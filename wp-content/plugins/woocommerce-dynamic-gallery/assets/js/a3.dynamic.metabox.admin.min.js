jQuery(function(a){function e(a){a.tipTip({attribute:"data-tip",maxWidth:"500px",fadeIn:50,fadeOut:50})}function i(e){e.sortable({items:"li.image",cursor:"move",scrollSensitivity:40,forcePlaceholderSize:!0,forceHelperSize:!1,helper:"clone",opacity:.65,placeholder:"metabox-sortable-placeholder",start:function(a,e){e.item.css("background-color","#f6f6f6")},stop:function(a,e){e.item.removeAttr("style")},update:function(e,i){var t="";dgallery_images_container=a(this).parents(".dgallery_images_container"),dgallery_ids=dgallery_images_container.find(".dgallery_ids"),a(this).find("li.image").css("cursor","default").each(function(){var e=a(this).attr("data-attachment_id");t=t+e+","}),dgallery_ids.val(t),l(dgallery_images_container)}})}function t(){a("input.actived_d_gallery").is(":checked")&&a("input.wc_dgallery_show_variation").is(":checked")?(a(".variations_dgallery_activated_panel_container").slideDown(),a(".woocommerce_variation .upload_image").slideUp()):(a(".variations_dgallery_activated_panel_container").slideUp(),a(".woocommerce_variation .upload_image").slideDown())}function l(e){if(e.hasClass("dgallery_variation_images_container")){dgallery_ids=e.find(".dgallery_ids"),e.find(".a3_dg_variation_ajax_loader").show();var i={action:"wc_dgallery_variation_save_gallery_ids",variation_id:dgallery_ids.data("variation-id"),dgallery_ids:dgallery_ids.val()};a.post(a3_dgallery_metabox.ajax_url,i,function(a){e.find(".a3_dg_variation_ajax_loader").hide()})}}e(a(".dg_tips")),a(document.body).on("woocommerce-product-type-change",function(e,i){"variable"==i?a(".a3_dgallery_is_variable_product").slideDown():a(".a3_dgallery_is_variable_product").slideUp()}),a("#woocommerce-product-data").on("woocommerce_variations_loaded",function(){e(a(".woocommerce_variation .dg_tips")),i(a(".woocommerce_variation ul.dgallery_images")),t()}),a(document.body).on("woocommerce_variations_added",function(){e(a(".woocommerce_variation .dg_tips")),i(a(".woocommerce_variation ul.dgallery_images")),t()}),a("input.actived_d_gallery").change(function(){a(this).is(":checked")?(a("#main_dgallery_panel").slideDown(),a(".variations_dgallery_deactivated_panel_container").slideUp()):(a("#main_dgallery_panel").slideUp(),a(".variations_dgallery_deactivated_panel_container").slideDown()),t()}),a("input.wc_dgallery_show_variation").change(function(){t()}),a(document).on("click",".add_dgallery_images a",function(e){var i,t=a(this),d=a(this).parents(".dgallery_images_container"),o=d.find(".dgallery_ids"),n=d.find("ul.dgallery_images");return e.preventDefault(),i?void i.open():(i=wp.media.frames.a3_dgallery=wp.media({title:t.data("choose"),button:{text:t.data("update")},states:[new wp.media.controller.Library({title:t.data("choose"),filterable:"uploaded",allowLocalEdits:!0,displayUserSettings:!0,multiple:!0,type:"image"})]}),i.on("select",function(){var a=i.state().get("selection"),e=o.val();a.map(function(a){if(a=a.toJSON(),a.id){e=e?e+","+a.id:a.id;var i=a.sizes&&a.sizes.thumbnail?a.sizes.thumbnail.url:a.url;n.append('					<li class="image" data-attachment_id="'+a.id+'">						<img src="'+i+'" />						<ul class="actions">							<li><a href="#" class="delete dg_tips" data-tip="'+t.data("delete")+'" title="'+t.data("delete")+'">'+t.data("text")+"</a></li>						</ul>					</li>")}}),o.val(e),l(d)}),void i.open())}),a(".dgallery_images_container").find("ul.dgallery_images").each(function(){i(a(this))}),a(document).on("click",".dgallery_images_container a.delete",function(){var e=a(this).parents(".dgallery_images_container"),i=e.find(".dgallery_ids"),t=e.find("ul.dgallery_images");a("#tiptip_holder").hide(),a(this).closest("li.image").remove();var d="";return t.find("li.image").css("cursor","default").each(function(){var e=a(this).attr("data-attachment_id");d=d+e+","}),i.val(d),l(e),!1})});