//     Underscore.js 1.6.0
//     http://underscorejs.org
//     (c) 2009-2014 Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
//     Underscore may be freely distributed under the MIT license.

/**
 * @license RequireJS text 2.0.3 Copyright (c) 2010-2012, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/requirejs/text for details
 */

/* Chosen v1.1.0 | (c) 2011-2013 by Harvest | MIT License, https://github.com/harvesthq/chosen/blob/master/LICENSE.md */

/*! jquery-dateFormat 10-05-2014 */

/*!
 * jQuery Simulate v@VERSION - simulate browser mouse and keyboard events
 * https://github.com/jquery/jquery-simulate
 *
 * Copyright 2012 jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 *
 * Date: @DATE
 */

/**
 * findAndReplaceDOMText v 0.4.2
 * @author James Padolsey http://james.padolsey.com
 * @license http://unlicense.org/UNLICENSE
 *
 * Matches the text of a DOM node against a regular expression
 * and replaces each match (or node-separated portions of the match)
 * in the specified element.
 */

/*
    Redactor v10.0.9
    Updated: March 16, 2015

    http://imperavi.com/redactor/

    Copyright (c) 2009-2015, Imperavi LLC.
    License: http://imperavi.com/redactor/license/

    Usage: $('#content').redactor();
*/

(function(){var e=this,t=e._,n={},r=Array.prototype,i=Object.prototype,s=Function.prototype,o=r.push,u=r.slice,a=r.concat,f=i.toString,l=i.hasOwnProperty,c=r.forEach,h=r.map,p=r.reduce,d=r.reduceRight,v=r.filter,m=r.every,g=r.some,y=r.indexOf,b=r.lastIndexOf,w=Array.isArray,E=Object.keys,S=s.bind,x=function(e){return e instanceof x?e:this instanceof x?void (this._wrapped=e):new x(e)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=x),exports._=x):e._=x,x.VERSION="1.6.0";var T=x.each=x.forEach=function(e,t,r){if(null==e)return e;if(c&&e.forEach===c)e.forEach(t,r);else if(e.length===+e.length){for(var i=0,s=e.length;s>i;i++)if(t.call(r,e[i],i,e)===n)return}else for(var o=x.keys(e),i=0,s=o.length;s>i;i++)if(t.call(r,e[o[i]],o[i],e)===n)return;return e};x.map=x.collect=function(e,t,n){var r=[];return null==e?r:h&&e.map===h?e.map(t,n):(T(e,function(e,i,s){r.push(t.call(n,e,i,s))}),r)};var N="Reduce of empty array with no initial value";x.reduce=x.foldl=x.inject=function(e,t,n,r){var i=arguments.length>2;if(null==e&&(e=[]),p&&e.reduce===p)return r&&(t=x.bind(t,r)),i?e.reduce(t,n):e.reduce(t);if(T(e,function(e,s,o){i?n=t.call(r,n,e,s,o):(n=e,i=!0)}),!i)throw new TypeError(N);return n},x.reduceRight=x.foldr=function(e,t,n,r){var i=arguments.length>2;if(null==e&&(e=[]),d&&e.reduceRight===d)return r&&(t=x.bind(t,r)),i?e.reduceRight(t,n):e.reduceRight(t);var s=e.length;if(s!==+s){var o=x.keys(e);s=o.length}if(T(e,function(u,a,f){a=o?o[--s]:--s,i?n=t.call(r,n,e[a],a,f):(n=e[a],i=!0)}),!i)throw new TypeError(N);return n},x.find=x.detect=function(e,t,n){var r;return C(e,function(e,i,s){return t.call(n,e,i,s)?(r=e,!0):void 0}),r},x.filter=x.select=function(e,t,n){var r=[];return null==e?r:v&&e.filter===v?e.filter(t,n):(T(e,function(e,i,s){t.call(n,e,i,s)&&r.push(e)}),r)},x.reject=function(e,t,n){return x.filter(e,function(e,r,i){return!t.call(n,e,r,i)},n)},x.every=x.all=function(e,t,r){t||(t=x.identity);var i=!0;return null==e?i:m&&e.every===m?e.every(t,r):(T(e,function(e,s,o){return(i=i&&t.call(r,e,s,o))?void 0:n}),!!i)};var C=x.some=x.any=function(e,t,r){t||(t=x.identity);var i=!1;return null==e?i:g&&e.some===g?e.some(t,r):(T(e,function(e,s,o){return i||(i=t.call(r,e,s,o))?n:void 0}),!!i)};x.contains=x.include=function(e,t){return null==e?!1:y&&e.indexOf===y?e.indexOf(t)!=-1:C(e,function(e){return e===t})},x.invoke=function(e,t){var n=u.call(arguments,2),r=x.isFunction(t);return x.map(e,function(e){return(r?t:e[t]).apply(e,n)})},x.pluck=function(e,t){return x.map(e,x.property(t))},x.where=function(e,t){return x.filter(e,x.matches(t))},x.findWhere=function(e,t){return x.find(e,x.matches(t))},x.max=function(e,t,n){if(!t&&x.isArray(e)&&e[0]===+e[0]&&e.length<65535)return Math.max.apply(Math,e);var r=-1/0,i=-1/0;return T(e,function(e,s,o){var u=t?t.call(n,e,s,o):e;u>i&&(r=e,i=u)}),r},x.min=function(e,t,n){if(!t&&x.isArray(e)&&e[0]===+e[0]&&e.length<65535)return Math.min.apply(Math,e);var r=1/0,i=1/0;return T(e,function(e,s,o){var u=t?t.call(n,e,s,o):e;i>u&&(r=e,i=u)}),r},x.shuffle=function(e){var t,n=0,r=[];return T(e,function(e){t=x.random(n++),r[n-1]=r[t],r[t]=e}),r},x.sample=function(e,t,n){return null==t||n?(e.length!==+e.length&&(e=x.values(e)),e[x.random(e.length-1)]):x.shuffle(e).slice(0,Math.max(0,t))};var k=function(e){return null==e?x.identity:x.isFunction(e)?e:x.property(e)};x.sortBy=function(e,t,n){return t=k(t),x.pluck(x.map(e,function(e,r,i){return{value:e,index:r,criteria:t.call(n,e,r,i)}}).sort(function(e,t){var n=e.criteria,r=t.criteria;if(n!==r){if(n>r||n===void 0)return 1;if(r>n||r===void 0)return-1}return e.index-t.index}),"value")};var L=function(e){return function(t,n,r){var i={};return n=k(n),T(t,function(s,o){var u=n.call(r,s,o,t);e(i,u,s)}),i}};x.groupBy=L(function(e,t,n){x.has(e,t)?e[t].push(n):e[t]=[n]}),x.indexBy=L(function(e,t,n){e[t]=n}),x.countBy=L(function(e,t){x.has(e,t)?e[t]++:e[t]=1}),x.sortedIndex=function(e,t,n,r){n=k(n);for(var i=n.call(r,t),s=0,o=e.length;o>s;){var u=s+o>>>1;n.call(r,e[u])<i?s=u+1:o=u}return s},x.toArray=function(e){return e?x.isArray(e)?u.call(e):e.length===+e.length?x.map(e,x.identity):x.values(e):[]},x.size=function(e){return null==e?0:e.length===+e.length?e.length:x.keys(e).length},x.first=x.head=x.take=function(e,t,n){return null==e?void 0:null==t||n?e[0]:0>t?[]:u.call(e,0,t)},x.initial=function(e,t,n){return u.call(e,0,e.length-(null==t||n?1:t))},x.last=function(e,t,n){return null==e?void 0:null==t||n?e[e.length-1]:u.call(e,Math.max(e.length-t,0))},x.rest=x.tail=x.drop=function(e,t,n){return u.call(e,null==t||n?1:t)},x.compact=function(e){return x.filter(e,x.identity)};var A=function(e,t,n){return t&&x.every(e,x.isArray)?a.apply(n,e):(T(e,function(e){x.isArray(e)||x.isArguments(e)?t?o.apply(n,e):A(e,t,n):n.push(e)}),n)};x.flatten=function(e,t){return A(e,t,[])},x.without=function(e){return x.difference(e,u.call(arguments,1))},x.partition=function(e,t){var n=[],r=[];return T(e,function(e){(t(e)?n:r).push(e)}),[n,r]},x.uniq=x.unique=function(e,t,n,r){x.isFunction(t)&&(r=n,n=t,t=!1);var i=n?x.map(e,n,r):e,s=[],o=[];return T(i,function(n,r){(t?r&&o[o.length-1]===n:x.contains(o,n))||(o.push(n),s.push(e[r]))}),s},x.union=function(){return x.uniq(x.flatten(arguments,!0))},x.intersection=function(e){var t=u.call(arguments,1);return x.filter(x.uniq(e),function(e){return x.every(t,function(t){return x.contains(t,e)})})},x.difference=function(e){var t=a.apply(r,u.call(arguments,1));return x.filter(e,function(e){return!x.contains(t,e)})},x.zip=function(){for(var e=x.max(x.pluck(arguments,"length").concat(0)),t=new Array(e),n=0;e>n;n++)t[n]=x.pluck(arguments,""+n);return t},x.object=function(e,t){if(null==e)return{};for(var n={},r=0,i=e.length;i>r;r++)t?n[e[r]]=t[r]:n[e[r][0]]=e[r][1];return n},x.indexOf=function(e,t,n){if(null==e)return-1;var r=0,i=e.length;if(n){if("number"!=typeof n)return r=x.sortedIndex(e,t),e[r]===t?r:-1;r=0>n?Math.max(0,i+n):n}if(y&&e.indexOf===y)return e.indexOf(t,n);for(;i>r;r++)if(e[r]===t)return r;return-1},x.lastIndexOf=function(e,t,n){if(null==e)return-1;var r=null!=n;if(b&&e.lastIndexOf===b)return r?e.lastIndexOf(t,n):e.lastIndexOf(t);for(var i=r?n:e.length;i--;)if(e[i]===t)return i;return-1},x.range=function(e,t,n){arguments.length<=1&&(t=e||0,e=0),n=arguments[2]||1;for(var r=Math.max(Math.ceil((t-e)/n),0),i=0,s=new Array(r);r>i;)s[i++]=e,e+=n;return s};var O=function(){};x.bind=function(e,t){var n,r;if(S&&e.bind===S)return S.apply(e,u.call(arguments,1));if(!x.isFunction(e))throw new TypeError;return n=u.call(arguments,2),r=function(){if(this instanceof r){O.prototype=e.prototype;var i=new O;O.prototype=null;var s=e.apply(i,n.concat(u.call(arguments)));return Object(s)===s?s:i}return e.apply(t,n.concat(u.call(arguments)))}},x.partial=function(e){var t=u.call(arguments,1);return function(){for(var n=0,r=t.slice(),i=0,s=r.length;s>i;i++)r[i]===x&&(r[i]=arguments[n++]);for(;n<arguments.length;)r.push(arguments[n++]);return e.apply(this,r)}},x.bindAll=function(e){var t=u.call(arguments,1);if(0===t.length)throw new Error("bindAll must be passed function names");return T(t,function(t){e[t]=x.bind(e[t],e)}),e},x.memoize=function(e,t){var n={};return t||(t=x.identity),function(){var r=t.apply(this,arguments);return x.has(n,r)?n[r]:n[r]=e.apply(this,arguments)}},x.delay=function(e,t){var n=u.call(arguments,2);return setTimeout(function(){return e.apply(null,n)},t)},x.defer=function(e){return x.delay.apply(x,[e,1].concat(u.call(arguments,1)))},x.throttle=function(e,t,n){var r,i,s,o=null,u=0;n||(n={});var a=function(){u=n.leading===!1?0:x.now(),o=null,s=e.apply(r,i),r=i=null};return function(){var f=x.now();u||n.leading!==!1||(u=f);var l=t-(f-u);return r=this,i=arguments,0>=l?(clearTimeout(o),o=null,u=f,s=e.apply(r,i),r=i=null):o||n.trailing===!1||(o=setTimeout(a,l)),s}},x.debounce=function(e,t,n){var r,i,s,o,u,a=function(){var f=x.now()-o;t>f?r=setTimeout(a,t-f):(r=null,n||(u=e.apply(s,i),s=i=null))};return function(){s=this,i=arguments,o=x.now();var f=n&&!r;return r||(r=setTimeout(a,t)),f&&(u=e.apply(s,i),s=i=null),u}},x.once=function(e){var t,n=!1;return function(){return n?t:(n=!0,t=e.apply(this,arguments),e=null,t)}},x.wrap=function(e,t){return x.partial(t,e)},x.compose=function(){var e=arguments;return function(){for(var t=arguments,n=e.length-1;n>=0;n--)t=[e[n].apply(this,t)];return t[0]}},x.after=function(e,t){return function(){return--e<1?t.apply(this,arguments):void 0}},x.keys=function(e){if(!x.isObject(e))return[];if(E)return E(e);var t=[];for(var n in e)x.has(e,n)&&t.push(n);return t},x.values=function(e){for(var t=x.keys(e),n=t.length,r=new Array(n),i=0;n>i;i++)r[i]=e[t[i]];return r},x.pairs=function(e){for(var t=x.keys(e),n=t.length,r=new Array(n),i=0;n>i;i++)r[i]=[t[i],e[t[i]]];return r},x.invert=function(e){for(var t={},n=x.keys(e),r=0,i=n.length;i>r;r++)t[e[n[r]]]=n[r];return t},x.functions=x.methods=function(e){var t=[];for(var n in e)x.isFunction(e[n])&&t.push(n);return t.sort()},x.extend=function(e){return T(u.call(arguments,1),function(t){if(t)for(var n in t)e[n]=t[n]}),e},x.pick=function(e){var t={},n=a.apply(r,u.call(arguments,1));return T(n,function(n){n in e&&(t[n]=e[n])}),t},x.omit=function(e){var t={},n=a.apply(r,u.call(arguments,1));for(var i in e)x.contains(n,i)||(t[i]=e[i]);return t},x.defaults=function(e){return T(u.call(arguments,1),function(t){if(t)for(var n in t)e[n]===void 0&&(e[n]=t[n])}),e},x.clone=function(e){return x.isObject(e)?x.isArray(e)?e.slice():x.extend({},e):e},x.tap=function(e,t){return t(e),e};var M=function(e,t,n,r){if(e===t)return 0!==e||1/e==1/t;if(null==e||null==t)return e===t;e instanceof x&&(e=e._wrapped),t instanceof x&&(t=t._wrapped);var i=f.call(e);if(i!=f.call(t))return!1;switch(i){case"[object String]":return e==String(t);case"[object Number]":return e!=+e?t!=+t:0==e?1/e==1/t:e==+t;case"[object Date]":case"[object Boolean]":return+e==+t;case"[object RegExp]":return e.source==t.source&&e.global==t.global&&e.multiline==t.multiline&&e.ignoreCase==t.ignoreCase}if("object"!=typeof e||"object"!=typeof t)return!1;for(var s=n.length;s--;)if(n[s]==e)return r[s]==t;var o=e.constructor,u=t.constructor;if(o!==u&&!(x.isFunction(o)&&o instanceof o&&x.isFunction(u)&&u instanceof u)&&"constructor"in e&&"constructor"in t)return!1;n.push(e),r.push(t);var a=0,l=!0;if("[object Array]"==i){if(a=e.length,l=a==t.length)for(;a--&&(l=M(e[a],t[a],n,r)););}else{for(var c in e)if(x.has(e,c)&&(a++,!(l=x.has(t,c)&&M(e[c],t[c],n,r))))break;if(l){for(c in t)if(x.has(t,c)&&!(a--))break;l=!a}}return n.pop(),r.pop(),l};x.isEqual=function(e,t){return M(e,t,[],[])},x.isEmpty=function(e){if(null==e)return!0;if(x.isArray(e)||x.isString(e))return 0===e.length;for(var t in e)if(x.has(e,t))return!1;return!0},x.isElement=function(e){return!!e&&1===e.nodeType},x.isArray=w||function(e){return"[object Array]"==f.call(e)},x.isObject=function(e){return e===Object(e)},T(["Arguments","Function","String","Number","Date","RegExp"],function(e){x["is"+e]=function(t){return f.call(t)=="[object "+e+"]"}}),x.isArguments(arguments)||(x.isArguments=function(e){return!!e&&!!x.has(e,"callee")}),"function"!=typeof /./&&(x.isFunction=function(e){return"function"==typeof e}),x.isFinite=function(e){return isFinite(e)&&!isNaN(parseFloat(e))},x.isNaN=function(e){return x.isNumber(e)&&e!=+e},x.isBoolean=function(e){return e===!0||e===!1||"[object Boolean]"==f.call(e)},x.isNull=function(e){return null===e},x.isUndefined=function(e){return e===void 0},x.has=function(e,t){return l.call(e,t)},x.noConflict=function(){return e._=t,this},x.identity=function(e){return e},x.constant=function(e){return function(){return e}},x.property=function(e){return function(t){return t[e]}},x.matches=function(e){return function(t){if(t===e)return!0;for(var n in e)if(e[n]!==t[n])return!1;return!0}},x.times=function(e,t,n){for(var r=Array(Math.max(0,e)),i=0;e>i;i++)r[i]=t.call(n,i);return r},x.random=function(e,t){return null==t&&(t=e,e=0),e+Math.floor(Math.random()*(t-e+1))},x.now=Date.now||function(){return(new Date).getTime()};var _={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"}};_.unescape=x.invert(_.escape);var D={escape:new RegExp("["+x.keys(_.escape).join("")+"]","g"),unescape:new RegExp("("+x.keys(_.unescape).join("|")+")","g")};x.each(["escape","unescape"],function(e){x[e]=function(t){return null==t?"":(""+t).replace(D[e],function(t){return _[e][t]})}}),x.result=function(e,t){if(null==e)return void 0;var n=e[t];return x.isFunction(n)?n.call(e):n},x.mixin=function(e){T(x.functions(e),function(t){var n=x[t]=e[t];x.prototype[t]=function(){var e=[this._wrapped];return o.apply(e,arguments),F.call(this,n.apply(x,e))}})};var P=0;x.uniqueId=function(e){var t=++P+"";return e?e+t:t},x.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var H=/(.)^/,B={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},j=/\\|'|\r|\n|\t|\u2028|\u2029/g;x.template=function(e,t,n){var r;n=x.defaults({},n,x.templateSettings);var i=new RegExp([(n.escape||H).source,(n.interpolate||H).source,(n.evaluate||H).source].join("|")+"|$","g"),s=0,o="__p+='";e.replace(i,function(t,n,r,i,u){return o+=e.slice(s,u).replace(j,function(e){return"\\"+B[e]}),n&&(o+="'+\n((__t=("+n+"))==null?'':_.escape(__t))+\n'"),r&&(o+="'+\n((__t=("+r+"))==null?'':__t)+\n'"),i&&(o+="';\n"+i+"\n__p+='"),s=u+t.length,t}),o+="';\n",n.variable||(o="with(obj||{}){\n"+o+"}\n"),o="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+o+"return __p;\n";try{r=new Function(n.variable||"obj","_",o)}catch(u){throw u.source=o,u}if(t)return r(t,x);var a=function(e){return r.call(this,e,x)};return a.source="function("+(n.variable||"obj")+"){\n"+o+"}",a},x.chain=function(e){return x(e).chain()};var F=function(e){return this._chain?x(e).chain():e};x.mixin(x),T(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var t=r[e];x.prototype[e]=function(){var n=this._wrapped;return t.apply(n,arguments),"shift"!=e&&"splice"!=e||0!==n.length||delete n[0],F.call(this,n)}}),T(["concat","join","slice"],function(e){var t=r[e];x.prototype[e]=function(){return F.call(this,t.apply(this._wrapped,arguments))}}),x.extend(x.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}}),"function"==typeof define&&define.amd&&define("underscore",[],function(){return x})}).call(this),function(e,t){if(typeof define=="function"&&define.amd)define("backbone",["underscore","jquery","exports"],function(n,r,i){e.Backbone=t(e,i,n,r)});else if(typeof exports!="undefined"){var n=require("underscore");t(e,exports,n)}else e.Backbone=t(e,{},e._,e.jQuery||e.Zepto||e.ender||e.$)}(this,function(e,t,n,r){var i=e.Backbone,s=[],o=s.push,u=s.slice,a=s.splice;t.VERSION="1.1.2",t.$=r,t.noConflict=function(){return e.Backbone=i,this},t.emulateHTTP=!1,t.emulateJSON=!1;var f=t.Events={on:function(e,t,n){if(!c(this,"on",e,[t,n])||!t)return this;this._events||(this._events={});var r=this._events[e]||(this._events[e]=[]);return r.push({callback:t,context:n,ctx:n||this}),this},once:function(e,t,r){if(!c(this,"once",e,[t,r])||!t)return this;var i=this,s=n.once(function(){i.off(e,s),t.apply(this,arguments)});return s._callback=t,this.on(e,s,r)},off:function(e,t,r){var i,s,o,u,a,f,l,h;if(!this._events||!c(this,"off",e,[t,r]))return this;if(!e&&!t&&!r)return this._events=void 0,this;u=e?[e]:n.keys(this._events);for(a=0,f=u.length;a<f;a++){e=u[a];if(o=this._events[e]){this._events[e]=i=[];if(t||r)for(l=0,h=o.length;l<h;l++)s=o[l],(t&&t!==s.callback&&t!==s.callback._callback||r&&r!==s.context)&&i.push(s);i.length||delete this._events[e]}}return this},trigger:function(e){if(!this._events)return this;var t=u.call(arguments,1);if(!c(this,"trigger",e,t))return this;var n=this._events[e],r=this._events.all;return n&&h(n,t),r&&h(r,arguments),this},stopListening:function(e,t,r){var i=this._listeningTo;if(!i)return this;var s=!t&&!r;!r&&typeof t=="object"&&(r=this),e&&((i={})[e._listenId]=e);for(var o in i)e=i[o],e.off(t,r,this),(s||n.isEmpty(e._events))&&delete this._listeningTo[o];return this}},l=/\s+/,c=function(e,t,n,r){if(!n)return!0;if(typeof n=="object"){for(var i in n)e[t].apply(e,[i,n[i]].concat(r));return!1}if(l.test(n)){var s=n.split(l);for(var o=0,u=s.length;o<u;o++)e[t].apply(e,[s[o]].concat(r));return!1}return!0},h=function(e,t){var n,r=-1,i=e.length,s=t[0],o=t[1],u=t[2];switch(t.length){case 0:while(++r<i)(n=e[r]).callback.call(n.ctx);return;case 1:while(++r<i)(n=e[r]).callback.call(n.ctx,s);return;case 2:while(++r<i)(n=e[r]).callback.call(n.ctx,s,o);return;case 3:while(++r<i)(n=e[r]).callback.call(n.ctx,s,o,u);return;default:while(++r<i)(n=e[r]).callback.apply(n.ctx,t);return}},p={listenTo:"on",listenToOnce:"once"};n.each(p,function(e,t){f[t]=function(t,r,i){var s=this._listeningTo||(this._listeningTo={}),o=t._listenId||(t._listenId=n.uniqueId("l"));return s[o]=t,!i&&typeof r=="object"&&(i=this),t[e](r,i,this),this}}),f.bind=f.on,f.unbind=f.off,n.extend(t,f);var d=t.Model=function(e,t){var r=e||{};t||(t={}),this.cid=n.uniqueId("c"),this.attributes={},t.collection&&(this.collection=t.collection),t.parse&&(r=this.parse(r,t)||{}),r=n.defaults({},r,n.result(this,"defaults")),this.set(r,t),this.changed={},this.initialize.apply(this,arguments)};n.extend(d.prototype,f,{changed:null,validationError:null,idAttribute:"id",initialize:function(){},toJSON:function(e){return n.clone(this.attributes)},sync:function(){return t.sync.apply(this,arguments)},get:function(e){return this.attributes[e]},escape:function(e){return n.escape(this.get(e))},has:function(e){return this.get(e)!=null},set:function(e,t,r){var i,s,o,u,a,f,l,c;if(e==null)return this;typeof e=="object"?(s=e,r=t):(s={})[e]=t,r||(r={});if(!this._validate(s,r))return!1;o=r.unset,a=r.silent,u=[],f=this._changing,this._changing=!0,f||(this._previousAttributes=n.clone(this.attributes),this.changed={}),c=this.attributes,l=this._previousAttributes,this.idAttribute in s&&(this.id=s[this.idAttribute]);for(i in s)t=s[i],n.isEqual(c[i],t)||u.push(i),n.isEqual(l[i],t)?delete this.changed[i]:this.changed[i]=t,o?delete c[i]:c[i]=t;if(!a){u.length&&(this._pending=r);for(var h=0,p=u.length;h<p;h++)this.trigger("change:"+u[h],this,c[u[h]],r)}if(f)return this;if(!a)while(this._pending)r=this._pending,this._pending=!1,this.trigger("change",this,r);return this._pending=!1,this._changing=!1,this},unset:function(e,t){return this.set(e,void 0,n.extend({},t,{unset:!0}))},clear:function(e){var t={};for(var r in this.attributes)t[r]=void 0;return this.set(t,n.extend({},e,{unset:!0}))},hasChanged:function(e){return e==null?!n.isEmpty(this.changed):n.has(this.changed,e)},changedAttributes:function(e){if(!e)return this.hasChanged()?n.clone(this.changed):!1;var t,r=!1,i=this._changing?this._previousAttributes:this.attributes;for(var s in e){if(n.isEqual(i[s],t=e[s]))continue;(r||(r={}))[s]=t}return r},previous:function(e){return e==null||!this._previousAttributes?null:this._previousAttributes[e]},previousAttributes:function(){return n.clone(this._previousAttributes)},fetch:function(e){e=e?n.clone(e):{},e.parse===void 0&&(e.parse=!0);var t=this,r=e.success;return e.success=function(n){if(!t.set(t.parse(n,e),e))return!1;r&&r(t,n,e),t.trigger("sync",t,n,e)},I(this,e),this.sync("read",this,e)},save:function(e,t,r){var i,s,o,u=this.attributes;e==null||typeof e=="object"?(i=e,r=t):(i={})[e]=t,r=n.extend({validate:!0},r);if(i&&!r.wait){if(!this.set(i,r))return!1}else if(!this._validate(i,r))return!1;i&&r.wait&&(this.attributes=n.extend({},u,i)),r.parse===void 0&&(r.parse=!0);var a=this,f=r.success;return r.success=function(e){a.attributes=u;var t=a.parse(e,r);r.wait&&(t=n.extend(i||{},t));if(n.isObject(t)&&!a.set(t,r))return!1;f&&f(a,e,r),a.trigger("sync",a,e,r)},I(this,r),s=this.isNew()?"create":r.patch?"patch":"update",s==="patch"&&(r.attrs=i),o=this.sync(s,this,r),i&&r.wait&&(this.attributes=u),o},destroy:function(e){e=e?n.clone(e):{};var t=this,r=e.success,i=function(){t.trigger("destroy",t,t.collection,e)};e.success=function(n){(e.wait||t.isNew())&&i(),r&&r(t,n,e),t.isNew()||t.trigger("sync",t,n,e)};if(this.isNew())return e.success(),!1;I(this,e);var s=this.sync("delete",this,e);return e.wait||i(),s},url:function(){var e=n.result(this,"urlRoot")||n.result(this.collection,"url")||F();return this.isNew()?e:e.replace(/([^\/])$/,"$1/")+encodeURIComponent(this.id)},parse:function(e,t){return e},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return!this.has(this.idAttribute)},isValid:function(e){return this._validate({},n.extend(e||{},{validate:!0}))},_validate:function(e,t){if(!t.validate||!this.validate)return!0;e=n.extend({},this.attributes,e);var r=this.validationError=this.validate(e,t)||null;return r?(this.trigger("invalid",this,r,n.extend(t,{validationError:r})),!1):!0}});var v=["keys","values","pairs","invert","pick","omit"];n.each(v,function(e){d.prototype[e]=function(){var t=u.call(arguments);return t.unshift(this.attributes),n[e].apply(n,t)}});var m=t.Collection=function(e,t){t||(t={}),t.model&&(this.model=t.model),t.comparator!==void 0&&(this.comparator=t.comparator),this._reset(),this.initialize.apply(this,arguments),e&&this.reset(e,n.extend({silent:!0},t))},g={add:!0,remove:!0,merge:!0},y={add:!0,remove:!1};n.extend(m.prototype,f,{model:d,initialize:function(){},toJSON:function(e){return this.map(function(t){return t.toJSON(e)})},sync:function(){return t.sync.apply(this,arguments)},add:function(e,t){return this.set(e,n.extend({merge:!1},t,y))},remove:function(e,t){var r=!n.isArray(e);e=r?[e]:n.clone(e),t||(t={});var i,s,o,u;for(i=0,s=e.length;i<s;i++){u=e[i]=this.get(e[i]);if(!u)continue;delete this._byId[u.id],delete this._byId[u.cid],o=this.indexOf(u),this.models.splice(o,1),this.length--,t.silent||(t.index=o,u.trigger("remove",u,this,t)),this._removeReference(u,t)}return r?e[0]:e},set:function(e,t){t=n.defaults({},t,g),t.parse&&(e=this.parse(e,t));var r=!n.isArray(e);e=r?e?[e]:[]:n.clone(e);var i,s,o,u,a,f,l,c=t.at,h=this.model,p=this.comparator&&c==null&&t.sort!==!1,v=n.isString(this.comparator)?this.comparator:null,m=[],y=[],b={},w=t.add,E=t.merge,S=t.remove,x=!p&&w&&S?[]:!1;for(i=0,s=e.length;i<s;i++){a=e[i]||{},a instanceof d?o=u=a:o=a[h.prototype.idAttribute||"id"];if(f=this.get(o))S&&(b[f.cid]=!0),E&&(a=a===u?u.attributes:a,t.parse&&(a=f.parse(a,t)),f.set(a,t),p&&!l&&f.hasChanged(v)&&(l=!0)),e[i]=f;else if(w){u=e[i]=this._prepareModel(a,t);if(!u)continue;m.push(u),this._addReference(u,t)}u=f||u,x&&(u.isNew()||!b[u.id])&&x.push(u),b[u.id]=!0}if(S){for(i=0,s=this.length;i<s;++i)b[(u=this.models[i]).cid]||y.push(u);y.length&&this.remove(y,t)}if(m.length||x&&x.length){p&&(l=!0),this.length+=m.length;if(c!=null)for(i=0,s=m.length;i<s;i++)this.models.splice(c+i,0,m[i]);else{x&&(this.models.length=0);var T=x||m;for(i=0,s=T.length;i<s;i++)this.models.push(T[i])}}l&&this.sort({silent:!0});if(!t.silent){for(i=0,s=m.length;i<s;i++)(u=m[i]).trigger("add",u,this,t);(l||x&&x.length)&&this.trigger("sort",this,t)}return r?e[0]:e},reset:function(e,t){t||(t={});for(var r=0,i=this.models.length;r<i;r++)this._removeReference(this.models[r],t);return t.previousModels=this.models,this._reset(),e=this.add(e,n.extend({silent:!0},t)),t.silent||this.trigger("reset",this,t),e},push:function(e,t){return this.add(e,n.extend({at:this.length},t))},pop:function(e){var t=this.at(this.length-1);return this.remove(t,e),t},unshift:function(e,t){return this.add(e,n.extend({at:0},t))},shift:function(e){var t=this.at(0);return this.remove(t,e),t},slice:function(){return u.apply(this.models,arguments)},get:function(e){return e==null?void 0:this._byId[e]||this._byId[e.id]||this._byId[e.cid]},at:function(e){return this.models[e]},where:function(e,t){return n.isEmpty(e)?t?void 0:[]:this[t?"find":"filter"](function(t){for(var n in e)if(e[n]!==t.get(n))return!1;return!0})},findWhere:function(e){return this.where(e,!0)},sort:function(e){if(!this.comparator)throw new Error("Cannot sort a set without a comparator");return e||(e={}),n.isString(this.comparator)||this.comparator.length===1?this.models=this.sortBy(this.comparator,this):this.models.sort(n.bind(this.comparator,this)),e.silent||this.trigger("sort",this,e),this},pluck:function(e){return n.invoke(this.models,"get",e)},fetch:function(e){e=e?n.clone(e):{},e.parse===void 0&&(e.parse=!0);var t=e.success,r=this;return e.success=function(n){var i=e.reset?"reset":"set";r[i](n,e),t&&t(r,n,e),r.trigger("sync",r,n,e)},I(this,e),this.sync("read",this,e)},create:function(e,t){t=t?n.clone(t):{};if(!(e=this._prepareModel(e,t)))return!1;t.wait||this.add(e,t);var r=this,i=t.success;return t.success=function(e,n){t.wait&&r.add(e,t),i&&i(e,n,t)},e.save(null,t),e},parse:function(e,t){return e},clone:function(){return new this.constructor(this.models)},_reset:function(){this.length=0,this.models=[],this._byId={}},_prepareModel:function(e,t){if(e instanceof d)return e;t=t?n.clone(t):{},t.collection=this;var r=new this.model(e,t);return r.validationError?(this.trigger("invalid",this,r.validationError,t),!1):r},_addReference:function(e,t){this._byId[e.cid]=e,e.id!=null&&(this._byId[e.id]=e),e.collection||(e.collection=this),e.on("all",this._onModelEvent,this)},_removeReference:function(e,t){this===e.collection&&delete e.collection,e.off("all",this._onModelEvent,this)},_onModelEvent:function(e,t,n,r){if((e==="add"||e==="remove")&&n!==this)return;e==="destroy"&&this.remove(t,r),t&&e==="change:"+t.idAttribute&&(delete this._byId[t.previous(t.idAttribute)],t.id!=null&&(this._byId[t.id]=t)),this.trigger.apply(this,arguments)}});var b=["forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","toArray","size","first","head","take","initial","rest","tail","drop","last","without","difference","indexOf","shuffle","lastIndexOf","isEmpty","chain","sample"];n.each(b,function(e){m.prototype[e]=function(){var t=u.call(arguments);return t.unshift(this.models),n[e].apply(n,t)}});var w=["groupBy","countBy","sortBy","indexBy"];n.each(w,function(e){m.prototype[e]=function(t,r){var i=n.isFunction(t)?t:function(e){return e.get(t)};return n[e](this.models,i,r)}});var E=t.View=function(e){this.cid=n.uniqueId("view"),e||(e={}),n.extend(this,n.pick(e,x)),this._ensureElement(),this.initialize.apply(this,arguments),this.delegateEvents()},S=/^(\S+)\s*(.*)$/,x=["model","collection","el","id","attributes","className","tagName","events"];n.extend(E.prototype,f,{tagName:"div",$:function(e){return this.$el.find(e)},initialize:function(){},render:function(){return this},remove:function(){return this.$el.remove(),this.stopListening(),this},setElement:function(e,n){return this.$el&&this.undelegateEvents(),this.$el=e instanceof t.$?e:t.$(e),this.el=this.$el[0],n!==!1&&this.delegateEvents(),this},delegateEvents:function(e){if(!e&&!(e=n.result(this,"events")))return this;this.undelegateEvents();for(var t in e){var r=e[t];n.isFunction(r)||(r=this[e[t]]);if(!r)continue;var i=t.match(S),s=i[1],o=i[2];r=n.bind(r,this),s+=".delegateEvents"+this.cid,o===""?this.$el.on(s,r):this.$el.on(s,o,r)}return this},undelegateEvents:function(){return this.$el.off(".delegateEvents"+this.cid),this},_ensureElement:function(){if(!this.el){var e=n.extend({},n.result(this,"attributes"));this.id&&(e.id=n.result(this,"id")),this.className&&(e["class"]=n.result(this,"className"));var r=t.$("<"+n.result(this,"tagName")+">").attr(e);this.setElement(r,!1)}else this.setElement(n.result(this,"el"),!1)}}),t.sync=function(e,r,i){var s=N[e];n.defaults(i||(i={}),{emulateHTTP:t.emulateHTTP,emulateJSON:t.emulateJSON});var o={type:s,dataType:"json"};i.url||(o.url=n.result(r,"url")||F()),i.data==null&&r&&(e==="create"||e==="update"||e==="patch")&&(o.contentType="application/json",o.data=JSON.stringify(i.attrs||r.toJSON(i))),i.emulateJSON&&(o.contentType="application/x-www-form-urlencoded",o.data=o.data?{model:o.data}:{});if(i.emulateHTTP&&(s==="PUT"||s==="DELETE"||s==="PATCH")){o.type="POST",i.emulateJSON&&(o.data._method=s);var u=i.beforeSend;i.beforeSend=function(e){e.setRequestHeader("X-HTTP-Method-Override",s);if(u)return u.apply(this,arguments)}}o.type!=="GET"&&!i.emulateJSON&&(o.processData=!1),o.type==="PATCH"&&T&&(o.xhr=function(){return new ActiveXObject("Microsoft.XMLHTTP")});var a=i.xhr=t.ajax(n.extend(o,i));return r.trigger("request",r,a,i),a};var T=typeof window!="undefined"&&!!window.ActiveXObject&&(!window.XMLHttpRequest||!(new XMLHttpRequest).dispatchEvent),N={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};t.ajax=function(){return t.$.ajax.apply(t.$,arguments)};var C=t.Router=function(e){e||(e={}),e.routes&&(this.routes=e.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},k=/\((.*?)\)/g,L=/(\(\?)?:\w+/g,A=/\*\w+/g,O=/[\-{}\[\]+?.,\\\^$|#\s]/g;n.extend(C.prototype,f,{initialize:function(){},route:function(e,r,i){n.isRegExp(e)||(e=this._routeToRegExp(e)),n.isFunction(r)&&(i=r,r=""),i||(i=this[r]);var s=this;return t.history.route(e,function(n){var o=s._extractParameters(e,n);s.execute(i,o),s.trigger.apply(s,["route:"+r].concat(o)),s.trigger("route",r,o),t.history.trigger("route",s,r,o)}),this},execute:function(e,t){e&&e.apply(this,t)},navigate:function(e,n){return t.history.navigate(e,n),this},_bindRoutes:function(){if(!this.routes)return;this.routes=n.result(this,"routes");var e,t=n.keys(this.routes);while((e=t.pop())!=null)this.route(e,this.routes[e])},_routeToRegExp:function(e){return e=e.replace(O,"\\$&").replace(k,"(?:$1)?").replace(L,function(e,t){return t?e:"([^/?]+)"}).replace(A,"([^?]*?)"),new RegExp("^"+e+"(?:\\?([\\s\\S]*))?$")},_extractParameters:function(e,t){var r=e.exec(t).slice(1);return n.map(r,function(e,t){return t===r.length-1?e||null:e?decodeURIComponent(e):null})}});var M=t.History=function(){this.handlers=[],n.bindAll(this,"checkUrl"),typeof window!="undefined"&&(this.location=window.location,this.history=window.history)},_=/^[#\/]|\s+$/g,D=/^\/+|\/+$/g,P=/msie [\w.]+/,H=/\/$/,B=/#.*$/;M.started=!1,n.extend(M.prototype,f,{interval:50,atRoot:function(){return this.location.pathname.replace(/[^\/]$/,"$&/")===this.root},getHash:function(e){var t=(e||this).location.href.match(/#(.*)$/);return t?t[1]:""},getFragment:function(e,t){if(e==null)if(this._hasPushState||!this._wantsHashChange||t){e=decodeURI(this.location.pathname+this.location.search);var n=this.root.replace(H,"");e.indexOf(n)||(e=e.slice(n.length))}else e=this.getHash();return e.replace(_,"")},start:function(e){if(M.started)throw new Error("Backbone.history has already been started");M.started=!0,this.options=n.extend({root:"/"},this.options,e),this.root=this.options.root,this._wantsHashChange=this.options.hashChange!==!1,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);var r=this.getFragment(),i=document.documentMode,s=P.exec(navigator.userAgent.toLowerCase())&&(!i||i<=7);this.root=("/"+this.root+"/").replace(D,"/");if(s&&this._wantsHashChange){var o=t.$('<iframe src="javascript:0" tabindex="-1">');this.iframe=o.hide().appendTo("body")[0].contentWindow,this.navigate(r)}this._hasPushState?t.$(window).on("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!s?t.$(window).on("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this.fragment=r;var u=this.location;if(this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!this.atRoot())return this.fragment=this.getFragment(null,!0),this.location.replace(this.root+"#"+this.fragment),!0;this._hasPushState&&this.atRoot()&&u.hash&&(this.fragment=this.getHash().replace(_,""),this.history.replaceState({},document.title,this.root+this.fragment))}if(!this.options.silent)return this.loadUrl()},stop:function(){t.$(window).off("popstate",this.checkUrl).off("hashchange",this.checkUrl),this._checkUrlInterval&&clearInterval(this._checkUrlInterval),M.started=!1},route:function(e,t){this.handlers.unshift({route:e,callback:t})},checkUrl:function(e){var t=this.getFragment();t===this.fragment&&this.iframe&&(t=this.getFragment(this.getHash(this.iframe)));if(t===this.fragment)return!1;this.iframe&&this.navigate(t),this.loadUrl()},loadUrl:function(e){return e=this.fragment=this.getFragment(e),n.any(this.handlers,function(t){if(t.route.test(e))return t.callback(e),!0})},navigate:function(e,t){if(!M.started)return!1;if(!t||t===!0)t={trigger:!!t};var n=this.root+(e=this.getFragment(e||""));e=e.replace(B,"");if(this.fragment===e)return;this.fragment=e,e===""&&n!=="/"&&(n=n.slice(0,-1));if(this._hasPushState)this.history[t.replace?"replaceState":"pushState"]({},document.title,n);else{if(!this._wantsHashChange)return this.location.assign(n);this._updateHash(this.location,e,t.replace),this.iframe&&e!==this.getFragment(this.getHash(this.iframe))&&(t.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,e,t.replace))}if(t.trigger)return this.loadUrl(e)},_updateHash:function(e,t,n){if(n){var r=e.href.replace(/(javascript:|#).*$/,"");e.replace(r+"#"+t)}else e.hash="#"+t}}),t.history=new M;var j=function(e,t){var r=this,i;e&&n.has(e,"constructor")?i=e.constructor:i=function(){return r.apply(this,arguments)},n.extend(i,r,t);var s=function(){this.constructor=i};return s.prototype=r.prototype,i.prototype=new s,e&&n.extend(i.prototype,e),i.__super__=r.prototype,i};d.extend=m.extend=C.extend=E.extend=M.extend=j;var F=function(){throw new Error('A "url" property or function must be specified')},I=function(e,t){var n=t.error;t.error=function(r){n&&n(e,r,t),e.trigger("error",e,r,t)}};return t}),function(e){define("models",["backbone"],function(t){Upfront.Events=_.isEmpty(Upfront.Events)?_.extend(Upfront.Events,t.Events):Upfront.Events;var n="alpha",r={},s=t.Model.extend({defaults:{name:"",value:""},idAttribute:"name"}),o=t.Collection.extend({model:s}),u=t.Model.extend({defaults:{name:"",element_id:"",properties:new o},initialize:function(){var e=arguments;e&&e[0]&&e[0].properties?(e[0].properties=e[0].properties instanceof o?e[0].properties:new o(e[0].properties),this.set("properties",e[0].properties)):this.set("properties",new o([])),this.init&&this.init(),this.get_property_value_by_name("currentpreset")&&(this.set_property("preset",this.get_property_value_by_name("currentpreset"),!0),this.set_property("currentpreset",!1,!0))},get_view_class:function(){return Upfront.Views.ObjectView},get_property_by_name:function(e){var t=this.get("properties").where({name:e});return t.length?t[0]:!1},get_property_value_by_name:function(e){var t=this.get_property_by_name(e);return t&&t.get?t.get("value"):!1},has_property:function(e){return!!this.get_property_value_by_name(e)},has_property_value:function(e,t){return t==this.get_property_value_by_name(e)},decode_preset:function(e){e=e||(Upfront.Views.breakpoints_storage.get_breakpoints().get_active()||{}).id;var t=this.get_property_value_by_name("preset")||"default",n=this.get_property_value_by_name("breakpoint_presets")||{},r=(n[e]||{}).preset,i=r||t;return this.set_property("preset",i,!1),i},encode_preset:function(e,t){t=t||(Upfront.Views.breakpoints_storage.get_breakpoints().get_active()||{}).id;var n=this.get_property_value_by_name("breakpoint_presets")||{};return current=(this.get_property_by_name("preset").previousAttributes()||{value:"default"}).value,default_bp_id=(Upfront.Views.breakpoints_storage.get_breakpoints().findWhere({"default":!0})||{}).id,n[t]={preset:e},n[default_bp_id]||(n[default_bp_id]={preset:current}),this.set_property("breakpoint_presets",n,!0),n},add_property:function(e,t,n){n||(n=!1),this.get("properties").add(new Upfront.Models.Property({name:e,value:t}),{silent:n}),Upfront.Events.trigger("model:property:add",e,t,n)},set_property:function(e,t,n){if(!e)return!1;n||(n=!1);var r=this.get_property_by_name(e);if(!r||!r.set)return this.add_property(e,t,n);r.set({value:t},{silent:n}),Upfront.Events.trigger("model:property:set",e,t,n)},remove_property:function(e,t){if(!e)return!1;t||(t=!1);var n=this.get_property_by_name(e);if(!n||!n.set)return;this.get("properties").remove(n,{silent:t}),Upfront.Events.trigger("model:property:remove",e,t)},init_property:function(e,t){this.has_property(e)||this.add_property(e,t)},init_properties:function(e){var t=this;_(e).each(function(e,n){t.init_property(n,e)})},get_content:function(){return this.get_property_value_by_name("content")},set_content:function(e,t){var n=this.get_property_by_name("content"),t=typeof t!="undefined"?t:{};return n?n.set("value",e,t):this.get("properties").add(new Upfront.Models.Property({name:"content",value:e}))},get_element_id:function(){return this.get_property_value_by_name("element_id")},get_wrapper_id:function(){return this.get_property_value_by_name("wrapper_id")},replace_class:function(e){var t=this.get_property_by_name("class"),n=t?t.get("value"):!1;if(t&&n){var r=e.split(" "),i=n;for(var o=0;o<r.length;o++){var u=r[o].replace(/-?\d+/,"-?\\d+"),a=new RegExp(u);i.match(a)?i=i.replace(a,r[o]):i+=" "+r[o]}return t.set("value",i)}return t||this.get("properties").add(new s({name:"class",value:e})),!1},add_class:function(e){var t=new RegExp(e),n=this.get_property_by_name("class"),r=n?n.get("value"):!1;return n&&!r.match(t)?n.set("value",r+" "+e):(n||this.get("properties").add(new s({name:"class",value:e})),!1)},remove_class:function(e){var t=new RegExp(e),n=this.get_property_by_name("class"),r=n?n.get("value"):!1;return n&&r.match(t)?n.set("value",r.replace(t,"")):!1},is_visible:function(){return this.get_property_value_by_name("visibility")},get_breakpoint_property_value:function(e,t,n){var r=Upfront.Settings.LayoutEditor.CurrentBreakpoint;n=typeof n=="undefined"?!1:n;if(!r||r.default)return this.get_property_value_by_name(e);var i=this.get_property_value_by_name("breakpoint");return _.isObject(i)&&_.isObject(i[r.id])&&e in i[r.id]?i[r.id][e]:t?this.get_property_value_by_name(e):n},set_breakpoint_property:function(e,t,n){var r=Upfront.Settings.LayoutEditor.CurrentBreakpoint;if(!r||r.default)this.set_property(e,t,n);else{var i=Upfront.Util.clone(this.get_property_value_by_name("breakpoint")||{});_.isObject(i[r.id])||(i[r.id]={}),i[r.id][e]=t,i.current_property=e,this.set_property("breakpoint",i,n)}},add_to:function(e,t,n){var r=this,i=[],s=!1,n=_.isObject(n)?n:{};e.each(function(e,n){n==t&&(i.push(r),s=!0),i.push(e)}),s?(e.reset(i,{silent:!0}),e.trigger("add",this,e,_.extend(n,{index:t}))):e.add(this,_.extend(n,{index:t}))}}),a=u.extend({defaults:function(){return{name:"",objects:new f,wrappers:new g,properties:new o}},initialize:function(){var e=arguments;e&&e[0]&&e[0].objects?(e[0].objects=e[0].objects instanceof f?e[0].objects:new f(e[0].objects),this.set("objects",e[0].objects)):this.set("objects",new f([])),e&&e[0]&&e[0].wrappers?(e[0].wrappers=e[0].wrappers instanceof g?e[0].wrappers:new g(e[0].wrappers),this.set("wrappers",e[0].wrappers)):this.set("wrappers",new g([])),e&&e[0]&&e[0].properties?(e[0].properties=e[0].properties instanceof o?e[0].properties:new o(e[0].properties),this.set("properties",e[0].properties)):this.set("properties",new o([])),this.init&&this.init()}}),f=t.Collection.extend({model:function(e,t){var n=e.properties?_(e.properties).where({name:"type"}):e.get("properties").where({name:"type"}),r=n.length?n[0].value:"";return Upfront.Models[r]?new Upfront.Models[r](e,t):new u(e,t)},get_by_element_id:function(e){var t=!1;return this.each(function(n){n.get_element_id()==e&&(t=n)}),t}}),c=u.extend({defaults:{name:"",objects:new f,properties:new o},initialize:function(){var e=arguments;e&&e[0]&&e[0].objects?(e[0].objects=e[0].objects instanceof f?e[0].objects:new f(e[0].objects),this.set("objects",e[0].objects)):this.set("objects",new f([])),e&&e[0]&&e[0].properties?(e[0].properties=e[0].properties instanceof o?e[0].properties:new o(e[0].properties),this.set("properties",e[0].properties)):this.set("properties",new o([])),this.init&&this.init()}}),h=u.extend({defaults:function(){return{name:"",modules:new p,wrappers:new g,properties:new o}},initialize:function(){var e=arguments;e&&e[0]&&e[0].modules?(e[0].modules=e[0].modules instanceof p?e[0].modules:new p(e[0].modules),this.set("modules",e[0].modules)):this.set("modules",new p([])),e&&e[0]&&e[0].wrappers?(e[0].wrappers=e[0].wrappers instanceof g?e[0].wrappers:new g(e[0].wrappers),this.set("wrappers",e[0].wrappers)):this.set("wrappers",new g([])),e&&e[0]&&e[0].properties?(e[0].properties=e[0].properties instanceof o?e[0].properties:new o(e[0].properties),this.set("properties",e[0].properties)):this.set("properties",new o([])),this.init_property("has_settings",1),this.init_property("type","ModuleGroup"),this.init&&this.init()}}),p=t.Collection.extend({model:function(e,t){return e.modules?new h(e,t):new c(e,t)},get_by_element_id:function(e){var t=!1;return this.each(function(n){n.get_element_id()==e&&(t=n)}),t}}),d=u.extend({defaults:function(){return{name:"",properties:new o,wrappers:new g,modules:new p}},initialize:function(){var e=arguments;e&&e[0]&&e[0].modules?(e[0].modules=e[0].modules instanceof p?e[0].modules:new p(e[0].modules),this.set("modules",e[0].modules)):this.set("modules",new p([])),e&&e[0]&&e[0].wrappers?(e[0].wrappers=e[0].wrappers instanceof g?e[0].wrappers:new g(e[0].wrappers),this.set("wrappers",e[0].wrappers)):this.set("wrappers",new g([])),e&&e[0]&&e[0].properties?(e[0].properties=e[0].properties instanceof o?e[0].properties:new o(e[0].properties),this.set("properties",e[0].properties)):this.set("properties",new o([]))},is_main:function(){var e=this.get("container"),t=this.get("name");return!e||e==t},get_sub_regions:function(){if(!this.collection)return!1;var e=this.collection,t=e.indexOf(this),n=e.size()-1,r=this.get("container")||this.get("name"),i=e.filter(function(e){return e.get("container")==r||e.get("name")==r}),s=[],o={fixed:[],lightbox:[],top:!1,left:!1,right:!1,bottom:!1};i.length>1&&_.each(i,function(e,t){var n=e.get("sub");n=="fixed"?o.fixed.push(e):n=="lightbox"?o.lightbox.push(e):n&&n.match(/^(top|left|bottom|right)$/)?o[n]=e:s.push(e)});if(s.length>1){var t=_.indexOf(s,this);t==0?o.right=s[1]:t==1&&(o.left=s[0],o.right=s.length>2?s[2]:!1)}return o},get_sub_region:function(e){return this.get_sub_regions()[e]},has_sub_region:function(){return _.find(this.get_sub_regions(),function(e){return e!==!1})},get_side_region:function(e){return this.get_sub_region(e?"right":"left")},has_side_region:function(){var e=this.get_sub_regions();return e.left||e.right}}),v=t.Collection.extend({model:d,get_by_name:function(e){var t=!1,e=e.toLowerCase();return this.each(function(n){n.get("name").toLowerCase()==e&&(t=n)}),t},at_container:function(e){var t=0;return this.find(function(n){if(n.is_main()){if(t==e)return!0;t++}return!1})},index_container:function(e,t){var t=_.isArray(t)?t:[t],n=this.filter(function(e){return e.is_main()&&!_.contains(t,e.get("name"))}),r=n.indexOf(e);return r},total_container:function(e){var e=_.isArray(e)?e:[e],t=this.filter(function(t){return t.is_main()&&!_.contains(e,t.get("name"))});return t.length},get_new_title:function(e,t){var n=(e+t).replace(/[^A-Za-z0-9\s_-]/g,""),r=n.toLowerCase().replace(/\s/g,"-");return this.get_by_name(r)?this.get_new_title(e,t+1):{title:n,name:r}}}),m=u.extend({defaults:{name:"",properties:new o},initialize:function(){var e=arguments;e&&e[0]&&e[0].properties?(e[0].properties=e[0].properties instanceof o?e[0].properties:new o(e[0].properties),this.set("properties",e[0].properties)):this.set("properties",new o([]))}}),g=t.Collection.extend({model:m,get_by_wrapper_id:function(e){var t=!1;return this.each(function(n){n.get_wrapper_id()==e&&(t=n)}),t}}),y=u.extend({defaults:{name:"",properties:new o,regions:new v,wrappers:new g},initialize:function(){var e,t=arguments;t&&t[0]&&t[0].regions&&(t[0].regions=t[0].regions instanceof v?t[0].regions:new v(t[0].regions),this.set("regions",t[0].regions)),t&&t[0]&&t[0].properties&&(t[0].properties=t[0].properties instanceof o?t[0].properties:new o(t[0].properties),this.set("properties",t[0].properties)),t&&t[0]&&t[0].wrappers&&(t[0].wrappers=t[0].wrappers instanceof g?t[0].wrappers:new g(t[0].wrappers),this.set("wrappers",t[0].wrappers))},get_current_state:function(){return Upfront.PreviewUpdate.get_revision()},has_undo_states:function(){return!!Upfront.Util.Transient.length("undo")},has_redo_states:function(){return!!Upfront.Util.Transient.length("redo")},store_undo_state:function(){var e=this.get_current_state(),t=Upfront.Util.Transient.get_all();if(t.indexOf(e)>=0)return!1;Upfront.Util.Transient.push("undo",e),Upfront.Events.trigger("upfront:undo:state_stored")},restore_undo_state:function(){return this.has_undo_states()?this.restore_state_from_stack("undo"):!1},restore_redo_state:function(){return this.has_redo_states()?this.restore_state_from_stack("redo"):!1},restore_state_from_stack:function(t){var n="undo"==t?"redo":"undo",r=Upfront.Util.Transient.pop(t);if(!r)return Upfront.Util.log("Invalid "+r+" state"),!1;Upfront.Util.Transient.push(n,this.get_current_state());var i=this,s=new e.Deferred;return Upfront.Util.post({action:"upfront_get_revision",revision:r}).done(function(e){"revision"in e.data&&(i.get("regions").reset(Upfront.Util.model_to_json(e.data.revision.regions)),s.resolve())}),s.promise()}}),b=t.Model.extend({initialize:function(){var e=arguments,n=e[0]||{};this.taxonomy=n.taxonomy?new t.Model(n.taxonomy):t.Model({}),this.all_terms=n.all_terms?new t.Collection(n.all_terms):new t.Collection([]),this.post_terms=n.post_terms?new t.Collection(n.post_terms):new t.Collection([])}}),w=t.Model.extend({action:"upfront-wp-model",fetchAttributes:[],saveAttributes:[],fetch:function(e){var t=this;return postdata={action:"fetch_"+this.modelName,id:this.id},_.each(this.fetchAttributes,function(e){postdata[e]=t[e]}),postdata=_.extend(postdata,e),this.post(postdata).done(function(e){t.set(e.data)})},save:function(){var e=this,t=this.toJSON();return _.each(this.saveAttributes,function(n){t[n]=e[n]}),t.action="save_"+this.modelName,this.post(t).done(function(t){e.changed={}})},post:function(e){return e=_.isObject(e)?_.clone(e):{},e.model_action=e.action,e.action=this.action,Upfront.Util.post(e)},get:function(e){var t=this.attributes[e],n=["post_date","post_date_gmt","post_modified","post_modified_gmt"];if(_.indexOf(n,e)!==-1){var r=(new Date).getTimezoneOffset(),i=r/60,s=i>0?"-":"+",o=parseInt(Math.abs(i),10),u=parseInt((Math.abs(i)-o)*60,10),a=t.replace(/ /,"T");o=o>=10?""+o:"0"+o,u=u>=10?""+u:"0"+u,a&&o.length&&u.length&&(a+=s+o+u);var f=a.split(/[^0-9]/);return new Date(f[0],f[1]-1,f[2],f[3],f[4],f[5])}return this.attributes[e]},set:function(e,n,r){var i=n,s={};if(_.isObject(e)){for(var o in e){var u=e[o];n instanceof Date?s[o]=Upfront.Util.format_date(u,!0,!0).replace(/\//g,"-"):s[o]=u}t.Model.prototype.set.call(this,s,r)}else n instanceof Date&&(i=Upfront.Util.format_date(n,!0,!0).replace(/\//g,"-")),t.Model.prototype.set.call(this,e,i,r);return this}}),E=t.Collection.extend({action:"upfront-wp-model",fetchAttributes:[],saveAttributes:[],changedModels:[],addedModels:[],removedModels:[],isNew:!0,parentAttribute:!1,childrenAttribute:!1,orphans:{},orderby:!1,order:"desc",pagination:{pages:1,pageSize:10,currentPage:1,totalElements:0,loaded:{}},lastFetchOptions:{},fetch:function(e){var t=this,n={action:"fetch_"+this.collectionName,id:this.id};return this.orderby&&(n.orderby=this.orderby,n.order=this.order),_.each(this.fetchAttributes,function(e){n[e]=t[e]}),n=this.checkPostFlush(_.extend(n,e)),this.changedModels=[],this.addedModels=[],this.removedModels=[],this.off("change",this.updateChanged,this),this.on("change",this.updateChanged,this),this.off("add",this.updateAdded,this),this.on("add",this.updateAdded,this),this.off("remove",this.updateRemoved,this),this.on("remove",this.updateRemoved,this),this.isNew=!1,this.post(n).done(function(e){if(e.data.pagination){var r=e.data.pagination,i=[];n.flush||t.pagination.totalElements!=r.total?(t.pagination={totalElements:r.total,pageSize:r.page_size,pages:Math.ceil(r.total/r.page_size),currentPage:r.page,loaded:n.flush?{}:t.pagination.loaded},t.pagination.loaded[r.page]=!0,_.each(e.data.results,function(e){var n=new t.model(e);n.belongsToPage=r.page,i.push(n)}),t.reset(i)):(t.pagination.currentPage=r.page,t.pagination.loaded[r.page]=!0,_.each(e.data.results,function(e){var n=new t.model(e);n.belongsToPage=r.page,t.add(n,{silent:!0,merge:!0})}),t.trigger("reset",t))}else t.reset(e.data.results)})},post:function(e){return e=_.isObject(e)?_.clone(e):{},e.model_action=e.action,e.action=this.action,Upfront.Util.post(e)},save:function(){var e=this,t={all:this.toJSON(),added:[],changed:[],removed:[],action:"save_"+this.collectionName};return this.isNew?t.added=t.all:this.each(function(n){e.addedModels.indexOf(n.id)!=-1&&t.added.push(n.toJSON()),e.changedModels.indexOf(n.id)!=-1&&t.changed.push(n.toJSON()),e.removedModels.indexOf(n.id)!=-1&&t.removed.push(n.toJSON())}),this.isNew=!1,_.each(this.saveAttributes,function(n){t[n]=e[n]}),this.post(t).done(function(t){e.reset(t.data),e.addedModels=[],e.changedModels=[],e.removedModels=[]})},updateChanged:function(e){var t=e.id,n=_.indexOf(this.addedModels,t);n!=-1?this.addedModels[n]=t:_.contains(this.changedModels,t)||this.changedModels.push(t)},updateAdded:function(e){var t=e.id,n=_.indexOf(this.removedModels,t);n!=-1?(this.removedModels.splice(n,1),this.changedModels.push(t)):_.contains(this.addedModels,t)||this.addedModels.push(t)},updateRemoved:function(e){var t=e.id,n=_.indexOf(this.addedModels,t),r=_.indexOf(this.changedModels,t);n!=-1?this.addedModels.splice(n,1):_.contains(this.removedModels,t)||this.removedModels.push(t),r!=-1&&this.changedModels.splice(r,1)},add:function(e,n){if(!this.parentAttribute||!this.childrenAttribute)return t.Collection.prototype.add.call(this,e,n);var r=this;if(!_.isArray(e)){var i=0,s=e;if(this.model&&s instanceof this.model)i=s.get(this.parentAttribute);else{if(!_.isObject(s))return t.Collection.prototype.add.call(this,s,n);i=s[this.parentAttribute],this.model&&(s=new this.model(e))}this.orphans[s.id]?(s[this.childrenAttribute]?s[this.childrenAttribute].add(this.orphans[s.id],n):s[this.childrenAttribute]=new this.constructor(this.orphans[s.id],n),delete this.orphans[s.id]):s[this.childrenAttribute]||(s[this.childrenAttribute]=new this.constructor([],n));if(i){var o=this.get(i);if(o)o[this.childrenAttribute].add(s,n);else{var u=this.orphans[i];u?u.push(s):this.orphans[i]=[s]}}return t.Collection.prototype.add.call(this,s,n)}_.each(e,function(e){r.add(e,n)})},remove:function(e,n){if(!this.parentAttribute||!this.childrenAttribute)return t.Collection.prototype.remove.call(this,e,n);var r=this;e=_.isArray(e)?e.slice():[e];for(i=0,l=e.length;i<l;i++){var s=this.get(e[i]);s&&s[this.childrenAttribute].each(function(e){r.remove(e,n)})}return t.Collection.prototype.remove.call(this,e,n)},getPage:function(e){var t=this;return this.filter(function(t){return t.belongsToPage==e})},fetchPage:function(e,t){t||(t={});if(!t.flush&&this.pagination.loaded[e]){this.pagination.currentPage=e;var n=this.getPage(e),r=[];return _.each(n,function(e){r.push(e.toJSON())}),this.pagination.currentPage=e,jQuery.Deferred().resolve({results:r})}return this.fetch(_.extend({page:e,limit:this.pagination.pageSize},t))},reSort:function(e,t){var n=t=="asc"?"asc":"desc";return this.orderby=e,this.order=n,this.fetch({page:0,sort:e,direction:n})},checkPostFlush:function(e){var t=this,n=!1,r=_.clone(e);return e.flush?(delete r.flush,this.lastFetchOptions=r,e):(_.each(e,function(e,r){["limit","page"].indexOf(r)==-1&&(n=n||t.lastFetchOptions[r]!=e)}),n?(t.lastFetchOptions=_.clone(e),r.flush=!0):r=_.extend(this.lastFetchOptions,r),r)}}),S=w.extend({modelName:"post",defaults:{ID:0,post_author:0,post_date:new Date,post_date_gmt:new Date,post_content:"",post_title:"",post_excerpt:"",post_status:"",comment_status:"",ping_status:"",post_password:"",post_name:"",to_ping:[],pinged:[],post_modified:new Date,post_modified_gmt:new Date,post_content_filtered:"",post_parent:0,guid:"",menu_order:0,post_type:"post",post_mime_type:"",comment_count:0,permalink:""},saveAttributes:["sticky"],author:!1,comments:!1,parent:!1,terms:!1,meta:!1,initialize:function(e,t){var n=this;e&&(e.id&&this.set(this.idAttribute,e.id),e.author&&(this.author=new Upfront.Models.User(e.author)),e.meta&&(this.meta=new Upfront.Collections.MetaList(e.meta,{objectId:this.id,metaType:"post"})))},getVisibility:function(){return this.get("post_status")=="private"?"private":this.get("post_password")?"password":this.sticky?"sticky":"public"},setVisibility:function(e){this.sticky=0,e=="password"?this.set("post_status","publish"):(this.set("post_password",""),e=="private"?this.set("post_status","private"):e=="sticky"?this.sticky=1:e=="public"&&this.set("post_status","publish"))},fetch:function(e){var t=this;return w.prototype.fetch.call(this,e).done(function(e){e.data.author&&(t.author=new Upfront.Models.User(e.data.author)),e.data.meta&&(t.meta=new Upfront.Collections.MetaList(e.data.meta,{objectId:t.id,metaType:"post"})),t.sticky=e.data.sticky})},idAttribute:"ID",fetch_comments:function(e){var t=this;return e=_.isObject(e)?e:{},this.comments=new Upfront.Collections.CommentList([],{postId:this.id}),this.comments.fetch()},fetch_parent:function(){if(!this.get("post_parent"))return!1;var e=this,t={action:"fetch_post",id:this.get("post_parent")};return this.post(t).done(function(t){e.parent=new S(t.data)})},fetch_author:function(){console.log("Fetch author not yet implemented.")},fetch_terms:function(e){return e?this.post({taxonomy:e,post_id:this.get("ID"),action:"get_terms"}):!1},fetch_meta:function(){return this.meta=new Upfront.Collection.MetaList([],{objectId:this.id,metaType:"post"}),this.meta.fetch()}}),x=E.extend({collectionName:"post_list",model:S,parentAttribute:"post_parent",childrenAttribute:"children",postId:!1,postType:"post",withMeta:!1,withAuthor:!1,fetchAttributes:["postId","postType","withMeta","withAuthor"],initialize:function(e,t){t&&(t.postId&&(this.postId=t.postId),t.postType&&(this.postType=t.postType),t.withMeta&&(this.withMeta=t.withMeta),t.withAuthor&&(this.withAuthor=t.withAuthor))}}),T=w.extend({modelName:"comment",defaults:{comment_ID:0,comment_post_id:0,comment_author:"",comment_author_email:"",comment_author_url:"",comment_author_IP:"0.0.0.0",comment_date:new Date,comment_date_gmt:new Date,comment_content:"",comment_karma:"",comment_agent:"",comment_type:"",comment_approved:"0",comment_parent:0,user_id:0},idAttribute:"comment_ID",initialize:function(e){e&&e.id&&this.set(this.idAttribute,e.id)},trash:function(e){return e?this.set("comment_approved","trash"):!e&&this.get("comment_approved")=="trash"&&this.set("comment_approved","0"),this},spam:function(e){return e?this.set("comment_approved","spam"):!e&&this.get("comment_approved")=="spam"&&this.set("comment_approved","0"),this},approve:function(e){return e?this.set("comment_approved","1"):!e&&this.get("comment_approved")=="1"&&this.set("comment_approved","0"),this},isTrash:function(){return this.get("comment_approved")=="trash"},isApproved:function(){return this.get("comment_approved")=="1"},isSpam:function(){return this.get("comment_approved")=="spam"}}),N=E.extend({model:T,collectionName:"comment_list",postId:!1,fetchAttributes:["postId","commentType"],parentAttribute:"comment_parent",childrenAttribute:"replies",commentType:"comment",initialize:function(e,t){t.postId&&(this.postId=t.postId)},save:function(){console.error("CommentList save: Use single comment save instead.")}}),C=t.Model.extend({defaults:{meta_key:"",meta_value:""},idAttribute:"meta_key"}),k=E.extend({model:C,collectionName:"meta_list",metaType:"post",objectId:0,fetchAttributes:["objectId","metaType"],saveAttributes:["objectId","metaType"],initialize:function(e,t){var n=[];t.objectId&&(this.objectId=t.objectId),t.metaType&&(this.metaType=t.metaType)},getValue:function(e){var t=this.get(e);return t?t.get("meta_value"):undefined},setValue:function(e,t){var n=this.get(e);return n?(n.set("meta_value",t),this.changedModels.push(n.id)):(n=new C({meta_key:e,meta_value:t}),this.add(n)),n}}),L=w.extend({modelName:"term",defaults:{term_id:0,name:"",slug:"",term_group:"",term_taxonomy_id:0,taxonomy:"",description:"",parent:"",count:0},idAttribute:"term_id",taxonomy:!1,fetchAttributes:["taxonomy"],saveAttributes:["taxonomy"],initialize:function(e,t){e&&e.taxonomy&&(this.taxonomy=e.taxonomy)},save:function(e){var t=this;return w.prototype.save.call(this,e).done(function(e){t.set("term_id",e.data.term_id)})}}),A=E.extend({collectionName:"term_list",model:L,taxonomy:!1,taxonomyObject:!1,postId:!1,fetchAttributes:["taxonomy","postId"],saveAttributes:["taxonomy","postId"],parentAttribute:"parent",childrenAttribute:"children",initialize:function(e,t){t&&(t.taxonomy&&(this.taxonomy=t.taxonomy),t.postId&&(this.postId=t.postId))},fetch:function(e){var t=this;return E.prototype.fetch.call(this,e).done(function(e){t.taxonomyObject=e.data.taxonomy})}}),O=w.extend({modelName:"user",defaults:{ID:0,caps:[],cap_key:"",roles:[],allcaps:[],data:{}},idAttribute:"ID"}),M=t.Model.extend({initialize:function(){var e=arguments,n=e[0]||{};this.posts=n.posts?new t.Collection(n.posts):new t.Collection([]),this.pagination=n.pagination?new t.Model(n.pagination):new t.Model([])}}),D=M.extend({}),P=t.Model.extend({initialize:function(){var e=arguments,n=e[0]||{};this.comments=n.comments?new t.Collection(n.comments):new t.Collection([]),this.pagination=n.pagination?new t.Model(n.pagination):new t.Model([])}}),H=t.Model.extend({defaults:function(){return{vid:"",label:"Variant Label",group:{margin_left:0,margin_right:0,col:24,row:50,left:0,"float":"none"},image:{order:0,col:24,top:0,left:0,row:40,clear:!0},caption:{show:1,order:1,col:24,top:0,left:0,row:10,clear:!0}}}}),B=t.Collection.extend({model:H}),j="omega";return{Models:{Property:s,ObjectModel:u,ObjectGroup:a,Module:c,ModuleGroup:h,Region:d,Wrapper:m,Layout:y,Taxonomy:b,Post:S,Posts:M,Pages:D,Comment:T,Comments:P,Meta:C,Term:L,User:O,ImageVariant:H},Collections:{Properties:o,Objects:f,Modules:p,Regions:v,Wrappers:g,CommentList:N,MetaList:k,PostList:x,TermList:A,ImageVariants:B}}})}(jQuery),define("text",["module"],function(e){"use strict";var t,n,r=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],i=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,s=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,o=typeof location!="undefined"&&location.href,u=o&&location.protocol&&location.protocol.replace(/\:/,""),a=o&&location.hostname,f=o&&(location.port||undefined),l=[],c=e.config&&e.config()||{};t={version:"2.0.3",strip:function(e){if(e){e=e.replace(i,"");var t=e.match(s);t&&(e=t[1])}else e="";return e},jsEscape:function(e){return e.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r").replace(/[\u2028]/g,"\\u2028").replace(/[\u2029]/g,"\\u2029")},createXhr:c.createXhr||function(){var e,t,n;if(typeof XMLHttpRequest!="undefined")return new XMLHttpRequest;if(typeof ActiveXObject!="undefined")for(t=0;t<3;t+=1){n=r[t];try{e=new ActiveXObject(n)}catch(i){}if(e){r=[n];break}}return e},parseName:function(e){var t=!1,n=e.indexOf("."),r=e.substring(0,n),i=e.substring(n+1,e.length);return n=i.indexOf("!"),n!==-1&&(t=i.substring(n+1,i.length),t=t==="strip",i=i.substring(0,n)),{moduleName:r,ext:i,strip:t}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(e,n,r,i){var s,o,u,a=t.xdRegExp.exec(e);return a?(s=a[2],o=a[3],o=o.split(":"),u=o[1],o=o[0],(!s||s===n)&&(!o||o.toLowerCase()===r.toLowerCase())&&(!u&&!o||u===i)):!0},finishLoad:function(e,n,r,i){r=n?t.strip(r):r,c.isBuild&&(l[e]=r),i(r)},load:function(e,n,r,i){if(i.isBuild&&!i.inlineText){r();return}c.isBuild=i.isBuild;var s=t.parseName(e),l=s.moduleName+"."+s.ext,h=n.toUrl(l),p=c.useXhr||t.useXhr;!o||p(h,u,a,f)?t.get(h,function(n){t.finishLoad(e,s.strip,n,r)},function(e){r.error&&r.error(e)}):n([l],function(e){t.finishLoad(s.moduleName+"."+s.ext,s.strip,e,r)})},write:function(e,n,r,i){if(l.hasOwnProperty(n)){var s=t.jsEscape(l[n]);r.asModule(e+"!"+n,"define(function () { return '"+s+"';});\n")}},writeFile:function(e,n,r,i,s){var o=t.parseName(n),u=o.moduleName+"."+o.ext,a=r.toUrl(o.moduleName+"."+o.ext)+".js";t.load(u,r,function(n){var r=function(e){return i(a,e)};r.asModule=function(e,t){return i.asModule(e,a,t)},t.write(e,u,r,s)},s)}};if(c.env==="node"||!c.env&&typeof process!="undefined"&&process.versions&&!!process.versions.node)n=require.nodeRequire("fs"),t.get=function(e,t){var r=n.readFileSync(e,"utf8");r.indexOf("﻿")===0&&(r=r.substring(1)),t(r)};else if(c.env==="xhr"||!c.env&&t.createXhr())t.get=function(e,n,r){var i=t.createXhr();i.open("GET",e,!0),c.onXhr&&c.onXhr(i,e),i.onreadystatechange=function(t){var s,o;i.readyState===4&&(s=i.status,s>399&&s<600?(o=new Error(e+" HTTP status: "+s),o.xhr=i,r(o)):n(i.responseText))},i.send(null)};else if(c.env==="rhino"||!c.env&&typeof Packages!="undefined"&&typeof java!="undefined")t.get=function(e,t){var n,r,i="utf-8",s=new java.io.File(e),o=java.lang.System.getProperty("line.separator"),u=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(s),i)),a="";try{n=new java.lang.StringBuffer,r=u.readLine(),r&&r.length()&&r.charAt(0)===65279&&(r=r.substring(1)),n.append(r);while((r=u.readLine())!==null)n.append(o),n.append(r);a=String(n.toString())}finally{u.close()}t(a)};return t}),define("text!upfront/templates/object.html",[],function(){return'<div class="upfront-editable_entity upfront-object {{properties.class}} {{properties.preset}}" id="{{properties.element_id}}" style="{[ if (height > 0){ ]}min-height: {{height}}px;{[ } ]} {[ if (hide == 1) { ]}display: none;{[ } ]}">\r\n	<b class="upfront-entity_meta upfront-ui">\r\n		<!-- {[ if (parseInt(properties.has_settings, 10)) { ]} <a href="#" class="upfront-icon-button upfront-icon-button-setting upfront-entity-settings_trigger"></a> {[ } ]} -->\r\n        {{extra_buttons}}\r\n		<!--<a href="#" class="upfront-icon-button upfront-icon-button-delete upfront-entity-delete_trigger"></a>-->\r\n	</b>\r\n	{[ if (buttons){ ]}\r\n	<b class="upfront-entity_meta upfront-ui upfront-entity_meta_extra">{{buttons}}</b>\r\n	{[ } ]}\r\n	<div class="upfront-object-content upfront-output-{{properties.id_slug}}">\r\n		{{content}}\r\n	</div>\r\n</div>\r\n'}),define("text!upfront/templates/object_group.html",[],function(){return'<div class="upfront-editable_entity upfront-object-group {{properties.class}} {{properties.preset}}" id="{{properties.element_id}}" {[ if (height > 0){ ]}style="min-height: {{height}}px;"{[ } ]}>\r\n	<b class="upfront-entity_meta upfront-ui">\r\n		<!-- {[ if (parseInt(properties.has_settings, 10)) { ]} <a href="#" class="upfront-icon-button upfront-icon-button-setting upfront-entity-settings_trigger"></a> {[ } ]} -->\r\n        {{extra_buttons}}\r\n		<!--<a href="#" class="upfront-icon-button upfront-icon-button-delete upfront-entity-delete_trigger"></a>-->\r\n	</b>\r\n	{[ if (buttons){ ]}\r\n	<b class="upfront-entity_meta upfront-ui upfront-entity_meta_extra">{{buttons}}</b>\r\n	{[ } ]}\r\n	<div class="upfront-object-group-default"></div>\r\n	<div class="upfront-objects_container upfront-output-{{properties.id_slug}}"></div>\r\n</div>\r\n<div class="upfront-object-group-finish-edit upfront-ui"><i class="upfront-field-icon upfront-field-icon-tick"></i> {{Upfront.Settings.l10n.global.views.done}}</div>'}),define("text!upfront/templates/module.html",[],function(){return'<div class="upfront-editable_entity upfront-module {{parent_group_class}} {{properties.class}}" id="{{properties.element_id}}" style="{[ if (height > 0){ ]}min-height: {{height}}px;{[ } ]} {[ if (hide == 1) { ]}display: none;{[ } ]}" data-row="{{properties.row}}">\r\n	<b class="upfront-entity_meta upfront-ui">\r\n		{{name}} \r\n		{[ if (parseInt(properties.has_settings, 10)) { ]} <a href="#" class="upfront-icon-button upfront-icon-button-setting upfront-entity-settings_trigger"></a> {[ } ]}\r\n		{[ if (!properties.sticky) { ]} <a href="#" class="upfront-icon-button upfront-icon-button-delete upfront-entity-delete_trigger"></a> {[ } ]}\r\n		<a href="#" class="upfront-icon-button upfront-icon-button-hide upfront-entity-hide_trigger" style="display:none;"></a> \r\n	</b>\r\n	<div class="upfront-objects_container"></div>\r\n</div>\r\n<div class="upfront-module-hidden-toggle upfront-ui" style="display:none;"><a class="upfront-entity-hide_trigger">{{Upfront.Settings.l10n.global.views.show_element}}</a></div>\r\n'}),define("text!upfront/templates/module_group.html",[],function(){return'<b class="upfront-entity_meta upfront-ui">\r\n	<!--<a href="#" class="upfront-icon-button upfront-icon-button-setting upfront-entity-settings_trigger"></a>-->\r\n	<a href="#" class="upfront-icon-button upfront-icon-button-hide upfront-entity-hide_trigger" style="display:none;"></a>\r\n</b>\r\n<div class="upfront-selected-border"></div>\r\n<div class="upfront-module-group-toggle-container upfront-module-group-toggle-edit-container">\r\n	<div class="upfront-module-group-toggle upfront-module-group-ungroup">{{Upfront.Settings.l10n.global.views.ungroup}}</div><br />\r\n	<div class="upfront-module-group-toggle upfront-module-group-edit">{{Upfront.Settings.l10n.global.views.edit_elements}}</div>\r\n</div>\r\n<div class="upfront-module-group-toggle-container upfront-module-group-toggle-reorder-container">\r\n	<div class="upfront-module-group-toggle upfront-module-group-reorder">{{Upfront.Settings.l10n.global.views.reorder}}</div>\r\n</div>\r\n<div class="upfront-module-group-finish-edit upfront-ui"><i class="upfront-field-icon upfront-field-icon-tick"></i> {{Upfront.Settings.l10n.global.views.done}}</div>\r\n\r\n<div class="upfront-module-hidden-toggle upfront-ui" style="display:none;"><a class="upfront-entity-hide_trigger">{{Upfront.Settings.l10n.global.views.show_group}}</a></div>\r\n\r\n<div class="upfront-module-group-bg"></div>\r\n<div class="upfront-modules_container"></div>\r\n'}),define("text!upfront/templates/region_container.html",[],function(){return'<div class="upfront-region-container-bg">\r\n	<div class="upfront-grid-layout {{size_class}}{{max_col}}">\r\n		<div class="upfront-grid-layout-gutter">\r\n			<div class="upfront-grid-layout-gutter-left"></div>\r\n			<div class="upfront-grid-layout-gutter-right"></div>\r\n		</div>\r\n	</div>\r\n</div>'}),define("text!upfront/templates/region.html",[],function(){return'<b class="upfront-entity_meta upfront-ui">\r\n	<a href="#" class="upfront-icon-button upfront-icon-button-delete upfront-entity-delete_trigger"></a>\r\n	<a href="#" class="upfront-icon-button upfront-icon-button-hide upfront-entity-hide_trigger" style="display:none;"></a> \r\n	<a href="#" class="upfront-icon-button upfront-icon-button-setting upfront-entity-settings_trigger"></a>\r\n</b>\r\n<div class="upfront-region-title">{{title}}</div>\r\n<div class="upfront-region-wrapper"><div class="upfront-modules_container"></div></div>\r\n<div class="upfront-region-hidden-toggle upfront-ui" style="display:none;"><a class="upfront-entity-hide_trigger">{{Upfront.Settings.l10n.global.views.show_region}}</a></div>'}),define("text!upfront/templates/wrapper.html",[],function(){return'<b class="upfront-wrapper-meta upfront-wrapper-meta-left upfront-ui upfront-resize-handle-wrapper upfront-resize-handle-wrapper-w ui-resizable-handle ui-resizable-w">\r\n	<a href="#" class="upfront-icon-button upfront-icon-button-add-spacer upfront-add-spacer" data-position="left" title="Add spacer"></a>\r\n</b>\r\n<b class="upfront-wrapper-meta upfront-wrapper-meta-right upfront-ui upfront-resize-handle-wrapper upfront-resize-handle-wrapper-e ui-resizable-handle ui-resizable-e">\r\n	<a href="#" class="upfront-icon-button upfront-icon-button-add-spacer upfront-add-spacer" data-position="right" title="Add spacer"></a>\r\n</b>\r\n'}),define("text!upfront/templates/layout.html",[],function(){return'<section class="upfront-layout">\r\n\r\n</section>'}),function(e){var t=Upfront.Settings&&Upfront.Settings.l10n?Upfront.Settings.l10n.global.views:Upfront.mainData.l10n.global.views;define("views",["text!upfront/templates/object.html","text!upfront/templates/object_group.html","text!upfront/templates/module.html","text!upfront/templates/module_group.html","text!upfront/templates/region_container.html","text!upfront/templates/region.html","text!upfront/templates/wrapper.html","text!upfront/templates/layout.html"],function(){var n=["text!upfront/templates/object.html","text!upfront/templates/object_group.html","text!upfront/templates/module.html","text!upfront/templates/module_group.html","text!upfront/templates/region_container.html","text!upfront/templates/region.html","text!upfront/templates/wrapper.html","text!upfront/templates/layout.html"],r=arguments,i={};_(n).each(function(e,t){i[e.replace(/text!upfront\/templates\//,"").replace(/\.html/,"")]=r[t]});var s=_.clone(Backbone.Events),o={dispatcher:s},u={activate_condition:function(){return!1}},a={activate_condition:function(){var e=this.parent_module_view,t=e&&e.model?e.model:!1;return t?!!t.get("name").length:!0}},f={anchor:{is_target:!0,is_trigger:!1}},l=Backbone.View.extend(_.extend({},o,{initialize:function(e){this.options=e,this.listenTo(this.model,"change",this.render),this.init&&this.init(),this.listenTo(Upfront.Events,"upfront:paddings:top:updated",this.adjust_top_settings_panel_position)},_get_full_size_el:function(e,t,n){var r=e.width(),i=e.height();return this._get_full_size(r,i,t,n)},_get_full_size:function(e,t,n,r){if(!r){if(Math.round(t/e*100)/100>n){var i=t/n;return[i,t,(e-i)/2,0]}var s=e*n;return[e,s,0,(t-s)/2]}if(Math.round(t/e*100)/100<n){var i=t/n;return[i,t,(e-i)/2,0]}var s=e*n;return[e,s,0,(t-s)/2]},update_background:function(){var t=this,n=this instanceof D,r=typeof this.$bg!="undefined"?this.$bg:this.$el,i=this.model.get_breakpoint_property_value("background_type",!0),s=r.children(".upfront-region-bg-overlay");i!="featured"&&t.$el.children(".feature_image_selector").length>0&&t.$el.children(".feature_image_selector").remove(),s.data("uparallax")&&s.uparallax("destroy");if(!i||i=="color")this.update_background_color(),s.length&&s.hide();else{s.length?s.show():(s=e('<div class="upfront-region-bg-overlay" />'),r.append(s));var o=s.find(".upfront-region-bg-"+i);o.length?o.show():(o=e('<div class="upfront-region-bg upfront-region-bg-'+i+'" />'),s.append(o)),s.find(".upfront-region-bg").not(o).hide(),r.css({backgroundColor:"",backgroundImage:"none",backgroundSize:"",backgroundRepeat:"",backgroundPosition:""});switch(i){case"image":this.update_background_image(o,s);break;case"featured":this.update_background_featured(o,s);break;case"map":this.update_background_map(o,s);break;case"slider":this.update_background_slider(o,s);break;case"video":this.update_background_video(o,s)}}Upfront.Events.trigger("entity:background:update",this,this.model)},update_background_color:function(){var e=typeof this.$bg!="undefined"?this.$bg:this.$el,t=this.model.get_breakpoint_property_value("background_color",!0);t?e.css("background-color",t):e.css("background-color","")},_update_background_image_from_data:function(t,n,r){var i=this instanceof D,s=this.model.get_breakpoint_property_value("background_repeat",!0),o=this.model.get_breakpoint_property_value("background_position",!0),u=this.model.get_breakpoint_property_value("background_style",!0);if(t.image){n.css("background-image","url('"+t.image+"')"),u=="parallax"&&r.uparallax({element:n,overflowTop:0,overflowBottom:0});if(u=="full"||u=="parallax"){var a=this._get_full_size_el(i?e(window):n,t.ratio,!1);n.data("bg-position-y",a[3]),n.data("bg-position-x",a[2]),n.css({backgroundSize:a[0]+"px "+a[1]+"px",backgroundRepeat:"no-repeat",backgroundPosition:a[2]+"px "+a[3]+"px"})}else n.css({backgroundSize:"auto auto",backgroundRepeat:s,backgroundPosition:o});i&&n.css("background-attachment","fixed")}else n.css({backgroundImage:"none",backgroundSize:"",backgroundRepeat:"",backgroundPosition:"",backgroundAttachment:""})},update_background_image:function(e,t){var n=typeof this.$bg!="undefined"?this.$bg:this.$el,r=this.model.get_breakpoint_property_value("background_image",!0),i=parseFloat(this.model.get_breakpoint_property_value("background_image_ratio",!0));this.update_background_color(),this._update_background_image_from_data({image:r,ratio:i},e,t)},update_background_featured:function(t,n){var r=this,i=typeof this.$bg!="undefined"?this.$bg:this.$el,s=this.model.get_breakpoint_property_value("background_default",!0),o=function(){s=="image"?r.update_background_image(t,n):r._update_background_image_from_data({image:!1,ratio:0},t,n)};i.addClass("no-featured_image"),this.update_background_color();if(r.$el.children(".feature_image_selector").length<1&&!Upfront.Application.is_builder()){var u=e('<a href="#" class="feature_image_selector">Add Feature Image</a>');u.bind("click",function(){Upfront.Views.Editor.ImageSelector.open().done(function(t){var n={},i=0;_.each(t,function(e,t){n=e,i=t});var s={src:n.medium?n.medium[0]:n.full[0],srcFull:n.full[0],srcOriginal:n.full[0],fullSize:{width:n.full[1],height:n.full[2]},size:n.medium?{width:n.medium[1],height:n.medium[2]}:{width:n.full[1],height:n.full[2]},position:!1,rotation:0,id:i};e("<img>").attr("src",s.srcFull).load(function(){var t=Upfront.data.posts[_upfront_post_data.post_id];t.meta.setValue("_thumbnail_id",s.id),t.meta.setValue("_thumbnail_data",s),t.meta.save().done(function(){e("<img>").attr("src",s.srcOriginal).load(function(){r.update_background(),Upfront.Views.Editor.ImageSelector.close()})})})})}),r.$el.append(u)}Upfront.Util.post({action:"this_post-get_thumbnail",post_id:_upfront_post_data.post_id}).done(function(s){if(typeof s.data.featured_image!="undefined"){s.data.featured_image!=""?r.$el.children(".feature_image_selector").addClass("change_feature_image"):r.$el.children(".feature_image_selector").removeClass("change_feature_image"),image=s.data.featured_image;var u=e("<img>").attr("src",s.data.featured_image);u.load(function(){ratio=parseFloat(Math.round(this.height/this.width*100)/100),i.data("bg-featured-image-ratio",ratio),i.removeClass("no-featured_image"),r._update_background_image_from_data({image:image,ratio:ratio},t,n)})}else o()}).fail(o())},postpone_map_init:function(t,n){var r=this;e(document).one("upfront-google_maps-loaded",function(){r.update_background_map(t,n)})},update_background_map:function(e,t){try{if(!window.google.maps.Map)return this.postpone_map_init(e,t)}catch(n){return this.postpone_map_init(e,t)}var r=this,i=this.model.get_breakpoint_property_value("background_map_center",!0),s=this.model.get_breakpoint_property_value("background_map_zoom",!0),o=this.model.get_breakpoint_property_value("background_map_style",!0),u=this.model.get_breakpoint_property_value("background_map_controls",!0),a=this.model.get_breakpoint_property_value("background_show_markers",!0),f=this.model.get_breakpoint_property_value("background_use_custom_map_code",!0)?JSON.parse(this.model.get_breakpoint_property_value("map_styles",!0)):!1,l={center:new google.maps.LatLng(i[0],i[1]),zoom:parseInt(s),mapTypeId:google.maps.MapTypeId[o],panControl:u.indexOf("pan")>=0,zoomControl:u.indexOf("zoom")>=0,mapTypeControl:u.indexOf("map_type")>=0,scaleControl:u.indexOf("scale")>=0,streetViewControl:u.indexOf("street_view")>=0,overviewMapControl:u.indexOf("overview_map")>=0,scrollwheel:!1,styles:f};this.bg_map?(e.show(),this.bg_map.setOptions(l),f&&this.bg_map.setOptions({styles:f}),setTimeout(function(){r.bg_map.setCenter(l.center)},500)):(this.bg_map=new google.maps.Map(e.get(0),l),f&&this.bg_map.setOptions({styles:f}));if(!!a)var c=new google.maps.Marker({position:l.center,draggable:!1,map:this.bg_map})},update_background_slider:function(t,n){var r=this,i=this.model.get_breakpoint_property_value("background_slider_images",!0),s=this.model.get_breakpoint_property_value("background_slider_rotate",!0),o=this.model.get_breakpoint_property_value("background_slider_rotate_time",!0),u=this.model.get_breakpoint_property_value("background_slider_control",!0),a=this.model.get_breakpoint_property_value("background_slider_transition",!0);if(i){s?(t.attr("data-slider-auto",1),t.attr("data-slider-interval",o*1e3)):t.attr("data-slider-auto",0),t.attr("data-slider-show-control",u),t.attr("data-slider-effect",a);if(!_.isUndefined(Upfront.themeExporter)){Upfront.Views.Editor.ImageEditor.getImageData(i).done(function(n){var s=n.data.images;_.each(i,function(n){var r=_.isNumber(n)||n.match(/^\d+$/)?s[n]:_.find(s,function(e){return e.full[0].split(/[\\/]/).pop()==n.split(/[\\/]/).pop()}),i=e('<div class="upfront-default-slider-item" />');r&&r.full&&i.append('<img src="'+r.full[0]+'" />'),t.append(i)}),r.slide_images=i,t.trigger("refresh")});return}this.slide_images!=i&&i.length>0?Upfront.Views.Editor.ImageEditor.getImageData(i).done(function(n){var s=n.data.images;_.each(i,function(n){var r=s[n],i=e('<div class="upfront-default-slider-item" />');r&&r.full&&i.append('<img src="'+r.full[0]+'" />'),t.append(i)}),r.slide_images=i,t.trigger("refresh")}):t.trigger("refresh"),i.length==0&&(t.find(".upfront-default-slider-wrap").html(""),t.trigger("refresh"))}},update_background_video:function(t,n){var r=this,i=this instanceof D,s=typeof this.$bg!="undefined"?this.$bg:this.$el,o=this.model.get_breakpoint_property_value("background_color",!0),u=this.model.get_breakpoint_property_value("background_video",!0),a=this.model.get_breakpoint_property_value("background_video_embed",!0),f=this.model.get_breakpoint_property_value("background_video_width",!0),l=this.model.get_breakpoint_property_value("background_video_height",!0),c=this.model.get_breakpoint_property_value("background_video_style",!0)||"crop",h,p;c=="inside"&&o?s.css("background-color",o):s.css("background-color",""),i&&n.css("position","fixed");if(u&&a&&(this._prev_video&&this._prev_video!=u||!this._prev_video)){h=l/f,p=e(a),p.css("position","absolute").appendTo(t);if(c=="crop"||c=="inside"){var d=this._get_full_size_el(i?e(window):t,h,c=="inside");p.css({width:d[0],height:d[1],left:d[2],top:d[3]})}else c=="full"&&p.css({width:i?e(window).width():t.width(),height:i?e(window).height():t.height(),left:0,top:0});this._prev_video=u}else!u||!a?this.remove_background():this.refresh_background()},refresh_background:function(){var e=typeof this.$bg!="undefined"?this.$bg:this.$el,t=this.model.get_breakpoint_property_value("background_type",!0),n=e.children(".upfront-region-bg-overlay"),r=n.find(".upfront-region-bg-"+t);switch(t){case"image":this.refresh_background_image(r,n);break;case"featured":this.refresh_background_featured(r,n);break;case"map":this.refresh_background_map(r,n);break;case"slider":this.refresh_background_slider(r,n);break;case"video":this.refresh_background_video(r,n)}},_refresh_background_image_from_data:function(e,t,n){var r=this.model.get_breakpoint_property_value("background_style",!0);r=="parallax"&&n.data("uparallax")&&(n.uparallax("refresh"),setTimeout(function(){n.data("uparallax")&&n.uparallax("refresh")},2e3));if(r=="full"||r=="parallax"){var i=this._get_full_size_el(t,e.ratio,!1);t.data("bg-position-y",i[3]),t.data("bg-position-x",i[2]),t.css({backgroundSize:i[0]+"px "+i[1]+"px",backgroundRepeat:"no-repeat",backgroundPosition:i[2]+"px "+i[3]+"px"})}},refresh_background_image:function(e,t){var n=this.model.get_breakpoint_property_value("background_image_ratio",!0);this._refresh_background_image_from_data({ratio:n},e,t)},refresh_background_featured:function(e,t){var n=e.data("bg-featured-image-ratio");this._refresh_background_image_from_data({ratio:n},e,t)},refresh_background_map:function(e,t){if(!this.bg_map)return;google.maps.event.trigger(this.bg_map,"resize")},refresh_background_video:function(e,t){var n=this.model.get_breakpoint_property_value("background_video",!0),r=this.model.get_breakpoint_property_value("background_video_embed",!0),i=this.model.get_breakpoint_property_value("background_video_width",!0),s=this.model.get_breakpoint_property_value("background_video_height",!0),o=this.model.get_breakpoint_property_value("background_video_style",!0)||"crop",u,a=e.children("iframe");if(n&&r){u=s/i;if(o=="crop"||o=="inside"){var f=this._get_full_size_el(e,u,o=="inside");a.css({width:f[0],height:f[1],left:f[2],top:f[3]})}else o=="full"&&a.css({width:e.width(),height:e.height(),left:0,top:0})}},refresh_background_slider:function(e,t){e.trigger("refresh")},remove_background:function(){var e=typeof this.$bg!="undefined"?this.$bg:this.$el,t=this.$el.find(".upfront-region-bg-overlay");t.length&&t.hide(),e.css({backgroundColor:"",backgroundImage:"none",backgroundSize:"",backgroundRepeat:"",backgroundPosition:""})},on_window_resize:function(e){if(e.target!=window||!e.data.model)return;var t=e.data;t.refresh_background()},adjust_top_settings_panel_position:function(t,n){var r=t&&t instanceof Backbone.Model?t:this.model,i=n?n:this,s=n&&n.$control_el?n.$control_el:this.$control_el,o=e(Upfront.Settings.LayoutEditor.Selectors.main),u,a;if(!i||!s||s.$el)return;u=o.offset(),a=i.$el.offset(),parseInt(r.get_breakpoint_property_value("top_padding_num",!1,0),10)<30&&a.top-u.top>=30?s.find(".upfront-inline-panel-top").first().css("top","-30px"):s.find(".upfront-inline-panel-top").first().css("top","0px")}})),c=l.extend({resort_bound_collection:function(){this.$el.trigger("resort",[this])},get_settings:function(){return""},on_click:function(t){if(e("#element-settings-sidebar").html()!==""||e("#settings").html()!=="")return!1;if(t&&t.shiftKey)return;this.activate(),Upfront.Events.trigger("entity:contextmenu:deactivate",this)},deactivate:function(){this.$el.removeClass("upfront-active_entity"),this.check_deactivated(),this.trigger("upfront:entity:deactivate",this)},activate:function(){var e=this,t=Upfront.data.currentEntity;if(this.activate_condition&&!this.activate_condition())return!1;if(t&&t==this)return!1;if(!(this instanceof b))return;if(t&&t!=this){if(Upfront.data.currentEntity.$el.closest(e.$el).length)return;Upfront.data.currentEntity.trigger("deactivated")}Upfront.data.currentEntity=this,this.trigger("upfront:entity:activate",this),this.trigger("activated",this),this.listenToOnce(this,"deactivated",this.deactivate),this.$el.addClass("upfront-active_entity"),this.adjust_top_settings_panel_position()},on_meta_click:function(){},on_delete_click:function(){this.$el.closest(".upfront-region-container").removeClass("upfront-region-module-activated"),this.$el.trigger("upfront:entity:remove",[this]);if(this.group_view){var e=this.group_view.$el.find(".upfront-editable_entities_container .upfront-module-view");e.length==0&&this.group_view.on_ungroup()}return!1},on_context_menu:function(t){if(e(t.target).closest(".redactor-editor").length>0){t.stopPropagation();return}if(Upfront.Settings.Application.no_context_menu)return;t.stopPropagation();if(e(t.target).closest(".redactor_box").length>0)return;t.preventDefault(),this.event=t,Upfront.Events.trigger("entity:contextmenu:activate",this)},on_settings_click:function(e){typeof e!="undefined"&&e.preventDefault(),Upfront.Events.trigger("entity:settings:activate",this)},on_hide_click:function(e){e.preventDefault();var t=Upfront.Settings.LayoutEditor.CurrentBreakpoint,n=Upfront.Util.clone(this.model.get_property_value_by_name("breakpoint")||{});_.isObject(n[t.id])||(n[t.id]={}),n[t.id].hide==1?n[t.id].hide=0:n[t.id].hide=1,this.model.set_property("breakpoint",n)},check_deactivated:function(){Upfront.data.currentEntity==this&&(Upfront.data.currentEntity=!1)},create_size_hint:function(t){var n=this,t=t?t:this.$el.find(".upfront-editable_entity:first");t.children(".upfront-entity-size-hint").length||(this.$size_hint=e('<div class="upfront-entity-size-hint upfront-ui"></div>'),t.append(this.$size_hint)),setTimeout(function(){n.update_size_hint()},500)},update_size_hint:function(e,t){if(!this.$size_hint)return;var n=Upfront.Settings.LayoutEditor.Grid.column_padding,r=parseInt(this.model.get_breakpoint_property_value("left_padding_num")||n)+parseInt(this.model.get_breakpoint_property_value("right_padding_num")||n),i=parseInt(this.model.get_breakpoint_property_value("top_padding_num")||n)+parseInt(this.model.get_breakpoint_property_value("bottom_padding_num")||n),e=e?e-r:this.$el.width()-r,t=t?t:this.$el.outerHeight(),s="<b>w:</b>"+e+"px <b>h:</b>"+t+"px";this.$el.find(".upfront-entity-size-hint").html(s)},apply_breakpoint_position:function(e,t,n){var r=Upfront.Settings.LayoutEditor.CurrentBreakpoint,i=Upfront.Settings.LayoutEditor.Grid;if(!r)return;var s=this,n=_.isArray(n)?n:[],o=this.model.get_property_value_by_name("breakpoint"),u=this.model.get_property_value_by_name("row"),a=this.model.get_property_value_by_name("default_hide"),f=this.model.get_property_value_by_name("toggle_hide"),l=this.model.get_property_value_by_name("hide"),c=o[r.id],h=this.$el.parent(".upfront-wrapper"),p=h.length>0?h.children(":not(.upfront-wrapper-meta)").length>1:!1,d=c?c.left+c.col:0;p&&(d=Upfront.Util.width_to_col(h.width()));if(!_.contains(n,"hide")){if(c&&"hide"in c)l=c.hide;else if(!r.default||l===!1)l=a;l?e.hide():e.show(),t&&t.length>0&&(f!==!1&&f==0||!l?t.hide():l&&t.show())}_.contains(n,"col")||(c&&typeof c.col=="number"?(e.css("width",c.col/d*100+"%"),e.data("breakpoint_col",c.col),e.data("current_col",c.col)):(e.css("width",""),e.removeData("breakpoint_col"),e.data("current_col",e.data("default_col")))),_.contains(n,"left")||(c&&typeof c.left=="number"?(e.css("margin-left",c.left/d*100+"%"),e.data("breakpoint_left",c.left)):(e.css("margin-left",""),e.removeData("breakpoint_left"))),_.contains(n,"top")||(c&&typeof c.top=="number"?(e.css("margin-top",c.top*i.baseline+"px"),e.data("breakpoint_top",c.top)):(e.css("margin-top",""),e.removeData("breakpoint_top"))),_.contains(n,"row")||(c&&typeof c.row=="number"?(e.css("min-height",c.row*i.baseline+"px"),e.data("breakpoint_row",c.row)):(e.css("min-height",u*i.baseline+"px"),e.removeData("breakpoint_row"))),_.contains(n,"order")||(c&&typeof c.order=="number"?(this.$el.css("order",c.order),e.data("breakpoint_order",c.order)):(this.$el.css("order",""),e.removeData("breakpoint_order")))},apply_paddings:function(e){var t=this.model.get_breakpoint_property_value("top_padding_use",!0),n=this.model.get_breakpoint_property_value("bottom_padding_use",!0),r=this.model.get_breakpoint_property_value("left_padding_use",!0),i=this.model.get_breakpoint_property_value("right_padding_use",!0),s=this.model.get_breakpoint_property_value("top_padding_num",!0),o=this.model.get_breakpoint_property_value("bottom_padding_num",!0),u=this.model.get_breakpoint_property_value("left_padding_num",!0),a=this.model.get_breakpoint_property_value("right_padding_num",!0);e.css({paddingTop:t&&s!==!1?s+"px":"",paddingBottom:n&&o!==!1?o+"px":"",paddingLeft:r&&u!==!1?u+"px":"",paddingRight:i&&a!==!1?a+"px":""})},show_top_padding_hint:function(t){var n=this,r=this.$el.parents(".upfront-module").find(".upfront-entity-top-padding-hint");if(!this.top_padding_hint_flag){this.top_padding_hint_flag=!0;return}r.length||(r=e('<div class="upfront-ui upfront-entity-padding-hint upfront-entity-top-padding-hint"></div>').appendTo(this.$el.parents(".upfront-module"))),r.css({height:t+"px",opacity:1}),clearTimeout(this.top_padding_hint_timer),this.top_padding_hint_timer=setTimeout(function(){n.hide_top_padding_hint()},1e3)},hide_top_padding_hint:function(){this.padding_hint_locked||this.$el.parents(".upfront-module").find(".upfront-entity-top-padding-hint").css({opacity:0})},show_bottom_padding_hint:function(t){var n=this,r=this.$el.parents(".upfront-module").find(".upfront-entity-bottom-padding-hint");if(!this.bottom_padding_hint_flag){this.bottom_padding_hint_flag=!0;return}r.length||(r=e('<div class="upfront-ui upfront-entity-padding-hint upfront-entity-bottom-padding-hint"></div>').appendTo(this.$el.parents(".upfront-module"))),r.css({height:t+"px",opacity:1}),clearTimeout(this.bottom_padding_hint_timer),this.bottom_padding_hint_timer=setTimeout(function(){n.hide_bottom_padding_hint()},1e3)},hide_bottom_padding_hint:function(){this.padding_hint_locked||this.$el.parents(".upfront-module").find(".upfront-entity-bottom-padding-hint").css({opacity:0})},updateControls:function(){var e='<div class="upfront-element-controls upfront-ui"></div>';if(this.paddingControl&&typeof this.paddingControl.isOpen!="undefined"&&this.paddingControl.isOpen)return;this.controls||(this.controls=this.createControls());if(this.controls===!1)return;this.controls.render();if(!this.$control_el||this.$control_el.length===0)this.$control_el=this.$el;this.$control_el.find(">.upfront-element-controls").length===0&&(this.$control_el.append(e),this.$control_el.find(">.upfront-element-controls").html("").append(this.controls.$el)),this.updateAdvancedPadding(),this.controls.delegateEvents()},updateAdvancedPadding:function(){var t=this;t.model.set_breakpoint_property("use_padding","yes",!0);if(t.$control_el){var n=t.$control_el.find(".upfront-element-controls .upfront-field-advanced-padding");n.length>0&&(t.$el.hasClass("upfront-module-group")||n.on("click",function(){t.paddingControl!==undefined&&t.paddingControl.close(),e("#element-settings-sidebar #settings").length==0&&t.on_settings_click(),setTimeout(function(){var t=e("#element-settings-sidebar .advanced-settings");t.length>0&&!t.hasClass("uf-settings-panel--expanded")&&t.toggleClass("uf-settings-panel--expanded").find(".uf-settings-panel__body").toggle()},500)}))}},createControls:function(){var e=this,t=new Upfront.Views.Editor.InlinePanels.Panel;return t.items=this.getControlItems(),t},createControl:function(e,t,n){var r=this,i=new Upfront.Views.Editor.InlinePanels.Control;return i.icon=e,i.tooltip=t,n&&this.listenTo(i,"click",function(e){r[n](e)}),i},createPaddingControl:function(){return this.paddingControl=new Upfront.Views.Editor.InlinePanels.PaddingControl({model:this.model}),this.paddingControl.icon="padding",this.paddingControl.tooltip=t.padding_settings,this.paddingControl},getControlItems:function(){return _([this.createPaddingControl(),this.createControl("settings",t.settings,"on_settings_click")])}}),h=c.extend({events:{click:"on_click",dblclick:"on_edit"},on_edit:function(){if(e("#element-settings-sidebar").html()!==""||e("#settings").html()!=="")return!1;var t=this.$el.find("[contenteditable]");return t.length>0?t[0].focus():Upfront.Events.trigger("entity:settings:activate",this),!1}}),p=Backbone.View.extend(_.extend({},o,{initialize:function(){this.listenTo(this.model,"change",this.render),this.listenTo(this.model,"add",this.render),this.listenTo(this.model,"remove",this.render),this.init&&this.init()}})),d=p.extend({events:{resort:"on_resort_collection","upfront:entity:remove":"on_entity_remove"},on_resort_collection:function(){var t=[],n=this.model;return this.$el.find(".upfront-editable_entity, .upfront-module-group").each(function(){var r=e(this).attr("id"),i=n.get_by_element_id(r);i&&t.push(i)}),this.model.reset(t),!1},on_entity_remove:function(e,t){t.remove(),this.model.remove(t.model)},on_activate:function(e){this.model.active_entity=e.model,Upfront.Events.trigger("entity:activated",e,e.model),this.trigger("activated")},deactivate:function(e){e==this.model.active_entity&&(this.model.active_entity=!1),Upfront.Events.trigger("entity:deactivated",e),this.trigger("deactivated")},fix_flexbox_clear:function(e){},fix_wrapper_height:function(e,t,n){Upfront.Behaviors.GridEditor.time_start("fn fix_wrapper_height");var r=this,i=Upfront.Behaviors.GridEditor,s=Upfront.Views.breakpoints_storage.get_breakpoints().get_active().toJSON(),o=i.parse_modules_to_lines(e,t,s.id,_.isNumber(n)?n:s.columns);Upfront.Events.trigger("upfront:wrappers:before_fix_height",this),t.each(function(e){var t=Upfront.data.wrapper_views[e.cid];if(!t)return;t.$el.css("min-height","")}),_.each(o,function(e){var t=[];_.each(e.wrappers,function(e){var n=Upfront.data.wrapper_views[e.model.cid];if(!n)return;t.push(n.$el)}),r._apply_wrapper_height(t)}),Upfront.Events.trigger("upfront:wrappers:after_fix_height",this),Upfront.Behaviors.GridEditor.time_end("fn fix_wrapper_height")},_apply_wrapper_height:function(e){var t=_.map(e,function(e){return parseFloat(e.css("height"))}),n=_.max(t,function(e){return e});_.each(e,function(t,r){var i=r>0?e[r-1].hasClass("upfront-wrapper-spacer"):!1,s=r<e.length-1?e[r+1].hasClass("upfront-wrapper-spacer"):!1;t.removeAttr("data-first-in-row"),t.removeAttr("data-last-in-row"),t.removeAttr("data-prev-spacer"),t.removeAttr("data-next-spacer"),r==0&&t.attr("data-first-in-row","1"),r==e.length-1&&t.attr("data-last-in-row","1"),i&&t.attr("data-prev-spacer","1"),s&&t.attr("data-next-spacer","1"),t.css("min-height",n)})},normalize_child_modules:function(e,t,n){var r=Upfront.Views.breakpoints_storage.get_breakpoints().get_active().toJSON(),i=this,s=Upfront.Behaviors.GridEditor,o=this.model,u=_.isNumber(t)?t:e,a=s.parse_modules_to_lines(o,n,r?r.id:"desktop",u);_.each(a,function(t){i._normalize_child_modules_line(t,e,u,r,n)})},normalize_child_spacing:function(){if(this.region_view&&this.region_view.model.get("name")=="shadow")return;if(!this.object_group_view&&!this.region_view)return;var e=this,t=Upfront.Behaviors.GridEditor,n=Upfront.Views.breakpoints_storage.get_breakpoints().get_enabled(),r=!_.isUndefined(this.group_view),i=!_.isUndefined(this.object_group_view),s=this.model,o=r?this.group_view.model.get("wrappers"):i?this.object_group_view.model.get("wrappers"):this.region_view.model.get("wrappers");_.each(n,function(n){var r=n.toJSON(),i=t.get_container_col(e,r),u=t.parse_modules_to_lines(s,o,r.id,i),a=!1;_.each(u,function(n){var i=[],s=[],u=[];_.each(n.wrappers,function(e){i.push(e),e.spacer?s.push(e):u.push(e)});if(i.length==s.length){e._remove_spacers(s,o),a=!0;return}_.each(i,function(n,s){if(s==0)return;if(!n.spacer||!i[s-1].spacer)return;var u=i[s-1],f=u.col+n.col,l=u.model.get_property_value_by_name("breakpoint"),c=l&&r.id in l?l[r.id]:{};e._remove_spacers([n],o),!r||r.default?(u.model.replace_class(t.grid.class+f),_.each(u.modules,function(e){e.model.replace_class(t.grid.class+f)})):(c.col=f,u.model.set_property("breakpoint",Upfront.Util.clone(l)),_.each(u.modules,function(e){var t=e.model.get_property_value_by_name("breakpoint"),n=t&&r.id in t?t[r.id]:{};n.col=f,e.model.set_property("breakpoint",Upfront.Util.clone(t))})),a=!0})}),a&&(u=t.parse_modules_to_lines(s,o,r.id,i)),_.each(u,function(t){if(t.col==i)return;e._normalize_child_modules_line(t,i,t.col,r,o)})})},_normalize_child_modules_line:function(e,t,n,r,i){var s=this,o=Upfront.Behaviors.GridEditor,u=this.model,a=t-e.col,f=0,l=0,c=0,h=0,p=[],d=[],v=[];if(a==0)return;_.each(e.wrappers,function(e){e.ratio=e.col/n,e.apply_diff=Math.round(e.ratio*a),e.col+e.apply_diff<=0&&(e.apply_diff=0),f+=e.apply_diff,p.push(e),e.spacer?d.push(e):v.push(e)});if(p.length==d.length){this._remove_spacers(d,i);return}l=f-a;if(l!=0){h=l>0?-1:1;while(l!=0){c=l,_.each(a>0?_.union(v,d):_.union(d,v),function(e){if(l==0)return;if(e.col+e.apply_diff+h<=0)return;e.apply_diff+=h,l+=h});if(c==l)break}}_.each(p,function(e){var t=e.col+e.apply_diff,n=e.model.get_property_value_by_name("breakpoint"),i=n&&r.id in n?n[r.id]:{};!r||r.default?(e.model.replace_class(o.grid.class+t),_.each(e.modules,function(e){e.model.replace_class(o.grid.class+t)})):(i.col=t,e.model.set_property("breakpoint",Upfront.Util.clone(n)),_.each(e.modules,function(e){var n=e.model.get_property_value_by_name("breakpoint"),i=n&&r.id in n?n[r.id]:{};i.col=t,e.model.set_property("breakpoint",Upfront.Util.clone(n))}))})},_remove_spacers:function(e,t){var n=this.model;_.each(e,function(e){_.each(e.modules,function(e){n.remove(e.model)}),t.remove(e.model)})},preserve_wrappers_breakpoint_order:function(){if(!this.region_view||this.region_view.model.get("name")=="shadow")return;var e=this,t=Upfront.Behaviors.GridEditor,n=Upfront.Views.breakpoints_storage.get_breakpoints().get_enabled(),r=!_.isUndefined(this.group_view),i=!_.isUndefined(this.object_group_view),s=this.model,o=r?this.group_view.model.get("wrappers"):i?this.object_group_view.model.get("wrappers"):this.region_view.model.get("wrappers");_.each(n,function(n){var r=n.toJSON();if(r.default)return;var i=t.get_container_col(e,r),u=t.parse_modules_to_lines(s,o,r.id,i),a=1;_.each(u,function(e){_.each(e.wrappers,function(e){var t=e.model.get_property_value_by_name("breakpoint"),n=t&&r.id in t?t[r.id]:{};n.order=a,e.model.set_property("breakpoint",Upfront.Util.clone(t)),a++})})})}}),v=Backbone.View.extend({tagName:"li",initialize:function(e){this.options=e,this.label=this.options.get_label,this.action=this.options.action,typeof this.options.in_context=="function"&&(this.in_context=this.options.in_context)},render:function(){var e=this,t="upfront-ctx-"+this.label().replace(/[^a-z0-9]/ig,"_").toLowerCase();this.$el.empty().addClass(t),this.$el.append(this.label),this.$el.bind("click",function(t){t.preventDefault(),e.action(this.for_view,t),Upfront.Events.trigger("entity:contextmenu:deactivate",this)})},remove:function(){this.parent_view=!1,this.for_view=!1,Backbone.View.prototype.remove.call(this)},in_context:function(){return!0}}),m=Backbone.View.extend({tagName:"ul",initialize:function(e){this.options=e,this.for_view=this.options.for_view},render:function(){var e=this;this.$el.empty(),this.menuitems.each(function(t){t.menulist||(t.menulist=e),t.for_view=e.for_view;if(!t.in_context())return;t.render(),t.parent_view=e,e.$el.append(t.el)})},remove:function(){this.menuitems&&this.menuitems.each(function(e){e.remove()}),this.for_view=!1,this.parent_view=!1,this.options=!1,Backbone.View.prototype.remove.call(this)}}),g=m.extend({className:"upfront-default_ctx_list",initialize:function(){var e=[];Upfront.Application.get_current()!="theme"&&(Upfront.Settings.Application.NO_SAVE||e.push(new Upfront.Views.ContextMenuItem({get_label:function(){return t.save},action:function(){var e=new Upfront.Views.Editor.Command_SaveLayout;e.on_click()}})),e.push(new Upfront.Views.ContextMenuItem({get_label:function(){return t.undo},action:function(e){var t=new Upfront.Views.Editor.Command_Undo({model:Upfront.Application.layout});t.on_click()}}))),e.push(new Upfront.Views.ContextMenuItem({get_label:function(){return Upfront.Application.get_gridstate()?t.hide_grid:t.show_grid},action:function(){var e=new Upfront.Views.Editor.Command_ToggleGrid;e.on_click()}})),e.push(new Upfront.Views.ContextMenuItem({get_label:function(){return t.clone},in_context:function(){return this.for_view instanceof Upfront.Views.ObjectView},action:function(e,t){var n=this.for_view.parent_module_view,r=n.model,i=n.group_view?n.group_view:n.region_view,s=i.model.get("modules"),o=i.model.get("wrappers"),u=o.get_by_wrapper_id(r.get_property_value_by_name("wrapper_id")),a=Upfront.Util.model_to_json(r),f=new Upfront.Models.Module(a),l=Upfront.Util.get_unique_id("wrapper"),c=Upfront.Util.model_to_json(u),h=new Upfront.Models.Wrapper(c),p=s.indexOf(r),d=[];h.set_property("wrapper_id",l),f.set_property("wrapper_id",l),f.set_property("element_id",Upfront.Util.get_unique_id("module")),f.get("objects").each(function(e){e.set_property("element_id",Upfront.Util.get_unique_id("object"))}),o.add(h),s.add(f);var v=Upfront.Behaviors.GridEditor,m=Upfront.data.module_views[f.cid],g=m.$el,y=g.find(".upfront-module"),b=y.offset(),w=y.position(),E=y.outerHeight(),S=y.outerWidth();v.start(m,f),v.normalize(v.els,v.wraps),y.css({position:"relative",top:t.pageY-b.top-E/2,left:t.pageX-b.left-S/2}),y.simulate("mousedown",{clientX:t.clientX,clientY:t.clientY})}})),e.push(new Upfront.Views.ContextMenuItem({get_label:function(){return"Edit Object"},in_context:function(){return this.for_view instanceof Upfront.Views.ObjectGroup},action:function(e,t){this.for_view.enable_object_edit()}})),this.menuitems=_(e)}}),y=Backbone.View.extend({initialize:function(e){this.options=e,this.for_view=this.options.for_view,this.menulists=_([])},render:function(){var t=this;this.$el.empty().show(),this.menulists.each(function(e){e.for_view=t.for_view,e.render(),e.parent_view=t,t.$el.append(e.el)});var n=new g;n.for_view=t.for_view,n.render(),n.parent_view=t,t.$el.append(n.el),this.$el.css({position:"absolute","z-index":1e7,display:"block"}).offset({top:t.for_view.event.pageY,left:t.for_view.event.pageX-(e(document).width()-t.for_view.event.pageX<=this.$el.width()?this.$el.width():0)}).addClass("uf-context-menu")},remove:function(){this.menulists&&this.menulists.each(function(e){e.remove()}),Backbone.View.prototype.remove.call(this),e("#contextmenu").length||e("body").append('<div id="contextmenu">')}}),b=h.extend({className:"upfront-object-view",display_size_hint:!0,events:{"click .upfront-object > .upfront-entity_meta > a.upfront-entity-delete_trigger":"on_delete_click","click .upfront-object > .upfront-entity_meta > a.upfront-entity-hide_trigger":"on_hide_click","click .upfront-object-hidden-toggle > a.upfront-entity-hide_trigger":"on_hide_click","click .upfront-object > .upfront-entity_meta":"on_meta_click",click:"on_click",contextmenu:"on_context_menu"},initialize:function(){var e=this.update||this.render;this.listenTo(this.model.get("properties"),"change",e),this.listenTo(this.model.get("properties"),"add",e),this.listenTo(this.model.get("properties"),"remove",e),this.listenTo(Upfront.Events,"entity:resize_start",this.close_settings),this.listenTo(Upfront.Events,"entity:drag_start",this.close_settings),this.listenTo(Upfront.Events,"upfront:element:edit:start",this.on_element_edit_start),this.listenTo(Upfront.Events,"upfront:element:edit:stop",this.on_element_edit_stop),this.listenTo(Upfront.Events,"upfront:edit_content_style:start",this.on_content_style_edit_start),this.listenTo(Upfront.Events,"upfront:edit_content_style:stop",this.on_content_style_edit_stop),this.listenTo(Upfront.Events,"entity:module:update",this.on_module_update),this.listenTo(Upfront.Events,"layout:after_render",this.on_after_layout_render),this.listenTo(Upfront.Events,"layout:after_render",this.checkUiOffset),this.on("entity:resize_start",this.on_resize_start),this.on("entity:resizing",this.on_resizing),this.on("entity:resize_stop",this.on_resize),this.listenTo(Upfront.Events,"upfront:layout_size:change_breakpoint",this.on_change_breakpoint),this.listenTo(Upfront.Events,"entity:wrapper:update_position",this.on_wrapper_update),this.init&&this.init()},init_properties:function(){var e=Upfront.Settings.LayoutEditor.Grid.column_padding;this.model.get_property_value_by_name("padding_slider")||this.model.init_property("padding_slider",e)},close_settings:function(){Upfront.Events.trigger("entity:settings:deactivate")},render:function(){var e=Upfront.Settings.LayoutEditor.Grid,t={},n=this,r=this.get_buttons?this.get_buttons():"",s=this.get_extra_buttons?this.get_extra_buttons():"",o=this.get_content_markup?this.get_content_markup():"",u=e.column_padding,a,f,l,c,h,p,d;this.$el.addClass("upfront-object-view"),this.init_properties();var v=this.model.get_property_value_by_name("anchor");v&&v.length&&(this.el.id=v),this.model.get("properties").each(function(e){t[e.get("name")]=e.get("value")});var m="";_.each(this.model._previousAttributes.properties,function(e){if(typeof e=="undefined")return;e.name==="theme_style"&&(m=e.value)}),m&&t.theme_style===""&&(this.$el.removeClass(m),this.$el.addClass(t.preset));var g=this.model.get_breakpoint_property_value("row",!0);a=g?g*Upfront.Settings.LayoutEditor.Grid.baseline:0,d="default_hide"in t?t.default_hide:0,p="hide"in t?t.hide:d;var y=this.model.get_breakpoint_property_value("theme_style",!0);y&&(t.class+=" "+y.toLowerCase(),this._theme_style=y),t.preset=t.preset||"",f=_.extend(this.model.toJSON(),{properties:t,buttons:r,content:o,height:a,hide:p,extra_buttons:s}),typeof f.properties.usingNewAppearance=="undefined"&&(f.properties.preset=""),l=_.template(i.object,f),Upfront.Events.trigger("entity:object:before_render",this,this.model),this.parent_module_view&&(this.stopListening(this._previous_parent_module_view||this.parent_module_view,"entity:resize_start"),this.listenTo(this.parent_module_view,"entity:resize_start",this.on_element_resize_start),this.stopListening(this._previous_parent_module_view||this.parent_module_view,"entity:resizing"),this.listenTo(this.parent_module_view,"entity:resizing",this.on_element_resizing),this.stopListening(this._previous_parent_module_view||this.parent_module_view,"entity:resize_stop"),this.listenTo(this.parent_module_view,"entity:resize_stop",this.on_element_resize),this.stopListening(this._previous_parent_module_view||this.parent_module_view,"entity:drop"),this.listenTo(this.parent_module_view,"entity:drop",this.on_element_drop),this.listenTo(this.parent_module_view,"entity:drop",this.adjust_top_settings_panel_position),c=Upfront.Behaviors.GridEditor.get_class_num(this.parent_module_view.model.get_property_value_by_name("class"),e.class)),this.object_group_view&&(this.stopListening(this.object_group_view,"toggle_object_edit"),this.listenTo(this.object_group_view,"toggle_object_edit",this.on_toggle_object_edit)),this.$el.html(l),typeof this.subview!="undefined"&&this.subview.setElement(this.$(".upfront-object-content")).render(),"class"in t?(h=Upfront.Behaviors.GridEditor.get_class_num(t.class,e.class),h=h>c?c:h):h=c,$object=this.$el.find(".upfront-editable_entity:first"),$object.data("default_col",h),$object.data("current_col",h),this.apply_paddings(this.$el.find("> .upfront-editable_entity:first")),Upfront.Events.trigger("entity:object:after_render",this,this.model),this.display_size_hint&&this.create_size_hint(this.$el),this.on_render&&this.on_render(),this.ensure_breakpoint_change_is_listened(),this.ensureUiOffsetCalls(),this.parent_module_view&&(this.$control_el=this.parent_module_view.$(".upfront-module"),this.updateControls(),setTimeout(function(){n.paddingControl&&typeof n.paddingControl.isOpen!="undefined"&&!n.paddingControl.isOpen&&n.paddingControl.refresh()},300))},update:function(e,t){if(typeof e=="undefined")return this.render();var n=e.get("value"),r=this.$el.find(".upfront-editable_entity:first"),i=Upfront.Settings.LayoutEditor.Grid;if(e.id=="row"){var s=n*i.baseline;r.css("min-height",s).attr("data-row",n)}else if(e.id=="class"){var o=r.attr("class");_.each([i.class,i.left_margin_class,i.top_margin_class,i.bottom_margin_class,i.right_margin_class],function(e){var t=new RegExp("\\b"+e+"(\\d+)"),s=n.match(t);s&&s[1]&&(Upfront.Behaviors.GridEditor.update_class(r,e,s[1]),e==i.class&&(r.data("default_col",parseInt(s[1],10)),r.data("current_col",parseInt(s[1],10))))})}else if(e.id=="breakpoint"){this.update_position();var u=n.current_property,a=Upfront.Settings.LayoutEditor.CurrentBreakpoint,f=n[a.id]&&n[a.id][u]?n[a.id][u]:!1;u&&f&&(u==="top_padding_num"&&this.show_top_padding_hint(f),u==="bottom_padding_num"&&this.show_bottom_padding_hint(f))}else e.id.match(/(top|bottom|left|right)_padding_(use|num|slider)/)?(this.apply_paddings(r),this.handle_visual_padding_hint(e)):e.id.match(/padding_slider/)?(this.render(),this.handle_visual_padding_hint(e)):this.render();Upfront.Events.trigger("entity:object:update",this,this.model)},handle_visual_padding_hint:function(e){if(typeof e=="undefined")return;var t=e.get("value");e.id.match(/(top|bottom)_padding_(num|slider)/)?(e.id.match(/top_padding_(num|slider)/)&&this.show_top_padding_hint(t),e.id.match(/bottom_padding_(num|slider)/)&&this.show_bottom_padding_hint(t)):e.id.match(/padding_slider/)&&(this.show_top_padding_hint(t),this.show_bottom_padding_hint(t))},update_position:function(){var e=Upfront.Settings.LayoutEditor.CurrentBreakpoint;if(!e)return;var t=this.$el.find("> .upfront-editable_entity:first"),n=this.$el.find("> .upfront-object-hidden-toggle");this.apply_paddings(t),this.apply_breakpoint_position(t,n),this.display_size_hint&&this.update_size_hint(),Upfront.Events.trigger("entity:object:update_position",this,this.model)},ensure_breakpoint_change_is_listened:function(){if(this.breakpoint_change_is_setup)return;this.listenTo(Upfront.Events,"upfront:layout_size:change_breakpoint",this.on_change_breakpoint),this.breakpoint_change_is_setup=!0},ensureUiOffsetCalls:function(){var t=this;this.parent_module_view&&this.parent_module_view.$el&&!this.offset_check_set_for_parent&&(this.offset_check_set_for_parent=!0,this.listenTo(this.parent_module_view,"entity:drop",function(){t.checkUiOffset()}));if(this.window_resize_offset_check_set)return;this.lazyCheckUiOffset=_.throttle(this.checkUiOffset,1e3),e(window).on("resize",e.proxy(this.lazyCheckUiOffset,t)),this.window_resize_offset_check_set=!0},checkUiOffset:function(){if(!this.parent_module_view)return;var e=this.parent_module_view.region_view&&this.parent_module_view.region_view.$el;if(!e)return;var t=Upfront.Settings.LayoutEditor.CurrentBreakpoint,n=t&&!t.default,r=e.closest(".upfront-region-container"),i=n?e.offset():r.offset(),s=this.$el.offset(),o=i&&s.top-i.top<50,u=s.left+this.$el.width(),a=(i||{left:0}).left+(n?e.width():r.width()),f=a-u<30;o&&f?this.parent_module_view.$el.addClass("offset-ui-from-right-top"):this.parent_module_view.$el.removeClass("offset-ui-from-right-top")},on_element_edit_start:function(e,t){(e=="text"||e=="write")&&this.parent_module_view&&(this.parent_module_view.$el.find(">.upfront-module").addClass("upfront-module-editing"),e=="write"?this.parent_module_view.disable_interaction(!0,!0,!1,!1,!0):this.parent_module_view.disable_interaction(!1))},on_element_edit_stop:function(t,n,r){var i=e(Upfront.Settings.LayoutEditor.Selectors.main);if(i.hasClass("upfront-editing-post-content")&&t!="write")return;this.parent_module_view&&this.parent_module_view.enable_interaction&&r!==!0&&(this.parent_module_view.$el.find(">.upfront-module").removeClass("upfront-module-editing"),t=="write"?this.parent_module_view.enable_interaction(!0):this.parent_module_view.enable_interaction(!1))},on_content_style_edit_start:function(){this.parent_module_view&&(this.parent_module_view.$el.find(">.upfront-module").addClass("upfront-module-editing"),this.parent_module_view.disable_interaction(!1))},on_content_style_edit_stop:function(){this.parent_module_view&&this.parent_module_view.enable_interaction&&(this.parent_module_view.$el.find(">.upfront-module").removeClass("upfront-module-editing"),this.parent_module_view.enable_interaction(!1))},on_element_resize_start:function(e){},on_element_resizing:function(e){this.display_size_hint&&this.update_size_hint(e.width,e.height)},on_element_resize:function(e){},on_element_drop:function(e){},on_resize_start:function(e){},on_resizing:function(e){this.display_size_hint&&this.update_size_hint(e.width,e.height)},on_resize:function(e){},on_after_layout_render:function(){},on_module_update:function(e){if(!this.parent_module_view||this.parent_module_view!=e)return;if(this.display_size_hint){var t=this;setTimeout(function(){t.update_size_hint()},500)}},on_wrapper_update:function(e,t){if(this.wrapper_view&&e!=this.wrapper_view)return;this.update_position()},on_toggle_object_edit:function(e){var t=this.$el.find(">.upfront-editable_entity:first"),n=t.find("> .upfront-entity_meta > a.upfront-entity-hide_trigger"),r=Upfront.Settings.LayoutEditor.CurrentBreakpoint;t.data("ui-draggable")&&t.draggable("option","disabled",!e),r&&!r.default?n.toggle(e):n.hide()},on_change_breakpoint:function(e){var t=this.model.get_breakpoint_property_value("theme_style",!0),n=this.$el.find("> .upfront-editable_entity:first");this._theme_style&&n.removeClass(this._theme_style.toLowerCase()),t&&(n.addClass(t.toLowerCase()),this._theme_style=t),this.model.decode_preset(e.id),this.checkUiOffset()},activate:function(){typeof Upfront.data.prevEntity!="undefined"&&Upfront.data.prevEntity!==!1&&Upfront.data.prevEntity.deactivate(),Upfront.data.prevEntity=this,c.prototype.activate.call(this),e(".upfront-region-module-activated").removeClass(".upfront-region-module-activated"),this.$el.closest(".upfront-region-container").addClass("upfront-region-module-activated");if(!this.parent_module_view)return;this.parent_module_view.$el.find(">.upfront-module").addClass("upfront-module-active");if(!this.parent_module_view.wrapper_view)return;this.parent_module_view.wrapper_view.$el.addClass("upfront-wrapper-active")},deactivate:function(){if(e("#element-settings-sidebar").html()!==""||e("#settings").html()!=="")return!1;Upfront.data.prevEntity=!1,c.prototype.deactivate.call(this),this.$el.closest(".upfront-region-container").removeClass("upfront-region-module-activated");if(!this.parent_module_view)return;this.parent_module_view.$el.find(">.upfront-module").removeClass("upfront-module-active");if(!this.parent_module_view.wrapper_view)return;this.parent_module_view.wrapper_view.$el.removeClass("upfront-wrapper-active upfront-inline-panel-item-open")},on_hide_click:function(e){e.preventDefault();var t=Upfront.Settings.LayoutEditor.CurrentBreakpoint,n=Upfront.Util.clone(this.model.get_property_value_by_name("breakpoint")||{});_.isObject(n[t.id])||(n[t.id]={}),n[t.id].hide==1?n[t.id].hide=0:n[t.id].hide=1,this.model.set_property("breakpoint",n)},on_context_menu:function(e){if(this.object_group_view)return;c.prototype.on_context_menu.call(this,e)},toggle_region_class:function(e,t,n){var r=this.parent_module_view&&this.parent_module_view.region_view?this.parent_module_view.region_view:!1,i=r?r.parent_view.get_container_view(r.model):!1,n=!0===n;if(!r)return;n?(i||{}).$el&&i.$el.toggleClass(e,t):r.$el.toggleClass(e,t)},add_region_class:function(e,t){this.toggle_region_class(e,!0,t)},remove_region_class:function(e,t){this.toggle_region_class(e,!1,t)},get_element_size:function(e){var t=Upfront.Behaviors.GridEditor,e=typeof e=="undefined"?!0:e;t.start(this.parent_module_view,this.parent_module_view.model);var n=t.get_position(this.parent_module_view.$el.find(".upfront-module"));return{col:n.col,row:e?n.row:this.model.get_property_value_by_name("row")}},get_element_columns:function(){return this.get_element_size().col},get_element_rows:function(){return this.get_element_size().row},get_element_size_px:function(e){var t=Upfront.Behaviors.GridEditor,e=typeof e=="undefined"?!0:e,n=this.get_element_size(e);return{col:n.col*t.col_size,row:n.row*t.baseline}},get_element_columns_px:function(){return this.get_element_size_px().col},get_element_rows_px:function(){return this.get_element_size_px().row},get_element_max_size:function(e){var t=Upfront.Behaviors.GridEditor,n=this.parent_module_view.$el.find(".upfront-module"),r=this.$el.closest(".upfront-region");return t.start(this.parent_module_view,this.parent_module_view.model),t.get_max_size(t.get_el(n),t.els,t.get_region(r),e)},get_element_max_columns:function(e){return this.get_element_max_size(e).col},get_element_max_rows:function(e){return this.get_element_max_size(e).row},get_element_max_size_px:function(e){var t=Upfront.Behaviors.GridEditor,n=this.get_element_max_size(e);return{col:n.col*t.col_size,row:n.row*t.baseline}},get_element_max_columns_px:function(e){return this.get_element_max_size_px(e).col},get_element_max_rows_px:function(e){return this.get_element_max_size_px(e).row},set_element_size:function(e,t,n,r){return Upfront.Behaviors.GridEditor.resize(this.parent_module_view,this.parent_module_view.model,e,t,n,r)},cleanup:function(){},remove:function(){this.cleanup(),e(window).off("resize",this.lazyCheckUiOffset),this.parent_view=!1,this.parent_module_view=!1,this.object_group_view=!1,Backbone.View.prototype.remove.call(this)},on_settings_click:function(e){typeof e!="undefined"&&e.preventDefault(),Upfront.Events.trigger("element:settings:activate",this)}}),w=b.extend({className:"upfront-object-group-view",events:{"click .upfront-object-group > .upfront-entity_meta > a.upfront-entity-settings_trigger":"on_settings_click","click .upfront-object-group > .upfront-entity_meta > a.upfront-entity-delete_trigger":"on_delete_click","click .upfront-object-group > .upfront-entity_meta":"on_meta_click","click > .upfront-object-group-finish-edit":"on_finish",click:"on_click",contextmenu:"on_context_menu"},initialize:function(){b.prototype.initialize.call(this),this.listenTo(Upfront.Events,"command:object_group:finish_edit",this.on_finish),this._module_col={},this.editing=!1},render:function(){var e=this,t=Upfront.Settings.LayoutEditor.Grid,n=this._objects_view||new E({model:this.model.get("objects")}),r={},s=this.get_buttons?this.get_buttons():"",o=this.get_extra_buttons?this.get_extra_buttons():"",u,a,f,l,c,h=this.model.get_property_value_by_name("anchor");h&&h.length&&(this.el.id=h),this.model.get("properties").each(function(e){r[e.get("name")]=e.get("value")});var p=this.model.get_breakpoint_property_value("row",!0);u=p?p*Upfront.Settings.LayoutEditor.Grid.baseline:0;var d=this.model.get_breakpoint_property_value("theme_style",!0);d&&(r.class+=" "+d.toLowerCase(),this._theme_style=d),r.preset=r.preset||"",this._preset=r.preset,a=_.extend(this.model.toJSON(),{properties:r,buttons:s,height:u,extra_buttons:o}),f=_.template(i.object_group,a),Upfront.Events.trigger("entity:object_group:before_render",this,this.model),this.parent_module_view&&(this.stopListening(this._previous_parent_module_view||this.parent_module_view,"entity:resize_start"),this.listenTo(this.parent_module_view,"entity:resize_start",this.on_element_resize_start),this.stopListening(this._previous_parent_module_view||this.parent_module_view,"entity:resizing"),this.listenTo(this.parent_module_view,"entity:resizing",this.on_element_resizing),this.stopListening(this._previous_parent_module_view||this.parent_module_view,"entity:resize_stop"),this.listenTo(this.parent_module_view,"entity:resize_stop",this.on_element_resize),this.stopListening(this._previous_parent_module_view||this.parent_module_view,"entity:drop"),this.listenTo(this.parent_module_view,"entity:drop",this.on_element_drop),l=Upfront.Behaviors.GridEditor.get_class_num(this.parent_module_view.model.get_property_value_by_name("class"),t.class)),n.$el.detach(),this.$el.html(f),n.object_group_view=this,this.$(".upfront-objects_container").append(n.el),n.render(),c=Upfront.Behaviors.GridEditor.get_class_num(r.class,t.class),c=c>l?l:c,$object=this.$el.find(".upfront-editable_entity:first"),$object.data("default_col",c),$object.data("current_col",c),this.apply_paddings(this.$el.find("> .upfront-editable_entity:first")),Upfront.Events.trigger("entity:object_group:after_render",this,this.model),this.display_size_hint&&this.create_size_hint(this.$el),this.on_render&&this.on_render(),this._objects_view?this._objects_view.delegateEvents():this._objects_view=n,this.ensure_breakpoint_change_is_listened(),this.ensureUiOffsetCalls(),this.parent_module_view&&(this.$control_el=this.parent_module_view.$(".upfront-module"),this.updateControls(),setTimeout(function(){e.paddingControl&&typeof e.paddingControl.isOpen!="undefined"&&!e.paddingControl.isOpen&&e.paddingControl.refresh()},300)),this._module_cols=this.get_module_cols()},update:function(e,t){if(typeof e=="undefined")return;var n=e.get("value"),r=this.$el.find(".upfront-editable_entity:first"),i=Upfront.Settings.LayoutEditor.Grid;if(e.id=="row"){var s=n*i.baseline;r.css("min-height",s).attr("data-row",n)}else if(e.id=="class"){var o=r.attr("class");_.each([i.class,i.left_margin_class,i.top_margin_class,i.bottom_margin_class,i.right_margin_class],function(e){var t=new RegExp("\\b"+e+"(\\d+)"),i=n.match(t);i&&i[1]&&Upfront.Behaviors.GridEditor.update_class(r,e,i[1])})}else if(e.id=="breakpoint"){this.update_position();var u=n.current_property,a=Upfront.Settings.LayoutEditor.CurrentBreakpoint,f=n[a.id]&&n[a.id][u]?n[a.id][u]:!1;u&&f&&(u==="top_padding_num"&&this.show_top_padding_hint(f),u==="bottom_padding_num"&&this.show_bottom_padding_hint(f))}else e.id.match(/(top|bottom|left|right)_padding_(use|num|slider)/)?(this.apply_paddings(r),this.handle_visual_padding_hint(e)):e.id.match(/padding_slider/)?this.handle_visual_padding_hint(e):e.id=="preset"&&(this._preset&&r.removeClass(this._preset),r.addClass(n),this._preset=n);Upfront.Events.trigger("entity:object_group:update",this,this.model)},get_module_cols:function(){var e=this,t=this.parent_module_view.model,n=t.get_property_value_by_name("class"),r=Upfront.Settings.LayoutEditor.Grid,i=Upfront.Behaviors.GridEditor,s=Upfront.Views.breakpoints_storage.get_breakpoints().get_enabled(),o={};return o.default=i.get_class_num(n,r.class),_.each(s,function(t){var n=t.toJSON(),r=i.get_container_col(e._objects_view,n);o[n.id]=r}),o},on_click:function(e){c.prototype.on_click.call(this,e),this.parent_module_view&&this.parent_module_view.group_view&&e.stopPropagation()},on_module_update:function(e,t){if(!this.parent_module_view||this.parent_module_view!=e)return;var n=Upfront.Settings.LayoutEditor.CurrentBreakpoint,r=this.get_module_cols();Upfront.Application.layout_ready&&(prev_col=!n||n.default?this._module_cols.default:this._module_cols[n.id],col=!n||n.default?r.default:r[n.id],prev_col!=col&&this.normalize_child_modules(prev_col)),this._module_cols=r},normalize_child_modules:function(e){if(!this._objects_view)return;var t=Upfront.Views.breakpoints_storage.get_breakpoints().get_active().toJSON(),n=Upfront.Behaviors.GridEditor,r=this.parent_module_view.$el.find("> .upfront-module"),i=!t||t.default?n.get_class_num(r,n.grid.class):r.data("breakpoint_col");this._objects_view.normalize_child_modules(i,e,this.model.get("wrappers"))},enable_object_edit:function(){this.parent_module_view&&!this.parent_module_view.group_view&&Upfront.Events.trigger("command:module_group:finish_edit"),Upfront.Events.trigger("command:object_group:finish_edit"),this.toggle_object_edit(!0)},disable_object_edit:function(){if(!this.editing)return;this.toggle_object_edit(!1)},toggle_object_edit:function(t){var n=e(Upfront.Settings.LayoutEditor.Selectors.main);t?(n.addClass("upfront-object-group-editing"),this.$el.addClass("upfront-object-group-on-edit"),this.parent_module_view.disable_interaction(!0,!0,!1,!1,!0),this.parent_module_view.$el.addClass("upfront-module-object-group-on-edit"),this.parent_module_view.wrapper_view&&this.parent_module_view.wrapper_view.$el.addClass("upfront-wrapper-object-group-on-edit"),this.editing=!0):this.editing&&(n.removeClass("upfront-object-group-editing"),this.$el.removeClass("upfront-object-group-on-edit"),this.parent_module_view.enable_interaction(!0),this.parent_module_view.$el.removeClass("upfront-module-object-group-on-edit"),this.parent_module_view.wrapper_view&&this.parent_module_view.wrapper_view.$el.removeClass("upfront-wrapper-object-group-on-edit"),this.editing=!1),this.trigger("toggle_object_edit",t)},on_finish:function(e){typeof e!="undefined"&&e.preventDefault(),this.disable_object_edit()},remove:function(){this._objects_view&&this._objects_view.remove(),Backbone.View.prototype.remove.call(this)}}),E=d.extend({attributes:{"class":"upfront-editable_entities_container"},init:function(){this.stopListening(this.model,"add",this.render),this.listenTo(this.model,"add",this.on_add),this.stopListening(this.model,"remove",this.render),this.listenTo(this.model,"remove",this.on_remove),this.stopListening(this.model,"change",this.render),this.listenTo(this.model,"change",this.rerender_objects),this.listenTo(this.model,"reset",this.on_reset),this.listenTo(Upfront.Events,"entity:drag_stop",this.apply_wrapper_height),this.listenTo(Upfront.Events,"entity:drag_stop",this.apply_adapt_to_breakpoints),this.listenTo(Upfront.Events,"entity:resized",this.apply_wrapper_height),this.listenTo(Upfront.Events,"entity:resized",this.apply_adapt_to_breakpoints),this.listenTo(Upfront.Events,"entity:wrapper:resized",this.on_wrapper_resize),this.listenTo(Upfront.Events,"entity:wrappers:update",this.on_wrappers_update),this.listenTo(Upfront.Events,"entity:object:refresh",this.on_object_refresh),this.listenTo(Upfront.Events,"layout:render",this.on_after_layout_render),this.listenTo(Upfront.Events,"upfront:layout_size:change_breakpoint",this.on_change_breakpoint)},on_entity_remove:function(e,t){Upfront.Events.trigger("entity:object:removed:before");var n=t.model.get_wrapper_id(),r=this;if(n&&this.object_group_view){var i=this.object_group_view.model.get("wrappers"),s=i.get_by_wrapper_id(n),o=0;s&&(this.model.each(function(e){e.get_wrapper_id()==n&&o++}),o==1&&(Upfront.Behaviors.GridEditor.normalize_module_remove(t,t.model,this.model,s,i),i.remove(s)))}t.remove(),this.model.remove(t.model),this.normalize_child_spacing(),Upfront.Events.trigger("entity:object:removed:after")},render:function(){var e=this.$el,t=this;e.find(">.upfront-wrapper").detach(),typeof Upfront.data.object_views=="undefined"&&(Upfront.data.object_views={}),typeof Upfront.data.wrapper_views=="undefined"&&(Upfront.data.wrapper_views={}),this.current_wrapper_view=null,this.current_wrapper_id=null,this.current_wrapper_el=null,this.model.each(function(e){t.render_object(e)}),this.apply_flexbox_clear()},render_object:function(t,n){var r=this.$el,i=n&&typeof n.index!="undefined"?n.index-1:-2,s=i>=0?r.find("> .upfront-wrapper > .upfront-object-view, > .upfront-wrapper > .upfront-object-group").eq(i):!1,o=this.object_group_view&&this.object_group_view.model?this.object_group_view.model.get("wrappers"):!1,u=t.get("properties").where({name:"view_class"}),a=t.get("objects")?!0:!1,f=a?"ObjectGroup":"ObjectView",l=u.length?u[0].get("value"):f,c=Upfront.Views[l]?Upfront.data.object_views[t.cid]||new Upfront.Views[l]({model:t}):!1,h=t.get_wrapper_id(),p=o&&h?o.get_by_wrapper_id(h):!1,d,v;if(o&&!p)return;c&&(c.parent_view=this,c.parent_module_view&&(c._previous_parent_module_view=c.parent_module_view),this.object_group_view?(c.object_group_view=this.object_group_view,c.parent_module_view=this.object_group_view.parent_module_view):c.parent_module_view=this.parent_view,p?(this.current_wrapper_id==h?v=this.current_wrapper_el:(d=Upfront.data.wrapper_views[p.cid],d?d.parent_view=this:(d=new Upfront.Views.Wrapper({model:p}),d.parent_view=this,d.render()),v=d.el,this.current_wrapper_view=d),this.current_wrapper_id=h,this.current_wrapper_el=v,this.current_wrapper_view&&(c.wrapper_view=this.current_wrapper_view),d&&(i===-2?r.append(v):i===-1?r.prepend(v):s.closest(".upfront-wrapper").after(v),Upfront.data.wrapper_views[p.cid]||(Upfront.data.wrapper_views[p.cid]=d)),s!==!1?s.closest(".upfront-wrapper").get(0)==v?s.after(c.el):e(v).prepend(c.el):i===-1?e(v).prepend(c.el):e(v).append(c.el),c.render()):(i===-2?r.append(c.el):i===-1?r.prepend(c.el):s.parent().after(c.el),c.render()),Upfront.data.object_views[t.cid]?c.delegateEvents():(this.listenTo(c,"upfront:entity:activate",this.on_activate),this.listenTo(c.model,"remove",this.deactivate),Upfront.data.object_views[t.cid]=c)),Upfront.Events.trigger("entity:objects:render_object",c,c.model,this,this.model)},rerender_objects:function(){this.model.each(function(e){var t=Upfront.data.object_views[e.cid];if(!t)return;t.render()})},apply_flexbox_clear:function(){this.fix_flexbox_clear(this.$el)},apply_wrapper_height:function(){if(!Upfront.Application.layout_ready)return;if(!this.object_group_view)return;var e=this.object_group_view.parent_module_view;if(e.region_view&&e.region_view.model.get("name")=="shadow")return;var t=Upfront.Behaviors.GridEditor,n=Upfront.Views.breakpoints_storage.get_breakpoints().get_active().toJSON(),r=this.object_group_view.model.get("wrappers"),i=n.default?t.get_class_num(e.$el.find(">.upfront-module"),t.grid.class):e.model.get_breakpoint_property_value("col");this.fix_wrapper_height(this.model,r,i)},apply_adapt_to_breakpoints:function(){var e=Upfront.Settings.LayoutEditor.CurrentBreakpoint;if(e&&!e.default)return;if(!this.object_group_view)return;var t=this.object_group_view.parent_module_view;if(t.region_view&&t.region_view.model.get("name")=="shadow")return;var n=this,r=Upfront.Behaviors.GridEditor,i=this.object_group_view.model.get("wrappers"),s=Upfront.Views.breakpoints_storage.get_breakpoints().get_enabled();_.each(s,function(e){var s=e.toJSON();if(s.default)return;var o=r.get_class_num(t.$el,r.grid.class),u=t.model.get_property_value_by_name("breakpoint");_.isObject(u)&&_.isObject(u[s.id])&&!_.isUndefined(u[s.id].col)&&(o=u[s.id].col),r.adapt_to_breakpoint(n.model,i,s.id,o,!0)})},on_after_layout_render:function(){this.apply_wrapper_height(),this.apply_adapt_to_breakpoints(),this.listenTo(Upfront.Events,"upfront:layout_size:change_breakpoint",this.apply_wrapper_height)},on_wrappers_update:function(e){if(_.isObject(e)&&e.get("objects")!=this.model)return;this.model.each(function(e){var t=Upfront.data.object_views[e.cid];if(!t)return;t.update_position()}),this.apply_wrapper_height()},on_wrapper_resize:function(e,t){if(e.parent_view&&e.parent_view!=this)return;this.apply_wrapper_height(),this.apply_adapt_to_breakpoints()},on_object_refresh:function(e){if(!this.object_group_view)return;if(e.parent_view&&e.parent_view!=this)return;this.apply_wrapper_height()},on_add:function(e,t,n){var r=typeof n.update!="undefined"?n.update:!0;this.current_wrapper_id=this.current_wrapper_el=null,this.render_object(e,n),r&&(this.apply_wrapper_height(),this.apply_adapt_to_breakpoints()),Upfront.Events.trigger("entity:added:after")},on_remove:function(e,t,n){var r=typeof n.update!="undefined"?n.update:!0;this.remove_model(e),r&&(this.apply_wrapper_height(),this.apply_adapt_to_breakpoints())},remove_model:function(e){var t=Upfront.data.object_views[e.cid];if(!t)return;t.unbind(),t.remove(),delete Upfront.data.object_views[e.cid]},on_reset:function(e,t){var n=this;t&&t.call_render&&(_.each(t.call_render,function(t){var r=e.indexOf(t);n.render_object(t,{index:r})}),this.apply_wrapper_height(),this.apply_adapt_to_breakpoints())},on_change_breakpoint:function(e){var t=this;setTimeout(function(){t.apply_wrapper_height()},1e3)},remove:function(){this.model&&this.model.each(function(e){var t=Upfront.data.object_views[e.cid];t&&(t.remove(),delete Upfront.data.object_views[e.cid])}),this.parent_view=!1,Backbone.View.prototype.remove.call(this),this.model&&(this.model.reset([],{silent:!0}),this.model=!1)}}),S=c.extend({interaction:!0,lock_interaction:!1,className:"upfront-module-view",events:{"click .upfront-module > .upfront-entity_meta > a.upfront-entity-settings_trigger":"on_settings_click","click .upfront-module > .upfront-entity_meta > a.upfront-entity-delete_trigger":"on_delete_click","click .upfront-module > .upfront-entity_meta > a.upfront-entity-hide_trigger":"on_hide_click","click .upfront-module-hidden-toggle > a.upfront-entity-hide_trigger":"on_hide_click","click .upfront-module > .upfront-entity_meta":"on_meta_click",click:"on_click"},initialize:function(){var e=this.update||this.render;this.listenTo(this.model.get("properties"),"change",e),this.listenTo(this.model.get("properties"),"add",e),this.listenTo(this.model.get("properties"),"remove",e),this.listenTo(Upfront.Events,"command:region:edit_toggle",this.on_region_edit),this.listenTo(Upfront.Events,"command:region:fixed_edit_toggle",this.on_region_edit),this.on("on_layout",this.render_new_object,this),this.on("region:updated",this.on_region_update,this),this.listenTo(Upfront.Events,"upfront:layout_size:change_breakpoint",this.on_change_breakpoint),this.listenTo(Upfront.Events,"entity:wrapper:update_position",this.on_wrapper_update),this.listenTo(Upfront.Events,"layout:render",this.on_after_layout_render)},render:function(){var e=Upfront.Settings.LayoutEditor.CurrentBreakpoint,t=Upfront.Settings.LayoutEditor.Grid,n={},r=typeof this.group_view!="undefined",s=this.model.get("properties").each(function(e){n[e.get("name")]=e.get("value")}),o=n.row?n.row*Upfront.Settings.LayoutEditor.Grid.baseline:0,u=Upfront.Behaviors.GridEditor.get_class_num(n.class,t.class),a="default_hide"in n?n.default_hide:0,f="hide"in n?n.hide:a,l=_.extend(this.model.toJSON(),{properties:n,height:o,hide:f,parent_group_class:r?"upfront-module-parent-group":""}),c=_.template(i.module,l),h;Upfront.Events.trigger("entity:module:before_render",this,this.model),this.$el.html(c),h=this.$el.find(".upfront-editable_entity:first"),h.data("default_col",u),h.data("current_col",u),e&&!e.default&&this.update_position(),this.model.get("shadow")?h.attr("data-shadow",this.model.get("shadow")):this.render_object(),this.$el.is(".upfront-active_entity")&&this.$el.trigger("upfront-editable_entity-selected",[this.model,this]),Upfront.Events.trigger("entity:module:after_render",this,this.model)},update:function(e,t){var n=e._previousAttributes.value,r=e.get("value"),i=this.$el.find(".upfront-editable_entity:first"),s=Upfront.Settings.LayoutEditor.Grid;if(e.id=="row"){var o=r*s.baseline;i.css("min-height",o).attr("data-row",r)}else if(e.id=="class"){var u=i.attr("class");_.each([s.class,s.left_margin_class,s.top_margin_class,s.bottom_margin_class,s.right_margin_class],function(e){var t=new RegExp("\\b"+e+"(\\d+)"),n=r.match(t);n&&n[1]&&(Upfront.Behaviors.GridEditor.update_class(i,e,n[1]),e==s.class&&(i.data("default_col",parseInt(n[1],10)),i.data("current_col",parseInt(n[1],10))))})}else e.id=="breakpoint"&&this.update_position();Upfront.Events.trigger("entity:module:update",this,this.model)},update_position:function(){var e=Upfront.Settings.LayoutEditor.CurrentBreakpoint,t=Upfront.Settings.LayoutEditor.Grid;if(!e)return;var n=this.$el.find("> .upfront-module"),r=this.$el.find("> .upfront-module-hidden-toggle");this.apply_breakpoint_position(n,r),Upfront.Events.trigger("entity:module:update_position",this,this.model)},render_object:function(){var e=this._objects_view||new E({model:this.model.get("objects")});e.parent_view=this,this.$(".upfront-objects_container").append(e.el),e.render(),this._objects_view?this._objects_view.delegateEvents():this._objects_view=e},render_new_object:function(){this.render_object(),this.model.get("objects").each(function(e){e.set_property("usingNewAppearance",!0)})},disable_interaction:function(e,t,n,r,i){var s=this.$el.find(".upfront-editable_entity:first");e&&t&&s.addClass("upfront-module-disabled-all"),e&&s.addClass("upfront-module-disabled-edit"),t&&s.addClass("upfront-module-disabled-button"),!n&&s.data("ui-resizable")&&s.resizable("option","disabled",!0),!r&&s.data("ui-draggable")&&s.draggable("option","disabled",!0),this.interaction=!1,i&&(this.lock_interaction=!0)},enable_interaction:function(e){if(this.lock_interaction&&!e)return;var t=this.$el.find(".upfront-editable_entity:first");t.removeClass("upfront-module-disabled-all upfront-module-disabled-edit upfront-module-disabled-button"),t.data("ui-resizable")&&t.resizable("option","disabled",!1),t.data("ui-draggable")&&t.draggable("option","disabled",!1),this.interaction=!0,this.lock_interaction=!1},on_click:function(t){var n=this,r=Upfront.Behaviors.LayoutEditor,i=!1,s=this.$el.find(">.upfront-module"),o=Upfront.data.currentEntity,u=o?o.$el.closest(".upfront-module"):!1,a,f,l;this.interaction?t&&t.shiftKey&&this.region_view?(_.each(r.selection,function(t){i||(i=e(t).closest(".upfront-region").get(0)!=n.region_view.$el.get(0))}),i&&r.remove_selections(),f=this.region_view.$el.find(".upfront-module").not(".upfront-ui-selected, .upfront-module-parent-group"),l=this.region_view.$el.find(".upfront-module-group"),r.selection.length>0?(a=this.region_view.$el.find(".upfront-ui-selected"),r._add_selections(a.add(s),f,l)):u!==!1&&u.length>0?(r._add_selection(u.get(0)),a=u,u.get(0)!=s.get(0)&&(a=a.add(s)),a.length>1&&r._add_selections(a,f,l)):r._add_selection(s.get(0)),r._update_selection_outline(),r.selection.length>1&&r.parse_selections(),o&&(o.trigger("deactivated",t),o.$el.removeClass("upfront-active_entity"),Upfront.Events.trigger("entity:deactivated",t),Upfront.data.currentEntity=!1),t.stopPropagation()):(r.remove_selections(),this.constructor.__super__.on_click.call(this,t)):t.stopPropagation()},on_hide_click:function(e){c.prototype.on_hide_click.call(this,e),Upfront.Events.trigger("entity:module:hide_toggle",this,this.model)},on_resize:function(e){},on_drop:function(e){},on_region_update:function(){this._objects_view&&this._objects_view.model.each(function(e){e.trigger("region:updated")})},on_region_edit:function(e){if(Upfront.Application.PostContentEditor==Upfront.Application.current_subapplication)return;e?this.disable_interaction(!0,!0,!1,!1,!0):this.enable_interaction(!0)},on_wrapper_update:function(e,t){if(this.wrapper_view&&e!=this.wrapper_view)return;this.update_position()},on_change_breakpoint:function(e){var t=this.$el.find(".upfront-module > .upfront-entity_meta > a.upfront-entity-delete_trigger"),n=this.$el.find(".upfront-module > .upfront-entity_meta > a.upfront-entity-hide_trigger");e.default?(this.enable_interaction(!0),t.show(),n.hide()):(this.disable_interaction(!0,!1,!0,!0,!0),t.hide(),n.show())},on_after_layout_render:function(){},remove:function(){this._objects_view&&this._objects_view.remove(),Backbone.View.prototype.remove.call(this)}}),x=c.extend({className:"upfront-editable_entity upfront-module-group",id:function(){return this.model.get_property_value_by_name("element_id")},cssSelectors:{".upfront-module-group":{label:t.mg_label,info:t.mg_info},".upfront-module-group-bg":{label:t.mgbg_label,info:t.mgbg_info},".upfront-object, .upfront-output-object":{label:t.mgel_label,info:t.mgel_info}},events:{"click > .upfront-entity_meta > a.upfront-entity-settings_trigger":"on_settings_click","click > .upfront-module-group-toggle-container > .upfront-module-group-ungroup":"on_ungroup","click > .upfront-module-group-toggle-container > .upfront-module-group-reorder":"on_reorder","click > .upfront-module-group-toggle-container > .upfront-module-group-edit":"on_edit","click > .upfront-entity_meta > a.upfront-entity-hide_trigger":"on_hide_click","click > .upfront-module-hidden-toggle > a.upfront-entity-hide_trigger":"on_hide_click","click .open-item-controls":"onOpenItemControlsClick","click > .upfront-module-group-finish-edit":"on_finish",click:"on_click",dblclick:"on_dblclick"},initialize:function(){var e=this.update||this.render;this.listenTo(this.model.get("properties"),"change",e),this.listenTo(this.model.get("properties"),"change",this.handle_visual_padding_hint),this.listenTo(this.model.get("properties"),"add",e),this.listenTo(this.model.get("properties"),"remove",e),this._prev_class=this.model.get_property_value_by_name("class"),this.listenTo(Upfront.Events,"layout:after_render",this.refresh_background),this.listenTo(Upfront.Events,"layout:after_render",this.update_size_hint),this.listenTo(Upfront.Events,"upfront:layout_size:change_breakpoint",this.on_change_breakpoint),this.listenTo(Upfront.Events,"command:module_group:finish_edit",this.on_finish),this.listenTo(Upfront.Events,"command:module_group:close_panel",this.closeControlPanel),this.editing=!1,this.hidden=!1,this.on("entity:resize_stop",this.on_resize,this)},handle_visual_padding_hint:function(e){if(typeof e=="undefined")return;var t=e.get("value");e.id.match(/(top|bottom)_padding_(num|slider)/)&&(e.id.match(/top_padding_(num|slider)/)&&this.show_top_padding_hint(t),e.id.match(/bottom_padding_(num|slider)/)&&this.show_bottom_padding_hint(t))},show_top_padding_hint:function(t){var n=this,r=this.$el.find(".upfront-entity-top-padding-hint");if(!this.top_padding_hint_flag){this.top_padding_hint_flag=!0;return}r.length||(r=e('<div class="upfront-ui upfront-entity-padding-hint upfront-entity-top-padding-hint"></div>').appendTo(this.$el)),r.css({height:t+"px",opacity:1}),clearTimeout(this.top_padding_hint_timer),this.top_padding_hint_timer=setTimeout(function(){n.hide_top_padding_hint()},1e3)},hide_top_padding_hint:function(){this.padding_hint_locked||this.$el.find(".upfront-entity-top-padding-hint").css({opacity:0})},show_bottom_padding_hint:function(t){var n=this,r=this.$el.find(".upfront-entity-bottom-padding-hint");if(!this.bottom_padding_hint_flag){this.bottom_padding_hint_flag=!0;return}r.length||(r=e('<div class="upfront-ui upfront-entity-padding-hint upfront-entity-bottom-padding-hint"></div>').appendTo(this.$el)),r.css({height:t+"px",opacity:1}),clearTimeout(this.bottom_padding_hint_timer),this.bottom_padding_hint_timer=setTimeout(function(){n.hide_bottom_padding_hint()},1e3)},hide_bottom_padding_hint:function(){this.padding_hint_locked||this.$el.find(".upfront-entity-bottom-padding-hint").css({opacity:0})},createPaddingControl:function(){return this.paddingControl=new Upfront.Views.Editor.InlinePanels.PaddingControl({model:this.model}),this.paddingControl.icon="padding",this.paddingControl.tooltip=t.padding_settings,this.paddingControl.default_padding.top=0,this.paddingControl.default_padding.bottom=0,this.paddingControl},onOpenPanelClick:function(e){e.preventDefault(),this.toggleLinkPanel()},onOpenItemControlsClick:function(){this.$el.hasClass("controls-visible")?this.closeControlPanel():this.openControlPanel()},openControlPanel:function(){this.$el.addClass("controls-visible"),this.controlsVisible=!0,this.disable_interaction(!1,!1,!1)},closeControlPanel:function(e){var e=e!==!1;this.$el.removeClass("controls-visible"),this.controlsVisible=!1,e&&this.enable_interaction()},createInlineControlPanel:function(){var n=this.model.get_property_value_by_name("href");n||(n="");var r=this,i=new Upfront.Views.Editor.InlinePanels.ControlPanel,s=new Upfront.Views.Editor.InlinePanels.Controls.VisitLink({url:n,hideIfUnlink:!0,linkLabel:{external:t.visit_link}}),o=new Upfront.Views.Editor.InlinePanels.Controls.GroupLinkPanel({linkUrl:n,linkType:Upfront.Util.guessLinkType(n),linkTarget:this.model.get_property_value_by_name("linkTarget"),button:!1}),u=new Upfront.Views.Editor.InlinePanels.Control({label:t.ungroup,className:"upfront-inline-panel-item ungroup-control"}),a=new Upfront.Views.Editor.InlinePanels.Control({label:t.edit_elements,className:"upfront-inline-panel-item edit-elements-control"});this.listenTo(o,"change change:target",function(e){s.setLink(e.url),this.model.set_property("href",e.url),this.model.set_property("linkTarget",e.target)}),this.listenTo(o,"panel:open panel:close",function(){r.toggleLinkPanel()}),this.listenTo(u,"click",function(e){r.on_ungroup()}),this.listenTo(a,"click",function(e){r.closeControlPanel(!1),r.on_edit()}),i.items=_([o,s,a,u]);var f=e('<div class="upfront-module-group-controls upfront-ui"></div>');this.$el.append(f),i.render(),f.append(i.el),i.delegateEvents(),this.panel=i},toggleLinkPanel:function(){this.$el.toggleClass("control-dialog-open")},render:function(){var e=this,t={},n=this.model.get("properties").each(function(e){t[e.get("name")]=e.get("value")}),r=t.row?t.row*Upfront.Settings.LayoutEditor.Grid.baseline:0,s=_.extend(this.model.toJSON(),{properties:t,height:r,href:""}),o=_.template(i.module_group,s);Upfront.Events.trigger("entity:module_group:before_render",this,this.model);var u=this.model.get_property_value_by_name("anchor");u&&u.length&&(this.el.id=u);var a=this.model.get_breakpoint_property_value("theme_style",!0);a&&(this.$el.addClass(a.toLowerCase()),this._theme_style=a),this.$el.html(o+'<span class="open-item-controls"></span>'),this.$bg=this.$el.find(".upfront-module-group-bg"),this.update();var f=this._modules_view||new T({model:this.model.get("modules")});f.region_view=this.region_view,f.group_view=this,this.$el.find("> .upfront-modules_container").append(f.el),f.render(),this.apply_paddings(this.$el.find("> .upfront-modules_container")),this._modules_view?this._modules_view.delegateEvents():this._modules_view=f,this.createInlineControlPanel(),this.create_size_hint(this.$el),this.$control_el=this.$el,this.updateControls(),setTimeout(function(){e.paddingControl&&typeof e.paddingControl.isOpen!="undefined"&&!e.paddingControl.isOpen&&e.paddingControl.refresh()},300),Upfront.Events.trigger("entity:module_group:after_render",this,this.model)},update:function(e){var t=Upfront.Settings.LayoutEditor.CurrentBreakpoint,n=this.model.get_property_value_by_name("class"),r=this.model.get_property_value_by_name("row"),i=this.model.get_breakpoint_property_value("use_padding",!0),s=this.model.get_breakpoint_property_value("theme_style",!0),o=Upfront.Settings.LayoutEditor.Grid,u=Upfront.Behaviors.GridEditor,a=u.get_class_num(n,o.class),f,l;Upfront.Application.layout_ready&&(f=!t||t.default?u.get_class_num(this._prev_class,o.class):this.$el.data("breakpoint_col"),l=!t||t.default?u.get_class_num(n,o.class):this.model.get_breakpoint_property_value("col")),this.$el.removeClass(this._prev_class).addClass(n),this.$el.data("default_col",a),this.$el.data("current_col",a),this._prev_class=n,s&&(this.$el.removeClass(this._theme_style).addClass(s.toLowerCase()),this._theme_style=s),this.$el.css("min-height",r*o.baseline+"px").attr("data-row",r),this.$bg.toggleClass("upfront-module-group-bg-padding",i?!0:!1),this.update_position(),this.update_background(),Upfront.Application.layout_ready&&e&&(e.id=="class"||e.id=="breakpoint")&&f!=l&&this.normalize_child_modules(f),Upfront.Events.trigger("entity:module_group:update",this,this.model)},update_position:function(){var e=Upfront.Settings.LayoutEditor.CurrentBreakpoint,t=Upfront.Settings.LayoutEditor.Grid;this.apply_paddings(this.$el.find("> .upfront-modules_container"));if(!e)return;var n=this.$el.find("> .upfront-module-hidden-toggle"),r=this.model.get_breakpoint_property_value("hide",!0);this.apply_breakpoint_position(this.$el,n,["hide"]),r?(this.hidden=!0,this.$el.addClass("upfront-module-group-hidden"),n.show(),this.disable_interaction(!0,!1,!1)):(this.hidden=!1,this.$el.removeClass("upfront-module-group-hidden"),n.hide(),this.enable_interaction(),this.model.get("modules").each(function(e){var t=Upfront.data.module_views?Upfront.data.module_views[e.cid]:!1;if(!t)return;t.update_position()}));var i=this.model.get_breakpoint_property_value("theme_style",!0);this._theme_style&&this.$el.removeClass(this._theme_style.toLowerCase()),i&&(this.$el.addClass(i.toLowerCase()),this._theme_style=i),this.update_size_hint(),Upfront.Events.trigger("entity:module_group:update_position",this,this.model)},normalize_child_modules:function(e){if(!this._modules_view)return;var t=Upfront.Views.breakpoints_storage.get_breakpoints().get_active().toJSON(),n=Upfront.Behaviors.GridEditor,r=!t||t.default?n.get_class_num(this.$el,n.grid.class):this.$el.data("breakpoint_col");this._modules_view.normalize_child_modules(r,e,this.model.get("wrappers"))},on_settings_click:function(e){typeof e!="undefined"&&e.preventDefault();var n=Upfront.Views.Editor.BgSettings.Settings.extend({bg_title:t.group_settings,enable_types:["color","image"]});Upfront.Events.trigger("entity:settings:activate",this,n)},on_ungroup:function(){var e=this,t=Upfront.Behaviors.GridEditor,n=Upfront.Views.breakpoints_storage.get_breakpoints().get_active().toJSON(),r=t.get_class_num(this.$el,t.grid.class),i=this.model.get_breakpoint_property_value("top_padding_use",!0),s=this.model.get_breakpoint_property_value("top_padding_num",!0),o=i&&s!==!1?s:0,u=this.$el.closest(".upfront-wrapper"),a=Upfront.Util.find_sorted(u.parent(),"> .upfront-wrapper:visible"),f=u.hasClass("clr"),l=this.model.get_wrapper_id(),c=this.model.get("modules"),h=this.model.get("wrappers"),p=this.region,d=this.region_view.model.get("modules"),v=this.region_view.model.get("wrappers"),m=v.get_by_wrapper_id(l),g=Upfront.data.wrapper_views[m.cid],y=d.indexOf(this.model),b=t.parse_modules_to_lines(d,v,n.id,n.columns),w=t.parse_modules_to_lines(c,h,n.id,r),E=c.map(function(e){return e}),S=[],x,T,N,C,k=0,L=[],A=!1,O=[],M=[],D=0,P=0;this.toggle_modules_interaction(!0,!0),t.start(this,this.model),_.each(b,function(t){if(x)return;N=!1,C=!1,_.each(t.wrappers,function(n){T&&!C&&(C=n),_.each(n.modules,function(r){e.model==r.model&&(T=n,x=t)}),T||(N=n)})});if(!x)return;_.each(x.wrappers,function(e){e.spacer&&S.push(e)});if(T.modules.length>1||x.wrappers.length-S.length>1)A=!0,T.modules.length==1&&w.length==1&&(A=!1);A&&T.modules.length==1&&(_.each(w,function(e,t){_.each(e.wrappers,function(t,n){n==0&&(t.spacer?O.push(t.col):O.push(0)),n==e.wrappers.length-1&&(t.spacer?M.push(t.col):M.push(0))})}),D=_.min(O),P=_.min(M)),_.each(w,function(n,i){_.each(n.wrappers,function(s,u){var a=Upfront.data.wrapper_views[s.model.cid],p=[],m=[];_.each(s.modules,function(n,s){var u=Upfront.data.module_views[n.model.cid],a=u.$el.find("> .upfront-editable_entity"),f=a.is(":visible"),c=n.model.get("objects").first(),h=r,d=!1;f?(A&&(n.spacer?d=!0:(D>0&&N&&N.spacer&&(h-=D),P>0&&C&&C.spacer&&(h-=P),t.update_model_margin_classes(a,[t.grid.class+h]),n.model.set_property("wrapper_id",l))),i==0&&s==0&&!n.spacer&&e._update_padding("top",c,o)):d=!0,delete u.group_view,d?p.push({model:n.model}):(m.push({model:n.model,index:y+k}),k++)}),A||(u==0&&(f?s.model.add_class("clr"):s.model.remove_class("clr"),N&&N.spacer&&(s.spacer?(s.modules[0].model.replace_class(t.grid.class+(s.col+N.col)),s.model.replace_class(t.grid.class+(s.col+N.col))):L.push({view:a,position:"left",col:N.col,wrapper_col:s.col+N.col}))),u==n.wrappers.length-1&&C&&C.spacer&&(s.spacer?(s.modules[0].model.replace_class(t.grid.class+(s.col+C.col)),s.model.replace_class(t.grid.class+(s.col+C.col))):L.push({view:a,position:"right",col:C.col,wrapper_col:s.col+C.col}))),_.each(p,function(e){c.remove(e.model)}),h.remove(s.model,{silent:!0}),m.length>0&&(A||v.add(s.model,{silent:!0}),_.each(m,function(e){c.remove(e.model,{silent:!0}),e.model.add_to(d,e.index,{update:!1})}))})}),A?(D>0&&(N&&N.spacer?(N.modules[0].model.replace_class(t.grid.class+(N.col+D)),N.model.replace_class(t.grid.class+(N.col+D))):g.add_spacer("left",D,r)),P>0&&(C&&C.spacer?(C.modules[0].model.replace_class(t.grid.class+(C.col+P)),C.model.replace_class(t.grid.class+(C.col+P))):g.add_spacer("right",P,r-D))):(N&&N.spacer&&(v.remove(N.model),d.remove(N.modules[0].model,{update:!1})),C&&C.spacer&&(v.remove(C.model),d.remove(C.modules[0].model,{update:!1})),_.each(L,function(e){e.view.add_spacer(e.position,e.col,e.wrapper_col)}),v.remove(m)),d.remove(this.model),t.update_position_data(u.closest(".upfront-editable_entities_container")),t.update_wrappers(p),Upfront.Events.trigger("entity:module_group:ungroup",E,p)},_update_padding:function(e,t,n){var r=t.get_breakpoint_property_value(e+"_padding_use",!0),i=t.get_breakpoint_property_value(e+"_padding_num",!0),s=Upfront.Views.breakpoints_storage.get_breakpoints().get_active().get("column_padding");if(n===0)return;t.set_breakpoint_property(e+"_padding_use","yes"),i!==!1?t.set_breakpoint_property(e+"_padding_num",parseInt(i,10)+parseInt(n,10)):t.set_breakpoint_property(e+"_padding_num",parseInt(s,10)+parseInt(n,10))},on_reorder:function(){Upfront.Events.trigger("command:module_group:finish_edit"),Upfront.Events.trigger("command:object_group:finish_edit");var t=e(Upfront.Settings.LayoutEditor.Selectors.main);t.addClass("upfront-module-group-editing"),this.$el.addClass("upfront-module-group-on-edit"),this.editing=!0,this.disable_interaction(!1,!1),this.toggle_modules_interaction(!0,!1),Upfront.Events.trigger("entity:module_group:edit",this,this.model)},on_edit:function(){Upfront.Events.trigger("command:module_group:finish_edit"),Upfront.Events.trigger("command:object_group:finish_edit");var t=e(Upfront.Settings.LayoutEditor.Selectors.main);t.addClass("upfront-module-group-editing"),this.wrapper_view&&this.wrapper_view.$el.addClass("upfront-wrapper-module-group-on-edit"),this.$el.addClass("upfront-module-group-on-edit"),this.trigger("deactivated"),this.editing=!0,this.disable_interaction(!1,!1,!1),this.toggle_modules_interaction(!0,!0),Upfront.Events.trigger("entity:module_group:edit",this,this.model)},on_finish:function(){if(!this.editing)return;var t=e(Upfront.Settings.LayoutEditor.Selectors.main);t.removeClass("upfront-module-group-editing"),this.wrapper_view&&this.wrapper_view.$el.removeClass("upfront-wrapper-module-group-on-edit"),this.$el.removeClass("upfront-module-group-on-edit"),this.editing=!1,this.enable_interaction(),this.toggle_modules_interaction(!1)},on_resize:function(e){var t=this.model.get("wrappers");t.each(function(e){var t=Upfront.data.wrapper_views[e.cid];if(!t)return;t.update_position()}),this.update_size_hint()},on_dblclick:function(t){if(e("#element-settings-sidebar").html()!==""||e("#settings").html()!=="")return!1;if(this.$el.hasClass("upfront-module-group-on-edit")||this.$el.hasClass("upfront-module-group-disabled"))return;this.closeControlPanel(!1),this.on_edit()},on_hide_click:function(e){c.prototype.on_hide_click.call(this,e),this.closeControlPanel(!1),this.deactivate(),e.stopPropagation(),Upfront.Events.trigger("entity:module_group:hide_toggle",this,this.model)},disable_interaction:function(e,t,n){e&&this.$el.addClass("upfront-module-group-disabled"),!t&&this.$el.data("ui-resizable")&&this.$el.resizable("option","disabled",!0),!n&&this.$el.data("ui-draggable")&&this.$el.draggable("option","disabled",!0)},enable_interaction:function(){if(this.editing||this.hidden)return;this.$el.removeClass("upfront-module-group-disabled"),this.$el.data("ui-resizable")&&this.$el.resizable("option","disabled",!1),this.$el.data("ui-draggable")&&this.$el.draggable("option","disabled",!1)},toggle_modules_interaction:function(e,t){var t=t===!0?!0:!1;this.model.get("modules").each(function(n){var r=Upfront.data.module_views?Upfront.data.module_views[n.cid]:!1;r&&(e?(r.enable_interaction(!0),r.disable_interaction(!t,!1,!0,!0,!t)):r.disable_interaction(!0,!1,!1,!1,!0))})},on_change_breakpoint:function(e){var t=this.$el.find("> .upfront-entity_meta > a.upfront-entity-hide_trigger");e.default?(this.$el.removeClass("upfront-module-group-reorder-mode"),t.hide()):(this.$el.addClass("upfront-module-group-reorder-mode"),t.show()),this.on_finish(),this.update_position(),this.update_background()},deactivate:function(){if(e("#element-settings-sidebar").html()!==""||e("#settings").html()!=="")return!1;Upfront.data.prevEntity=!1,this.$el.removeClass("upfront-module-group-active"),this.check_deactivated(),this.trigger("upfront:entity:deactivate",this)},activate:function(){var e=this,t=Upfront.data.currentEntity;if(this.hidden)return!1;typeof Upfront.data.prevEntity!="undefined"&&Upfront.data.prevEntity!==!1&&Upfront.data.prevEntity.deactivate(),Upfront.data.prevEntity=this;if(this.activate_condition&&!this.activate_condition())return!1;if(t&&t==this)return!1;t&&t!=this&&t.trigger("deactivated"),Upfront.data.currentEntity=this,this.trigger("activated",this),this.trigger("upfront:entity:activate",this),this.listenToOnce(this,"deactivated",this.deactivate),this.$el.addClass("upfront-module-group-active")},remove:function(){this._modules_view&&this._modules_view.remove();var e=this.model.get("wrappers");e&&e.each(function(e){var t=Upfront.data.wrapper_views[e.cid];t&&(t.remove(),delete Upfront.data.wrapper_views[e.cid])}),this.panel&&(this.panel.remove(),this.panel=!1),this.region_view=!1,this.region=!1,Backbone.View.prototype.remove.call(this),this.model.get("wrappers").reset([],{silent:!0}),this.model=!1}}),T=d.extend({className:"upfront-editable_entities_container",init:function(){this.stopListening(this.model,"add",this.render),this.listenTo(this.model,"add",this.on_add),this.stopListening(this.model,"remove",this.render),this.listenTo(this.model,"remove",this.on_remove),this.listenTo(this.model,"reset",this.on_reset),this.listenTo(Upfront.Events,"entity:drag_stop",this.on_drop),this.listenTo(Upfront.Events,"entity:resized",this.on_resize),this.listenTo(Upfront.Events,"entity:wrapper:resized",this.on_wrapper_resize),this.listenTo(Upfront.Events,"entity:wrappers:update",this.on_wrappers_update),this.listenTo(Upfront.Events,"entity:module:hide_toggle",this.on_module_hide),this.listenTo(Upfront.Events,"entity:module_group:hide_toggle",this.on_module_hide),this.listenTo(Upfront.Events,"entity:object:refresh",this.on_object_refresh),this.listenTo(Upfront.Events,"entity:module_group:group",this.on_group),this.listenTo(Upfront.Events,"entity:module_group:ungroup",this.on_ungroup),this.listenTo(Upfront.Events,"layout:after_render",this.on_after_layout_render),this.listenTo(Upfront.Events,"upfront:csseditor:ready",this.on_csseditor_ready),this.listenTo(Upfront.Events,"upfront:layout_size:change_breakpoint",this.on_change_breakpoint)},on_entity_remove:function(e,t){Upfront.Events.trigger("entity:removed:before");var n=t.model.get_wrapper_id(),r=this;if(n){var i=!_.isUndefined(this.group_view),s=i?this.group_view.model.get("wrappers"):this.region_view.model.get("wrappers"),o=s.get_by_wrapper_id(n),u=0;o&&(this.model.each(function(e){e.get_wrapper_id()==n&&u++}),u==1&&(Upfront.Behaviors.GridEditor.normalize_module_remove(t,t.model,this.model,o,s),s.remove(o)))}t.remove(),this.model.remove(t.model),this.normalize_child_spacing(),Upfront.Events.trigger("entity:removed:after")},render:function(){this.$el.html("");var e=this.$el,t=this;this.current_wrapper_view=null,this.current_wrapper_id=null,this.current_wrapper_el=null,Upfront.Events.trigger("entity:modules:before_render",this,this.model),typeof Upfront.data.module_views=="undefined"&&(Upfront.data.module_views={}),typeof Upfront.data.wrapper_views=="undefined"&&(Upfront.data.wrapper_views={}),this.model.each(function(e){t.render_module(e)}),this.apply_flexbox_clear(),this.apply_wrapper_height(),Upfront.Events.trigger("entity:modules:after_render",this,this.model)},render_module:function(t,n){var r=this.$el,i=n&&typeof n.index!="undefined"?n.index-1:-2,s=i>=0?r.find("> .upfront-wrapper > .upfront-module-view, > .upfront-wrapper > .upfront-module-group").eq(i):!1,o=t.get("modules")?"ModuleGroup":"Module",u=t.get("properties").where({name:"view_class"}),a=u.length?u[0].get("value"):o,f=Upfront.Views[a]?Upfront.data.module_views[t.cid]||new Upfront.Views[a]({model:t}):!1,l=(typeof this.group_view!="undefined"?this.group_view:this.region_view).model.get("wrappers"),c=t.get_wrapper_id(),h=l&&c?l.get_by_wrapper_id(c):!1,p,d;f&&(f.parent_view=this,f.region_view=this.region_view,f.region=this.region_view.model,this.group_view&&(f.group_view=this.group_view),h?(this.current_wrapper_id==c?d=this.current_wrapper_el:(p=Upfront.data.wrapper_views[h.cid],p?p.parent_view=this:(p=new Upfront.Views.Wrapper({model:h}),p.parent_view=this,p.render()),d=p.el,this.current_wrapper_view=p),this.current_wrapper_id=c,this.current_wrapper_el=d,this.current_wrapper_view&&(f.wrapper_view=this.current_wrapper_view),p&&(i===-2?r.append(d):i===-1?r.prepend(d):s.closest(".upfront-wrapper").after(d),Upfront.data.wrapper_views[h.cid]||(Upfront.data.wrapper_views[h.cid]=p)),s!==!1?s.closest(".upfront-wrapper").get(0)==d?s.after(f.el):e(d).prepend(f.el):i===-1?e(d).prepend(f.el):e(d).append(f.el),f.render()):(f.render(),i===-2?r.append(f.el):i===-1?r.prepend(f.el):s.parent().after(f.el)),Upfront.data.module_views[t.cid]?f.delegateEvents():(this.listenTo(f,"upfront:entity:activate",this.on_activate),this.listenTo(f.model,"remove",this.deactivate),Upfront.data.module_views[t.cid]=f)),Upfront.Events.trigger("entity:modules:render_module",f,f.model,this,this.model)},on_wrappers_update:function(e){if(_.isObject(e)&&e.get("modules")!=this.model)return;this.model.each(function(e){var t=Upfront.data.module_views[e.cid];if(!t)return;t.update_position()}),this.apply_flexbox_clear(),this.apply_wrapper_height()},on_drop:function(e,t){if(e.parent_view&&e.parent_view!=this)return;this.apply_wrapper_height(),this.apply_adapt_to_breakpoints()},on_resize:function(e,t){if(e.parent_view&&e.parent_view!=this)return;this.apply_wrapper_height(),this.apply_adapt_to_breakpoints()},on_wrapper_resize:function(e,t){if(e.parent_view&&e.parent_view!=this)return;this.apply_wrapper_height(),this.apply_adapt_to_breakpoints()},on_module_hide:function(e,t){if(e.parent_view&&e.parent_view!=this)return;this.apply_wrapper_height(),this.apply_adapt_to_breakpoints()},on_object_refresh:function(e){if(!e.parent_module_view)return;if(e.parent_module_view.parent_view&&e.parent_module_view.parent_view!=this)return;this.apply_wrapper_height()},on_add:function(e,t,n){var r=typeof n.update!="undefined"?n.update:!0;this.current_wrapper_id=this.current_wrapper_el=null,this.render_module(e,n),r&&(this.apply_wrapper_height(),this.apply_adapt_to_breakpoints()),Upfront.Events.trigger("entity:added:after")},on_remove:function(e,t,n){var r=typeof n.update!="undefined"?n.update:!0;this.remove_model(e),r&&(this.apply_wrapper_height(),this.apply_adapt_to_breakpoints())},remove_model:function(e){var t=Upfront.data.module_views[e.cid];if(!t)return;t.unbind(),t.remove(),delete Upfront.data.module_views[e.cid]},on_reset:function(e,t){var n=this;t&&t.call_render&&(_.each(t.call_render,function(t){var r=e.indexOf(t);n.render_module(t,{index:r})}),this.apply_flexbox_clear(),this.apply_wrapper_height(),this.apply_adapt_to_breakpoints())},on_after_layout_render:function(){var e=this;this.apply_flexbox_clear(),this.apply_adapt_to_breakpoints(),this.normalize_child_spacing(),setTimeout(function(){e.apply_wrapper_height()},1e3)},on_csseditor_ready:function(){},apply_flexbox_clear:function(){this.fix_flexbox_clear(this.$el)},apply_wrapper_height:function(){if(!Upfront.Application.layout_ready)return;if(!this.region_view||this.region_view.model.get("name")=="shadow")return;var e=Upfront.Behaviors.GridEditor,t=Upfront.Views.breakpoints_storage.get_breakpoints().get_active().toJSON(),n=!_.isUndefined(this.group_view),r=(n?this.group_view:this.region_view).model.get("wrappers"),i=t.default?e.get_class_num((n?this.group_view:this.region_view).$el,e.grid.class):(n?this.group_view:this.region_view).model.get_breakpoint_property_value("col");this.model.each(function(e){var t=Upfront.data.module_views[e.cid];if(!t||!t._modules_view)return;t._modules_view.apply_wrapper_height()}),this.fix_wrapper_height(this.model,r,i)},apply_adapt_to_breakpoints:function(){var e=Upfront.Settings.LayoutEditor.CurrentBreakpoint;if(e&&!e.default)return;if(this.region_view&&this.region_view.model.get("name")=="shadow")return;var t=this,n=Upfront.Behaviors.GridEditor,r=typeof this.group_view!="undefined",i=(r?this.group_view:this.region_view).model.get("wrappers"),s=Upfront.Views.breakpoints_storage.get_breakpoints().get_enabled();_.each(s,function(e){var s=e.toJSON();if(s.default)return;if(r){var o=n.get_class_num(t.group_view.$el,n.grid.class),u=t.group_view.model.get_property_value_by_name("breakpoint");_.isObject(u)&&_.isObject(u[s.id])&&!_.isUndefined(u[s.id].col)&&(o=u[s.id].col)}var a=r?o:s.columns;n.adapt_to_breakpoint(t.model,i,s.id,a,!0)})},on_group:function(e){if(typeof this.group_view=="undefined"||e.cid!=this.group_view.model.cid)return;this.reset_breakpoints(this.model.map(function(e){return e}))},on_ungroup:function(e){if(e&&e[0]&&!this.model.find(function(t){return t.cid==e[0].cid}))return;this.reset_breakpoints(e)},reset_breakpoints:function(e){_.each(e,function(e){var t=Upfront.Util.clone(e.get_property_value_by_name("breakpoint")||{});_.each(t,function(e,n){t[n].edited=!1}),e.set_property("breakpoint",t,!0)}),this.apply_adapt_to_breakpoints()},on_change_breakpoint:function(e){var t=this;setTimeout(function(){t.apply_flexbox_clear(),t.apply_wrapper_height()},1e3)},remove:function(){var e=this;this.model.each(function(t){e.remove_model(t)}),this.region_view=!1,this.group_view=!1,Backbone.View.prototype.remove.call(this),this.model.reset([],{silent:!0}),this.model=!1}}),N=l.extend({cssSelectors:{".upfront-region-container-bg":{label:t.region_container_label,info:t.region_container_info},".upfront-region-center":{label:t.main_content_label,info:t.main_content_info},".upfront-region-side-left":{label:t.lsr_label,info:t.lsr_info},".upfront-region-side-right":{label:t.rsr_label,info:t.rsr_info}},events:{"click > .upfront-region-edit-trigger":"trigger_edit","click > .upfront-region-edit-fixed-trigger":"trigger_edit_fixed","click > .upfront-region-finish-edit":"finish_edit",contextmenu:"on_context_menu",mouseover:"on_mouse_over"},attributes:function(){var e=(this.model.get("container")||this.model.get("name")).toLowerCase().replace(/\s/g,"-"),t=[];return t.push("upfront-region-container"),t.push("upfront-region-container-"+e),t.push("upfront-region-container-"+this._get_region_type()),_.isObject(this.model.collection)&&this.model.collection.active_region==this.model&&t.push("upfront-region-container-active"),{"class":t.join(" "),id:"region-container-"+e}},_get_region_type:function(){return this.model.get("type")||(this.model.get("clip")?"clip":"wide")},_get_previous_region_type:function(){return this.model.previous("type")||(this.model.previous("clip")?"clip":"wide")},on_mouse_over:function(){var t=e(Upfront.Settings.LayoutEditor.Selectors.main);t.hasClass("upfront-region-fixed-editing")&&this.trigger("activate_region",this)},remove_context_menu:function(t){if(!this.context_menu_view)return!1;e(Upfront.Settings.LayoutEditor.Selectors.contextmenu).html("").hide(),this.context_menu_view=!1},on_context_menu:function(t){if(e(t.target).closest(".upfront-inline-modal-content").length>0){t.stopPropagation();return}if(Upfront.Settings.Application.no_context_menu)return;t.preventDefault(),this.event=t;if(this.context_menu_view)return this.context_menu_view.render();var n=new this.ContextMenu({model:this.model,el:e(Upfront.Settings.LayoutEditor.Selectors.contextmenu)});return n.for_view=this,this.context_menu_view=n,this.context_menu_view.render()},init:function(){var n=this,r=Upfront.Views.ContextMenuList.extend({initialize:function(){this.menuitems=_([new Upfront.Views.ContextMenuItem({get_label:function(){var n=e(Upfront.Settings.LayoutEditor.Selectors.main);return n.hasClass("upfront-region-editing")?t.finish_editing:t.edit_background},action:function(){var t=e(Upfront.Settings.LayoutEditor.Selectors.main);t.hasClass("upfront-region-editing")?n.close_edit():n.trigger_edit(n.event)}}),new Upfront.Views.ContextMenuItem({get_label:function(){return t.add_floating_region},action:function(t,r){function S(e,t){var n="animationend.fixed_region_ani webkitAnimationEnd.fixed_region_ani MSAnimationEnd.fixed_region_ani oAnimationEnd.fixed_region_ani";g=setTimeout(x,2e3),e.$el.addClass("upfront-add-region-ani upfront-add-region-ani-"+E+"-"+w),e.$el.one(n,function(){x(e),clearTimeout(g),e.$el.off(n)})}function x(e){e.$el.removeClass("upfront-add-region-ani upfront-add-region-ani-"+E+"-"+w),Upfront.Events.trigger("command:region:fixed_edit_toggle",!0)}var i=e(Upfront.Settings.LayoutEditor.Selectors.main),s=n.model.collection,o=s.indexOf(n.model),u=n.model.get_sub_region("fixed"),a=n.model.get("title")+" Floating "+(u.length+1),f=a.toLowerCase().replace(/\s/g,"-"),l=new Upfront.Models.Region(_.extend(_.clone(Upfront.data.region_default_args),{name:f,container:n.model.get("name"),title:a,type:"fixed",sub:"fixed",scope:n.model.get("scope")})),c=n.$el.offset(),h=n.$el.width(),p=n.$el.height(),d=e(window).height(),v=225,m=225,g,y,b,w,E;l.set_property("width",v),l.set_property("height",m),r.pageX>c.left+h/2?(y=c.left+h-r.pageX-Math.floor(v/2),w="right"):(y=r.pageX-c.left-Math.floor(v/2),w="left"),p>=d&&r.clientY>d/2?(b=d-r.clientY-Math.floor(m/2),E="bottom"):(b=r.clientY-Math.floor(m/2),E="top"),y=y>0?y:0,b=b>0?b:0,l.set_property(w,y),l.set_property(E,b),l.set_property("background_type","color"),l.set_property("background_color","#aeb8c2"),Upfront.Events.once("entity:region:added",S,this),l.add_to(s,o+1,{sub:"fixed"}),i.hasClass("upfront-region-fixed-editing")||n.trigger_edit_fixed(n.event)}})])}});this.ContextMenu=Upfront.Views.ContextMenu.extend({initialize:function(){this.menulists=_([new r])}});var i=Upfront.Settings.LayoutEditor.Grid,s=this.model.get_property_value_by_name("width");this.sub_model=[],this.max_col=s?Upfront.Util.width_to_col(s):i.size,this.available_col=this.max_col,this.listenTo(this.model.get("properties"),"change",this.update),this.listenTo(this.model.get("properties"),"add",this.update),this.listenTo(this.model.get("properties"),"remove",this.update),this.listenTo(Upfront.Events,"entity:region:activated",this.update_pos),this.listenTo(Upfront.Events,"entity:region:activated",this.update_overlay),this.listenTo(Upfront.Events,"entity:region:deactivated",this.close_edit),this.listenTo(Upfront.Events,"layout:after_render",this.fix_height),this.listenTo(Upfront.Events,"entity:resize_stop",this.fix_height),this.listenTo(Upfront.Events,"entity:region:resize_stop",this.fix_height),this.listenTo(Upfront.Events,"entity:region_container:resize_stop",this.fix_height),this.listenTo(Upfront.Events,"entity:region_container:resize_stop",this.update_overlay),this.listenTo(Upfront.Events,"entity:drag_stop",this.fix_height),this.listenTo(Upfront.Events,"entity:drag:drop_change",this.refresh_background),this.listenTo(Upfront.Events,"sidebar:toggle:done",this.refresh_background),this.listenTo(Upfront.Events,"entity:navigation:responsive_open",this.refresh_background),this.listenTo(Upfront.Events,"entity:navigation:responsive_close",this.refresh_background),this.listenTo(Upfront.Events,"entity:region:added",this.fix_height),this.listenTo(Upfront.Events,"entity:region:removed",this.on_region_remove),this.listenTo(Upfront.Events,"entity:region:hide_toggle",this.on_region_hide),this.listenTo(Upfront.Events,"entity:module_group:group",this.fix_height),this.listenTo(Upfront.Events,"entity:module_group:ungroup",this.fix_height),this.listenTo(Upfront.Events,"upfront:layout:contained_region_width",this.on_contained_width_change),this.listenTo(Upfront.Events,"layout:after_render",this.update_pos),this.listenTo(Upfront.Events,"sidebar:toggle:done",this.update_pos),this.listenTo(Upfront.Events,"application:mode:after_switch",this.update_pos),e(window).on("scroll.region_container_"+this.model.get("name"),this,this.on_scroll),e(window).on("resize.region_container_"+this.model.get("name"),this,this.on_window_resize),this.listenTo(Upfront.Events,"upfront:layout_size:change_breakpoint",this.on_change_breakpoint),this.listenTo(Upfront.Events,"entity:contextmenu:deactivate",this.remove_context_menu),this.lazyFixHeight=_.debounce(this.fix_height,1e3)},render:function(){var n=Upfront.Settings.LayoutEditor.Grid,r=this._get_region_type(),s=_.extend(this.model.toJSON(),{size_class:n.class,max_col:this.max_col,available_col:this.available_col}),o=_.template(i.region_container,s),u=e('<div class="upfront-region-edit-trigger upfront-ui" title="'+t.change_background+'"><i class="upfront-icon upfront-icon-region-edit"></i></div>'),a=e('<div class="upfront-region-finish-edit upfront-ui"><i class="upfront-field-icon upfront-field-icon-tick"></i> '+t.finish_edit_bg+"</div>");Upfront.Events.trigger("entity:region_container:before_render",this,this.model),this.$el.html(o),this.$bg=this.$el.find(".upfront-region-container-bg"),this.$layout=this.$el.find(".upfront-grid-layout"),u.appendTo(this.$el),a.appendTo(this.$el),this.update(),this.$el.append('<div class="upfront-region-active-overlay" />'),Upfront.Events.trigger("entity:region_container:after_render",this,this.model)},update:function(){var e=this,t=Upfront.Settings.LayoutEditor.Grid,n=(this.model.get("container")||this.model.get("name")).toLowerCase().replace(/\s/g,"-"),r=(this.model.previous("container")||this.model.previous("name")).toLowerCase().replace(/\s/g,"-"),i=this.model.get_property_value_by_name("expand_lock"),s=this._get_region_type(),o=this._get_previous_region_type(),u=Upfront.Views.breakpoints_storage.get_breakpoints().get_default().toJSON(),a=Upfront.Application.layout.get_property_value_by_name("contained_region_width")||u.columns*t.column_width;s=="clip"?this.$bg.css("max-width",a+"px"):this.$bg.css("max-width",""),this.update_background(),o!=s&&(this.$el.removeClass("upfront-region-container-"+o),this.$el.addClass("upfront-region-container-"+s),_.delay(function(){e.fix_height(),e.update_overlay()},500)),r!=n&&(this.$el.removeClass("upfront-region-container-"+r),this.$el.addClass("upfront-region-container-"+n),this.$el.attr("id","region-container-"+n))},render_fixed_panel:function(){this.region_fixed_panels=new Upfront.Views.Editor.RegionFixedPanels({model:this.model}),this.region_fixed_panels.render(),this.$el.append(this.region_fixed_panels.el)},on_change_breakpoint:function(e){var t=Upfront.Settings.LayoutEditor.Grid,n=this;this.$layout.removeClass(t.class+this.max_col),this.max_col=e.columns,this.$layout.addClass(t.class+this.max_col),this.update_background(),setTimeout(function(){n.fix_height()},500)},on_contained_width_change:function(e){var t=this._get_region_type();t=="clip"?this.$bg.css("max-width",e+"px"):this.$bg.css("max-width",""),this.refresh_background()},trigger_edit:function(t){if(Upfront.Application.get_current()==Upfront.Settings.Application.MODE.CONTENT)return!1;var n=e(Upfront.Settings.LayoutEditor.Selectors.main);n.addClass("upfront-region-editing"),this.update_overlay(),Upfront.Events.trigger("command:region:edit_toggle",!0),this.trigger("activate_region",this),this.listenTo(Upfront.Events,"command:newpage:start",this.close_edit),this.listenTo(Upfront.Events,"command:newpost:start",this.close_edit),this.$el.find(".upfront-region-edit-fixed-trigger").show(),Upfront.Application.sidebar.visible&&Upfront.Application.sidebar.toggleSidebar(),t.stopPropagation()},finish_edit:function(e){Upfront.Events.trigger("entity:region:deactivated")},close_edit:function(){var t=e(Upfront.Settings.LayoutEditor.Selectors.main);if(!t.hasClass("upfront-region-editing")&&!t.hasClass("upfront-region-fixed-editing")&&!t.hasClass("upfront-region-lightbox-editing"))return;t.removeClass("upfront-region-editing"),t.removeClass("upfront-region-fixed-editing"),t.removeClass("upfront-region-lightbox-editing"),this.remove_overlay(),Upfront.Events.trigger("command:region:edit_toggle",!1),Upfront.Events.trigger("command:region:fixed_edit_toggle",!1),Upfront.Events.off("command:newpage:start",this.close_edit,this),Upfront.Events.off("command:newpost:start",this.close_edit,this),this.$el.find(".upfront-region-edit-fixed-trigger").hide(),this.$el.find(".upfront-region-edit-lightbox-trigger").hide(),Upfront.Application.sidebar.visible||Upfront.Application.sidebar.toggleSidebar(),e(".upfront-region-container > .upfront-region-finish-edit").css({position:"",left:"",right:""})},trigger_edit_lightbox:function(t){if(Upfront.Application.get_current()==Upfront.Settings.Application.MODE.CONTENT)return!1;var n=this,r=e(Upfront.Settings.LayoutEditor.Selectors.main);r.hasClass("upfront-region-editing")&&this.close_edit(),r.addClass("upfront-region-lightbox-editing"),this.trigger("activate_region",this),Upfront.Events.trigger("command:region:fixed_edit_toggle",!0),setTimeout(function(){e(".upfront-region-container > .upfront-region-finish-edit").each(function(){e(this).css({position:"fixed",left:n.$layout.offset().left+n.$layout.width()-e(this).width(),right:"auto"})})},350)},trigger_edit_fixed:function(){if(Upfront.Application.get_current()==Upfront.Settings.Application.MODE.CONTENT)return!1;var t=this,n=e(Upfront.Settings.LayoutEditor.Selectors.main);n.hasClass("upfront-region-editing")&&this.close_edit(),n.addClass("upfront-region-fixed-editing"),this.trigger("activate_region",this),Upfront.Events.trigger("command:region:fixed_edit_toggle",!0),Upfront.Application.sidebar.visible&&Upfront.Application.sidebar.toggleSidebar(),setTimeout(function(){e(".upfront-region-container > .upfront-region-finish-edit").each(function(){e(this).css({position:"fixed",left:t.$layout.offset().left+t.$layout.width()-e(this).width(),right:"auto"})})},350)},update_overlay:function(){var t=e(Upfront.Settings.LayoutEditor.Selectors.main),n=this.$el.position(),r=e('<div class="upfront-region-editing-overlay" />'),i=e('<div class="upfront-region-editing-overlay" />');if(!t.hasClass("upfront-region-editing"))return;if(this.parent_view.model.active_region!=this.model)return;this.$el.siblings(".upfront-region-editing-overlay").remove(),this.$el.before(r),r.css({bottom:"auto",height:n.top}),this.$el.after(i),i.css({top:n.top+this.$el.height()})},remove_overlay:function(){this.$el.siblings(".upfront-region-editing-overlay").remove()},add_sub_model:function(e){this.sub_model.push(e)},on_scroll:function(e){var t=e.data;t.update_pos()},on_region_render:function(e){},on_region_update:function(e){var t=Upfront.Settings.LayoutEditor.CurrentBreakpoint,n=this.max_col;_.each(this.sub_model,function(e){var t=e.get("sub");if(!t||t=="left"||t=="right")n-=e.get_property_value_by_name("col")});if(!t||t.default)this.trigger("region_resize",n),this.available_col=n;this.fix_height(),this.update_overlay()},on_region_changed:function(){this.fix_height()},on_region_remove:function(e,t){var n=t.get("sub");this.fix_height(),(!n||!n.match(/(top|bottom|left|right)/))&&this.close_edit()},on_region_hide:function(e,t){var n=t.parent_view.get_container_view(t.model);if(this!=n)return;e&&this.$el.find(".upfront-region-center, .upfront-region-side-left, .upfront-region-side-right").not(".upfront-region-hidden").length==0&&this.close_edit()},on_window_resize:function(e){if(e.target!=window||!e.data.model)return;var t=e.data;t.lazyFixHeight()},fix_height:function(){var t=Upfront.Settings.LayoutEditor.CurrentBreakpoint;if(t&&!t.default||this.$layout.css("display").indexOf("flex")!=-1){this.set_full_screen(),this.refresh_background(),this.update_pos();return}var n=this.$el.find(".upfront-region-center, .upfront-region-side-left, .upfront-region-side-right"),r=this.$el.find(".upfront-region-side-top, .upfront-region-side-bottom"),i=n.find("> .upfront-region-wrapper > .upfront-modules_container"),s=0;n.add(i).css({minHeight:"",height:"",maxHeight:""}),this.set_full_screen(),r.each(function(){e(this).find("> .upfront-region-wrapper > .upfront-modules_container").css("min-height",e(this).outerHeight())}),n.each(function(){var t=e(this).outerHeight();s=t>s?t:s}),n.add(i).css("min-height",s),this.refresh_background(),this.update_pos()},set_full_screen:function(){var t=this.$layout.find(".upfront-region-center"),n=this.$bg.find(".upfront-region-side-top, .upfront-region-side-bottom"),r=this.model.get_breakpoint_property_value("row",!0),i=r?r*Upfront.Settings.LayoutEditor.Grid.baseline:0,s=e(window).height();this._get_region_type()=="full"?(this.$bg.children(".upfront-region-bg-overlay").css("height",s),n.each(function(){s-=e(this).outerHeight()}),t.css({minHeight:s}),this.model.set_property("original_height",s,!0)):(this.$bg.children(".upfront-region-bg-overlay").css("height",""),t.css({minHeight:""}),i>0&&t.css("min-height",i),this.model.remove_property("original_height",!0))},update_pos:function(){var t=Upfront.Settings.LayoutEditor.CurrentBreakpoint,n=e(Upfront.Settings.LayoutEditor.Selectors.main),r=this.$el.offset(),i=r.top,s=this.$el.outerHeight(),o=i+s,u=e(document).scrollTop(),a=e(window).height(),f=u+a,l=n.offset(),c=l.top,h=this.$el.find("> .upfront-region-edit-trigger"),p=h.offset(),d=this.model.get("sticky"),v=this.$el.data("sticky-top");u=u<0?0:u,t&&!t.default&&(d=!1),d&&!_.isNumber(v)&&u>i-c&&(this.$el.css({position:"fixed",top:c,left:l.left,right:0,bottom:"auto"}),this.$el.addClass("upfront-region-container-sticky"),this.$el.data("sticky-top",i-c),this.$el.nextAll(".upfront-region-container:first").css("margin-top",this.$el.height())),this.$el.css("position")=="fixed"&&(!d||_.isNumber(v)&&u<=v)&&(this.$el.css({position:"",top:"",left:"",right:"",bottom:""}),this.$el.removeClass("upfront-region-container-sticky"),this.$el.removeData("sticky-top"),this.$el.nextAll(".upfront-region-container:first").css("margin-top",""));if(this._get_region_type()=="full"){var m=this.model.get_breakpoint_property_value("background_type",!0),g=parseInt(this.$layout.find(".upfront-region-center").css("min-height"));u>=i-c&&f<=o?this.$bg.children(".upfront-region-bg-overlay").css("top",u-c):this.$bg.children(".upfront-region-bg-overlay").css("top",s-a)}u>i-c&&u<o-c?h.css("position")!="fixed"&&h.css({position:"fixed",top:c,left:p.left,right:"auto"}):h.css({position:"",top:"",left:"",right:""});if(n.hasClass("upfront-region-editing")&&this.$el.hasClass("upfront-region-container-active")){var y=this.$el.find(".upfront-region-finish-edit"),b=y.offset();o+y.outerHeight()>f&&i<f?y.css("position")!="fixed"&&y.css({position:"fixed",bottom:0,left:b.left,right:"auto"}):y.css({position:"",bottom:"",left:"",right:""})}},remove:function(){e(window).off("scroll.region_container_"+this.model.get("name")),e(window).off("resize.region_container_"+this.model.get("name")),this.context_menu_view&&this.context_menu_view.remove(),this.parent_view=!1,this.event=!1,Backbone.View.prototype.remove.call(this)}}),C=l.extend({attributes:function(){var e=this.model.get("container")||this.model.get("name"),t=this.model.get("sub"),n=[];return n.push("upfront-region-sub-container"),n.push("upfront-region-sub-container-"+e.toLowerCase().replace(/ /,"-")),n.push("upfront-region-sub-container-"+t),{"class":n.join(" ")}},init:function(){this.listenTo(this.model.get("properties"),"change",this.update),this.listenTo(this.model.get("properties"),"add",this.update),this.listenTo(this.model.get("properties"),"remove",this.update),this.listenTo(Upfront.Events,"layout:after_render",this.refresh_background),this.listenTo(Upfront.Events,"entity:resize_stop",this.refresh_background),this.listenTo(Upfront.Events,"entity:region:resize_stop",this.refresh_background),this.listenTo(Upfront.Events,"entity:region_container:resize_stop",this.update_pos),this.listenTo(Upfront.Events,"entity:region_container:resize_stop",this.refresh_background),this.listenTo(Upfront.Events,"entity:drag_stop",this.refresh_background),this.listenTo(Upfront.Events,"entity:drag:drop_change",this.refresh_background),this.listenTo(Upfront.Events,"layout:after_render",this.update_pos),this.listenTo(Upfront.Events,"entity:region:added",this.update_pos),this.listenTo(Upfront.Events,"entity:region:removed",this.update_pos),this.listenTo(Upfront.Events,"sidebar:toggle:done",this.update_pos),this.listenTo(Upfront.Events,"application:mode:after_switch",this.update_pos),this.listenTo(Upfront.Events,"upfront:layout_size:change_breakpoint",this.on_change_breakpoint),e(window).on("scroll.region_subcontainer_"+this.model.get("name"),this,this.on_scroll),e(window).on("resize.region_subcontainer_"+this.model.get("name"),this,this.on_window_resize)},_get_region_type:function(){return this.model.get("type")||(this.model.get("clip")?"clip":"wide")},render:function(){var e=Upfront.Settings.LayoutEditor.Grid,t=this.parent_view.get_container_view(this.model),n=_.extend(this.model.toJSON(),{size_class:e.class,max_col:t.max_col,available_col:t.available_col}),r=_.template(i.region_container,n);Upfront.Events.trigger("entity:region_sub_container:before_render",this,this.model),this.$el.html(r),this.$layout=this.$el.find(".upfront-grid-layout"),this.update(),Upfront.Events.trigger("entity:region_sub_container:after_render",this,this.model)},update:function(){var e=this.parent_view.get_container_view(this.model);e&&e._get_region_type()=="full"?(this.update_background(),this.$el.show()):this.$el.hide(),this.update_pos()},on_scroll:function(e){var t=e.data;t.update_pos()},on_window_resize:function(e){var t=e.data;t.update_pos()},on_change_breakpoint:function(){this.update_pos()},update_pos:function(){var t=Upfront.Settings.LayoutEditor.CurrentBreakpoint,n=e(Upfront.Settings.LayoutEditor.Selectors.main),r=this.$el.offset(),i=r.top,s=e(document).scrollTop(),o=e(window).height(),u=s+o,a=n.offset(),f=a.top,l=this.parent_view.get_container_view(this.model),c=l.$el.outerHeight(),h=l.$el.offset(),p=h.top+c,d=this.$el.height(),v=this.model.get("sticky"),m=this.$el.data("sticky-top"),g=this.model.get("sub"),y=!1,b={};if(this.$el.css("display")=="none"){this.$el.css({position:"",top:"",left:"",right:"",bottom:""}),this.$el.removeClass("upfront-region-container-sticky"),this.$el.removeData("sticky-top"),g=="top"?this.$el.closest(".upfront-region-container-bg").css("padding-top",""):this.$el.closest(".upfront-region-container-bg").css("padding-bottom","");return}s=s<0?0:s,t&&!t.default&&(v=!1),v&&!_.isNumber(m)&&s>=i-f&&(b.position="fixed",b.top=f,b.left=a.left,b.right=0,b.bottom="auto",y=!0,this.$el.data("sticky-top",i-f));if(s+f>=h.top&&u<=p){b.position="fixed",g=="top"?(b.top=f,b.bottom="auto"):(b.top="auto",b.bottom=0),b.left=a.left,b.right=0,y=!1;var w=e(".upfront-regions"),E=this.$el.children(".upfront-region-container-bg").children(".upfront-grid-layout");b.width=w.width(),w.offset()&&(b.left=w.offset().left-e(document).scrollLeft())}if(b.position&&b.position=="fixed"){if(this.$el.css("position")!=b.position||this.$el.css("left")!=b.left||this.$el.css("top")!=b.top)this.$el.css(b),g=="top"?this.$el.closest(".upfront-region-container-bg").css("padding-top",d):this.$el.closest(".upfront-region-container-bg").css("padding-bottom",d);y?this.$el.addClass("upfront-region-container-sticky"):this.$el.removeClass("upfront-region-container-sticky")}else this.$el.css("position")=="fixed"&&(!v||_.isNumber(m)&&s<=m||!_.isNumber(m)&&(s+f<h.top||u>p))&&(this.$el.css({position:"",top:"",left:"",right:"",bottom:""}),g=="top"&&this.$el.css("top",c-o+f),this.$el.removeClass("upfront-region-container-sticky"),this.$el.removeData("sticky-top"),g=="top"?this.$el.closest(".upfront-region-container-bg").css("padding-top",""):this.$el.closest(".upfront-region-container-bg").css("padding-bottom",""))},remove:function(){var t=this.model.get("sub");t=="top"?this.$el.closest(".upfront-region-container-bg").css("padding-top",""):this.$el.closest(".upfront-region-container-bg").css("padding-bottom",""),this.event=!1,e(window).off("scroll.region_subcontainer_"+this.model.get("name")),e(window).off("resize.region_subcontainer_"+this.model.get("name")),Backbone.View.prototype.remove.call(this)}}),k=l.extend({cssSelectors:{".upfront-region-wrapper":{label:t.rw_label,info:t.rw_info}},events:{mouseup:"on_mouse_up",mouseover:"on_mouse_over",mouseenter:"on_mouse_enter","mouseleave > .upfront-region-edit-trigger-small":"on_mouse_leave",click:"on_click","click > .upfront-entity_meta > a.upfront-entity-settings_trigger":"on_settings_click","click > .upfront-entity_meta > a.upfront-entity-delete_trigger":"on_delete_click","click > .upfront-entity_meta > a.upfront-entity-hide_trigger":"on_hide_click","click > .upfront-region-hidden-toggle > a.upfront-entity-hide_trigger":"on_hide_click","click > .upfront-region-edit-trigger":"trigger_edit"},attributes:function(){var e=Upfront.Settings.LayoutEditor.Grid,t=this.model.get("container"),n=this.model.get("name").toLowerCase().replace(/\s/,"-"),r=[],i,s;this.col||(i=this.model.get_property_value_by_name("col"),s=this.model.get_property_value_by_name("width"),this.col=i||(s?Upfront.Util.width_to_col(s):e.size),this.col>e.size&&(this.col=e.size)),r.push("upfront-region"),r.push("upfront-region-"+n),r.push(e.class+this.col);if(!this.model.is_main()){var o=this.model.collection.indexOf(this.model),u=this.model.get("sub"),a=this.model.collection.at(o+1),f=a&&(a.get("name")==t||a.get("container")==t);r.push("upfront-region-side"),r.push("upfront-region-side-"+(u?u:f?"left":"right"))}else r.push("upfront-region-center");return this.model.collection&&this.model.collection.active_region==this.model&&r.push("upfront-region-active"),{"class":r.join(" "),id:"region-"+n}},init:function(){var t=this.model.get("container"),n=this.model.get("name");this.listenTo(this.dispatcher,"plural:propagate_activation",this.on_mouse_up),this.listenTo(this.model.get("properties"),"change",this.update),this.listenTo(this.model.get("properties"),"add",this.update),this.listenTo(this.model.get("properties"),"remove",this.update),this.listenTo(this.model.get("modules"),"change",this.on_module_update),this.listenTo(this.model.get("modules"),"add",this.on_module_update),this.listenTo(this.model.get("modules"),"remove",this.on_module_update),this.listenTo(this.model.get("modules"),"reset",this.on_module_update),this.listenTo(Upfront.Events,"entity:added:after",this.display_region_hint),this.listenTo(Upfront.Events,"layout:after_render",this.on_layout_render),this.listenTo(Upfront.Events,"entity:resize_stop",this.refresh_background),this.listenTo(Upfront.Events,"entity:region:resize_stop",this.refresh_background),this.listenTo(Upfront.Events,"entity:region_container:resize_stop",this.refresh_background),this.listenTo(Upfront.Events,"entity:drag_stop",this.refresh_background),this.listenTo(Upfront.Events,"entity:drag:drop_change",this.refresh_background),this.listenTo(Upfront.Events,"entity:navigation:responsive_open",this.refresh_background),this.listenTo(Upfront.Events,"entity:navigation:responsive_close",this.refresh_background),this.listenTo(Upfront.Events,"upfront:layout_size:change_breakpoint",this.on_change_breakpoint),this.listenTo(Upfront.Events,"entity:region:hide_toggle",this.update_hide_toggle),this.listenTo(Upfront.Events,"command:region:edit_toggle",this.update_buttons),this.listenTo(Upfront.Events,"entity:region:removed",this.update_buttons),e(window).on("resize.region_"+this.model.get("name"),this,this.on_window_resize)},on_click:function(e){},on_mouse_up:function(){this.trigger("activate_region",this)},on_mouse_over:function(){var t=Upfront.Settings.LayoutEditor.CurrentBreakpoint,n=this.parent_view.get_container_view(this.model),r=e(Upfront.Settings.LayoutEditor.Selectors.main);if(!r.hasClass("upfront-region-editing"))return;n&&n.$el.hasClass("upfront-region-container-active")&&!n.$el.hasClass("upfront-region-bg-setting-open")&&this.trigger("activate_region",this)},on_mouse_enter:function(t){var n=Upfront.Settings.LayoutEditor.CurrentBreakpoint;if(n!==undefined&&n.name!="Default Desktop"){var r=e(t.target).parents(".upfront-region-container").find(".upfront-region-edit-trigger-small");r.length>0&&(e(".upfront-region-edit-trigger-small").removeClass("visible"),r.addClass("visible"))}},on_mouse_leave:function(t){e(t.target).removeClass("visible")},_is_clipped:function(){var e=this.model.get("type"),t=this.model.get("sub");return!this.model.is_main()&&(!t||t!="top"&&t!="bottom")},render:function(){var n=this.model.get("container"),r=this.model.get("name"),s=_.template(i.region,this.model.toJSON()),o=e('<div class="upfront-region-edit-trigger upfront-region-edit-trigger-small upfront-ui" title="'+t.edit_region+'"><i class="upfront-icon upfront-icon-region-edit"></i>'+t.edit_region+"</div>"),u=e('<div class="upfront-region-size-hint upfront-ui"></div>');Upfront.Events.trigger("entity:region:before_render",this,this.model),this.$el.html(s),this.$el.append('<div class="upfront-debug-info"/>'),o.appendTo(this.$el),u.appendTo(this.$el),this.update();var a=this._modules_view||new T({model:this.model.get("modules")});a.region_view=this,this.$el.find("> .upfront-region-wrapper > .upfront-modules_container").append(a.el),a.render(),this.render_panels(),this.render_bg_setting(),this.display_region_hint(),Upfront.Events.trigger("entity:region:after_render",this,this.model),this.trigger("region_render",this),this._modules_view?this._modules_view.delegateEvents():this._modules_view=a},render_panels:function(){this.region_panels=new Upfront.Views.Editor.RegionPanels({model:this.model}),this.region_panels.render(),this.$el.append(this.region_panels.el)},render_bg_setting:function(){var e=this.parent_view.get_container_view(this.model),t={model:this.model,to:this.$el,width:420,top:52,right:43,keep_position:!1};this.bg_setting=new Upfront.Views.Editor.ModalBgSetting(t),this.bg_setting.for_view=this,this.bg_setting.render(),this.$el.append(this.bg_setting.el),this.listenTo(this.bg_setting,"modal:open",this.on_modal_open),this.listenTo(this.bg_setting,"modal:close",this.on_modal_close)},update:function(){var e=Upfront.Settings.LayoutEditor.Grid,t=Upfront.Settings.LayoutEditor.CurrentBreakpoint,n=this.model.get("container"),r=this.model.get("name").toLowerCase().replace(/\s/g,"-"),i=this.model.previous("name"),s=this.model.get_property_value_by_name("col"),o=this.model.get_property_value_by_name("row"),u=o?o*Upfront.Settings.LayoutEditor.Grid.baseline:0,a=this.model.get_property_value_by_name("expand_lock");this.$el.data("name",r),this.$el.attr("data-title",this.model.get("title")),this.$el.data("type",this.model.get("type")),this.$el.find(".upfront-region-title").html(this.model.get("title")),(!t||t.default)&&s&&s!=this.col&&this.region_resize(s),u>0&&this.$el.css("min-height",u+"px"),a?this.$el.addClass("upfront-region-expand-lock"):this.$el.removeClass("upfront-region-expand-lock"),i!=r&&(this.$el.removeClass("upfront-region-"+i.toLowerCase().replace(/\s/g,"-")),this.$el.addClass("upfront-region-"+r),this.$el.attr("id","region-"+r)),this._is_clipped()?this.update_background():this.remove_background(),this.update_position(),this.update_buttons(),this.update_size_hint(this.col*e.column_width,parseInt(this.$el.css("height"),10)),this.trigger("region_update",this)},update_position:function(){var e=Upfront.Settings.LayoutEditor.CurrentBreakpoint,t=Upfront.Settings.LayoutEditor.Grid,n=this.$el.find("> .upfront-region-edit-trigger");if(!e)return;var r=this.model.get_property_value_by_name("breakpoint"),i=this.model.get_property_value_by_name("row"),s=r[e.id],o=this.parent_view.get_container_view(this.model),u=this.$el.find("> .upfront-region-wrapper > .upfront-modules_container"),a=this.$el.find(".upfront-region-hidden-toggle"),f=o.$el.find(".upfront-region-center, .upfront-region-side-left, .upfront-region-side-right"),l=this.$el.find("> .upfront-entity_meta > a.upfront-entity-hide_trigger"),c=0,h=0,p=0,d=0;!s||!s.hide?(u.show(),a.hide(),this.$el.removeClass("upfront-region-hidden"),e.default||l.show()):s.hide&&(u.hide(),a.show(),this.$el.addClass("upfront-region-hidden"),l.hide(),this.update_hide_toggle()),f.length>0&&f.length==o.$el.find(".upfront-region-hidden").length?o.$el.addClass("upfront-region-container-hidden"):o.$el.removeClass("upfront-region-container-hidden"),s&&typeof s.col=="number"?(h=s.col/e.columns*100,this.$el.css("width",(h>100?100:h)+"%"),this.$el.data("breakpoint_col",s.col)):(this.$el.css("width",""),this.$el.removeData("breakpoint_col")),e.default?(n.css("right",""),a.css("left","")):(this.model.is_main()?n.css("right",(e.width-e.columns*t.column_width)/2*-1):n.css("right",""),a.css("left",(e.width-e.columns*t.column_width)/2)),s&&typeof s.row=="number"?(c=s.row*t.baseline,this.$el.data("breakpoint_row",s.row)):(c=i*t.baseline,this.$el.removeData("breakpoint_row")),c>0?(p=parseInt(this.$el.css("padding-top"),10),d=parseInt(this.$el.css("padding-bottom"),10),this.$el.css("min-height",c+"px"),c-=p+d,c=c>0?c:0,u.css("min-height",c+"px")):(this.$el.css("min-height",""),u.css("min-height","")),this.trigger("region_changed",this)},update_buttons:function(){var e=Upfront.Settings.LayoutEditor.CurrentBreakpoint,t=this.$el.find("> .upfront-entity_meta > a.upfront-entity-delete_trigger");!e||e.default?this.model.is_main()&&this.model.has_side_region()||this.model.get("sub")=="top"||this.model.get("sub")=="bottom"?t.hide():t.css("display","block"):t.hide(),this.update_size_hint(parseInt(this.$el.css("width"),10),parseInt(this.$el.css("height"),10))},update_size_hint:function(e,t,n){var r="<b>w:</b>"+e+"px <b>h:</b>"+t+"px";(n?n:this.$el).find(".upfront-region-size-hint").html(r)},region_resize:function(e){var t=Upfront.Settings.LayoutEditor.Grid,n=this.col;this.col=e,this.$el.removeClass(t.class+n),this.$el.addClass(t.class+this.col),Upfront.Application.layout_ready&&this.normalize_child_modules(n)},on_module_update:function(){this.trigger("region_changed",this),this.display_region_hint()},display_region_hint:function(){if(Upfront.Application.get_current()!="theme"||this.$el.hasClass("upfront-region-floating")||this.$el.hasClass("upfront-region-lightbox")||this.$el.attr("id")=="region-shadow")return;this.$el.find("> .upfront-region-wrapper > .upfront-modules_container .upfront-wrapper").size()<1?this.$el.addClass("empty_in_theme_mode"):this.$el.removeClass("empty_in_theme_mode")},on_layout_render:function(){this.update_size_hint(parseInt(this.$el.css("width"),10),parseInt(this.$el.css("height"),10)),this.refresh_background()},normalize_child_modules:function(e){if(!this._modules_view)return;var t=Upfront.Views.breakpoints_storage.get_breakpoints().get_active().toJSON(),n=Upfront.Behaviors.GridEditor,r=!t||t.default?n.get_class_num(this.$el,n.grid.class):this.$el.data("breakpoint_col");this._modules_view.normalize_child_modules(r,e,this.model.get("wrappers"))},remove:function(){this._modules_view&&this._modules_view.remove(),e(window).off("resize.region_"+this.model.get("name"));var t=this.model.get("wrappers");t&&t.each(function(e){var t=Upfront.data.wrapper_views[e.cid];t&&(t.remove(),delete Upfront.data.wrapper_views[e.cid])}),this.parent_view=!1,Backbone.View.prototype.remove.call(this),this.model.get("wrappers").reset([],{silent:!0}),this.model=!1},on_delete_click:function(n){var r,i;typeof n!="undefined"&&n.preventDefault();if(confirm(t.section_delete_nag)){var s=this.$el.closest(".upfront-region-container-bg").children(".upfront-region-bg-overlay");s.length>0&&s.data("uparallax")&&s.uparallax("destroy");var o=this.parent_view;this.model.get("type")=="lightbox"&&this.hide();var u=this.model.collection;if(this.model.is_main()){var a=this.model.get_sub_regions();_.each(a,function(e,t){_.isArray(e)?_.each(e,function(e){u.remove(e)}):_.isObject(e)&&u.remove(e)})}var f=this.model.get("type")==="fixed";this.model.collection.remove(this.model);var l=u.total_container(["shadow","lightbox"]);l==0&&o.$el.find("#no_region_add_one").length<1&&o.$el.append(e("<a>").attr("id","no_region_add_one").text(t.no_region_add).one("click",function(){var n=!1,r="main",i=t.main_area;u.get_by_name(r)&&(n=u.get_new_title("Main ",2),i=n.title,r=n.name);var s=new Upfront.Models.Region(_.extend(_.clone(Upfront.data.region_default_args),{name:r,container:r,title:i})),o={};s.set_property("row",Upfront.Util.height_to_row(e(window).height())),s.add_to(u,0,o),e(this).remove()})),f&&o.render()}},on_settings_click:function(t){typeof t!="undefined"&&(t.preventDefault(),t.stopPropagation());var n=this,r=this.parent_view.get_container_view(this.model);this.listenToOnce(Upfront.Events,"entity:region:deactivated",function(r){t&&!this.$el.is(e(t.target).closest("div.upfront-region"))&&n.bg_setting.close(!1)}),_.each(_.flatten([r.model,r.sub_model]),function(e){var t=Upfront.data.region_views[e.cid];if(e==n.model){t.$el.find(".upfront-inline-modal-wrap").draggable({delay:300,addClasses:!1,cancel:".upfront-field-select, input,textarea,button,select,option"});return}t&&t.bg_setting&&t.bg_setting.close(!1)});var i=this.$el.find("> .upfront-entity_meta > a.upfront-entity-settings_trigger"),s=i.offset(),o=this.$el.offset(),u=this.$el.width();if(this.model.get("type")=="lightbox"){this.bg_setting.right=80,this.bg_setting.top=s.top;var r=this.parent_view.get_container_view(this.model);r.trigger_edit_lightbox(t)}else this.bg_setting.width<s.left-10?(this.bg_setting.right=o.left+u-s.left+10,this.bg_setting.left=-1):(this.bg_setting.right=-1,this.bg_setting.left=u),this.bg_setting.top=s.top-o.top;r.$el.addClass("upfront-region-bg-setting-open"),this.bg_setting.open().always(function(){r.$el.removeClass("upfront-region-bg-setting-open")})},on_hide_click:function(e){e.preventDefault();var t=Upfront.Settings.LayoutEditor.CurrentBreakpoint,n=Upfront.Util.clone(this.model.get_property_value_by_name("breakpoint")||{});_.isObject(n[t.id])||(n[t.id]={}),n[t.id].hide==1?n[t.id].hide=0:n[t.id].hide=1,this.model.set_property("breakpoint",n),Upfront.Events.trigger("entity:region:hide_toggle",n[t.id].hide,this)},update_hide_toggle:function(){if(!this.$el.hasClass("upfront-region-hidden"))return;var t=this.$el.find(".upfront-region-hidden-toggle"),n=e(".upfront-region-center, .upfront-region-side-left, .upfront-region-side-right"),r=Upfront.Util.find_from_elements(n,this.$el,".upfront-region",!0,":not(.upfront-region-hidden)");t.css("margin-top",r.length*20+"px")},trigger_edit:function(e){var t=this.parent_view.get_container_view(this.model);t.trigger_edit(e),e.stopPropagation()},close_edit:function(e){var t=this.parent_view.get_container_view(this.model);t.close_edit(),e.stopPropagation()},on_modal_open:function(){var e=this.parent_view.get_container_view(this.model);e.$el.find(".upfront-region-finish-edit").css("display","none")},on_modal_close:function(){var e=this.parent_view.get_container_view(this.model);e.$el.find(".upfront-region-finish-edit").css("display","")},on_change_breakpoint:function(e){var t=this.$el.find("> .upfront-entity_meta > a.upfront-entity-delete_trigger"),n=this.$el.find("> .upfront-entity_meta > a.upfront-entity-settings_trigger"),r=this.$el.find("> .upfront-entity_meta > a.upfront-entity-hide_trigger");e.default?(t.show(),r.hide()):(t.hide(),r.show()),this.update_position(),this.update_size_hint(parseInt(this.$el.css("width"),10),parseInt(this.$el.css("height"),10)),this._is_clipped()&&this.update_background()}}),L=k.extend({events:{mouseover:"on_mouse_over",click:"on_click","click > .upfront-entity_meta > a.upfront-entity-settings_trigger":"on_settings_click","click > .upfront-entity_meta > a.upfront-entity-delete_trigger":"on_delete_click","click > .upfront-region-edit-trigger":"trigger_edit","click > .upfront-region-finish-edit-fixed":"close_edit"},init:function(){this.constructor.__super__.init.call(this),this.listenTo(Upfront.Events,"sidebar:toggle:done",this.update_region_position),this.listenTo(Upfront.Events,"entity:drag_stop",this.update_region_position),this.listenTo(Upfront.Events,"entity:drag_stop",this.check_modules),this.listenTo(Upfront.Events,"layout:after_render",this.check_modules),this.listenTo(Upfront.Events,"upfront:layout_size:change_breakpoint",this.on_change_breakpoint),this.listenTo(this.model,"restrict_to_container",this.update_position_on_restrict),e(window).on("scroll.region_"+this.model.get("name"),this,this.on_scroll)},render:function(){this.constructor.__super__.render.call(this);var n=e('<div class="upfront-region-edit-trigger upfront-region-edit-trigger-small upfront-ui" title="'+t.change_background+'"><i class="upfront-icon upfront-icon-region-edit"></i></div>'),r=e('<div class="upfront-region-edit-trigger upfront-region-edit-trigger-full upfront-ui"><div class="upfront-region-edit-text">'+t.click_to_edit_floating_region+"</div></div>"),i=e('<div class="upfront-region-finish-edit-fixed upfront-ui">'+t.ok+"</div>"),s=e('<div class="upfront-region-size-hint upfront-ui"></div>'),o=e('<div class="upfront-region-position-hint upfront-ui"></div>');s.appendTo(this.$el),o.appendTo(this.$el),n.appendTo(this.$el),r.appendTo(this.$el),i.appendTo(this.$el)},render_bg_setting:function(){var t=e(Upfront.Settings.LayoutEditor.Selectors.main);this.bg_setting=new Upfront.Views.Editor.ModalBgSetting({model:this.model,to:t,width:420}),this.bg_setting.render(),t.append(this.bg_setting.el),this.listenTo(this.bg_setting,"modal:open",this.on_modal_open),this.listenTo(this.bg_setting,"modal:close",this.on_modal_close)},update:function(){this.constructor.__super__.update.call(this),this.check_modules(),this.update_region_position()},update_region_position:function(){var t=e(Upfront.Settings.LayoutEditor.Selectors.main),n=Upfront.Settings.LayoutEditor.Grid,r=this.model.get("restrict_to_container"),i=this.model.get_property_value_by_name("width"),s=this.model.get_property_value_by_name("col"),o=this.model.get_property_value_by_name("height"),u=this.model.get_property_value_by_name("top"),a=typeof u=="number",f=this.model.get_property_value_by_name("left"),l=typeof f=="number",c=this.model.get_property_value_by_name("bottom"),h=typeof c=="number",p=this.model.get_property_value_by_name("right"),d=typeof p=="number",v={width:i||225,minHeight:o||225};i||this.model.set_property("width",225,!0),s?s=s<=n.size?s:n.size:(s=Upfront.Util.width_to_col(v.width),s=s<=n.size?s:n.size,this.model.set_property("col",s,!0)),o||this.model.set_property("height",225,!0),a||!h?(v.top=a?u:30,v.bottom="",a||this.model.set_property("top",30,!0)):(v.bottom=c,v.top=""),l||!d?(v.left=(l?f:30)+(r?0:t.offset().left),v.right="",l||this.model.set_property("left",30,!0)):(v.right=p,v.left=""),this.$el.find("> .upfront-region-wrapper > .upfront-modules_container").css({width:s*n.column_width,minHeight:v.minHeight}),this.$el.css(v),this.edit_position&&this.edit_position.update_fields(),this.update_size_hint(v.width,v.minHeight),this.update_position_hint(v),this.update_position_scroll()},update_position_hint:function(e,t){var n="";typeof e.top=="number"?n+="<b>top:</b>"+e.top:typeof e.bottom=="number"&&(n+="<b>bottom:</b>"+e.bottom),typeof e.left=="number"?n+=" <b>left:</b>"+e.left:typeof e.right=="number"&&(n+=" <b>right:</b>"+e.right),(t?t:this.$el).find(".upfront-region-position-hint").html(n)},update_position_on_restrict:function(t){var n=e(window).scrollTop(),r=e(window).height(),i=n+r,s=this.parent_view.get_container_view(this.model),o=s.$el.height(),u=s.$el.offset(),a=u.top+o,f=this.model.get_property_value_by_name("height"),l=this.model.get_property_value_by_name("top"),c=typeof l=="number",h=this.model.get_property_value_by_name("bottom"),p=typeof h=="number";t?(c||!p)&&n<=u.top?(l-=u.top-n,l+f>o?l=o-f:l<0&&(l=0)):p&&i>=a&&(h-=i-a,h+f>o?h=o-f:h<0&&(h=0)):c||!p?l=u.top>=n?u.top-n+l:l:h=i>=a?i-a+h:h,c||!p?(this.model.set_property("top",l,!0),o>r&&i>a&&e("html,body").animate({scrollTop:a-r},600)):(this.model.set_property("bottom",h,!0),o>r&&n<u.top&&e("html,body").animate({scrollTop:u.top},600))},update_position_scroll:function(){var t=e(Upfront.Settings.LayoutEditor.Selectors.main),n=e(window).scrollTop(),r=e(window).height(),i=n+r,s=this.parent_view.get_container_view(this.model),o=s.$el.height(),u=s.$el.offset(),a=u.top+o,f=this.model.get("restrict_to_container"),l=this.model.get_property_value_by_name("height"),c=this.model.get_property_value_by_name("top"),h=typeof c=="number",p=this.model.get_property_value_by_name("left"),d=this.model.get_property_value_by_name("right"),v=typeof p=="number",m=this.model.get_property_value_by_name("bottom"),g=typeof m=="number",y={};(i<s.$el.offset().top||n>s.$el.offset().top+s.$el.outerHeight())!=1?d==0&&this.$el.find(".upfront-region-edit-trigger").css({right:30}):this.$el.find(".upfront-region-edit-trigger").css({right:0}),f?n>=u.top&&i<=a?(y.position="fixed",h?y.top=c:y.bottom=m):(y.position="absolute",h?o>r&&n>=u.top+o-r?y.top=o-r+c:y.top=c:o>r&&i<=u.top+r?y.bottom=o-r+m:y.bottom=m):(y.position="fixed",h?y.top=c:y.bottom=m),v&&(y.left=p+(y.position=="fixed"?t.offset().left:0)),this.$el.css(y),y.position=="fixed"&&y.bottom<35||y.position=="absolute"&&this.$el.offset().top+this.$el.height()>i-35?this.$el.find(".upfront-region-finish-edit-fixed").css("bottom",0):this.$el.find(".upfront-region-finish-edit-fixed").css("bottom","")},on_scroll:function(e){var t=e.data;t.update_position_scroll()},render_panels:function(){},render_edit_position:function(){this.edit_position=new Upfront.Views.Editor.RegionFixedEditPosition({model:this.model}),this.edit_position.render(),this.$el.append(this.edit_position.el)},trigger_edit:function(e){var t=this.parent_view.get_container_view(this.model);t.trigger_edit_fixed(),e.stopPropagation()},close_edit:function(e){var t=this.parent_view.get_container_view(this.model);t.close_edit(),e.stopPropagation()},check_modules:function(){var e=this.$el.find("> .upfront-region-wrapper > .upfront-modules_container > .upfront-editable_entities_container").find(".upfront-module").size();e==0?(this.$el.removeClass("upfront-region-has-modules"),this.$el.addClass("upfront-region-empty")):(this.$el.removeClass("upfront-region-empty"),this.$el.addClass("upfront-region-has-modules"))},remove:function(){e(window).off("scroll.region_"+this.model.get("name")),this.constructor.__super__.remove.call(this)},on_change_breakpoint:function(e){e.default?this.$el.show():this.$el.hide()}}),A=k.extend({cssSelectors:{".upfront-region-side-lightbox":{label:t.ltbox_area_label,info:t.ltbox_area_info},".close_lightbox > .upfront-icon-popup-close":{label:t.ltbox_close_icon_label,info:t.ltbox_close_icon_info}},$bg:e('<div class="upfront-lightbox-bg"></div>'),$close:e('<div class="upfront-ui close_lightbox"></div>'),$close_icon:e('<div class="upfront-icon-popup-close"></div>'),events:{mouseover:"on_mouse_over",click:"on_click","click > .upfront-entity_meta > a.upfront-entity-settings_trigger":"on_settings_click","click > .upfront-entity_meta > a.upfront-entity-delete_trigger":"on_delete_click","click > .upfront-region-edit-trigger":"trigger_edit","click > .upfront-region-finish-edit-lightbox":"close_edit","click > .close_lightbox":"hide"},init:function(){this.constructor.__super__.init.call(this),this.listenTo(Upfront.Events,"sidebar:toggle:done",this.update_region_position),this.listenTo(Upfront.Events,"entity:drag_stop",this.update_region_position),this.listenTo(Upfront.Events,"entity:drag_stop",this.check_modules),this.listenTo(Upfront.Events,"layout:after_render",this.check_modules),this.listenTo(Upfront.Events,"upfront:layout_size:change_breakpoint",this.on_change_breakpoint)},render:function(){this.constructor.__super__.render.call(this),this.hide(),this.$close.appendTo(this.$el)},render_bg_setting:function(){var t=e(Upfront.Settings.LayoutEditor.Selectors.main);this.bg_setting=new Upfront.Views.Editor.ModalBgSetting({model:this.model,to:t,width:420}),this.bg_setting.for_view=this,this.bg_setting.render(),t.append(this.bg_setting.el),this.listenTo(this.bg_setting,"modal:open",this.on_modal_open),this.listenTo(this.bg_setting,"modal:close",this.close_edit)},show:function(){Upfront.Events.trigger("upfront:element:edit:stop");var e=this;this.$bg.insertBefore(this.$el),this.model.get_property_value_by_name("click_out_close")=="yes"&&(this.$bg.unbind("click"),this.$bg.bind("click",function(){e.hide()})),this.$el.show(),this._modules_view.apply_flexbox_clear(),this._modules_view.apply_wrapper_height(),Upfront.Events.trigger("upfront:lightbox:show")},hide:function(){this.$el.hide(),this.$bg.remove()},refresh_background:function(){this.constructor.__super__.refresh_background.call(this)},update:function(){this.constructor.__super__.update.call(this),this.check_modules(),this.update_region_position(),this.model.get_property_value_by_name("show_close")=="yes"||this.model.get_property_value_by_name("add_close_text")=="yes"?(this.$el.find(".close_lightbox").css("display","block"),this.model.get_property_value_by_name("add_close_text")=="yes"?(this.$close.html("<h3>"+this.model.get_property_value_by_name("close_text")+"</h3>"),this.model.get_property_value_by_name("show_close")=="yes"&&this.$close.children("h3").css("margin-right","40px")):this.$close.html(""),this.model.get_property_value_by_name("show_close")=="yes"&&this.$close.append(this.$close_icon)):this.$el.find(".close_lightbox").css("display","none");var e=this;this.model.get_property_value_by_name("click_out_close")=="yes"?(this.$bg.unbind("click"),this.$bg.bind("click",function(){e.hide()})):this.$bg.unbind("click"),this.$bg.css("background-color",this.model.get_property_value_by_name("overlay_color")),this.$el.css("background-color",this.model.get_property_value_by_name("lightbox_color")),this.$el.removeClass("init_state"),this.model.get_property_value_by_name("delete")&&(this.model.set_property("delete",!1),this.on_delete_click())},update_region_position:function(){var t=e(Upfront.Settings.LayoutEditor.Selectors.main),n=Upfront.Settings.LayoutEditor.Grid,r=this.model.get_breakpoint_property_value("col",!0),i=this.model.get_property_value_by_name("height");r||this.model.set_property("col",10,!0),i||this.model.set_property("height",225,!0),width=r*n.column_width;var s={width:width||225,minHeight:parseInt(i)||225};s["margin-left"]=parseInt(-(width/2)+e("#sidebar-ui").width()/2),s["margin-top"]=parseInt(-(i/2)),this.$el.find("> .upfront-region-wrapper > .upfront-modules_container").css({width:Math.floor(s.width/n.column_width)*n.column_width,minHeight:s.minHeight}),this.$el.css(s)},render_edit_position:function(){this.edit_position=new Upfront.Views.Editor.RegionFixedEditPosition({model:this.model}),this.edit_position.render(),this.$el.append(this.edit_position.el)},trigger_edit:function(e){this.on_settings_click(),e.stopPropagation()},close_edit:function(e){var t=this.parent_view.get_container_view(this.model);t.close_edit(),typeof e!="undefined"&&e.stopPropagation()},check_modules:function(){var e=this.$el.find("> .upfront-region-wrapper > .upfront-modules_container > .upfront-editable_entities_container").find(".upfront-module").size();e==0?(this.$el.removeClass("upfront-region-has-modules"),this.$el.addClass("upfront-region-empty")):(this.$el.removeClass("upfront-region-empty"),this.$el.addClass("upfront-region-has-modules"))},on_change_breakpoint:function(e){this.update_region_position(),this.hide()}}),O=p.extend({className:"upfront-regions",allow_edit:!0,init:function(){this.stopListening(this.model,"add",this.render),this.listenTo(this.model,"add",this.on_add),this.stopListening(this.model,"remove",this.render),this.listenTo(this.model,"remove",this.on_remove),this.listenTo(this.model,"reset",this.on_reset),this.listenTo(Upfront.Events,"entity:region:resize_start",this.pause_edit),this.listenTo(Upfront.Events,"entity:region:resize_stop",this.resume_edit),this.listenTo(Upfront.Events,"entity:region:deactivated",this.deactivate_region),this.listenTo(Upfront.Events,"upfront:layout_size:change_breakpoint",this.on_change_breakpoint)},render:function(){this.$el.html("");var e=this;typeof this.container_views!="object"&&(this.container_views={}),typeof this.sub_container_views!="object"&&(this.sub_container_views={}),typeof Upfront.data.region_views!="object"&&(Upfront.data.region_views={}),this.model.each(function(t){e.render_container(t)}),this.model.each(function(t,n){e.render_region(t)}),this.apply_adapt_region_to_breakpoints()},render_container:function(e,t){var n=e.get("container"),r=e.get("name");if(e.is_main()||n=="lightbox"&&!this.container_views[e.cid]){var i=this.container_views[e.cid]||this.create_container_instance(e);return i.parent_view=this,this.listenTo(i,"activate_region",this.activate_region_container),t>=0?this.$el.find(".upfront-region").eq(t).closest(".upfront-region-container").before(i.el):this.$el.append(i.el),i.render(),this.container_views[e.cid]?i.delegateEvents():this.container_views[e.cid]=i,Upfront.Events.trigger("entity:regions:render_container",i,i.model),i}},render_region:function(e,t){var n=Upfront.data.region_views[e.cid]||this.create_region_instance(e),r=this.get_container_view(e),t=t?t:e.get("sub"),i;if(!r)return;return t=="top"||t=="bottom"?(i=this.sub_container_views[e.cid]||new C({model:e}),t=="top"?r.$layout.before(i.el):r.$layout.after(i.el),i.parent_view=this,i.listenTo(r.model.get("properties"),"change",i.update),i.render(),n.sub_container_view=i,i.$layout.append(n.el),this.sub_container_views[e.cid]?i.delegateEvents():this.sub_container_views[e.cid]=i):t=="left"?r.$layout.prepend(n.el):t=="fixed"?r.$el.append(n.el):r.$layout.append(n.el),Upfront.data.region_views[e.cid]?(n.render(),n.delegateEvents()):(n.parent_view=this,r.listenTo(n,"region_render",r.on_region_render),r.listenTo(n,"region_update",r.on_region_update),r.listenTo(n,"region_changed",r.on_region_changed),e.is_main()?n.listenTo(r,"region_resize",n.region_resize):r.add_sub_model(e),n.render(),this.listenTo(n,"activate_region",this.activate_region),Upfront.data.region_views[e.cid]=n),e.get("default")&&n.trigger("activate_region",n),Upfront.Events.trigger("entity:regions:render_region",n,n.model),n},create_container_instance:function(e){return new N({model:e})},create_region_instance:function(e){var t=e.get("type");return t=="fixed"?new L({model:e}):t=="lightbox"?new A({model:e}):new k({model:e})},get_container_view:function(e){return _.find(this.container_views,function(t){var n=t.model.get("container")||t.model.get("name");if(e.get("container")==n||e.get("name")==n)return!0})},activate_region:function(t){if(!this.allow_edit)return;var t=t.model?t:Upfront.data.region_views[t.cid],n=t.model;if(this.model.active_region==n)return;this.model.active_region=n;if(t.$el){e(".upfront-region-active").removeClass("upfront-region-active"),t.$el.addClass("upfront-region-active");var r=this.get_container_view(t.model);r&&(e(".upfront-region-container-active").removeClass("upfront-region-container-active"),r.$el.addClass("upfront-region-container-active")),e(".upfront-region-sub-container-active").removeClass("upfront-region-sub-container-active"),t.sub_container_view&&t.sub_container_view.$el.addClass("upfront-region-sub-container-active"),Upfront.Events.trigger("entity:region:activated",t)}},deactivate_region:function(){if(!this.allow_edit||!this.model.active_region)return;e(".upfront-region-active").removeClass("upfront-region-active"),e(".upfront-region-container-active").removeClass("upfront-region-container-active"),this.model.active_region=null},activate_region_container:function(e){var t=Upfront.data.region_views[e.model.cid];t&&t.trigger("activate_region",t)},pause_edit:function(){this.allow_edit=!1},resume_edit:function(){this.allow_edit=!0},on_edit_toggle:function(e){this.allow_edit=e},on_add:function(e,t,n){var r=this.get_container_view(e),i=typeof n.index!="undefined"?n.index:-1,s=n.sub?n.sub:!1,o;r?o=this.render_region(e,s):(this.render_container(e,i),o=this.render_region(e)),this.apply_adapt_region_to_breakpoints(),Upfront.Events.trigger("entity:region:added",o,o.model)},on_remove:function(e){var t=Upfront.data.region_views[e.cid];if(!t)return;var n=this.get_container_view(e),r=this.sub_container_views[e.cid];delete Upfront.data.region_views[e.cid],t.region_panels&&(t.region_panels.unbind(),t.region_panels.remove()),t.bg_setting&&(t.bg_setting.unbind(),t.bg_setting.remove()),t.edit_position&&(t.edit_position.unbind(),t.edit_position.remove()),t.unbind(),t.remove();if(n){if(n.sub_model.length>0){var i=Upfront.data.region_views[n.model.cid];_.each(n.sub_model,function(t,r){if(t==e)n.sub_model.splice(r,1);else{var i=Upfront.data.region_views[t.cid];i&&i.update()}}),i&&i.update()}n.sub_model.length==0&&(delete this.container_views[n.model.cid],n.region_fixed_panels&&(n.region_fixed_panels.unbind(),n.region_fixed_panels.remove()),n.unbind(),n.remove())}r&&(delete this.sub_container_views[e.cid],r.unbind(),r.remove()),Upfront.Events.trigger("entity:region:removed",t,e)},on_reset:function(e,t){var n=this;t.previousModels&&_.each(t.previousModels,function(e){n.on_remove(e)})},apply_adapt_region_to_breakpoints:function(){var e=Upfront.Settings.LayoutEditor.CurrentBreakpoint;if(e&&!e.default)return;var t=this,n=Upfront.Behaviors.GridEditor,r=Upfront.Views.breakpoints_storage.get_breakpoints().get_enabled();_.each(r,function(e){var r=e.toJSON();if(r.default)return;n.adapt_region_to_breakpoint(t.model,r.id,r.columns,!0)})},on_change_breakpoint:function(e){},remove:function(){var e=this;this.model.each(function(t){e.on_remove(t)}),Backbone.View.prototype.remove.call(this),_.each(this.container_views,function(t,n){t.remove(),delete e.container_views[n]}),this.container_views=null,_.each(this.sub_container_views,function(t,n){t.remove(),delete e.sub_container_views[n]}),this.sub_container_views=null,this.model.reset([],{silent:!0}),this.model=!1,this.options=!1}}),M=l.extend({events:{mouseup:"on_mouse_up","click > .upfront-wrapper-meta > .upfront-add-spacer":"on_add_spacer"},attributes:function(){var e="upfront-wrapper",t=this.model.get_property_value_by_name("class");return{"class":e+" "+t,id:this.model.get_wrapper_id()}},init:function(){this.listenTo(this.model.get("properties"),"change",this.update),this.listenTo(this.model,"remove",this.on_remove),this.listenTo(Upfront.Events,"upfront:layout_size:change_breakpoint",this.on_change_breakpoint),this.listenTo(Upfront.Events,"entity:module:update_position",this.on_module_update),this.listenTo(Upfront.Events,"entity:modules:render_module",this.on_module_update),this.listenTo(Upfront.Events,"entity:object:update_position",this.on_object_update),this.listenTo(Upfront.Events,"entity:objects:render_object",this.on_object_update),this.listenTo(Upfront.Events,"layout:after_render",this.on_layout_after_render),this.listenTo(Upfront.Events,"upfront:lightbox:show",this.on_lightbox_show)},render:function(){var e=Upfront.Settings.LayoutEditor.CurrentBreakpoint,t=_.template(i.wrapper),n=Upfront.Settings.LayoutEditor.Grid,r=this.model.get_property_value_by_name("class"),s=Upfront.Behaviors.GridEditor.get_class_num(r,n.class);Upfront.Events.trigger("entity:wrapper:before_render",this,this.model),this.$el.html(t),this.$el.data("default_col",s),this.$el.data("current_col",s),e&&!e.default&&this.update_position(),Upfront.Events.trigger("entity:wrapper:after_render",this,this.model)},update:function(e,t){var n=Upfront.Settings.LayoutEditor.Grid,r=this.model.get_property_value_by_name("class"),i=Upfront.Behaviors.GridEditor.get_class_num(r,n.class);e.id=="class"?(this.$el.attr("class",this.attributes().class),this.$el.data("default_col",i),this.$el.data("current_col",i)):e.id=="breakpoint"&&this.update_position()},update_position:function(){var e=Upfront.Settings.LayoutEditor.CurrentBreakpoint;if(!e)return;var t=Upfront.Behaviors.GridEditor,n=Upfront.Settings.LayoutEditor.Grid,r=this.model.get_property_value_by_name("breakpoint"),i=r[e.id],s=!_.isUndefined(this.parent_view.group_view),o=!_.isUndefined(this.parent_view.object_group_view),u=s?this.parent_view.group_view:o?this.parent_view.object_group_view:this.parent_view.region_view,a=s?t.get_position(u.$el):o?t.get_position(u.parent_module_view.$el.find("> .upfront-module")):t.get_region_position(u.$el),f=a.col;this.$el.css({minHeight:"",marginRight:0}),i&&typeof i.col=="number"?(this.$el.css("width",i.col/f*100+"%"),this.$el.data("breakpoint_col",i.col),this.$el.data("current_col",i.col)):(this.$el.css("width",""),this.$el.removeData("breakpoint_col"),this.$el.data("current_col",this.$el.data("default_col"))),i&&typeof i.order=="number"?(this.$el.css("order",i.order),this.$el.data("breakpoint_order",i.order)):(this.$el.css("order",""),this.$el.removeData("breakpoint_order")),i&&i.clear?this.$el.data("breakpoint_clear",i.clear):this.$el.removeData("breakpoint_clear"),Upfront.Events.trigger("entity:wrapper:update_position",this,this.model)},on_add_spacer:function(t){var n=Upfront.Behaviors.GridEditor,r=e(t.target),i=r.attr("data-position");t.preventDefault(),n.start(this,this.model),this.add_spacer(i,1,null,r.closest(".upfront-objects_container").length!==0)},add_spacer:function(t,n,r,i){var s=Upfront.Settings.LayoutEditor.CurrentBreakpoint,o=Upfront.Behaviors.GridEditor,u=Upfront.Settings.LayoutEditor.Grid.class,i=_.isUndefined(i)?!1:i,n=n>0?n:1,r=_.isNumber(r)&&r>n?r:Upfront.Util.width_to_col(this.$el.width()),a=this._find_child_min_col(),f=r-n,l=f>=a?this.$el:this._find_closest_wrapper(t=="left",n);if(!l.length)return;f<a&&(r=Upfront.Util.width_to_col(l.width()),f=r-n);var c=this.model.collection.get_by_wrapper_id(l.attr("id")),h=this.model.get_property_value_by_name("class"),p=s&&!s.default?this.model.get_breakpoint_property_value("clear"):h.match(/clr/),d=Upfront.Util.get_unique_id("wrapper"),v=[{name:"wrapper_id",value:d},{name:"default_hide",value:1},{name:"toggle_hide",value:0},{name:"hide",value:s&&!s.default?1:0}],m=new Upfront.Models.UspacerModel({name:"",properties:i?_.union([{name:"class",value:u+n+" upfront-object-spacer"}],v):[]}),g=new Upfront.Models.Module({name:"",properties:_.union([{name:"element_id",value:Upfront.Util.get_unique_id("module")},{name:"class",value:u+n+" upfront-module-spacer"},{name:"has_settings",value:0}],v),objects:[m]}),y=new Upfront.Models.Wrapper({name:"",properties:[{name:"wrapper_id",value:d},{name:"class",value:u+n+(p&&t=="left"?" clr":"")}]}),b=this.$el.find(o.el_selector_direct),w=t=="right"?b.last():b.first(),E=o.get_el_model(w),S=E.collection.indexOf(E);if(!c)return;l.find(o.el_selector_direct).each(function(){var t=o.get_el_model(e(this));s&&!s.default?(t.set_breakpoint_property("edited",!0,!0),t.set_breakpoint_property("col",f)):t.replace_class(u+f)}),p&&t=="left"&&(s&&!s.default?this.model.set_breakpoint_property("clear",!1):this.model.remove_class("clr")),s&&!s.default?(c.set_breakpoint_property("edited",!0,!0),c.set_breakpoint_property("col",f)):c.replace_class(u+f),s&&!s.default&&(y.set_breakpoint_property("edited",!0,!0),y.set_breakpoint_property("clear",p&&t=="left",!0),y.set_breakpoint_property("order",this.model.get_breakpoint_property_value("order")),y.set_breakpoint_property("col",n),i?(m.set_breakpoint_property("edited",!0,!0),m.set_breakpoint_property("hide",0,!0),m.set_breakpoint_property("left",0,!0),m.set_breakpoint_property("col",n)):(g.set_breakpoint_property("edited",!0,!0),g.set_breakpoint_property("hide",0,!0),g.set_breakpoint_property("left",0,!0),g.set_breakpoint_property("col",n))),this.model.collection.add(y),i?m.add_to(E.collection,t=="right"?S+1:S):g.add_to(E.collection,t=="right"?S+1:S)},_find_closest_wrapper:function(t,n){var r=Upfront.Settings.LayoutEditor.CurrentBreakpoint,i=this.$el.parent().children(".upfront-wrapper:visible").filter(function(){return e(this).height()>0}).each(Upfront.Util.normalize_sort_elements_cb).sort(Upfront.Util.sort_elements_cb),s=i.index(this.$el),o=function(e){return!r||r.default?e.hasClass("clr"):e.data("breakpoint_clear")},u=function(e){return Upfront.Util.width_to_col(e.width())>n},a=o(this.$el)?this.$el:Upfront.Util.find_from_elements(i,this.$el,o,!0),f=Upfront.Util.find_from_elements(i,a,".upfront-wrapper",!1,o),l=e(_.union([a.get(0)],f.map(function(){return this}).get())),c=Upfront.Util.find_from_elements(l,this.$el,u,t),h=c.length?c:Upfront.Util.find_from_elements(l,this.$el,u,!t);return h.first()},_find_child_min_col:function(){var e=Upfront.Behaviors.GridEditor,t=1;return this.parent_view.model.each(function(n){if(!n.get("modules"))return;var r=Upfront.data.module_views[n.cid],i=r?e.get_group_min_col(r):1;t=Math.max(t,i)}),t},toggle_wrapper_visibility:function(){var e=parseInt(this.$el.css("height"),10)>0;!e&&this.$el.css("display")!="none"?this.$el.css("display","none"):e&&this.$el.css("display","")},on_change_breakpoint:function(){this.$el.css({display:""}),this.update_position()},on_module_update:function(e){if(!e.wrapper_view||e.wrapper_view!=this)return;if(e instanceof Upfront.Views.ModuleGroup)return;this.toggle_wrapper_visibility()},on_object_update:function(e){if(!e.wrapper_view||e.wrapper_view!=this)return;this.toggle_wrapper_visibility()},on_layout_after_render:function(){if(this.$el.find("> .upfront-module-group").length>0)return;this.toggle_wrapper_visibility()},on_lightbox_show:function(){if(this.$el.find("> .upfront-module-group").length>0)return;this.toggle_wrapper_visibility()},on_remove:function(){this.unbind(),this.remove()}}),D=l.extend({tpl:_.template(i.layout),events:{click:"on_click"},initialize:function(t){this._has_ruler=!1,this.listenTo(this.model.get("properties"),"change",this.update),this.listenTo(this.model.get("properties"),"add",this.update),this.listenTo(this.model.get("properties"),"remove",this.update),this.listenTo(Upfront.Events,"command:layout:edit_background",this.open_edit_background),this.listenTo(Upfront.Events,"upfront:layout_size:change_breakpoint",this.on_change_breakpoint),this.listenTo(Upfront.Events,"application:mode:after_switch",this.on_mode_switch),e(window).on("resize.upfront_layout",this,this.on_window_resize),e(window).on("scroll.upfront_layout",this,this.on_window_scroll),e(window).on("keydown.upfront_layout",this,this.on_keydown),this.render()},update:function(){this.update_background()},update_background_color:function(){var t=e("body"),n=this.model.get_breakpoint_property_value("background_color",!0);n?t.css("background-color",n):t.css("background-color","")},render:function(){this.$el.addClass("upfront-layout-view"),this.$el.html(this.tpl(this.model.toJSON())),this.$layout=this.$(".upfront-layout"),this.remove_selections(),this.local_view?(this.$layout.append(this.local_view.el),this.local_view.render(),this.local_view.delegateEvents()):(this.local_view=new O({model:this.model.get("regions")}),this.$layout.append(this.local_view.el),this.local_view.render()),this.update(),this.bg_setting=new Upfront.Views.Editor.ModalBgSetting({model:this.model,to:this.$el,width:420}),this.bg_setting.render(),this.$el.append(this.bg_setting.el),this.fix_height(),Upfront.Util.css_support("flex")&&e("html").addClass("flexbox-support"),Upfront.Events.trigger("layout:after_render")},on_click:function(t){var n=Upfront.data.currentEntity;!e(t.target).closest(".upfront-entity_meta").length&&!e(t.target).closest("#upfront-csseditor").length&&Upfront.Events.trigger("entity:settings:deactivate"),Upfront.Events.trigger("entity:contextmenu:deactivate"),n&&(e(t.target).closest(n.el).length||(n.trigger("deactivated",t),n.$el.removeClass("upfront-active_entity"),Upfront.Events.trigger("entity:deactivated",t),Upfront.data.currentEntity=!1)),e(t.target).hasClass("upfront-editable_entities_container")&&Upfront.Events.trigger("entity:deactivated"),e(t.target).hasClass("upfront-region-editing-overlay")&&!e(".upfront-region-bg-setting-open").length&&Upfront.Events.trigger("entity:region:deactivated"),this.remove_selections(),e(t.target).closest(".upfront-module-group-on-edit").length||Upfront.Events.trigger("command:module_group:finish_edit"),e(t.target).closest(".upfront-object-group-on-edit").length||Upfront.Events.trigger("command:object_group:finish_edit")},on_keydown:function(e){var t=Upfront.data.currentEntity;if(typeof t=="undefined"||!t||!t instanceof b||t.$el.find(".redactor-box").length>0||!t.paddingControl)return;if(e.keyCode===38||e.keyCode===40){e.preventDefault(),e.stopPropagation();switch(e.keyCode){case 38:t.paddingControl.on_up_arrow_click();break;case 40:t.paddingControl.on_down_arrow_click()}}},on_mode_switch:function(){Upfront.Application.get_current()!==Upfront.Settings.Application.MODE.RESPONSIVE?this.remove_ruler():this.render_ruler(!0)},on_change_breakpoint:function(e){var t=Upfront.Settings.LayoutEditor.Grid;Upfront.Settings.LayoutEditor.CurrentBreakpoint=e,t.size=e.columns,e.default?(this.$layout.css("width",""),this.render_ruler(!0),this.remove_gutter(),Upfront.Behaviors.LayoutEditor.enable_mergeable()):(this.$layout.width(e.width),this.render_ruler(!1,e.width),this.render_gutter(e.width),Upfront.Behaviors.LayoutEditor.disable_mergeable()),this.update_grid_css()},render_gutter:function(t){var n=this.$el.find(".upfront-layout-gutter");n.length||(n=e('<div class="upfront-layout-gutter"><div class="upfront-layout-gutter-left"></div><div class="upfront-layout-gutter-right"></div></div>'),this.$el.prepend(n)),n.find(".upfront-layout-gutter-left").css("margin-right",Math.ceil(t/2)),n.find(".upfront-layout-gutter-right").css("margin-left",Math.ceil(t/2))},remove_gutter:function(){this.$el.find(".upfront-layout-gutter").remove()},render_ruler:function(t,n){var r=Upfront.Settings.LayoutEditor.Grid,n=t?r.size*r.column_width:n,i=this.$el.find(".upfront-ruler-container"),s=i.find(".upfront-ruler"),o=function(e,t,n){return'<div class="upfront-ruler-mark" style="width:'+t+'px;">'+(n?'<div class="upfront-ruler-mark-num">'+e+"</div>":"")+"</div>"},u;i.length||(i=e('<div class="upfront-ruler-container"></div>'),s=e('<div class="upfront-ruler upfront-ui"></div>'),this.$el.prepend(i),i.prepend(s)),s.empty(),s.css("width",n);for(u=0;u<n;u+=100)s.append(o(u,100,u+40>n?!1:!0));n>u-100&&s.append(o(n,n-(u-100),!0)),this._has_ruler=!0},remove_ruler:function(){this.$el.find(".upfront-ruler-container").remove(),this._has_ruler=!1},update_ruler:function(){if(!this._has_ruler)return;var t=e(window).scrollTop(),n=this.$el.find(".upfront-ruler-container"),r=n.css("position");if(t>0&&r!="fixed"){var i=this.$el.offset(),s=n.offset();n.css({position:"fixed",top:i.top,left:s.left,right:0,width:"auto"})}else t<=0&&r=="fixed"&&n.css({position:"",top:"",left:"",right:"",width:""})},on_window_scroll:function(e){var t=e.data;t.update_ruler()},update_grid_css:function(){var t=Upfront.Settings.LayoutEditor.Grid,n=[],r="#page.upfront-layout-view";n.push(r+" .upfront-grid-layout { width: "+t.column_width*t.size+"px; }"),n.push(r+" .upfront-object { padding: "+t.column_padding+"px; }"),n.push(r+" .upfront-overlay-grid {background-size: 100% "+t.baseline+"px; }"),n.push(r+" .plaintxt_padding {padding: "+t.type_padding+"px; }"),n.push(r+" .upfront-inserted_image-wrapper .wp-caption-text, "+r+" .uinsert-image-wrapper { padding: "+t.column_padding+"px; }"),n.push(r+" .upfront-module-group-bg-padding { margin: "+t.column_padding+"px; }"),e("#upfront-grid-style-inline").length?e("#upfront-grid-style-inline").html(n.join("\n")):e("body").append('<style id="upfront-grid-style-inline">'+n.join("\n")+"</style>")},remove:function(){this.local_view&&this.local_view.remove(),this.local_view=null,e(window).off("resize.upfront_layout"),e(window).off("scroll.upfront_layout"),this.bg_setting&&this.bg_setting.remove(),this.bg_setting=null,Backbone.View.prototype.remove.call(this),this.model=!1,this.options=!1},open_edit_background:function(){this.bg_setting.open().always(function(){})},fix_height:function(){this.$(".upfront-layout").css("min-height",e(window).height())},remove_selections:function(){Upfront.Behaviors.LayoutEditor.selecting||Upfront.Events.trigger("command:selection:remove")}});return{Views:{ObjectView:b,ObjectGroup:w,Module:S,ModuleGroup:x,Wrapper:M,Layout:D,ContextMenu:y,ContextMenuList:m,ContextMenuItem:v,RegionView:k,RegionLightboxView:A,RegionContainerView:N,RegionsView:O},Mixins:{FixedObject:u,FixedObjectInAnonymousModule:a,Anchorable:f}}})}(jQuery),!function(){var e,t,n,r,i,s={}.hasOwnProperty,o=function(e,t){function n(){this.constructor=e}for(var r in t)s.call(t,r)&&(e[r]=t[r]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e};r=function(){function e(){this.options_index=0,this.parsed=[]}return e.prototype.add_node=function(e){return"OPTGROUP"===e.nodeName.toUpperCase()?this.add_group(e):this.add_option(e)},e.prototype.add_group=function(e){var t,n,r,i,s,o;for(t=this.parsed.length,this.parsed.push({array_index:t,group:!0,label:this.escapeExpression(e.label),children:0,disabled:e.disabled}),s=e.childNodes,o=[],r=0,i=s.length;i>r;r++)n=s[r],o.push(this.add_option(n,t,e.disabled));return o},e.prototype.add_option=function(e,t,n){return"OPTION"===e.nodeName.toUpperCase()?(""!==e.text?(null!=t&&(this.parsed[t].children+=1),this.parsed.push({array_index:this.parsed.length,options_index:this.options_index,value:e.value,text:e.text,html:e.innerHTML,selected:e.selected,disabled:n===!0?n:e.disabled,group_array_index:t,classes:e.className,style:e.style.cssText})):this.parsed.push({array_index:this.parsed.length,options_index:this.options_index,empty:!0}),this.options_index+=1):void 0},e.prototype.escapeExpression=function(e){var t,n;return null==e||e===!1?"":/[\&\<\>\"\'\`]/.test(e)?(t={"<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},n=/&(?!\w+;)|[\<\>\"\'\`]/g,e.replace(n,function(e){return t[e]||"&amp;"})):e},e}(),r.select_to_array=function(e){var t,n,i,s,o;for(n=new r,o=e.childNodes,i=0,s=o.length;s>i;i++)t=o[i],n.add_node(t);return n.parsed},t=function(){function e(t,n){this.form_field=t,this.options=null!=n?n:{},e.browser_is_supported()&&(this.is_multiple=this.form_field.multiple,this.set_default_text(),this.set_default_values(),this.setup(),this.set_up_html(),this.register_observers())}return e.prototype.set_default_values=function(){var e=this;return this.click_test_action=function(t){return e.test_active_click(t)},this.activate_action=function(t){return e.activate_field(t)},this.active_field=!1,this.mouse_on_container=!1,this.results_showing=!1,this.result_highlighted=null,this.allow_single_deselect=null!=this.options.allow_single_deselect&&null!=this.form_field.options[0]&&""===this.form_field.options[0].text?this.options.allow_single_deselect:!1,this.disable_search_threshold=this.options.disable_search_threshold||0,this.disable_search=this.options.disable_search||!1,this.enable_split_word_search=null!=this.options.enable_split_word_search?this.options.enable_split_word_search:!0,this.group_search=null!=this.options.group_search?this.options.group_search:!0,this.search_contains=this.options.search_contains||!1,this.single_backstroke_delete=null!=this.options.single_backstroke_delete?this.options.single_backstroke_delete:!0,this.max_selected_options=this.options.max_selected_options||1/0,this.inherit_select_classes=this.options.inherit_select_classes||!1,this.display_selected_options=null!=this.options.display_selected_options?this.options.display_selected_options:!0,this.display_disabled_options=null!=this.options.display_disabled_options?this.options.display_disabled_options:!0},e.prototype.set_default_text=function(){return this.default_text=this.form_field.getAttribute("data-placeholder")?this.form_field.getAttribute("data-placeholder"):this.is_multiple?this.options.placeholder_text_multiple||this.options.placeholder_text||e.default_multiple_text:this.options.placeholder_text_single||this.options.placeholder_text||e.default_single_text,this.results_none_found=this.form_field.getAttribute("data-no_results_text")||this.options.no_results_text||e.default_no_result_text},e.prototype.mouse_enter=function(){return this.mouse_on_container=!0},e.prototype.mouse_leave=function(){return this.mouse_on_container=!1},e.prototype.input_focus=function(){var e=this;if(this.is_multiple){if(!this.active_field)return setTimeout(function(){return e.container_mousedown()},50)}else if(!this.active_field)return this.activate_field()},e.prototype.input_blur=function(){var e=this;return this.mouse_on_container?void 0:(this.active_field=!1,setTimeout(function(){return e.blur_test()},100))},e.prototype.results_option_build=function(e){var t,n,r,i,s;for(t="",s=this.results_data,r=0,i=s.length;i>r;r++)n=s[r],t+=n.group?this.result_add_group(n):this.result_add_option(n),(null!=e?e.first:void 0)&&(n.selected&&this.is_multiple?this.choice_build(n):n.selected&&!this.is_multiple&&this.single_set_selected_text(n.text));return t},e.prototype.result_add_option=function(e){var t,n;return e.search_match?this.include_option_in_results(e)?(t=[],e.disabled||e.selected&&this.is_multiple||t.push("active-result"),!e.disabled||e.selected&&this.is_multiple||t.push("disabled-result"),e.selected&&t.push("result-selected"),null!=e.group_array_index&&t.push("group-option"),""!==e.classes&&t.push(e.classes),n=document.createElement("li"),n.className=t.join(" "),n.style.cssText=e.style,n.setAttribute("data-option-array-index",e.array_index),n.innerHTML=e.search_text,this.outerHTML(n)):"":""},e.prototype.result_add_group=function(e){var t;return e.search_match||e.group_match?e.active_options>0?(t=document.createElement("li"),t.className="group-result",t.innerHTML=e.search_text,this.outerHTML(t)):"":""},e.prototype.results_update_field=function(){return this.set_default_text(),this.is_multiple||this.results_reset_cleanup(),this.result_clear_highlight(),this.results_build(),this.results_showing?this.winnow_results():void 0},e.prototype.reset_single_select_options=function(){var e,t,n,r,i;for(r=this.results_data,i=[],t=0,n=r.length;n>t;t++)e=r[t],e.selected?i.push(e.selected=!1):i.push(void 0);return i},e.prototype.results_toggle=function(){return this.results_showing?this.results_hide():this.results_show()},e.prototype.results_search=function(){return this.results_showing?this.winnow_results():this.results_show()},e.prototype.winnow_results=function(){var e,t,n,r,i,s,o,u,a,f,l,c,h;for(this.no_results_clear(),i=0,o=this.get_search_text(),e=o.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),r=this.search_contains?"":"^",n=new RegExp(r+e,"i"),f=new RegExp(e,"i"),h=this.results_data,l=0,c=h.length;c>l;l++)t=h[l],t.search_match=!1,s=null,this.include_option_in_results(t)&&(t.group&&(t.group_match=!1,t.active_options=0),null!=t.group_array_index&&this.results_data[t.group_array_index]&&(s=this.results_data[t.group_array_index],0===s.active_options&&s.search_match&&(i+=1),s.active_options+=1),(!t.group||this.group_search)&&(t.search_text=t.group?t.label:t.html,t.search_match=this.search_string_match(t.search_text,n),t.search_match&&!t.group&&(i+=1),t.search_match?(o.length&&(u=t.search_text.search(f),a=t.search_text.substr(0,u+o.length)+"</em>"+t.search_text.substr(u+o.length),t.search_text=a.substr(0,u)+"<em>"+a.substr(u)),null!=s&&(s.group_match=!0)):null!=t.group_array_index&&this.results_data[t.group_array_index].search_match&&(t.search_match=!0)));return this.result_clear_highlight(),1>i&&o.length?(this.update_results_content(""),this.no_results(o)):(this.update_results_content(this.results_option_build()),this.winnow_results_set_highlight())},e.prototype.search_string_match=function(e,t){var n,r,i,s;if(t.test(e))return!0;if(this.enable_split_word_search&&(e.indexOf(" ")>=0||0===e.indexOf("["))&&(r=e.replace(/\[|\]/g,"").split(" "),r.length))for(i=0,s=r.length;s>i;i++)if(n=r[i],t.test(n))return!0},e.prototype.choices_count=function(){var e,t,n,r;if(null!=this.selected_option_count)return this.selected_option_count;for(this.selected_option_count=0,r=this.form_field.options,t=0,n=r.length;n>t;t++)e=r[t],e.selected&&(this.selected_option_count+=1);return this.selected_option_count},e.prototype.choices_click=function(e){return e.preventDefault(),this.results_showing||this.is_disabled?void 0:this.results_show()},e.prototype.keyup_checker=function(e){var t,n;switch(t=null!=(n=e.which)?n:e.keyCode,this.search_field_scale(),t){case 8:if(this.is_multiple&&this.backstroke_length<1&&this.choices_count()>0)return this.keydown_backstroke();if(!this.pending_backstroke)return this.result_clear_highlight(),this.results_search();break;case 13:if(e.preventDefault(),this.results_showing)return this.result_select(e);break;case 27:return this.results_showing&&this.results_hide(),!0;case 9:case 38:case 40:case 16:case 91:case 17:break;default:return this.results_search()}},e.prototype.clipboard_event_checker=function(){var e=this;return setTimeout(function(){return e.results_search()},50)},e.prototype.container_width=function(){return null!=this.options.width?this.options.width:""+this.form_field.offsetWidth+"px"},e.prototype.include_option_in_results=function(e){return this.is_multiple&&!this.display_selected_options&&e.selected?!1:!this.display_disabled_options&&e.disabled?!1:e.empty?!1:!0},e.prototype.search_results_touchstart=function(e){return this.touch_started=!0,this.search_results_mouseover(e)},e.prototype.search_results_touchmove=function(e){return this.touch_started=!1,this.search_results_mouseout(e)},e.prototype.search_results_touchend=function(e){return this.touch_started?this.search_results_mouseup(e):void 0},e.prototype.outerHTML=function(e){var t;return e.outerHTML?e.outerHTML:(t=document.createElement("div"),t.appendChild(e),t.innerHTML)},e.browser_is_supported=function(){return"Microsoft Internet Explorer"===window.navigator.appName?document.documentMode>=8:/iP(od|hone)/i.test(window.navigator.userAgent)?!1:/Android/i.test(window.navigator.userAgent)&&/Mobile/i.test(window.navigator.userAgent)?!1:!0},e.default_multiple_text="Select Some Options",e.default_single_text="Select an Option",e.default_no_result_text="No results match",e}(),e=jQuery,e.fn.extend({chosen:function(r){return t.browser_is_supported()?this.each(function(){var t,i;t=e(this),i=t.data("chosen"),"destroy"===r&&i?i.destroy():i||t.data("chosen",new n(this,r))}):this}}),n=function(t){function n(){return i=n.__super__.constructor.apply(this,arguments)}return o(n,t),n.prototype.setup=function(){return this.form_field_jq=e(this.form_field),this.current_selectedIndex=this.form_field.selectedIndex,this.is_rtl=this.form_field_jq.hasClass("chosen-rtl")},n.prototype.set_up_html=function(){var t,n;return t=["chosen-container"],t.push("chosen-container-"+(this.is_multiple?"multi":"single")),this.inherit_select_classes&&this.form_field.className&&t.push(this.form_field.className),this.is_rtl&&t.push("chosen-rtl"),n={"class":t.join(" "),style:"width: "+this.container_width()+";",title:this.form_field.title},this.form_field.id.length&&(n.id=this.form_field.id.replace(/[^\w]/g,"_")+"_chosen"),this.container=e("<div />",n),this.is_multiple?this.container.html('<ul class="chosen-choices"><li class="search-field"><input type="text" value="'+this.default_text+'" class="default" autocomplete="off" style="width:25px;" /></li></ul><div class="chosen-drop"><ul class="chosen-results"></ul></div>'):this.container.html('<a class="chosen-single chosen-default" tabindex="-1"><span>'+this.default_text+'</span><div><b></b></div></a><div class="chosen-drop"><div class="chosen-search"><input type="text" autocomplete="off" /></div><ul class="chosen-results"></ul></div>'),this.form_field_jq.hide().after(this.container),this.dropdown=this.container.find("div.chosen-drop").first(),this.search_field=this.container.find("input").first(),this.search_results=this.container.find("ul.chosen-results").first(),this.search_field_scale(),this.search_no_results=this.container.find("li.no-results").first(),this.is_multiple?(this.search_choices=this.container.find("ul.chosen-choices").first(),this.search_container=this.container.find("li.search-field").first()):(this.search_container=this.container.find("div.chosen-search").first(),this.selected_item=this.container.find(".chosen-single").first()),this.results_build(),this.set_tab_index(),this.set_label_behavior(),this.form_field_jq.trigger("chosen:ready",{chosen:this})},n.prototype.register_observers=function(){var e=this;return this.container.bind("mousedown.chosen",function(t){e.container_mousedown(t)}),this.container.bind("mouseup.chosen",function(t){e.container_mouseup(t)}),this.container.bind("mouseenter.chosen",function(t){e.mouse_enter(t)}),this.container.bind("mouseleave.chosen",function(t){e.mouse_leave(t)}),this.search_results.bind("mouseup.chosen",function(t){e.search_results_mouseup(t)}),this.search_results.bind("mouseover.chosen",function(t){e.search_results_mouseover(t)}),this.search_results.bind("mouseout.chosen",function(t){e.search_results_mouseout(t)}),this.search_results.bind("mousewheel.chosen DOMMouseScroll.chosen",function(t){e.search_results_mousewheel(t)}),this.search_results.bind("touchstart.chosen",function(t){e.search_results_touchstart(t)}),this.search_results.bind("touchmove.chosen",function(t){e.search_results_touchmove(t)}),this.search_results.bind("touchend.chosen",function(t){e.search_results_touchend(t)}),this.form_field_jq.bind("chosen:updated.chosen",function(t){e.results_update_field(t)}),this.form_field_jq.bind("chosen:activate.chosen",function(t){e.activate_field(t)}),this.form_field_jq.bind("chosen:open.chosen",function(t){e.container_mousedown(t)}),this.form_field_jq.bind("chosen:close.chosen",function(t){e.input_blur(t)}),this.search_field.bind("blur.chosen",function(t){e.input_blur(t)}),this.search_field.bind("keyup.chosen",function(t){e.keyup_checker(t)}),this.search_field.bind("keydown.chosen",function(t){e.keydown_checker(t)}),this.search_field.bind("focus.chosen",function(t){e.input_focus(t)}),this.search_field.bind("cut.chosen",function(t){e.clipboard_event_checker(t)}),this.search_field.bind("paste.chosen",function(t){e.clipboard_event_checker(t)}),this.is_multiple?this.search_choices.bind("click.chosen",function(t){e.choices_click(t)}):this.container.bind("click.chosen",function(e){e.preventDefault()})},n.prototype.destroy=function(){return e(this.container[0].ownerDocument).unbind("click.chosen",this.click_test_action),this.search_field[0].tabIndex&&(this.form_field_jq[0].tabIndex=this.search_field[0].tabIndex),this.container.remove(),this.form_field_jq.removeData("chosen"),this.form_field_jq.show()},n.prototype.search_field_disabled=function(){return this.is_disabled=this.form_field_jq[0].disabled,this.is_disabled?(this.container.addClass("chosen-disabled"),this.search_field[0].disabled=!0,this.is_multiple||this.selected_item.unbind("focus.chosen",this.activate_action),this.close_field()):(this.container.removeClass("chosen-disabled"),this.search_field[0].disabled=!1,this.is_multiple?void 0:this.selected_item.bind("focus.chosen",this.activate_action))},n.prototype.container_mousedown=function(t){return this.is_disabled||(t&&"mousedown"===t.type&&!this.results_showing&&t.preventDefault(),null!=t&&e(t.target).hasClass("search-choice-close"))?void 0:(this.active_field?this.is_multiple||!t||e(t.target)[0]!==this.selected_item[0]&&!e(t.target).parents("a.chosen-single").length||(t.preventDefault(),this.results_toggle()):(this.is_multiple&&this.search_field.val(""),e(this.container[0].ownerDocument).bind("click.chosen",this.click_test_action),this.results_show()),this.activate_field())},n.prototype.container_mouseup=function(e){return"ABBR"!==e.target.nodeName||this.is_disabled?void 0:this.results_reset(e)},n.prototype.search_results_mousewheel=function(e){var t;return e.originalEvent&&(t=-e.originalEvent.wheelDelta||e.originalEvent.detail),null!=t?(e.preventDefault(),"DOMMouseScroll"===e.type&&(t=40*t),this.search_results.scrollTop(t+this.search_results.scrollTop())):void 0},n.prototype.blur_test=function(){return!this.active_field&&this.container.hasClass("chosen-container-active")?this.close_field():void 0},n.prototype.close_field=function(){return e(this.container[0].ownerDocument).unbind("click.chosen",this.click_test_action),this.active_field=!1,this.results_hide(),this.container.removeClass("chosen-container-active"),this.clear_backstroke(),this.show_search_field_default(),this.search_field_scale()},n.prototype.activate_field=function(){return this.container.addClass("chosen-container-active"),this.active_field=!0,this.search_field.val(this.search_field.val()),this.search_field.focus()},n.prototype.test_active_click=function(t){var n;return n=e(t.target).closest(".chosen-container"),n.length&&this.container[0]===n[0]?this.active_field=!0:this.close_field()},n.prototype.results_build=function(){return this.parsing=!0,this.selected_option_count=null,this.results_data=r.select_to_array(this.form_field),this.is_multiple?this.search_choices.find("li.search-choice").remove():this.is_multiple||(this.single_set_selected_text(),this.disable_search||this.form_field.options.length<=this.disable_search_threshold?(this.search_field[0].readOnly=!0,this.container.addClass("chosen-container-single-nosearch")):(this.search_field[0].readOnly=!1,this.container.removeClass("chosen-container-single-nosearch"))),this.update_results_content(this.results_option_build({first:!0})),this.search_field_disabled(),this.show_search_field_default(),this.search_field_scale(),this.parsing=!1},n.prototype.result_do_highlight=function(e){var t,n,r,i,s;if(e.length){if(this.result_clear_highlight(),this.result_highlight=e,this.result_highlight.addClass("highlighted"),r=parseInt(this.search_results.css("maxHeight"),10),s=this.search_results.scrollTop(),i=r+s,n=this.result_highlight.position().top+this.search_results.scrollTop(),t=n+this.result_highlight.outerHeight(),t>=i)return this.search_results.scrollTop(t-r>0?t-r:0);if(s>n)return this.search_results.scrollTop(n)}},n.prototype.result_clear_highlight=function(){return this.result_highlight&&this.result_highlight.removeClass("highlighted"),this.result_highlight=null},n.prototype.results_show=function(){return this.is_multiple&&this.max_selected_options<=this.choices_count()?(this.form_field_jq.trigger("chosen:maxselected",{chosen:this}),!1):(this.container.addClass("chosen-with-drop"),this.results_showing=!0,this.search_field.focus(),this.search_field.val(this.search_field.val()),this.winnow_results(),this.form_field_jq.trigger("chosen:showing_dropdown",{chosen:this}))},n.prototype.update_results_content=function(e){return this.search_results.html(e)},n.prototype.results_hide=function(){return this.results_showing&&(this.result_clear_highlight(),this.container.removeClass("chosen-with-drop"),this.form_field_jq.trigger("chosen:hiding_dropdown",{chosen:this})),this.results_showing=!1},n.prototype.set_tab_index=function(){var e;return this.form_field.tabIndex?(e=this.form_field.tabIndex,this.form_field.tabIndex=-1,this.search_field[0].tabIndex=e):void 0},n.prototype.set_label_behavior=function(){var t=this;return this.form_field_label=this.form_field_jq.parents("label"),!this.form_field_label.length&&this.form_field.id.length&&(this.form_field_label=e("label[for='"+this.form_field.id+"']")),this.form_field_label.length>0?this.form_field_label.bind("click.chosen",function(e){return t.is_multiple?t.container_mousedown(e):t.activate_field()}):void 0},n.prototype.show_search_field_default=function(){return this.is_multiple&&this.choices_count()<1&&!this.active_field?(this.search_field.val(this.default_text),this.search_field.addClass("default")):(this.search_field.val(""),this.search_field.removeClass("default"))},n.prototype.search_results_mouseup=function(t){var n;return n=e(t.target).hasClass("active-result")?e(t.target):e(t.target).parents(".active-result").first(),n.length?(this.result_highlight=n,this.result_select(t),this.search_field.focus()):void 0},n.prototype.search_results_mouseover=function(t){var n;return n=e(t.target).hasClass("active-result")?e(t.target):e(t.target).parents(".active-result").first(),n?this.result_do_highlight(n):void 0},n.prototype.search_results_mouseout=function(t){return e(t.target).hasClass("active-result")?this.result_clear_highlight():void 0},n.prototype.choice_build=function(t){var n,r,i=this;return n=e("<li />",{"class":"search-choice"}).html("<span>"+t.html+"</span>"),t.disabled?n.addClass("search-choice-disabled"):(r=e("<a />",{"class":"search-choice-close","data-option-array-index":t.array_index}),r.bind("click.chosen",function(e){return i.choice_destroy_link_click(e)}),n.append(r)),this.search_container.before(n)},n.prototype.choice_destroy_link_click=function(t){return t.preventDefault(),t.stopPropagation(),this.is_disabled?void 0:this.choice_destroy(e(t.target))},n.prototype.choice_destroy=function(e){return this.result_deselect(e[0].getAttribute("data-option-array-index"))?(this.show_search_field_default(),this.is_multiple&&this.choices_count()>0&&this.search_field.val().length<1&&this.results_hide(),e.parents("li").first().remove(),this.search_field_scale()):void 0},n.prototype.results_reset=function(){return this.reset_single_select_options(),this.form_field.options[0].selected=!0,this.single_set_selected_text(),this.show_search_field_default(),this.results_reset_cleanup(),this.form_field_jq.trigger("change"),this.active_field?this.results_hide():void 0},n.prototype.results_reset_cleanup=function(){return this.current_selectedIndex=this.form_field.selectedIndex,this.selected_item.find("abbr").remove()},n.prototype.result_select=function(e){var t,n;return this.result_highlight?(t=this.result_highlight,this.result_clear_highlight(),this.is_multiple&&this.max_selected_options<=this.choices_count()?(this.form_field_jq.trigger("chosen:maxselected",{chosen:this}),!1):(this.is_multiple?t.removeClass("active-result"):this.reset_single_select_options(),n=this.results_data[t[0].getAttribute("data-option-array-index")],n.selected=!0,this.form_field.options[n.options_index].selected=!0,this.selected_option_count=null,this.is_multiple?this.choice_build(n):this.single_set_selected_text(n.text),(e.metaKey||e.ctrlKey)&&this.is_multiple||this.results_hide(),this.search_field.val(""),(this.is_multiple||this.form_field.selectedIndex!==this.current_selectedIndex)&&this.form_field_jq.trigger("change",{selected:this.form_field.options[n.options_index].value}),this.current_selectedIndex=this.form_field.selectedIndex,this.search_field_scale())):void 0},n.prototype.single_set_selected_text=function(e){return null==e&&(e=this.default_text),e===this.default_text?this.selected_item.addClass("chosen-default"):(this.single_deselect_control_build(),this.selected_item.removeClass("chosen-default")),this.selected_item.find("span").text(e)},n.prototype.result_deselect=function(e){var t;return t=this.results_data[e],this.form_field.options[t.options_index].disabled?!1:(t.selected=!1,this.form_field.options[t.options_index].selected=!1,this.selected_option_count=null,this.result_clear_highlight(),this.results_showing&&this.winnow_results(),this.form_field_jq.trigger("change",{deselected:this.form_field.options[t.options_index].value}),this.search_field_scale(),!0)},n.prototype.single_deselect_control_build=function(){return this.allow_single_deselect?(this.selected_item.find("abbr").length||this.selected_item.find("span").first().after('<abbr class="search-choice-close"></abbr>'),this.selected_item.addClass("chosen-single-with-deselect")):void 0},n.prototype.get_search_text=function(){return this.search_field.val()===this.default_text?"":e("<div/>").text(e.trim(this.search_field.val())).html()},n.prototype.winnow_results_set_highlight=function(){var e,t;return t=this.is_multiple?[]:this.search_results.find(".result-selected.active-result"),e=t.length?t.first():this.search_results.find(".active-result").first(),null!=e?this.result_do_highlight(e):void 0},n.prototype.no_results=function(t){var n;return n=e('<li class="no-results">'+this.results_none_found+' "<span></span>"</li>'),n.find("span").first().html(t),this.search_results.append(n),this.form_field_jq.trigger("chosen:no_results",{chosen:this})},n.prototype.no_results_clear=function(){return this.search_results.find(".no-results").remove()},n.prototype.keydown_arrow=function(){var e;return this.results_showing&&this.result_highlight?(e=this.result_highlight.nextAll("li.active-result").first())?this.result_do_highlight(e):void 0:this.results_show()},n.prototype.keyup_arrow=function(){var e;return this.results_showing||this.is_multiple?this.result_highlight?(e=this.result_highlight.prevAll("li.active-result"),e.length?this.result_do_highlight(e.first()):(this.choices_count()>0&&this.results_hide(),this.result_clear_highlight())):void 0:this.results_show()},n.prototype.keydown_backstroke=function(){var e;return this.pending_backstroke?(this.choice_destroy(this.pending_backstroke.find("a").first()),this.clear_backstroke()):(e=this.search_container.siblings("li.search-choice").last(),e.length&&!e.hasClass("search-choice-disabled")?(this.pending_backstroke=e,this.single_backstroke_delete?this.keydown_backstroke():this.pending_backstroke.addClass("search-choice-focus")):void 0)},n.prototype.clear_backstroke=function(){return this.pending_backstroke&&this.pending_backstroke.removeClass("search-choice-focus"),this.pending_backstroke=null},n.prototype.keydown_checker=function(e){var t,n;switch(t=null!=(n=e.which)?n:e.keyCode,this.search_field_scale(),8!==t&&this.pending_backstroke&&this.clear_backstroke(),t){case 8:this.backstroke_length=this.search_field.val().length;break;case 9:this.results_showing&&!this.is_multiple&&this.result_select(e),this.mouse_on_container=!1;break;case 13:e.preventDefault();break;case 38:e.preventDefault(),this.keyup_arrow();break;case 40:e.preventDefault(),this.keydown_arrow()}},n.prototype.search_field_scale=function(){var t,n,r,i,s,o,u,f,l;if(this.is_multiple){for(r=0,u=0,s="position:absolute; left: -1000px; top: -1000px; display:none;",o=["font-size","font-style","font-weight","font-family","line-height","text-transform","letter-spacing"],f=0,l=o.length;l>f;f++)i=o[f],s+=i+":"+this.search_field.css(i)+";";return t=e("<div />",{style:s}),t.text(this.search_field.val()),e("body").append(t),u=t.width()+25,t.remove(),n=this.container.outerWidth(),u>n-10&&(u=n-10),this.search_field.css({width:u+"px"})}},n}(t)}.call(this),define("chosen",function(){}),function(e){define("scripts/upfront/global-event-handlers",[],function(){e("body").on("mouseup",function(){e(".upfront-field-select").removeClass("upfront-field-select-expanded")});var t='#page input[type="text"], #page input[type="email"], #page input[type="password"], #page textarea, #page select, #page .upfront-field-select';e("body").on("mouseover",t,function(t){try{e(t.target).closest(".ui-draggable").draggable("disable")}catch(t){}}),e("body").on("mouseout",t,function(t){try{e(t.target).closest(".ui-draggable").draggable("enable")}catch(t){}}),e(document).on("click",function(t){if(e(".sp-container").length===e(".sp-container.sp-hidden").length)return;e(".sp-container").not(".sp-hidden").each(function(){var t=e(this),n=t.data("sp-options");if(!n||!n.flat){var r=t.parent().find(".sp-replacer");r.removeClass("sp-active"),t.addClass("sp-hidden"),setTimeout(function(){r.removeClass("sp-active"),t.addClass("sp-hidden")},10)}})}),/i(Pad|Phone|Pod)/g.test(navigator.userAgent)&&e(window).on("resize",function(t){setTimeout(function(){e.magnificPopup.instance.updateSize()},500)}),e(document).one("upfront-load",function(){Upfront.Events.once("Upfront:loaded",function(){e(document).on("click","a",function(t){var n,r,i,s,o;if(t.isDefaultPrevented())return;n=e(t.currentTarget).data("bypass");if(n)return;i=t.target,s=i.pathname,r=i.getAttribute("href"),o=i.search;if(r=="#"||i.origin!=window.location.origin||s==window.location.pathname&&o==window.location.search)return;if(e(t.target).closest(".redactor_box").length||e(t.target).parents(".redactor-editor").length)return;Upfront.mainData.site.indexOf("localhost")>-1&&Upfront.mainData.site+"/"===i.origin+s&&(s="/"),window.location.search.indexOf("dev=true")>-1&&o.indexOf("dev=true")===-1&&(o===""&&(o="?"),o+="dev=true"),t.preventDefault(),(!Upfront.PreviewUpdate._is_dirty||confirm(Upfront.Settings.l10n.global.application.navigation_confirm))&&Upfront.Application.navigate(s+o,{trigger:!0})}).on("keydown",function(t){if(t.which==8){var n=t.target.tagName.toUpperCase();n!="INPUT"&&n!="TEXTAREA"&&!e(t.target).closest(".redactor_box").length&&!t.target.contentEditable&&t.preventDefault()}})})})})}(jQuery),function(e){define("scripts/upfront/inline-panels/panels",[],function(){var t=Backbone.View.extend({className:"upfront-inline-panels upfront-ui",initialize:function(){this.panels=_([])},render:function(){var t=this,n=typeof this.panels=="function"?this.panels():this.panels,r=e('<div class="upfront-inline-panels-wrap" />');this.$el.html(""),n.each(function(e){if(!e)return;e.panels_view=t,e.render(),e.delegateEvents(),r.append(e.el)}),this.$el.append(r),typeof this.on_render=="function"&&this.on_render()},on_active:function(){e(".upfront-inline-panels-active").removeClass("upfront-inline-panels-active"),this.$el.addClass("upfront-inline-panels-active")},remove:function(){var e=typeof this.panels=="function"?this.panels():this.panels;e&&e.each(function(e){e.remove()}),Backbone.View.prototype.remove.call(this)}});return t})}(jQuery),define("scripts/upfront/inline-panels/panel",[],function(){var e=Backbone.View.extend({className:"upfront-inline-panel upfront-no-select",position_v:"top",position_h:"center",initialize:function(){this.items=_([])},render:function(){var e=typeof this.items=="function"?this.items():this.items,t=["upfront-inline-panel-"+this.position_v,"upfront-inline-panel-"+this.position_v+"-"+this.position_h],n=0,r=0;this.$el.html(""),this.collapsedParent=!1,e.each(function(e){e.panel_view=this,e.render(),e.delegateEvents(),this.$el.append(e.el),e.collapsed&&(t.push("upfront-inline-panel-collapsed-parent"),this.collapsedParent=!0),this.position_v==="center"?(n=e.width>n?e.width:n,r+=e.height):(n+=e.width,r=e.height>r?e.height:r),typeof e.active=="function"&&e.active()==1?e.$el.addClass("active"):typeof e.active=="function"&&e.active()==0&&e.$el.removeClass("active")},this),this.$el.addClass(this.className+" "+t.join(" ")),this.collapsedParent&&(r=13),this.$el.css({width:n,height:r})},remove:function(){var e=typeof this.items=="function"?this.items():this.items;e&&e.each(function(e){e.remove()}),Backbone.View.prototype.remove.call(this)}});return e}),define("scripts/upfront/inline-panels/item",[],function(){var e=Backbone.View.extend({className:"upfront-inline-panel-item",width:38,height:38,icon_class:"upfront-icon-region",initialize:function(e){this.options=e||{},this.label=this.options.label},render_icon:function(){var e=typeof this.icon=="function"?this.icon():this.icon;if(!e)return;var t=this,n=e.split(" "),r=["upfront-icon"],i=this.$el.find(".upfront-icon");_.each(n,function(e){r.push(t.icon_class+"-"+e)}),i.length?i.attr("class",r.join(" ")):this.$el.append('<i class="'+r.join(" ")+'" />')},render_label:function(){var e=typeof this.label=="function"?this.label():this.label;if(!e)return;var t=this.$el.find(".upfront-inline-panel-item-label");this.$el.addClass("labeled"),t.length?t.html(e):this.$el.append('<span class="upfront-inline-panel-item-label">'+e+"</span>")},render_tooltip:function(){var e=typeof this.tooltip=="function"?this.tooltip():this.tooltip;if(!e)return;this.$el.attr("title",e)},render:function(){this.render_icon(),this.render_label(),this.render_tooltip(),this.$el.css({width:this.width,height:this.height}),this.$el.attr("id",this.id),typeof this.on_render=="function"&&this.on_render()},open_modal:function(e,t){if(!this.modal){var n=this,r=this.$el.closest(".upfront-region-container");this.modal=new Upfront.Views.Editor.Modal({to:r,top:60}),this.modal.render(),r.append(this.modal.$el)}return this.listenToOnce(Upfront.Events,"entity:region:deactivated",function(){n.close_modal(!1)}),this.modal.open(e,this,t)},close_modal:function(e){return this.modal.close(e)},remove:function(){this.panel_view=!1}});return e}),function(e){define("scripts/upfront/inline-panels/item-multi",["scripts/upfront/inline-panels/item"],function(t){var n=t.extend({events:{"click >.upfront-icon":"toggle_subitem"},initialize:function(){this.sub_items={},this.listenTo(Upfront.Events,"entity:region:activated",this.on_region_change)},get_selected_item:function(){},get_default_item:function(){},get_selected_icon:function(e){return e+"-active"},set_selected_item:function(){},select_item:function(e){this.set_selected_item(e),this.render()},render:function(){var t=this,n=this.get_selected_item()||this.get_default_item(),r=e('<div class="upfront-inline-panel-subitem" />');this.$el.html(""),this.icon=this.get_selected_icon(n),this.render_icon(),this.render_tooltip(),_.each(this.sub_items,function(e,i){e.panel_view=t.panel_view,e.parent_view=t,e.render(),e.delegateEvents(),n!=i&&r.append(e.el)}),r.append(this.sub_items[n].el),this.$el.append(r)},toggle_subitem:function(){this.$el.hasClass("upfront-inline-panel-subitem-active")?this.close_subitem():this.open_subitem()},open_subitem:function(){this.$el.addClass("upfront-inline-panel-subitem-active"),this.$el.removeClass("upfront-inline-panel-subitem-inactive")},close_subitem:function(){this.$el.addClass("upfront-inline-panel-subitem-inactive"),this.$el.removeClass("upfront-inline-panel-subitem-active")},on_region_change:function(e){e.model!=this.model&&this.close_subitem()},remove:function(){this.sub_items&&_.each(this.sub_items,function(e){e.remove()}),this.panel_view=!1,Backbone.View.prototype.remove.call(this)}});return n})}(jQuery),function(e){define("scripts/upfront/inline-panels/control",["scripts/upfront/inline-panels/item"],function(t){var n=t.extend({events:{click:"clicked"},initialize:function(e){this.options=e||{},this.label=this.options.label,this.icon=this.options.icon},clicked:function(t){var n=e(t.target);t.preventDefault(),t.stopPropagation(),this.$el.siblings(".upfront-inline-panel-subitem-active").removeClass("upfront-inline-panel-subitem-active"),n.hasClass("upfront-icon-region-settings")||(n.closest(".upfront-inline-panel-item").hasClass("upfront-control-dialog-open")?n.closest(".upfront-wrapper").removeClass("upfront-inline-panel-item-open"):n.closest(".upfront-wrapper").addClass("upfront-inline-panel-item-open")),this.trigger("click",t)},setIsSelected:function(e){if(e){this.$el.addClass("inline-panel-item-selected");return}this.$el.removeClass("inline-panel-item-selected")}});return n})}(jQuery),function(e){define("scripts/upfront/inline-panels/multi-control",["scripts/upfront/inline-panels/item-multi"],function(t){var n=t.extend({events:{click:"clicked","click .upfront-inline-panel-item":"selectItem"},render:function(){t.prototype.render.call(this,arguments)},clicked:function(t){var n=this.$el.children(".upfront-inline-panel-subitem");if(e(t.target).closest(n).length>0)return;this.trigger("click",t),this.toggle_subitem()},get_selected_item:function(){return this.selected},selectItem:function(t){var n=!1,r=e(t.target).is("i")?e(t.target):e(t.target).find("i");_.each(this.sub_items,function(e,t){r.hasClass("upfront-icon-region-"+e.icon)&&(n=t)}),n&&(this.selected=n,this.render(),this.trigger("select",n))}});return n})}(jQuery),function(e){define("scripts/upfront/inline-panels/tooltip-control",["scripts/upfront/inline-panels/item","scripts/upfront/inline-panels/control"],function(t,n){var r=Upfront.mainData.l10n.image_element,i=n.extend({multiControl:!0,events:{click:"onClickControl","click .upfront-inline-panel-item":"selectItem"},initialize:function(){var t=this;e(document).click(function(n){var r=e(n.target);r.closest("#page").length&&r[0]!==t.el&&!r.closest(t.el).length&&t.isOpen&&t.close()})},onClickControl:function(e){if(this.isDisabled)return;e.preventDefault(),this.clicked(e),this.$el.siblings(".upfront-control-dialog-open").removeClass("upfront-control-dialog-open"),this.isOpen?this.close():this.open()},open:function(){this.isOpen=!0,this.$el.addClass("upfront-control-dialog-open")},close:function(){this.isOpen=!1,this.$el.removeClass("upfront-control-dialog-open")},render:function(){t.prototype.render.call(this,arguments);var n=this.$(".uimage-caption-control"),r=this,i;this.$el.hasClass("uimage-caption-control-item")||this.$el.addClass("uimage-caption-control-item"),n.length||(n=e('<div class="uimage-caption-control inline-panel-control-dialog"></div>'),this.$el.append(n)),_.each(this.sub_items,function(e,t){t===r.selected?e.setIsSelected(!0):e.setIsSelected(!1),e.render(),e.$el.find("i").addClass("upfront-icon-region-caption"),n.append(e.$el),r.listenTo(e,"click",r.selectItem)}),i=this.sub_items[this.selected],i&&(typeof i.icon!="undefined"?this.$el.children("i").addClass("upfront-icon-region-"+i.icon):typeof i.label!="undefined"&&this.$el.find(".tooltip-content").append(": "+i.label))},get_selected_item:function(){return this.selected},selectItem:function(t){var n=!1,r=e(t.target).is("i")?e(t.target):e(t.target).find("i");_.each(this.sub_items,function(i,s){r.hasClass("upfront-icon-region-"+i.icon)&&(n=s),!n&&e(t.target).closest(".upfront-inline-panel-item").attr("id")===i.id&&(n=s)}),n&&(this.selected=n,this.render(),this.trigger("select",n))},setDisabled:function(e){this.isDisabled=e,e?this.tooltip=r.ctrl.caption_position_disabled:this.tooltip=r.ctrl.caption_display}});return i})}(jQuery),function(e){define("scripts/upfront/inline-panels/padding-control",["scripts/upfront/inline-panels/item","scripts/upfront/inline-panels/control"],function(t,n){var r=Upfront.mainData.l10n.global.views,i=n.extend({multiControl:!0,events:{click:"onClickControl"},initialize:function(){var t=this;e(document).click(function(n){var r=e(n.target);r.closest("#page").length&&r[0]!==t.el&&!r.closest(t.el).length&&t.isOpen&&t.close()}),e(document).mouseup(function(n){var r=e(n.target),i=Upfront.data.currentEntity;r.closest("#page").length&&r[0]!==t.el&&!r.closest(t.el).length&&typeof i!="undefined"&&typeof i.padding_hint_locked!="undefined"&&i.padding_hint_locked&&(i.padding_hint_locked=!1,i.top_padding_hint_timer=setTimeout(function(){typeof i.hide_top_padding_hint=="function"&&i.hide_top_padding_hint()},1e3),i.bottom_padding_hint_timer=setTimeout(function(){typeof i.hide_bottom_padding_hint=="function"&&i.hide_bottom_padding_hint()},1e3))}),this.default_padding={top:!1,bottom:!1},this.listenTo(Upfront.Events,"upfront:paddings:updated",this.refresh)},onClickControl:function(t){var n=e(t.target);if(this.isDisabled)return;t.preventDefault();if(!n.closest(".upfront-icon-region-padding").length){t.stopPropagation();return}this.clicked(t),this.$el.siblings(".upfront-control-dialog-open").removeClass("upfront-control-dialog-open"),this.isOpen?this.close():this.open()},open:function(){this.isOpen=!0,this.refresh(),this.$el.addClass("upfront-control-dialog-open")},close:function(){this.isOpen=!1,this.$el.removeClass("upfront-control-dialog-open"),this.$el.closest(".upfront-inline-panel-item-open").removeClass("upfront-inline-panel-item-open")},on_render:function(){var t=this,n=t.$(".upfront-padding-control"),i=e('<div class="upfront-padding-container">'+r.top_padding_short+'<span class="upfront-padding-value"></span></div>'),s=e('<div class="upfront-padding-container">'+r.bottom_padding_short+'<span class="upfront-padding-value"></span></div>'),o=e('<div class="upfront-padding-container"></div>'),u=Upfront.Settings.LayoutEditor.Grid.column_padding;t.$el.hasClass("upfront-padding-control-item")||t.$el.addClass("upfront-padding-control-item"),n.length===0&&(n=e('<div class="upfront-padding-control inline-panel-control-dialog"></div>'),t.$el.append(n)),t.default_padding.top===!1&&(t.default_padding.top=u),t.default_padding.bottom===!1&&(t.default_padding.bottom=u),t.paddingTop=new Upfront.Views.Editor.Field.Slider({model:this.model,use_breakpoint_property:!0,property:"top_padding_num",label:"",default_value:this.model.get_breakpoint_property_value("top_padding_num")||t.default_padding.top,min:0,max:200,step:5,valueTextFilter:function(e){return t.paddingTop.$el.parent(".upfront-padding-container").find(".upfront-padding-value").html(e),""},change:function(){var e=this.get_value();this.model.set_breakpoint_property("use_padding","yes",!0),this.model.set_breakpoint_property("lock_padding","",!0),this.model.set_breakpoint_property("top_padding_use","yes",!0),this.model.set_breakpoint_property("top_padding_slider",e,!0),this.model.set_breakpoint_property("top_padding_num",e),Upfront.Events.trigger("upfront:paddings:updated",this.model,Upfront.data.currentEntity),Upfront.Events.trigger("upfront:paddings:top:updated",this.model,Upfront.data.currentEntity)}}),t.paddingBottom=new Upfront.Views.Editor.Field.Slider({model:this.model,use_breakpoint_property:!0,property:"bottom_padding_num",label:"",default_value:this.model.get_breakpoint_property_value("bottom_padding_num")||t.default_padding.bottom,min:0,max:200,step:5,valueTextFilter:function(e){return t.paddingBottom.$el.parent(".upfront-padding-container").find(".upfront-padding-value").html(e),""},change:function(){var e=this.get_value();this.model.set_breakpoint_property("use_padding","yes",!0),this.model.set_breakpoint_property("lock_padding","",!0),this.model.set_breakpoint_property("bottom_padding_use","yes",!0),this.model.set_breakpoint_property("bottom_padding_slider",e,!0),this.model.set_breakpoint_property("bottom_padding_num",e),Upfront.Events.trigger("upfront:paddings:updated",this.model,Upfront.data.currentEntity),Upfront.Events.trigger("upfront:paddings:bottom:updated",this.model,Upfront.data.currentEntity)}}),n.html(""),t.paddingTop.render(),i.append(t.paddingTop.$el),n.append(i),t.paddingBottom.render(),s.append(t.paddingBottom.$el),n.append(s),t.model.attributes.modules===undefined&&!t.model.get_property_value_by_name("code_selection_type")&&(t.advancedPadding=new Upfront.Views.Editor.Field.Button({className:"upfront-field-wrap upfront-field-wrap-button upfront-field-advanced-padding",compact:!0,label:r.advanced_padding,name:"advanced-padding"}),t.advancedPadding.render(),o.append(t.advancedPadding.$el),n.append(o)),i.on("mousedown",function(){Upfront.data.currentEntity.padding_hint_locked=!0}).on("mouseup",function(){var e=Upfront.data.currentEntity;e.padding_hint_locked=!1,e.top_padding_hint_timer=setTimeout(function(){typeof e.hide_top_padding_hint=="function"&&e.hide_top_padding_hint()},1e3)}),s.on("mousedown",function(){Upfront.data.currentEntity.padding_hint_locked=!0}).on("mouseup",function(){var e=Upfront.data.currentEntity;e.padding_hint_locked=!1,e.bottom_padding_hint_timer=setTimeout(function(){typeof e.hide_bottom_padding_hint=="function"&&e.hide_bottom_padding_hint()},1e3)})},refresh:function(e){if(e&&e!==this.model)return;var t=Upfront.Settings.LayoutEditor.Grid.column_padding,n=this.model.get_breakpoint_property_value("top_padding_use",!0),r=this.model.get_breakpoint_property_value("bottom_padding_use",!0),i,s;this.default_padding.top===!1&&(this.default_padding.top=t),this.default_padding.bottom===!1&&(this.default_padding.bottom=t),i=n?this.model.get_breakpoint_property_value("top_padding_num",!0):this.default_padding.top,s=r?this.model.get_breakpoint_property_value("bottom_padding_num",!0):this.default_padding.bottom,typeof this.paddingTop!="undefined"&&(this.paddingTop.get_field().val(i),typeof this.paddingTop.$el.find("#"+this.paddingTop.get_field_id()).slider("instance")!="undefined"&&this.paddingTop.$el.find("#"+this.paddingTop.get_field_id()).slider("value",i),this.paddingTop.$el.parent(".upfront-padding-container").find(".upfront-padding-value").html(i)),typeof this.paddingBottom!="undefined"&&(this.paddingBottom.get_field().val(s),typeof this.paddingBottom.$el.find("#"+this.paddingBottom.get_field_id()).slider("instance")!="undefined"&&this.paddingBottom.$el.find("#"+this.paddingBottom.get_field_id()).slider("value",s),this.paddingBottom.$el.parent(".upfront-padding-container").find(".upfront-padding-value").html(s))},on_up_arrow_click:function(){if(typeof this.paddingTop!="undefined"){var e=parseInt(this.model.get_breakpoint_property_value("top_padding_num",!0))-5;e=e<0?0:e,this.model.set_breakpoint_property("top_padding_use","yes"),this.model.set_breakpoint_property("top_padding_num",e),this.model.set_breakpoint_property("top_padding_slider",e),this.refresh()}},on_down_arrow_click:function(){if(typeof this.paddingTop!="undefined"){var e=parseInt(this.model.get_breakpoint_property_value("top_padding_num",!0))+5;this.model.set_breakpoint_property("top_padding_use","yes"),this.model.set_breakpoint_property("top_padding_num",e),this.model.set_breakpoint_property("top_padding_slider",e),this.refresh()}}});return i})}(jQuery),function(e){define("scripts/upfront/inline-panels/collapsed-multi-control",["scripts/upfront/inline-panels/control","scripts/upfront/inline-panels/multi-control"],function(t,n){var r=n.extend({collapsed:!0,className:"upfront-inline-panel-item inline-panel-collapsed-control",render:function(){if(!this.sub_items.collapsedControl){var e=new t;e.icon="collapsedControl",e.tooltip="More tools",this.sub_items.collapsedControl=e}this.selected="collapsedControl",this.constructor.__super__.render.call(this,arguments)},selectItem:function(t){var r=!1,i=!1,s=e(t.target).is("i")?e(t.target):e(t.target).find("i");_.each(this.sub_items,function(e,t){s.hasClass("upfront-icon-region-"+e.icon)&&(r=e,i=t)});if(r){if(r instanceof n||r.multiControl===!0)return!1;this.render(),this.trigger("select",i)}},open_subitem:function(){_.each(this.sub_items,function(e){e instanceof n&&e.close_subitem()}),this.constructor.__super__.open_subitem.call(this,arguments)}});return r})}(jQuery),define("scripts/upfront/inline-panels/control-panel",["scripts/upfront/inline-panels/panel","scripts/upfront/inline-panels/collapsed-multi-control","scripts/upfront/inline-panels/tooltip-control"],function(e,t,n){var r=Upfront.mainData.l10n.image_element,i=e.extend({position_v:"none",position_h:"none",setWidth:function(e){var i=this.items._wrapped,s,o=_.extend({widthThreshold:100,width:101,heightThreshold:100,height:101},e);o.width<o.widthThreshold||o.height<o.heightThreshold?this.collapsed!==!0&&(s=new t,_.each(i,function(e){e instanceof n&&e.setDisabled(!0),s.sub_items[e.icon]=e}),s.icon="collapsedControl",s.tooltip=r.ctrl.more_tools,s.position="left",this.items=_([s]),this.collapsed=!0):(this.collapsed&&(this.items=_([]),_.each(i[0].sub_items,function(e,t){t!=="collapsedControl"&&this.items.push(e),e instanceof n&&e.setDisabled(!1)},this)),this.collapsed=!1)},delegateEvents:function(){Backbone.View.prototype.delegateEvents.call(this,arguments),this.items.each(function(e){e.delegateEvents()})}});return i}),define("text!scripts/upfront/inline-panels/templates/panel-control-template.html",[],function(){return'<div class="uimage-control-panel upfront-ui">\n	<div class="uimage-control-panel-content"></div>\n	{[ if (!hideOkButton) { ]}\n	<button type="button" class="upfront-save_settings"><i class="icon-ok"></i> {{ l10n.ok }}</button>\n	{[ } ]}\n</div>\n'}),function(e){define("scripts/upfront/inline-panels/dialog-control",["scripts/upfront/inline-panels/control","text!scripts/upfront/inline-panels/templates/panel-control-template.html"],function(t,n){var r=Upfront.mainData.l10n.image_element,i=t.extend({multiControl:!0,hideOnClick:!0,events:{click:"onClickControl","click button":"onClickOk"},initialize:function(e){var t=this;this.options=e||{},this.listenTo(Upfront.Events,"dialog-control:open",function(e){if(t===e)return;t.close()})},render:function(){t.prototype.render.call(this,arguments);var i=this,s;return this.$el.hasClass("uimage-control-panel-item")||this.$el.addClass("uimage-control-panel-item"),this.view&&(this.view.render(),this.view.delegateEvents()),this.panel||(s=e(_.template(n,{l10n:r.template,hideOkButton:this.hideOkButton})),s.addClass("inline-panel-control-dialog"),s.addClass("inline-panel-control-dialog-"+this.id),this.$el.append(s),s.find(".uimage-control-panel-content").html("").append(this.view.$el),this.panel=s,e(document).on("click.dialog-control."+i.cid,i,i.onDocumentClick)),this},remove:function(){e(document).off("click.dialog-control."+this.cid)},onDocumentClick:function(t){var n=e(t.target),r=t.data;n.closest("#page").length&&n[0]!==r.el&&!n.closest(r.el).length&&r.isopen&&r.close()},onClickControl:function(t){this.$el.siblings(".upfront-control-dialog-open").removeClass("upfront-control-dialog-open");if(!e(t.target).closest(".upfront-icon").length||e(t.target).closest("upfront-icon-media-label-delete").length){t.stopPropagation();return}t.preventDefault(),this.clicked(t),this.$el.siblings(".upfront-control-dialog-open").removeClass("upfront-control-dialog-open"),this.isopen?this.close():this.open()},onClickOk:function(e){e.preventDefault(),this.trigger("panel:ok",this.view)},bindEvents:function(){this.panel.find("button").on("click",function(){})},open:function(){return this.isopen=!0,this.$el.addClass("upfront-control-dialog-open"),this.trigger("panel:open"),Upfront.Events.trigger("dialog-control:open",this),this},close:function(){return this.isopen=!1,this.$el.removeClass("upfront-control-dialog-open"),this.trigger("panel:close"),this}});return i})}(jQuery),define("scripts/upfront/inline-panels/controls/visit-link",["scripts/upfront/inline-panels/control"],function(e){var t=Upfront.Settings&&Upfront.Settings.l10n?Upfront.Settings.l10n.global.content:Upfront.mainData.l10n.global.content,n=e.extend({className:"upfront-inline-panel-item visit-link-control",initialize:function(e){this.options=e||{},this.constructor.__super__.initialize.call(this,e),this.linkLabel=_.extend({unlink:t.not_linked,lightbox:t.open_lightbox,anchor:t.scroll_to_anchor,entry:t.go_to_post,external:t.open_ext_link,email:t.send_email},e.linkLabel||{}),this.setOptions(this.options.url,this.options.type),this.hideIfUnlink=e.hideIfUnlink===!0,this.setOptions(this.options.url)},setOptions:function(e,t){var n=t?t:Upfront.Util.guessLinkType(e);this.url=e,this.icon="visit-link-"+n,this.label=this.getTextByLinkType(n)},clicked:function(e){this.constructor.__super__.clicked.call(this,e),this.url!==""&&Upfront.Util.visitLink(this.url)},setLink:function(e,t){this.setOptions(e,t),this.render()},on_render:function(){this.hideIfUnlink&&Upfront.Util.guessLinkType(this.url)=="unlink"?this.$el.hide():this.$el.is(":visible")||this.$el.show()},getTextByLinkType:function(e){return this.linkLabel[e]}});return n}),define("scripts/upfront/inline-panels/controls/link-panel",["scripts/upfront/inline-panels/dialog-control"],function(e){var t=e.extend({initialize:function(e){this.options=e||{},this.constructor.__super__.initialize.call(this,e),this.icon=this.options.icon,this.tooltip=this.options.tooltip,this.id=this.options.id,this.view=new Upfront.Views.Editor.LinkPanel({model:this.model,button:!1}),this.listenTo(this.view,"url:changed",this.onClickOk)},onClickOk:function(e){(e||{}).preventDefault&&e.preventDefault(),this.view.model.get("type")==="lightbox"&&this.view.$el.find(".js-ulinkpanel-lightbox-input").val()!==""&&this.view.createLightBox(),this.close()}});return t}),define("scripts/upfront/link-model",[],function(){var e=Backbone.Model.extend({defaults:{type:"unlink",url:"",target:"_self"},initialize:function(){this.on("change:type",this.updateTarget,this)},updateTarget:function(){_.contains(["lightbox","anchor"],this.get("type"))&&(console.log("we have an anchor or a lightbox"),this.set({target:"_self"},{silent:!0}))}});return e}),function(e){define("scripts/upfront/inline-panels/controls/group-link-panel",["scripts/upfront/inline-panels/controls/link-panel","scripts/upfront/link-model"],function(t,n){var r=Upfront.Settings&&Upfront.Settings.l10n?Upfront.Settings.l10n.global.views:Upfront.mainData.l10n.global.views,i=t.extend({className:"upfront-inline-panel-item group-link-control",initialize:function(e){var t=this;this.options=e||{},this.constructor.__super__.constructor.__super__.initialize.call(this,e),this.icon=this.options.icon,this.tooltip=this.options.tooltip,this.id=this.options.id,this.link=new n({type:this.options.linkType,url:this.options.linkUrl,target:this.options.linkTarget,object:this.options.linkObject,object_id:this.options.linkObjectId}),this.view=new Upfront.Views.Editor.LinkPanel({model:this.link,button:!1,title:r.link_group_to}),this.listenTo(this.link,"change change:target change:type",function(e){t.render_label(),this.trigger("change",{url:e.get("url"),target:e.get("target"),type:e.get("type")})})},label:function(){return this.link.get("type")!="unlink"?r.edit_link:r.not_linked},onClickControl:function(t){this.$el.siblings(".upfront-control-dialog-open").removeClass("upfront-control-dialog-open");if(e(t.target).closest(".inline-panel-control-dialog").length)return;t.preventDefault(),this.isopen?this.close():this.open()}});return i})}(jQuery),define("scripts/upfront/inline-panels/inline-panels",["scripts/upfront/inline-panels/panels","scripts/upfront/inline-panels/panel","scripts/upfront/inline-panels/item","scripts/upfront/inline-panels/item-multi","scripts/upfront/inline-panels/control","scripts/upfront/inline-panels/multi-control","scripts/upfront/inline-panels/tooltip-control","scripts/upfront/inline-panels/padding-control","scripts/upfront/inline-panels/control-panel","scripts/upfront/inline-panels/dialog-control","scripts/upfront/inline-panels/collapsed-multi-control","scripts/upfront/inline-panels/controls/visit-link","scripts/upfront/inline-panels/controls/link-panel","scripts/upfront/inline-panels/controls/group-link-panel"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p){return{Panels:e,Panel:t,Item:n,ItemMulti:r,Control:i,MultiControl:s,TooltipControl:o,PaddingControl:u,ControlPanel:a,DialogControl:f,CollapsedMultiControl:l,Controls:{VisitLink:c,LinkPanel:h,GroupLinkPanel:p}}}),function(e){define("scripts/upfront/element-settings/sidebar",[],function(){e("body").append('<div id="element-settings-sidebar" />'),e("#element-settings-sidebar").width(0).css("opacity",0);var t,n,r,i=function(){t&&(t.cleanUp(),t=!1,e("#element-settings-sidebar").width(10).css("opacity",0).html(""),Upfront.Events.off("element:settings:saved",i),Upfront.Events.off("element:settings:cancel",s))},s=function(){var e=new Upfront.Collections.Properties(r.properties);e._events=n.get("properties")._events,n.set("properties",e),i()},o=function(o){var u,a;if(t){Upfront.Events.trigger("element:settings:canceled");return}u=_(Upfront.Application.LayoutEditor.Objects).reduce(function(e,t){return o instanceof t.View?t:e},!1),u=u&&u.Settings?u:Upfront.Views.Editor.Settings,a=u.Settings,t=new a({model:o.model,anchor:u?u.anchor:!1}),t.for_view=o,t.render(),e("#element-settings-sidebar").html(t.el),e("#element-settings-sidebar").width(260).css("opacity",""),e(".uf-settings-panel--expanded:not(:first)").toggleClass("uf-settings-panel--expanded").find(".uf-settings-panel__body").toggle(),Upfront.Events.on("element:settings:saved",i),n=o.model,r=Upfront.Util.model_to_json(o.model),Upfront.Events.once("element:settings:canceled",s),setTimeout(function(){e("#element-settings-sidebar").removeClass("collapsed")},500),Upfront.Events.trigger("element:settings:render")};Upfront.Events.on("element:settings:activate",o),Upfront.Events.on("entity:removed:after",i),Upfront.Events.on("upfront:layout_size:change_breakpoint",i)})}(jQuery),define("text!scripts/upfront/templates/link-panel.html",[],function(){return'<div class="ulinkpanel-title">{{title}}</div>\n<form>\n{[if(type == \'external\') { ]}\n<div class="upfront-field-wrap ulinkpanel-external-wrap">\n	<input type="text" value="{{link.url}}" placeholder="Type link URL" class="upfront-field-text js-ulinkpanel-input-url js-ulinkpanel-input-external">\n</div>\n{[ } ]}\n{[if(type == \'email\') { ]}\n<div class="upfront-field-wrap ulinkpanel-external-wrap">\n	<input type="text" value="{{link.url}}" placeholder="johnsmith@example.com" class="upfront-field-text js-ulinkpanel-input-url js-ulinkpanel-input-external">\n</div>\n{[ } ]}\n{[if(type == \'entry\') { ]}\n<div class="upfront-field-wrap ulinkpanel-entry-wrap">\n	<a title="{{Upfront.Settings.l10n.global.content.change_link}}" class="ulinkpanel-entry-url js-ulinkpanel-input-url js-ulinkpanel-input-entry" href="#">{{(!link.url || link.url==\'\' || link.url==\'http://\')? Upfront.Settings.l10n.global.content.select :link.url}}</a>\n</div>\n{[ } ]}\n{[if(type == \'anchor\') { ]}\n<div class="anchor-selector">\n</div>\n{[ } ]}\n{[if(type == \'lightbox\') { ]}\n<div class="js-ulinkpanel-input-url js-ulinkpanel-input-lightbox clearfix">\n	{[ if(lightboxes.length) { ]}\n		<div class="lightbox-selector">\n		</div>\n		<a href="{{link.url}}" class="link-panel-lightbox-trigger">{{Upfront.Settings.l10n.global.content.open_lightbox}}</a>\n	{[ } else { ]}\n\n	{[ } ]}\n\n    <div class="js-ulinkpanel-new-lightbox ulinkpanel-new-lightbox">\n        <div class="ulinkpanel-title">{{Upfront.Settings.l10n.global.content.create_lightbox}}</div>\n        <input type="text" name="new_lightbox" class="upfront-field upfront-field-text upfront-field-empty ulinkpanel-lightbox-input js-ulinkpanel-lightbox-input" value="" placeholder="{{Upfront.Settings.l10n.global.content.lightbox_name}}" />\n    </div>\n</div>\n{[ } ]}\n</form>\n{[if(button) { ]}\n<div class="upfront-settings-button_panel">\n	<button type="button" class="upfront-save_settings js-ulinkpanel-ok"><i class="icon-ok"></i> {{Upfront.Settings.l10n.global.content.ok}}</button>\n</div>\n{[ } ]}\n'}),function(e){define("scripts/upfront/link-panel",["scripts/upfront/link-model","text!scripts/upfront/templates/link-panel.html"],function(t,n){var r=function(){var e=Upfront.Application.layout.get("regions"),t=[{id:"#page",label:Upfront.Settings.l10n.global.views.back_to_top}],n;return n=function(e){e.each(function(e){var r=e.get_property_value_by_name("anchor");r&&r.length&&t.push({id:"#"+r,label:r}),e.get("objects")&&(e.get("objects")||{}).each?e.get("objects").each(function(e){var n=e.get_property_value_by_name("anchor");n&&n.length&&t.push({id:"#"+n,label:n})}):e.get("modules")&&n(e.get("modules"))})},e.each(function(e){n(e.get("modules"))}),t},i=function(){var e=[];return _.each(Upfront.data.ugallery.postTypes,function(t){t.name!="attachment"&&e.push({name:t.name,label:t.label})}),e},s=function(){var e=[],t=(Upfront.Application.layout||{}).get?Upfront.Application.layout.get("regions"):[];return _.each(t.models,function(t){t.attributes.sub=="lightbox"&&e.push({id:"#"+t.get("name"),label:t.get("title")})}),e},o=Backbone.View.extend({tpl:_.template(n),defaultLinkTypes:{unlink:!0,external:!0,entry:!0,anchor:!0,image:!1,lightbox:!0,email:!0,homepage:!0},events:{"click .js-ulinkpanel-input-entry":"openPostSelector","keydown .js-ulinkpanel-lightbox-input":"onLightboxNameInputChange","blur .js-ulinkpanel-input-external":"onUrlInputBlur","click .upfront-save_settings":"onOkClick","keydown .js-ulinkpanel-input-url.js-ulinkpanel-input-external":"onExternalUrlKeydown","click .link-panel-lightbox-trigger":"visit_lightbox"},className:"ulinkpanel-dark",visit_lightbox:function(t){t.preventDefault();var n=e(t.target).attr("href");if(!n||n==="")return;var r=Upfront.Application.layout.get("regions");region=r?r.get_by_name(this.getUrlanchor(n)):!1;if(region){_.each(r.models,function(e){e.attributes.sub=="lightbox"&&Upfront.data.region_views[e.cid].hide()});var i=Upfront.data.region_views[region.cid];i.show()}},getUrlanchor:function(t){if(typeof t=="undefined")var t=e(location).attr("href");if(t.indexOf("#")>=0){var n=t.split("#");return n[1]}return!1},initialize:function(e){if(e.linkTypes&&e.linkTypes.image&&e.linkTypes.image===!0&&_.isUndefined(e.imageUrl))throw'Provide "imageUrl" if "linkTypes" option has { image: true } when initializing LinkPanel.';var t=this;this.options=e||{},this.linkTypes=_.extend({},this.defaultLinkTypes,e.linkTypes||{}),this.theme=e.theme||"dark",this.button=e.button||!1,this.title=e.title||Upfront.Settings.l10n.global.content.links_to;if(typeof e.model=="undefined"){Upfront.Util.log("There was no link model, use new linking.");return}var n=document.location.origin+document.location.pathname;this.model.get("type")==="anchor"&&this.model.get("url").match(/^#/)!==null&&this.model.set({url:n+this.model.get("url")},{silent:!0}),this.listenTo(this.model,"change:type",this.handleTypeChange)},onOkClick:function(){this.model.get("type")=="lightbox"&&this.$el.find(".js-ulinkpanel-lightbox-input").val()!==""?this.createLightBox():(this.close(),this.model.trigger("change"))},onExternalUrlKeydown:function(e){return 13!==e.which?!0:(e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation(),this.onOkClick(e),this.trigger("url:changed"),!1)},close:function(){this.trigger("linkpanel:close")},handleTypeChange:function(){this.model.get("type")==="homepage"?this.model.set({url:Upfront.mainData.site},{silent:!0}):this.model.set({url:""},{silent:!0}),this.render(),this.model.get("type")==="entry"&&this.openPostSelector(),this.model.get("type")==="image"&&this.model.set({url:this.options.imageUrl})},getLinkTypeValue:function(e){var t=Upfront.Settings.l10n.global.content;switch(e){case"homepage":return{value:"homepage",label:t.homepage};case"unlink":return{value:"unlink",label:t.no_link};case"external":return{value:"external",label:t.url};case"email":return{value:"email",label:t.email};case"entry":return{value:"entry",label:t.post_or_page};case"anchor":return{value:"anchor",label:t.anchor};case"image":return{value:"image",label:t.larger_image};case"lightbox":return{value:"lightbox",label:t.lightbox}}},openPostSelector:function(e){e&&e.preventDefault();var t=this,n={postTypes:i()};Upfront.Views.Editor.PostSelector.open(n).done(function(e){t.model.set({url:e.get("permalink"),object:e.get("post_type"),object_id:e.get("ID")}),t.render()})},onLightboxNameInputChange:function(e){e.which==13&&(e.preventDefault(),this.createLightBox())},createLightBox:function(){var t=e.trim(this.$(".js-ulinkpanel-lightbox-input").val());if(!t)return Upfront.Views.Editor.notify(Upfront.Settings.l10n.global.views.ltbox_empty_name_nag,"error"),!1;this.model.set({url:"#"+Upfront.Application.LayoutEditor.getLightboxSafeName(t)}),Upfront.Application.LayoutEditor.createLightboxRegion(t),this.model.trigger("change",!0),this.render()},onUrlInputBlur:function(t){var n=e(t.currentTarget).val().trim();this.model.get("type")==="external"&&!n.match(/https?:\/\//)&&!_.isEmpty(n)&&(n="http://"+n),this.model.get("type")==="email"&&!n.match(/^mailto:/)&&(n="mailto:"+n),this.model.set({url:n}),this.render()},render:function(){var e=this;if(!this.model){this.$el.html("Error occurred, link panel switch to new style.");return}var t={title:this.title,link:this.model.toJSON(),checked:'checked="checked"',lightboxes:s(),button:this.button,type:this.model.get("type")};this.$el.html(this.tpl(t)),this.renderTypeSelect(),this.model.get("type")=="anchor"&&this.renderAnchorSelect(),this.model.get("type")=="lightbox"&&s()&&this.renderLightBoxesSelect(),_.contains(["external","entry","homepage"],this.model.get("type"))&&this.renderTargetRadio(),this.delegateEvents()},renderTypeSelect:function(){var e=this,t=[];_.each(this.linkTypes,function(e,n){if(!e)return;t.push(this.getLinkTypeValue(n))},this),this.typeSelect=new Upfront.Views.Editor.Field.Select({label:"",values:t,default_value:this.model.get("type"),change:function(){e.model.set({type:this.get_value()})}}),this.typeSelect.render(),this.$el.find("form").prepend(this.typeSelect.el)},renderTargetRadio:function(){var e=this;this.targetRadio=new Upfront.Views.Editor.Field.Radios({label:Upfront.Settings.l10n.global.content.target,default_value:this.model.get("target")||"_self",layout:"horizontal-inline",values:[{label:Upfront.Settings.l10n.global.content.blank,value:"_blank"},{label:Upfront.Settings.l10n.global.content.self,value:"_self"}],change:function(){e.model.set({target:this.get_value()})}}),this.targetRadio.render(),this.$el.find("form").append(this.targetRadio.el)},renderAnchorSelect:function(){var e=this.model,t=document.location.origin+document.location.pathname,n=[{label:"Choose Anchor...",value:""}];_.each(r(),function(e){n.push({label:e.label,value:t+e.id})});var i=this.model.get("url");i=i?i:"",i=i.indexOf("#")!==-1?i:"",this.anchorSelect=new Upfront.Views.Editor.Field.Select({label:"",values:n,default_value:i,change:function(){e.set({url:this.get_value()})}}),this.anchorSelect.render(),this.$el.find(".anchor-selector").append(this.anchorSelect.el)},renderLightBoxesSelect:function(){var t=this.model,n=[{label:"Choose Lightbox...",value:""}];_.each(s()||[],function(e){n.push({label:e.label,value:e.id})});var r=this.model.get("url");r=r?r:"",r=r.match(/^#/)?r:"",this.lightboxSelect=new Upfront.Views.Editor.Field.Select({label:"",values:n,default_value:r,change:function(){t.set({url:this.get_value()}),e(".link-panel-lightbox-trigger").attr("href",this.get_value())}}),this.lightboxSelect.render(),this.$el.find(".lightbox-selector").append(this.lightboxSelect.el)},delegateEvents:function(e){this.typeSelect&&this.typeSelect.delegateEvents(),this.anchorSelect&&this.anchorSelect.delegateEvents(),this.lightboxSelect&&this.lightboxSelect.delegateEvents(),Backbone.View.prototype.delegateEvents.call(this,e)}});return o})}(jQuery),define("text!upfront/templates/property.html",[],function(){return'<dt class="upfront-property">{{name}}</dt>\r\n<dd class="upfront-property">\r\n	{{value}}\r\n	<div class="upfront-property-actions">\r\n		<a href="#" class="upfront-property-change">{{Upfront.Settings.l10n.global.views.edit}}</a>\r\n		<a href="#" class="upfront-property-remove">{{Upfront.Settings.l10n.global.views.remove}}</a>\r\n	</div>\r\n</dd>'}),define("text!upfront/templates/properties.html",[],function(){return'<h3>{{name}}</h3>\r\n\r\n<dl class="upfront-properties_collection">\r\n</dl>\r\n\r\n<button type="button" id="add-property">{{Upfront.Settings.l10n.global.views.add_new}}</button>\r\n\r\n<div id="upfront-new_property" style="display:none">\r\n	<input type="text" id="upfront-new_property-name" placeholder="name" />\r\n	<input type="text" id="upfront-new_property-value" placeholder="value" />\r\n	<button type="button" id="done-adding-property">{{Upfront.Settings.l10n.global.views.add}}</button>\r\n</div>'}),define("text!upfront/templates/property_edit.html",[],function(){return'<input type="text" id="upfront-new_property-name" placeholder="name" value="{{name}}" />\r\n<input type="text" id="upfront-new_property-value" placeholder="value" value="{{value}}" />\r\n<button type="button" class="upfront-property-save">{{Upfront.Settings.l10n.global.views.save}}</button>'}),define("text!upfront/templates/overlay_grid.html",[],function(){return'<div class="upfront-overlay-grid upfront-overlay-grid-{{style}}">\r\n	{[ _(columns).times(function(i){ var c = i+1; ]}<div class="c1 t1 m1 upfront-grid-border">{{c}}</div>{[ }) ]}\r\n</div>\r\n'}),define("text!upfront/templates/edit_background_area.html",[],function(){return'<div class="command-edit-label">{{Upfront.Settings.l10n.global.views.edit_bg_areas}}</div>\r\n<div class="command-edit-switcher">\r\n	<span class="switch switch-off">{{Upfront.Settings.l10n.global.views.off}}</span>\r\n	<span class="switch switch-on">{{Upfront.Settings.l10n.global.views.on}}</span>\r\n	<span class="knob"></span>\r\n</div>'}),define("text!upfront/templates/sidebar_settings_lock_area.html",[],function(){return'<div class="panel-setting-item">\r\n	<div class="region-lock-switch upfront-icon upfront-icon-unlock {{lock_class}}">{{Upfront.Settings.l10n.global.views.lock_areas}}</div>\r\n</div>\r\n<div class="panel-setting-dialog panel-setting-dialog-info">{{Upfront.Settings.l10n.global.views.unlock_areas}}</div>'}),define("text!upfront/templates/sidebar_settings_background.html",[],function(){return'<div class="panel-setting-item">\r\n	<div class="panel-setting-sub-label">{{Upfront.Settings.l10n.global.views..background}}:</div>\r\n	<div class="panel-setting-background clearfix">\r\n		<input type="text" id="region-bg-color" name="color" />\r\n		<a href="#" id="region-bg-image-upload" class="panel-setting-button upfront-icon upfront-icon-edit thickbox">{{Upfront.Settings.l10n.global.views..upload_image}}</a>\r\n		<a href="#" id="region-bg-image-edit" class="panel-setting-button upfront-icon upfront-icon-edit" style="display: none;">{{Upfront.Settings.l10n.global.views..edit_image}}</a>\r\n	</div>\r\n	<div class="panel-setting-background-more">\r\n		<div class="background-image-wrap"></div>\r\n		<div class="panel-setting-sub-label">{{Upfront.Settings.l10n.global.views..edit_image_position}}:</div>\r\n		<div class="panel-setting-background-position">\r\n			<div class="background-position-select">\r\n				<span class="position-select-wrap"><input type="radio" class="position-select" name="position" value="left top" /></span>\r\n				<span class="position-select-wrap"><input type="radio" class="position-select" name="position" value="center top" /></span>\r\n				<span class="position-select-wrap"><input type="radio" class="position-select" name="position" value="right top" /></span>\r\n				<span class="position-select-wrap"><input type="radio" class="position-select" name="position" value="left center" /></span>\r\n				<span class="position-select-wrap"><input type="radio" class="position-select" name="position" value="center" /></span>\r\n				<span class="position-select-wrap"><input type="radio" class="position-select" name="position" value="right center" /></span>\r\n				<span class="position-select-wrap"><input type="radio" class="position-select" name="position" value="left bottom" /></span>\r\n				<span class="position-select-wrap"><input type="radio" class="position-select" name="position" value="center bottom" /></span>\r\n				<span class="position-select-wrap"><input type="radio" class="position-select" name="position" value="right bottom" /></span>\r\n			</div>\r\n			<div class="or-round">or</div>\r\n			<div class="background-tile-select">\r\n				<label class="tile-select-wrap"><input type="checkbox" class="upfront-field-checkbox tile-select" name="tile" value="repeat-x" />{{Upfront.Settings.l10n.global.views..tile_horizontally}}</label>\r\n				<label class="tile-select-wrap"><input type="checkbox" class="upfront-field-checkbox tile-select" name="tile" value="repeat-y" />{{Upfront.Settings.l10n.global.views..tile_vertically}}</label>\r\n				<label class="tile-select-wrap"><input type="checkbox" class="upfront-field-checkbox tile-select" name="tile" value="fill" />{{Upfront.Settings.l10n.global.views..fill_space}}</label>\r\n			</div>\r\n		</div>\r\n	</div>\r\n</div>'}),define("text!upfront/templates/popup.html",[],function(){return'<div>\r\n	<!--\r\n        Wrap everything in a div to convert this file\'s content in a jquery element\r\n        so it is possible to use $.find.\r\n    -->\r\n	<script type="text/template" id="upfront-post-list-tpl">\r\n		<div id="upfront-list">\r\n			<div id="upfront-list-meta" class="upfront-list_item clearfix">\r\n				<div class="upfront-list_item-component upfront-date upfront-header {{ orderby == \'post_date\' ? \'active ordered-\' + order : \'\' }}" data-sortby="post_date">{{Upfront.Settings.l10n.global.content.date}} <i class="icon-caret-down">&#9660;</i><i class="icon-caret-up">&#9650;</i></div>\r\n				<div class="upfront-list_item-component upfront-title upfront-header {{ orderby == \'post_title\' ? \'active ordered-\' + order : \'\' }}"  data-sortby="post_title">Post Title <i class="icon-caret-down">&#9660;</i><i class="icon-caret-up">&#9650;</i></div>\r\n				<div class="upfront-list_item-component upfront-author upfront-header {{ orderby == \'post_author\' ? \'active ordered-\' + order : \'\' }}" data-sortby="post_author">Author <i class="icon-caret-down">&#9660;</i><i class="icon-caret-up">&#9650;</i></div>\r\n				<div class="upfront-list_item-component upfront-comments-count upfront-header {{ orderby == \'post_comments\' ? \'active ordered-\' + order : \'\' }}" data-sortby="post_comments"><i class="icon-post-comments"></i> <i class="icon-caret-down">&#9660;</i><i class="icon-caret-up">&#9650;</i></div>\r\n			</div>\r\n			<div class="upfront-list-items upfront-scroll-panel">\r\n				{[ if(!posts.length){ ]}\r\n				<p class="upfront-no-results">{{Upfront.Settings.l10n.global.content.no_posts}}</p>\r\n				{[ } else { ]}\r\n				{[ _.each(posts, function (post, idx){ ]}\r\n				<div class="upfront-list_item-post upfront-list_item clearfix status-{{ post.get("post_status") }}" data-post_id="{{ post.get("ID") }}">\r\n				<div class="upfront-list_item-component upfront-date post-status-{{ post.get("post_status") }}" title="{[ if(post.get("post_status") == "publish") { ]}Published{[ } else if(post.get("post_status") == "future") { ]}Scheduled{[ } else { ]}Draft{[ } ]}">{[ if(post.get("post_status") == "future") { ]}sched. for{[ } ]}\r\n				{{ Upfront.Util.format_date(post.get("post_date")) }}</div>\r\n			<div class="upfront-list_item-component upfront-title upfront-list_item-main">{{ post.get("post_title") }}</div>\r\n			<div class="upfront-list_item-component upfront-author">{[ if(post.author.get(\'data\')){ ]} {{ post.author.get(\'data\').display_name }} {[ } ]}</div>\r\n			<div class="upfront-list_item-component upfront-comments-count">{{ post.get("comment_count") }}</div>\r\n			<div class="upfront-list_item-component upfront-editactions"><a href="/edit/post/{{ post.get("ID") }}" class="editaction edit">{{Upfront.Settings.l10n.global.content.edit}}</a><a href="{{ post.get("permalink") }}" class="editaction view">{{Upfront.Settings.l10n.global.content.view}}</a><a href="#" class="editaction trash">{{Upfront.Settings.l10n.global.content.trash}}</a></div>\r\n		</div>\r\n		{[ }); } ]}\r\n		</div>\r\n		</div>\r\n	</script>\r\n\r\n	<script type="text/template" type="text/template" id="upfront-post-single-tpl">\r\n		<div id="upfront-list-page" style="display:none">\r\n			<div id="upfront-list-page-path">\r\n				<a href="#" class="upfront-path-back">{{Upfront.Settings.l10n.global.content.posts}}</a> &nbsp;&raquo;&nbsp;\r\n				<a href="#" class="last">{{ post.get(\'post_title\') }}</a>\r\n			</div>\r\n			<div id="upfront-list-page-preview">\r\n				<div id="upfront-page_preview-wrapper">\r\n					<div id="upfront-page_preview-featured_image" class="upfront-page_preview-item">\r\n						<h4>Featured Image: </h4>\r\n						<div class="upfront-thumbnailinfo">{{Upfront.Settings.l10n.global.content.loading}}</div>\r\n						<img src="{{post.featuredImage }}" style="{{post.featuredImage ? \'\' : \'display:none\'}}" />\r\n						<div class="upfront-page_preview-edit_feature"><a href="#">{{Upfront.Settings.l10n.global.content.edit}} <i class="icon-pencil"></i></a></div>\r\n					</div>\r\n					<div class="upfront-page_preview-bottom" id="upfront-page_preview-edit">\r\n						<button type="button"><i class="icon-pencil"></i> {{Upfront.Settings.l10n.global.content.edit_post}}</button>\r\n					</div>\r\n				</div>\r\n			</div>\r\n			<div id="upfront-list-page-tree" class="upfront-scroll-panel">\r\n				<div class="upfront-post_content-wrapper">\r\n					<div class="upfront-post_content">\r\n						<h3>{{ post.get(\'post_title\') }}</h3>\r\n						{{ post.get(\'post_content\') }}\r\n					</div>\r\n				</div>\r\n			</div>\r\n		</div>\r\n	</script>\r\n\r\n	<script type="text/template" id="upfront-page-list-old-tpl">\r\n		<div id="upfront-list-page" class="bordered-bottom clearfix">\r\n			<div id="upfront-list-page-path"></div>\r\n			<div id="upfront-list-page-preview">\r\n				<div id="upfront-page_preview-wrapper">\r\n					<h4>{{Upfront.Settings.l10n.global.content.select_page}}</h4>\r\n				</div>\r\n			</div>\r\n			<div id="upfront-list-page-tree" class="upfront-list-items upfront-scroll-panel">\r\n				{[ _.each(pages, function (page){ ]}\r\n				{{ pageItemTemplate({page: page, pageItemTemplate: pageItemTemplate}) }}\r\n				{[ }); ]}\r\n			</div>\r\n		</div>\r\n	</script>\r\n\r\n	<script type="text/template"  id="upfront-page-list-item-tpl">\r\n		<div class="upfront-list-page_item {{ page.children.length ? \'has_children closed\' : \'\' }}" id="upfront-list-page_item-{{ page.get("ID") }}" data-post_id="{{ page.get("ID") }}">\r\n		{[if(page.children.length){ ]}\r\n		<i class="icon-caret-right"></i>\r\n		<i class="icon-caret-down"></i>\r\n		{[ } ]}\r\n		{{ page.get("post_title") }}\r\n		{[if(page.children.length){ page.children.each(function(child, idx) { ]}\r\n		{{ pageItemTemplate({page: child, pageItemTemplate: pageItemTemplate}) }}\r\n		{[ })}; ]}\r\n		</div>\r\n	</script>\r\n\r\n\r\n	<script type="text/template" id="upfront-page-list-tpl">\r\n		<div id="upfront-list">\r\n			<div id="upfront-list-meta" class="upfront-list_item clearfix">\r\n				<div class="upfront-list_item-component upfront-date upfront-header {{ orderby == \'post_date\' ? \'active ordered-\' + order : \'\' }}" data-sortby="post_date">{{Upfront.Settings.l10n.global.content.date}} <i class="icon-caret-down">&#9660;</i><i class="icon-caret-up">&#9650;</i></div>\r\n				<div class="upfront-list_item-component upfront-title upfront-header {{ orderby == \'post_title\' ? \'active ordered-\' + order : \'\' }}"  data-sortby="post_title">Page Title <i class="icon-caret-down">&#9660;</i><i class="icon-caret-up">&#9650;</i></div>\r\n				<div class="upfront-list_item-component upfront-author upfront-header {{ orderby == \'post_author\' ? \'active ordered-\' + order : \'\' }}" data-sortby="post_author">Author <i class="icon-caret-down">&#9660;</i><i class="icon-caret-up">&#9650;</i></div>\r\n				<div class="upfront-list_item-component upfront-comments-count upfront-header {{ orderby == \'post_comments\' ? \'active ordered-\' + order : \'\' }}" data-sortby="post_comments"><i class="icon-post-comments"></i> <i class="icon-caret-down">&#9660;</i><i class="icon-caret-up">&#9650;</i></div>\r\n			</div>\r\n			<div class="upfront-list-items upfront-scroll-panel">\r\n				{[ if(!pages.length){ ]}\r\n				<p class="upfront-no-results">{{Upfront.Settings.l10n.global.content.no_posts}}</p>\r\n				{[ } else { ]}\r\n				{[ _.each(pages, function (post){ ]}\r\n				<div class="upfront-list_item-post upfront-list_item clearfix status-{{ post.get("post_status") }}" data-post_id="{{ post.get("ID") }}">\r\n				<div class="upfront-list_item-component upfront-date post-status-{{ post.get("post_status") }}" title="{[ if(post.get("post_status") == "publish") { ]}Published{[ } else if(post.get("post_status") == "future") { ]}Scheduled{[ } else { ]}Draft{[ } ]}">{[ if(post.get("post_status") == "future") { ]}sched. for{[ } ]}\r\n				{{ Upfront.Util.format_date(post.get("post_date")) }}</div>\r\n			<div class="upfront-list_item-component upfront-title upfront-list_item-main">{{ post.get("post_title") }}</div>\r\n			<div class="upfront-list_item-component upfront-author">{[ if(post.author.get(\'data\')){ ]} {{ post.author.get(\'data\').display_name }} {[ } ]}</div>\r\n			<div class="upfront-list_item-component upfront-comments-count">{{ post.get("comment_count") }}</div>\r\n			<div class="upfront-list_item-component upfront-editactions"><a href="/edit/page/{{ post.get("ID") }}" class="editaction edit">{{Upfront.Settings.l10n.global.content.edit}}</a><a href="{{ post.get("permalink") }}" class="editaction view">{{Upfront.Settings.l10n.global.content.view}}</a><a href="#" class="editaction trash">{{Upfront.Settings.l10n.global.content.trash}}</a></div>\r\n		</div>\r\n		{[ }); } ]}\r\n		</div>\r\n		</div>\r\n	</script>\r\n\r\n\r\n\r\n	<script type="text/template" id="upfront-page-preview-tpl">\r\n		<div id="upfront-page_preview-wrapper" class="upfront-scroll-panel">\r\n			<div id="upfront-page_preview-featured_image" class="upfront-page_preview-item">\r\n				<h4>{{Upfront.Settings.l10n.global.content.featured_image}}: </h4>\r\n				<div class="upfront-thumbnailinfo" style="{{page.thumbnail ? \'display:none\' : \'\'}}">Loading...</div>\r\n				<img src="{{page.thumbnail }}" style="{{page.thumbnail ? \'\' : \'display:none\'}}" />\r\n				<div class="upfront-page_preview-edit_feature"><a href="#">{{Upfront.Settings.l10n.global.content.edit}} <i class="icon-pencil"></i></a></div>\r\n			</div>\r\n			<div id="upfront-page_preview-template" class="upfront-page_preview-item">\r\n				<h4>{{Upfront.Settings.l10n.global.content.template}}: </h4>\r\n				<select id="upfront-page_template-select">\r\n					<option value="0">{{Upfront.Settings.l10n.global.content.default_opt}}</option>\r\n					{[ _.each(allTemplates, function(tpl, name){ var selected = tpl == template ? \'selected="selected"\' : ""; ]}\r\n					<option value="{{tpl}}" {{selected}}>{{name}}</option>\r\n					{[ }) ]}\r\n				</select>\r\n			</div>\r\n			<div id="upfront-page_preview-edit">\r\n				<button type="button"><i class="icon-pencil"></i> {{Upfront.Settings.l10n.global.content.edit_page}}</button>\r\n			</div>\r\n		</div>\r\n	</script>\r\n\r\n	<script type="text/template"  id="upfront-comments-tpl">\r\n		<div id="upfront-list" class="upfront-list-comments clearfix bordered-bottom">\r\n			{[ if(!comments.length){ ]}\r\n			<p class="upfront-no-results">{{Upfront.Settings.l10n.global.content.no_comments}}</p>\r\n			{[ } else { ]}\r\n			<div id="upfront-list-meta" class="upfront-list_item">\r\n				<div class="upfront-list_item-component upfront-comment_author upfront-header {{ orderby == \'comment_author\' ? \'active ordered-\' + order : \'\' }}" data-sortby="comment_author">{{Upfront.Settings.l10n.global.content.author}} <i class="icon-caret-down">&#9660;</i><i class="icon-caret-up">&#9650;</i></div>\r\n				<div class="upfront-list_item-component upfront-date upfront-header {{ orderby == \'comment_date\' ? \'active ordered-\' + order : \'\' }}" data-sortby="comment_date">{{Upfront.Settings.l10n.global.content.date}} <i class="icon-caret-down">&#9660;</i><i class="icon-caret-up">&#9650;</i></div>\r\n				<div class="upfront-list_item-component upfront-comment_content upfront-header {{ orderby == \'comment_content\' ? \'active ordered-\' + order : \'\' }}" data-sortby="comment_content">{{Upfront.Settings.l10n.global.content.comment}} <i class="icon-caret-down">&#9660;</i><i class="icon-caret-up">&#9650;</i></div>\r\n			</div>\r\n			<div class="upfront-list-items upfront-list-comment-items upfront-scroll-panel">\r\n\r\n				{[ _.each(comments, function(comment){ ]}\r\n				<div class="upfront-list_item-comment upfront-list_item clearfix" id="upfront-list_item-comment-{{ comment.get("comment_ID") }}" data-comment_id="{{ comment.get("comment_ID") }}">\r\n				{{ commentTpl({comment:comment, excerptLength: excerptLength}) }}\r\n			</div>\r\n			{[ }) ]}\r\n		</div>\r\n		{[ } ]}\r\n		</div>\r\n	</script>\r\n\r\n	<script type="text/template"  id="upfront-comment-single-tpl">\r\n		{[ var excerpt = jQuery(\'<div></div>\').html(comment.get(\'comment_content\')).text(); ]}\r\n		<div class="upfront-comment-approved">\r\n			{[ if(comment.get("comment_approved") === \'0\'){ ]}\r\n			<i class="upfront-comments-approve icon-circle-blank" data-comment_id="{{ comment.get("comment_ID") }}"></i>\r\n			{[ } ]}\r\n		</div>\r\n		<div class="upfront-list_item-component upfront-comment_author">\r\n			<img src="{{ Upfront.Util.get_avatar(comment) }}" title="{{comment.get("comment_author")}}" class="avatar" /> {{comment.get("comment_author")}}</div>\r\n		<div class="upfront-list_item-component upfront-date">{{ Upfront.Util.format_date(comment.get("comment_date")) }}</div>\r\n		<div class="upfront-list_item-component upfront-comment_content upfront-comment_excerpt upfront-list_item-main upfront-post_content">{{ excerpt.length > excerptLength ? excerpt.substring(0, excerptLength) + \' [...]\' : excerpt }}</div>\r\n		<div class="upfront-list_item-component upfront-comment_content upfront-comment_content-full-wrapper upfront-list_item-main upfront-post_content  upfront-scroll-panel">\r\n			<div class="upfront-comment_content-full upfront-comment_togglable">{{ comment.get("comment_content") }}</div>\r\n			<div class="upfront-comment_edit upfront-comment_togglable" data-comment_id="{{ comment.get(\'comment_ID\') }}">\r\n				<textarea class="comment-edit-box" class="edit" rows="16">{{ comment.get("comment_content") }}</textarea>\r\n				<button type="button" class="comment-edit-ok">{{Upfront.Settings.l10n.global.content.ok}}</button>\r\n				<button type="button" class="comment-edit-cancel">{{Upfront.Settings.l10n.global.content.cancel}}</button>\r\n			</div>\r\n			<div class="upfront-comment_reply upfront-comment_togglable" data-comment_id="{{ comment.get(\'comment_ID\') }}">\r\n				<textarea class="comment-edit-box" class="edit" rows="16" placeholder="Reply here..."></textarea>\r\n				<button type="button" class="comment-reply-ok">{{Upfront.Settings.l10n.global.content.ok}}</button>\r\n				<button type="button" class="comment-reply-cancel">{{Upfront.Settings.l10n.global.content.cancel}}</button>\r\n			</div>\r\n		</div>\r\n		<div class="upfront-comment_actions-wrapper">\r\n			{[ if(comment.get("comment_approved") !== \'trash\'){ ]}\r\n			<a href="#reply" class="reply"><i class="icon-reply"></i> {{Upfront.Settings.l10n.global.content.reply}}</a>\r\n			{[ } ]}\r\n			<a href="#edit" class="edit"><i class="icon-pencil"></i> {{Upfront.Settings.l10n.global.content.edit}}</a>\r\n			{[ if(comment.get("comment_approved") === \'0\'){ ]}\r\n			<a href="#approve" class="approve"><i class="icon-ok"></i> {{Upfront.Settings.l10n.global.content.approve}}</a>\r\n			{[ } else if(comment.get("comment_approved") === \'1\'){ ]}\r\n			<a href="#unapprove" class="unapprove"><i class="icon-circle-blank"></i> {{Upfront.Settings.l10n.global.content.unapprove}}</a>\r\n			{[ } if(comment.get("comment_approved") === \'spam\'){ ]}\r\n			<a href="#unspam" class="unspam"><i class="icon-comment-alt"></i> {{Upfront.Settings.l10n.global.content.unspam}}</a>\r\n			{[ } else if(comment.get("comment_approved") !== \'trash\') { ]}\r\n			<a href="#spam" class="spam"><i class="icon-ban-circle"></i> {{Upfront.Settings.l10n.global.content.spam}}</a>\r\n			{[ } if(comment.get("comment_approved") === \'trash\'){ ]}\r\n			<a href="#unthrash" class="unthrash"><i class="icon-comment"></i> {{Upfront.Settings.l10n.global.content.untrash}}</a>\r\n			{[ } else { ]}\r\n			<a href="#thrash" class="thrash"><i class="icon-remove"></i> {{Upfront.Settings.l10n.global.content.trash}}</a>\r\n			{[ } ]}\r\n		</div>\r\n	</script>\r\n\r\n	<script type="text/template" id="upfront-slug-tpl">\r\n		<div class="upfront-slug_editor">\r\n			<div class="upfront-slug_editor-title">{{Upfront.Settings.l10n.global.content.edit_post_url}}</div>\r\n			<p class="upfront-slug_editor-info">{{Upfront.Settings.l10n.global.content.post_url_info}}</p>\r\n			<p class="upfront-slug_editor-url">\r\n				{{ rootURL }}\r\n				<input type="text" id="upfront-post_slug" value	="{{ slug }}" />\r\n				<button id="upfront-post_slug-send" value="{{Upfront.Settings.l10n.global.content.ok}}"><i class="icon-ok"></i> {{Upfront.Settings.l10n.global.content.ok}}</button>\r\n			</p>\r\n		</div>\r\n	</script>\r\n	<script type="text/template" id="upfront-pagination-tpl">\r\n		<div id="upfront-entity_list-pagination">\r\n			<a class="upfront-pagination_item upfront-pagination_item-skip upfront-pagination_item-prev"></a>\r\n\r\n\r\n			<div class="upfront-pagination_navigation">\r\n				<input type="text" class="upfront-pagination_page-current" value="{{currentPage+1}}" /> of <a class="upfront-pagination_page-item" data-idx="{{pages}}">{{pages}}</a>\r\n			</div>\r\n\r\n			<a class="upfront-pagination_item upfront-pagination_item-skip upfront-pagination_item-next"></a>\r\n\r\n			<small>{{totalElements}} items</small>\r\n		</div>\r\n	</script>\r\n\r\n	<script type="text/template" id="upfront-pagination-tpl-old">\r\n		<div id="upfront-entity_list-pagination" data-total="{{ pages }}" data-page_size="{{pageSize}}">\r\n			{[ if(pages > 1) { ]}\r\n			<div class="upfront-pagination_item upfront-pagination_item-skip upfront-pagination_item-prev">\r\n\r\n			</div>\r\n\r\n			{[ _.each(_.range(pages), function(i){ ]}\r\n			<div class="upfront-pagination_item upfront-pagination_page-item {{ i == currentPage ? \'current\' : \'\' }}" data-page_idx="{{ i }}">{{ i + 1}}</div>\r\n			{[ }) ]}\r\n\r\n			<div class="upfront-pagination_item upfront-pagination_item-skip upfront-pagination_item-next">\r\n\r\n			</div>\r\n			{[ } ]}\r\n		</div>\r\n	</script>\r\n\r\n	<script type="text/template" id="upfront-tabs-tpl">\r\n		<ul class="upfront-tabs">\r\n			{[ _.each(tabs, function(tab){ ]}\r\n			<li data-type="{{tab.id}}" class="{{ tab.id == active ? \'active\' : \'\' }}">{{tab.text}}</li>\r\n			{[ }); ]}\r\n		</ul>\r\n	</script>\r\n\r\n	<script type="text/template" id="upfront-search-tpl">\r\n		<div class="search_container clearfix">\r\n			<div id="upfront-search_action" class="search upfront-icon upfront-icon-popup-search"></div>\r\n			<div id="upfront-search_container" style="display:{{ query ? \'block\' : \'none\' }}">\r\n				<input type="text" id="upfront-list-search_input" value="{{ query ? query : \'\' }}" />\r\n			</div>\r\n		</div>\r\n	</script>\r\n\r\n	<script type="text/template" id="upfront-notifier-tpl">\r\n		<div id="upfront-notifier">\r\n			<div id="upfront-notice"></div>\r\n		</div>\r\n	</script>\r\n\r\n	<script type="text/template" id="selector-post_type-tpl">\r\n		{[if(postTypes.length > 1){ ]}\r\n		<div id="upfront-selector-post_type">\r\n			{{Upfront.Settings.l10n.global.views.select_post_type}}\r\n			<div class="upfront-field-select">\r\n				<div class="upfront-field-select-value">{{postTypes[0].label}}</div>\r\n				<ul class="upfront-field-select-options">\r\n					{[ _.each(postTypes, function(type){ ]}\r\n					<li class="upfront-field-select-option upfront-selector-option" rel="{{ type.name }}">\r\n						{{ type.label }}\r\n					</li>\r\n					{[ }); ]}\r\n				</ul>\r\n			</div>\r\n		</div>\r\n		{[ } ]}\r\n		<div id="upfront-selector-posts" class="upfront-scroll-panel">\r\n\r\n		</div>\r\n	</script>\r\n	<script type="text/template" id="selector-post-tpl">\r\n		<table id="upfront-list" class="upfront-list-items">\r\n			{[ _.each(posts, function(post){ ]}\r\n			<tr class="upfront-selector-post upfront-list_item" rel="{{post.id}}">\r\n				<td class="upfront-selector-post-checked upfront-list_item-component"></td>\r\n				<td class="upfront-selector-post-title upfront-list_item-component upfront-list_item-main">{{post.get(\'post_title\')}}</td>\r\n				<td class="upfront-selector-post-date upfront-list_item-component">{{ Upfront.Util.format_date(post.get(\'post_date\'), false) }}</td>\r\n			</tr>\r\n			{[ }) ]}\r\n		</table>\r\n	</script>\r\n\r\n\r\n	<script type="text/template" id="datepicker-tpl">\r\n		<div class="upfront-date_picker upfront-ui">\r\n			<div class="upfront-bar-datepicker">\r\n			</div>\r\n			<div class="upfront-time_picker">\r\n				Time:\r\n				<select class="ueditor-hours-select">\r\n					{[ _.each(hours, function(h){ ]}\r\n					<option value="{{h}}" {{h == currentHour ? \'selected=\\\'selected\\\'\' : \'\'}} >{{h}}</option>\r\n					{[ }); ]}\r\n				</select>:\r\n				<select class="ueditor-minutes-select">\r\n					{[ _.each(minutes, function(m){ ]}\r\n					<option value="{{m}}" {{m == currentMinute ? \'selected=\\\'selected\\\'\' : \'\'}} >{{m}}</option>\r\n					{[ }); ]}\r\n				</select>\r\n			</div>\r\n			<div class="ueditor-datepicker-buttons">\r\n				<a class="ueditor-action-pickercancel">Cancel</a>\r\n				<a class="ueditor-action-pickerok button small-button">Ok</a>\r\n			</div>\r\n		</div>\r\n	</script>\r\n\r\n	<script type="text/template" id="microselect-tpl">\r\n		<div class="ueditor-select-options">\r\n			{[ _.each(options, function(option){ ]}\r\n			<a class="ueditor-select-option ueditor-action-status" data-id="{{option.value}}">{{option.name}}</a>\r\n			{[ }); ]}\r\n		</div>\r\n		<input type="text" class="ueditor-select-focus">\r\n	</script>\r\n\r\n	<script id="csseditor-tpl" type="text/template">\r\n		<div class="upfront-css-resizable">\r\n			<div class="upfront-css-top">\r\n				{[ if (elementType) { ]}\r\n				<span class="upfront-css-type">{{ elementType }} Element</span>\r\n				{[ } ]}\r\n				{[ if (showToolbar) { ]}\r\n				<div id="insert-font-widget" class="upfront-icon">\r\n					<a class="upfront-css-font" href="#">{{Upfront.Settings.l10n.global.content.insert_font}}</a>\r\n				</div>\r\n				<a class="upfront-css-theme_image upfront-css-image" href="#">{{Upfront.Settings.l10n.global.content.insert_theme_image}}</a>\r\n				<a class="upfront-css-media_image upfront-css-image" href="#">{{Upfront.Settings.l10n.global.content.insert_image}}</a>\r\n				<span class="upfront-css-color"></span>\r\n				{[ } ]}\r\n				<a class="upfront-css-close" href="#">close</a>\r\n			</div>\r\n			<div class="upfront-css-body">\r\n				<div class="upfront-css-ace"></div>\r\n				<div class="upfront-css-sidebar">\r\n					{[ if (selectors) { ]}\r\n					<div class="upfront-css-selectors upfront-scroll-panel">\r\n						<p>{{Upfront.Settings.l10n.global.content.available_element_selectors}}</p>\r\n						{[ _.each(selectors, function(data, s){ ]}\r\n						<span class="upfront-css-selector" title="{{ data.info }}" data-selector="{{ s }}">{{data.label}}</span>\r\n						{[ }); ]}\r\n						{[ if (elementType) { ]}\r\n						{{ _.size(selectors) ? \'\' : \'No selectors available for the \' + elementType.toLowerCase() + \' element.\'}}\r\n						{[ } ]}\r\n					</div>\r\n					{[ } ]}\r\n					<div class="upfront-css-save-form">\r\n						{[ if (show_style_name) { ]}\r\n						<p>{{Upfront.Settings.l10n.global.views.style_name}}</p>\r\n						<input type="text" class="upfront-css-save-name-field" value="{{ name }}">\r\n						{[ } ]}\r\n						<button class="upfront-css-save-ok">{{Upfront.Settings.l10n.global.content.save}}</button>\r\n					</div>\r\n				</div>\r\n			</div>\r\n		</div>\r\n	</script>\r\n\r\n	<script id="icon-fonts-manager-tpl" type="text/template">\r\n		<div class="manage-icon-fonts">\r\n			<div class="fonts-manager-panel-title">\r\n				{{Upfront.Settings.l10n.global.content.choose_icon_fonts}}\r\n			</div>\r\n			<div class="icon-fonts-list">\r\n				{[ _.each(fonts, function(font) { ]}\r\n				<div data-family="{{ font.get(\'family\') }}" class="icon-fonts-list-item {[ if (font.get(\'active\')) { ]}icon-fonts-list-item-active{[ } ]}">\r\n					{{ font.get(\'name\') }}{[ if (font.getUploadStatus() !== true) { ]} <span class="icon-font-upload-status" title="{{ font.getUploadStatus() }}">*</span>{[ } ]}\r\n				</div>\r\n				{[ }); ]}\r\n			</div>\r\n			{[ if(Upfront.themeExporter && location.pathname.match(/\\/create_new\\/theme/) === null) { ]}\r\n			<div class="upload-icon-font">{{Upfront.Settings.l10n.global.views.upload_icon_font}}</div>\r\n			<form style="display: none" id="upfront-upload-icon-font" name="upfront-upload-icon-font" enctype="multipart/form-data" method="post" action="{{url}}" data-url="{{url}}?action=upfront-upload-icon-font">\r\n				<input type="file" name="media" id="upfront-icon-font-input">\r\n				<input type="hidden" name="action" value="upfront-upload-icon-font">\r\n				<input type="submit" value="Upload">\r\n			</form>\r\n			{[ } ]}\r\n		</div>\r\n		<div class="preview-icon-fonts">\r\n			<div class="fonts-manager-panel-title">\r\n				{{Upfront.Settings.l10n.global.content.icon_font_icons_preview}}\r\n			</div>\r\n			<div class="icon-font-icons-preview">\r\n				<div class="icon-font-icon-preview uf_font_icon" title="A">A</div>\r\n				<div class="icon-font-icon-preview uf_font_icon" title="B">B</div>\r\n				<div class="icon-font-icon-preview uf_font_icon" title="C">C</div>\r\n				<div class="icon-font-icon-preview uf_font_icon" title="D">D</div>\r\n				<div class="icon-font-icon-preview uf_font_icon" title="E">E</div>\r\n				<div class="icon-font-icon-preview uf_font_icon" title="F">F</div>\r\n				<div class="icon-font-icon-preview uf_font_icon" title="G">G</div>\r\n				<div class="icon-font-icon-preview uf_font_icon" title="H">H</div>\r\n				<div class="icon-font-icon-preview uf_font_icon" title="I">I</div>\r\n				<div class="icon-font-icon-preview uf_font_icon" title="J">J</div>\r\n				<div class="icon-font-icon-preview uf_font_icon" title="K">K</div>\r\n				<div class="icon-font-icon-preview uf_font_icon" title="L">L</div>\r\n				<div class="icon-font-icon-preview uf_font_icon" title="M">M</div>\r\n				<div class="icon-font-icon-preview uf_font_icon" title="N">N</div>\r\n				<div class="icon-font-icon-preview uf_font_icon" title="O">O</div>\r\n				<div class="icon-font-icon-preview uf_font_icon" title="P">P</div>\r\n				<div class="icon-font-icon-preview uf_font_icon" title="Q">Q</div>\r\n				<div class="icon-font-icon-preview uf_font_icon" title="R">R</div>\r\n				<div class="icon-font-icon-preview uf_font_icon" title="S">S</div>\r\n				<div class="icon-font-icon-preview uf_font_icon" title="T">T</div>\r\n				<div class="icon-font-icon-preview uf_font_icon" title="U">U</div>\r\n				<div class="icon-font-icon-preview uf_font_icon" title="V">V</div>\r\n				<div class="icon-font-icon-preview uf_font_icon" title="W">W</div>\r\n				<div class="icon-font-icon-preview uf_font_icon" title="X">X</div>\r\n				<div class="icon-font-icon-preview uf_font_icon" title="Y">Y</div>\r\n				<div class="icon-font-icon-preview uf_font_icon" title="Z">Z</div>\r\n				<div class="icon-font-icon-preview uf_font_icon" title="a">a</div>\r\n				<div class="icon-font-icon-preview uf_font_icon" title="b">b</div>\r\n				<div class="icon-font-icon-preview uf_font_icon" title="c">c</div>\r\n				<div class="icon-font-icon-preview uf_font_icon" title="d">d</div>\r\n				<div class="icon-font-icon-preview uf_font_icon" title="e">e</div>\r\n				<div class="icon-font-icon-preview uf_font_icon" title="f">f</div>\r\n				<div class="icon-font-icon-preview uf_font_icon" title="g">g</div>\r\n				<div class="icon-font-icon-preview uf_font_icon" title="h">h</div>\r\n				<div class="icon-font-icon-preview uf_font_icon" title="i">i</div>\r\n				<div class="icon-font-icon-preview uf_font_icon" title="j">j</div>\r\n				<div class="icon-font-icon-preview uf_font_icon" title="k">k</div>\r\n				<div class="icon-font-icon-preview uf_font_icon" title="l">l</div>\r\n				<div class="icon-font-icon-preview uf_font_icon" title="m">m</div>\r\n				<div class="icon-font-icon-preview uf_font_icon" title="n">n</div>\r\n				<div class="icon-font-icon-preview uf_font_icon" title="o">o</div>\r\n				<div class="icon-font-icon-preview uf_font_icon" title="p">p</div>\r\n				<div class="icon-font-icon-preview uf_font_icon" title="q">q</div>\r\n				<div class="icon-font-icon-preview uf_font_icon" title="r">r</div>\r\n				<div class="icon-font-icon-preview uf_font_icon" title="s">s</div>\r\n				<div class="icon-font-icon-preview uf_font_icon" title="t">t</div>\r\n				<div class="icon-font-icon-preview uf_font_icon" title="u">u</div>\r\n				<div class="icon-font-icon-preview uf_font_icon" title="v">v</div>\r\n				<div class="icon-font-icon-preview uf_font_icon" title="w">w</div>\r\n				<div class="icon-font-icon-preview uf_font_icon" title="x">x</div>\r\n				<div class="icon-font-icon-preview uf_font_icon" title="y">y</div>\r\n				<div class="icon-font-icon-preview uf_font_icon" title="z">z</div>\r\n			</div>\r\n		</div>\r\n	</script>\r\n\r\n	<script id="text-fonts-manager-tpl" type="text/template">\r\n		<div class="add-font-panel panel">\r\n			<div class="loading-fonts">{{Upfront.Settings.l10n.global.content.loading_fonts}}</div>\r\n			<div class="font-weights-list">\r\n				<div class="font-weights-list-wrapper">\r\n					<div class="fonts-manager-panel-title">\r\n						{{Upfront.Settings.l10n.global.content.choose_typeface}}\r\n					</div>\r\n					{[ if (show_no_styles_notice) { ]}\r\n					<div class="fonts-weights-notice-text">\r\n						{{Upfront.Settings.l10n.global.content.typeface_info_text}}\r\n					</div>\r\n					{[ } ]}\r\n				</div>\r\n			</div>\r\n			<span class="add-font-button">Add &raquo;</span>\r\n		</div>\r\n	</script>\r\n\r\n	<script id="theme-fonts-panel" type="text/template">\r\n		<h3 class="panel-title">{{Upfront.Settings.l10n.global.content.theme_font_styles}}</h3>\r\n		<div class="font-list">\r\n			{[ if (show_no_styles_notice) { ]}\r\n			<div class="fonts-manager-panel-title">{{Upfront.Settings.l10n.global.content.no_fonts_added}}</div>\r\n			{[ } ]}\r\n		</div>\r\n		<div class="font-stats">\r\n		</div>\r\n	</script>\r\n\r\n	<script id="theme-font-list-item" type="text/template">\r\n		{{ family }} ({{ variant }})<span class="delete upfront-icon"></span>\r\n	</script>\r\n\r\n	<script id="save-dialog-tpl" type="text/template">\r\n		<div id="upfront-save-dialog">\r\n			<p>{{ question }}</p>\r\n			<span class="upfront-save-button" data-save-as="this-post">{{ thisPostButton }}</span>\r\n			<span class="upfront-save-button" data-save-as="all-posts">{{ allPostsButton }}</span>\r\n		</div>\r\n	</script>\r\n\r\n\r\n	<!-- end of the wrap div -->\r\n</div>'}),define("text!upfront/templates/region_add_panel.html",[],function(){return'<div class="upfront-add-region-choice"></div>\r\n<div class="upfront-add-region-new"></div>\r\n<div class="upfront-add-region-global"></div>\r\n\r\n'}),define("text!upfront/templates/region_edit_panel.html",[],function(){return'<div>\r\n<!--\r\n	Wrap everything in a div to convert this file\'s content in a jquery element\r\n	so it is possible to use $.find.\r\n-->\r\n<script type="text/template" id="upfront-region-bg-setting">\r\n	<div class="upfront-region-bg-setting-header clearfix">\r\n		<div class="upfront-region-bg-setting-auto-resize"></div>\r\n		\r\n		<div class="upfront-region-bg-setting-name">\r\n			<div class="upfront-region-bg-setting-name-wrap">\r\n				<span class="upfront-region-name-edit-value"></span>\r\n				<span class="upfront-region-bg-setting-is-global">{{Upfront.Settings.l10n.global.views.global}}</span>\r\n				<a href="#" class="upfront-region-name-edit-trigger">{{Upfront.Settings.l10n.global.views.edit}}</a>\r\n			</div>\r\n			<div class="upfront-region-bg-setting-name-edit"></div>\r\n		</div>\r\n	</div>\r\n	\r\n	<div class="upfront-region-bg-setting-fixed-region clearfix">\r\n		<div class="upfront-region-bg-setting-label">{{Upfront.Settings.l10n.global.views.floating_region_settings}}:</div>\r\n\r\n	</div>\r\n\r\n	<div class="upfront-region-bg-setting-lightbox-region clearfix">\r\n\r\n	</div>\r\n\r\n	<div class="upfront-region-bg-setting-theme-body">\r\n		<div class="upfront-region-bg-setting-heading">{{Upfront.Settings.l10n.global.views.global_bg_settings}}</div>\r\n\r\n	</div>\r\n\r\n	<div class="upfront-region-bg-setting-region-global"></div>\r\n	<div class="upfront-region-bg-setting-add-global-region"></div>\r\n\r\n	<div class="upfront-region-bg-setting-region-type">\r\n		<!-- <div class="upfront-region-bg-setting-label">{{Upfront.Settings.l10n.global.views.area_type}}</div> -->\r\n	</div>\r\n	<div class="upfront-region-bg-setting-region-behavior">\r\n		<div class="upfront-region-bg-setting-label">{{Upfront.Settings.l10n.global.views.element_behavior}}</div>\r\n	</div>\r\n	<div class="upfront-region-bg-setting-region-nav">\r\n		<div class="upfront-region-bg-setting-label">{{Upfront.Settings.l10n.global.views.add_sub_region}}</div>\r\n	</div>\r\n	<div class="upfront-region-bg-setting-type">\r\n		<div class="upfront-region-bg-setting-label">{{Upfront.Settings.l10n.global.views.bg_type}}</div>\r\n	</div>\r\n	<div class="upfront-region-bg-setting-tab upfront-region-bg-setting-tab-color"></div>\r\n	<div class="upfront-region-bg-setting-tab upfront-region-bg-setting-tab-image"></div>\r\n	<div class="upfront-region-bg-setting-tab upfront-region-bg-setting-tab-featured"></div>\r\n	<div class="upfront-region-bg-setting-tab upfront-region-bg-setting-tab-slider"></div>\r\n	<div class="upfront-region-bg-setting-tab upfront-region-bg-setting-tab-map"></div>\r\n	<div class="upfront-region-bg-setting-tab upfront-region-bg-setting-tab-video"></div>\r\n	<div class="upfront-region-bg-setting-padding">\r\n		<div class="upfront-region-bg-setting-padding-type"></div>\r\n		<div class="upfront-region-bg-setting-equal-padding"></div>\r\n		<div class="upfront-region-bg-setting-varied-padding">\r\n			<div class="upfront-region-bg-setting-padding-top">\r\n				<div class="upfront-region-bg-setting-label">{{Upfront.Settings.l10n.global.views.top_padding}}</div>\r\n			</div>\r\n			<div class="upfront-region-bg-setting-padding-bottom">\r\n				<div class="upfront-region-bg-setting-label">{{Upfront.Settings.l10n.global.views.bottom_padding}}</div>\r\n			</div>\r\n		</div>\r\n	</div>\r\n	<div class="upfront-region-bg-setting-footer clearfix">\r\n		<!-- <div class="upfront-region-bg-setting-change-image">\r\n			{{Upfront.Settings.l10n.global.views.change_image}}\r\n		</div> -->\r\n		<div class="upfront-region-bg-setting-floating-restrict"></div>\r\n		<div class="upfront-region-bg-setting-sticky"></div>\r\n		<div class="upfront-region-bg-setting-edit-css upfront-icon upfront-icon-edit-css">\r\n			<span>{{Upfront.Settings.l10n.global.views.edit_region_css}}</span>\r\n		</div>\r\n	</div>\r\n</script>\r\n\r\n<script type="text/template" id="upfront-region-bg-setting-tab">\r\n	<div class="upfront-region-bg-setting-tab-primary"></div>\r\n	<div class="upfront-region-bg-setting-tab-secondary"></div>\r\n</script>\r\n\r\n<script type="text/template" id="upfront-region-bg-setting-tab-color">\r\n	<div class="upfront-region-bg-setting-tab-primary">\r\n		<div class="upfront-region-bg-setting-label">{{Upfront.Settings.l10n.global.views.pick_color}}</div>\r\n	</div>\r\n	<div class="upfront-region-bg-setting-tab-secondary"></div>\r\n</script>\r\n\r\n<script type="text/template" id="upfront-region-bg-setting-tab-image">\r\n	<div class="upfront-region-bg-setting-tab-primary">\r\n		<div class="upfront-region-bg-setting-label">{{Upfront.Settings.l10n.global.views.image_variation}}</div>\r\n	</div>\r\n	<div class="upfront-region-bg-setting-tab-secondary"></div>\r\n</script>\r\n\r\n<script type="text/template" id="upfront-region-bg-setting-tab-featured">\r\n	<div class="upfront-region-bg-setting-tab-primary">\r\n		<div class="upfront-region-bg-setting-label">{{Upfront.Settings.l10n.global.views.image_variation}}</div>\r\n	</div>\r\n	<div class="upfront-region-bg-setting-tab-secondary"></div>\r\n</script>\r\n\r\n<script type="text/template" id="upfront-region-bg-setting-tab-slider">\r\n	<div class="upfront-region-bg-setting-tab-primary">\r\n		<div class="upfront-region-bg-setting-label">{{Upfront.Settings.l10n.global.views.slider_transition}}</div>\r\n	</div>\r\n	<div class="upfront-region-bg-setting-tab-secondary"></div>\r\n</script>\r\n\r\n\r\n<script type="text/template" id="upfront-region-bg-setting-tab-video">\r\n	<div class="upfront-region-bg-setting-tab-primary">\r\n		<div class="upfront-region-bg-setting-label">&nbsp;</div>\r\n	</div>\r\n	<div class="upfront-region-bg-setting-tab-secondary"></div>\r\n</script>\r\n\r\n\r\n</div>\r\n'}),define("text!upfront/templates/sidebar_settings_theme_colors.html",[],function(){return'<div class="panel-setting-theme-colors">\n    <div class="pabel-setting-theme-colors-top">\n        <div id="panel-setting-theme-colors-pane">\n            {[ if (!colors.length){ ]}\n            <div id="theme-colors-no-color-notice" class="upfront-icon">\n                {{Upfront.Settings.l10n.global.views.no_colors_click_plus}}\n            </div>\n            {[ } ]}\n            <div id="theme-colors-swatches">\n                <span class="theme-colors-swatch"></span>\n                <p class="theme-colors-explanation">{{Upfront.Settings.l10n.global.views.theme_colors_explanation}} <span class="theme-colors-eg-attribute">color:</span> <span class="theme-colors-eg-sharp">#</span><span class="theme-colors-eg-value">ufc2</span><span class="theme-colors-eg-semicolon">;</span></p>\n                {[ _.each(colors, function (color, idx){ ]}\n                                <span class="theme-colors-color-picker color-{{idx}}" data-index="{{idx}}" data-color="{{color.color}}"></span>\n                {[ }); ]}\n\n            </div>\n        </div>\n    </div>\n    <!--<div class="panel-setting-theme-colors-bottom">-->\n        <!--<div class="panel-setting-theme-colors-shades-wrap">-->\n            <!--{[ if( colors.length ){ ]}-->\n                        <!--{{Upfront.Settings.l10n.global.views.define_swatch_hovers}}-->\n            <!--<label id="panel-setting-theme-colors-shades-label"  for="panel-setting-theme-colors-shades-range">-->\n                            <!--Color change value (<span class="panel-setting-theme-colors-shades-range-number">{{range}}</span>)-->\n                        <!--</label>-->\n                        <!--<div class="upfront-field upfront-field-slider panel-setting-theme-colors-shades-range"></div>-->\n                        <!--<ul class="panel-setting-theme-colors-shades-range-labels">-->\n                                <!--<li>0</li>-->\n                                <!--<li>50</li>-->\n                        <!--</ul>-->\n            <!--<div class="panel-setting-theme-colors-meta">-->\n                <!--{{Upfront.Settings.l10n.global.views.click_hilite_shade}}-->\n                                <!--<p class="swatch-title">{{Upfront.Settings.l10n.global.views.hilite}}:</p>-->\n                <!--<div class="panel-setting-theme-colors-highlights">-->\n                    <!--{[ _.each(colors, function (color, idx){ ]}-->\n                                        <!--<span class="theme-colors-color-box theme-colors-highlight{[ if(color.selected === \'highlight\') { ]} theme-colors-color-box-selected{[ } ]} {{color.luminance}} color-{{idx}}" style="background-color: {{color.highlight}}" data-color="{{color.highlight}}" data-index="{{idx}}" data-type="highlight"></span>-->\n                    <!--{[ }); ]}-->\n                <!--</div>-->\n                <!--<p class="swatch-title">Shade:</p>-->\n                <!--<div class="panel-setting-theme-colors-shades">-->\n                    <!--{[ _.each(colors, function (color, idx){ ]}-->\n                                        <!--<span class="theme-colors-color-box theme-colors-shade{[ if(color.selected === \'shade\') { ]} theme-colors-color-box-selected{[ } ]} {{color.luminance}} color-{{idx}}"  style="background-color: {{color.shade}}" data-index="{{idx}}" data-color="{{color.shade}}" data-type="shade"></span>-->\n                    <!--{[ }); ]}-->\n                <!--</div>-->\n            <!--</div>-->\n            <!--{[ } ]}-->\n        <!--</div>-->\n    <!--</div>-->\n</div>\n'}),define("text!upfront/templates/color_picker.html",[],function(){return'<ul class="upfront_color_picker_rgba">\n	<li class="upfront_color_picker_rgba_r">\n		R:\n		<input type="text" value="{{r}}" data-type=\'r\' name="upfront_color_picker_rgba_r">\n	</li>\n	<li class="upfront_color_picker_rgba_g">\n		G:\n		<input type="text" value="{{g}}" data-type=\'g\' name="upfront_color_picker_rgba_g">\n	</li>\n	<li class="upfront_color_picker_rgba_b">\n		B:\n		<input type="text" value="{{b}}" data-type=\'b\'  name="upfront_color_picker_rgba_b">		\n	</li>\n	<li class="upfront_color_picker_rgba_a">\n		A:\n		<input type="text" value="{{a}}" data-type=\'a\' name="upfront_color_picker_rgba_a">			\n	</li>\n</ul>\n<span class="upfront_color_picker_reset noColor"></span>'}),function(e,t,n){function c(e,t,n){var r=[];for(var i=0;i<e.length;i++){var s=e[i];if(s){var o=tinycolor(s),a=o.toHsl().l<.5?"sp-thumb-el sp-thumb-dark":"sp-thumb-el sp-thumb-light";a+=tinycolor.equals(t,s)?" sp-thumb-active":"";var f=u?"background-color:"+o.toRgbString():"filter:"+o.toFilter();r.push('<span title="'+o.toRgbString()+'" data-color="'+o.toRgbString()+'" class="'+a+'"><span class="sp-thumb-inner" style="'+f+';" /></span>')}else{var l="sp-clear-display";r.push('<span title="No Color Selected" data-color="" style="background-color:transparent;" class="'+l+'"></span>')}}return"<div class='sp-cf "+n+"'>"+r.join("")+"</div>"}function h(){for(var e=0;e<s.length;e++)s[e]&&s[e].hide()}function p(e,n){var i=t.extend({},r,e);return i.callbacks={move:y(i.move,n),change:y(i.change,n),show:y(i.show,n),hide:y(i.hide,n),beforeShow:y(i.beforeShow,n)},i}function d(r,d){function Tt(){m.showPaletteOnly&&(m.showPalette=!0);if(m.palette){I=m.palette.slice(0),q=t.isArray(I[0])?I:[I],R={};for(var e=0;e<q.length;e++)for(var n=0;n<q[e].length;n++){var r=tinycolor(q[e][n]).toRgbString();R[r]=!0}}G.toggleClass("sp-flat",y),G.toggleClass("sp-input-disabled",!m.showInput),G.toggleClass("sp-alpha-enabled",m.showAlpha),G.toggleClass("sp-clear-enabled",xt),G.toggleClass("sp-buttons-disabled",!m.showButtons),G.toggleClass("sp-palette-disabled",!m.showPalette),G.toggleClass("sp-palette-only",m.showPaletteOnly),G.toggleClass("sp-initial-disabled",!m.showInitial),G.addClass(m.className),Xt()}function Nt(){function n(e){return e.data&&e.data.ignore?(Ft(t(this).data("color")),Rt()):(Ft(t(this).data("color")),Rt(),Wt(!0),Bt()),!1}o&&G.find("*:not(input)").attr("unselectable","on"),Tt(),pt&&K.after(dt).hide(),xt||ft.hide();if(y)K.after(G).hide();else{var e=m.appendTo==="parent"?K.parent():t(m.appendTo);e.length!==1&&(e=t("body")),e.append(G)}Ct(),vt.bind("click.spectrum touchstart.spectrum",function(e){Q||Pt(),e.stopPropagation(),t(e.target).is("input")||e.preventDefault()}),(K.is(":disabled")||m.disabled===!0)&&Kt(),G.click(g),st.change(Dt),st.bind("paste",function(){setTimeout(Dt,1)}),st.keydown(function(e){e.keyCode==13&&Dt()}),at.text(m.cancelText),at.bind("click.spectrum",function(e){e.stopPropagation(),e.preventDefault(),Bt("cancel")}),ft.attr("title",m.clearText),ft.bind("click.spectrum",function(e){e.stopPropagation(),e.preventDefault(),St=!0,Rt(),y&&Wt(!0)}),lt.text(m.chooseText),lt.bind("click.spectrum",function(e){e.stopPropagation(),e.preventDefault(),qt()&&(Wt(!0),Bt())}),b(rt,function(e,t,n){F=e/_,St=!1,n.shiftKey&&(F=Math.round(F*10)/10),Rt()},Mt,_t),b(et,function(e,t){H=parseFloat(t/O),St=!1,m.showAlpha||(F=1),Rt()},Mt,_t),b(Y,function(e,t,n){if(!n.shiftKey)X=null;else if(!X){var r=B*k,i=L-j*L,s=Math.abs(e-r)>Math.abs(t-i);X=s?"x":"y"}var o=!X||X==="x",u=!X||X==="y";o&&(B=parseFloat(e/k)),u&&(j=parseFloat((L-t)/L)),St=!1,m.showAlpha||(F=1),Rt()},Mt,_t),gt?(Ft(gt),Ut(),wt=bt||tinycolor(gt).format,kt(gt)):Ut(),y&&Ht();var r=o?"mousedown.spectrum":"click.spectrum touchstart.spectrum";ot.delegate(".sp-thumb-el",r,n),ut.delegate(".sp-thumb-el:nth-child(1)",r,{ignore:!0},n)}function Ct(){if(S&&e.localStorage){try{var n=e.localStorage[S].split(",#");n.length>1&&(delete e.localStorage[S],t.each(n,function(e,t){kt(t)}))}catch(r){}try{U=e.localStorage[S].split(";")}catch(r){}}}function kt(t){if(E){var n=tinycolor(t).toRgbString();if(!R[n]&&U.indexOf(n)===-1){U.push(n);while(U.length>z)U.shift()}if(S&&e.localStorage)try{e.localStorage[S]=U.join(";")}catch(r){}}}function Lt(){var e=[];if(m.showPalette)for(i=0;i<U.length;i++){var t=tinycolor(U[i]).toRgbString();R[t]||e.push(U[i])}return e.reverse().slice(0,m.maxSelectionSize)}function At(){var e=It(),n=t.map(q,function(t,n){return c(t,e,"sp-palette-row sp-palette-row-"+n)});Ct(),U&&n.push(c(Lt(),e,"sp-palette-row sp-palette-row-selection")),ot.html(n.join(""))}function Ot(){if(m.showInitial){var e=yt,t=It();ut.html(c([e,t],t,"sp-palette-row-initial"))}}function Mt(){(L<=0||k<=0||O<=0)&&Xt(),G.addClass(W),X=null,K.trigger("dragstart.spectrum",[It()])}function _t(){G.removeClass(W),K.trigger("dragstop.spectrum",[It()])}function Dt(){var e=st.val();if(e!==null&&e!==""||!xt){var t=tinycolor(e);t.ok?(Ft(t),Wt(!0)):st.addClass("sp-validation-error")}else Ft(null),Wt(!0)}function Pt(){C?Bt():Ht()}function Ht(){var n=t.Event("beforeShow.spectrum");if(C){Xt();return}K.trigger(n,[It()]);if(T.beforeShow(It())===!1||n.isDefaultPrevented())return;h(),C=!0,t(V).bind("click.spectrum",Bt),t(e).bind("resize.spectrum",N),dt.addClass("sp-active"),G.removeClass("sp-hidden"),Xt(),Ut(),yt=It(),Ot(),T.show(yt),K.trigger("show.spectrum",[yt])}function Bt(n){if(n&&n.type=="click"&&n.button==2)return;if(!C||y)return;C=!1,t(V).unbind("click.spectrum",Bt),t(e).unbind("resize.spectrum",N),dt.removeClass("sp-active"),G.addClass("sp-hidden");var r=!tinycolor.equals(It(),yt);r&&(Et&&n!=="cancel"?Wt(!0):jt()),T.hide(It()),K.trigger("hide.spectrum",[It()])}function jt(){Ft(yt,!0)}function Ft(e,t){if(tinycolor.equals(e,It())){Ut();return}var n,r;!e&&xt?St=!0:(St=!1,n=tinycolor(e),r=n.toHsv(),H=r.h%360/360,B=r.s,j=r.v,F=r.a),Ut(),n&&n.ok&&!t&&(wt=bt||n.format)}function It(e){return e=e||{},xt&&St?null:tinycolor.fromRatio({h:H,s:B,v:j,a:Math.round(F*100)/100},{format:e.format||wt})}function qt(){return!st.hasClass("sp-validation-error")}function Rt(){Ut(),T.move(It()),K.trigger("move.spectrum",[It()])}function Ut(){st.removeClass("sp-validation-error"),zt();var e=tinycolor.fromRatio({h:H,s:1,v:1});Y.css("background-color",e.toHexString());var t=wt;F<1&&(F!==0||t!=="name")&&(t==="hex"||t==="hex3"||t==="hex6"||t==="name")&&(t="rgb");var n=It({format:t}),r="";mt.removeClass("sp-clear-display"),mt.css("background-color","transparent");if(!n&&xt)mt.addClass("sp-clear-display");else{var i=n.toHexString(),s=n.toRgbString();u||n.alpha===1?mt.css("background-color",s):(mt.css("background-color","transparent"),mt.css("filter",n.toFilter()));if(m.showAlpha){var a=n.toRgb();a.a=0;var f=tinycolor(a).toRgbString(),l="linear-gradient(left, "+f+", "+i+")";o?nt.css("filter",tinycolor(f).toFilter({gradientType:1},i)):(nt.css("background","-webkit-"+l),nt.css("background","-moz-"+l),nt.css("background","-ms-"+l),nt.css("background","linear-gradient(to right, "+f+", "+i+")"))}r=n.toString(t)}m.showInput&&st.val(r),m.showPalette&&At(),Ot()}function zt(){var e=B,t=j;if(xt&&St)it.hide(),tt.hide(),Z.hide();else{it.show(),tt.show(),Z.show();var n=e*k,r=L-t*L;n=Math.max(-A,Math.min(k-A,n-A)),r=Math.max(-A,Math.min(L-A,r-A)),Z.css({top:r+"px",left:n+"px"});var i=F*_;it.css({left:i-D/2+"px"});var s=H*O;tt.css({top:s-P+"px"})}}function Wt(e){var t=It(),n="",r=!tinycolor.equals(t,yt);t&&(n=t.toString(wt),kt(t)),ct&&K.val(n),yt=t,e&&r&&(T.change(t),K.trigger("change",[t]))}function Xt(){k=Y.width(),L=Y.height(),A=Z.height(),M=et.width(),O=et.height(),P=tt.height(),_=rt.width(),D=it.width(),y||(G.css("position","absolute"),G.offset(v(G,vt))),zt(),m.showPalette&&At(),K.trigger("reflow.spectrum")}function Vt(){K.show(),vt.unbind("click.spectrum touchstart.spectrum"),G.remove(),dt.remove(),s[Qt.id]=null}function $t(e,r){if(e===n)return t.extend({},m);if(r===n)return m[e];m[e]=r,Tt()}function Jt(){Q=!1,K.attr("disabled",!1),vt.removeClass("sp-disabled")}function Kt(){Bt(),Q=!0,K.attr("disabled",!0),vt.addClass("sp-disabled")}var m=p(d,r),y=m.flat,E=m.showSelectionPalette,S=m.localStorageKey,x=m.theme,T=m.callbacks,N=w(Xt,10),C=!1,k=0,L=0,A=0,O=0,M=0,_=0,D=0,P=0,H=0,B=0,j=0,F=1,I=[],q=[],R={},U=m.selectionPalette.slice(0),z=m.maxSelectionSize,W="sp-dragging",X=null,V=r.ownerDocument,J=V.body,K=t(r),Q=!1,G=t(l,V).addClass(x),Y=G.find(".sp-color"),Z=G.find(".sp-dragger"),et=G.find(".sp-hue"),tt=G.find(".sp-slider"),nt=G.find(".sp-alpha-inner"),rt=G.find(".sp-alpha"),it=G.find(".sp-alpha-handle"),st=G.find(".sp-input"),ot=G.find(".sp-palette"),ut=G.find(".sp-initial"),at=G.find(".sp-cancel"),ft=G.find(".sp-clear"),lt=G.find(".sp-choose"),ct=K.is("input"),ht=ct&&a&&K.attr("type")==="color",pt=ct&&!y,dt=pt?t(f).addClass(x).addClass(m.className):t([]),vt=pt?dt:K,mt=dt.find(".sp-preview-inner"),gt=m.color||ct&&K.val(),yt=!1,bt=m.preferredFormat,wt=bt,Et=!m.showButtons||m.clickoutFiresChange,St=!gt,xt=m.allowEmpty&&!ht;Nt();var Qt={show:Ht,hide:Bt,toggle:Pt,reflow:Xt,option:$t,enable:Jt,disable:Kt,set:function(e){Ft(e),Wt()},get:It,destroy:Vt,container:G};return Qt.id=s.push(Qt)-1,Qt}function v(e,n){var r=0,i=e.outerWidth(),s=e.outerHeight(),o=n.outerHeight(),u=e[0].ownerDocument,a=u.documentElement,f=a.clientWidth+t(u).scrollLeft(),l=a.clientHeight+t(u).scrollTop(),c=n.offset();return c.top+=o,c.left-=Math.min(c.left,c.left+i>f&&f>i?Math.abs(c.left+i-f):0),c.top-=Math.min(c.top,c.top+s>l&&l>s?Math.abs(s+o-r):r),c}function m(){}function g(e){e.stopPropagation()}function y(e,t){var n=Array.prototype.slice,r=n.call(arguments,2);return function(){return e.apply(t,r.concat(n.call(arguments)))}}function b(n,r,i,s){function d(e){e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault(),e.returnValue=!1}function v(e){if(a){if(o&&document.documentMode<9&&!e.button)return g();var t=e.originalEvent.touches,i=t?t[0].pageX:e.pageX,s=t?t[0].pageY:e.pageY,u=Math.max(0,Math.min(i-f.left,c)),p=Math.max(0,Math.min(s-f.top,l));h&&d(e),r.apply(n,[u,p,e])}}function m(e){var r=e.which?e.which==3:e.button==2,s=e.originalEvent.touches;!r&&!a&&i.apply(n,arguments)!==!1&&(a=!0,l=t(n).height(),c=t(n).width(),f=t(n).offset(),t(u).bind(p),t(u.body).addClass("sp-dragging"),h||v(e),d(e))}function g(){a&&(t(u).unbind(p),t(u.body).removeClass("sp-dragging"),s.apply(n,arguments)),a=!1}r=r||function(){},i=i||function(){},s=s||function(){};var u=n.ownerDocument||document,a=!1,f={},l=0,c=0,h="ontouchstart"in e,p={};p.selectstart=d,p.dragstart=d,p["touchmove mousemove"]=v,p["touchend mouseup"]=g,t(n).bind("touchstart mousedown",m)}function w(e,t,n){var r;return function(){var i=this,s=arguments,o=function(){r=null,e.apply(i,s)};n&&clearTimeout(r);if(n||!r)r=setTimeout(o,t)}}function E(){e.console&&(Function.prototype.bind?E=Function.prototype.bind.call(console.log,console):E=function(){Function.prototype.apply.call(console.log,console,arguments)},E.apply(this,arguments))}var r={beforeShow:m,move:m,change:m,show:m,hide:m,color:!1,flat:!1,showInput:!1,allowEmpty:!1,showButtons:!0,clickoutFiresChange:!1,showInitial:!1,showPalette:!1,showPaletteOnly:!1,showSelectionPalette:!0,localStorageKey:!1,appendTo:"body",maxSelectionSize:7,cancelText:"cancel",chooseText:"choose",clearText:"Clear Color Selection",preferredFormat:!1,className:"",showAlpha:!1,theme:"sp-light",palette:[["#ffffff","#000000","#ff0000","#ff8000","#ffff00","#008000","#0000ff","#4b0082","#9400d3"]],selectionPalette:[],disabled:!1},s=[],o=!!/msie/i.exec(e.navigator.userAgent),u=function(){function e(e,t){return!!~(""+e).indexOf(t)}var t=document.createElement("div"),n=t.style;return n.cssText="background-color:rgba(0,0,0,.5)",e(n.backgroundColor,"rgba")||e(n.backgroundColor,"hsla")}(),a=function(){var e=t("<input type='color' value='!' />")[0];return e.type==="color"&&e.value!=="!"}(),f=["<div class='sp-replacer'>","<div class='sp-preview'><div class='sp-preview-inner'></div></div>","<div class='sp-dd'>&#9660;</div>","</div>"].join(""),l=function(){var e="";if(o)for(var t=1;t<=6;t++)e+="<div class='sp-"+t+"'></div>";return["<div class='sp-container sp-hidden'>","<div class='sp-palette-container'>","<div class='sp-palette sp-thumb sp-cf'></div>","</div>","<div class='sp-picker-container'>","<div class='sp-top sp-cf'>","<div class='sp-fill'></div>","<div class='sp-top-inner'>","<div class='sp-color'>","<div class='sp-sat'>","<div class='sp-val'>","<div class='sp-dragger'></div>","</div>","</div>","</div>","<div class='sp-clear sp-clear-display'>","</div>","<div class='sp-hue'>","<div class='sp-slider'></div>",e,"</div>","</div>","<div class='sp-alpha'><div class='sp-alpha-inner'><div class='sp-alpha-handle'></div></div></div>","</div>","<div class='sp-input-container sp-cf'>","<input class='sp-input' type='text' spellcheck='false'  />","</div>","<div class='sp-initial sp-thumb sp-cf'></div>","<div class='sp-button-container sp-cf'>","<a class='sp-cancel' href='#'></a>","<button class='sp-choose'></button>","</div>","</div>","</div>"].join("")}(),S="spectrum.id";t.fn.spectrum=function(e,n){if(typeof e=="string"){var r=this,i=Array.prototype.slice.call(arguments,1);return this.each(function(){var n=s[t(this).data(S)];if(n){var o=n[e];if(!o)throw new Error("Spectrum: no such method: '"+e+"'");e=="get"?r=n.get():e=="container"?r=n.container:e=="option"?r=n.option.apply(n,i):e=="destroy"?(n.destroy(),t(this).removeData(S)):o.apply(n,i)}}),r}return this.spectrum("destroy").each(function(){var n=t.extend({},e,t(this).data()),r=d(this,n);t(this).data(S,r.id)})},t.fn.spectrum.load=!0,t.fn.spectrum.loadOpts={},t.fn.spectrum.draggable=b,t.fn.spectrum.defaults=r,t.spectrum={},t.spectrum.localization={},t.spectrum.palettes={},t.fn.spectrum.processNativeColorInputs=function(){a||t("input[type=color]").spectrum({preferredFormat:"hex6"})},function(){function f(e,t){e=e?e:"",t=t||{};if(typeof e=="object"&&e.hasOwnProperty("_tc_id"))return e;var n=l(e),i=n.r,o=n.g,u=n.b,a=n.a,c=s(100*a)/100,p=t.format||n.format;return i<1&&(i=s(i)),o<1&&(o=s(o)),u<1&&(u=s(u)),{ok:n.ok,format:p,_tc_id:r++,alpha:a,getAlpha:function(){return a},get_is_theme_color:function(){var e=Upfront.Views.Theme_Colors.colors.is_theme_color(this);return e!==!1?(this.is_theme_color=!0,e-=1,this.theme_color="#ufc"+e,this.theme_color_code=Upfront.Util.colors.convert_string_ufc_to_color(this.theme_color)):this.is_theme_color=!1,e},setAlpha:function(e){a=E(e),c=s(100*a)/100},toHsv:function(){var e=d(i,o,u);return{h:e.h*360,s:e.s,v:e.v,a:a}},toHsvString:function(){var e=d(i,o,u),t=s(e.h*360),n=s(e.s*100),r=s(e.v*100);return a==1?"hsv("+t+", "+n+"%, "+r+"%)":"hsva("+t+", "+n+"%, "+r+"%, "+c+")"},toHsl:function(){var e=h(i,o,u);return{h:e.h*360,s:e.s,l:e.l,a:a}},toHslString:function(){var e=h(i,o,u),t=s(e.h*360),n=s(e.s*100),r=s(e.l*100);return a==1?"hsl("+t+", "+n+"%, "+r+"%)":"hsla("+t+", "+n+"%, "+r+"%, "+c+")"},toHex:function(e){return m(i,o,u,e)},toHexString:function(e){return"#"+this.toHex(e)},toHex8:function(){return g(i,o,u,a)},toHex8String:function(){return"#"+this.toHex8()},toRgb:function(){return{r:s(i),g:s(o),b:s(u),a:a}},toRgbString:function(){return a==1?"rgb("+s(i)+", "+s(o)+", "+s(u)+")":"rgba("+s(i)+", "+s(o)+", "+s(u)+", "+c+")"},toPercentageRgb:function(){return{r:s(S(i,255)*100)+"%",g:s(S(o,255)*100)+"%",b:s(S(u,255)*100)+"%",a:a}},toPercentageRgbString:function(){return a==1?"rgb("+s(S(i,255)*100)+"%, "+s(S(o,255)*100)+"%, "+s(S(u,255)*100)+"%)":"rgba("+s(S(i,255)*100)+"%, "+s(S(o,255)*100)+"%, "+s(S(u,255)*100)+"%, "+c+")"},toName:function(){return a===0?"transparent":b[m(i,o,u,!0)]||!1},toFilter:function(e){var n="#"+g(i,o,u,a),r=n,s=t&&t.gradientType?"GradientType = 1, ":"";if(e){var l=f(e);r=l.toHex8String()}return"progid:DXImageTransform.Microsoft.gradient("+s+"startColorstr="+n+",endColorstr="+r+")"},toString:function(e){var t=!!e;e=e||this.format;var n=!1,r=!t&&a<1&&a>0,i=r&&(e==="hex"||e==="hex6"||e==="hex3"||e==="name");e==="rgb"&&(n=this.toRgbString()),e==="prgb"&&(n=this.toPercentageRgbString());if(e==="hex"||e==="hex6")n=this.toHexString();return e==="hex3"&&(n=this.toHexString(!0)),e==="hex8"&&(n=this.toHex8String()),e==="name"&&(n=this.toName()),e==="hsl"&&(n=this.toHslString()),e==="hsv"&&(n=this.toHsvString()),i?this.toRgbString():n||this.toHexString()}}}function l(e){var t={r:0,g:0,b:0},n=1,r=!1,i=!1;return typeof e=="string"&&(e=_(e)),typeof e=="object"&&(e.hasOwnProperty("r")&&e.hasOwnProperty("g")&&e.hasOwnProperty("b")?(t=c(e.r,e.g,e.b),r=!0,i=String(e.r).substr(-1)==="%"?"prgb":"rgb"):e.hasOwnProperty("h")&&e.hasOwnProperty("s")&&e.hasOwnProperty("v")?(e.s=L(e.s),e.v=L(e.v),t=v(e.h,e.s,e.v),r=!0,i="hsv"):e.hasOwnProperty("h")&&e.hasOwnProperty("s")&&e.hasOwnProperty("l")&&(e.s=L(e.s),e.l=L(e.l),t=p(e.h,e.s,e.l),r=!0,i="hsl"),e.hasOwnProperty("a")&&(n=e.a)),n=E(n),{ok:r,format:e.format||i,r:o(255,u(t.r,0)),g:o(255,u(t.g,0)),b:o(255,u(t.b,0)),a:n}}function c(e,t,n){return{r:S(e,255)*255,g:S(t,255)*255,b:S(n,255)*255}}function h(e,t,n){e=S(e,255),t=S(t,255),n=S(n,255);var r=u(e,t,n),i=o(e,t,n),s,a,f=(r+i)/2;if(r==i)s=a=0;else{var l=r-i;a=f>.5?l/(2-r-i):l/(r+i);switch(r){case e:s=(t-n)/l+(t<n?6:0);break;case t:s=(n-e)/l+2;break;case n:s=(e-t)/l+4}s/=6}return{h:s,s:a,l:f}}function p(e,t,n){function o(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+(t-e)*6*n:n<.5?t:n<2/3?e+(t-e)*(2/3-n)*6:e}var r,i,s;e=S(e,360),t=S(t,100),n=S(n,100);if(t===0)r=i=s=n;else{var u=n<.5?n*(1+t):n+t-n*t,a=2*n-u;r=o(a,u,e+1/3),i=o(a,u,e),s=o(a,u,e-1/3)}return{r:r*255,g:i*255,b:s*255}}function d(e,t,n){e=S(e,255),t=S(t,255),n=S(n,255);var r=u(e,t,n),i=o(e,t,n),s,a,f=r,l=r-i;a=r===0?0:l/r;if(r==i)s=0;else{switch(r){case e:s=(t-n)/l+(t<n?6:0);break;case t:s=(n-e)/l+2;break;case n:s=(e-t)/l+4}s/=6}return{h:s,s:a,v:f}}function v(e,t,n){e=S(e,360)*6,t=S(t,100),n=S(n,100);var r=i.floor(e),s=e-r,o=n*(1-t),u=n*(1-s*t),a=n*(1-(1-s)*t),f=r%6,l=[n,u,o,o,a,n][f],c=[a,n,n,u,o,o][f],h=[o,o,a,n,n,u][f];return{r:l*255,g:c*255,b:h*255}}function m(e,t,n,r){var i=[k(s(e).toString(16)),k(s(t).toString(16)),k(s(n).toString(16))];return r&&i[0].charAt(0)==i[0].charAt(1)&&i[1].charAt(0)==i[1].charAt(1)&&i[2].charAt(0)==i[2].charAt(1)?i[0].charAt(0)+i[1].charAt(0)+i[2].charAt(0):i.join("")}function g(e,t,n,r){var i=[k(A(r)),k(s(e).toString(16)),k(s(t).toString(16)),k(s(n).toString(16))];return i.join("")}function w(e){var t={};for(var n in e)e.hasOwnProperty(n)&&(t[e[n]]=n);return t}function E(e){e=parseFloat(e);if(isNaN(e)||e<0||e>1)e=1;return e}function S(e,t){N(e)&&(e="100%");var n=C(e);return e=o(t,u(0,parseFloat(e))),n&&(e=parseInt(e*t,10)/100),i.abs(e-t)<1e-6?1:e%t/parseFloat(t)}function x(e){return o(1,u(0,e))}function T(e){return parseInt(e,16)}function N(e){return typeof e=="string"&&e.indexOf(".")!=-1&&parseFloat(e)===1}function C(e){return typeof e=="string"&&e.indexOf("%")!=-1}function k(e){return e.length==1?"0"+e:""+e}function L(e){return e<=1&&(e=e*100+"%"),e}function A(e){return Math.round(parseFloat(e)*255).toString(16)}function O(e){return T(e)/255}function _(e){e=e.replace(t,"").replace(n,"").toLowerCase();var r=!1;if(y[e])e=y[e],r=!0;else if(e=="transparent")return{r:0,g:0,b:0,a:0,format:"name"};var i;return(i=M.rgb.exec(e))?{r:i[1],g:i[2],b:i[3]}:(i=M.rgba.exec(e))?{r:i[1],g:i[2],b:i[3],a:i[4]}:(i=M.hsl.exec(e))?{h:i[1],s:i[2],l:i[3]}:(i=M.hsla.exec(e))?{h:i[1],s:i[2],l:i[3],a:i[4]}:(i=M.hsv.exec(e))?{h:i[1],s:i[2],v:i[3]}:(i=M.hex8.exec(e))?{a:O(i[1]),r:T(i[2]),g:T(i[3]),b:T(i[4]),format:r?"name":"hex8"}:(i=M.hex6.exec(e))?{r:T(i[1]),g:T(i[2]),b:T(i[3]),format:r?"name":"hex"}:(i=M.hex3.exec(e))?{r:T(i[1]+""+i[1]),g:T(i[2]+""+i[2]),b:T(i[3]+""+i[3]),format:r?"name":"hex"}:!1}var t=/^[\s,#]+/,n=/\s+$/,r=0,i=Math,s=i.round,o=i.min,u=i.max,a=i.random;f.fromRatio=function(e,t){if(typeof e=="object"){var n={};for(var r in e)e.hasOwnProperty(r)&&(r==="a"?n[r]=e[r]:n[r]=L(e[r]));e=n}return f(e,t)},f.equals=function(e,t){return!e||!t?!1:f(e).toRgbString()==f(t).toRgbString()},f.random=function(){return f.fromRatio({r:a(),g:a(),b:a()})},f.desaturate=function(e,t){t=t===0?0:t||10;var n=f(e).toHsl();return n.s-=t/100,n.s=x(n.s),f(n)},f.saturate=function(e,t){t=t===0?0:t||10;var n=f(e).toHsl();return n.s+=t/100,n.s=x(n.s),f(n)},f.greyscale=function(e){return f.desaturate(e,100)},f.lighten=function(e,t){t=t===0?0:t||10;var n=f(e).toHsl();return n.l+=t/100,n.l=x(n.l),f(n)},f.darken=function(e,t){t=t===0?0:t||10;var n=f(e).toHsl();return n.l-=t/100,n.l=x(n.l),f(n)},f.complement=function(e){var t=f(e).toHsl();return t.h=(t.h+180)%360,f(t)},f.triad=function(e){var t=f(e).toHsl(),n=t.h;return[f(e),f({h:(n+120)%360,s:t.s,l:t.l}),f({h:(n+240)%360,s:t.s,l:t.l})]},f.tetrad=function(e){var t=f(e).toHsl(),n=t.h;return[f(e),f({h:(n+90)%360,s:t.s,l:t.l}),f({h:(n+180)%360,s:t.s,l:t.l}),f({h:(n+270)%360,s:t.s,l:t.l})]},f.splitcomplement=function(e){var t=f(e).toHsl(),n=t.h;return[f(e),f({h:(n+72)%360,s:t.s,l:t.l}),f({h:(n+216)%360,s:t.s,l:t.l})]},f.analogous=function(e,t,n){t=t||6,n=n||30;var r=f(e).toHsl(),i=360/n,s=[f(e)];for(r.h=(r.h-(i*t>>1)+720)%360;--t;)r.h=(r.h+i)%360,s.push(f(r));return s},f.monochromatic=function(e,t){t=t||6;var n=f(e).toHsv(),r=n.h,i=n.s,s=n.v,o=[],u=1/t;while(t--)o.push(f({h:r,s:i,v:s})),s=(s+u)%1;return o},f.readability=function(e,t){var n=f(e).toRgb(),r=f(t).toRgb(),i=(n.r*299+n.g*587+n.b*114)/1e3,s=(r.r*299+r.g*587+r.b*114)/1e3,o=Math.max(n.r,r.r)-Math.min(n.r,r.r)+Math.max(n.g,r.g)-Math.min(n.g,r.g)+Math.max(n.b,r.b)-Math.min(n.b,r.b);return{brightness:Math.abs(i-s),color:o}},f.readable=function(e,t){var n=f.readability(e,t);return n.brightness>125&&n.color>500},f.mostReadable=function(e,t){var n=null,r=0,i=!1;for(var s=0;s<t.length;s++){var o=f.readability(e,t[s]),u=o.brightness>125&&o.color>500,a=3*(o.brightness/125)+o.color/500;if(u&&!i||u&&i&&a>r||!u&&!i&&a>r)i=u,r=a,n=f(t[s])}return n};var y=f.names={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"0ff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"00f",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",burntsienna:"ea7e5d",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"0ff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"f0f",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"},b=f.hexNames=w(y),M=function(){var e="[-\\+]?\\d+%?",t="[-\\+]?\\d*\\.\\d+%?",n="(?:"+t+")|(?:"+e+")",r="[\\s|\\(]+("+n+")[,|\\s]+("+n+")[,|\\s]+("+n+")\\s*\\)?",i="[\\s|\\(]+("+n+")[,|\\s]+("+n+")[,|\\s]+("+n+")[,|\\s]+("+n+")\\s*\\)?";return{rgb:new RegExp("rgb"+r),rgba:new RegExp("rgba"+i),hsl:new RegExp("hsl"+r),hsla:new RegExp("hsla"+i),hsv:new RegExp("hsv"+r),hex3:/^([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hex8:/^([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/}}();e.tinycolor=f}(),t(function(){t.fn.spectrum.load&&t.fn.spectrum.processNativeColorInputs()})}(window,jQuery),define("spectrum",function(){}),function(e){Upfront.mainData.isRTL&&e.widget("ui.slider",e.ui.slider,{_handleEvents:{keydown:function(t){var n,r,i,s,o=e(t.target).data("ui-slider-handle-index");switch(t.keyCode){case e.ui.keyCode.HOME:case e.ui.keyCode.END:case e.ui.keyCode.PAGE_UP:case e.ui.keyCode.PAGE_DOWN:case e.ui.keyCode.UP:case e.ui.keyCode.RIGHT:case e.ui.keyCode.DOWN:case e.ui.keyCode.LEFT:t.preventDefault();if(!this._keySliding){this._keySliding=!0,e(t.target).addClass("ui-state-active"),n=this._start(t,o);if(n===!1)return}}s=this.options.step,this.options.values&&this.options.values.length?r=i=this.values(o):r=i=this.value();switch(t.keyCode){case e.ui.keyCode.HOME:i=this._valueMin();break;case e.ui.keyCode.END:i=this._valueMax();break;case e.ui.keyCode.PAGE_UP:i=this._trimAlignValue(r+(this._valueMax()-this._valueMin())/this.numPages);break;case e.ui.keyCode.PAGE_DOWN:i=this._trimAlignValue(r-(this._valueMax()-this._valueMin())/this.numPages);break;case e.ui.keyCode.UP:if(r===this._valueMax())return;i=this._trimAlignValue(r+s);break;case e.ui.keyCode.RIGHT:if(r===this._valueMax())return;i=this._trimAlignValue(r+ -s);break;case e.ui.keyCode.DOWN:if(r===this._valueMin())return;i=this._trimAlignValue(r-s);case e.ui.keyCode.LEFT:if(r===this._valueMin())return;i=this._trimAlignValue(r- -s)}this._slide(t,o,i)},keyup:function(t){var n=e(t.target).data("ui-slider-handle-index");this._keySliding&&(this._keySliding=!1,this._stop(t,n),this._change(t,n),e(t.target).removeClass("ui-state-active"))}},_normValueFromMouse:function(e){var t,n,r,i,s;return this.orientation==="horizontal"?(t=this.elementSize.width,n=e.x-this.elementOffset.left-(this._clickOffset?this._clickOffset.left:0)):(t=this.elementSize.height,n=e.y-this.elementOffset.top-(this._clickOffset?this._clickOffset.top:0)),r=n/t,r>1&&(r=1),r<0&&(r=0),r=1-r,i=this._valueMax()-this._valueMin(),s=this._valueMin()+r*i,this._trimAlignValue(s)},_refreshValue:function(){var t,n,r,i,s,o=this.options.range,u=this.options,a=this,f=this._animateOff?!1:u.animate,l={};if(this.options.values&&this.options.values.length)this.handles.each(function(r){n=(a.values(r)-a._valueMin())/(a._valueMax()-a._valueMin())*100,l[a.orientation==="horizontal"?"left":"bottom"]=n+"%",e(this).stop(1,1)[f?"animate":"css"](l,u.animate),a.options.range===!0&&(a.orientation==="horizontal"?(r===0&&a.range.stop(1,1)[f?"animate":"css"]({left:n+"%"},u.animate),r===1&&a.range[f?"animate":"css"]({width:n-t+"%"},{queue:!1,duration:u.animate})):(r===0&&a.range.stop(1,1)[f?"animate":"css"]({bottom:n+"%"},u.animate),r===1&&a.range[f?"animate":"css"]({height:n-t+"%"},{queue:!1,duration:u.animate}))),t=n});else{r=this.value(),i=this._valueMin(),s=this._valueMax(),n=s!==i?(r-i)/(s-i)*100:0;var c=n;this.orientation==="horizontal"&&(c=100-n),l[this.orientation==="horizontal"?"left":"bottom"]=c+"%",this.handle.stop(1,1)[f?"animate":"css"](l,u.animate),o==="min"&&this.orientation==="horizontal"&&this.range.stop(1,1)[f?"animate":"css"]({width:n+"%"},u.animate),o==="max"&&this.orientation==="horizontal"&&this.range[f?"animate":"css"]({width:100-n+"%"},{queue:!1,duration:u.animate}),o==="min"&&this.orientation==="vertical"&&this.range.stop(1,1)[f?"animate":"css"]({height:n+"%"},u.animate),o==="max"&&this.orientation==="vertical"&&this.range[f?"animate":"css"]({height:100-n+"%"},{queue:!1,duration:u.animate})}}}),e.cssHooks.backgroundColor={set:function(t,n){if(n.indexOf("ufc")===-1){t.style.backgroundColor=n;return}t.style.backgroundColor=Upfront.Util.colors.get_color(n),e(t).data("ufc",n),e(t).data("ufc_rule","backgroundColor")}},e.cssHooks.color={set:function(t,n){if(n.indexOf("ufc")===-1){t.style.color=n;return}t.style.color=Upfront.Util.colors.get_color(n),e(t).data("ufc",n),e(t).data("ufc_rule","color")}};var t=Upfront.Settings&&Upfront.Settings.l10n?Upfront.Settings.l10n.global.views:Upfront.mainData.l10n.global.views;define("editor_views",["chosen","scripts/upfront/global-event-handlers","scripts/upfront/inline-panels/inline-panels","scripts/upfront/element-settings/sidebar","scripts/upfront/link-panel","text!upfront/templates/property.html","text!upfront/templates/properties.html","text!upfront/templates/property_edit.html","text!upfront/templates/overlay_grid.html","text!upfront/templates/edit_background_area.html","text!upfront/templates/sidebar_settings_lock_area.html","text!upfront/templates/sidebar_settings_background.html","text!upfront/templates/popup.html","text!upfront/templates/region_add_panel.html","text!upfront/templates/region_edit_panel.html","text!upfront/templates/sidebar_settings_theme_colors.html","text!upfront/templates/color_picker.html","spectrum"],function(n,r,i,s,o){var u=["text!upfront/templates/property.html","text!upfront/templates/properties.html","text!upfront/templates/property_edit.html","text!upfront/templates/overlay_grid.html","text!upfront/templates/edit_background_area.html","text!upfront/templates/sidebar_settings_lock_area.html","text!upfront/templates/sidebar_settings_background.html","text!upfront/templates/popup.html","text!upfront/templates/region_add_panel.html","text!upfront/templates/region_edit_panel.html","text!upfront/templates/sidebar_settings_theme_colors.html","text!upfront/templates/color_picker.html"],a=_.rest(arguments,5),f={};_(u).each(function(e,t){e.match(/text!/)&&(f[e.replace(/text!upfront\/templates\//,"").replace(/\.html/,"")]=a[t])});var l=i;Upfront.Events.on("data:ready",function(){Upfront.data.tpls=f});var c={stop_scroll_propagation:function(t){t.on("DOMMouseScroll mousewheel",function(t){var n=e(this),r=this.scrollTop,i=this.scrollHeight,s=n.outerHeight(),o=t.originalEvent.wheelDelta,u=o>0,a=i>s;if(!a)return;t.stopPropagation();var f=function(){return t.preventDefault(),t.returnValue=!1,!1};if(!u&&-o>i-s-r)return n.scrollTop(i),f();if(u&&o>r)return n.scrollTop(0),f()})}},h=Backbone.View.extend({events:{"click .upfront-property-change":"show_edit_property_partial","click .upfront-property-save":"save_property","click .upfront-property-remove":"remove_property"},render:function(){var e=_.template(f.property,this.model.toJSON());this.$el.html(e)},remove_property:function(){this.model.destroy()},save_property:function(){var e=this.$("#upfront-new_property-name").val(),t=this.$("#upfront-new_property-value").val();this.model.set({name:e,value:t}),this.render()},show_edit_property_partial:function(){var e=_.template(f.property_edit,this.model.toJSON());this.$el.html(e)}}),p=Backbone.View.extend({events:{"click #add-property":"show_new_property_partial","click #done-adding-property":"add_new_property"},initialize:function(){this.listenTo(this.model.get("properties"),"change",this.render),this.listenTo(this.model.get("properties"),"add",this.render),this.listenTo(this.model.get("properties"),"remove",this.render)},render:function(){var e=_.template(f.properties,this.model.toJSON()),t=this;this.$el.html(e),this.model.get("properties").each(function(e){var n=new h({model:e});n.render(),t.$el.find("dl").append(n.el)})},show_new_property_partial:function(){this.$("#add-property").hide(),this.$("#upfront-new_property").slideDown()},add_new_property:function(){var e=this.$("#upfront-new_property-name").val(),t=this.$("#upfront-new_property-value").val();this.model.get("properties").add(new Upfront.Models.Property({name:e,value:t})),this.$("#upfront-new_property").slideUp().find("input").val("").end(),this.$("#add-property").show()}}),d=Backbone.View.extend({tagName:"li",events:{click:"on_click"},on_click:function(){this.render()},add_module:function(e){var t=this.model.get("regions").active_region;if(!t)return Upfront.Util.log("select a region");Upfront.Events.trigger("entity:module:before_added",e,t);var n=this.model.get("wrappers"),r=Upfront.Util.get_unique_id("wrapper"),i=new Upfront.Models.Wrapper({name:"",properties:[{name:"wrapper_id",value:r},{name:"class",value:"c24 clr"}]});e.set_property("wrapper_id",r),n.add(i),t.get("modules").add(e),Upfront.Events.trigger("entity:module:added",e,t)}}),v=d.extend({className:"command-logo",render:function(){var e=Upfront.Settings.site_url;e[e.length-1]!="/"&&(e+="/"),Upfront.Application.get_current()!=Upfront.Settings.Application.MODE.CONTENT?this.$el.html('<a class="upfront-logo" href="'+e+'"></a>'):this.$el.html('<a class="upfront-logo upfront-logo-small" href="'+e+'"></a>')},on_click:function(){}}),m=d.extend({className:"command-exit upfront-icon upfront-icon-exit",render:function(){},on_click:function(){var n=window.location.pathname,r=new Upfront.Views.Editor.Loading({loading:t.exiting_upfront,done:t.exit_done,fixed:!0});r.render(),e("body").append(r.$el);if(n.indexOf("/create_new/")!==-1)return window.location.href=Upfront.Settings.site_url;if(n.indexOf("/edit/")!==-1&&_upfront_post_data&&_upfront_post_data.post_id)return window.location.href=Upfront.Settings.site_url+"/?p="+_upfront_post_data.post_id;if(window.location.search.match(/(\?|\&)editmode/))return window.location.search=window.location.search.replace(/(\?|\&)editmode(=[^?&]+)?/,"");window.location.reload(!0);var i=setTimeout(function(){r.cancel()},1e3)}}),g=d.extend({className:"command-new-post",postView:!1,postType:"post",setMode:!1,initialize:function(){this.setMode=Upfront.Application.MODE.CONTENT},render:function(){Upfront.Events.trigger("command:newpost:start",!0),this.$el.html(t.new_post),this.$el.prop("title",t.new_post)},on_click:function(e){e.preventDefault();if(Upfront.Settings.LayoutEditor.newpostType==this.postType)return Upfront.Views.Editor.notify(t.already_creating_post.replace(/%s/,this.postType),"warning");Upfront.Util.post({action:"upfront-create-post_type",data:_.extend({post_type:this.postType},{})}).done(function(e){Upfront.Application.navigate("/edit/post/"+e.data.post_id,{trigger:!0})})},on_post_loaded:function(e){this.postView||(this.postView=e,e.editPost(e.post),Upfront.data.currentEntity=e,Upfront.Events.off("elements:this_post:loaded",this.on_post_loaded,this),Upfront.Events.on("upfront:application:contenteditor:render",this.select_title,this))},select_title:function(){var t=this.postView.$(".post_title input").focus();t.val(t.val()),e("#upfront-loading").remove(),Upfront.Events.off("upfront:application:contenteditor:render",this.select_title,this)}}),y=g.extend({className:"command-new-page",postType:"page",_default_label:t.new_page,initialize:function(){this.setMode=Upfront.Application.MODE.LAYOUT},render:function(){Upfront.Events.trigger("command:newpage:start",!0),this.$el.html(this._default_label),this.$el.prop("title",this._default_label)},on_click:function(t){t.preventDefault();var n=this;this.spawn_modal(),this.modal.render(),e("body").append(this.modal.el),this.modal.open(function(){n.render_modal(),n.trigger("new_page:modal:open")}).done(function(){n.trigger("new_page:modal:close"),Upfront.Util.post({action:"upfront-create-post_type",data:_.extend({post_type:n.postType},n.modal._data)}).done(function(e){Upfront.Application.navigate("/edit/page/"+e.data.post_id,{trigger:!0})})})},render_modal:function(){var e=this,n=this.modal.$el.find(".upfront-inline-modal-content");n.empty().append("<h2>"+t.add_new_page+"</h2>"),_.each(e.modal._fields,function(e){e.render(),e.delegateEvents(),n.append(e.$el)})},spawn_modal:function(){if(this.modal)return this.initialize_modal_data();var n=this,r=function(){_.each(n.modal._fields,function(e,t){n.modal._data[t]=e.get_value()});if(!n.modal._fields.permalink.has_been_edited()){var t=e.trim(n.modal._data.title||n._default_label),r=t.replace(/^[^a-z0-9]+/gi,"").replace(/[^a-z0-9]+$/gi,"").replace(/[^-_0-9a-z]/gi,"-").toLowerCase();n.modal._fields.permalink.set_value(r)}},i=[{label:t.none,value:""}],s=Upfront.Util.post({action:"upfront-wp-model",model_action:"get_post_extra",postId:"fake",allTemplates:!0});this.modal=new Upfront.Views.Editor.Modal({to:e("body"),button:!0,top:120,width:540,button_text:t.create_page}),this.modal._fields={title:new Upfront.Views.Editor.Field.Text({label:"",name:"title",default_value:this._default_label,change:r}),permalink:new Xt({label:"<b>"+t.permalink+":</b> "+Upfront.Settings.site_url.replace(/\/$/,"")+"/",label_style:"inline",name:"permalink",change:r}),template:new Upfront.Views.Editor.Field.Select({label:t.page_template,name:"template",values:i})},this.initialize_modal_data(),this.on("new_page:modal:open",r,this),this.on("new_page:modal:close",r,this),s.done(function(e){n.modal._fields.template.options.values=i;if(!e.data||!e.data.allTemplates)return!1;_.each(e.data.allTemplates,function(e,t){n.modal._fields.template.options.values.push({label:t,value:e})}),n.modal._fields.template.render()})},initialize_modal_data:function(){var e=this;this.modal._data={},_.each(_.keys(this.modal._fields),function(t){e.modal._data[t]="",e.modal._fields[t].reset_state&&e.modal._fields[t].reset_state()})}}),b=d.extend({className:"command-save",render:function(){this.$el.html(t.save),this.$el.prop("title",t.save)},on_click:function(){_upfront_post_data.layout.specificity&&_upfront_post_data.layout.item&&!_upfront_post_data.layout.item.match(/-page/)?Upfront.Events.trigger("command:layout:save_as"):Upfront.Events.trigger("command:layout:save")}}),w=d.extend({render:function(){this.$el.html(t.save_as),this.$el.prop("title",t.save_as)},on_click:function(){Upfront.Events.trigger("command:layout:save_as")}}),E=b.extend({className:"command-save",render:function(){this.$el.addClass("upfront-icon upfront-icon-save"),this.$el.html(t.save_layout),this.$el.prop("title",t.save_layout)},on_click:function(){Upfront.Events.trigger("post:layout:save")}}),S=d.extend({className:"command-cancel",render:function(){this.$el.html(t.cancel),this.$el.prop("title",t.cancel)},on_click:function(){Upfront.Events.trigger("post:layout:cancel"),Upfront.Application.is_builder()&&Upfront.Events.trigger("post:layout:post:style:cancel")}}),x=d.extend({className:"command-preview",can_preview:!1,render:function(){this.$el.addClass("command-save command-preview upfront-icon upfront-icon-save"),this.preview_built(),Upfront.Events.on("preview:build:start",this.building_preview,this),Upfront.Events.on("preview:build:stop",this.preview_built,this)},on_click:function(){this.can_preview&&Upfront.Events.trigger("command:layout:preview")},building_preview:function(){this.$el.html(t.building),this.can_preview=!1},preview_built:function(){this.$el.html(t.preview),this.$el.prop("title",t.preview),this.can_preview=!0}}),T=d.extend({render:function(){this.$el.html(t.alternate_layout),this.$el.prop("title",t.alternate_layout)},on_click:function(){Upfront.Events.trigger("command:layout:load",2)}}),N=d.extend({className:"command-publish-layout",render:function(){this.$el.html(t.publish_layout)},on_click:function(){Upfront.Events.trigger("command:layout:publish")}}),C=d.extend({className:"command-undo",initialize:function(){Upfront.Events.on("command:undo",this.render,this),Upfront.Events.on("command:redo",this.render,this),Upfront.Events.on("upfront:undo:state_stored",this.render,this),this.deactivate()},render:function(){this.$el.addClass("upfront-icon upfront-icon-undo"),this.$el.html(t.undo),this.$el.prop("title",t.undo),this.model.has_undo_states()?this.activate():this.deactivate()},activate:function(){this.$el.css("opacity",1)},deactivate:function(){this.$el.css("opacity",.5)},on_click:function(){var n=this,r=!1,i=new Upfront.Views.Editor.Loading({loading:t.undoing,done:t.undoing_done,fixed:!0});i.render(),e("body").append(i.$el),r=n.model.restore_undo_state(),r&&r.done?r.done(function(){Upfront.Events.trigger("command:undo"),n.render(),i.done()}):setTimeout(function(){i.done()},100)}}),k=d.extend({className:"command-redo",initialize:function(){Upfront.Events.on("command:undo",this.render,this),this.deactivate()},render:function(){this.$el.addClass("upfront-icon upfront-icon-redo"),this.$el.html(t.redo),this.$el.prop("title",t.redo),this.model.has_redo_states()?this.activate():this.deactivate()},activate:function(){this.$el.css("opacity",1)},deactivate:function(){this.$el.css("opacity",.5)},on_click:function(){var n=this,r=!1,i=new Upfront.Views.Editor.Loading({loading:t.redoing,done:t.redoing_done,fixed:!0});i.render(),e("body").append(i.$el),r=n.model.restore_redo_state(),r&&r.done?r.done(function(){Upfront.Events.trigger("command:redo"),n.render(),i.done()}):setTimeout(function(){i.done()},100)}}),L=d.extend({render:function(){this.$el.html(t.export_history)},on_click:function(){alert("Check console output"),console.log({undo:Upfront.Util.Transient.get_all("undo"),redo:Upfront.Util.Transient.get_all("redo")})}}),A=d.extend({render:function(){if(!this.model.merge.length)return!1;this.$el.html(t.merge_selected)},on_click:function(){var t=this.model.merge,n=this.model.get("regions").active_region,r=n.get("modules"),i=[];_(t).each(function(e){e.get("objects").each(function(e){i.push(e)}),r.remove(e)});var s=Upfront.Util.get_unique_id("module"),o=new Upfront.Models.Module({name:"Merged module",properties:[{name:"element_id",value:s},{name:"class",value:"c24"}],objects:i});this.add_module(o),e("#"+s).trigger("click"),this.remove(),this.trigger("upfront:command:remove",this),Upfront.Events.trigger("command:merge")}}),O=d.extend({initialize:function(){Upfront.Events.on("entity:activated",this.activate,this),Upfront.Events.on("entity:deactivated",this.deactivate,this),this.deactivate()},render:function(){this.$el.html(t.delete_string)},on_click:function(){var e=this.model.get("regions").active_region,t=e.get("modules"),n=t.active_entity;if(n)return this.delete_module(e,n);t.each(function(e){var t=e.get("objects"),n=t.active_entity;n&&t.remove(n)})},activate:function(){this.$el.css("text-decoration","none")},deactivate:function(){this.$el.css("text-decoration","line-through")},delete_module:function(e,t){var n=e.get("modules");n.remove(t)}}),M=d.extend({initialize:function(){Upfront.Events.on("command:merge",this.on_click,this)},render:function(){this.$el.html("Select mode "+(this._selecting?"on":"off")),this.$el.html(this._selecting?t.select_mode_on:t.select_mode_off)},on_click:function(){this._selecting?Upfront.Events.trigger("command:deselect"):Upfront.Events.trigger("command:select"),this._selecting=!this._selecting,this.render()}}),D=d.extend({className:"command-grid",render:function(){this.$el.addClass("upfront-icon upfront-icon-grid"),this.$el.prop("title",t.toggle_grid),this.listenTo(Upfront.Events,"entity:region:added",this.update_grid),this.listenTo(Upfront.Events,"upfront:layout_size:change_breakpoint",this.update_grid),this.listenTo(Upfront.Events,"grid:toggle",this.on_click)},on_click:function(){e(".upfront-overlay-grid").size()||this.create_grid(),this.toggle_grid()},create_grid:function(){this.update_grid()},toggle_grid:function(){Upfront.Application.get_gridstate()?this.hide_grid():this.show_grid()},show_grid:function(){this.$el.addClass("upfront-icon-grid-active"),e(".upfront-overlay-grid").addClass("upfront-overlay-grid-show"),Upfront.Application.set_gridstate(!0)},hide_grid:function(){this.$el.removeClass("upfront-icon-grid-active"),e(".upfront-overlay-grid").removeClass("upfront-overlay-grid-show"),Upfront.Application.set_gridstate(!1)},update_grid:function(t){var n=e(Upfront.Settings.LayoutEditor.Selectors.main),r=Upfront.Settings.LayoutEditor.Grid;e(".upfront-overlay-grid").remove(),e(".upfront-grid-layout, .upfront-region-side-fixed .upfront-modules_container, .upfront-region-side-lightbox .upfront-modules_container").each(function(){var t=r.size,n=_.template(f.overlay_grid,{columns:t,size_class:r.class,style:"simple"});e(this).prepend(n),Upfront.Application.adjust_grid_padding_settings(this)}),!Upfront.Application.get_gridstate()||this.show_grid()}}),P=d.extend({className:"command-reset-everything",render:function(){this.$el.html("<span title='"+t.destroy_layout+"'>"+t.reset_everything+"</span>")},on_click:function(){Upfront.Util.reset().success(function(){Upfront.Util.log("layout reset"),window.location.reload()}).error(function(){Upfront.Util.log("error resetting layout")})}}),H=d.extend({className:"command-toggle-mode",enabled:!0,initialize:function(){Upfront.Events.on("upfront:element:edit:start",this.disable_toggle,this),Upfront.Events.on("upfront:element:edit:stop",this.enable_toggle,this)},render:function(){this.$el.html(_.template("<span title='toggle editing mode'>"+t.current_mode+"</span>",{mode:Upfront.Application.get_current()}))},on_click:function(){if(!this.enabled)return!1;var e=Upfront.Application.mode&&Upfront.Application.mode.current&&Upfront.Application.mode.current!=Upfront.Application.MODE.CONTENT?Upfront.Application.MODE.CONTENT:Upfront.Application.mode.last;Upfront.Application.start(e)},disable_toggle:function(){this.$el.css("opacity",.5),this.enabled=!1},enable_toggle:function(){this.$el.css("opacity",1),this.enabled=!0}}),B=H.extend({className:"command-toggle-mode upfront-icon",current_mode:!1,render:function(){this.current_mode&&this.$el.removeClass("command-toggle-mode-"+this.current_mode+" upfront-icon-collapse upfront-icon-expand"),this.current_mode=Upfront.Application.get_current();var e=this.current_mode!=Upfront.Application.MODE.CONTENT?"upfront-icon-collapse":"upfront-icon-expand";this.$el.addClass("command-toggle-mode-"+this.current_mode+" "+e)}}),j=d.extend({className:"command-edit-background-area",events:{"click .switch":"on_switch"},initialize:function(){Upfront.Events.on("command:newpage:start",this.switchOff,this),Upfront.Events.on("command:newpost:start",this.switchOff,this)},render:function(){var e=_.template(f.edit_background_area,{});this.$el.html(e)},on_switch:function(){var t=e(Upfront.Settings.LayoutEditor.Selectors.main);this.$el.find(".switch-on").hasClass("active")?this.switchOff():(this.$el.find(".switch-off").removeClass("active"),this.$el.find(".switch-on").addClass("active"),t.addClass("upfront-region-editing"),Upfront.Events.trigger("command:region:edit_toggle",!0))},switchOff:function(){var t=e(Upfront.Settings.LayoutEditor.Selectors.main);this.$el.find(".switch-off").addClass("active"),this.$el.find(".switch-on").removeClass("active"),t.removeClass("upfront-region-editing"),t.removeClass("upfront-region-lightbox-editing"),Upfront.Events.trigger("command:region:edit_toggle",!1)}}),F=d.extend({className:"themes-dropdown",enabled:!0,events:{"click .upfront-field-select-value":"openOptions","mouseup .upfront-field-select":"onMouseUp","change .upfront-field-select-option input":"onChange","click .upfront-field-select-option label":"onOptionClick"},initialize:function(){var e=_.union([{label:t.choose_theme,value:""}],_.map(Upfront.themeExporter.themes,function(e){return{label:e.name,value:e.directory}}));this.fields=[new en({values:e,default_value:Upfront.themeExporter.currentTheme==="upfront"?"":Upfront.themeExporter.currentTheme,change:function(){if(this.get_value()===""||this.get_value()===Upfront.themeExporter.currentTheme)return;Upfront.Events.trigger("builder:load_theme",this.get_value())}})]},render:function(){this.fields[0].render(),this.$el.append(this.fields[0].el)},openOptions:function(e){this.fields[0].openOptions(e)},onMouseUp:function(e){this.fields[0].onMouseUp(e)},onChange:function(e){this.fields[0].onChange(e)},onOptionClick:function(e){this.fields[0].onOptionClick(e)}}),I=d.extend({className:"command-new-layout",render:function(){this.$el.addClass("upfront-icon upfront-icon-layout"),this.$el.html(t.new_layout),this.$el.prop("title",t.new_layout)},on_click:function(){Upfront.Events.trigger("command:layout:create")}}),q=d.extend({className:"command-browse-layout upfront-icon upfront-icon-browse-layouts",render:function(){this.$el.html(t.layouts),this.$el.prop("title",t.layouts)},on_click:function(){Upfront.Events.trigger("command:layout:browse")}}),R=d.extend({tagName:"div",className:"command-link command-edit-structure",render:function(){this.$el.html(t.edit_grid),this.$el.prop("title",t.edit_grid)},on_click:function(){Upfront.Events.trigger("command:layout:edit_structure")}}),U=d.extend({tagName:"div",className:"command-link command-edit-bg",render:function(){this.$el.text(t.edit_global_bg),this.$el.prop("title",t.edit_global_bg)},on_click:function(){Upfront.Events.trigger("command:layout:edit_background")}}),z=d.extend({tagName:"div",className:"command-link command-edit-global-regions",render:function(){this.$el.text(t.edit_global_regions),this.$el.prop("title",t.edit_global_regions)},on_click:function(){Upfront.Events.trigger("command:layout:edit_global_regions")}}),W=d.extend({tagName:"div",className:"command-edit-css upfront-icon upfront-icon-edit-css",render:function(){this.$el.html("<span>"+t.add_custom_css_rules+"</span>"),this.$el.prop("title",t.add_custom_css_rules)},on_click:function(){var e=Upfront.Application.cssEditor,t;e.init({model:this.model,type:"Layout",sidebar:!1,element_id:"layout",global:!0})}}),X=d.extend({tagName:"div",className:"command-open-font-manager upfront-icon upfront-icon-open-font-manager",render:function(){this.$el.html('<span title="'+t.theme_font_manager+'">'+t.theme_font_manager+"</span>")},on_click:function(){Upfront.Events.trigger("command:themefontsmanager:open")}}),V=d.extend({tagName:"div",className:"command-edit-css upfront-icon upfront-icon-edit-css",initialize:function(){this.lazy_save_styles=_.debounce(function(e){this.model.set({styles:e})},1e3)},render:function(){this.$el.html('<span title="'+t.add_custom_css_rules+'">'+t.add_custom_css_rules+"</span>")},on_click:function(){var e,t=this;e=new Wn({model:this.model,page_class:this.model.get("id")+"-breakpoint",type:"Layout",sidebar:!1,global:!0,change:function(e){t.lazy_save_styles(e)}}),Upfront.Events.on("upfront:layout_size:change_breakpoint",function(){e.close()})}}),J=d.extend({tagName:"div",className:"command-go-to-type-preview",render:function(){this.$el.text(t.go_to_preview_page)},on_click:function(){alert("This is just placeholder :)")}}),K=d.extend({className:"command-export upfront-icon upfront-icon-export",render:function(){this.$el.text(t.export_str)},on_click:function(){e("div.redactor_editor").each(function(){var t=e(this).data("ueditor");t&&t.stop()}),Upfront.Events.trigger("command:layout:export_theme")}}),Q=d.extend({enabled:!0,className:"command-create-responsive-layouts upfront-icon upfront-icon-start-responsive",render:function(){this.$el.html("<span title='"+t.create_responsive_layouts+"'>"+t.create_responsive_layouts+"</span>")},on_click:function(){Upfront.Application.start(Upfront.Application.MODE.RESPONSIVE)}}),G=d.extend({enabled:!0,className:"command-start-responsive upfront-icon upfront-icon-start-responsive",render:function(){this.$el.html("<span title='"+t.responsive_mode+"'>"+t.responsive_mode+"</span>")},on_click:function(){Upfront.Application.start(Upfront.Application.MODE.RESPONSIVE)}}),Y=d.extend({enabled:!0,className:"exit-responsive",render:function(){this.$el.html("<span title='"+t.exit_responsive+"'>"+t.exit_responsive+"</span>")},on_click:function(){e("li.desktop-breakpoint-activate").trigger("click"),Upfront.Application.start(Upfront.Application.mode.last)}}),Z=d.extend({className:"activate-breakpoints-dropdown",enabled:!0,initialize:function(){var e=yr.get_breakpoints();this.fields=[new Zn({multiple:!0,label_text:t.activate_breakpoints,collection:e})]},render:function(){this.fields[0].render(),this.$el.append(this.fields[0].el),this.fields[0].delegateEvents()},on_click:function(){}}),et=Backbone.View.extend({tagName:"li",className:"upfornt-icon upfront-icon-add",id:"new-custom-breakpoint",events:{click:"add_breakpoint"},render:function(){this.$el.html(t.new_breakpoint)},initialize:function(e){this.collection=yr.get_breakpoints()},add_breakpoint:function(n){n.preventDefault();var r,i=new vr({id:this.collection.get_unique_id()});this.collection.add(i),i.set({enabled:!0}),i.set({active:!0}),r=Upfront.Popup.open(function(n,r,s){r.empty();var o=e(this),u=new Sr({model:i});o.append(u.render().el),s.append('<div class="breakpoint-edit-ok-button">'+t.ok+"</div>"),e("#upfront-popup-close").hide(),e(".breakpoint-edit-ok-button").on("click",function(){Upfront.Popup.close(),e("#upfront-popup-close").show()})},{width:400})}}),tt=C.extend({on_click:function(){alert("This is just placeholder.")}}),nt=k.extend({on_click:function(){alert("This is just placeholder.")}}),rt=d.extend({className:"command-browse-layout command-browse-layout-responsive",render:function(){this.$el.html('<span title="'+t.browse_layouts+'">'+t.browse_layouts+"</span>")},on_click:function(){Upfront.Events.trigger("command:layout:browse")}}),it=Backbone.View.extend({tagName:"ul",initialize:function(){this.commands=_([new y({model:this.model}),new g({model:this.model}),new b({model:this.model}),new w({model:this.model}),new C({model:this.model}),new k({model:this.model}),new O({model:this.model}),new M({model:this.model}),new D({model:this.model}),new P({model:this.model})]),Upfront.Settings.Debug.transients&&this.commands.push(new L({model:this.model}))},render:function(){this.$el.find("li").remove(),this.commands.each(this.add_command,this)},add_command:function(e){if(!e)return;e.remove(),e.render(),this.$el.append(e.el),e.bind("upfront:command:remove",this.remove_command,this),e.delegateEvents()},remove_command:function(e){var t=this.commands.reject(function(t){return t.remove(),t.cid==e.cid});this.commands=_(t),this.render()}}),st=Backbone.View.extend(_.extend({},c,{tagName:"li",className:"sidebar-panel",events:{"click .sidebar-panel-title":"on_click","click .sidebar-panel-tab":"show_tab"},get_title:function(){return""},render:function(){var e=this;this.active?this.$el.addClass("active"):this.$el.removeClass("active"),this.$el.html('<h3 class="sidebar-panel-title">'+this.get_title()+"</h3>"),this.$el.append('<div class="sidebar-panel-content" />'),this.stop_scroll_propagation(this.$el.find(".sidebar-panel-content")),this.sections&&(e.$el.find(".sidebar-panel-title").after("<ul class='sidebar-panel-tabspane'></ul>"),this.sections.each(function(t){t.render(),e.$el.find(".sidebar-panel-tabspane").append("<li data-target='"+t.cid+"' class='sidebar-panel-tab'>"+t.get_title()+"</li>"),e.$el.find(".sidebar-panel-content").append("<div class='sidebar-tab-content' id='"+t.cid+"'></div>"),e.$el.find(".sidebar-panel-content").find(".sidebar-tab-content").last().html(t.el)})),this.on_render&&this.on_render(),this.$el.find(".sidebar-panel-tab").first().addClass("active"),this.$el.find(".sidebar-tab-content").first().show()},get_section:function(e){return this.sections?this.sections.find(function(t){return t.get_name()==e}):!1},on_click:function(){e(".sidebar-panel").not(this.$el).removeClass("expanded"),this.$el.addClass("expanded"),e(".sidebar-panel").not(this.$el).find(".sidebar-panel-tabspane").hide(),this.$el.find(".sidebar-panel-tabspane").not(".sidebar-panel-tabspane-hidden").show()},show_tab:function(t){var n="#"+e(t.target).data("target");this.$el.find(".sidebar-panel-tab").removeClass("active"),e(t.target).addClass("active"),this.$el.find(".sidebar-tab-content").hide(),this.$el.find(n).show()}})),ot=Backbone.View.extend({tagName:"div",className:"panel-setting upfront-no-select",render:function(){this.on_render&&this.on_render()}}),ut=Backbone.View.extend({tagName:"div",className:"panel-section",initialize:function(){this.settings=_([])},get_title:function(){},render:function(){var e=this;this.$el.html(""),this.$el.append('<div class="panel-section-content" />'),this.settings.each(function(t){t.render(),t.delegateEvents(),e.$el.find(".panel-section-content").append(t.el)}),this.on_render&&this.on_render()}}),at=Backbone.View.extend({tagName:"span",className:"draggable-element upfront-no-select",shadow_id:"",draggable:!0,priority:1e4,initialize:function(e){this.options=e,this.title=e.title||t.no_title},render:function(){this.$el.html(this.title)},add_module:function(e){var t=this.model.get("regions").get_by_name("shadow");if(!t||!t.get)return!1;this.shadow_id=Upfront.Util.get_unique_id("shadow"),e.set({shadow:this.shadow_id},{silent:!0}),t.get("modules").add(e)}}),ft=st.extend({className:"sidebar-panel sidebar-panel-elements",initialize:function(){this.active=!0,this.sections=_([new lt({model:this.model}),new ct({model:this.model}),new ht({model:this.model})]),this.elements=_([]),Upfront.Events.on("command:layout:save",this.on_save,this),Upfront.Events.on("command:layout:save_as",this.on_save,this),Upfront.Events.on("command:layout:publish",this.on_save,this),Upfront.Events.on("command:layout:save_success",this.on_save_after,this),Upfront.Events.on("command:layout:save_error",this.on_save_after,this),Upfront.Events.on("entity:drag_stop",this.reset_modules,this),Upfront.Events.on("layout:render",this.apply_state_binding,this)},get_title:function(){return t.draggable_elements},on_save:function(){var e=this.model.get("regions");this._shadow_region=e.get_by_name("shadow"),e.remove(this._shadow_region,{silent:!0})},on_preview:function(){return this.on_save()},apply_state_binding:function(){Upfront.Events.on("command:undo",this.reset_modules,this),Upfront.Events.on("command:redo",this.reset_modules,this)},on_render:function(){this.reset_modules(),Upfront.Application.get_current()!=Upfront.Settings.Application.MODE.THEME&&this.$el.find(".sidebar-panel-title").trigger("click")},on_save_after:function(){var e=this.model.get("regions");this._shadow_region?e.add(this._shadow_region,{silent:!0}):this.reset_modules()},get_elements:function(){var e=[];return this.sections&&this.sections.each(function(t){t.elements&&e.push(t.elements.value())}),_(_.flatten(e))},update_sections:function(){if(!this.sections)return;var e=this,t=0;this.sections.each(function(n){n.elements&&n.elements.size()>0?t++:(e.$el.find(".sidebar-panel-tabspane [data-target="+n.cid+"]").hide(),e.$el.find(".sidebar-panel-content #"+n.cid).hide())}),t<=1?this.$el.find(".sidebar-panel-tabspane").addClass("sidebar-panel-tabspane-hidden"):this.$el.find(".sidebar-panel-tabspane").removeClass("sidebar-panel-tabspane-hidden")},reset_modules:function(){var e=this.model.get("regions"),t=e?e.get_by_name("shadow"):!1,n=this.get_elements();this.update_sections();if(!e)return!1;t||(t=new Upfront.Models.Region({name:"shadow",container:"shadow",title:"Shadow Region"}),this.model.get("regions").add(t));if(t.get("modules").length!=n.size()){var r=t.get("modules");n.each(function(e){var t=!1;r.forEach(function(n){n.get("shadow")==e.shadow_id&&(t=!0)}),t||e.add_element()},this)}}}),lt=ut.extend({initialize:function(){this.settings=_([]),this.elements=_([])},get_name:function(){return"layout"},get_title:function(){return"Layout"},on_render:function(){this.elements.each(this.render_element,this)},render_element:function(t){if(!t.draggable)return;var n=e(Upfront.Settings.LayoutEditor.Selectors.main),r=this;t.remove(),t.render(),this.$el.find(".panel-section-content").append(t.el),t.$el.on("mousedown",function(n){var r=e(Upfront.Settings.LayoutEditor.Selectors.main),i=e("[data-shadow="+t.shadow_id+"]"),s=r.offset(),o=i.position(),u=i.offset(),a=t.$el.offset(),f=i.outerHeight(),l=i.outerWidth(),c=t.$el.clone(),h=t.$el.outerHeight(),p=t.$el.outerWidth(),d=e('<div id="element-drag-wrapper" class="upfront-ui" />'),v=e(".upfront-grid-layout-gutter-left:first, .upfront-grid-layout-gutter-right:first");i.css({position:"absolute",top:n.pageY-(u.top-o.top)-f/2,left:n.pageX-(u.left-o.left)-l/2,visibility:"hidden",zIndex:-1}).one("mousedown",function(e){}).trigger(n).one("dragstart",function(n,r){t.$el.addClass("element-drag-active"),e("body").append(d),c.appendTo(d),c.addClass("element-dragging"),c.css({position:"absolute",top:n.pageY-h/2,left:n.pageX-p/2,zIndex:999})}).on("drag",function(t,n){var r=!1;v.each(function(){if(r)return;var n=e(this).offset(),i=e(this).width();t.pageX>=s.left&&t.pageX>=n.left+10&&t.pageX<=n.left+i-10&&(r=!0)}),r?c.addClass("element-dragging-no-drop"):c.removeClass("element-dragging-no-drop"),c.css({top:t.pageY-h/2,left:t.pageX-p/2})}).one("dragstop",function(e,n){t.$el.removeClass("element-drag-active"),c.remove(),d.remove()})})}}),ct=lt.extend({get_name:function(){return"data"},get_title:function(){return"Data"}}),ht=lt.extend({get_name:function(){return"plugins"},get_title:function(){return"Plugins"}}),pt=ft.extend({className:"sidebar-panel upfront-panel-post_panel",parts:["Title","Contents","Excerpt","Featured Image","Author","Author Gravatar","Date","Update","Comments Count","Tags","Categories"],partElements:[],initialize:function(e){this.active=!1,this.elements=_([]),Upfront.Events.on("entity:drag_stop",this.reset_modules,this),Upfront.Events.on("layout:render",this.apply_state_binding,this)},get_title:function(){return t.post_components},loadElements:function(){this.elements=_([]);var e=this,t=Upfront.Content.PostElement,n=Upfront.Application.LayoutEditor.Objects;return _.each(this.parts,function(r){var i=new t({title:r,model:Upfront.Application.layout}),s="PostPart_"+i.slug;e.elements.push(i),n[s]||(n[s]={Model:i.Model,View:i.View,Element:t,Settings:i.Settings},Upfront.Models[s+"Model"]=i.Model,Upfront.Views[s+"View"]=i.View),e.partElements.push(i)}),Upfront.Events.trigger("sidebar:postparts:loaded"),this},unloadElements:function(){var e=this,t=Upfront.Application.LayoutEditor.Objects;return _.each(this.partElements,function(e){var n="PostPart_"+e.slug;e.remove(),delete t[n],delete Upfront.Models[n+"Model"],delete Upfront.Views[n+"View"]}),this.partElements=[],Upfront.Events.trigger("sidebar:postparts:unloaded"),this}}),ot=Backbone.View.extend({tagName:"div",className:"panel-setting upfront-no-select",render:function(){this.on_render&&this.on_render()}}),ut=Backbone.View.extend({tagName:"div",className:"panel-section",initialize:function(){this.settings=_([])},get_title:function(){},render:function(){var e=this;this.$el.html(""),this.$el.append('<div class="panel-section-content" />'),this.settings.each(function(t){t.render(),t.delegateEvents(),e.$el.find(".panel-section-content").append(t.el)}),this.on_render&&this.on_render()}}),dt=ot.extend({fields:{},current_element:"h1",elements:["h1","h2","h3","h4","h5","h6","p","a","a:hover","ul","ol","blockquote","blockquote.upfront-quote-alternative"],inline_elements:["a","a:hover"],typefaces:{},styles:{},sizes:{},colors:{},line_heights:{},initialize:function(){var t=this;ot.prototype.initialize.call(this);var n=Nn.get_fonts();n&&n.state&&e.when(n).done(function(){t.render()}),this.listenTo(Upfront.Events,"upfront:render_typography_sidebar",this.render),this.listenTo(Upfront.Events,"entity:object:after_render",this.update_typography_elements),this.listenTo(Upfront.Events,"theme_colors:update",this.update_typography_elements,this)},on_render:function(){var n=this,r=[],i=e('<div class="upfront-typography-fields-left" />'),s=e('<div class="upfront-typography-fields-right" />'),o=this.model.get_property_value_by_name("typography"),u=_.findWhere(Upfront.Application.current_subapplication.get_layout_data().properties,{name:"typography"}),a={};u=u?u.value:a;var f,l,c;if(_.isEmpty(o))if(_.contains(["tablet","mobile"],this.model.get("id"))||this.model.get("name")==="big-tablet"){c=this.model.get("name")==="big-tablet"?"big-tablet":this.model.get("id");switch(c){case"big-tablet":o=_.clone(u);break;case"tablet":f=yr.get_breakpoints().findWhere({name:"big-tablet"}),_.isUndefined(f)||_.isUndefined(f.get("typography"))||_.isUndefined(f.get("typography").h2)?o=u:o=_.clone(f.get("typography"));break;case"mobile":l=yr.get_breakpoints().findWhere({id:"tablet"}),_.isUndefined(l)||_.isUndefined(l.get("typography"))||_.isUndefined(l.get("typography").h2)?o=_.clone(u):o=_.clone(l.get("typography"))}}else o=u||a;this.typography=o,Upfront.mainData.global_typography=o;var h=Upfront.Application.get_current(),p=Upfront.Settings.Application.MODE.THEME,d=Upfront.mainData.userDoneFontsIntro,v=h===p&&!d||h!==p&&On.length===0&&!d,m;v?m=new Vt({label:t.select_fonts_to_use,compact:!0,classname:"open-theme-fonts-manager",on_click:function(e){Upfront.Events.trigger("command:themefontsmanager:open")}}):m=new X;if(On.length===0&&Upfront.mainData.userDoneFontsIntro===!1){this.$el.html('<p class="sidebar-info-notice upfront-icon">'+t.no_defined_fonts+"</p>"),m.render(),this.$el.append(m.el);return}_.each(o,function(e,t){n.typefaces[t]=e.font_face,n.colors[t]=e.color,n.styles[t]=Sn.get_variant(e.weight,e.style),e.size&&(n.sizes[t]=e.size),e.line_height&&(n.line_heights[t]=e.line_height)}),this.fields.length||(this.fields={start_font_manager:m,element:new Upfront.Views.Editor.Field.Select({label:t.type_element,default_value:"h1",values:[{label:t.h1,value:"h1"},{label:t.h2,value:"h2"},{label:t.h3,value:"h3"},{label:t.h4,value:"h4"},{label:t.h5,value:"h5"},{label:t.h6,value:"h6"},{label:t.p,value:"p"},{label:t.a,value:"a"},{label:t.ahover,value:"a:hover"},{label:t.ul,value:"ul"},{label:t.ol,value:"ol"},{label:t.bq,value:"blockquote"},{label:t.bqalt,value:"blockquote.upfront-quote-alternative"}],change:function(){var t=this.get_value(),r=_.contains(n.inline_elements,t);n.current_element=t,n.fields.typeface.set_value(n.typefaces[t]),n.update_styles_field(),r?e([n.fields.size.el,n.fields.line_height.el]).hide():(e([n.fields.size.el,n.fields.line_height.el]).show(),n.fields.size.set_value(n.sizes[t]),n.fields.line_height.set_value(n.line_heights[t]||"1.1")),n.fields.color.set_value(n.colors[t]),n.fields.color.update_input_border_color(n.colors[t])}}),typeface:new nn({label:t.typeface,values:On.get_fonts_for_select(),default_value:n.typefaces.h1,select_width:"225px",change:function(){var e=this.get_value(),t=n.current_element;n.typefaces[t]!=e&&(n.typefaces[t]=e,n.styles[t]=Sn.get_default_variant(e),n.update_typography(),n.update_styles_field())}}),style:this.get_styles_field(),color:new Upfront.Views.Editor.Field.Color({label:t.color,default_value:n.colors.h1,autoHide:!0,spectrum:{choose:function(e){var t=e.toRgb(),r="rgba("+t.r+","+t.g+","+t.b+","+e.alpha+")",i=n.current_element;r=e.get_is_theme_color()!==!1?e.theme_color:r,n.colors[i]!=r&&(n.colors[i]=r,n.update_typography(e))}}}),size:new Upfront.Views.Editor.Field.Number({label:t.size,min:0,max:100,suffix:t.px,default_value:n.sizes.h1,change:function(){var e=this.get_value(),t=n.current_element;n.sizes[t]!=e&&(n.sizes[t]=e,n.update_typography())}}),line_height:new Upfront.Views.Editor.Field.Number({label:t.line_height,min:0,max:10,step:.1,default_value:n.line_heights.h1,change:function(){var e=this.get_value(),t=n.current_element;n.line_heights[t]!=e&&(n.line_heights[t]=e,n.update_typography())}})}),this.$el.html(""),this.$el.addClass("typography-panel"),_.each(this.fields,function(e){e.render(),e.delegateEvents()}),this.$el.append([this.fields.start_font_manager.el,this.fields.element.el,this.fields.typeface.el]),e(".upfront-chosen-select",this.$el).chosen({width:"230px"}),i.append([this.fields.style.el,this.fields.size.el]),this.$el.append(i),s.append([this.fields.color.el,this.fields.line_height.el]),this.$el.append(s),this.update_typography(undefined,!0)},update_styles_field:function(){this.fields.style.remove(),this.fields.style=this.get_styles_field(this.typefaces[this.current_element]),this.fields.style.render(),this.fields.style.delegateEvents(),e(".upfront-typography-fields-left").prepend(this.fields.style.el)},get_styles_field:function(e){var n=this;return new rn({label:t.weight_style,values:this.get_styles(),default_value:n.get_styles_field_default_value(),font_family:e,select_width:"120px",change:function(){var e=this.get_value(),t=n.current_element;n.styles[t]!=e&&(n.styles[t]=e,n.update_typography())},show:function(e){n.fields.style.set_option_font(e)}})},get_styles_field_default_value:function(){var e=this.get_styles(),t=this.typefaces[this.current_element],n=this.styles[this.current_element],r;return n?r=n:t?r=Sn.get_default_variant(t):r="regular",r==="regular"&&!_.findWhere(e,{value:"regular"})&&_.findWhere(e,{value:"400 normal"})?r="400 normal":r==="400 normal"&&!_.findWhere(e,{value:"400 normal"})&&_.findWhere(e,{value:"regular"})&&(r="regular"),r==="italic"&&!_.findWhere(e,{value:"italic"})&&_.findWhere(e,{value:"400 italic"})?r="400 italic":r==="400 italic"&&!_.findWhere(e,{value:"400 italic"})&&_.findWhere(e,{value:"italic"})&&(r="italic"),r},get_styles:function(){var e=this.typography,t=this.current_element,n=[],r;e==0&&(e={});if(_.isUndefined(e[t])||_.isUndefined(e[t].font_face))e[t]={font_face:"Arial"};return r=On.get_variants(e[t].font_face),n=[],_.each(r,function(e){n.push({label:e,value:e})}),n},update_typography:function(t,n){var r=this,i=[],s=[],o={};_.each(this.elements,function(t){var n=[],u,a=_.contains(r.inline_elements,t),f=r.typefaces[t],l=!1,c=!1,h=!1,p=!1,d=e(".upfront-object-content "+t),v,m,g;m=Sn.parse_variant(r.styles[t]||"regular"),h=m.weight,c=m.style,f===""&&(v=kn.get_fonts().models[0]),_.isUndefined(v)&&(v=kn.get_fonts().findWhere({family:f})),_.isUndefined(v)&&(v=On.get_additional_font(f));if(_.isUndefined(v)){var y=Nn.get_fonts();y&&y.findWhere&&(v=y.findWhere({family:f}));if(!v)return!0;u="//fonts.googleapis.com/css?family="+v.get("family").replace(/ /g,"+"),400!==parseInt(""+h,10)&&"inherit"!==h&&(u+=":"+h),e("head").append('<link href="'+u+'" rel="stylesheet" type="text/css" />')}l='"'+v.get("family")+'",'+v.get("category"),"inherit"!==l&&n.push("font-family: "+l),"inherit"!==h&&n.push("font-weight: "+h),"inherit"!==c&&n.push("font-style: "+c),a||(n.push("font-size: "+r.sizes[t]+"px"),n.push("line-height: "+r.line_heights[t]+"em")),!_.isEmpty(r.colors[t])&&Upfront.Views.Theme_Colors.colors.is_theme_color(r.colors[t])?g=Upfront.Views.Theme_Colors.colors.get_css_class(r.colors[t]):n.push("color: "+r.colors[t]),"blockquote"===t?p=".upfront-object-content blockquote, .upfront-object-content blockquote p":"a"===t?p=".upfront-object-content a, .upfront-object-content a:link, .upfront-object-content a:visited":"h1"===t||"h2"===t||"h3"===t||"h4"===t||"h5"===t||"h6"===t?p=".upfront-object-content "+t+", .upfront-object-content "+t+" a, .upfront-ui "+t+".tag-list-tag":p=".upfront-object-content "+t+", .upfront-ui "+t+".tag-list-tag",i.push(p+"{ "+n.join("; ")+"; }"),_.contains(["tablet","mobile"],r.model.get("id"))&&s.push(p.replace(/\.upfront-object-content/g,"."+r.model.get("id")+"-breakpoint .upfront-object-content")+" { "+n.join("; ")+"; }"),o[t]={weight:h,style:c,size:a?!1:r.sizes[t],line_height:a?!1:r.line_heights[t]||"1.1",font_face:v.get("family"),font_family:v.get("category"),color:r.colors[t],theme_color_class:g}}),this.update_typography_elements(),n||(this.model.set_property("typography",o),this.typography=o);if(_.contains(["tablet","mobile"],this.model.get("id"))){var u=this.model.get("id")+"-breakpoint-typography",a=s.join("\n");e("#"+u).length?e("#"+u).html(a):e("body").find("style").first().before('<style id="'+u+'">'+a+"</style>")}else e("head").find("#upfront-default-typography-inline").length?e("head").find("#upfront-default-typography-inline").html(i.join("\n")):e('<style id="upfront-default-typography-inline">'+i.join("\n")+"</style>").insertAfter(e("head").find('link[rel="stylesheet"]').first())},update_typography_elements:function(t){var n=this,r=[],i=!1;i=e("style#typography-colors"),i.length||(e("body").append('<style id="typography-colors" />'),i=e("style#typography-colors")),_.each(this.elements,function(e){n.colors[e]&&r.push(".upfront-object-content "+e+"{ color:"+Upfront.Util.colors.to_color_value(n.colors[e])+"; }")}),i.empty().append(r.join("\n"))}}),vt=ut.extend({initialize:function(){this.settings=_([new dt({model:this.model})]),this.edit_css=new W({model:this.model}),this.edit_background=new U({model:this.model}),this.edit_global_regions=new z({model:this.model}),Upfront.Application.get_current()==Upfront.Settings.Application.MODE.THEME&&(this.edit_structure=new R({model:this.model}))},get_title:function(){return t.typography},on_render:function(){this.$el.find(".panel-section-content").addClass("typography-section-content"),this.edit_css.render(),this.edit_css.delegateEvents(),this.$el.find(".panel-section-content").append(this.edit_css.el),Upfront.Application.get_current()==Upfront.Settings.Application.MODE.THEME&&(this.edit_structure.render(),this.edit_structure.delegateEvents(),this.$el.find(".panel-section-content").append(this.edit_structure.el)),this.edit_background.render(),this.edit_background.delegateEvents(),this.$el.find(".panel-section-content").append(this.edit_background.el),this.edit_global_regions.render(),this.edit_global_regions.delegateEvents(),this.$el.find(".panel-section-content").append(this.edit_global_regions.el)}}),mt=ut.extend({initialize:function(){this.settings=_([new dt({model:this.model})]),this.edit_css=new V({model:this.model})},get_title:function(){return t.typography_and_colors},on_render:function(){this.edit_css.render(),this.edit_css.delegateEvents(),this.$el.find(".panel-section-content").append(this.edit_css.el)}}),gt=Backbone.Model.extend({defaults:{color:"",prev:"",highlight:"",shade:"",selected:"",luminance:"",alpha:1},get_hover_color:function(){var e=this;return this.get("selected")!==""?this.get(e.get("selected")):this.get("color")==="#000000"&&this.get("alpha")==0?"inherit":this.get("color")}}),yt=Backbone.Collection.extend({model:gt,get_colors:function(){return this.pluck("color")?this.pluck("color"):[]},is_theme_color:function(e){return e=this.color_to_hex(e),_.indexOf(this.get_colors(),e)!==-1?_.indexOf(this.get_colors(),e)+1:!1},get_css_class:function(e,t){e=this.color_to_hex(e);var n=_.isUndefined(t)||t===!1?"upfront_theme_color_":"upfront_theme_bg_color_";if(this.is_theme_color(e)){var r=this.findWhere({color:e});if(r){var i=this.indexOf(r);return n+i}}return!1},get_all_classes:function(e){var t=_.isUndefined(e)||e===!1?"upfront_theme_color_":"upfront_theme_bg_color_",n=[];return _.each(this.get_colors(),function(e,r){n.push(t+r)}),n},remove_theme_color_classes:function(e,t){_.each(this.get_all_classes(t),function(t){e.removeClass(t)})},color_to_hex:function(e){if(typeof tinycolor=="function")return e=tinycolor(e),e.toHexString()==="#000000"&&e.alpha==0?"inherit":e.toHexString();if(e.substr(0,1)==="#")return e;e=e.replace(/\s+/g,"");var t=/(.*?)rgb\((\d+),(\d+),(\d+)\)/.exec(e);t=_.isEmpty(t)?/(.*?)rgba\((\d+),(\d+),(\d+),([0-9.]+)\)/.exec(e):t;var n=parseInt(t[2]),r=parseInt(t[3]),i=parseInt(t[4]),s=i|r<<8|n<<16;return t[1]+"#"+s.toString(16)}}),bt={colors:new yt(Upfront.mainData.themeColors.colors),range:Upfront.mainData.themeColors.range||0},wt=ot.extend({initialize:function(){var e=this;this.template=_.template(f.sidebar_settings_theme_colors),Upfront.Events.on("command:layout:save",this.on_save,this),Upfront.Events.on("command:layout:save_as",this.on_save,this),Upfront.Settings.Application.NO_SAVE&&Upfront.Events.on("preview:build:start",this.on_save,this),this.update_styles(),bt.colors.bind("change reset add",this.update_styles,this)},events:{"change .panel-setting-theme-colors-shades-range":"change_range","click .theme-colors-color-box":"select_variation"},on_save:function(){var e={action:"upfront_update_theme_colors",theme_colors:bt.colors.toJSON(),range:bt.range};Upfront.Util.post(e).error(function(){return tr.addMessage(t.theme_colors_save_fail)});var n={action:"upfront_save_theme_colors_styles",styles:this.styles};Upfront.Util.post(n).error(function(){return tr.addMessage(t.theme_color_style_save_fail)})},update_styles:function(){this.styles="";var t=this;bt.colors.each(function(e,n){var r=e.get("color")==="#000000"&&e.get("alpha")==0?"inherit":e.get("color");t.styles+=" .upfront_theme_color_"+n+"{ color: "+r+";}",t.styles+=" a .upfront_theme_color_"+n+":hover{ color: "+e.get_hover_color()+";}",t.styles+=" button .upfront_theme_color_"+n+":hover{ color: "+e.get_hover_color()+";}",t.styles+=" .upfront_theme_bg_color_"+n+"{ background-color: "+r+";}",t.styles+=" a .upfront_theme_bg_color_"+n+":hover{ background-color: "+e.get_hover_color()+";}",t.styles+=" button .upfront_theme_bg_color_"+n+":hover{ background-color: "+e.get_hover_color()+";}",Upfront.Util.colors.update_colors_in_dom(e.get("prev"),r,n)}),e("#upfront_theme_colors_dom_styles").remove(),e("<style id='upfront_theme_colors_dom_styles' type='text/css'>"+this.styles+"</style>").appendTo("body"),Upfront.Events.trigger("theme_colors:update")},on_render:function(){var e=this,t;this.theme_colors=bt,this.theme_color_range=bt.range,this.$el.html(this.template({colors:this.theme_colors.colors.toJSON(),range:bt.range})),this.add_previous_pickers(),t=this.theme_colors.colors.length;while(t<10)this.add_unset_color(t),t++;this.add_slider()},add_empty_picker:function(e){var t=this,n=new Yt({className:"upfront-field-wrap upfront-field-wrap-color sp-cf theme_color_swatch theme_color_swatch_empty",hide_label:!0,default_value:"#ffffff",blank_alpha:0,spectrum:{choose:function(r){if(!_.isObject(r))return!1;var i=n.get_value();i&&"undefined"!=typeof tinycolor&&(r=tinycolor(i)),t.add_new_color(r,e)},change:function(e){if(!_.isObject(e))return!1;n.update_input_val(e.toHexString())}}});n.render(),this.$(".theme_colors_empty_picker").html(n.$el).prepend('<span class="theme-colors-color-name">ufc'+e+"</span>")},add_unset_color:function(e){var t=this,n=new Yt({className:"upfront-field-wrap upfront-field-wrap-color sp-cf theme_color_swatch",hide_label:!0,default_value:"rgba(0, 0, 0, 0)",blank_alpha:0,spectrum:{choose:function(r){if(!_.isObject(r))return!1;var i=n.get_value();i&&"undefined"!=typeof tinycolor&&(r=tinycolor(i)),t.add_new_color(r,e)},change:function(e){if(!_.isObject(e))return!1;n.update_input_val(e.toHexString())}}});n.render(),n.$(".sp-preview").addClass("uf-unset-color"),this.$("#theme-colors-swatches").append(n.$el),n.$el.wrap('<span class="theme-colors-color-picker color-index">'.replace("index",e)),n.$el.closest(".theme-colors-color-picker").prepend('<span class="theme-colors-color-name">ufcindex</span>'.replace("index",e))},add_previous_pickers:function(){var t=this;this.$(".theme-colors-color-picker").each(function(n){var r=this,i=e(this),s=i.data("color"),o=t.theme_colors.colors.at(n),r=new Yt({className:"upfront-field-wrap upfront-field-wrap-color sp-cf theme_color_swatch",hide_label:!0,default_value:s,blank_alpha:0,spectrum:{change:function(e){t.update_colors(this,e,n)},move:function(e){r.$(".sp-preview").css({backgroundColor:e.toRgbString(),backgroundImage:"none"})},hide:function(e){r.$(".sp-preview").css({backgroundColor:e.toRgbString(),backgroundImage:"none"})}}});r.render(),r.$(".sp-preview").css({backgroundColor:s,backgroundImage:"none"}),o.get("color")==="#000000"&&o.get("alpha")==0?r.$(".sp-preview").addClass("uf-unset-color"):r.$(".sp-preview").removeClass("uf-unset-color"),i.html(r.$el),i.prepend('<span class="theme-colors-color-name">ufc'+n+"</span>")})},add_new_color:function(t,n){var r=parseInt(bt.range,10)/100||0;for(var i=this.theme_colors.colors.length;i<n;i++)this.theme_colors.colors.push({color:"#000000",prev:"#000000",highlight:"#000000",shade:"#000000",alpha:0});var s=this,o=this.theme_colors.colors.add({color:t.toHexString(),prev:t.toHexString(),highlight:s.color_luminance(t.toHex(),r),shade:s.color_luminance(t.toHex(),r*-1),alpha:t.alpha}),u=new Yt({className:"upfront-field-wrap upfront-field-wrap-color sp-cf theme_color_swatch theme-colors-color-picker",hide_label:!0,default_value:t.toRgbString(),blank_alpha:0,change:function(t){var n=parseInt(bt.range,10)/100||0;t=tinycolor(t),o.set({color:t.toHexString(),highlight:s.color_luminance(t.toHex(),n),shade:s.color_luminance(t.toHex(),n*-1),alpha:t.alpha}),e(this).parent().find(".sp-preview").css({backgroundColor:t.toRgbString(),backgroundImage:"none"}),this.default_value=t.toRgbString(),s.render_bottom()}}),a=bt.colors.length-1,f=e('<span class="theme-colors-color-picker color-'+a+'" data-index="'+a+'" data-color="'+t.toHexString()+'"><span class="theme-colors-color-name">ufc'+a+"</span></span>");u.render(),u.$(".sp-preview").css({backgroundColor:t.toRgbString(),backgroundImage:"none"}),t.toHexString()==="#000000"&&t.alpha==0?u.$(".sp-preview").addClass("uf-unset-color"):u.$(".sp-preview").removeClass("uf-unset-color"),f.append(u.$el),this.$("#theme-colors-no-color-notice").hide(),this.render_bottom(),this.on_save()},render_bottom:function(){return},color_luminance:function(e,t){e=String(e).replace(/[^0-9a-f]/gi,""),e.length<6&&(e=e[0]+e[0]+e[1]+e[1]+e[2]+e[2]),t=t||0;var n="#",r,i;for(i=0;i<3;i++)r=parseInt(e.substr(i*2,2),16),r=Math.round(Math.min(Math.max(0,r+r*t),255)).toString(16),n+=("00"+r).substr(r.length);return n},change_range:function(e){var t=this;bt.range=e,percentage=parseInt(e,10)/100||0,bt.colors.each(function(e){var n=e.get("color");e.set("highlight",t.color_luminance(n,percentage)),e.set("shade",t.color_luminance(n,percentage*-1))}),this.render_bottom()},select_variation:function(t){var n=this,r=e(t.target),i=r.data("type"),s=r.data("index"),o=r.data("color"),u=bt.colors.at(s);u.get("selected")?(u.set("selected",""),u.set("luminance",n.luminance(o))):(u.set("selected",i),u.set("luminance",n.luminance(o))),this.render_bottom()},luminance:function(e){e=e.substring(1);var t=parseInt(e,16),n=t>>16&255,r=t>>8&255,i=t>>0&255,s=.2126*n+.7152*r+.0722*i;return s<80?"dark":"light"},add_slider:function(){var e=this;this.$(".panel-setting-theme-colors-shades-range").slider({value:bt.range,min:0,max:50,change:function(t,n){e.change_range(n.value)}})},update_colors:function(t,n,r){var i=bt.colors.at(r),s=parseInt(bt.range,10)/100||0;i&&(i.set({color:n.toHexString(),prev:i.get("color"),highlight:this.color_luminance(n.toHex(),s),shade:this.color_luminance(n.toHex(),s*-1),alpha:n.alpha}),e(t).parent().find(".sp-preview").css({backgroundColor:n.toRgbString(),backgroundImage:"none"}),n.toHexString()==="#000000"&&n.alpha==0?e(t).parent().find(".sp-preview").addClass("uf-unset-color"):e(t).parent().find(".sp-preview").removeClass("uf-unset-color"),t.default_value=n.toRgbString(),this.render_bottom())}}),Et=ut.extend({initialize:function(){this.settings=_([]),this.edit_colors=new wt({model:this.model})},get_title:function(){return t.colors_section},on_render:function(){this.edit_colors.render(),this.edit_colors.delegateEvents(),this.$el.find(".panel-section-content").append(this.edit_colors.el),this.$el.addClass("colors-panel-section")}}),St=st.extend({className:"sidebar-panel sidebar-panel-settings",initialize:function(){this.active=!0,this.sections=_([new vt({model:this.model}),new Et({model:this.model})])},get_title:function(){return t.theme_settings},on_render:function(){Upfront.Application.get_current()==Upfront.Settings.Application.MODE.THEME&&this.$el.find(".sidebar-panel-title").trigger("click")}}),xt=Backbone.View.extend({tagName:"ul",className:"sidebar-panels",initialize:function(){this.panels={posts:new pt({model:this.model}),elements:new ft({model:this.model}),settings:new St({model:this.model})}},render:function(){var e=this;_.each(this.panels,function(t){t.render(),e.$el.append(t.el),t.delegateEvents()})}}),Tt=it.extend({className:"sidebar-commands sidebar-commands-primary clearfix",initialize:function(){this.commands=_([]),Upfront.Settings.Application.MODE.ALLOW.match(Upfront.Settings.Application.MODE.CONTENT)&&(this.commands.push(new g({model:this.model})),this.commands.push(new y({model:this.model}))),this.commands.push(new Ht({model:this.model})),this.commands.push(new Bt)}}),Nt=it.extend({className:"sidebar-commands sidebar-commands-primary clearfix",initialize:function(){this.commands=_([new F({model:this.model})]),Upfront.themeExporter.currentTheme!=="upfront"&&(this.commands.push(new I({model:this.model})),this.commands.push(new q({model:this.model})))}}),Ct=it.extend({className:"sidebar-commands sidebar-commands-additional",initialize:function(){this.commands=_([])},render:function(){}}),kt=it.extend({className:function(){var e="sidebar-commands sidebar-commands-control";return Upfront.Application.get_current()===Upfront.Settings.Application.MODE.THEME&&(e+=" sidebar-commands-theme"),e},initialize:function(){var e=Upfront.Settings.Application.MODE,t=Upfront.Application.get_current();t!==e.THEME?this.commands=_([new C({model:this.model}),new k({model:this.model}),new D({model:this.model})]):this.commands=_([new D({model:this.model})]),e.ALLOW.match(e.RESPONSIVE)&&t===e.THEME&&this.commands.push(new Q({model:this.model})),t==e.THEME&&this.commands.push(new K({model:this.model})),!Upfront.Settings.Application.NO_SAVE&&t!==e.THEME?this.commands.push(new b({model:this.model})):t!==e.THEME&&Upfront.Settings.Application.PERMS.REVISIONS&&this.commands.push(new x({model:this.model})),e.ALLOW.match(e.RESPONSIVE)&&t!==e.THEME&&this.commands.push(new G({model:this.model})),Upfront.Settings.Debug.dev&&(!Upfront.Settings.Application.NO_SAVE&&t!==e.THEME&&this.commands.push(new P({model:this.model})),!Upfront.Settings.Application.DEBUG&&t!==e.THEME&&!Upfront.Settings.Application.NO_SAVE&&this.commands.push(new N({model:this.model})))}}),Lt=it.extend({className:"sidebar-commands sidebar-commands-header",initialize:function(){this.commands=_([new v({model:this.model})]),this.commands.push(new m({model:this.model}))}}),At=Backbone.View.extend({tagName:"li",className:"sidebar-panel sidebar-panel-settings expanded",template:'<div class="sidebar-panel-content"></div>',initialize:function(){this.collection=yr.get_breakpoints(),this.listenTo(this.collection,"change:active",this.render)},render:function(){var e=yr.get_breakpoints().get_active();e.get("default")&&(this.model.attributes.id="default");var t=new mt({model:e.get("default")?this.model:e});t.render(),this.$el.html(this.template),this.$el.find(".sidebar-panel-content").html(t.el)}}),Ot=Backbone.View.extend({tagName:"ul",className:"sidebar-commands sidebar-commands-responsive",initialize:function(){this.views=[new Z,new et],this.views.push(new At({model:this.model}))},render:function(){return _.each(this.views,function(e){e.render(),this.$el.append(e.el)},this),this},destroy:function(){this.remove(),_.each(this.views,function(e){e.remove()})}}),Mt=it.extend({className:"sidebar-commands sidebar-commands-responsive-control sidebar-commands-control",initialize:function(){this.commands=_([new tt({model:this.model}),new nt({model:this.model}),new D({model:this.model}),new b,new Y])},render:function(){this.$el.find("li").remove(),this.commands.each(this.add_command,this)}}),_t=Backbone.View.extend({className:"sidebar-profile",render:function(){var e=Upfront.data.currentUser;e||(e=new Backbone.Model);var n=e.get("data")||{},r=e.get("roles")||[],i;i='<div class="sidebar-profile-avatar"><img src="//www.gravatar.com/avatar/{{ gravatar ? gravatar : "gravatar" }}?s=25" /></div><div class="sidebar-profile-detail"><span class="sidebar-profile-name">{{name}}</span><span class="sidebar-profile-role">{{role}}</span></div>'+(r.length?'<div class="sidebar-profile-edit"><a class="upfront-icon upfront-icon-edit" data-bypass="true" title="'+t.edit_profile+'" href="{{edit_url}}">'+t.edit_profile+"</a></div>":""),this.$el.html(_.template(i,{gravatar:n.gravatar,name:n.display_name||t.anonymous,role:r[0]||t.none,edit_url:Upfront.Settings.admin_url+"profile.php"}))}}),Dt=Backbone.View.extend({tagName:"div",visible:1,events:{"click #sidebar-ui-toggler-handle":"toggleSidebar"},initialize:function(){var e=Upfront.Application.get_current()==Upfront.Settings.Application.MODE.THEME;this.sidebar_profile=new _t({model:this.model}),this.sidebar_commands={header:new Lt({model:this.model}),primary:e?new Nt({model:this.model}):new Tt({model:this.model}),additional:e?!1:new Ct({model:this.model}),control:new kt({model:this.model}),responsive:new Ot({model:this.model})},this.sidebar_panels=new xt({model:this.model}),this.fetch_current_user(),Upfront.Application.get_current()!=Upfront.Settings.Application.MODE.CONTENT&&(Upfront.Events.on("upfront:element:edit:start",this.preventUsage,this),Upfront.Events.on("upfront:element:edit:stop",this.allowUsage,this)),Upfront.Events.on("application:mode:after_switch",this.render,this),Upfront.Events.on("application:user:fetch",this.render,this)},preventUsage:function(n){var r=t.not_available_in_text_edit;n==="media-upload"&&(r=t.not_available_in_media_upload),n==="write"&&(this.writingIsOn=!0,r=t.publish_first_nag),this.prevented_usage_type||(this.prevented_usage_type=n),e("#preventUsageOverlay span").html(r),e("#preventUsageOverlay").show()},allowUsage:function(t){if(this.writingIsOn&&t!=="write"){this.preventUsage("write");return}this.prevented_usage_type=!1,this.writingIsOn=!1,e("#preventUsageOverlay").hide()},render:function(){var t=Upfront.Application.get_current(),n=t===Upfront.Settings.Application.MODE.RESPONSIVE,r=e('<div id="sidebar-ui-wrapper" class="upfront-ui"></div>');t==Upfront.Settings.Application.MODE.THEME&&r.addClass("create-theme-sidebar"),this.sidebar_commands.header.render(),r.append(this.sidebar_commands.header.el),t!==Upfront.Settings.Application.MODE.THEME&&!n&&(this.sidebar_profile.render(),r.append(this.sidebar_profile.el)),n||(this.sidebar_commands.primary.render(),r.append(this.sidebar_commands.primary.el)),this.sidebar_commands.additional&&!n&&(this.sidebar_commands.additional.render(),r.append(this.sidebar_commands.additional.el)),n&&(this.sidebar_commands.responsive.render(),r.append(this.sidebar_commands.responsive.el));if(t!==Upfront.Settings.Application.MODE.CONTENT&&!n)this.sidebar_panels.render(),r.append(this.sidebar_panels.el),this.sidebar_commands.control.render(),r.append(this.sidebar_commands.control.el),r.append('<div id="preventUsageOverlay"><span></span></div>');else if(n){var i=new Mt({model:this.model});i.render(),r.append(i.el)}this.$el.html(r),Upfront.Events.trigger("sidebar:rendered")},get_panel:function(e){return this.sidebar_panels.panels[e]?this.sidebar_panels.panels[e]:!1},get_commands:function(e){return this.sidebar_commands[e]?this.sidebar_commands[e]:!1},to_content_editor:function(){},from_content_editor:function(){},fetch_current_user:function(){var e=Upfront.data.currentUser;e||(e=new Upfront.Models.User,Upfront.data.loading.currentUser=e.fetch().done(function(){Upfront.data.currentUser=e,Upfront.Events.trigger("application:user:fetch")}))},addCollapsibleEvents:function(){var t=this;this.$el.append('<div id="sidebar-ui-toggler"><div id="sidebar-ui-toggler-handle" class="sidebar-ui-hide"></div></div>'),e("body").on("mousemove",function(n){t.visible*300+100>n.pageX?t.collapsibleHint||(e("#sidebar-ui-toggler").fadeIn(),t.collapsibleHint=!0):t.collapsibleHint&&(e("#sidebar-ui-toggler").fadeOut(),t.collapsibleHint=!1)}),this.resizeCollapseHandle(),e(window).on("resize",function(){t.resizeCollapseHandle()})},resizeCollapseHandle:function(){var t=e(window).height();this.$("#sidebar-ui-toggler").height(t)},toggleSidebar:function(t){var n=this,r={marginLeft:"260px"};unmargined_css={marginLeft:"0px"},_margin=Upfront.Util.isRTL()?"marginRight":"marginLeft",this.visible?(e("#sidebar-ui, #element-settings-sidebar").stop().animate({width:"0px"},300,function(){e("#sidebar-ui, #element-settings-sidebar").addClass("collapsed")}),Upfront.Util.isRTL()&&(unmargined_css={marginRight:"0px"}),e("#page").stop().animate(unmargined_css,300,function(){Upfront.Events.trigger("sidebar:toggle:done",n.visible)}),this.$("#sidebar-ui-toggler-handle").removeClass().addClass("sidebar-ui-show"),this.visible=0):(Upfront.Util.isRTL()&&(r={marginRight:"260px"}),e("#sidebar-ui").removeClass("collapsed").stop().animate({width:"260px"},300),e("#element-settings-sidebar").removeClass("collapsed"),e("#element-settings-sidebar").contents().length!==0&&e("#element-settings-sidebar").removeClass("collapsed").stop().animate({width:"260px"},300),e("#page").stop().animate(r,300,function(){Upfront.Events.trigger("sidebar:toggle:done",n.visible)}),this.$("#sidebar-ui-toggler-handle").removeClass().addClass("sidebar-ui-hide"),this.visible=1),Upfront.Events.trigger("sidebar:toggle",this.visible)}}),Pt=d.extend({tagName:"div",className:"upfront-sidebar-content_editor-sidebar_command",post:!1,initialize:function(){this.setPost(),Upfront.Events.on("data:current_post:change",this.setPost,this)},setPost:function(){var e=Upfront.data.currentPost;if(!e)this.post=new Upfront.Models.Post({post_type:"post",id:"0"});else if(!this.post||this.post.id!=e.id)this.post=Upfront.data.currentPost,this.onPostChange&&this.onPostChange();return this}}),Ht=Pt.extend({tagName:"li",className:"command-popup-list",$popup:{},views:{},currentPanel:!1,render:function(){this.$el.addClass("upfront-entity_list upfront-icon upfront-icon-browse"),Upfront.Application.get_current()==Upfront.Settings.Application.MODE.LAYOUT?this.$el.html('<a title="'+t.posts_pages_comments+'">'+t.posts_pages_comments+"</a>"):this.$el.html('<a title="'+t.posts_pages+'">'+t.posts_pages+"</a>")},on_click:function(){var n=this,r=Upfront.Popup.open(function(r,i,s){var o=e(this);o.empty().append('<p class="upfront-popup-placeholder">'+t.popup_preloader+"</p>"),n.$popup={top:i,content:o,bottom:s}}),i=!1,s=Upfront.data.currentPost&&Upfront.data.currentPost.id?Upfront.data.currentPost.id:_upfront_post_data.post_id;i=!!s,s&&Upfront.data.posts&&Upfront.data.posts.length&&(i=Upfront.data.posts[s]&&Upfront.data.posts[s].get?!!parseInt(Upfront.data.posts[s].get("comment_count"),10):!1),n.$popup.top.html('<ul class="upfront-tabs"><li data-type="posts" class="active">'+t.posts+"</li>"+'<li data-type="pages">'+t.pages+"</li>"+(i?'<li data-type="comments">'+t.comments+"</li>":"")+"</ul>"+n.$popup.top.html()).find(".upfront-tabs li").on("click",function(){n.dispatch_panel_creation(this)}),n.dispatch_panel_creation(),r.done(function(){Upfront.Events.off("upfront:posts:sort"),Upfront.Events.off("upfront:posts:post:expand"),Upfront.Events.off("upfront:pages:sort"),Upfront.Events.off("upfront:comments:sort")})},dispatch_panel_creation:function(t){var n=this,r=t?e(t):n.$popup.top.find(".upfront-tabs li.active"),i=r.attr("data-type"),s=i.charAt(0).toUpperCase()+i.slice(1).toLowerCase(),o=t||{},u=!1,a=this.post.id,f={};n.$popup.top.find(".upfront-tabs li").removeClass("active"),r.addClass("active"),this.currentPanel=i;if(n.views[i]&&i!="pages"&&i!="posts")if(i!="comments"||Upfront.data.currentPost&&Upfront.data.currentPost.id&&n.views[i].view.collection.postId==Upfront.data.currentPost.id)return this.render_panel(n.views[i]);if(i=="posts")u=new Upfront.Collections.PostList([],{postType:"post"}),u.orderby="post_date",f={filterContent:!0,withAuthor:!0,limit:15};else if(i=="pages")u=new Upfront.Collections.PostList([],{postType:"page"}),u.orderby="post_date",f={limit:15};else{var l=Upfront.data.currentPost&&Upfront.data.currentPost.id?Upfront.data.currentPost.id:_upfront_post_data.post_id;u=new Upfront.Collections.CommentList([],{postId:l}),u.orderby="comment_date"}return u.fetch(f).done(function(e){switch(i){case"posts":var t=null;typeof n.views[i]!="undefined"&&(t=n.views[i].view.collection.pagination.totalElements);var r=u.pagination.totalElements;if(t==r)return n.render_panel(n.views[i]);u.on("reset sort",n.render_panel,n),views={view:new It({collection:u,$popup:n.$popup}),search:new jt({collection:u}),pagination:new Ft({collection:u})},n.views.posts=views;break;case"pages":var t=null;typeof n.views[i]!="undefined"&&(t=n.views[i].view.collection.pagination.totalElements);var r=u.pagination.totalElements;if(t==r)return n.render_panel(n.views[i]);u.on("reset sort",n.render_panel,n),views={view:new qt({collection:u,$popup:n.$popup}),search:new jt({collection:u}),pagination:new Ft({collection:u})},n.views.pages=views;break;case"comments":u.on("reset sort",n.render_panel,n),views={view:new Rt({collection:u,$popup:n.$popup}),search:new jt({collection:u}),pagination:new Ft({collection:u})},n.views.comments=views}n.render_panel()}),!1},render_panel:function(){var e=this,t=this.views[this.currentPanel];t.view.render(),e.$popup.content.html(t.view.$el),t.view.setElement(t.view.$el),e.$popup.bottom.empty(),t.pagination&&(t.pagination.render(),e.$popup.bottom.html(t.pagination.$el),t.pagination.setElement(t.pagination.$el)),t.search.render(),e.$popup.bottom.append(t.search.$el),t.search.setElement(t.search.$el)}}),Bt=d.extend({tagName:"li",className:"command-open-media-gallery upfront-icon upfront-icon-open-gallery",render:function(){this.$el.html('<a title="'+t.media+'">'+t.media+"</a>")},on_click:function(){Upfront.Media.Manager.open({media_type:["images","videos","audios","other"]})}}),jt=Backbone.View.extend({id:"upfront-entity_list-search",searchTpl:_.template(e(f.popup).find("#upfront-search-tpl").html()),events:{"click #upfront-search_action":"dispatch_search_click","keydown #upfront-list-search_input":"dispatch_search_enter"},render:function(){var e=this.collection.lastFetchOptions?this.collection.lastFetchOptions.search:!1;this.$el.html(this.searchTpl({query:e}))},dispatch_search_click:function(t){return e("#upfront-search_container").is(":visible")?this.handle_search_request(t):this.handle_search_reveal(t)},dispatch_search_enter:function(e){if(e.which==13)return this.handle_search_request(e)},handle_search_request:function(t){t.preventDefault();var n=e("#upfront-search_container input").val();this.collection.fetch({search:n})},handle_search_reveal:function(){e("#upfront-search_container").show()}}),Ft=Backbone.View.extend({paginationTpl:_.template(e(f.popup).find("#upfront-pagination-tpl").html()),events:{"click .upfront-pagination_page-item":"handle_pagination_request","click .upfront-pagination_item-next":"handle_next","click .upfront-pagination_item-prev":"handle_prev","click .upfront-pagination_page-item":"set_page","keypress .upfront-pagination_page-current":"set_page_keypress"},initialize:function(e){this.options=e},render:function(){this.$el.html(this.paginationTpl(this.collection.pagination))},handle_pagination_request:function(t,n){var r=this,i=this.collection.pagination,n=n?n:parseInt(e(t.target).attr("data-page_idx"),10)||0;this.collection.fetchPage(n).done(function(e){r.collection.trigger("reset")})},handle_next:function(e){var t=this.collection.pagination,n=t.currentPage==t.pages-1?!1:t.currentPage+1;n&&this.handle_pagination_request(e,n)},handle_prev:function(e){var t=this.collection.pagination,n=t.currentPage==0?!1:t.currentPage-1;n!==!1&&this.handle_pagination_request(e,n)},set_page:function(e){e.preventDefault(),e.stopPropagation();var t=this.collection.pagination.pages-1;this.handle_pagination_request(e,t)},set_page_keypress:function(t){t.stopPropagation();if(13!==t.which)return!0;var n=e.trim(e(t.target).val()),r=parseInt(n,10);if(!r||r<1)return!1;r>this.collection.pagination.pages&&(r=this.collection.pagination.pages),this.handle_pagination_request(t,r-1)}}),It=Backbone.View.extend({className:"upfront-entity_list-posts bordered-bottom",postListTpl:_.template(e(f.popup).find("#upfront-post-list-tpl").html()),postSingleTpl:_.template(e(f.popup).find("#upfront-post-single-tpl").html()),paginationTpl:_.template(e(f.popup).find("#upfront-pagination-tpl").html()),events:{"click #upfront-list-meta .upfront-list_item-component":"handle_sort_request","click .editaction.edit":"handle_post_edit","click .editaction.view":"handle_post_view","click #upfront-list-page-path a.upfront-path-back":"handle_return_to_posts","click .editaction.trash":"trash_post"},initialize:function(e){this.collection.on("change reset",this.render,this)},render:function(){this.$el.empty().append(this.postListTpl({posts:this.collection.getPage(this.collection.pagination.currentPage),orderby:this.collection.orderby,order:this.collection.order}))},handle_sort_request:function(t){var n=e(t.target).closest(".upfront-list_item-component"),r=n.attr("data-sortby"),i=this.collection.order;r&&(r==this.collection.orderby&&(i=i=="desc"?"asc":"desc"),this.collection.reSort(r,i))},handle_post_edit:function(t){t.preventDefault();var n=e(t.currentTarget).closest(".upfront-list_item-post").attr("data-post_id");Upfront.Application.navigate("/edit/post/"+n,{trigger:!0})},handle_post_view:function(t){t.preventDefault();var n=e(t.currentTarget).closest(".upfront-list_item-post").attr("data-post_id");window.location.href=this.collection.get(n).get("permalink")},trash_post:function(t){var n=this,r=e(t.currentTarget).closest(".upfront-list_item-post.upfront-list_item"),i=r.attr("data-post_id");confirm(Upfront.Settings.l10n.global.content.delete_confirm.replace(/%s/,this.collection.get(i).get("post_type")))&&this.collection.get(i).set("post_status","trash").save().done(function(){n.collection.remove(n.collection.get(i))})},expand_post:function(n){var r=this;n.featuredImage||this.collection.post({action:"get_post_extra",postId:n.id,thumbnail:!0,thumbnailSize:"medium"}).done(function(e){e.data.thumbnail&&e.data.postId==n.id?(r.$("#upfront-page_preview-featured_image img").attr("src",e.data.thumbnail[0]).show(),r.$(".upfront-thumbnailinfo").hide(),n.featuredImage=e.data.thumbnail[0]):(r.$(".upfront-thumbnailinfo").text(t.no_image),r.$(".upfront-page_preview-edit_feature a").html('<i class="icon-plus"></i> '+t.add))}),e("#upfront-list-page").show("slide",{direction:"right"},"fast"),this.$el.find("#upfront-list").hide(),e("#upfront-page_preview-edit button").one("click",function(){var e="/edit/post/"+n.id;window.location.search.indexOf("dev=true")>-1&&(e+="?dev=true"),Upfront.Popup.close(),Upfront.Application.navigate(e,{trigger:!0})}),this.bottomContent=e("#upfront-popup-bottom").html(),e("#upfront-popup-bottom").html(e('<a href="#" id="upfront-back_to_posts">'+t.back_to_posts+"</a>").on("click",function(e){r.handle_return_to_posts()}))},handle_return_to_posts:function(){var t=this;this.$el.find("#upfront-list").show("slide",{direction:"left"},function(){t.collection.trigger("reset")}),e("#upfront-list-page").hide()}}),qt=Backbone.View.extend({events:{"click #upfront-list-meta .upfront-list_item-component":"handle_sort_request","click .upfront-list-page_item":"handle_page_activate","click .upfront-page-path-item":"handle_page_activate","change #upfront-page_template-select":"template_change","click .editaction.trash":"trash_page","click .editaction.edit":"handle_post_edit","click .editaction.view":"handle_post_view"},currentPage:!1,pageListTpl:_.template(e(f.popup).find("#upfront-page-list-tpl").html()),pageListItemTpl:_.template(e(f.popup).find("#upfront-page-list-item-tpl").html()),pagePreviewTpl:_.template(e(f.popup).find("#upfront-page-preview-tpl").html()),allTemplates:[],render:function(){var e=this.collection.getPage(this.collection.pagination.currentPage);this.$el.html(this.pageListTpl({pages:e,pageItemTemplate:this.pageListItemTpl,orderby:this.collection.orderby,order:this.collection.order}))},renderPreview:function(e){var t=this.$el.find("#upfront-list-page-preview");t.html(this.pagePreviewTpl({page:e,template:e.template?e.template:"Default",allTemplates:this.allTemplates?this.allTemplates:[]})),this.$el.find("#upfront-page_preview-edit button").one("click",function(){var t="/edit/page/"+e.get("ID");window.location.search.indexOf("dev=true")>-1&&(t+="?dev=true"),Upfront.Popup.close(),Upfront.Application.navigate(t,{trigger:!0})})},handle_sort_request:function(t){var n=e(t.target).closest(".upfront-list_item-component"),r=n.attr("data-sortby"),i=this.collection.order;r&&(r==this.collection.orderby&&(i=i=="desc"?"asc":"desc"),this.collection.reSort(r,i))},handle_post_edit:function(t){t.preventDefault();var n=e(t.currentTarget).closest(".upfront-list_item-post").attr("data-post_id");Upfront.Application.navigate("/edit/page/"+n,{trigger:!0})},handle_post_view:function(t){t.preventDefault();var n=e(t.currentTarget).closest(".upfront-list_item-post").attr("data-post_id");window.location.href=this.collection.get(n).get("permalink")},handle_page_activate:function(t){var n=this.collection.get(e(t.target).attr("data-post_id"));t.preventDefault(),t.stopPropagation(),this.$(".upfront-list-page_item").removeClass("active"),this.$("#upfront-list-page_item-"+n.id).addClass("active").toggleClass("closed"),this.update_path(n),this.update_page_preview(n),this.currentPage=n},trash_page:function(t){var n=this,r=e(t.currentTarget).closest(".upfront-list_item-post.upfront-list_item"),i=r.attr("data-post_id");confirm(Upfront.Settings.l10n.global.content.delete_confirm.replace(/%s/,this.collection.get(i).get("post_type")))&&this.collection.get(i).set("post_status","trash").save().done(function(){n.collection.remove(n.collection.get(i)),r.remove()})},update_path:function(e){var t=e,n=[{id:e.get("ID"),title:e.get("post_title")}],r=this.$el.find("#upfront-list-page-path"),i="";while(t.get("post_parent"))t=this.collection.get(t.get("post_parent")),n.unshift({id:t.get("ID"),title:t.get("post_title")});_.each(n,function(t){i&&(i+="&nbsp;Â»&nbsp;"),t.id==e.id?i+='<span class="upfront-page-path-current last">'+t.title+"</span>":i+='<a href="#" class="upfront-page-path-item" data-post_id="'+t.id+'">'+t.title+"</a>"}),r.html(i)},update_page_preview:function(e){var n=this,r=!e.thumbnail||!n.allTemplates||!e.template,i=r?{thumbnail:!e.thumbnail,thumbnailSize:"medium",allTemplates:!n.allTemplates,template:!e.template,action:"get_post_extra",postId:e.get("ID")}:{};r&&this.collection.post(i).done(function(r){r.data.thumbnail&&r.data.postId==e.get("ID")?(n.$("#upfront-page_preview-featured_image img").attr("src",r.data.thumbnail[0]).show(),n.$(".upfront-thumbnailinfo").hide(),e.thumbnail=r.data.thumbnail[0]):(n.$(".upfront-thumbnailinfo").text(t.no_image),n.$(".upfront-page_preview-edit_feature a").html('<i class="icon-plus"></i> '+t.add)),r.data.allTemplates&&(n.allTemplates=r.data.allTemplates),r.data.template&&(e.template=r.data.template,n.renderPreview(e))}),this.renderPreview(e)},template_change:function(t){var n=this,r=e(t.target),i=r.val();this.currentPage.post({action:"update_page_template",postId:this.currentPage.get("ID"),template:i}).done(function(e){n.currentPage.get("ID")==e.data.postId&&(n.currentPage.template=e.data.template)})}}),Rt=Backbone.View.extend({events:{"click #upfront-list-meta .upfront-list_item-component":"handle_sort_request","mouseenter .upfront-list_item-comment":"start_reveal_counter","mouseleave .upfront-list_item-comment":"stop_reveal_counter","click .upfront-list_item-comment":"toggle_full_post","click .upfront-comments-approve":"handle_approval_request","click .upfront-comment_actions-wrapper a":"handle_action_bar_request","click .comment-edit-ok":"edit_comment","click .comment-reply-ok":"reply_to_comment","click .comment-reply-cancel":"cancel_edit","click .comment-reply-cancel":"cancel_edit","click .comment-edit-box":"stop_propagation"},excerptLength:60,commentsTpl:_.template(e(f.popup).find("#upfront-comments-tpl").html()),commentTpl:_.template(e(f.popup).find("#upfront-comment-single-tpl").html()),initialize:function(e){this.collection.on("change",this.renderComment,this),this.collection.on("add",this.addComment,this)},render:function(){var e=this.collection.postId==0?[]:this.collection.getPage(this.collection.pagination.currentPage);this.$el.html(this.commentsTpl({comments:e,excerptLength:45,commentTpl:this.commentTpl,orderby:this.collection.orderby,order:this.collection.order}))},renderComment:function(e){this.$("#upfront-list_item-comment-"+e.get("comment_ID")).html(this.commentTpl({comment:e,excerptLength:60}))},addComment:function(t){var n=t.get("comment_parent"),r=t.get("comment_ID"),i=e('<div class="upfront-list_item-comment upfront-list_item clearfix expanded" id="upfront-list_item-comment-'+r+'" data-comment_id="'+r+'">'+this.commentTpl({comment:t,excerptLength:this.excerptLength})+"</div>").hide();this.$("div.upfront-list_item-comment").removeClass("expanded"),this._currently_working=!1,n?this.$("#upfront-list_item-comment-"+n).after(i):this.$("div.upfront-list-comment-items").append(i),i.slideDown()},handle_sort_request:function(t){var n=e(t.target).closest(".upfront-list_item-component"),r=n.attr("data-sortby"),i=this.collection.order;r&&(r==this.collection.orderby&&(i=i=="desc"?"asc":"desc"),this.collection.reSort(r,i))},start_reveal_counter:function(t){var n=this;if(e(t.target).is(".upfront-comment-approved")||e(t.target).parents(".upfront-comment-approved").length)return!1;if(this._currently_working)return!1;clearTimeout(n._reveal_counter),n._reveal_counter=setTimeout(function(){n.reveal_comment(t)},500)},reveal_comment:function(t){this.$(".upfront-list-comments .upfront-list_item").removeClass("expanded"),e(t.currentTarget).addClass("expanded"),clearTimeout(this._reveal_counter)},revert_comment:function(t){e(t.currentTarget).removeClass("expanded"),clearTimeout(this._reveal_counter)},toggle_full_post:function(t){e(t.currentTarget).toggleClass("expanded")},stop_reveal_counter:function(e){if(this._currently_working)return!1;this.revert_comment(e)},handle_approval_request:function(t,n){var n=n?n:this.collection.get(e(t.target).attr("data-comment_id"));this.$("#upfront-list_item-comment-"+n.id+" i.upfront-comments-approve").animate({"font-size":"1px",opacity:0},400,"swing",function(){n.approve(!0).save()})},handle_action_bar_request:function(t){var n=this,r=e(t.currentTarget),i=this.collection.get(r.parents(".upfront-list_item-comment").attr("data-comment_id"));return r.is(".edit")?this._edit_comment(i):r.is(".reply")?this._reply_to_comment(i):r.is(".approve")?this.handle_approval_request(!1,i):r.is(".unapprove")?i.approve(!1).save():r.is(".thrash")?i.trash(!0).save():r.is(".unthrash")?i.trash(!1).save():r.is(".spam")?i.spam(!0).save():r.is(".unspam")&&i.spam(!1).save(),!1},edit_comment:function(t){var n=e(t.target).parent(),r=this.collection.get(n.attr("data-comment_id"));r.set("comment_content",n.find("textarea").attr("disabled",!0).val()).save()},reply_to_comment:function(t){var n=this,r=e(t.target).parent(),i=this.collection.get(r.attr("data-comment_id")),s=this.$("#upfront-list_item-comment-"+i.get("comment_ID")),o=r.find("textarea").val(),u=Upfront.data.currentUser;if(o){var a=new Upfront.Models.Comment({comment_author:u.get("data").display_name,comment_post_ID:this.collection.postId,comment_parent:i.get("comment_ID"),comment_content:o,comment_approved:"1",user_id:u.get("ID")}),f=(new Date).getTime();s.find("textarea").attr("disabled",!0),a.save().done(function(e){n.renderComment(i),a.set("comment_ID",e.data.comment_ID),n.collection.add(a),n.$("#upfront-list_item-comment-"+e.data.comment_ID).hide().slideDown()})}},cancel_edit:function(t){var n=e(t.target).parent(),r=this.collection.get(n.attr("data-comment_id"));this.renderComment(r)},stop_propagation:function(e){e.stopPropagation()},_edit_comment:function(e){var t=this.$("#upfront-list_item-comment-"+e.get("comment_ID"));t.find(".upfront-comment_togglable").hide(),t.find(".upfront-comment_edit").show(),this._currently_working=!0},_reply_to_comment:function(e){var t=this.$("#upfront-list_item-comment-"+e.get("comment_ID"));t.find(".upfront-comment_togglable").show(),t.find(".upfront-comment_edit").hide(),this._currently_working=!0}}),Ut={get_icon_html:function(e,t){if(!e)return"";if(e.match(/^https?:\/\//)){var n={src:e,alt:"","class":"upfront-field-icon-img"};return"<img "+this.get_field_attr_html(n)+" />"}var r=["upfront-field-icon"];return t?(r.push(t),r.push(t+"-"+e)):r.push("upfront-field-icon-"+e),'<i class="'+r.join(" ")+'"></i>'}},zt=Backbone.View.extend({className:"upfront-field-wrap",initialize:function(e){this.options=e,this.multiple=typeof this.options.multiple!="undefined"?this.options.multiple:typeof this.multiple!="undefined"?this.multiple:!1,this.label=typeof this.options.label!="undefined"?this.options.label:"",this.default_value=typeof this.options.default_value!="undefined"?this.options.default_value:this.multiple?[]:"",this.options.property?(this.property=this.model.get_property_by_name(this.options.property),this.property===!1&&(this.model.init_property(this.options.property,this.default_value),this.property=this.model.get_property_by_name(this.options.property)),this.property_name=this.options.property,typeof this.options.use_breakpoint_property!="undefined"&&(this.use_breakpoint_property=this.options.use_breakpoint_property)):this.property=!1,this.name=this.options.name?this.options.name:this.cid,this.selected_state=this.selected_state?this.selected_state:"",this.options.init&&this.options.init(),this.init&&this.init(),this.options.change&&this.on("changed",this.options.change,this),this.options.show&&this.on("changed rendered",this.dispatch_show,this),this.options.focus&&this.on("focus",this.options.focus,this),this.options.blur&&this.on("blur",this.options.blur,this),this.options.rendered&&this.on("rendered",this.options.rendered,this),this.options.on_click&&(this.on_click=this.options.on_click),this.once("rendered",function(){var e=this;this.get_field().on("focus",function(){e.trigger("focus")}).on("blur",function(){e.trigger("blur")})},this)},dispatch_show:function(){var e=this;setTimeout(function(){e.options.show(e.get_value(),e.$el)},100)},get_name:function(){return this.property?this.property.get("name"):this.name},get_saved_value:function(){if(this.property)return this.use_breakpoint_property?this.model.get_breakpoint_property_value(this.property_name,!0):this.property.get("value");if(this.model){var e=this.model.get(this.name);return e?e:this.default_value}return this.default_value},get_value:function(){var t=this.get_field();return!this.multiple||t.size()==1&&t.is("select")?t.val():_.map(t,function(t){return e(t).val()})},set_value:function(e){this.get_field().val(e)},get_field_id:function(){return this.cid+"-"+this.get_name()},get_field_name:function(){return this.get_name()},get_field:function(){return this.$el.find("[name="+this.get_field_name()+"]"+(this.selected_state?":"+this.selected_state:""))},get_label_html:function(){if(this.options.hide_label===!0)return"";var e={"for":this.get_field_id(),"class":"upfront-field-label "+(this.options.label_style=="inline"?"upfront-field-label-inline":"upfront-field-label-block")};return"<label "+this.get_field_attr_html(e)+">"+this.label+"</label>"},get_field_attr_html:function(e){return _.map(e,function(e,t){return t+'="'+e+'"'}).join(" ")}}),Wt=zt.extend({className:"upfront-field-wrap upfront-field-wrap-text",render:function(){this.$el.html(""),this.options.compact||this.$el.append(this.get_label_html()),this.$el.append(this.get_field_html());var t=this;this.get_field().keyup(function(){e(this).val()==""?e(this).addClass("upfront-field-empty"):e(this).hasClass("upfront-field-empty")&&e(this).removeClass("upfront-field-empty")}).trigger("keyup").change(function(){t.trigger("changed",t.get_value())}),this.trigger("rendered")},get_field_html:function(){var e={type:"text","class":"upfront-field upfront-field-text",id:this.get_field_id(),name:this.get_field_name(),value:this.get_saved_value()};return this.options.compact?(e.placeholder=this.label,this.$el.attr("title",this.label)):this.options.placeholder&&(e.placeholder=this.options.placeholder),"<input "+this.get_field_attr_html(e)+" />"}}),Xt=Wt.extend({is_edited:!1,className:"upfront-field-wrap upfront-field-wrap-text upfront-field-wrap-toggleable",render:function(){Wt.prototype.render.call(this);if(this.is_edited)return!1;this.$el.append(' <a href="#" class="upfront-toggleable-button">Edit</a>');var t=this;this.$el.on("click",".upfront-toggleable-button",function(n){n.preventDefault(),n.stopPropagation();var r=e(this),i=t.get_field();r.hide(),i.replaceWith(t.get_editable_html()),t.is_edited=!0})},has_been_edited:function(){return this.is_edited},reset_state:function(){this.is_edited=Xt.prototype.is_edited},get_field_html:function(){return this.is_edited?this.get_editable_html():this.get_toggleable_html()},get_field:function(){return this.is_edited?Wt.prototype.get_field.call(this):this.$el.find(".upfront-field-toggleable-value")},get_value:function(){return this.is_edited?Wt.prototype.get_value.call(this):e.trim(this.get_field().text())},set_value:function(e){return this.is_edited?this.get_field().val(e):this.get_field().text(e)},get_toggleable_html:function(){var e=this.get_value()||this.get_saved_value();return'<span class="upfront-field-toggleable-value">'+e+"</span>"},get_editable_html:function(){var e={type:"text","class":"upfront-field upfront-field-text upfront-field-toggleable",id:this.get_field_id(),name:this.get_field_name(),value:this.get_value()||this.get_saved_value()};return"inline"===this.options.label_style&&(e.class+=" upfront-has_inline_label"),this.options.compact?(e.placeholder=this.label,this.$el.attr("title",this.label)):this.options.placeholder&&(e.placeholder=this.options.placeholder),"<input "+this.get_field_attr_html(e)+" />"}}),Vt=zt.extend({className:"upfront-field-wrap upfront-field-wrap-button",events:{click:"on_click"},render:function(){this.$el.html(""),this.options.compact||this.$el.append(this.get_label_html()),this.options.info&&this.$el.append(this.get_info_html()),this.$el.append(this.get_field_html());var e=this;this.options.classname&&this.$el.addClass(this.options.classname),this.trigger("rendered")},get_info_html:function(){return'<span class="button-info">'+this.options.info+"</span>"},get_field_html:function(){var e={type:"button","class":"upfront-field upfront-field-button",id:this.get_field_id(),name:this.get_field_name(),value:this.label};return this.options.compact?(e.placeholder=this.label,this.$el.attr("title",this.label)):this.options.placeholder&&(e.value=this.options.placeholder),"<input "+this.get_field_attr_html(e)+" />"}}),$t=Wt.extend({get_field_html:function(){var e={type:"email","class":"upfront-field upfront-field-text upfront-field-email",id:this.get_field_id(),name:this.get_field_name(),value:this.get_saved_value()};return this.options.compact?(e.placeholder=this.label,this.$el.attr("title",this.label)):this.options.placeholder&&(e.placeholder=this.options.placeholder),"<input "+this.get_field_attr_html(e)+" />"}}),Jt=Wt.extend({className:"upfront-field-wrap upfront-field-wrap-text upfront-field-wrap-textarea",get_field_html:function(){var e={cols:"40",rows:"5","class":"upfront-field upfront-field-text upfront-field-textarea",id:this.get_field_id(),name:this.get_field_name()};return this.options.compact?(e.placeholder=this.label,this.$el.attr("title",this.label)):this.options.placeholder&&(e.placeholder=this.options.placeholder),"<textarea "+this.get_field_attr_html(e)+">"+this.get_saved_value()+"</textarea>"}}),Kt=Wt.extend({className:"upfront-field-wrap upfront-field-wrap-number",get_field_html:function(){var e={type:"number","class":"upfront-field upfront-field-number",id:this.get_field_id(),name:this.get_field_name(),value:this.get_saved_value()};return typeof this.options.min!="undefined"&&(e.min=this.options.min),typeof this.options.max!="undefined"&&(e.max=this.options.max),typeof this.options.step!="undefined"&&(e.step=this.options.step)," <input "+this.get_field_attr_html(e)+" /> "+(this.options.suffix?this.options.suffix:"")}}),Qt=Wt.extend(_.extend({},Ut,{className:"upfront-field-wrap upfront-field-wrap-slider",initialize:function(e){this.options=e,Qt.__super__.initialize.apply(this,arguments);var t=this,n={range:this.getOption("range","min"),min:this.getOption("min",0),max:this.getOption("max",0),step:this.getOption("step",1),orientation:this.getOption("orientation","horizontal"),value:this.get_saved_value()};this.value=this.get_saved_value(),typeof this.value=="undefined"&&(this.value=n.min),this.options.callbacks&&_.extend(n,this.options.callbacks),n.slide=function(e,n){var r=n.value;t.value=r,t.$("input").val(t.value).trigger("change"),t.options.valueTextFilter&&(r=t.options.valueTextFilter(r)),t.$(".upfront-field-slider-value").text(r),t.options.callbacks&&t.options.callbacks.slide&&t.options.callbacks.slide(e,n)},this.on("rendered",function(){var e=t.$("#"+t.get_field_id());n.orientation=="vertical"&&e.addClass("upfront-field-slider-vertical"),e.slider(n)})},get_field_html:function(){var e='<input type="hidden" name="'+this.get_field_name()+'" value="'+this.value+'">',t=this.value;return this.options.info&&(e+='<div class="upfront-field-info">'+this.options.info+"</div>"),e+='<div class="upfront-field upfront-field-slider" id="'+this.get_field_id()+'"></div>',this.options.valueTextFilter&&(t=this.options.valueTextFilter(t)),e+='<div class="upfront-field-slider-value"> '+t+"</div>",e},getOption:function(e,t){return this.options[e]?this.options[e]:t}})),Gt=Wt.extend({className:"upfront-field-wrap upfront-field-wrap-hidden",get_field_html:function(){var e={type:"hidden",id:this.get_field_id(),name:this.get_field_name(),"class":"upfront-field upfront-field-hidden",value:this.get_saved_value()};return" <input "+this.get_field_attr_html(e)+" /> "}}),Yt=Wt.extend({className:"upfront-field-wrap upfront-field-wrap-color sp-cf",defaults:{blank_alpha:1,autoHide:!0},spectrumDefaults:{clickoutFiresChange:!1,chooseText:"OK",showSelectionPalette:!0,showAlpha:!0,showPalette:!0,localStorageKey:"spectrum.recent_colors",palette:bt.colors.pluck("color").length?bt.colors.pluck("color"):[],maxSelectionSize:10,preferredFormat:"hex",showInput:!0,allowEmpty:!0,appendTo:"parent"},events:{"change .upfront_color_picker_rgba input":"rgba_sidebar_changed","change .sp-input":"sp_input_changed","click .upfront_color_picker_reset":"set_to_blank"},initialize:function(n){this.options=_.extend({},this.defaults,n),this.options.blank_alpha=_.isUndefined(this.options.blank_alpha)?1:this.options.blank_alpha,this.sidebar_template=_.template(f.color_picker);var r=this,i=typeof this.options.spectrum=="object"?_.extend({},this.spectrumDefaults,this.options.spectrum):this.spectrumDefaults;this.rgba={r:0,g:0,b:0,a:0},this.spectrumOptions=i,i.move=function(t,n){if(!_.isEmpty(t)){r.color=t;var i=t.toHexString();e(".sp-dragger").css({"border-top-color":i,"border-right-color":i}),r.update_input_border_color(t.toRgbString()),r.update_input_val(i),r.rgba=_.extend(r.rgba,t.toRgb()),r.render_sidebar_rgba(r.rgba)}r.options.spectrum&&r.options.spectrum.move&&r.options.spectrum.move(t),r.toggle_alpha_selector(t,n)},i.show=function(t){var n=e(".sp-input"),s=n.val();if(!_.isEmpty(t)){this.color=t;var o=t.toHexString();r.rgba=_.extend(r.rgba,t.toRgb()),r.update_input_border_color(t.toRgbString()),r.render_sidebar_rgba(r.rgba),r.update_input_val(o)}if(!_.isEmpty(s)&&!r.is_hex(s)){var u=tinycolor(s);n.val(u.toHexString())}r.spectrumOptions=i,r.options.spectrum&&r.options.spectrum.show&&r.options.spectrum.show(t),e(".sp-container").not(r.$(".sp-container")).each(function(){var t=e(this),n=t.data("sp-options");(!n||!n.flat)&&t.addClass("sp-hidden")});if(!_.isEmpty(s)){var a=tinycolor(s);r.toggle_alpha_selector(a)}},i.beforeShow=function(t){t instanceof Object&&e.extend(t,tinycolor.prototype),r.color=t,r.update_palette(),r.$("input[name="+r.get_field_name()+"]").spectrum("option","palette",r.options.palette),r.options.spectrum&&r.options.spectrum.beforeShow&&r.options.spectrum.beforeShow(t),r.$(".sp-container").data("sp-options",r.options.spectrum)};var s=function(e){r.options.spectrum&&r.options.spectrum.hide&&r.options.spectrum.hide(e)};i.hide=s,i.autoHide||(i.hide=function(e){r.color=e,s(e),r.$(".sp-replacer").addClass("sp-active"),r.$(".sp-container").removeClass("sp-hidden")});var o=_.debounce(function(){e(".sp-container").each(function(){e(this).find(".sp-input-container").attr("data-label",t.current_color).end().find(".sp-palette-container").attr("data-label",t.theme_colors).end().find(".sp-palette-row:last").attr("data-label",t.recent_colors)})});Yt.__super__.initialize.apply(this,arguments),this.on("rendered",function(){r.$("input[name="+r.get_field_name()+"]").spectrum(i),r.$spectrum=r.$("input[name="+r.get_field_name()+"]"),r.$spectrum.on("reflow.spectrum move.spectrum change",o),r.$(".sp-container").append("<div class='color_picker_rgb_container'></div>"),r.update_input_border_color(r.get_saved_value()),r.$(".sp-container").data("field_color",r),r.$(".sp-container").data("$spectrum",r.$spectrum),r.$(".sp-container").find(".sp-choose").on("click.spectrum",function(e){r.options.spectrum&&r.options.spectrum.choose&&r.color&&r.options.spectrum.choose(r.color),r.autoHide!==!0&&(r.$(".sp-replacer").removeClass("sp-active"),r.$(".sp-container").addClass("sp-hidden"))}),r.$(".sp-container").find(".sp-choose").text(Upfront.Settings.l10n.global.content.ok)})},render:function(){Yt.__super__.render.apply(this,arguments),this.stopListening(Upfront.Events,"theme_colors:update");var e=_.debounce(this.update_palette,200);this.listenTo(Upfront.Events,"theme_colors:update",e,this)},update_palette:function(){this.$spectrum&&this.$spectrum.spectrum&&this.$spectrum.spectrum("option","palette",bt.colors.pluck("color").length?bt.colors.pluck("color"):[])},is_hex:function(e){return e.indexOf("#")===-1?!1:!0},get_field_html:function(){var e={type:"text","class":"upfront-field upfront-field-color",id:this.get_field_id(),name:this.get_field_name(),value:this.get_saved_value()};return" <input "+this.get_field_attr_html(e)+" /> "+(this.options.suffix?this.options.suffix:"")},update_input_border_color:function(t){var n=this.$el.find(".sp-preview");e(".sp-input").css({borderColor:t}),n.css({backgroundColor:t}),t!=="rgba(0, 0, 0, 0)"?n.removeClass("uf-unset-color"):n.closest(".theme_colors_empty_picker").length===0&&n.addClass("uf-unset-color")},update_input_val:function(e){this.$(".sp-input").val(e)},render_sidebar_rgba:function(e){var t=this;this.$(".color_picker_rgb_container").html(this.sidebar_template(e)),this.$(".upfront_color_picker_reset").on("click",function(e){e.preventDefault(),t.set_to_blank()})},rgba_sidebar_changed:function(t){var n=e(t.target),r=n.data("type"),i=parseFloat(n.val()),s=this.$spectrum.spectrum("get"),o={};o[r]=i,s=tinycolor(_.extend(s.toRgb(),o)),this.$spectrum.spectrum("set",s.toRgbString()),this.update_input_border_color(s.toRgbString()),this.update_input_val(s.toHexString()),this.render_sidebar_rgba(s.toRgb()),this.options.spectrum&&typeof this.options.spectrum.move=="function"&&this.options.spectrum.move(s),this.options.spectrum&&typeof this.options.spectrum.change=="function"&&this.options.spectrum.change(s),t.stopPropagation(),t.preventDefault(),this.$spectrum.trigger("dragstop.spectrum")},sp_input_changed:function(t){var n=tinycolor(e(t.target).val());this.options.spectrum&&typeof this.options.spectrum.move=="function"&&this.options.spectrum.move(n),this.options.spectrum&&typeof this.options.spectrum.change=="function"&&this.options.spectrum.change(n),this.update_input_border_color(n.toRgbString)},set_to_blank:function(){var e="rgba(0, 0, 0, "+(_.isUndefined(this.options.blank_alpha)?1:this.options.blank_alpha)+")",t=tinycolor(e);t.reset=!0,this.rgba={r:0,g:0,b:0,a:0},this.$spectrum.spectrum("set",t.toRgbString()),this.update_input_border_color(e),this.update_input_val("#000000"),this.render_sidebar_rgba(this.rgba),this.options.spectrum&&typeof this.options.spectrum.move=="function"&&this.options.spectrum.move(t),this.options.spectrum&&typeof this.options.spectrum.change=="function"&&this.options.spectrum.change(t),this.options&&typeof this.options.move=="function"&&this.options.move(t),this.options&&typeof this.options.change=="function"&&this.options.change(t)},get_value:function(){return this.$el.find(".sp-preview-inner").css("background-color")},set_value:function(e){Upfront.Util.colors.is_theme_color(e)&&(e=Upfront.Util.colors.get_color(e));var t=tinycolor(e);this.color=t,this.$spectrum.spectrum("set",t)},toggle_alpha_selector:function(n){if(_.isEmpty(n))return;var r=this.$(".sp-alpha");Upfront.Views.Theme_Colors.colors.is_theme_color(n)?(r.addClass("sp-alpha-disabled sp-alpha-lower-opacity"),$overlay=e("<span class='sp-alpha-overlay' title='"+t.theme_colors_opacity_disabled+"'></span>").on("click",function(e){e.stopPropagation(),e.preventDefault()}),this.$(".sp-alpha-overlay").length||r.before($overlay)):(r.removeClass("sp-alpha-disabled sp-alpha-lower-opacity"),this.$(".sp-alpha-overlay").remove())}}),Zt=zt.extend(_.extend({},Ut,{get_values_html:function(){return _.map(this.options.values,this.get_value_html,this).join("")},set_value:function(e){this.$el.find('[value="'+e+'"]').trigger("click")}})),en=Zt.extend(_.extend({},c,{events:{"click .upfront-field-select-value":"openOptions","mouseup .upfront-field-select":"onMouseUp","change .upfront-field-select-option input":"onChange","click .upfront-field-select-option label":"onOptionClick"},onOptionClick:function(t){if(!this.multiple){t.stopPropagation();if(e(this).closest(".upfront-field-select-option").hasClass("upfront-field-select-option-disabled"))return;e(t.currentTarget).siblings("input").not(":checked")&&e(t.currentTarget).siblings("input").click(),this.$el.find(".upfront-field-select").removeClass("upfront-field-select-expanded"),this.trigger("blur")}},openOptions:function(t){t&&t.stopPropagation();if(this.options.disabled)return;e(".upfront-field-select-expanded").removeClass("upfront-field-select-expanded"),this.$el.find(".upfront-field-select").css("min-width","").css("min-width",this.$el.find(".upfront-field-select").width()),this.$el.find(".upfront-field-select").addClass("upfront-field-select-expanded");var n=this;_.delay(function(){var t=n.$el.parents("#sidebar-ui").length,r=n.$el.parents("#element-settings-sidebar").length,i=46;if(t==1||r==1){var s=n.$el.find(".upfront-field-select-options"),o=s.parent(),u=o.offset().top-e("#element-settings-sidebar").offset().top;u+=i,s.css("width",o.width()+3),s.css("top",u+"px"),Upfront.Util.isRTL()?s.css("right",e(window).width()-o.offset().left-o.width()+"px"):s.css("left",o.offset().left+"px"),s.css("display","block")}},10),e(".sidebar-panel-content, #sidebar-scroll-wrapper").on("scroll",this,this.on_scroll),this.trigger("focus")},on_scroll:function(e){var t=e.data;t.$el.find(".upfront-field-select").removeClass("upfront-field-select-expanded"),t.trigger("blur")},onMouseUp:function(e){e.stopPropagation()},onChange:function(){this.update_select_display_value(),this.trigger("changed",this.get_value())},selected_state:"checked",className:"upfront-field-wrap upfront-field-wrap-select",render:function(){this.$el.html(""),this.label&&this.$el.append(this.get_label_html()),this.$el.append(this.get_field_html()),this.stop_scroll_propagation(this.$el.find(".upfront-field-select-options")),!this.multiple&&!this.get_saved_value()&&this.$el.find(".upfront-field-select-option:eq(0) input").prop("checked",!0),this.update_select_display_value(),this.options.width&&this.$el.find(".upfront-field-select").css("width",this.options.width),this.options.additional_classes&&this.$el.addClass(this.options.additional_classes),this.trigger("rendered")},update_select_display_value:function(){var t=this.options.select_label?this.options.select_label:this.options.placeholder?this.options.placeholder:"",n=this.$el.find(".upfront-field-select-value"),r=this.$el.find(".upfront-field-select-option input:checked");if(r.size()==1&&!this.multiple){var i=r.closest(".upfront-field-select-option"),s=i.text(),o=i.find(".upfront-field-icon").clone();n.html(""),o&&n.append(o),n.append("<span>"+s+"</span>")}else{var u=[];r.each(function(){u.push(e(this).closest(".upfront-field-select-option").text())}),n.text(r.size()==0?t:u.join(", "))}this.$el.find(".upfront-field-select-option").each(function(){e(this).find("input:checked").size()>0?e(this).addClass("upfront-field-select-option-selected"):e(this).removeClass("upfront-field-select-option-selected")})},get_field_html:function(){var e={"class":"upfront-field-select upfront-no-select",id:this.get_field_id()};return e.class+=" upfront-field-select-"+(this.options.multiple?"multiple":"single"),this.options.disabled&&(e.class+=" upfront-field-select-disabled"),this.options.style=="zebra"&&(e.class+=" upfront-field-select-zebra"),"<div "+this.get_field_attr_html(e)+'><div class="upfront-field-select-value"></div><ul class="upfront-field-select-options">'+this.get_values_html()+"</ul></div>"},get_value_html:function(e,t){var n=this.get_field_id()+"-"+t,r={type:this.multiple?"checkbox":"radio",id:n,name:this.get_field_name(),"class":"upfront-field-"+(this.multiple?"checkbox":"radio"),value:e.value},i=this.get_saved_value(),s="upfront-field-select-option";e.disabled&&(r.disabled="disabled",s+=" upfront-field-select-option-disabled");var o=this.options.icon_class?this.options.icon_class:null;this.multiple&&_.contains(i,e.value)?r.checked="checked":!this.multiple&&i==e.value&&(r.checked="checked"),r.checked&&(s+=" upfront-field-select-option-selected"),s+=" upfront-field-select-option-"+(t%2==0?"odd":"even");var u="<input "+this.get_field_attr_html(r)+" />";return'<li class="'+s+'">'+'<label for="'+n+'">'+this.get_icon_html(e.icon,o)+'<span class="upfront-field-label-text">'+e.label+"</span></label>"+u+"</li>"}})),tn=en.extend({events:{"change select":"on_change","click .chosen-container .chosen-single":"openOptions"},multiple:!1,initialize:function(t){zt.prototype.initialize.call(this,t),e(".sidebar-panel-content, #sidebar-scroll-wrapper").on("scroll",this,this.closeChosen),e(".sidebar-panel-content .sidebar-tab-content").bind("mousewheel",function(){return!1})},get_field_html:function(){var e=this.multiple?"multiple":"";return['<select class="upfront-chosen-select"',e,' data-placeholder="',this.options.placeholder,'">',this.get_values_html(),"</select>"].join("")},get_value_html:function(e,t){var n="";return e.value===this.options.default_value&&(n=' selected="selected"'),['<option value="',e.value,'"',n,">",e.label,"</option>"].join("")},on_change:function(e){this.$el.find(".chosen-drop").css("display","none"),this.trigger("changed")},get_value:function(){return this.$el.find("select").val()},set_value:function(e){this.$el.find("select").val(e).trigger("chosen:updated")},openOptions:function(t){var n=this;_.delay(function(){var t=n.$el.parents("#sidebar-ui").length,r=n.$el.parents("#element-settings-sidebar").length,i=44;if(t==1||r==1){var s=n.$el.find(".chosen-drop"),o=s.parent(),u=o.offset().top-e("#element-settings-sidebar").offset().top+o.height();u+=i,s.css("width",o.width()),s.css("top",u+"px"),s.css("left",o.offset().left+"px"),s.css("display","block")}},20),n.$el.find(".chosen-drop").show()},closeChosen:function(t){var n=t.data,r=n.$el.parents("#sidebar-ui").length,i=n.$el.parents("#element-settings-sidebar").length;(r==1||i==1)&&n.$el.find(".chosen-drop").css("display","none"),n.$el.find("select").trigger("chosen:close"),e(".sidebar-panel-content .sidebar-tab-content").unbind("mousewheel")}}),nn=tn.extend({events:{"change select":"on_change","click .chosen-container .chosen-single":"openOptions"},multiple:!1,get_field_html:function(){var e=this.multiple?"multiple":"";return['<div class="upfront-select-font"><select class="upfront-chosen-select-typeface"',e,' data-placeholder="',this.options.placeholder,'">',this.get_values_html(),"</select></div>"].join("")},get_value_html:function(e,t){var n="",r=this.get_saved_value();return e.value===r&&(n=' selected="selected"'),['<option value="',e.value,'"',n,' style="font-family: ',e.value,'">',e.label,"</option>"].join("")},render:function(){tn.prototype.render.call(this);var t=this;e(".upfront-chosen-select-typeface",this.$el).chosen({width:this.options.select_width}),setTimeout(function(){t.set_option_font(t.get_saved_value())},50)},on_change:function(e){this.trigger("changed",this.get_value()),this.$el.find(".chosen-drop").css("display","none"),this.set_option_font(this.get_value())},set_option_font:function(e){this.$el.find(".chosen-single").css("font-family",e)},openOptions:function(e){tn.prototype.openOptions.call(this)}}),rn=tn.extend({events:{"change select":"on_change","click .chosen-container .chosen-single":"openOptions"},multiple:!1,get_field_html:function(){var e=this.multiple?"multiple":"";return['<div class="upfront-select-font"><select class="upfront-chosen-select-style"',e,' data-placeholder="',this.options.placeholder,'">',this.get_values_html(),"</select></div>"].join("")},get_value_html:function(e,t){var n="",r=this.options.font_family,i=Upfront.Views.Font_Model.parse_variant(e.value),s=this.get_saved_value();e.value===s&&(n=' selected="selected"');var o=this.map_labels(i.weight,i.style);return['<option value="',e.value,'"',n,' style="font-family: ',r,"; font-weight: ",i.weight,"; font-style: ",i.style,' ">',o,"</option>"].join("")},render:function(){tn.prototype.render.call(this);var t=this;e(".upfront-chosen-select-style",this.$el).chosen({width:this.options.select_width,disable_search:!0}),setTimeout(function(){t.set_option_font(t.get_saved_value())},50)},map_labels:function(e,n){var r,i={100:t.label_thin,200:t.label_extra_light,300:t.label_light,400:t.label_regular,500:t.label_medium,600:t.label_semi_bold,700:t.label_bold,800:t.label_extra_bold,900:t.label_ultra_bold};return!_.isUndefined(e)&&e.match(/^(\d+)/)?r=i[e]:r=e,n=="italic"&&(r+=" "+n),r},on_change:function(e){this.trigger("changed",this.get_value()),this.$el.find(".chosen-drop").css("display","none"),this.set_option_font(this.get_value())},set_option_font:function(e){var t=this.$el.parent().parent().find(".upfront-chosen-select-typeface").val(),n=Upfront.Views.Font_Model.parse_variant(e);this.$el.find(".chosen-single").css({"font-family":t,"font-weight":n.weight,"font-style":n.style})},openOptions:function(e){tn.prototype.openOptions.call(this)}}),sn=tn.extend({events:{"change select":"on_change","click .chosen-container-multi":"openOptions"},multiple:!0,get_field_html:function(){var e=this.multiple?"multiple":"";return['<select class="upfront-chosen-select-multiple"',e,' data-placeholder="',this.options.placeholder,'">',this.get_values_html(),"</select>"].join("")},get_value_html:function(e,t){var n="",r=this.get_saved_value();return _.contains(r,e.value)&&(n=' selected="selected"'),['<option value="',e.value,'"',n,">",e.label,"</option>"].join("")},render:function(){tn.prototype.render.call(this);var t=this;e(".upfront-chosen-select-multiple",this.$el).chosen({width:this.options.select_width})},on_change:function(e){this.trigger("changed",this.get_value()),this.$el.find(".chosen-drop").css("display","none")},openOptions:function(e){tn.prototype.openOptions.call(this)}}),on=Zt.extend({selected_state:"checked",render:function(){var t=this;this.$el.html(""),this.label&&this.$el.append(this.get_label_html()),this.$el.append(this.get_field_html()),this.$el.on("change",".upfront-field-multiple input",function(){t.$el.find(".upfront-field-multiple").each(function(){e(this).find("input:checked").size()>0?e(this).addClass("upfront-field-multiple-selected"):e(this).removeClass("upfront-field-multiple-selected")}),t.trigger("changed",t.get_value())}),this.trigger("rendered")},get_field_html:function(){return this.get_values_html()},get_value_html:function(e,t){var n=this.get_field_id()+"-"+t,r="upfront-field-multiple",i={type:this.type,id:n,name:this.get_field_name(),value:e.value,"class":"upfront-field-"+this.type},s=this.get_saved_value(),o=this.options.icon_class?this.options.icon_class:null;return this.options.layout&&(r+=" upfront-field-multiple-"+this.options.layout),e.disabled&&(i.disabled="disabled",r+=" upfront-field-multiple-disabled"),this.multiple&&_.contains(s,e.value)?i.checked="checked":!this.multiple&&s==e.value&&(i.checked="checked"),e.checked&&(i.checked="checked"),i.checked&&(r+=" upfront-field-multiple-selected"),'<span class="'+r+'"><input '+this.get_field_attr_html(i)+" />"+'<label for="'+n+'">'+this.get_icon_html(e.icon,o)+'<span class="upfront-field-label-text">'+e.label+"</span></label></span>"}}),un=on.extend({className:"upfront-field-wrap upfront-field-wrap-multiple upfront-field-wrap-radios",type:"radio"}),an=on.extend({className:"upfront-field-wrap upfront-field-wrap-multiple upfront-field-wrap-checkboxes",type:"checkbox",multiple:!0}),fn=an.extend({className:"upfront-field-wrap upfront-field-wrap-multiple upfront-field-wrap-checkboxes upfront-field-wrap-optional",events:{"change input":"onChange"},initialize:function(e){var t=this;fn.__super__.initialize.apply(this,arguments),this.options=e,this.on("panel:set",function(){this.panel.on("rendered",function(){t.onChange()})}),e.onChange&&(this.onChange=e.onChange)},onChange:function(){var t=this.$("input"),n=this.panel.$("input[name="+this.options.relatedField+"]").closest(".upfront-field-wrap");t.is(":checked")?n.show():n.hide(),e("#settings").height(this.panel.$(".upfront-settings_panel").outerHeight()),this.model.set_property(this.options.property,this.get_value())}}),ln=zt.extend(_.extend({},c,{events:{"click .upfront-suggest-add":"add_list","focus .upfront-field-text-suggest":"reveal_suggest","keyup .upfront-field-text-suggest":"update_suggest"},multiple:!0,selected_state:"checked",added_list:[],checked_list:[],suggest_list:[],render:function(){var n=this;this.$el.html(""),this.label&&this.$el.append(this.get_label_html()),this.$el.append('<div class="upfront-suggest-wrap" />');var r=this.$el.find(".upfront-suggest-wrap");r.append(this.get_field_html()),r.append('<div class="upfront-suggest-list-wrap upfront-no-select" />'),this.checked_list=this.get_saved_value();var i=this.$el.find(".upfront-suggest-list-wrap");i.append('<ul class="upfront-suggest-lists">'+this.get_suggest_list_html()+"</ul>"),i.append('<div class="upfront-suggest-add-wrap"><span class="upfront-suggest-add-value"></span><span class="upfront-suggest-add">'+t.add_new+"</span></div>"),this.stop_scroll_propagation(this.$el.find(".upfront-suggest-lists")),this.$el.on("change",".upfront-suggest-list input",function(){var t=e(this).val();!e(this).is(":checked")&&_.contains(n.checked_list,t)?n.checked_list=_.without(n.checked_list,t):n.checked_list.push(t),n.trigger("changed")}),this.$el.on("click",function(e){e.stopPropagation()}),e("#settings").on("click",".upfront-settings_panel",function(){n.$el.find(".upfront-suggest-list-wrap").removeClass("upfront-suggest-list-wrap-expanded")}),this.trigger("rendered")},reveal_suggest:function(){this.$el.find(".upfront-suggest-list-wrap").addClass("upfront-suggest-list-wrap-expanded"),this.update_suggest()},update_suggest:function(){var e=this.get_field_input_value();this.$el.find(".upfront-suggest-lists").html(this.get_suggest_list_html()),e?(this.$el.find(".upfront-suggest-add-wrap").show(),this.$el.find(".upfront-suggest-add-value").text(e),this.$el.find(".upfront-suggest-add").toggle(!_.contains(this.suggest_list,e))):this.$el.find(".upfront-suggest-add-wrap").hide()},get_field_html:function(){var e={type:"text","class":"upfront-field upfront-field-text upfront-field-text-suggest",id:this.get_field_id()};return this.options.placeholder&&(e.placeholder=this.options.placeholder),"<input "+this.get_field_attr_html(e)+" />"},get_suggest_list_html:function(){var e=this.get_field_input_value(),t=e?new RegExp("("+e+")","ig"):!1,n=this.get_suggest_list(t),r=this;return _.map(n,function(e,n){var i=r.get_field_id()+"-"+n,s={type:"checkbox",id:i,name:r.get_field_name(),value:e,"class":"upfront-field-checkbox"};_.contains(r.checked_list,e)&&(s.checked="checked");var o=t?e.replace(t,'<span class="upfront-suggest-match">$1</span>'):e;return'<li class="upfront-suggest-list"><input '+r.get_field_attr_html(s)+' /><label for="'+i+'">'+o+"</label></li>"}).join("")},get_suggest_list:function(e){var t=[];return _.each([this.options.source,this.added_list,this.get_saved_value()],function(n,r){_.each(n,function(n){(r!=2||!_.contains(t,n))&&(e&&n.match(e)||!e)&&t.push(n)})}),this.suggest_list=t,t},get_field_input_value:function(){return this.$el.find("#"+this.get_field_id()).val()},empty_field_input_value:function(){return this.$el.find("#"+this.get_field_id()).val("")},add_list:function(e){var t=this.get_field_input_value();this.added_list.push(t),this.checked_list.push(t),this.empty_field_input_value(),this.update_suggest()}})),cn=Backbone.View.extend({group:!0,get_name:function(){if(this.fields.length==1)return this.fields[0].get_name();if(this.fields.length>1)return this.fields.map(function(e){return e.get_name()})},get_value:function(){if(this.fields.length==1)return this.fields[0].get_value();if(this.fields.length>1)return this.fields.map(function(e){return e.get_value()})},get_title:function(){return this.options.title?this.options.title:""},initialize:function(e){var t=this;t.options=e,this.fields=e.fields?_(e.fields):_([]),this.group=typeof e.group!="undefined"?e.group:this.group,this.on("panel:set",function(){t.fields.each(function(e){e.panel=t.panel,e.trigger("panel:set")})})},render:function(){this.group?this.$el.append('<div class="upfront-settings-item"><div class="upfront-settings-item-title"><span>'+this.get_title()+"</span></div>"+'<div class="upfront-settings-item-content"></div>'+"</div>"):this.$el.append('<div class="upfront-settings-item-content"></div>');var e=this.$el.find(".upfront-settings-item-content");this.fields.each(function(t){t.render(),t.delegateEvents(),e.append(t.el)}),this.trigger("rendered")},save_fields:function(){var e=_([]);this.fields.each(function(t,n,r){if(t.property){var i=t.get_value()||[],s=t.get_saved_value();!t.multiple&&i!=s?e.push(t):t.multiple&&(i.length!=s.length||_.difference(i,s).length!=0)&&e.push(t)}}),e.each(function(e,t,n){e.use_breakpoint_property?e.model.set_breakpoint_property(e.property_name,e.get_value(),!0):e.property.set({value:e.get_value()},{silent:!0})}),e.size()>0&&(this.panel.is_changed=!0)},wrap:function(e){if(!e)return!1;var t=e.title||"",n=e.markup||e;this.$el.append('<div id="usetting-'+this.get_name()+'" class="upfront-settings-item">'+'<div class="upfront-settings-item-title"><span>'+t+"</span></div>"+'<div class="upfront-settings-item-content">'+n+"</div>"+"</div>")},remove:function(){this.fields&&this.fields.each(function(e){e.remove()}),Backbone.View.prototype.remove.call(this)}}),hn=Backbone.View.extend(_.extend({},Ut,{className:"upfront-settings-item-tab-wrap",radio:!1,is_default:!1,events:{"click .upfront-settings-item-tab":"reveal"},initialize:function(e){this.options=e,this.settings=e.settings?_(e.settings):_([]),this.radio=typeof e.radio!="undefined"?e.radio:this.radio,this.is_default=typeof e.is_default!="undefined"?e.is_default:this.is_default},get_title:function(){return this.options.title?this.options.title:""},get_icon:function(){return this.options.icon?this.options.icon:""},get_property:function(){return this.options.property?this.options.property:""},get_value:function(){return this.options.value?this.options.value:""},get_property_model:function(){var e=this.get_property();return e?this.model.get_property_by_name(e):!1},get_property_value:function(){var e=this.get_property_model();return e?e.get("value"):""},render:function(){var t=this;this.$el.html(""),this.$el.append('<div class="upfront-settings-item-tab" />'),this.$el.append('<div class="upfront-settings-item-tab-content" />');var n=this.$el.find(".upfront-settings-item-tab"),r=this.$el.find(".upfront-settings-item-tab-content");if(this.radio){var i=this.get_property_model();i||this.is_default&&this.model.init_property(this.get_property(),this.get_value());var s=this.cid+"-"+this.get_property(),o=e('<label for="'+s+'" />'),u=this.get_property_value()==this.get_value();o.append(this.get_icon_html(this.get_icon())),o.append('<span class="upfront-settings-item-tab-radio-text">'+this.get_title()+"</span>"),n.append(o),n.append('<input type="radio" id="'+s+'" class="upfront-field-radio" name="'+this.get_property()+'" value="'+this.get_value()+'" '+(u?'checked="checked"':"")+" />"),this.$el.addClass("upfront-settings-item-tab-radio")}else n.text(this.get_title());this.settings.each(function(e){e.panel=t.panel,e.render(),r.append(e.el)}),this.listenTo(this.panel,"rendered",this.panel_rendered),this.trigger("rendered")},conceal:function(){this.$el.removeClass("upfront-settings-item-tab-active")},reveal:function(){this.panel.settings.invoke("conceal"),this.$el.addClass("upfront-settings-item-tab-active"),this.radio&&this.$el.find(".upfront-settings-item-tab input").prop("checked",!0).trigger("change")},panel_rendered:function(){this.radio&&this.get_property_value()==this.get_value()&&this.reveal()},save_fields:function(){this.settings.invoke("save_fields");if(this.radio&&this.$el.find(".upfront-settings-item-tab input:checked").size()>0){var e=this.get_property_model();e?e.set({value:this.get_value()},{silent:!0}):this.model.init_property(this.get_property(),this.get_value()),this.get_property_value()!=this.get_value()&&(this.panel.is_changed=!0)}},remove:function(){this.settings&&this.settings.each(function(e){e.remove()}),Backbone.View.prototype.remove.call(this)}})),pn=Backbone.View.extend(_.extend({},c,{className:"upfront-settings_panel_wrap",hide_common_anchors:!1,hide_common_fields:!1,events:{"click .upfront-save_settings":"on_save","click .upfront-cancel_settings":"on_cancel","click .upfront-settings_label":"on_toggle","click .upfront-settings-common_panel .upfront-settings-item-title":"on_toggle_common","click .upfront-settings-padding_panel .upfront-settings-item-title":"on_toggle_padding"},get_title:function(){return this.options.title?this.options.title:""},get_label:function(){return this.options.label?this.options.label:""},initialize:function(e){var t=this;this.hide_common_fields=_.isUndefined(e.hide_common_fields)?!1:e.hide_common_fields,this.hide_common_anchors=_.isUndefined(e.hide_common_anchors)?!1:e.hide_common_anchors,t.options=e,this.settings=e.settings?_(e.settings):_([]),this.settings.each(function(e){e.panel=t,e.trigger("panel:set")}),this.tabbed=typeof e.tabbed!="undefined"?e.tabbed:this.tabbed},tabbed:!1,is_changed:!1,render:function(){this.$el.html('<div class="upfront-settings_label" /><div class="upfront-settings_panel" ><div class="upfront-settings_panel_scroll" />');var e=this.$el.find(".upfront-settings_label"),n=this.$el.find(".upfront-settings_panel"),r=this.$el.find(".upfront-settings_panel_scroll"),i,s=this;e.append(this.get_label()),this.settings.each(function(e){e.panel||(e.panel=s),e.render(),r.append(e.el)}),this.options.min_height&&r.css("min-height",this.options.min_height);if(this.tabbed){var o=this.settings.first();o.radio||o.reveal(),r.append('<div class="upfront-settings-tab-height" />')}this.stop_scroll_propagation(r);if(this.hide_common_fields===!1){this.$el.find(".upfront-settings_panel_scroll").after('<div class="upfront-settings-common_panel"></div>'),i=this.$el.find(".upfront-settings-common_panel");if(this.hide_common_anchors===!1){var u=new Vn({model:this.model,title:t.anchor_settings});u.panel=s,u.render(),i.append(u.el)}}this.$el.find(".upfront-settings_panel_scroll").after('<div class="upfront-settings-padding_panel"></div>'),$padding_panel=this.$el.find(".upfront-settings-padding_panel");if(typeof this.paddingEditor=="undefined"||this.paddingEditor)this.paddingEditor=new vn({model:this.model,title:t.padding_settings}),this.paddingEditor.panel=s,this.paddingEditor.render(),$padding_panel.append(this.paddingEditor.el);n.append("<div class='upfront-settings-button_panel'><button type='button' class='upfront-save_settings'><i class='icon-ok'></i> "+t.ok+"</button>"+"</div>"),this.$el.fadeIn("fast",function(){var e=s.$el.parent(),t=(e.offset()?e.offset().top:0)+e.height(),n=jQuery(window).height();t+60>n+jQuery("body").scrollTop()&&jQuery("body").animate({scrollTop:t-n+60},"slow")}),this.trigger("rendered")},on_toggle_common:function(){var e=this,t=this.$el.find(".upfront-settings-common_panel");t.toggleClass("open")},on_toggle_padding:function(){var e=this,t=this.$el.find(".upfront-settings-padding_panel");t.toggleClass("open")},conceal:function(){this.$el.find(".upfront-settings_panel").hide(),this.$el.find(".upfront-settings_label").removeClass("active"),this.trigger("concealed")},reveal:function(){this.$el.find(".upfront-settings_label").addClass("active"),this.$el.find(".upfront-settings_panel").show();if(this.tabbed){var t=0;this.$el.find(".upfront-settings-item-tab-content").each(function(){var n=e(this).outerHeight(!0);t=n>t?n:t}),this.$el.find(".upfront-settings-tab-height").css("height",t)}this.trigger("revealed")},show:function(){this.$el.show()},hide:function(){this.$el.hide()},is_active:function(){return this.$el.find(".upfront-settings_panel").is(":visible")},on_toggle:function(){this.trigger("upfront:settings:panel:toggle",this),this.show()},start_loading:function(e,t){this.loading=new Upfront.Views.Editor.Loading({loading:e,done:t}),this.loading.render(),this.$el.find(".upfront-settings_panel").append(this.loading.$el)},end_loading:function(e){this.loading?this.loading.done(e):e()},on_save:function(){var e=!1;this.parent_view.panels.each(function(t){t.save_settings(),t.is_changed&&(e=!0,t.is_changed=!1)}),e&&this.parent_view.model.get("properties").trigger("change"),this.trigger("upfront:settings:panel:saved",this),Upfront.Events.trigger("entity:settings:deactivate")},save_settings:function(){if(!this.settings)return!1;var e=this;this.settings.each(function(t){if((t.fields||t.settings).size()>0)t.save_fields();else{var n=e.model.get_property_value_by_name(t.get_name());n!=t.get_value()&&e.model.set_property(t.get_name(),t.get_value())}}),Upfront.Events.trigger("entity:settings:saved")},on_cancel:function(){this.trigger("upfront:settings:panel:close",this)},remove:function(){this.settings&&this.settings.each(function(e){e.remove()}),this.$el.off(),Backbone.View.prototype.remove.call(this)}})),dn=Backbone.View.extend({has_tabs:!0,initialize:function(e){this.options=e,this.panels=_([])},get_title:function(){return t.settings},render:function(){var t=this,n=t.for_view.$el.hasClass("upfront-editable_entity")?t.for_view.$el:t.for_view.$el.find(".upfront-editable_entity:first"),r=n.offset(),i=n.outerWidth(),s=r.left+i,o=(n.hasClass("upfront-object")?n.closest(".upfront-module"):n).find("> .upfront-element-controls .upfront-icon-region-settings"),u=o.offset(),a=u.left+o.outerWidth(),f=e(Upfront.Settings.LayoutEditor.Selectors.main),l=f.offset(),c=l.left+f.outerWidth();t.$el.empty().show().html('<div class="upfront-settings_title">'+this.get_title()+"</div>"),Upfront.Events.trigger("settings:prepare"),t.panels.each(function(e){e.render(),t.listenTo(e,"upfront:settings:panel:toggle",t.toggle_panel),t.listenTo(e,"upfront:settings:panel:close",t.close_panel),t.listenTo(e,"upfront:settings:panel:refresh",t.refresh_panel),e.parent_view=t,t.$el.append(e.el)}),this.toggle_panel(this.panels.first());var h=this.panels.first().$el.find(".upfront-settings_label").outerWidth(),p=this.panels.first().$el.find(".upfront-settings_panel").outerWidth();this.has_tabs||(h=0,this.$el.addClass("settings-no-tabs")),this.$el.css({position:"absolute","z-index":1e7}).offset({top:r.top,left:r.left+i-(s+h+p>c?h+p+(s-u.left)+5:0)}).addClass("upfront-ui"),this.trigger("open")},set_title:function(e){if(!e||!e.length)return!1;this.$el.find(".upfront-settings_title").html(e)},toggle_panel:function(e){this.panels.invoke("conceal"),e.$el.find(".upfront-settings_panel").css("height",""),e.show(),e.reveal(),this.set_title(e.get_title());var t=0;this.panels.each(function(e){t+=e.$el.find(".upfront-settings_label").outerHeight()});var n=e.$el.find(".upfront-settings_panel").outerHeight()-1;n>=t?this.$el.css("height",n):(e.$el.find(".upfront-settings_panel").css("height",t),this.$el.css("height",t))},refresh_panel:function(e){e.is_active()&&this.toggle_panel(e)},close_panel:function(e){this.panels.invoke("conceal"),this.panels.invoke("show"),this.set_title(this.get_title())},remove:function(){this.panels&&this.panels.each(function(e){e.remove()}),Backbone.View.prototype.remove.call(this)}}),vn=cn.extend({className:"upfront-settings-padding",initialize:function(n){var r=Upfront.Settings.LayoutEditor.Grid.column_padding,i=this.model instanceof Upfront.Models.ModuleGroup,s=new an({model:this.model,use_breakpoint_property:!0,property:"top_padding_use",label:"",multiple:!1,values:[{label:t.top_padding,value:"yes"}],default_value:this.model.get_breakpoint_property_value("top_padding_use")||!1,change:function(){var e=this.get_value();this.model.set_breakpoint_property("top_padding_use",e?e:0)},show:function(t,n){t==="yes"?(e(o.$el).css("display","inline-block"),e(u.$el).css("display","inline-block")):(e(o.$el).hide(),e(u.$el).hide())}}),o=new Qt({model:this.model,use_breakpoint_property:!0,property:"top_padding_slider",label:"",default_value:this.model.get_breakpoint_property_value("top_padding_slider")||r,min:0,max:200,step:5,valueTextFilter:function(){return""},change:function(){var e=this.get_value();this.model.set_breakpoint_property("top_padding_slider",e),u.get_field().val(e),this.model.set_breakpoint_property("top_padding_num",e,!0)}}),u=new Kt({model:this.model,use_breakpoint_property:!0,property:"top_padding_num",label:"",default_value:this.model.get_breakpoint_property_value("top_padding_num")||r,suffix:t.px,min:0,step:5,change:function(){var e=this.get_value();this.model.set_breakpoint_property("top_padding_num",e),this.model.set_breakpoint_property("top_padding_slider",e,!0),o.$el.find("#"+o.get_field_id()).slider("value",e)}}),a=new an({model:this.model,use_breakpoint_property:!0,property:"bottom_padding_use",label:"",multiple:!1,values:[{label:t.bottom_padding,value:"yes"}],default_value:this.model.get_breakpoint_property_value("bottom_padding_use")||!1,change:function(){var e=this.get_value();this.model.set_breakpoint_property("bottom_padding_use",e?e:0)},show:function(t,n){t==="yes"?(e(f.$el).css("display","inline-block"),e(l.$el).css("display","inline-block")):(e(f.$el).hide(),e(l.$el).hide())}}),f=new Qt({model:this.model,use_breakpoint_property:!0,property:"bottom_padding_slider",label:"",default_value:this.model.get_breakpoint_property_value("bottom_padding_slider")||r,min:0,max:200,step:5,valueTextFilter:function(){return""},change:function(){var e=this.get_value();this.model.set_breakpoint_property("bottom_padding_slider",e),l.get_field().val(e),this.model.set_breakpoint_property("bottom_padding_num",e,!0)}}),l=new Kt({model:this.model,use_breakpoint_property:!0,property:"bottom_padding_num",label:"",default_value:this.model.get_breakpoint_property_value("bottom_padding_num")||r,suffix:t.px,min:0,step:5,change:function(){var e=this.get_value();this.model.set_breakpoint_property("bottom_padding_num",e),this.model.set_breakpoint_property("bottom_padding_slider",e,!0),f.$el.find("#"+f.get_field_id()).slider("value",e)}});if(!i)var c=new an({model:this.model,use_breakpoint_property:!0,property:"left_padding_use",label:"",multiple:!1,values:[{label:t.left_padding,value:"yes"}],default_value:this.model.get_breakpoint_property_value("left_padding_use")||!1,change:function(){var e=this.get_value();this.model.set_breakpoint_property("left_padding_use",e?e:0)},show:function(t,n){t==="yes"?(e(h.$el).css("display","inline-block"),e(p.$el).css("display","inline-block")):(e(h.$el).hide(),e(p.$el).hide())}}),h=new Qt({model:this.model,use_breakpoint_property:!0,property:"left_padding_slider",label:"",default_value:this.model.get_breakpoint_property_value("left_padding_slider")||r,min:0,max:200,step:5,valueTextFilter:function(){return""},change:function(){var e=this.get_value();this.model.set_breakpoint_property("left_padding_slider",e),p.get_field().val(e),this.model.set_breakpoint_property("left_padding_num",e,!0)}}),p=new Kt({model:this.model,use_breakpoint_property:!0,property:"left_padding_num",label:"",default_value:this.model.get_breakpoint_property_value("left_padding_num")||r,suffix:t.px,min:0,step:5,change:function(){var e=this.get_value();this.model.set_breakpoint_property("left_padding_num",e),this.model.set_breakpoint_property("left_padding_slider",e,!0),h.$el.find("#"+h.get_field_id()).slider("value",e)}}),d=new an({model:this.model,use_breakpoint_property:!0,property:"right_padding_use",label:"",multiple:!1,values:[{label:t.right_padding,value:"yes"}],default_value:this.model.get_breakpoint_property_value("right_padding_use")||!1,change:function(){var e=this.get_value();this.model.set_breakpoint_property("right_padding_use",e?e:0)},show:function(t,n){t==="yes"?(e(v.$el).css("display","inline-block"),e(m.$el).css("display","inline-block")):(e(v.$el).hide(),e(m.$el).hide())}}),v=new Qt({model:this.model,use_breakpoint_property:!0,property:"right_padding_slider",label:"",default_value:this.model.get_breakpoint_property_value("right_padding_slider")||r,min:0,max:200,step:5,valueTextFilter:function(){return""},change:function(){var e=this.get_value();this.model.set_breakpoint_property("right_padding_slider",e),m.get_field().val(e),this.model.set_breakpoint_property("right_padding_num",e,!0)}}),m=new Kt({model:this.model,use_breakpoint_property:!0,property:"right_padding_num",label:"",default_value:this.model.get_breakpoint_property_value("right_padding_num")||r,suffix:t.px,min:0,step:5,change:function(){var e=this.get_value();this.model.set_breakpoint_property("right_padding_num",e),this.model.set_breakpoint_property("right_padding_slider",e,!0),v.$el.find("#"+v.get_field_id()).slider("value",e)}});cn.prototype.initialize.call(this,n),i?this.fields=_([s,o,u,a,f,l]):this.fields=_([s,o,u,a,f,l,c,h,p,d,v,m])}}),mn=cn.extend({className:"upfront-settings-css",events:{"click .upfront-css-edit":"openEditor"},initialize:function(e){cn.prototype.initialize.call(this,e);if(!Upfront.Application.cssEditor)return!1;var n=Upfront.Application.cssEditor.getElementType(this.model),r=[{label:t.default_str,value:"_default"}];Upfront.data.styles[n.id]&&_.each(Upfront.data.styles[n.id],function(e){if(e.indexOf("_default")>-1)return;r.push({label:e,value:e})}),this.fields=_([new Upfront.Views.Editor.Field.Button({model:this.model,className:"edit-preset-css-label",compact:!0,label:t.edit_css_label}),new Upfront.Views.Editor.Field.Button({model:this.model,className:"upfront-css-edit",compact:!0,name:"preset_css",label:t.edit_css})])},openEditor:function(e){e.preventDefault(),Upfront.Events.trigger("entity:settings:beforedeactivate"),Upfront.Application.cssEditor.init({model:this.model,stylename:"_default"}),Upfront.Events.trigger("entity:settings:deactivate")}}),gn=Backbone.Model.extend({initialize:function(e){this.set({presets:e})}}),yn=Backbone.Collection.extend({model:gn}),bn=new yn(Upfront.mainData.buttonPresets),wn=function(e){var n,r=function(){var e=_.debounce(i,100);bn.on("add remove edit",e)},i=function(){var e={action:"upfront_update_button_presets",button_presets:bn.toJSON()};Upfront.Util.post(e).error(function(){return tr.addMessage(t.button_presets_save_fail)})};r()},En=new wn,Sn=Backbone.Model.extend({},{parse_variant:function(e){var t;return e==="inherit"?{weight:"inherit",style:"inherit"}:!_.isUndefined(e)&&e.match(/^(\d+) *(normal|italic|oblique)$/)?(t=e.match(/^(\d+) *(normal|italic|oblique)/),{weight:t[1],style:t[2]}):e==="italic"?{weight:"400",style:"italic"}:!_.isUndefined(e)&&e.match(/^\d+$/)?{weight:e,style:"normal"}:{weight:"400",style:"normal"}},get_variant:function(e,t){return e==="inherit"||t==="inherit"?"inherit":(e=this.normalize_weight(e),t===""&&(t="normal"),e==="400"&&t==="normal"?"regular":e==="400"&&t==="italic"?"italic":e+" "+t)},normalize_variant:function(e){var t=this.parse_variant(e);return this.get_variant(t.weight,t.style)},normalize_weight:function(e){return e=="normal"||e==""?400:e=="lighter"?100:e=="bold"?700:e=="bolder"?900:e},get_default_variant:function(e){return"inherit"}}),xn=Backbone.Collection.extend({model:Sn}),Tn=function(){var e=!1;this.get_fonts=function(){if(e)return e;var t=Upfront.Util.post({action:"upfront_list_google_fonts"});return t=t.pipe(function(t){return e=new xn(t.data),e}),t}},Nn=new Tn,Cn=function(){var e=[{family:"Andale Mono",category:"monospace"},{family:"Arial",category:"sans-serif"},{family:"Arial Black",category:"sans-serif"},{family:"Courier New",category:"monospace"},{family:"Georgia",category:"serif"},{family:"Impact",category:"sans-serif"},{family:"Times New Roman",category:"serif"},{family:"Trebuchet MS",category:"sans-serif"},{family:"Verdana",category:"sans-serif"}],t=new xn,n=function(){var n;n=["Inherit","400","400 italic","700","700 italic"],_.each(e,function(e){e.variants=n,t.add(e)})};this.get_fonts=function(){return t},n()},kn=new Cn,gn=Backbone.Model.extend(),yn=Backbone.Collection.extend({model:gn}),bn=new yn(Upfront.mainData.buttonPresets),wn=function(e){var n,r=function(){var e=_.debounce(i,100);bn.on("add remove edit",e)},i=function(){var e={action:"upfront_update_button_presets",button_presets:bn.toJSON()};Upfront.Util.post(e).error(function(){return tr.addMessage(t.button_presets_save_fail)})};r()},En=new wn,Ln=Backbone.Model.extend({initialize:function(e){this.set({displayVariant:Sn.normalize_variant(e.variant)},{silent:!0})}}),An=Backbone.Collection.extend({model:Ln,get_fonts_for_select:function(){var e=[{label:t.choose_font,value:""}],n=[];return _.each(On.models,function(e){n.push(e.get("font").family)}),_.each(_.uniq(n),function(t){e.push({label:t,value:t})}),_.each(Upfront.mainData.additionalFonts,function(t){e.push({label:t.family,value:t.family})}),_.each(kn.get_fonts().models,function(t){e.push({label:t.get("family"),value:t.get("family")})}),e},get_variants:function(e){var t;return _.each(kn.get_fonts().models,function(n){e===n.get("family")&&(t=n.get("variants"))}),t?t:(_.each(Upfront.mainData.additionalFonts,function(n){e===n.family&&(t=["inherit"].concat(n.variants))}),t?t:(t=[],_.each(On.models,function(n){e===n.get("font").family&&t.push(n.get("displayVariant"))}),t.unshift("inherit"),t))},get_variants_for_select:function(e){var t,n=[];return _.each(kn.get_fonts().models,function(t){e===t.get("family")&&_.each(t.get("variants"),function(e){n.push({label:e,value:e})})}),_.each(Upfront.mainData.additionalFonts,function(t){e===t.family&&_.each(t.variants,function(e){n.push({label:e,value:e})})}),_.each(On.models,function(t){if(e===t.get("font").family){var r=t.get("displayVariant");n.push({label:r,value:r})}}),n},get_additional_font:function(e){var t=_.findWhere(Upfront.mainData.additionalFonts,{family:e});if(t)return new Backbone.Model(t);return}}),On=new An(Upfront.mainData.themeFonts),Mn=Backbone.Model.extend({getUploadStatus:function(){if(_.keys(this.get("files")).length===4)return!0;var e="Please upload:";return _.each(["eot","woff","svg","ttf"],function(t){_.isUndefined(this.get("files")[t])&&(e+=" "+t+",")},this),e.substring(0,e.length-1)+" file(s)."}}),_n=Backbone.Collection.extend({model:Mn}),Dn=new _n(Upfront.mainData.iconFonts),Pn=function(e){var n,r=function(){var e=_.debounce(i,100);On.on("add remove",e)},i=function(){var e={action:"upfront_update_theme_fonts",theme_fonts:On.toJSON()};Upfront.Util.post(e).error(function(){return tr.addMessage(t.theme_fonts_save_fail)})};r()},Hn=new Pn,Bn=Backbone.View.extend({className:"theme-font-list-item",events:{click:"on_click","click .delete":"on_delete"},template:e(f.popup).find("#theme-font-list-item").html(),render:function(){return this.$el.html(_.template(this.template,{family:this.model.get("font").family,variant:this.model.get("displayVariant")})),this},on_click:function(){this.$el.siblings().removeClass("theme-font-list-item-selected"),this.$el.addClass("theme-font-list-item-selected"),this.trigger("selected",this.model.toJSON())},on_delete:function(){On.remove(this.model),this.remove()}}),jn=Backbone.View.extend({className:"theme-fonts-panel panel",template:_.template(e(f.popup).find("#theme-fonts-panel").html()),initialize:function(e){this.options=e||{},this.listenTo(this.collection,"add remove",this.update_stats),this.listenTo(this.collection,"add remove",this.render)},render:function(){return this.$el.html(""),this.$el.html(this.template({show_no_styles_notice:this.collection.length===0})),this.collection.length>0&&this.$el.find(".font-list").css("background","white"),_.each(this.collection.models,function(e){this.add_one(e)},this),this.update_stats(),this},update_stats:function(){var e=t.font_styles_selected.replace(/%d/,this.collection.length);this.$el.find(".font-stats").html("<strong>"+e+"</strong>")},add_one:function(e){var t=new Bn({model:e});this.options.parent_view.listenTo(t,"selected",this.options.parent_view.replaceFont),this.$el.find(".font-list").append(t.render().el)}}),Fn=Backbone.View.extend({initialize:function(e){this.options=e||{}},className:function(){var e="font-variant-preview";return this.model.get("already_added")&&(e+=" font-variant-already-added"),e},template:_.template('<span class="font-family">{{family}} — {{name}}</span>{[ if(already_added) { ]} <span class="already-added">'+t.already_added+"</span>{[ } ]}"+'{[ if(heading_preview) { ]}<h1 style="font-family: {{family}}; font-weight: {{weight}}; font-style: {{style}};" class="heading-font-preview font-preview">'+t.header_preview_quote+"</h1>{[ } else { ]}"+'<p style="font-family: {{family}}; font-weight: {{weight}}; font-style: {{style}};" class="paragraph-font-preview font-preview">'+t.body_preview_quote+"</p>{[ } ]}"),events:{click:"on_click"},render:function(){return this.$el.html(this.template(_.extend({heading_preview:this.options.heading_preview},this.model.toJSON()))),this},on_click:function(){if(this.model.get("already_added"))return;this.model.set({selected:!this.model.get("selected")}),this.$el.toggleClass("font-variant-selected")}}),In=Backbone.View.extend({id:"font-variants-preview",initialize:function(e){this.options=e||{}},addOne:function(e){var t=new Fn({model:e,heading_preview:this.options.heading_preview});this.$el.append(t.render().el)},render:function(){return _.each(this.collection.models,function(e){this.addOne(e)},this),this},get_selected:function(){var e=[];return _.each(this.collection.models,function(t){t.get("selected")&&e.push(t.get("variant"))}),e}}),qn=Backbone.View.extend({id:"icon-fonts-manager",className:"clearfix",template:_.template(e(f.popup).find("#icon-fonts-manager-tpl").html()),events:{"click .upload-icon-font":"triggerFileChooser","click .icon-font-upload-status":"triggerFileChooser","click .icon-fonts-list-item":"makeFontActive"},triggerFileChooser:function(){this.$el.find("#upfront-icon-font-input").click()},render:function(){return this.$el.html(this.template({url:Upfront.mainData.ajax,show_no_fonts_notice:!1,fonts:this.collection.models})),_.isUndefined(this.collection.findWhere({active:!0}))&&this.$el.find('[data-family="icomoon"]').addClass("icon-fonts-list-item-active"),this.fileUploadInitialized||(this.fileUploadInitialized=!0,this.initializeFileUpload()),this},initializeFileUpload:function(){if(!jQuery.fn.fileupload)return!1;var e=this;this.$el.find("#upfront-upload-icon-font").fileupload({dataType:"json",done:function(t,n){var r=n.result.data.font,i;_.keys(r.files).length===1?(e.$el.find(".icon-fonts-list").append('<div data-family="'+r.family+'" class="icon-fonts-list-item">'+r.name+"</div>"),e.collection.add(r)):(i=e.collection.findWhere({family:r.family}),i.set({files:r.files}),i.get("active")===!0&&e.updateActiveFontStyle(r.family)),i=e.collection.findWhere({family:r.family});var s=e.$el.find("[data-family="+r.family+"]");s.find(".icon-font-upload-status").remove(),i.getUploadStatus()!==!0&&s.append('<span class="icon-font-upload-status" title="'+i.getUploadStatus()+'">*</span>')}})},makeFontActive:function(t){var n=e(t.currentTarget);n.siblings().removeClass("icon-fonts-list-item-active"),n.addClass("icon-fonts-list-item-active");var r={action:"upfront_update_active_icon_font",family:n.data("family")};Upfront.Util.post(r).error(function(){return tr.addMessage("Could not update active icon font")}),e("#active-icon-font").remove(),_.each(this.collection.models,function(e){e.set({active:!1})});if(n.data("family")==="icomoon")return;this.collection.findWhere({family:n.data("family")}).set({active:!0}),this.updateActiveFontStyle(n.data("family"))},updateActiveFontStyle:function(t){var n=this.collection.findWhere({family:t}),r="";_.each(n.get("files"),function(e,t){r+="url('"+Upfront.mainData.currentThemeUrl+"/icon-fonts/"+e+"') format('";switch(t){case"eot":r+="embedded-opentype";break;case"woff":r+="woff";break;case"ttf":r+="truetype";break;case"svg":r+="svg"}r+="'),"});var i="@font-face {	font-family: '"+n.get("family")+"';";n.get("files").eot&&(i+="src: url('"+Upfront.mainData.currentThemeUrl+"/icon-fonts/"+n.get("files").eot+"');"),i+="	src:"+r.substring(0,r.length-1)+";",i+="	font-weight: normal;	font-style: normal;}.uf_font_icon, .uf_font_icon * {	font-family: '"+n.get("family")+"'!important;"+"}",e("body").append('<style id="active-icon-font">'+i+"</style>")}}),Rn=Backbone.View.extend({id:"text-fonts-manager",className:"clearfix",template:_.template(e(f.popup).find("#text-fonts-manager-tpl").html()),events:{"click .add-font-button":"add_font","click .preview-size-p":"on_p_click","click .preview-size-h1":"on_h1_click"},initialize:function(){this.theme_fonts_panel=new jn({collection:this.collection,parent_view:this}),this.listenTo(this.collection,"remove",this.update_variants_on_remove)},render:function(){var t=this;return this.$el.html(this.template({show_no_styles_notice:this.collection.length===0})),e.when(Nn.get_fonts()).done(function(e){t.load_google_fonts(e)}),this.$el.find(".add-font-panel").after(this.theme_fonts_panel.render().el),Upfront.mainData.userDoneFontsIntro||this.$el.addClass("no-styles"),this.$el.find(".choose-font").after('<div class="preview-type"><span class="preview-type-title">'+Upfront.Settings.l10n.global.behaviors.preview_size+'</span><span class="preview-size-p selected-preview-size">P</span><span class="preview-size-h1">H1</span></div>'),this},on_p_click:function(){this.$el.find(".preview-size-h1").removeClass("selected-preview-size"),this.$el.find(".preview-size-p").addClass("selected-preview-size"),this.heading_preview=!1,this.update_variants()},on_h1_click:function(){this.$el.find(".preview-size-h1").addClass("selected-preview-size"),this.$el.find(".preview-size-p").removeClass("selected-preview-size"),this.heading_preview=!0,this.update_variants()},add_font:function(){var e,n=Nn.get_fonts().findWhere({family:this.font_family_select.get_value()});if(_.isEmpty(n)){alert(t.choose_font_weight);return}e=this.choose_variants.get_selected();if(_.isEmpty(e)){alert(t.choose_one_font_weight);return}_.each(e,function(e){On.add({id:n.get("family")+e,font:n.toJSON(),variant:e})}),this.update_variants()},load_google_fonts:function(n){var r=this.$el.find(".add-font-panel"),i=[{label:t.click_to_pick_google_font,value:""}];_.each(n.pluck("family"),function(e){i.push({label:e,value:e})}),r.find(".loading-fonts").remove(),this.font_family_select=new tn({label:t.typeface,values:i,placeholder:t.choose_font,additional_classes:"choose-font"}),this.font_family_select.render(),r.find(".font-weights-list").before(this.font_family_select.el),e(".upfront-chosen-select",this.$el).chosen({width:"289px"}),this.listenTo(this.font_family_select,"changed",this.update_variants)},update_variants_on_remove:function(){this.update_variants()},update_variants:function(t){this.$el.find(".font-weights-list").css("background","white"),t||(t=Nn.get_fonts().findWhere({family:this.font_family_select.get_value()}));if(!t)return;var n=new Backbone.Collection;_.each(t.get("variants"),function(r){e("#"+t.get("family").toLowerCase()+r+"-css").length===0&&e("head").append('<link rel="stylesheet" id="'+t.get("family").toLowerCase()+"-"+r+'-css" href="//fonts.googleapis.com/css?family='+t.get("family")+"%3A"+r+'" type="text/css" media="all">');var i=Sn.parse_variant(r);n.add({family:t.get("family"),name:Sn.normalize_variant(r),variant:r,already_added:!!On.get(t.get("family")+r),weight:i.weight,style:i.style})}),this.choose_variants&&this.choose_variants.remove(),this.choose_variants=new In({collection:n,heading_preview:this.heading_preview}),this.choose_variants.render(),this.$el.find(".font-weights-list-wrapper").html(this.choose_variants.el)},set_ok_button:function(e){e.on("click",this.on_ok_click)},on_ok_click:function(e){Upfront.Events.trigger("upfront:render_typography_sidebar");if(Upfront.mainData.userDoneFontsIntro)return;Upfront.Util.post({action:"upfront_user_done_font_intro"}),Upfront.mainData.userDoneFontsIntro=!0}}),Un=Backbone.View.extend({initialize:function(){var e=this;this.fields=[new nn({label:"",compact:!0,values:On.get_fonts_for_select(),additional_classes:"choose-typeface",select_width:"230px"}),new rn({label:"",compact:!0,values:[],additional_classes:"choose-variant",select_width:"120px"}),new Vt({label:t.insert_font,compact:!0,on_click:function(){e.finish()}})]},render:function(){return e("#insert-font-widget").html("").addClass("open"),this.$el.html(""),_.each(this.fields,function(e){e.render(),this.$el.append(e.el)},this),this.listenTo(this.fields[0],"changed",function(){var e=On.get_variants(this.fields[0].get_value());this.render_variants(e)}),this.listenTo(this.fields[1],"changed",function(){this.preview_font()}),e(".choose-typeface select",this.$el).chosen({width:"230px",disable_search:!0}),e(".choose-variant select",this.$el).chosen({width:"120px",disable_search:!0}),this},render_variants:function(e){var n=this.$el.find(".choose-variant select");n.find("option").remove(),n.append('<option value="">'+t.choose_variant+"</option>"),_.each(e,function(e){n.append('<option value="'+e+'">'+e+"</option>")}),n.trigger("chosen:updated")},preview_font:function(){this.replaceFont({font_family:this.fields[0].get_value(),variant:Sn.parse_variant(this.fields[1].get_value())})},replaceFont:function(e){var t;this.editor=Upfront.Application.cssEditor.editor,this.style_doc=this.editor.getSession().getDocument(),this.last_selected_font=e,this.font_family_range?this.font_family_range.end=this.end_point:this.font_family_range=this.editor.getSelection().getRange(),this.end_point=this.style_doc.replace(this.font_family_range,e.font_family),this.reset_properties(),t=[],e.variant.weight&&t.push("    font-weight: "+e.variant.weight+";"),e.variant.style&&t.push("    font-style: "+e.variant.style+";"),t.length>0&&this.style_doc.insertLines(this.font_family_range.start.row+1,t)},reset_properties:function(){var e,t,n;this.editor=Upfront.Application.cssEditor.editor,this.style_doc=this.editor.getSession().getDocument(),n={},e=this.font_family_range.start.row+1,t=this.style_doc.getLine(e);while(t.indexOf("}")<0){t.indexOf("font-weight")!==-1&&(n.weight=e,this.starting_weight||(this.starting_weight=t)),t.indexOf("font-style")!==-1&&(n.style=e,this.starting_style||(this.starting_style=t)),e++,t=this.style_doc.getLine(e);if(!t)break}n.weight&&n.style&&(n.weight>n.style?(this.style_doc.removeLines(n.weight,n.weight),this.style_doc.removeLines(n.style,n.style)):(this.style_doc.removeLines(n.style,n.style),this.style_doc.removeLines(n.weight,n.weight)),n.weight=!1,n.style=!1),n.weight&&this.style_doc.removeLines(n.weight,n.weight),n.style&&this.style_doc.removeLines(n.style,n.style)},finish:function(){e("#insert-font-widget").html('<a class="upfront-css-font" href="#">'+t.insert_font+"</a>").removeClass("open")}}),zn=Backbone.View.extend({className:"upfront-ui",id:"upfront-csseditor",tpl:_.template(e(f.popup).find("#csseditor-tpl").html()),prepareAce:!1,ace:!1,events:{"click .upfront-css-save-ok":"save","click .upfront-css-close":"close","click .upfront-css-theme_image":"openThemeImagePicker","click .upfront-css-media_image":"openImagePicker","click .upfront-css-font":"startInsertFontWidget","click .upfront-css-selector":"addSelector","click .upfront-css-type":"scrollToElement","click .upfront-css-delete":"deleteStyle","change .upfront-css-save-name-field":"updateStylename","mouseenter .upfront-css-selector":"hiliteElement","mouseleave .upfront-css-selector":"unhiliteElement","keyup .upfront-css-save-name-field":"checkDeleteToggle"},elementTypes:{UaccordionModel:{label:t.accordion,id:"uaccordion"},UcommentModel:{label:t.comments,id:"ucomment"},UcontactModel:{label:t.contact_form,id:"ucontact"},UgalleryModel:{label:t.gallery,id:"ugallery"},UimageModel:{label:t.image,id:"image"},LoginModel:{label:t.login,id:"upfront-login_element"},LikeBox:{label:t.like_box,id:"Like-box-object"},MapModel:{label:t.map,id:"upfront-map_element"},UnewnavigationModel:{label:t.navigation,id:"unewnavigation"},ButtonModel:{label:t.button,id:"ubutton"},PostsModel:{label:t.posts,id:"uposts"},UsearchModel:{label:t.search,id:"usearch"},USliderModel:{label:t.slider,id:"uslider"},SocialMediaModel:{label:t.social,id:"SocialMedia"},UtabsModel:{label:t.tabs,id:"utabs"},ThisPageModel:{label:t.page,id:"this_page"},ThisPostModel:{label:t.post,id:"this_post"},UwidgetModel:{label:t.widget,id:"uwidget"},UyoutubeModel:{label:t.youtube,id:"uyoutube"},PlainTxtModel:{label:t.text,id:"plain_text"},CodeModel:{label:t.code,id:"upfront-code_element"},Layout:{label:t.body,id:"layout"},GalleryLightbox:{label:t.body,id:"gallery-lightbox"},RegionContainer:{label:t.region,id:"region-container"},Region:{label:t.inner_region,id:"region"},RegionLightbox:{label:t.ltbox_region,id:"region"},ModuleGroup:{label:t.group,id:"module-group"},PostPart_titleModel:{label:t.postpart_title,id:"PostPart_title"},PostPart_contentsModel:{label:t.postpart_content,id:"PostPart_contents"},PostPart_excerptModel:{label:t.postpart_excerpt,id:"PostPart_excerpt"},PostPart_featured_imageModel:{label:t.postpart_featured,id:"PostPart_featured_image"},PostPart_authorModel:{label:t.postpart_author,id:"PostPart_author"},PostPart_author_gravatarModel:{label:t.postpart_author_gravatar,id:"PostPart_author_gravatar"},PostPart_dateModel:{label:t.postpart_date,id:"PostPart_date"},PostPart_updateModel:{label:t.postpart_update,id:"PostPart_update"},PostPart_comments_countModel:{label:t.postpart_comments,id:"PostPart_comments_count"},PostPart_tagsModel:{label:t.postpart_tags,id:"PostPart_tags"},PostPart_categoriesModel:{label:t.postpart_categories,id:"PostPart_categories"}},initialize:function(){e("#"+this.id).length||e("body").append(this.el),Upfront.Events.on("command:region:edit_toggle",this.close,this)},init:function(t){var n=this,r=e.Deferred(),i;this.$style&&this.close(),this.no_render=t.no_render===!0,this.no_stylename_fallback=t.no_stylename_fallback===!0,this.model=t.model,this.sidebar=t.sidebar!==!1,this.toolbar=t.toolbar!==!1,this.readOnly=t.readOnly===!0,this.global=t.global===!0,this.modelType=t.type?t.type:this.model.get_property_value_by_name("type"),this.elementType=this.elementTypes[this.modelType]||{label:"Unknown",id:"unknown"},this.is_global_stylesheet=t.type==="Layout"&&t.element_id==="layout",this.is_global_stylesheet&&(this.sidebar=!0),this.resolve_stylename(t),this.ensure_style_element(),this.selectors=this.elementSelectors[this.modelType]||{},this.element_id=t.element_id?t.element_id:this.model.get_property_value_by_name("element_id"),this.no_render||(this.prepareAce=r.promise(),require([Upfront.Settings.ace_url],function(){r.resolve()}),this.resizeHandler=this.resizeHandler||function(){n.$el.width(e(window).width()-e("#sidebar-ui").width()-1)},e(window).on("resize",this.resizeHandler),typeof t.change=="function"&&this.on("change",t.change),this.render(),Upfront.Events.on("command:undo",function(){setTimeout(function(){var e=Upfront.Util.Transient.pop("css-"+n.element_id);e&&(n.get_style_element().html(e.replace(/#page/g,"div#page.upfront-layout-view .upfront-editable_entity.upfront-module")),n.render())},200)}),this.startResizable(),Upfront.Events.trigger("csseditor:open",this.element_id))},resolve_stylename:function(t){this.stylename="",this.is_global_stylesheet?this.stylename="layout-style":this.stylename=t.stylename;if(this.is_region_style()){var n=_upfront_post_data.layout.specificity||_upfront_post_data.layout.item||_upfront_post_data.layout.type,r=this.model.get("scope")=="global",i=this.elementType.id+"-"+this.model.get("name")+"-style",s=n+"-"+this.model.get("name")+"-style";r?this.stylename=i:(this.stylename=s,_.isArray(Upfront.data.styles[this.elementType.id])&&Upfront.data.styles[this.elementType.id].indexOf(i)!==-1&&Upfront.data.styles[this.elementType.id].indexOf(s)===-1&&!this.no_stylename_fallback&&(this.stylename=i))}this.stylename===""&&(this.stylename=this.get_temp_stylename(),e("#"+this.model.get_property_value_by_name("element_id")).addClass(this.stylename)),this.is_default_style=this.stylename==="_default"},is_region_style:function(){return this.elementType.id==="region-container"||this.elementType.id==="region"},get_style_id:function(){return this.is_default_style?this.elementType.id+"_default":this.stylename},get_css_selector:function(){return this.is_global_stylesheet?"":this.is_region_style()?".upfront-"+this.elementType.id+"-"+this.model.get("name"):this.is_default_style===!1?"#page ."+this.stylename:".upfront-output-"+this.elementType.id},ensure_style_element:function(){var t=this.get_style_element();if(t.length!==0){this.$style=t;return}this.$style=e('<style id="'+this.get_style_id()+'"></style>'),e("body").append(this.$style)},get_style_element:function(){return e("style#"+this.get_style_id())},close:function(t){t&&_.isFunction(t.preventDefault)&&t.preventDefault(),e(window).off("resize",this.resizeHandler),this.off("change"),this.$style=!1,this.editor&&this.editor.destroy(),e("#page").css("padding-bottom",0),this.$el.hide(),Upfront.Events.trigger("csseditor:closed",this.element_id)},render:function(){var t=this;e("#"+this.id).length||e("#page").append(this.$el),this.sidebar?this.$el.removeClass("upfront-css-no-sidebar"):this.$el.addClass("upfront-css-no-sidebar"),this.$el.html(this.tpl({name:this.stylename,elementType:this.elementType.label,selectors:this.selectors,show_style_name:this.is_region_style()===!1&&this.is_global_stylesheet===!1&&this.sidebar!==!0,showToolbar:this.toolbar})),this.resizeHandler(".");var n=this.$el.height()-this.$(".upfront-css-top").outerHeight();this.$(".upfront-css-body").height(n),this.prepareAce.done(function(){t.startAce()}),this.prepareSpectrum(),this.checkDeleteToggle(this.stylename),this.$el.show()},startAce:function(){var t=this,n=ace.edit(this.$(".upfront-css-ace")[0]),r=n.getSession(),i=!1,s,o;r.setUseWorker(!1),n.setShowPrintMargin(!1),n.setReadOnly(this.readOnly),r.setMode("ace/mode/css"),n.setTheme("ace/theme/monokai"),n.on("change",function(r){t.timer&&clearTimeout(t.timer),t.timer=setTimeout(function(){t.updateStyles(n.getValue())},800),t.trigger("change",n);if(typeof t.editor!="undefined"){var s=e(t.editor.container).get(0).scrollWidth,o=e(t.editor.container).find(".ace_content").innerWidth();s<o+40?(i||t.startResizable(),i=!0):i=!1}}),o=Upfront.Util.colors.convert_string_color_to_ufc(this.get_style_element().html().replace(/div#page.upfront-layout-view .upfront-editable_entity.upfront-module/g,"#page")),this.is_global_stylesheet===!1&&(s=new RegExp(this.get_css_selector()+"\\s*","g"),o=o.replace(s,"")),n.setValue(e.trim(o),-1),n.renderer.scrollBar.width=5,n.renderer.scroller.style.right="5px",n.focus(),this.editor=n,t.timer&&clearTimeout(t.timer),t.timer=setTimeout(function(){t.startResizable()},300)},prepareSpectrum:function(){var e=this,t=new Yt({default_value:"#ffffff",showAlpha:!0,showPalette:!0,maxSelectionSize:9,localStorageKey:"spectrum.recent_bgs",preferredFormat:"hex",chooseText:Upfront.Settings.l10n.global.content.ok,showInput:!0,allowEmpty:!0,autohide:!1,spectrum:{show:function(){},choose:function(t){if(t.get_is_theme_color()!==!1)n=t.theme_color;else var n=t.alpha<1?t.toRgbString():t.toHexString();e.editor.insert(n),e.editor.focus()}}});t.render(),e.$(".upfront-css-color").html(t.el)},startResizable:function(){var t=this,n=t.$(".upfront-css-body"),r=0,i=t.$(".upfront-css-selectors"),s=t.$(".upfront-css-save-form"),o=this.$(".upfront-css-resizable"),u=function(u,a){var f=a?a.size.height:t.$(".upfront-css-resizable").height(),l=f-r;n.height(l),t.editor&&t.editor.resize(),i.outerHeight(l-s.outerHeight()),o.css({width:"",height:"",left:"",top:""}),e("#page").css("padding-bottom",f)};o.find(".upfront-css-top").removeClass("ui-resizable-handle").addClass("ui-resizable-handle").removeClass("ui-resizable-n").addClass("ui-resizable-n"),r=t.$(".upfront-css-top").outerHeight(),u(),o.resizable({handles:{n:".upfront-css-top"},resize:u,minHeight:200,delay:100})},scrollToElement:function(){var t=e("#"+this.element_id);if(!t.length)return;var n=t.offset().top-50;e(document).scrollTop(n>0?n:0),this.blink(t,4)},blink:function(e,t){var n=this;e.css("outline","3px solid #3ea"),setTimeout(function(){e.css("outline","none"),t--,t>0&&setTimeout(function(){n.blink(e,t-1)},100)},100)},hiliteElement:function(t){var n=e(t.target).data("selector");if(!n.length)return;var r=this.is_region_style()===!1?e("#"+this.element_id).parent():e("#"+this.element_id);r.find(n).addClass("upfront-css-hilite")},unhiliteElement:function(t){var n=e(t.target).data("selector");if(!n.length)return;var r=this.is_region_style()===!1?e("#"+this.element_id).parent():e("#"+this.element_id);r.find(n).removeClass("upfront-css-hilite")},remove:function(){Backbone.View.prototype.remove.call(this),e(window).off("resize",this.resizeHandler)},updateStyles:function(e){var t=this.get_style_element();Upfront.Util.Transient.push("css-"+this.element_id,t.html()),e=Upfront.Util.colors.convert_string_ufc_to_color(e),t.html(this.stylesAddSelector(e,this.is_default_style?"":this.get_css_selector()).replace(/#page/g,"div#page.upfront-layout-view .upfront-editable_entity.upfront-module")),this.trigger("updateStyles",this.element_id)},stylesAddSelector:function(t,n){if(this.is_global_stylesheet&&empty(n))return t;var r=this,i=t.split("}"),s="";return _.each(i,function(t){var i=e.trim(t).split("{");if(i.length!=2)return!0;var o=i[0].split(","),u=[];_.each(o,function(t){t=e.trim(t);var i=t.replace(/:[^\s]+/,""),s=i[0]==="@"||r.recursiveExistence(n,i),o=s?"":" ";u.push(""+n+o+t+"")}),s+=u.join(", ")+" {"+i[1]+"\n}\n"}),s},recursiveExistence:function(t,n){var r=n.split(" "),i=this;while(r.length>0){try{if(!!e(t+r.join(" ")).closest("#"+i.element_id).length)return!0}catch(s){}r.pop()}return!1},updateStylename:function(){var n=e.trim(this.$(".upfront-css-save-name-field").val()),r=this.stylename;n=n.replace(/\s/g,"-").replace(/[^A-Za-z0-9_-]/gi,"").replace(/-+/g,"-").toLowerCase();if(r==="_default"){this.$(".upfront-css-save-name-field").val("_default"),Upfront.Views.Editor.notify(t.default_style_name_nag,"error");return}e("#"+this.model.get_property_value_by_name("element_id")).removeClass(this.stylename),e("#"+this.model.get_property_value_by_name("element_id")).addClass(n),this.get_style_element().attr("id",n),this.stylename=n,this.get_style_element().html(this.get_style_element().html().replace(new RegExp(r,"g"),n)),this.model.set_breakpoint_property("theme_style",n);if(r===this.get_temp_stylename)return;this.save()},get_temp_stylename:function(){return this.modelType.toLowerCase().replace("model","")+"-new-style"},save:function(n){n&&n.preventDefault();var r=this,i=e.trim(this.editor.getValue()),s;if(this.is_global_stylesheet===!1&&this.stylename===this.get_temp_stylename())return tr.addMessage(t.style_name_nag,"error");i=this.stylesAddSelector(i,this.is_default_style?"":this.get_css_selector()),s={styles:i,elementType:this.elementType.id,global:this.global};if(Upfront.Application.is_builder()){s.stylename=this.get_style_id();if(this.is_global_stylesheet){var o=Upfront.Application.current_subapplication.layout.get("properties"),u=o&&o.findWhere?o.findWhere({name:"layout_style"}):!1;u&&u.set?u.set({value:i}):o.add({name:"layout_style",value:i})}Upfront.Behaviors.LayoutEditor.export_element_styles(s);return}s.name=this.get_style_id(),s.action="upfront_save_styles",Upfront.Util.post(s).success(function(e){var n=e.data,i=r.elementType.id;return Upfront.data.styles[i]||(Upfront.data.styles[i]=[]),Upfront.data.styles[i].indexOf(r.get_style_id())===-1&&Upfront.data.styles[i].push(r.get_style_id()),Upfront.Events.trigger("upfront:themestyle:saved",r.get_style_id()),r.checkDeleteToggle(n.name),tr.addMessage(t.style_saved_as.replace(/%s/,r.get_style_id()))}).error(function(e){return tr.addMessage(t.there_was_an_error)})},saveCall:function(n){var r=this,i=e.trim(this.get_style_element().html()),s;s={styles:i,elementType:this.elementType.id,global:this.global};if(Upfront.Application.is_builder()){s.stylename=this.get_style_id(),Upfront.Behaviors.LayoutEditor.export_element_styles(s);return}s.name=this.get_style_id(),s.action="upfront_save_styles",Upfront.Util.post(s).success(function(e){var i=e.data,s=r.elementType.id;return Upfront.data.styles[s]||(Upfront.data.styles[s]=[]),Upfront.data.styles[s].indexOf(r.get_style_id())===-1&&Upfront.data.styles[s].push(r.get_style_id()),Upfront.Events.trigger("upfront:themestyle:saved",r.get_style_id()),n?tr.addMessage(t.style_saved_as.replace(/%s/,r.get_style_id())):!0}).error(function(e){return n?tr.addMessage(t.there_was_an_error):!0})},checkDeleteToggle:function(n){if(_.isUndefined(n))return;this.deleteToggle||(this.deleteToggle=e('<a href="#" class="upfront-css-delete">'+t.delete_style+"</a>"));var r=_.isString(n)?n:n.target.value,i=this.elementType.id,s=Upfront.data.styles[i],o=s&&s.indexOf(i+"-"+r)!=-1,u=this.deleteToggle.parent().length;o&&!u?this.$(".upfront-css-save-form").append(this.deleteToggle):!o&&u&&this.deleteToggle.detach()},deleteStyle:function(n){n.preventDefault();var r=this,i=this.elementType.id,s=i+"-"+this.$(".upfront-css-save-name-field").val();if(!confirm(t.delete_stylename_nag.replace(/%s/,s)))return;var o={elementType:i,styleName:s,action:"upfront_delete_styles"};Upfront.Util.post(o).done(function(){var n=Upfront.data.styles[i].indexOf(s);tr.addMessage(t.stylename_deleted.replace(/%s/,s)),r.$(".upfront-css-save-name-field").val(""),r.editor.setValue(""),n!=-1&&Upfront.data.styles[i].splice(n,1),e("#upfront-style-"+s).remove(),r.model.get_property_value_by_name("theme_style")==s&&r.model.set_property("theme_style",""),r.deleteToggle.detach()})},fetchThemeStyles:function(t){var n={action:"upfront_theme_styles",separately:t},r=e.Deferred();return Upfront.Util.post(n).success(function(e){r.resolve(e.data.styles)}),r.promise()},createSelectors:function(e){var t=this,n={};_.each(e,function(e){n[e.cssSelectorsId]=e.cssSelectors||{}}),t.elementSelectors=n},createSelector:function(e,t,n){var r=new e,i=new t({model:r});this.elementSelectors[n]=i.cssSelectors||{},i.remove()},openThemeImagePicker:function(){this._open_media_popup({themeImages:!0})},openImagePicker:function(){this._open_media_popup()},_open_media_popup:function(e){e=_.isObject(e)?e:{};var t=this,n=_.extend({},e);Upfront.Media.Manager.open(n).done(function(e,n){Upfront.Events.trigger("upfront:element:edit:stop");if(!n)return;if(n.length==0)return;var r=n.models[0],i=r.get("image")?r.get("image"):n.models[0],s="src"in i?i.src:"get"in i?i.get("original_url"):!1;t.editor.insert('url("'+s+'")'),t.editor.focus()})},startInsertFontWidget:function(){var t=new Un({collection:On});e("#insert-font-widget").html(t.render().el)},getElementType:function(e){var t=e.get_property_value_by_name("type"),n=this.elementTypes[t];return n||t},addSelector:function(t){var n=e(t.target).data("selector");_.isUndefined(this.editor)||(this.editor.insert(n),this.editor.focus())}}),Wn=Backbone.View.extend({className:"upfront-ui",id:"upfront-general-csseditor",tpl:_.template(e(f.popup).find("#csseditor-tpl").html()),prepareAce:!1,ace:!1,events:{"click .upfront-css-save-ok":"fire_save","click .upfront-css-close":"close","click .upfront-css-image":"openImagePicker","click .upfront-css-selector":"addSelector"},initialize:function(t){var n=this,r=e.Deferred(),i,s;this.options=t||{},this.model=t.model,this.sidebar=t.sidebar!==!1,this.global=t.global===!0,this.toolbar=t.toolbar!==!1,this.prepareAce=r.promise(),require([Upfront.Settings.ace_url],function(){r.resolve()}),this.resizeHandler=this.resizeHandler||function(){n.$el.width(e(window).width()-e("#sidebar-ui").width()-1)},e(window).on("resize",this.resizeHandler),i=this.model.get("id")+"-breakpoint-style",s=e("#"+i),s.length===0?(this.$style=e('<style id="'+i+'"></style>'),e("body").append(this.$style)):this.$style=s,t.cssSelectors&&(this.selectors=t.cssSelectors),typeof t.change=="function"&&this.listenTo(this,"change",t.change),typeof t.onClose=="function"&&this.listenTo(this,"close",t.onClose),this.render(),this.startResizable()},close:function(t){t&&t.preventDefault(),e(window).off("resize",this.resizeHandler),this.editor&&this.editor.destroy(),e("#page").css("padding-bottom",0),this.remove()},render:function(){var t=this;e("#page").append(this.$el),this.sidebar?this.$el.removeClass("upfront-css-no-sidebar"):this.$el.addClass("upfront-css-no-sidebar"),this.$el.html(this.tpl({selectors:this.selectors,elementType:!1,show_style_name:!1,showToolbar:this.toolbar})),this.resizeHandler(".");var n=this.$el.height()-this.$(".upfront-css-top").outerHeight();this.$(".upfront-css-body").height(n),this.prepareAce.done(function(){t.startAce()}),this.prepareSpectrum(),this.$el.show()},startAce:function(){var t=this,n=ace.edit(this.$(".upfront-css-ace")[0]),r=n.getSession();r.setUseWorker(!1),n.setShowPrintMargin(!1),r.setMode("ace/mode/css"),n.setTheme("ace/theme/monokai"),n.on("change",function(r){var i,s=n.getValue().split("}"),o="\n\n."+t.options.page_class+" ";s=_.map(s,function(t){return e.trim(t)}),s.pop(),i=s.length?o+s.join("\n}"+o)+"\n}":"",t.$style.html(i),t.trigger("change",i)});var i=new RegExp("."+this.options.page_class+"s*","g"),s=this.model.get("styles")?this.model.get("styles").replace(i,""):"",i=new RegExp("."+this.options.page_class+"s*","g"),s;this.options.type==="GalleryLightbox"?s=this.model.get("properties").get("styles").get("value").replace(i,""):s=this.model.get("styles")?this.model.get("styles").replace(i,""):"",n.setValue(e.trim(s),-1),n.renderer.scrollBar.width=5,n.renderer.scroller.style.right="5px",n.focus(),this.editor=n},prepareSpectrum:function(){var n=this;n.$(".upfront-css-color").spectrum({showAlpha:!0,showPalette:!0,palette:bt.colors.pluck("color").length?bt.colors.pluck("color"):["fff","000","0f0"],maxSelectionSize:9,localStorageKey:"spectrum.recent_bgs",preferredFormat:"hex",chooseText:t.ok,showInput:!0,allowEmpty:!0,show:function(){spectrum=e(".sp-container:visible")},change:function(e){var t=e.alpha<1?e.toRgbString():e.toHexString();n.editor.insert(t),n.editor.focus()},move:function(e){var t=e.toRgbString();spectrum.find(".sp-dragger").css("border-top-color",t),spectrum.parent().find(".sp-dragger").css("border-right-color",t)}})},startResizable:function(){var t=this,n=t.$(".upfront-css-body"),r=t.$(".upfront-css-top").outerHeight(),i=t.$(".upfront-css-selectors"),s=t.$(".upfront-css-save-form"),o=function(o,u){var a=u?u.size.height:t.$(".upfront-css-resizable").height(),f=a-r;n.height(f),t.editor&&t.editor.resize(),i.height(f-s.outerHeight()),e("#page").css("padding-bottom",a)};o(),this.$(".upfront-css-resizable").resizable({handles:{n:".upfront-css-top"},resize:o,minHeight:200,delay:100})},remove:function(){this.trigger("close"),Backbone.View.prototype.remove.call(this),e(window).off("resize",this.resizeHandler)},openImagePicker:function(){var e=this;Upfront.Media.Manager.open({}).done(function(t,n){Upfront.Events.trigger("upfront:element:edit:stop");if(!n)return;var r=n.models[0].get("image").src;e.editor.insert('url("'+r+'")'),e.editor.focus()})},addSelector:function(t){var n=e(t.target).data("selector");this.editor.insert(n),this.editor.focus()}}),Xn=zt.extend({className:"upfront-field-complex_field-boolean_toggleable_text upfront-field-multiple",tpl:'<input type="checkbox" class = "upfront-field-checkbox" /> <label><span class="upfront-field-label-text">{{element_label}}</span></label> <div class="upfront-embedded_toggleable" style="display:none">{{field}}<div class="upfront-embedded_toggleable-notice">'+t.anchor_nag+"</div></div>",initialize:function(e){zt.prototype.initialize.call(this,e),this.options.field=new Wt(this.options)},render:function(){var e=this;this.$el.empty(),this.$el.append(this.get_field_html()),this.$el.on("click",":checkbox",function(t){t.stopPropagation(),e.field_toggle.apply(e)}),this.model.get_property_value_by_name(this.options.field.get_name())&&(this.$el.find(":checkbox").attr("checked",!0),this.check_value(),this.field_toggle()),this.$el.on("keyup",'[name="'+this.options.field.get_name()+'"]',function(t){t.stopPropagation(),e.check_value.apply(e)}),setTimeout(function(){e.trigger("anchor:updated")},50)},field_toggle:function(){this.$el.find(":checkbox").is(":checked")?this.$el.find(".upfront-embedded_toggleable").show():this.$el.find(".upfront-embedded_toggleable").hide(),this.property.set({value:this.get_value()}),this.trigger("anchor:updated")},check_value:function(){var e=this.$el.find('[name="'+this.options.field.get_name()+'"]'),t=this.$el.find(".upfront-embedded_toggleable"),n=e.length&&e.val?e.val():"";t.removeClass("error").removeClass("ok"),n.length&&!n.match(/^[a-zA-Z]+$/)?t.addClass("error"):n.length&&t.addClass("ok"),this.property.set({value:this.get_value()})},get_field_html:function(){this.options.field.render();var e=this.options.field.$el;return _.template(this.tpl,_.extend({},this.options,{field:e.html()}))},get_value:function(){var e={},t=this.$el.find(":checkbox"),n=this.$el.find('[name="'+this.options.field.get_name()+'"]'),r=n.val().replace(/[^a-zA-Z]/g,"");return t.is(":checked")&&r?r:""}}),Vn=cn.extend({className:"upfront-settings-item-anchor",initialize:function(e){this.options=e,cn.prototype.initialize.call(this,this.options);var n=new Xn({element_label:t.make_element_anchor,className:"upfront-field-complex_field-boolean_toggleable_text upfront-field-multiple checkbox-title",model:this.model,property:"anchor"});n.on("anchor:updated",function(){this.trigger("anchor:item:updated")},this),this.fields=_([n])},save_fields:function(){this.fields.invoke("check_value"),cn.prototype.save_fields.call(this)}}),$n=cn.extend({initialize:function(e){this.options=e;var t=this.get_lightboxes();this.options.fields=_([new en({model:this.model,property:"lightbox_target",values:t})]),cn.prototype.initialize.call(this,this.options)},get_lightboxes:function(){var e=Upfront.Application.layout.get("regions"),t=[""];return _.each(e.models,function(e){e.attributes.sub=="lightbox"&&t.push({label:e.attributes.title,value:e.attributes.name})}),t},get_values:function(){return this.fields._wrapped[0].get_value()}}),Jn=$n.extend({initialize:function(e){this.options=e,$n.prototype.initialize.call(this,this.options),this.options.fields.push(new Wt({model:this.model,property:"lightbox_label",label:t.label}))},get_values:function(){return{anchor:this.fields._wrapped[0].get_value(),label:this.fields._wrapped[1].get_value()}}}),Kn=cn.extend({initialize:function(e){this.options=e;var t=[],n=this.get_anchors();_(n).each(function(e){t.push({label:e,value:e})}),this.options.fields=_([new en({model:this.model,property:"anchor_target",values:t})]),cn.prototype.initialize.call(this,this.options)},get_anchors:function(){var e=Upfront.Application.layout.get("regions"),t=[""];return e.each(function(e){e.get("modules").each(function(e){e.get("objects").each(function(e){var n=e.get_property_value_by_name("anchor");n&&n.length&&t.push(n)})})}),t},get_values:function(){return this.fields._wrapped[0].get_value()}}),Qn=Kn.extend({initialize:function(e){this.options=e,Kn.prototype.initialize.call(this,this.options),this.options.fields.push(new Wt({model:this.model,property:"anchor_label",label:t.label}))},get_values:function(){return{anchor:this.fields._wrapped[0].get_value(),label:this.fields._wrapped[1].get_value()}}}),Gn=en.extend({initialize:function(e){en.prototype.initialize.call(this,e),this.options.values=this.get_anchors()},get_anchors:function(){var e=Kn.prototype.get_anchors.call(this),t=[];return _(e).each(function(e){t.push({label:e,value:e})}),t}}),Yn=Backbone.View.extend({tagName:"li",events:{"change input":"on_change"},className:function(){var e="upfront-field-select-option";return this.model.get("default")&&(e+=" upfront-field-select-option-disabled"),this.model.get("enabled")&&(e+=" upfront-field-select-option-selected"),e},template:'<label><span class="upfront-field-label-text">{{ name }} {[ if (width > 0) { ]}({{width}}px){[ } ]}</span></label><input type="checkbox" class="upfront-field-checkbox" value="{{ id }}" {[ if (is_default) { ]} disabled="disabled"{[ } ]}{[ if (enabled) { ]} checked="checked"{[ } ]}>',initilize:function(e){this.options=e||{},this.listenTo(this.model,"change",this.render)},on_change:function(e){this.model.set({enabled:this.$el.find("input").is(":checked")})},render:function(){var e=this.model.toJSON();return e.is_default=e.default,this.$el.append(_.template(this.template,e)),this}}),Zn=en.extend({className:"upfront-field-select upfront-no-select upfront-field-compact-label-select",template:'<ul class="upfront-field-select-options"><li class="upfront-field-select-option"><label><span class="upfront-field-label-text">{{ label_text }}</span></label></li></ul></div>',initialize:function(e){this.options=e||{},this.listenTo(this.collection,"add remove change:name change:width",this.render)},render:function(){var e=this;this.$el.html(""),this.$el.append(_.template(this.template,this.options)),this.$el.addClass(" upfront-field-select-"+(this.options.multiple?"multiple":"single")),this.options.disabled&&this.$el.addClass("upfront-field-select-disabled"),this.options.style=="zebra"&&this.$el.addClass("upfront-field-select-zebra"),_.each(this.collection.models,function(e){var t=new Yn({model:e});t.render(),this.$el.find("ul").append(t.el)},this)},onOptionClick:function(e){this.$el.toggleClass("compact-label-select-open"),en.prototype.onOptionClick.call(this,e)}}),er=Backbone.View.extend({notices:new Backbone.Collection([]),elId:"upfront-notice",timer:!1,timeoutTime:5e3,$notice:!1,tpl:_.template(e(f.popup).find("#upfront-notifier-tpl").html()),initialize:function(t){this.notices.on("add",this.messageAdded,this),this.notices.on("remove",this.messageRemoved,this),e("body").append(this.tpl({})),this.setElement(e("#"+this.elId))},addMessage:function(e,n,r){var i={message:e?e:t.no_message,type:n?n:"info",duration:r};this.notices.add(i)},show:function(e){var t=this;this.setMessage(e),this.$el.addClass("notify open").removeClass("out"),this.timer=setTimeout(function(){t.notices.remove(e)},e.get("duration")||this.timeoutTime)},replace:function(e){var t=this;this.setMessage(e),this.timer=setTimeout(function(){t.notices.remove(e)},this.timeoutTime),this.$el.removeClass("notify").addClass("shake"),setTimeout(function(){t.$el.removeClass("shake")},this.timeoutTime/2)},setMessage:function(e){this.$el.removeClass("info warning error").addClass(e.get("type")).html(e.get("message"))},close:function(){this.$el.addClass("out"),this.$el.removeClass("notify shake open")},messageAdded:function(e){this.$el.hasClass("notify")||this.show(e)},messageRemoved:function(e){this.notices.length?this.replace(this.notices.at(0)):this.close()}}),tr=new er,nr=Ft.extend({className:"upfront-selector-navigation",handle_pagination_request:function(t,n){var r=this,i=this.collection.pagination,n=n?n:parseInt(e(t.target).attr("data-page_idx"),10)||0;this.options.pageSelection(n)}}),rr=Backbone.View.extend({postTypeTpl:_.template(e(f.popup).find("#selector-post_type-tpl").html()),postListTpl:_.template(e(f.popup).find("#selector-post-tpl").html()),postType:"post",posts:[],pagination:!1,selected:!1,deferred:!1,popup:!1,defaultOptions:{title:t.select_content_to_link,postTypes:[{name:"post",label:t.posts},{name:"page",label:t.pages}]},events:{"click .upfront-field-select-value":"openTypesSelector","click .upfront-field-select-option":"selectType","click .upfront-selector-post":"selectPost","click .use":"postOk","click #upfront-search_action":"search","keyup .search_container>input":"inputSearch"},initialize:function(){("post_types"in Upfront.mainData.content_settings?Upfront.mainData.content_settings:{post_types:[]}).post_types.length&&(this.defaultOptions.postTypes=Upfront.mainData.content_settings.post_types)},open:function(n){var r=this;return bindEvents=!1,n=_.extend({},this.defaultOptions,n),!e("#upfront-popup").length&&this.$el.attr("id")!="upfront-popup"&&(bindEvents=!0),this.popup=Upfront.Popup.open(function(){}),this.deferred=e.Deferred(),this.posts=new Upfront.Collections.PostList([],{postType:"page"}),this.posts.pagination.pageSize=20,this.pagination=new nr({collection:this.posts,pageSelection:function(e){r.fetch({page:e})}}),this.setElement(e("#upfront-popup")),this.$("#upfront-popup-top").html('<h3 class="upfront-selector-title">'+n.title+"</h3>"),this.$("#upfront-popup-content").html(this.postTypeTpl(n)),this.fetch({}),this.$("#upfront-popup-bottom").html('<div class="use_selection_container inactive"><a href="#use" class="use">'+Upfront.Settings.l10n.global.content.ok+'</a></div><div class="search_container clearfix"><input type="text" placeholder="'+t.search+'" value=""><div class="search upfront-icon upfront-icon-popup-search" id="upfront-search_action"></div></div>').append(this.pagination.$el),e("#upfront-popup").addClass("upfront-postselector-popup"),this.$(".upfront-field-select-value").text(t.pages),this.deferred.promise()},openTypesSelector:function(){var e=this.$(".upfront-field-select");e.hasClass("open")?e.removeClass("open"):e.addClass("open")},selectType:function(t){var n=e(t.target).attr("rel");n!=this.posts.postType&&(this.$(".upfront-field-select-value").text(e(t.target).text()),this.$(".upfront-field-select").removeClass("open"),this.fetch({postType:n}))},selectPost:function(t){var n=e(t.currentTarget);this.$(".upfront-selector-post.selected").removeClass("selected"),this.selected=e(t.currentTarget).addClass("selected").attr("rel"),this.$(".use_selection_container").removeClass("inactive")},postOk:function(e){e.preventDefault();if(!this.selected)return;return Upfront.Popup.close(),this.deferred.resolve(this.posts.get(this.selected))},fetch:function(e){var n=this,r=new Upfront.Views.Editor.Loading({loading:t.loading,done:t.thank_you_for_waiting,fixed:!1});this.$(".use_selection_container").addClass("inactive"),this.selected=!1,r.render(),this.$("#upfront-selector-posts").append(r.$el),e.postType&&e.postType!=this.posts.postType&&(e.flush=!0,this.posts.postType=e.postType);var i=e.page;i||(i=0),this.posts.fetchPage(i,e).done(function(e){r.done(),n.$("#upfront-selector-posts").find("table").remove(),n.$("#upfront-selector-posts").append(n.postListTpl({posts:n.posts.getPage(i)})),n.pagination.render()})},search:function(e){e.preventDefault();var t=this.$(".search_container input").val();t?this.fetch({search:t,flush:!0}):this.$(".search_container input").focus()},inputSearch:function(e){e.which==13&&this.search(e)}}),ir=Backbone.View.extend({className:"upfront-loading",is_done:!1,done_callback:[],done_timeout:!1,initialize:function(e){this.options=e},render:function(){var e=this;this.$el.html('<div class="upfront-loading-ani" />'),this.options.fixed&&this.$el.addClass("upfront-loading-fixed"),this.options.loading_type&&this.$el.addClass(this.options.loading_type),this.options.loading&&this.$el.append('<p class="upfront-loading-text">'+this.options.loading+"</p>"),this.options.loading_notice&&this.$el.append('<p class="upfront-loading-notice">'+this.options.loading_notice+"</p>"),this.$el.find(".upfront-loading-ani").on("animationend webkitAnimationEnd MSAnimationEnd oAnimationEnd",function(){var t=e.$el.hasClass("upfront-loading-repeat")?"repeat":e.$el.hasClass("upfront-loading-done")?"done":"start";if(t=="start")if(e.is_done){var n=e.done_text||e.options.done;e.$el.addClass("upfront-loading-done"),e.$el.find(".upfront-loading-text").text(n)}else e.$el.addClass("upfront-loading-repeat");else t=="repeat"?e.$el.removeClass("upfront-loading-repeat"):t=="done"&&(e.remove(),clearTimeout(e.done_timeout),e.done_callback&&_(e.done_callback).each(function(t){t&&t.call&&t.call(e)}))})},update_loading_text:function(e){this.$el.find(".upfront-loading-text").text(e)},on_finish:function(e){this.done_callback.push(e)},done:function(e,t){var n=this,r=n.options.timeout||6e3;this.is_done=!0,this.done_timeout=setTimeout(function(){n&&(n.remove(),_(n.done_callback).each(function(e){e&&e.call&&e.call(n)}))},r),e&&e.call(n),this.done_text=t},cancel:function(e,t){this.remove(),e&&e()}}),sr=Backbone.View.extend({attributes:function(){return{"class":"upfront-inline-modal upfront-ui upfront-no-select",id:"upfront-inline-modal-"+this.cid}},initialize:function(e){this.options=e,this.$to=e.to,this.button_text=e.button_text?e.button_text:Upfront.Settings.l10n.global.content.ok,this.button=typeof e.button!="undefined"?e.button:!0,this.width=typeof e.width!="undefined"?e.width:"50%",this.top=typeof e.top!="undefined"?e.top:-1,this.left=typeof e.left!="undefined"?e.left:-1,this.right=typeof e.right!="undefined"?e.right:-1,this.keep_position=typeof e.keep_position!="undefined"?e.keep_position:!0},events:{click:"on_click","click .upfront-inline-modal-content":"on_click_content","click .upfront-inline-modal-save":"on_click_save"},render:function(){this.$el.html('<div class="upfront-inline-modal-wrap"><div class="upfront-inline-modal-content"></div></div>'),this.$el.hide()},open:function(t,n,r){var i=this,s=this.$el.find(".upfront-inline-modal-wrap"),o=this.$el.find(".upfront-inline-modal-content"),u=e('<button type="button" class="upfront-inline-modal-save">'+this.button_text+"</button>"),a={},f,l,c=n&&n.for_view&&n.for_view.$el.hasClass("upfront-region-side-lightbox");return this._deferred=e.Deferred(),this.$el.show(),t.apply(n,[o,this.$el]),r=typeof r!="undefined"?r:this.button,r&&u.appendTo(o),a.width=this.width,!c&&this.top>=0?(a.top=this.top,a.bottom="auto"):(l=this.$el.height()>e(window).height()?e(window).height():this.$el.height(),f=o.outerHeight(),this.top=l-f>0?(l-f)/2:0,c&&(this.top=22),a.top=this.top,a.bottom="auto"),this.left>=0?(a.left=this.left,a.right="auto"):this.right>=0&&(a.left="auto",a.width>0&&this.right+a.width<=e(window).width()&&(a.right=this.right)),s.css(a),this.keep_position&&(this.update_pos(),e(window).on("scroll",this,this.on_scroll)),this.trigger("modal:open"),this._deferred.promise()},close:function(t){this.$el.hide(),e(window).off("scroll",this.on_scroll),this.trigger("modal:close");if(!this._deferred)return;t?this._deferred.resolve(this):this._deferred.reject(this)},on_scroll:function(e){var t=e.data;t.update_pos()},on_click:function(){this.close(!1)},on_click_content:function(e){e.stopPropagation()},on_click_save:function(){this.close(!0)},update_pos:function(){var t=e(Upfront.Settings.LayoutEditor.Selectors.main);if(this.$el.css("display")=="none")return;var n=this.$el.find(".upfront-inline-modal-wrap"),r=this.$to.offset(),i=r.top,s=i+this.$to.outerHeight(),o=e(window).height(),u=e(document).scrollTop(),a=u+o,f=t.offset().top,l=50,c=this.$el.offset(),h=c.left+this.$el.width(),p=this.$el.find(".upfront-inline-modal-wrap").outerHeight(),d=i+p;u>=i-f?this.$el.css("position")!="fixed"&&(this.$el.css({position:"fixed",top:0,bottom:0,left:c.left,right:e(window).width()-h}),n.css({top:f+this.top})):(s>d?s:d)+l>a?this.$el.css("position")!="fixed"&&(this.$el.css({position:"fixed",top:0,bottom:0,left:c.left,right:e(window).width()-h}),n.css({top:(s>d?o-(s-i>o?o:s-i)-l:o-p-l)+this.top})):(this.$el.css({position:"",top:"",bottom:"",left:"",right:""}),n.css({top:this.top}))}}),or=sr.extend({open:function(){return this.constructor.__super__.open.call(this,this.render_modal,this,!0)},render_modal:function(n,r){var i=this,s=Upfront.Settings.LayoutEditor.Grid,o=Upfront.Settings.LayoutEditor.CurrentBreakpoint,u=o&&!o.default,a=this.model instanceof Upfront.Models.Layout,l=this.model instanceof Upfront.Models.Region,c=l&&this.model.is_main()?!1:this.model.get("sub"),h=this.model.get_breakpoint_property_value("background_image",!0),p=e(f.region_edit_panel),d=_.template(p.find("#upfront-region-bg-setting").html()),v=d(),m=[{label:t.solid_color,value:"color",icon:"color"},{label:t.image,value:"image",icon:"image"},{label:t.video,value:"video",icon:"video"}];a||(m.push({label:t.image_slider,value:"slider",icon:"slider"}),m.push({label:t.map,value:"map",icon:"map"}));if(_upfront_post_data.post_id||Upfront.Application.get_current()===Upfront.Application.MODE.THEME&&"type"in _upfront_post_data.layout&&"single"===_upfront_post_data.layout.type)"item"in _upfront_post_data.layout&&_upfront_post_data.layout.item.match(/single-404/)||m.push({label:t.featured_image,value:"featured",icon:"feat"});var g=new en({model:this.model,property:"background_type",use_breakpoint_property:!0,default_value:h?"image":"color",icon_class:"upfront-region-field-icon",values:m,change:function(){var e=this.get_value();this.model.set_breakpoint_property(this.property_name,e),n.find(".upfront-region-bg-setting-tab").not(".upfront-region-bg-setting-tab-"+e).hide(),n.find(".upfront-region-bg-setting-tab-"+e).show(),i.render_modal_tab(e,n.find(".upfront-region-bg-setting-tab-"+e),n)}}),y=new Upfront.Views.Editor.BgSettings.BgItem({model:this.model}),b,w,E,S,x,T,N,C,k;if(!u&&l)var L=new Wt({model:this.model,name:"title",placeholder:t.region_name_placeholder,compact:!0,change:function(){},blur:function(){var t=this.model.collection,n=this.model.get("title"),r=this.model.get("name"),s=e.trim(this.get_value().replace(/[^A-Za-z0-9\s_-]/g,"")),o=s.toLowerCase().replace(/\s/g,"-"),u,a,f;n!=s&&(t.get_by_name(o)&&(u=t.get_new_title(s+" ",2),s=u.title,o=u.name),f=i.get_region_css_styles(this.model),this.model.is_main()?(a=this.model.get_sub_regions(),_.each(a,function(e,t){_.isArray(e)?_.each(e,function(e){e.set({container:o},{silent:!0})}):_.isObject(e)&&e.set({container:o},{silent:!0})}),this.model.set({title:s,name:o,container:o},{silent:!0})):this.model.set({title:s,name:o},{silent:!0}),w.find(".upfront-region-name-edit-value").text(s),i.set_region_css_styles(this.model,f.styles,f.selector),this.model.get("properties").trigger("change"))},rendered:function(){var e=this;this.get_field().on("keyup",function(t){t.which===13&&e.trigger("blur")})}}),A=new an({model:this.model,name:"scope",multiple:!1,values:[{label:t.make_global,value:"global"}],change:function(){var e=this.get_value();e=="global"&&(i.apply_region_scope(this.model,"global"),w.find(".upfront-region-bg-setting-is-global").show())}}),O=new Vt({model:this.model,name:"localize",label:t.localize_region,classname:"upfront-region-bg-setting-localize",compact:!0,on_click:function(){i.apply_region_scope(this.model,"local"),w.find(".upfront-region-bg-setting-name-wrap").show(),$region_auto.show(),w.find(".upfront-region-bg-setting-name-edit").hide(),w.find(".upfront-region-bg-setting-is-global").hide(),A.$el.find("[value=global]").prop("checked",!1),A.$el.show(),this.$el.hide()},rendered:function(){this.$el.attr("title",t.localize_region_info)}}),M=new Vt({model:this.model,name:"save",label:t.save,compact:!0,classname:"upfront-region-bg-setting-name-save",on_click:function(){w.find(".upfront-region-bg-setting-name-wrap").show(),$region_auto.show(),w.find(".upfront-region-bg-setting-name-edit").hide(),this.model.get("scope")=="global"?(A.$el.hide(),O._no_display||O.$el.show()):A.$el.show()}});if(a)var D=new Kt({model:this.model,property:"contained_region_width",label:t.contained_region_width,label_style:"inline",default_value:s.size*s.column_width,min:s.size*s.column_width,max:5120,step:1,suffix:t.px,change:function(){var e=this.get_value();e=e<this.options.min?this.options.min:e,this.property.set({value:e}),Upfront.Events.trigger("upfront:layout:contained_region_width",e)}});if(l&&this.model.is_main()){var P=_.findWhere(Upfront.Application.current_subapplication.get_layout_data().properties,{name:"global_regions"}),H=_.isUndefined(P)?!1:_.findWhere(P.value,{name:"header"}),B=_.isUndefined(P)?!1:_.findWhere(P.value,{name:"footer"}),j=this.model.collection,F=j.indexOf(this.model),I=j.index_container(this.model,["shadow","lightbox"]),q=j.total_container(["shadow","lightbox"]),R=I==0,U=I==q-1,z=j.findWhere({sticky:"1"}),W=[{label:t.full_width,value:"wide"},{label:t.contained,value:"clip"}],W=I>0?W:_.union([{label:t.full_screen,value:"full"}],W);region_global=new an({model:this.model,name:"scope",multiple:!1,values:[{label:R?t.use_as_global_header:U?t.use_as_global_footer:"",value:"global"}],change:function(){var e=this.get_value(),n=this.model.get_sub_regions(),r=!1,s=!1,o=!1,u=!1;e=="global"?(s=R?t.header:U?t.footer:"",o=R?"header":U?"footer":"",s&&o&&(u=this.model.collection.get_by_name(o),u&&u!=this.model&&(r=this.model.collection.get_new_title("Region ",q),i.apply_region_scope(u,"local",r.name,r.title)),i.apply_region_scope(this.model,"global",o,s))):i.apply_region_scope(this.model,"local")}}),add_global_region=new Vt({model:this.model,label:R?t.add_global_header:t.add_global_footer,info:R?t.layout_no_global_header:t.layout_no_global_footer,compact:!0,on_click:function(e){e.preventDefault();var t=new Upfront.Models.Region(R?H:B),n=this.model.collection.get_by_name(R?"header":"footer"),r=!1;n&&(r=this.model.collection.get_new_title("Region ",q),i.apply_region_scope(n,"local",r.name,r.title)),Upfront.Events.once("entity:region:added",function(e){e.trigger("activate_region",e)},this),t.add_to(this.model.collection,R?0:F+1),i.close()}}),region_type=new un({model:this.model,name:"type",default_value:"wide",layout:"horizontal-inline",values:W,change:function(){var e=this.get_value();this.model.set({type:e},{silent:!0}),e=="full"?(x.show(),T.show()):(x.hide(),T.hide()),this.model.get("properties").trigger("change"),i.update_pos(),Upfront.Events.trigger("command:region:edit_toggle",!1),Upfront.Events.trigger("command:region:edit_toggle",!0)}}),region_nav_value=this.model.get_property_value_by_name("nav_region"),region_nav=new an({model:this.model,property:"sub_regions",default_value:this.model.get_property_value_by_name("sub_regions")?[]:[region_nav_value],layout:"horizontal-inline",multiple:!0,values:[{label:t.top,value:"top"},{label:t.bottom,value:"bottom"}],change:function(){var e=this.get_value(),t=i.model.get_sub_regions(),n=!1;F=j.indexOf(i.model),!_.contains(e,"top")&&t.top&&(n=Upfront.Util.model_to_json(t.top),i._sub_region_top_copy=new Upfront.Models.Region(n),j.remove(t.top)),!_.contains(e,"bottom")&&t.bottom&&(n=Upfront.Util.model_to_json(t.bottom),i._sub_region_bottom_copy=new Upfront.Models.Region(n),j.remove(t.bottom)),_.each(e,function(e){if(t[e])return;var n=!1,r=!1;e=="bottom"?(i._sub_region_bottom_copy&&(r=i._sub_region_bottom_copy),n=t.right?F+2:F+1):e=="top"&&(i._sub_region_top_copy&&(r=i._sub_region_top_copy),n=t.left?F-1:F);if(n!==!1){var s=i.model.get("name")+"_"+e,o=i.model.get("title")+" "+e;r===!1&&(r=new Upfront.Models.Region(_.extend(_.clone(Upfront.data.region_default_args),{name:s,title:o,container:i.model.get("name"),sub:e,scope:i.model.get("scope")}))),r.add_to(j,n,{sub:e}),Upfront.Events.trigger("command:region:edit_toggle",!0)}}),this.property.set({value:e})}}),region_behavior=new un({model:this.model,name:"behavior",default_value:"keep-position",layout:"horizontal-inline",values:[{label:t.keep_position,value:"keep-position"},{label:t.keep_ratio,value:"keep-ratio"}],change:function(){var e=this.get_value();this.model.set({behavior:e},{silent:!0}),this.model.get("properties").trigger("change")}})}else if(l&&c=="fixed")var X=new an({model:this.model,name:"restrict_to_container",default_value:"",layout:"horizontal-inline",values:[{label:t.restrict_to_parent,value:"1"}],change:function(){var e=this.get_value();this.model.set({restrict_to_container:e},{silent:!0}),this.model.trigger("restrict_to_container",e),this.model.get("properties").trigger("change")},multiple:!1});if(l)var V=new un({model:this.model,use_breakpoint_property:!0,property:"bg_padding_type",label:"",values:[{label:t.varied_padding,value:"varied"},{label:t.equal_padding,value:"equal"}],default_value:this.model.get_breakpoint_property_value("bg_padding_type")||"varied",change:function(){this.model.set_breakpoint_property("bg_padding_type",this.get_value())},show:function(t,r){t==="varied"?(e(".upfront-region-bg-setting-padding-top",n).show(),e(".upfront-region-bg-setting-padding-bottom",n).show(),e(".upfront-region-bg-setting-equal-padding",n).hide()):(e(".upfront-region-bg-setting-equal-padding",n).show(),e(".upfront-region-bg-setting-padding-top",n).hide(),e(".upfront-region-bg-setting-padding-bottom",n).hide())}}),J=new Qt({model:this.model,use_breakpoint_property:!0,property:"top_bg_padding_slider",label:"",default_value:this.model.get_breakpoint_property_value("top_bg_padding_slider")||0,min:0,max:200,step:5,valueTextFilter:function(){return""},change:function(){var e=this.get_value();this.model.set_breakpoint_property("top_bg_padding_slider",e),K.get_field().val(e),this.model.set_breakpoint_property("top_bg_padding_num",e,!0)}}),K=new Kt({model:this.model,use_breakpoint_property:!0,property:"top_bg_padding_num",label:"",default_value:this.model.get_breakpoint_property_value("top_bg_padding_num")||0,prefix:t.bottom_padding,suffix:t.px,min:0,step:5,change:function(){var e=this.get_value();this.model.set_breakpoint_property("top_bg_padding_num",e),this.model.set_breakpoint_property("top_bg_padding_slider",e,!0),J.$el.find("#"+J.get_field_id()).slider("value",e)}}),Q=new Qt({model:this.model,use_breakpoint_property:!0,property:"bottom_bg_padding_slider",label:"",default_value:this.model.get_breakpoint_property_value("bottom_bg_padding_slider")||0,min:0,max:200,step:5,valueTextFilter:function(){return""},change:function(){var e=this.get_value();this.model.set_breakpoint_property("bottom_bg_padding_slider",e),G.get_field().val(e),this.model.set_breakpoint_property("bottom_bg_padding_num",e,!0)}}),G=new Kt({model:this.model,use_breakpoint_property:!0,property:"bottom_bg_padding_num",label:"",default_value:this.model.get_breakpoint_property_value("bottom_bg_padding_num")||0,suffix:t.px,min:0,step:5,change:function(){var e=this.get_value();this.model.set_breakpoint_property("bottom_bg_padding_num",e),this.model.set_breakpoint_property("bottom_bg_padding_slider",e,!0),Q.$el.find("#"+Q.get_field_id()).slider("value",e)}}),Y=new Qt({model:this.model,use_breakpoint_property:!0,property:"bg_padding_slider",label:"",default_value:this.model.get_breakpoint_property_value("bg_padding_slider")||0,min:0,max:200,step:5,valueTextFilter:function(){return""},change:function(){var e=this.get_value();this.model.set_breakpoint_property("bg_padding_slider",e),this.model.set_breakpoint_property("top_bg_padding_slider",e,!0),this.model.set_breakpoint_property("bottom_bg_padding_slider",e,!0),J.$el.find("#"+J.get_field_id()).slider("value",e),Q.$el.find("#"+Q.get_field_id()).slider("value",e),Z.get_field().val(e),K.get_field().val(e),G.get_field().val(e),this.model.set_breakpoint_property("bg_padding_num",e,!0),this.model.set_breakpoint_property("top_bg_padding_num",e,!0),this.model.set_breakpoint_property("bottom_bg_padding_num",e,!0)}}),Z=new Kt({model:this.model,use_breakpoint_property:!0,property:"bg_padding_num",label:"",default_value:this.model.get_breakpoint_property_value("bg_padding_num")||0,suffix:t.px,min:0,step:5,change:function(){var e=this.get_value();this.model.set_breakpoint_property("bg_padding_num",e),K.get_field().val(e),G.get_field().val(e),this.model.set_breakpoint_property("top_bg_padding_num",e,!0),this.model.set_breakpoint_property("bottom_bg_padding_num",e,!0),this.model.set_breakpoint_property("bg_padding_slider",e,!0),this.model.set_breakpoint_property("top_bg_padding_slider",e,!0),this.model.set_breakpoint_property("bottom_bg_padding_slider",e,!0),Y.$el.find("#"+Y.get_field_id()).slider("value",e),J.$el.find("#"+J.get_field_id()).slider("value",e),Q.$el.find("#"+Q.get_field_id()).slider("value",e)}});n.find(".upfront-region-bg-setting-tab-primary, .upfront-region-bg-setting-tab-secondary").children().detach(),n.html(v),r.addClass("upfront-region-modal-bg"),$fixed=n.find(".upfront-region-bg-setting-fixed-region"),$fixed.hide(),$lightbox=n.find(".upfront-region-bg-setting-lightbox-region"),$lightbox.hide(),b=n.find(".upfront-region-bg-setting-header"),w=n.find(".upfront-region-bg-setting-name"),E=n.find(".upfront-region-bg-setting-region-global"),$add_global_region=n.find(".upfront-region-bg-setting-add-global-region"),S=n.find(".upfront-region-bg-setting-region-type"),x=n.find(".upfront-region-bg-setting-region-nav"),T=n.find(".upfront-region-bg-setting-region-behavior"),N=n.find(".upfront-region-bg-setting-floating-restrict"),C=n.find(".upfront-region-bg-setting-sticky"),$region_auto=n.find(".upfront-region-bg-setting-auto-resize"),$region_padding_type=n.find(".upfront-region-bg-setting-padding-type"),$region_equal_padding=n.find(".upfront-region-bg-setting-equal-padding"),$region_top_padding=n.find(".upfront-region-bg-setting-padding-top"),$region_bottom_padding=n.find(".upfront-region-bg-setting-padding-bottom");if(!u&&l){L.render(),A.render(),O.render(),M.render(),w.find(".upfront-region-bg-setting-name-edit").append([L.$el,A.$el,O.$el,M.$el]).hide(),w.find(".upfront-region-name-edit-value").text(this.model.get("title"));if(this.model.get("scope")=="global"){w.find(".upfront-region-bg-setting-is-global").show(),A.$el.hide();if(!this.model.is_main()&&c){var et=this.model.collection.get_by_name(this.model.get("container"));et&&et.get("scope")=="global"&&(O.$el.hide(),O._no_display=!0)}}else w.find(".upfront-region-bg-setting-is-global").hide(),O.$el.hide();w.on("click",".upfront-region-name-edit-trigger",function(e){e.preventDefault(),w.find(".upfront-region-bg-setting-name-wrap").hide(),$region_auto.hide(),w.find(".upfront-region-bg-setting-name-edit").show(),i.model.get("scope")!="global"?L.get_field().prop("disabled",!1).trigger("focus").select():L.get_field().prop("disabled",!0)})}else b.hide();!u&&l&&this.model.is_main()?(region_type.render(),S.append(region_type.$el),region_nav.render(),x.append(region_nav.$el),region_behavior.render(),T.append(region_behavior.$el)):(E.hide(),S.hide(),x.hide(),T.hide(),$region_auto.hide()),N.hide(),C.hide();if(!u&&l&&(this.model.is_main()||c=="top"||c=="bottom"))if(!z&&this.for_view.$el.height()<=300||this.model.get("sticky")){var tt=new an({model:this.model,name:"sticky",default_value:"",layout:"horizontal-inline",values:[{label:t.sticky_region,value:"1"}],change:function(){var e=this.get_value();this.model.set({sticky:e},{silent:!0}),this.model.get("properties").trigger("change")},multiple:!1});tt.render(),C.append(tt.$el).show()}k=n.find(".upfront-region-bg-setting-theme-body"),a?(D.render(),k.append(D.$el),n.find(".upfront-region-bg-setting-edit-css").hide()):k.hide(),this.model.attributes.sub!="lightbox"?(g.render(),n.find(".upfront-region-bg-setting-type").append(g.$el)):n.find(".upfront-region-bg-setting-type").remove(),n.find(".upfront-region-bg-setting-edit-css").on("click",function(e){e.preventDefault(),e.stopPropagation(),i.trigger_edit_css()});if(l&&this.model.is_main()){var nt=n.find(".upfront-region-bg-setting-auto-resize");nt.on("click",function(t){t.preventDefault(),t.stopPropagation(),i.trigger_expand_lock(e(this))}),this.render_expand_lock(nt),this.listenTo(region_type,"changed",function(){i.render_expand_lock(nt)}),u||region_type.trigger("changed")}else l&&c=="fixed"?(this.render_fixed_settings($fixed),$fixed.show(),X.render(),N.append(X.$el).show()):l&&c=="lightbox"?(this.render_lightbox_settings($lightbox),$lightbox.show()):n.find(".upfront-region-bg-setting-auto-resize").hide();l&&(V.render(),$region_padding_type.append(V.$el),J.render(),$region_top_padding.append(J.$el),K.render(),$region_top_padding.append(K.$el),Q.render(),$region_bottom_padding.append(Q.$el),G.render(),$region_bottom_padding.append(G.$el),Y.render(),$region_equal_padding.append(Y.$el),Z.render(),$region_equal_padding.append(Z.$el)),a&&!l&&n.find(".upfront-region-bg-setting-padding").hide(),g.trigger("changed")},on_close_modal:function(){var e=this;e._active=!1,e.render_icon()},notify:function(){Upfront.Views.Editor.notify(t.bg_updated)},apply_region_scope:function(e,t,n,r){var i=this,s=e.get_sub_regions(),o=e.get("title"),u=e.get("name"),a=function(e){var s=i.get_region_css_styles(e);e.set({scope:t},{silent:!0});if(n&&u!=n){var a=new RegExp("^"+o,"i"),f=new RegExp("^"+u,"i"),l=e.get("title").replace(a,r),c=e.get("name").replace(f,n);e.set({container:n,title:l,name:c},{silent:!0})}i.set_region_css_styles(e,s.styles,s.selector),e.get("properties").trigger("change")},f;e.is_main()&&_.each(s,function(e){_.isArray(e)?_.each(e,function(e){a(e)}):e&&a(e)}),f=i.get_region_css_styles(e),e.set({scope:t},{silent:!0}),n&&u!=n&&e.set({title:r,name:n,container:n},{silent:!0}),i.set_region_css_styles(e,f.styles,f.selector),e.get("properties").trigger("change")},get_region_css_styles:function(t){return Upfront.Application.cssEditor.init({model:t,type:t.is_main()?"RegionContainer":"Region",element_id:t.is_main()?"region-container-"+t.get("name"):"region-"+t.get("name"),no_render:!0}),{styles:e.trim(Upfront.Application.cssEditor.get_style_element().html()),selector:Upfront.Application.cssEditor.get_css_selector()}},set_region_css_styles:function(e,t,n){t&&(Upfront.Application.cssEditor.init({model:e,type:e.is_main()?"RegionContainer":"Region",element_id:e.is_main()?"region-container-"+e.get("name"):"region-"+e.get("name"),no_stylename_fallback:!0,no_render:!0}),selector=Upfront.Application.cssEditor.get_css_selector(),n!=selector&&(t=t.replace(new RegExp(n.replace(/^\./,"."),"g"),selector)),Upfront.Application.cssEditor.get_style_element().html(t),Upfront.Application.cssEditor.saveCall(!1))},render_fixed_settings:function(e){var n=this,r=Upfront.Settings.LayoutEditor.Grid,i=this.model.get_property_value_by_name("top"),s=typeof i=="number",o=this.model.get_property_value_by_name("left"),u=typeof o=="number",a=this.model.get_property_value_by_name("bottom"),f=typeof a=="number",l=this.model.get_property_value_by_name("right"),c=typeof l=="number",h=function(){var e=this.get_value(),t=this.get_saved_value();if(e!=t){switch(this.options.property){case"top":this.model.remove_property("bottom",!0);break;case"bottom":this.model.remove_property("top",!0);break;case"left":this.model.remove_property("right",!0);break;case"right":this.model.remove_property("left",!0)}this.property.set({value:parseInt(e)})}},p={width:new Upfront.Views.Editor.Field.Number({model:this.model,property:"width",label:t.width+":",label_style:"inline",min:3*r.column_width,max:Math.floor(r.size/2)*r.column_width,change:h}),height:new Upfront.Views.Editor.Field.Number({model:this.model,property:"height",label:t.height+":",label_style:"inline",min:3*r.baseline,change:h})};s||!f?p.top=new Upfront.Views.Editor.Field.Number({model:this.model,property:"top",label:t.top+":",label_style:"inline",min:0,change:h}):p.bottom=new Upfront.Views.Editor.Field.Number({model:this.model,property:"bottom",label:t.bottom+":",label_style:"inline",min:0,change:h}),u||!c?p.left=new Upfront.Views.Editor.Field.Number({model:this.model,property:"left",label:t.left+":",label_style:"inline",min:0,change:h}):p.right=new Upfront.Views.Editor.Field.Number({model:this.model,property:"right",label:t.right+":",label_style:"inline",min:0,change:h}),_.each(p,function(t){t.render(),t.delegateEvents(),e.append(t.$el)})},render_lightbox_settings:function(e){var n=this,r=Upfront.Settings.LayoutEditor.Grid,i=function(e){n=e.$spectrum?e:this;var t=n.get_value(),r=n.get_saved_value();t!=r&&n.property.set({value:t})},s={width:new Upfront.Views.Editor.Field.Number({model:this.model,property:"col",className:"upfront-field-wrap upfront-field-wrap-number width_cols",label:t.col_width+":",label_style:"inline",min:3,max:24,change:i}),height:new Upfront.Views.Editor.Field.Number({model:this.model,property:"height",label:t.px_height+":",label_style:"inline",min:3*r.baseline,max:99999,change:i}),click_out_close:new Upfront.Views.Editor.Field.Checkboxes({model:this.model,property:"click_out_close",label:"",values:[{label:t.click_close_ltbox,value:"yes",checked:this.model.get_property_value_by_name("click_out_close")=="yes"?"checked":!1}],change:i}),show_close:new Upfront.Views.Editor.Field.Checkboxes({model:this.model,property:"show_close",label:"",values:[{label:t.show_close_icon,value:"yes",checked:this.model.get_property_value_by_name("show_close")=="yes"?"checked":!1}],change:i})};s.overlay_color=new Upfront.Views.Editor.Field.Color({model:this.model,property:"overlay_color",className:"upfront-field-wrap upfront-field-wrap-color sp-cf overlay_color",default_value:"rgba(38,58,77,0.75)",label:t.overlay_bg+":",change:i,spectrum:{move:function(e){var t=e.toRgb(),n="rgba("+t.r+","+t.g+","+t.b+","+e.alpha+")";s.overlay_color.get_field().val(n),i(s.overlay_color)},change:function(e){var t=e.toRgb(),n="rgba("+t.r+","+t.g+","+t.b+","+e.alpha+")";s.overlay_color.get_field().val(n),i(s.overlay_color)}}}),s.lightbox_color=new Upfront.Views.Editor.Field.Color({model:this.model,property:"lightbox_color",default_value:"rgba(248,254,255,0.9)",label:t.active_area_bg+":",change:i,spectrum:{move:function(e){var t=e.toRgb(),n="rgba("+t.r+","+t.g+","+t.b+","+e.alpha+")";s.lightbox_color.get_field().val(n),i(s.lightbox_color)},change:function(e){var t=e.toRgb(),n="rgba("+t.r+","+t.g+","+t.b+","+e.alpha+")";s.lightbox_color.get_field().val(n),i(s.lightbox_color)}}}),_.each(s,function(t){t.render(),t.delegateEvents(),e.append(t.$el)}),this.model.set_property("delete",!1);var n=this;e.on("click","a.upfront-entity-delete_trigger",function(){n.model.set_property("delete",!0),n.close()}),e.closest(".upfront-inline-modal-wrap").draggable()},update_lightbox_overlay:function(e){var t=e.toRgb(),n="rgba("+t.r+","+t.g+","+t.b+","+e.alpha+")"},render_modal_tab:function(e,t,n){var r=n.find(".upfront-region-bg-setting-change-image");r.hide();switch(e){case"color":this.render_modal_tab_color(t);break;case"image":r.show(),this.render_modal_tab_image(t,e);break;case"featured":this.render_modal_tab_image(t,e);break;case"slider":this.render_modal_tab_slider(t);break;case"map":this.render_modal_tab_map(t);break;case"video":this.render_modal_tab_video(t)}},_render_tab_template:function(t,n,r,i){var s=e(f.region_edit_panel),o=!1,u=!1;i?u=_.template(s.find("#upfront-region-bg-setting-tab-"+i).html()):u=_.template(s.find("#upfront-region-bg-setting-tab").html()),u&&(o=e("<div>"+u()+"</div>")),o.find(".upfront-region-bg-setting-tab-primary").append(n),r&&o.find(".upfront-region-bg-setting-tab-secondary").append(r),t.html(""),t.append(o)},render_modal_tab_color:function(e){this._color_item||(this._color_item=new Upfront.Views.Editor.BgSettings.ColorItem({model:this.model}),this._color_item.render()),this._color_item.trigger("show"),this._render_tab_template(e,this._color_item.$el,"")},render_modal_tab_image:function(e,t){this._image_item||(this._image_item=new Upfront.Views.Editor.BgSettings.ImageItem({model:this.model}),this._image_item.render(),this.$_image_primary=this._image_item.$el.find(".uf-bgsettings-image-style, .uf-bgsettings-image-pick")),this._image_item.trigger("show"),this._render_tab_template(e,this.$_image_primary,this._image_item.$el)},render_modal_tab_slider:function(t){this._slider_item||(this.$_slides=e('<div class="upfront-region-bg-slider-slides"></div>'),this._slider_item=new Upfront.Views.Editor.BgSettings.SliderItem({model:this.model,slides_item_el:this.$_slides}),this._slider_item.render(),this.$_slider_primary=this._slider_item.$el.find(".uf-bgsettings-slider-transition")),this._slider_item.trigger("show"),this._render_tab_template(t,this.$_slider_primary,[this._slider_item.$el,this.$_slides])},render_modal_tab_map:function(e){this._map_item||(this._map_item=new Upfront.Views.Editor.BgSettings.MapItem({model:this.model}),this._map_item.render()),this._map_item.trigger("show"),this._render_tab_template(e,"",this._map_item.$el)},render_modal_tab_video:function(e){this._video_item||(this._video_item=new Upfront.Views.Editor.BgSettings.VideoItem({model:this.model}),this._video_item.render()),this._video_item.trigger("show"),this._render_tab_template(e,"",this._video_item.$el)},render_expand_lock:function(n){var r=this.model.get_breakpoint_property_value("expand_lock",!0),i=this.model.get("type"),s=e("<span />");i=="full"?(n.addClass("upfront-region-bg-setting-auto-resize-disabled"),n.attr("title",t.auto_resize_disabled_title)):(n.removeClass("upfront-region-bg-setting-auto-resize-disabled"),n.removeAttr("title")),r?s.addClass("auto-resize-off"):s.addClass("auto-resize-on"),n.html(""),n.append("<span>"+t.auto_resize+"</span>"),n.append(s)},trigger_expand_lock:function(e){if(e.hasClass("upfront-region-bg-setting-auto-resize-disabled"))return;var t=this.model.get_breakpoint_property_value("expand_lock");this.model.set_breakpoint_property("expand_lock",!t),this.render_expand_lock(e)},trigger_edit_css:function(){Upfront.Application.cssEditor.init({model:this.model,type:this.model.is_main()?"RegionContainer":this.model.get("type")=="lightbox"?"RegionLightbox":"Region",element_id:this.model.is_main()?"region-container-"+this.model.get("name"):"region-"+this.model.get("name")}),this.listenTo(Upfront.Application.cssEditor,"updateStyles",this.adjust_grid_padding)},adjust_grid_padding:function(){var e=new Upfront.Views.Editor.Command_ToggleGrid;e.update_grid()}}),ur=l.Item.extend({initialize:function(){this.on("modal:open",this.on_modal_open,this),this.on("modal:close",this.on_modal_close,this)},on_modal_open:function(){Upfront.Events.trigger("command:region:edit_toggle",!1)},on_modal_close:function(){Upfront.Events.trigger("command:region:edit_toggle",!0)}}),ar=ur.extend({events:{"click .upfront-icon":"open_bg_setting"},className:"upfront-inline-panel-item upfront-region-panel-item-bg",icon:function(){return this._active?"bg-setting-active":"bg-setting"},tooltip:t.change_background,_active:!1,open_bg_setting:function(){var t=this.model.get_property_value_by_name("background_type");t||this.model.get_property_value_by_name("background_image")&&this.model.set_property("background_type","image"),this._active=!0,this.render_icon(),this.open_modal(this.render_modal,!0).always(e.proxy(this.on_close_modal,this)).fail(e.proxy(this.notify,this))}}),fr=ur.extend({events:{"click .upfront-icon":"toggle_lock"},className:"upfront-inline-panel-item upfront-region-panel-item-expand-lock",icon:function(){var e=this.model.get_property_value_by_name("expand_lock");return e?"expand-lock":"expand-unlock"},tooltip:function(){var e=this.model.get_property_value_by_name("expand_lock"),n='<span class="'+(e?"expand-lock-active":"expand-lock-inactive")+'">'+(e?t.off:t.on)+"</span>";return t.autoexpand.replace(/%s/,n)},toggle_lock:function(){var e=this.model.get_property_value_by_name("expand_lock");this.model.set_property("expand_lock",!e),this.render_icon(),this.render_tooltip()}}),lr=ur.extend({width:24,height:24,events:{click:"add_region_modal"},className:"upfront-inline-panel-item upfront-region-panel-item-add-region",icon:function(){var e=this.options.to;if(e.match(/^(top|bottom)-(left|right)$/))return;return"add add-"+e},tooltip:function(){var e=this.options.to;switch(e){case"bottom":var n=t.new_region_below;break;case"left":var n=t.new_sidebar_region;break;case"right":var n=t.new_sidebar_region;break;case"top":var n=t.new_region_above;break;case"top-left":case"top-right":case"bottom-left":case"bottom-right":var n=t.add_floating_region}return n},tooltip_pos:function(){var e=this.options.to;switch(e){case"bottom":var t="top";break;case"left":case"top-left":case"bottom-left":var t="right";break;case"right":case"top-right":case"bottom-right":var t="left";break;case"top":var t="bottom"}return t},initialize:function(e){this.options=e,this.options.to||(this.options.to="top"),this.options.width&&(this.width=this.options.width),this.options.height&&(this.height=this.options.height)},add_region_modal:function(e){var n=this.options.to,r=this,i=new sr({to:this.panel_view.panels_view.$el,button:!0,width:422}),s=(n=="left"||n=="right")&&r.model.get("scope")=="global",o=r.$el.parents(".upfront-region-center");o.addClass("upfront-region-editing-modal"),o.next().find(".upfront-icon-control-region-resize").hide(),fields={from:new un({name:"from",default_value:"new",layout:"horizontal-inline",values:[{label:t.new_region,value:"new"},{label:t.choose_global_region,value:"global",disabled:s}],change:function(){var e=this.get_value();r.from=e}}),region_title:new Wt({name:"name",placeholder:t.region_name_placeholder,focus:function(){fields.from.set_value("new"),fields.from.trigger("changed")},change:function(){var e=this.get_value();r.region_title=e}}),make_global:new an({name:"make_global",multiple:!1,values:[{label:t.make_this_region_global,value:1}],focus:function(){fields.from.set_value("new"),fields.from.trigger("changed")},change:function(){var e=this.get_value();r.make_global=e==1?!0:!1}}),from_region:new en({name:"from_region",values:[{label:Upfront.Settings.l10n.global.behaviors.loading,value:""}],disabled:s,focus:function(){fields.from.set_value("global"),fields.from.trigger("changed")},change:function(){var e=this.get_value();r.from_region=e}})},from_region_values=function(){var e=[],i=n=="top"||n=="bottom",s=n=="left"||n=="right";return e.push({label:t.select_global_region,value:"",disabled:!0}),_.each(Upfront.data.global_regions,function(t){if(i&&t.container&&t.name!=t.container)return;if(s&&t.sub!="left"&&t.sub!="right")return;var n=r.model.collection,o=n.get_by_name(t.name);e.push({label:t.title,value:t.name,disabled:o!==!1})}),e},i.render(),this.panel_view.panels_view.$el.append(i.$el),this.from="new",this.region_title="",this.make_global=!1,this.from_region="",Upfront.data.global_regions?fields.from_region.options.values=from_region_values():Upfront.Util.post({action:"upfront_list_scoped_regions",scope:"global",storage_key:_upfront_save_storage_key}).done(function(e){Upfront.data.global_regions=e.data,fields.from_region.options.values=from_region_values(),fields.from_region.render(),fields.from_region.delegateEvents()}),i.open(function(e,t){var n=_.template(f.region_add_panel,{});_.each(fields,function(e,t){e.render(),e.delegateEvents()}),t.addClass("upfront-add-region-modal"),e.append(n),e.find(".upfront-add-region-choice").append(fields.from.$el),e.find(".upfront-add-region-new").append(fields.region_title.$el),s||e.find(".upfront-add-region-new").append(fields.make_global.$el),e.find(".upfront-add-region-global").append(fields.from_region.$el)},this).done(function(e){r.from=="new"||!r.from_region?r.add_region():r.add_region_from_global(r.from_region)}).always(function(e){o.removeClass("upfront-region-editing-modal"),o.next().find(".upfront-icon-control-region-resize").show(),e.remove()}),e.stopPropagation()},add_region:function(){var t=this.options.to,n=this.model.collection,r=n.size()-1,i=n.indexOf(this.model),s=this.model.get("position"),o=this.model.get_sub_regions(),u=t=="top"||t=="bottom",a=t=="top"||t=="left",f=this.region_title?this.region_title.replace(/[^A-Za-z0-9\s_-]/g,""):u?"Region ":this.model.get("title")+" "+t.charAt(0).toUpperCase()+t.slice(1),l=f.toLowerCase().replace(/\s/g,"-"),c=n.get_by_name(l)||!this.region_title&&u?n.get_new_title(f,1):!1,h=c!==!1?c.title:f,p=c!==!1?c.name:l,d=new Upfront.Models.Region(_.extend(_.clone(Upfront.data.region_default_args),{name:p,container:u?p:this.model.get("name"),title:h})),v={},m=function(e){return!e||!e.cid?-1:n.indexOf(e)};if(!u){d.set_property("col",5);if(t=="left"||t=="right")d.set("sub",a?"left":"right"),d.set("position",a?s-1:s+1),v.sub=a?"left":"right";else if(t=="top-left"||t=="top-right"||t=="bottom-left"||t=="bottom-right")d.set("type","fixed"),d.set("sub","fixed"),d.set_property("width",225),d.set_property("height",225),t.match(/^top/)&&d.set_property("top",30),t.match(/^bottom/)&&d.set_property("bottom",30),t.match(/left$/)&&d.set_property("left",30),t.match(/right$/)&&d.set_property("right",30),d.set_property("background_type","color"),d.set_property("background_color","#aeb8c2"),v.sub="fixed";this.make_global?d.set({scope:"global"}):d.set({scope:this.model.get("scope")})}else{d.set_property("row",Upfront.Util.height_to_row(300));var g=_.filter(_.map(o,m),function(e){return e>=0}),y=o.fixed.length>0?_.map(o.fixed,m):[];g=_.union(g,y,[i]),g.length>0&&(t=="top"?i=_.min(g):t=="bottom"&&(i=_.max(g))),this.make_global&&d.set({scope:"global"})}d.get("clip")||!u?(Upfront.Events.once("entity:region:before_render",this.before_animation,this),Upfront.Events.once("entity:region:added",this.run_animation,this)):(Upfront.Events.once("entity:region_container:before_render",this.before_animation,this),Upfront.Events.once("entity:region:added",this.run_animation,this)),d.add_to(n,a?i:i+1,v);var b=n.where({type:"wide"});b.length>0&&e("div.upfront-regions a#no_region_add_one").remove()},add_region_from_global:function(e){var t=this,n=this.options.to,r=this.model.collection,i=r.size()-1,s=r.indexOf(this.model),o=this.model.get("position"),u=this.model.get_sub_regions(),a=n=="top"||n=="bottom",f=n=="top"||n=="left",l=function(e){return!e||!e.cid?-1:r.indexOf(e)};if(a){var c=_.filter(_.map(u,l),function(e){return e>=0}),h=u.fixed.length>0?_.map(u.fixed,l):[];c=_.union(c,h,[s]),c.length>0&&(n=="top"?s=_.min(c):n=="bottom"&&(s=_.max(c)))}a?(Upfront.Events.once("entity:region_container:before_render",this.before_animation,this),Upfront.Events.once("entity:region:added",this.run_animation,this)):(Upfront.Events.once("entity:region:before_render",this.before_animation,this),Upfront.Events.once("entity:region:added",this.run_animation,this)),Upfront.Util.post({action:"upfront_get_scoped_regions",scope:"global",name:e,storage_key:_upfront_save_storage_key}).done(function(e){var i=e.data,o=!1,u=[],a=function(){_.each(u,function(e){e.model.add_to(r,e.index,e.options)})};_.each(i,function(e,r){var i=new Upfront.Models.Region(e),a={};i.is_main()?o={model:i,index:f?s:s+1,options:a}:(n=="left"||n=="right"?(i.set("container",t.model.get("name")),i.set("sub",f?"left":"right"),a.sub=f?"left":"right"):a.sub=i.get("sub"),u.push({model:i,index:(f?s:s+1)+r,options:a}))}),o!==!1?(Upfront.Events.once("entity:region:added",function(){a()}),o.model.add_to(r,o.index,o.options)):a()})},before_animation:function(e,t){Upfront.Events.trigger("command:region:edit_toggle",!1),Upfront.Events.trigger("command:region:fixed_edit_toggle",!1)},run_animation:function(t,n){function d(){var e=Upfront.Settings.LayoutEditor.Grid.baseline,n=t.$el.outerHeight();t.$el.removeClass(i),Upfront.Events.trigger("command:region:edit_toggle",!0),Upfront.Events.trigger("command:region:fixed_edit_toggle",!0),t.trigger("activate_region",t)}var r=this.options.to,i="upfront-add-region-ani upfront-add-region-ani-"+r,s=setTimeout(d,500),o="animationstart.region_ani webkitAnimationStart.region_ani MSAnimationStart.region_ani oAnimationStart.region_ani",u="animationend.region_ani webkitAnimationEnd.region_ani MSAnimationEnd.region_ani oAnimationEnd.region_ani";t.$el.one(o,function(){clearTimeout(s),t.$el.off(o)}),t.$el.one(u,function(){d(),t.$el.off(u)}),t.$el.addClass(i);if(r=="top"||r=="bottom"){var a=t.$el.hasClass("upfront-region-container")?t.$el:t.$el.closest(".upfront-region-container"),f=a.offset(),l=e(document).scrollTop(),c=!1,h=a.height(),p=e(window).height();r=="top"&&f.top<l?c=f.top-50:r=="bottom"&&f.top+h>l+p&&(c=f.top+h-p),c!==!1&&e("html,body").animate({scrollTop:c},600)}}}),cr=l.Panel.extend({initialize:function(e){this.options=e,this.options.to||(this.options.to="bottom");var t=this.options.to;args={model:this.model,to:t},this.options.width&&(args.width=this.options.width),this.options.height&&(args.height=this.options.height),this.items=_([new lr(args)]);if(t=="top"||t=="bottom")this.position_v=t,this.position_h="center";else if(t=="left"||t=="right")this.position_v="center",this.position_h=t;else if(t=="top-left"||t=="top-right"||t=="bottom-left"||t=="bottom-right")this.position_v=t.split("-")[0],this.position_h=t.split("-")[1]},items:function(){return _([this.add_region])}}),hr=l.Panels.extend({className:"upfront-inline-panels upfront-region-panels upfront-ui",initialize:function(){var e=this.model.get("container"),t=this.model.get("name");this.listenTo(this.model.collection,"add",this.render),this.listenTo(this.model.collection,"remove",this.render),this.listenTo(this.model.get("properties"),"change",this.render),this.listenTo(this.model.get("properties"),"add",this.render),this.listenTo(this.model.get("properties"),"remove",this.render),this.listenTo(Upfront.Events,"upfront:layout_size:change_breakpoint",this.update_padding),this.listenTo(Upfront.Events,"layout:after_render",this.update_padding),this.listenTo(Upfront.Events,"entity:region:activated",this.on_region_active),this.listenTo(Upfront.Events,"entity:region:deactivated",this.on_region_deactive),this.add_panel_top=new cr({model:this.model,to:"top"}),this.add_panel_bottom=new cr({model:this.model,to:"bottom"}),this.model.is_main()&&this.model.get("allow_sidebar")&&(this.add_panel_left=new cr({model:this.model,to:"left"}),this.add_panel_right=new cr({model:this.model,to:"right"}))},panels:function(){var e=_([]),t=this.model.collection;if(_.isUndefined(t))return this._panels=e,e;var n=t.index_container(this.model,["shadow","lightbox"]),r=t.total_container(["shadow","lightbox"]),i=n==0,s=n==r-1,o=this.model.get("type")=="full";if(this.model.is_main()){var u=this.model.get_sub_regions();(!o||!i)&&e.push(this.add_panel_top),this.model.get("allow_sidebar")&&(u.left===!1&&e.push(this.add_panel_left),u.right===!1&&e.push(this.add_panel_right)),e.push(this.add_panel_bottom)}return this._panels=e,e},on_render:function(){this.update_pos()},on_scroll:function(e){var t=e.data;t.update_pos()},on_region_active:function(t){if(t.model!=this.model)return;var n=e(Upfront.Settings.LayoutEditor.Selectors.main);n.hasClass("upfront-region-editing")&&(this.on_active(),this.listenToOnce(Upfront.Events,"sidebar:toggle:done",this.update_pos),e(window).on("scroll",this,this.on_scroll))},on_region_deactive:function(){e(window).off("scroll",this,this.on_scroll)},update_pos:function(){var t=e(Upfront.Settings.LayoutEditor.Selectors.main),n=this.$el.closest(".upfront-region-container"),r=this.$el.closest(".upfront-region"),i=n.find(".upfront-region-side-top"),s=n.find(".upfront-region-side-bottom");if(!t.hasClass("upfront-region-editing")&&!t.hasClass("upfront-region-fixed-editing")&&!t.hasClass("upfront-region-lightbox-editing")||!n.hasClass("upfront-region-container-active"))return;var o=this,u=r.offset(),a=u.top,f=a+r.outerHeight(),l=i.length?i.outerHeight():0,c=s.length?s.outerHeight():0,h=e(window).height(),p=e(document).scrollTop(),d=p+h-c,v=t.offset().top+l;this.add_responsive_items(),this._panels.each(function(t){var n=t.$el.offset();if(t.position_v=="top"&&p>a-v&&p<f-v)t.$el.css("position")!="fixed"&&t.$el.css({position:"fixed",top:v,left:n.left,right:"auto"});else if(t.position_v=="bottom"&&f>d&&a<d)t.$el.css("position")!="fixed"&&t.$el.css({position:"fixed",bottom:c,left:n.left,right:"auto"});else if(t.position_v=="center"&&(p>a-v||f>d)){var r=p>a-v?v:a-p,i=f>d?0:d-f,s=t.position_h=="left"?n.left:"auto",o=t.position_h=="right"?e(window).width()-n.left-t.$el.width():"auto";t.$el.css("position")!="fixed"?t.$el.css({position:"fixed",top:r,bottom:i,left:s,right:o}):t.$el.css({top:r,bottom:i})}else t.$el.css({position:"",top:"",bottom:"",left:"",right:""})}),setTimeout(function(){o.update_padding()},300)},update_padding:function(){var e={},t=this.$el.closest(".upfront-region");this.model.get("properties").each(function(t){e[t.get("name")]=t.get("value")});var n=typeof Upfront.Settings.LayoutEditor.Theme.breakpoints!="undefined"?Upfront.Settings.LayoutEditor.Theme.breakpoints:[],r=typeof Upfront.Settings.LayoutEditor.CurrentBreakpoint!="undefined"?Upfront.Settings.LayoutEditor.CurrentBreakpoint:"desktop",i=r==="default"?r:r.id,s,o,u=typeof e.breakpoint!="undefined"&&typeof e.breakpoint[i]!="undefined"?e.breakpoint[i]:!1;s=typeof u.top_bg_padding_num!="undefined"?u.top_bg_padding_num:typeof e.top_bg_padding_num!="undefined"?e.top_bg_padding_num:!1,o=typeof u.bottom_bg_padding_num!="undefined"?u.bottom_bg_padding_num:typeof e.bottom_bg_padding_num!="undefined"?e.bottom_bg_padding_num:!1,t.css({"padding-top":!1===s?"":s+"px","padding-bottom":!1===o?"":o+"px"})},add_responsive_items:function(){var n=this,r=n.$el.parents(".upfront-region"),i=n.model.get_sub_regions(),s=e('<span class="open-responsive-item-controls"></span>'),o=e('<div class="responsive-item-controls">'+t.add_region+"</div>"),u=e('<div class="responsive-item-control responsive-add-region-top">'+t.above+"</div>"),a=e('<div class="responsive-item-control responsive-add-region-bottom">'+t.below+"</div>"),f=e('<div class="responsive-item-control responsive-add-region-left">'+t.left_sidebar+"</div>"),l=e('<div class="responsive-item-control responsive-add-region-right">'+t.right_sidebar+"</div>");r.find(".open-responsive-item-controls").length===0&&(s.click(function(){r.toggleClass("controls-visible")}),r.append(s)),u.click(function(){n.add_panel_top.$el.find(".upfront-icon").trigger("click"),r.toggleClass("controls-visible")}),o.append(u),a.click(function(){n.add_panel_bottom.$el.find(".upfront-icon").trigger("click"),r.toggleClass("controls-visible")}),o.append(a),n.model.is_main()&&this.model.get("allow_sidebar")&&(i.left===!1&&(f.click(function(){n.add_panel_left.$el.find(".upfront-icon").trigger("click"),r.toggleClass("controls-visible")}),o.append(f)),i.right===!1&&(l.click(function(){n.add_panel_right.$el.find(".upfront-icon").trigger("click"),r.toggleClass("controls-visible")}),o.append(l))),r.find(".responsive-item-controls").remove(),r.append(o)},remove:function(){this.add_panel_top.remove(),this.add_panel_bottom.remove(),this.edit_panel=!1,this.delete_panel=!1,this.add_panel_top=!1,this.add_panel_bottom=!1,this.model.is_main()&&this.model.get("allow_sidebar")&&(this.add_panel_left.remove(),this.add_panel_right.remove(),this.add_panel_left=!1,this.add_panel_right=!1),e(window).off("scroll",this,this.on_scroll),Backbone.View.prototype.remove.call(this)}}),pr=hr.extend({className:"upfront-inline-panels upfront-region-fixed-panels upfront-ui",initialize:function(){var e=this.model.get("container"),t=this.model.get("name");this.listenTo(this.model.collection,"add",this.render),this.listenTo(this.model.collection,"remove",this.render),this.listenTo(Upfront.Events,"entity:region:activated",this.on_region_active),this.listenTo(Upfront.Events,"entity:region:deactivated",this.on_region_deactive),this.add_panel_top_left=new cr({model:this.model,to:"top-left",width:50,height:50}),this.add_panel_top_right=new cr({model:this.model,to:"top-right",width:50,height:50}),this.add_panel_bottom_left=new cr({model:this.model,to:"bottom-left",width:50,height:50}),this.add_panel_bottom_right=new cr({model:this.model,to:"bottom-right",width:50,height:50})},panels:function(){var e=_([]);return e.push(this.add_panel_top_left),e.push(this.add_panel_top_right),e.push(this.add_panel_bottom_left),e.push(this.add_panel_bottom_right),this._panels=e,e},on_region_active:function(t){if(t.model!=this.model)return;var n=e(Upfront.Settings.LayoutEditor.Selectors.main);n.hasClass("upfront-region-fixed-editing")&&(this.on_active(),this.listenToOnce(Upfront.Events,"sidebar:toggle:done",this.update_pos),e(window).on("scroll",this,this.on_scroll))},remove:function(){this.add_panel_top_left.remove(),this.add_panel_top_right.remove(),this.add_panel_bottom_left.remove(),this.add_panel_bottom_right.remove(),this.add_panel_top_left=!1,this.add_panel_top_right=!1,this.add_panel_bottom_left=!1,this.add_panel_bottom_right=!1,Backbone.View.prototype.remove.call(this)}}),dr=Backbone.View.extend({className:"upfront-region-fixed-edit-pos",initialize:function(){},render:function(){var e=this,n=Upfront.Settings.LayoutEditor.Grid,r=this.model.get_property_value_by_name("top"),i=typeof r=="number",s=this.model.get_property_value_by_name("left"),o=typeof s=="number",u=this.model.get_property_value_by_name("bottom"),a=typeof u=="number",f=this.model.get_property_value_by_name("right"),l=typeof f=="number",c=function(){var e=this.get_value(),t=this.get_saved_value();e!=t&&this.property.set({value:e})};this.fields={width:new Upfront.Views.Editor.Field.Number({model:this.model,property:"width",label:t.width,label_style:"inline",min:3*n.column_width,max:Math.floor(n.size/2)*n.column_width}),height:new Upfront.Views.Editor.Field.Number({model:this.model,property:"height",label:t.height,label_style:"inline",min:3*n.baseline})},i||!a?this.fields.top=new Upfront.Views.Editor.Field.Number({model:this.model,property:"top",label:t.top,label_style:"inline",min:0}):this.fields.bottom=new Upfront.Views.Editor.Field.Number({model:this.model,property:"bottom",label:t.bottom,label_style:"inline",min:0}),o||!l?this.fields.left=new Upfront.Views.Editor.Field.Number({model:this.model,property:"left",label:t.left,label_style:"inline",min:0}):this.fields.right=new Upfront.Views.Editor.Field.Number({model:this.model,property:"right",label:t.right,label_style:"inline",min:0}),_.each(this.fields,function(t){t.render(),t.delegateEvents(),e.$el.append(t.$el)})},update_fields:function(){_.each(this.fields,function(e){var t=e.get_saved_value();e.set_value(t)})}}),vr=Backbone.Model.extend({defaults:{"default":!1,name:"Breakpoint",short_name:"breakpoint",fixed:!1,enabled:!1,active:!1,width:240,columns:5,typography:{},styles:""},initialize:function(){this.attributes.columns===0&&this.attributes.width>0&&(this.attributes.columns=Math.round(this.attributes.width/45)),this.on("change:width",this.update_columns,this),this.on("change:columns",this.update_width,this),this.on("change:name",this.update_short_name,this)},update_width:function(e,t){var n=parseInt(t,10);if(n>24){this.set({columns:24});return}if(n<5){this.set({columns:5});return}this.attributes.width=n*45},update_columns:function(e,t){var n,r=parseInt(t,10);if(r>1080){this.set({width:1080});return}if(r<240){this.set({width:240});return}n=Math.round(r/45),this.attributes.columns!==n&&(this.attributes.columns=n)},update_short_name:function(e,t){this.attributes.short_name=t},get_property_value_by_name:function(e){return this.get(e)},set_property:function(e,t){var n={};n[e]=t,this.set(n)}}),mr=Backbone.Collection.extend({model:vr,initialize:function(){this.on("change:active",this.on_change_active,this),this.on("change:enabled",this.on_change_enabled,this),this.on("change:width",this.on_change_width,this)},on_change_active:function(t){var n=this.active?this.active.toJSON():!1;this.prev_active=this.active,this.active=t,_.each(this.models,function(e){if(e.get("id")===t.get("id"))return;e.set({active:!1},{silent:!0})}),Upfront.Events.trigger("upfront:layout_size:change_breakpoint",t.toJSON(),n),this.prev_active&&e("#page").removeClass(this.prev_active.get("id")+"-breakpoint"),e("#page").addClass(this.active.get("id")+"-breakpoint"),this.active.get("default")?e("#page").removeClass("responsive-breakpoint").addClass("default-breakpoint"):e("#page").removeClass("default-breakpoint").addClass("responsive-breakpoint")},on_change_enabled:function(e){if(e.get("active")===!1)return;var t=this.get_default();t.set({active:!0})},on_change_width:function(e,t){Upfront.Events.trigger("upfront:layout_size:viewport_width_change",t)},sorted_by_width:function(){return _.sortBy(this.models,function(e){return e.get("width")})},get_active:function(){var e=this.findWhere({active:!0});return _.isUndefined(e)===!1?e:(e=this.get_default(),e.set({active:!0}),e)},get_enabled:function(){var e=this.where({enabled:!0});return _.isUndefined(e)===!1&&e.length>0?e:[this.get_active()]},get_default:function(){var e=this.findWhere({"default":!0});_.isUndefined(e)&&(e=this.findWhere({id:"desktop"}),e&&e.set({"default":!0}));if(_.isUndefined(e))throw"Breakpoints are not loaded properly.";return e},get_unique_id:function(){var e="custom-"+ +(new Date);while(!_.isUndefined(this.findWhere({id:e})))e="custom-"+ +(new Date);return e}}),gr=function(n){var r,i=function(){r=new mr(n);var t=r.get_default();t.set({active:!0}),r.on("change:enabled change:width change:name add remove change:typography change:styles",s),_.each(r.models,function(t){var n=e("#"+t.get("id")+"-breakpoint-style");if(n.length>0)return;e("body").append('<style id="'+t.get("id")+'-breakpoint-style">'+t.get("styles")+"</style>")})};this.get_breakpoints=function(){return r};var s=function(){var e={action:"upfront_update_breakpoints",breakpoints:r.toJSON()};Upfront.Util.post(e).error(function(){return tr.addMessage(t.breakpoint_save_fail)})};Upfront.Events.once("application:mode:before_switch",i)},yr=new gr(Upfront.mainData.themeInfo.breakpoints),br=Backbone.View.extend({tagName:"li",template:"{{ short_name }} ({{ width }}px)",className:function(){return this.model.get("id")+"-breakpoint-activate"},events:{click:"on_click"},initialize:function(e){this.options=e||{}},render:function(){return this.$el.html(_.template(this.template,this.model.toJSON())),this.model.get("active")&&this.$el.addClass("active"),this},on_click:function(){this.model.set({active:!0})}}),wr=Backbone.View.extend({tagName:"ul",className:"breakpoints-toggler",initialize:function(){this.collection=yr.get_breakpoints(),this.listenTo(this.collection,"add remove change",this.render)},render:function(){return this.$el.html(""),_.each(this.collection.sorted_by_width(),function(e){if(e.get("enabled")===!1)return;var t=new br({model:e});this.$el.append(t.render().el)},this),this}}),Er=Backbone.View.extend({className:"breakpoint-width-input",initialize:function(e){this.options=e||{},this.collection=yr.get_breakpoints(),this.listenTo(this.collection,"change:active",this.render)},render:function(){this.$el.html(""),this.active_breakpoint=this.collection.get_active();var e=_.debounce(this.propagate_change,1e3);return this.active_breakpoint.get("fixed")?this:(this.input=new Upfront.Views.Editor.Field.Number({className:"inline-number plaintext-settings",min:1,label:t.viewport_width,suffix:t.px,default_value:this.active_breakpoint.get("width")}),this.input.render(),this.$el.html(this.input.el),this.listenTo(this.input,"changed",e),this)},propagate_change:function(){this.active_breakpoint.set({width:this.input.get_value()})}}),Sr=Backbone.View.extend({className:"breakpoint-edit-panel",template:'<div><span class="edit-breakpoint-popup-title">'+t.set_custom_breakpoint+":</span></div>"+"<div>"+'<label for="breakpoint-name">'+t.name+':</label><input type="text" value="{{ name }}" placeholder="'+t.custom_breakpoint_placeholder+'" id="breakpoint-name" />'+"</div><div>"+'<label for="breakpoint-width">'+t.width+':</label><input type="number" min="240" max="1080" value="{{ width }}" id="breakpoint-width" /><label>'+t.px+"</label>"+'<label for="breakpoint-columns">'+t.number_of_columns+':</label><input min="5" max="24" type="number" value="{{ columns }}" id="breakpoint-columns" />'+"</div>",events:{"change #breakpoint-name":"on_name_change","change #breakpoint-width":"on_width_change","change #breakpoint-columns":"on_columns_change"},initialize:function(e){this.options=e||{},_.isUndefined(this.model)&&(this.model=yr.get_breakpoints().get_active()),this.listenTo(this.model,"change",this.update_values),this.lazy_change_width=_.debounce(function(e){this.model.set({width:e})},500)},render:function(){return this.$el.html(_.template(this.template,this.model.toJSON())),this},update_values:function(){this.$el.find("#breakpoint-name").val(this.model.get("name")),this.$el.find("#breakpoint-width").val(this.model.get("width")),this.$el.find("#breakpoint-columns").val(this.model.get("columns"))},on_name_change:function(t){this.model.set({name:e(t.currentTarget).val()})},on_width_change:function(t){this.lazy_change_width(e(t.currentTarget).val())},on_columns_change:function(t){this.model.set({columns:e(t.currentTarget).val()})}}),xr=Backbone.View.extend({className:"breakpoint-edit",events:{"click #edit-breakpoint":"edit_breakpoint"},initialize:function(e){this.options=e||{},this.collection=yr.get_breakpoints(),this.listenTo(this.collection,"change:active",this.render)},render:function(){return this.$el.html(""),this.active_breakpoint=this.collection.get_active(),this.active_breakpoint.get("fixed")?this:(this.$el.html('<a href="" id="edit-breakpoint">'+t.edit_breakpoint+"</a>"),this)},edit_breakpoint:function(n){n.preventDefault();var r;r=Upfront.Popup.open(function(n,r,i){r.empty();var s=e(this),o=new Sr;s.append(o.render().el),i.append('<div class="breakpoint-edit-ok-button">'+t.ok+"</div>"),e("#upfront-popup-close").hide(),e(".breakpoint-edit-ok-button").on("click",function(){Upfront.Popup.close(),e("#upfront-popup-close").show()})},{width:400})}}),Tr=Backbone.View.extend({id:"upfront-ui-topbar",content_views:[],initialize:function(){this.listenTo(Upfront.Events,"sidebar:toggle",this.on_sidebar_toggle)},render:function(){return _.each(this.content_views,function(e){e.render(),this.$el.append(e.el)},this),this},start:function(){this.content_views=[],Upfront.Application.get_current()===Upfront.Settings.Application.MODE.RESPONSIVE&&(this.content_views.push(new xr),this.content_views.push(new wr)),e("body").prepend(this.render().el)},stop:function(){this.remove()},on_sidebar_toggle:function(e){e?this.$el.css("left",""):this.$el.css("left",0)}});return{Editor:{Property:h,Properties:p,Commands:it,Command:d,Command_SaveLayout:b,Command_SavePostLayout:E,Command_CancelPostLayout:S,Command_Undo:C,Command_ToggleGrid:D,Command_Merge:A,Settings:{Settings:dn,Panel:pn,Item:cn,ItemTabbed:hn,Lightbox:{Trigger:$n,LabeledTrigger:Jn},Anchor:{Trigger:Kn,LabeledTrigger:Qn},Settings_CSS:mn,AnchorSetting:Vn},Button:{Presets:bn},Fonts:{System:kn,Google:Nn,Text_Fonts_Manager:Rn,Icon_Fonts_Manager:qn,theme_fonts_collection:On,icon_fonts_collection:Dn},Field:{Field:zt,Text:Wt,Button:Vt,Email:$t,Textarea:Jt,Color:Yt,Multiple_Suggest:ln,Chosen_Select:tn,Typeface_Chosen_Select:nn,Typeface_Style_Chosen_Select:rn,Multiple_Chosen_Select:sn,Number:Kt,Slider:Qt,Select:en,Radios:un,Checkboxes:an,Hidden:Gt,Anchor:Gn,Optional:fn},Sidebar:{Sidebar:Dt,Panel:st,Element:at},Topbar:{Topbar:Tr},notify:function(e,t,n){tr.addMessage(e,t,n)},Loading:ir,Modal:sr,ModalBgSetting:or,PostSelector:new rr,InlinePanels:l,RegionPanels:hr,RegionPanelsAddRegion:lr,RegionFixedPanels:pr,RegionFixedEditPosition:dr,CSSEditor:zn,Insert_Font_Widget:Un,GeneralCSSEditor:Wn,LinkPanel:o},Mixins:{Upfront_Scroll_Mixin:c},Theme_Colors:bt,breakpoints_storage:yr,Font_Model:Sn}})}(jQuery),function(e){var t={selection:[],selecting:!1,create_mergeable:function(t,n){var r=this,i=Upfront.Behaviors.LayoutEditor,s=r.layout.get("regions");t.$el.selectable({distance:10,filter:".upfront-module",cancel:".upfront-module:not(.upfront-module-spacer), .upfront-module-group, .upfront-region-side-fixed, .upfront-entity_meta, .upfront-region-edit-trigger, .upfront-region-edit-fixed-trigger, .upfront-region-finish-edit, .upfront-icon-control-region-resize, .upfront-inline-modal, .upfront-inline-panels",selecting:function(t,n){var r=e(n.selecting),s,o,u,a,f;if(r.closest(".upfront-module-group").length>0)return;if(i.selection.length>0){s=e(i.selection[0]).closest(".upfront-region");if(r.closest(".upfront-region").get(0)!=s.get(0))return;i._add_selections(s.find(".ui-selecting"),s.find(".upfront-module").not(".upfront-ui-selected, .upfront-module-parent-group"),s.find(".upfront-module-group"))}else i._add_selection(n.selecting);i._update_selection_outline()},unselecting:function(t,n){var r=e(n.unselecting),s,o;if(i.selection.length>1){s=e(i.selection[0]).closest(".upfront-region");if(r.closest(".upfront-region").get(0)!=s.get(0))return;e(".upfront-ui-selected").each(function(){i._remove_selection(this)}),o=s.find(".ui-selecting"),o.length>0&&(i._add_selection(o.get(0)),i._add_selections(o,s.find(".upfront-module").not(".upfront-ui-selected, .upfront-module-parent-group"),s.find(".upfront-module-group"))),i._update_selection_outline();return}i._remove_selection(n.unselecting),i._update_selection_outline()},unselected:function(t,n){var r=e(n.unselected);r.find(".upfront-selected-border").remove(),e(".upfront-module-group-group").remove()},start:function(e,t){i.remove_selections(),i.selection=[],i.selecting=!0},stop:function(e,t){i.parse_selections()}})},refresh_mergeable:function(){this.remove_selections(),e(".ui-selectable").each(function(){e(this).selectable("refresh")})},enable_mergeable:function(){this.remove_selections(),e(".ui-selectable").each(function(){e(this).selectable("enable")})},disable_mergeable:function(){this.remove_selections(),e(".ui-selectable").each(function(){e(this).selectable("disable")})},destroy_mergeable:function(){this.remove_selections(),e(".ui-selectable").each(function(){e(this).selectable("destroy")})},parse_selections:function(){if(!e(".upfront-ui-selected").length)return!1;var t=this,n=Upfront.Application.layout.get("regions"),r=e(".upfront-ui-selected:first").closest(".upfront-region"),i=n.get_by_name(r.data("name")),s=i?i.get("modules"):!1,o=i?i.get("wrappers"):!1,u=function(){e(this).find(".upfront-selected-border").remove(),e(this).removeClass("upfront-ui-selected ui-selected")},a=e(".upfront-ui-selected");if(a.length<2)return a.each(function(){t._remove_selection(this)}),e("#upfront-group-selection").remove(),!1;e(".upfront-module-group-group").remove();var f=e('<div class="upfront-module-group-toggle upfront-module-group-group">'+Upfront.Settings.l10n.global.behaviors.group+"</div>"),l=sel_left=sel_right=sel_bottom=!1,c=wrap_left=wrap_right=wrap_bottom=!1,h=group_left=0;e("body").append(f),a.each(function(){var t=e(this).offset(),n=e(this).outerWidth(),r=e(this).outerHeight(),i=e(this).closest(".upfront-wrapper"),s=i.offset(),o=i.outerWidth(),u=i.outerHeight();t.right=t.left+n,t.bottom=t.top+r,l=l===!1||t.top<l?t.top:l,sel_bottom=sel_bottom===!1||t.bottom>sel_bottom?t.bottom:sel_bottom,sel_left=sel_left===!1||t.left<sel_left?t.left:sel_left,sel_right=sel_right===!1||t.right>sel_right?t.right:sel_right,s.right=s.left+o,s.bottom=s.top+u,c=c===!1||s.top<c?s.top:c,wrap_bottom=wrap_bottom===!1||s.bottom>wrap_bottom?s.bottom:wrap_bottom,wrap_left=wrap_left===!1||s.left<wrap_left?s.left:wrap_left,wrap_right=wrap_right===!1||s.right>wrap_right?s.right:wrap_right}),h=l+Math.round((sel_bottom-l)/2)-Math.round(f.outerHeight()/2),group_left=sel_left+Math.round((sel_right-sel_left)/2)-Math.round(f.outerWidth()/2),f.css({position:"absolute",zIndex:999999,top:h,left:group_left}),setTimeout(function(){t.selecting=!1},1e3),f.on("click",function(){var n=Upfront.Views.breakpoints_storage.get_breakpoints().get_active().toJSON(),u=Upfront.Behaviors.GridEditor,f=!1,l=Math.round((wrap_right-wrap_left)/u.grid.column_width),c=u.parse_modules_to_lines(s,o,n.id,n.columns),h=[],p=[],d=[],v=!1,m=!1,g=0,y=0,b=0,w=!1;_.each(c,function(t){var n=[],r=[],i=[],s=[],o=[],u=0,l=0,c=0;_.each(t.wrappers,function(t){var h=[],p=[],d=[];_.each(t.modules,function(t){var n=!1;a.each(function(){var r=e(this).attr("id"),i;t.model.get_element_id()==r&&(f===!1&&(f=Upfront.data.module_views[t.model.cid]),h.push(t),n=!0)}),n||(h.length==0?p.push(t):d.push(t))}),h.length>0?(n.push({modules:h,top_modules:p,bottom_modules:d,model:t.model,col:t.col,clear:t.clear,spacer:t.spacer,order:t.order}),u+=t.col,p.length&&s.push({modules:p,model:t.model,col:t.col,clear:t.clear,spacer:t.spacer,order:t.order}),d.length&&o.push({modules:d,model:t.model,col:t.col,clear:t.clear,spacer:t.spacer,order:t.order})):((n.length==0?r:i).push({modules:t.modules,model:t.model,col:t.col,clear:t.clear,spacer:t.spacer,order:t.order}),n.length==0?l+=t.col:c+=t.col)}),n.length>0&&(h.push({wrappers:n,top_wrappers:s,bottom_wrappers:o,col:u}),g=u>g?u:g,r.length>0&&(p.push({wrappers:r,col:l}),y=l>y?l:y),i.length>0&&(d.push({wrappers:i,col:c}),b=c>b?c:b))}),u.start(f,f.model),p.length>1&&(t._do_combine(p,i)||t._do_group(p,i)),p.length==0&&d.length==0&&(w=!0),t._do_group(h,i,!1,w),d.length>1&&(t._do_combine(d,i)||t._do_group(d,i)),u.update_position_data(r.find(".upfront-editable_entities_container:first")),u.update_wrappers(i),e(this).remove(),e("#upfront-group-selection").remove(),t.selection=[]})},_do_group:function(e,t,n,r){var i=this,s=Upfront.Behaviors.GridEditor,o=n===!0,r=r===!0,u=t.get("modules"),a=t.get("wrappers"),f=Upfront.Util.get_unique_id("module-group"),l=new Upfront.Models.ModuleGroup,c=!1,h=l.get("modules"),p=l.get("wrappers"),d=!1,v=!1,m=!1,g=0,y=!1,b=!1;_.each(e,function(e,n){g=e.col>g?e.col:g,_.each(e.wrappers,function(e,t){var r=new Upfront.Models.Wrapper({}),i=Upfront.Util.get_unique_id("wrapper"),o=Upfront.data.wrapper_views[e.model.cid],f="top_modules"in e&&e.top_modules.length>0,l="bottom_modules"in e&&e.bottom_modules.length>0;r.set_property("wrapper_id",i),r.set_property("class",e.model.get_property_value_by_name("class")),r.replace_class(s.grid.class+e.col),t==0&&(r.add_class("clr"),n==0&&(d=e.clear)),p.add(r),_.each(e.modules,function(e,t){var n=u.indexOf(e.model),r=Upfront.data.module_views[e.model.cid];y===!1&&(y=n),e.model.set_property("wrapper_id",i,!0),u.remove(e.model,{silent:!0}),r.$el.detach(),!f&&!l&&o.$el.detach(),h.add(e.model)}),n==0&&t==0?(m=e.model.get_wrapper_id(),v=e.model):f||a.remove(e.model)}),"bottom_wrappers"in e&&e.bottom_wrappers.length>1&&(r?i._do_split(e.bottom_wrappers,t):i._do_group([{wrappers:e.bottom_wrappers,col:e.col}],t)),"top_wrappers"in e&&e.top_wrappers.length>1&&(r?(_.each(e.top_wrappers,function(e,t){_.each(e.modules,function(e,t){var n=u.indexOf(e.model);if(b===!1){b=n;return}u.remove(e.model,{silent:!0}),b++,e.model.add_to(u,b)})}),b!==!1&&(y=b+1),o=!0):i._do_group([{wrappers:e.top_wrappers,col:e.col}],t))}),o&&(v=new Upfront.Models.Wrapper({}),m=Upfront.Util.get_unique_id("wrapper"),a.add(v)),v.set_property("wrapper_id",m),v.replace_class(s.grid.class+g),d&&v.add_class("clr"),l.set_property("wrapper_id",m),l.set_property("element_id",f),l.replace_class(s.grid.class+g),l.set_property("original_col",g),l.add_to(u,y),Upfront.Events.trigger("entity:module_group:group",l,t)},_do_combine:function(e,t){var n=this,r=Upfront.Behaviors.GridEditor,i=t.get("modules"),s=t.get("wrappers"),o=[],u=[],a=!0;_.each(e,function(e,t){t in o||(o[t]=[]),_.each(e.wrappers,function(e,n){n in u||(u[n]=[]),o[t][n]=e.col,u[n].push(e)})});if(o.length>1)for(var f=1;f<o.length;f++)if(!_.isEqual(o[f-1],o[f])){a=!1;break}return a?(_.each(u,function(e){var t=0,n=_.filter(e,function(e){return e.spacer}),r=e.length==n.length,o;_.each(e,function(e,n){if(n==0){o=e.model.get_wrapper_id(),t=i.indexOf(_.last(e.modules).model),e.spacer&&!r&&(_.each(e.modules,function(e){i.remove(e.model)}),t--);return}s.remove(e.model),e.spacer?_.each(e.modules,function(e){i.remove(e.model)}):_.each(e.modules,function(e,n){e.model.set_property("wrapper_id",o,!0),i.remove(e.model,{silent:!0}),t++,e.model.add_to(i,t)})})}),!0):!1},_do_split:function(e,t){var n=this,r=Upfront.Behaviors.GridEditor,i=t.get("modules"),s=t.get("wrappers");return _.each(e,function(e,t){var n=new Upfront.Models.Wrapper({}),r=Upfront.Util.get_unique_id("wrapper");n.set_property("wrapper_id",r),n.set_property("class",e.model.get_property_value_by_name("class")),s.add(n),_.each(e.modules,function(e,t){var n=i.indexOf(e.model);e.model.set_property("wrapper_id",r,!0),i.remove(e.model,{silent:!0}),e.model.add_to(i,n)})}),!0},_get_group_position:function(t){var n=sel_left=sel_right=sel_bottom=!1,r=wrap_left=wrap_right=wrap_bottom=!1;return t.each(function(){var t=e(this).offset(),i=Math.round(parseFloat(e(this).css("width"))),s=Math.round(parseFloat(e(this).css("height"))),o=e(this).closest(".upfront-wrapper"),u=o.offset(),a=Math.round(parseFloat(o.css("width"))),f=Math.round(parseFloat(o.css("height")));t.left=Math.round(t.left),t.top=Math.round(t.top),t.right=t.left+i,t.bottom=t.top+s,n=n===!1||t.top<n?t.top:n,sel_bottom=sel_bottom===!1||t.bottom>sel_bottom?t.bottom:sel_bottom,sel_left=sel_left===!1||t.left<sel_left?t.left:sel_left,sel_right=sel_right===!1||t.right>sel_right?t.right:sel_right,u.left=Math.round(u.left),u.top=Math.round(u.top),u.right=u.left+a,u.bottom=u.top+f,r=r===!1||u.top<r?u.top:r,wrap_bottom=wrap_bottom===!1||u.bottom>wrap_bottom?u.bottom:wrap_bottom,wrap_left=wrap_left===!1||u.left<wrap_left?u.left:wrap_left,wrap_right=wrap_right===!1||u.right>wrap_right?u.right:wrap_right}),{element:{top:n,bottom:sel_bottom,left:sel_left,right:sel_right},wrapper:{top:r,bottom:wrap_bottom,left:wrap_left,right:wrap_right}}},_find_affected_el:function(t,n){if(this.selection.length==0)return!1;var r=!1;return t.each(function(){var t=e(this).offset(),i=Math.round(parseFloat(e(this).css("width"))),s=Math.round(parseFloat(e(this).css("height"))),o=Math.round(t.top),u=Math.round(t.left),a=o+s,f=u+i;n.top<a&&n.bottom>o&&n.left<f&&n.right>u&&(r=r!==!1?r.add(e(this)):e(this))}),r},_update_selection_outline:function(){var t=e("#upfront-group-selection"),n=this._get_group_position(e(this.selection));t.length||(t=e('<div id="upfront-group-selection" />'),t.appendTo("body")),t.css({top:n.element.top,left:n.element.left,height:n.element.bottom-n.element.top,width:n.element.right-n.element.left})},_add_selection:function(t){var n=_.find(this.selection,function(e){return e==t});if(n)return;this.selection.push(t),e(t).addClass("upfront-ui-selected")},_add_selections:function(t,n,r){var i=this,s=[],o,u,a;t.each(function(){var t=this,f=_.find(i.selection,function(e){return e==t}),l=e(n);if(f)return;s=[],o=i._get_group_position(e(i.selection).add(this)),u=i._find_affected_el(l,o.element);while(u!==!1)u.each(function(){s.push(this)}),l=l.not(u),o=i._get_group_position(e(i.selection).add(s)),u=i._find_affected_el(l,o.element);a=i._find_affected_el(r,o.element);if(a!==!1)return;_.each(s,function(e){i._add_selection(e)})});return},_remove_selection:function(t){this.selection=_.reject(this.selection,function(e){return e==t}),e(t).find(".upfront-selected-border").remove(),e(t).removeClass("upfront-ui-selected ui-selected")},remove_selections:function(){var t=Upfront.Behaviors.LayoutEditor;e(".upfront-ui-selected").each(function(){t._remove_selection(this)}),t._update_selection_outline(),e(".upfront-module-group-group").remove()},create_undo:function(){this.layout.store_undo_state()},apply_history_change:function(){var e=Upfront.Application.layout.get("regions"),t=e?e.get_by_name("shadow"):!1;e&&t&&(e.remove(t),t=!1),Upfront.Application.layout_view.render()},save_dialog:function(t,n){e("body").append("<div id='upfront-save-dialog-background' />"),e("body").append("<div id='upfront-save-dialog' />");var r=e("#upfront-save-dialog"),i=e("#upfront-save-dialog-background"),s=Upfront.Application.layout.get("current_layout"),o="";o+="<p>"+Upfront.Settings.l10n.global.behaviors.this_post_only+"</p>",e.each(_upfront_post_data.layout,function(e,t){if(e=="type")return;o+='<span class="upfront-save-button" data-save-as="'+t+'">'+Upfront.Settings.LayoutEditor.Specificity[e]+"</span>"}),location.pathname.indexOf("create_new")>-1?(i.remove(),r.remove(),t.apply(n,["single-post"])):(r.html(o),e("#upfront-save-dialog").on("click",".upfront-save-button",function(){var s=e(this).attr("data-save-as");return i.remove(),r.remove(),t.apply(n,[s]),!1}),e("#upfront-save-dialog-background").on("click",function(){return i.remove(),r.remove(),!1}))},load_theme:function(e){var t=location.origin;t+=location.pathname.split("create_new")[0],t+="create_new/"+e,location.toString().indexOf("dev=true")>-1&&(t+="?dev=true"),window.location=t},open_theme_fonts_manager:function(){var t={},n=new Upfront.Views.Editor.Fonts.Text_Fonts_Manager({collection:Upfront.Views.Editor.Fonts.theme_fonts_collection});n.render();if(Upfront.Application.mode.current===Upfront.Application.MODE.THEME){var r=new Upfront.Views.Editor.Fonts.Icon_Fonts_Manager({collection:Upfront.Views.Editor.Fonts.icon_fonts_collection});r.render()}var i=Upfront.Popup.open(function(n,r,i){var s=e(this);s.empty().append('<p class="upfront-popup-placeholder">'+Upfront.Settings.l10n.global.behaviors.loading_content+"</p>"),t.$popup={top:r,content:s,bottom:i}},{width:750},"font-manager-popup");t.$popup.top.html('<ul class="upfront-tabs"><li id="theme-text-fonts-tab" class="active">'+Upfront.Settings.l10n.global.behaviors.theme_text_fonts+"</li>"+(Upfront.Application.mode.current===Upfront.Application.MODE.THEME?'<li id="theme-icon-fonts-tab">'+Upfront.Settings.l10n.global.behaviors.theme_icon_fonts+"</li>":"")+"</ul>"+t.$popup.top.html()),t.$popup.top.on("click","#theme-text-fonts-tab",function(r){t.$popup.content.html(n.el),e("#theme-icon-fonts-tab").removeClass("active"),e("#theme-text-fonts-tab").addClass("active"),e(".theme-fonts-ok-button").css("margin-top","30px")}),t.$popup.top.on("click","#theme-icon-fonts-tab",function(){t.$popup.content.html(r.el),e("#theme-text-fonts-tab").removeClass("active"),e("#theme-icon-fonts-tab").addClass("active"),e(".theme-fonts-ok-button").css("margin-top",0)}),t.$popup.bottom.append('<a class="theme-fonts-ok-button">'+Upfront.Settings.l10n.global.behaviors.ok+"</a>"),t.$popup.content.html(n.el),n.set_ok_button(t.$popup.bottom.find(".theme-fonts-ok-button")),t.$popup.bottom.find(".theme-fonts-ok-button").on("click",function(){Upfront.Popup.close()})},create_layout_dialog:function(){var t=Upfront.Application,n=Upfront.Behaviors.LayoutEditor,r={layout:new Upfront.Views.Editor.Field.Select({name:"layout",values:[{label:Upfront.Settings.l10n.global.behaviors.loading,value:""}],change:function(){var e=this.get_value();e==="single-page"?r.$_page_name_wrap.show():r.$_page_name_wrap.hide()}}),page_name:new Upfront.Views.Editor.Field.Text({name:"page_name",label:Upfront.Settings.l10n.global.behaviors.page_layout_name}),inherit:new Upfront.Views.Editor.Field.Radios({name:"inherit",layout:"horizontal-inline",values:[{label:Upfront.Settings.l10n.global.behaviors.start_fresh,value:""},{label:Upfront.Settings.l10n.global.behaviors.start_from_existing,value:"existing"}]}),existing:new Upfront.Views.Editor.Field.Select({name:"existing",values:[]})};n.available_layouts?r.layout.options.values=_.map(n.available_layouts,function(e,t){return{label:e.label,value:t,disabled:e.saved}}):Upfront.Util.post({action:"upfront_list_available_layout"}).done(function(e){n.available_layouts=e.data,r.layout.options.values=_.map(n.available_layouts,function(e,t){return{label:e.label,value:t,disabled:e.saved}}),r.layout.render(),r.layout.delegateEvents()}),n.all_templates?r.existing.options.values=_.map(n.all_templates,function(e,t){return{label:t,value:e}}):Upfront.Util.post({action:"upfront-wp-model",model_action:"get_post_extra",postId:"fake",allTemplates:!0}).done(function(e){if(!e.data||!e.data.allTemplates)return!1;if(0===e.data.allTemplates.length)return r.inherit.$el.hide(),r.existing.$el.hide(),!1;n.all_templates=e.data.allTemplates,r.existing.options.values=[],_.each(e.data.allTemplates,function(e,t){r.existing.options.values.push({label:t,value:e})}),r.existing.render()}),n.layout_modal||(n.layout_modal=new Upfront.Views.Editor.Modal({to:e("body"),button:!1,top:120,width:540}),n.layout_modal.render(),e("body").append(n.layout_modal.el)),n.layout_modal.open(function(t,i){var s=e('<div style="clear:both"><span class="uf-button">'+Upfront.Settings.l10n.global.behaviors.create+"</span></div>"),o=e('<div class="upfront-modal-select-wrap" />');$page_name_wrap=e('<div class="upfront-modal-select-wrap" />'),r.$_page_name_wrap=$page_name_wrap,_.each(r,function(e){if(!e.render)return!0;e.render(),e.delegateEvents()}),t.html('<h1 class="upfront-modal-title">'+Upfront.Settings.l10n.global.behaviors.create_new_layout+"</h1>"),o.append(r.layout.el),t.append(o),$page_name_wrap.hide(),$page_name_wrap.append(r.page_name.el),$page_name_wrap.append(r.inherit.el),$page_name_wrap.append(r.existing.el),t.append($page_name_wrap),t.append(s),s.on("click",function(){n.layout_modal.close(!0)})},n).done(function(){var e=r.layout.get_value(),i=t.layout.get("layout_slug"),s=_.extend({},n.available_layouts[e]),o=r.page_name.get_value();e==="single-page"&&o&&(e="single-page-"+o.replace(/\s/g,"-").toLowerCase(),s={layout:{type:"single",item:"single-page",specificity:e}}),s.use_existing=e.match(/^single-page/)&&o&&"existing"===r.inherit.get_value()?r.existing.get_value():!1,t.create_layout(s.layout,{layout_slug:i,use_existing:s.use_existing}).done(function(){t.layout.set("current_layout",e),n._export_layout()})})},browse_layout_dialog:function(){var t=Upfront.Application,n=Upfront.Behaviors.LayoutEditor,r={layout:new Upfront.Views.Editor.Field.Select({name:"layout",values:[{label:Upfront.Settings.l10n.global.behaviors.loading,value:""}],default_value:t.layout.get("current_layout")})};n.browse_modal||(n.browse_modal=new Upfront.Views.Editor.Modal({to:e("body"),button:!1,top:120,width:540}),n.browse_modal.render(),e("body").append(n.browse_modal.el)),n._get_saved_layout().done(function(e){!e||e.length==0?r.layout.options.values=[{label:Upfront.Settings.l10n.global.behaviors.no_saved_layout,value:""}]:r.layout.options.values=_.map(n.saved_layouts,function(e,t){return{label:e.label,value:t}}),r.layout.render(),r.layout.delegateEvents()}),n.browse_modal.open(function(t,i){var s=e('<span class="uf-button">'+Upfront.Settings.l10n.global.behaviors.edit+"</span>"),o=e('<div class="upfront-modal-select-wrap" />');_.each(r,function(e){e.render(),e.delegateEvents()}),t.html('<h1 class="upfront-modal-title">'+Upfront.Settings.l10n.global.behaviors.edit_saved_layout+"</h1>"),o.append(r.layout.el),t.append(o),t.append(s),s.on("click",function(){n.browse_modal.close(!0)})},n).done(function(){var e=r.layout.get_value(),i=t.layout.get("layout_slug"),s=n.saved_layouts[e];s.latest_post&&(_upfront_post_data.post_id=s.latest_post),t.layout.set("current_layout",e),t.load_layout(s.layout,{layout_slug:i})})},is_exporter_start_page:function(){return Upfront.themeExporter.currentTheme==="upfront"},export_dialog:function(){var t=Upfront.Application,n=Upfront.Behaviors.LayoutEditor,r,i;i=new Upfront.Views.Editor.Loading({loading:Upfront.Settings.l10n.global.behaviors.checking_layouts,done:Upfront.Settings.l10n.global.behaviors.layout_exported,fixed:!0}),n.is_exporter_start_page()?(r={theme:new Upfront.Views.Editor.Field.Select({name:"theme",default_value:Upfront.themeExporter.currentTheme==="upfront"?"":Upfront.themeExporter.currentTheme,label:Upfront.Settings.l10n.global.behaviors.select_theme,values:[{label:Upfront.Settings.l10n.global.behaviors.new_theme,value:""}],change:function(){var t=this.get_value(),n=e([r.name.el,r.directory.el,r.author.el,r.author_uri.el]);t!=""?n.hide():n.show()}}),name:new Upfront.Views.Editor.Field.Text({name:"name",label:Upfront.Settings.l10n.global.behaviors.theme_name}),directory:new Upfront.Views.Editor.Field.Text({name:"directory",label:Upfront.Settings.l10n.global.behaviors.directory}),author:new Upfront.Views.Editor.Field.Text({name:"author",label:Upfront.Settings.l10n.global.behaviors.author}),author_uri:new Upfront.Views.Editor.Field.Text({name:"author_uri",label:Upfront.Settings.l10n.global.behaviors.author_uri}),activate:new Upfront.Views.Editor.Field.Checkboxes({name:"activate",default_value:!0,multiple:!1,values:[{label:Upfront.Settings.l10n.global.behaviors.activate_upon_creation,value:1}]}),with_images:new Upfront.Views.Editor.Field.Checkboxes({name:"with_images",default_value:!0,multiple:!1,values:[{label:Upfront.Settings.l10n.global.behaviors.export_theme_images,value:1}]})},n.export_modal||(n.export_modal=new Upfront.Views.Editor.Modal({to:e("body"),button:!1,top:120,width:540}),n.export_modal.render(),e("body").append(n.export_modal.el)),n._get_themes().done(function(e){r.theme.options.values=_.union([{label:Upfront.Settings.l10n.global.behaviors.new_theme,value:""}],_.map(e,function(e,t){return{label:e.name,value:e.directory}})),r.theme.render(),r.theme.delegateEvents(),r.theme.$el.find("input").trigger("change")}),n.export_modal.open(function(t,s){var o=e('<span class="uf-button">'+Upfront.Settings.l10n.global.behaviors.export_button+"</span>");_.each(r,function(e){e.render(),e.delegateEvents()}),t.html('<h1 class="upfront-modal-title">'+Upfront.Settings.l10n.global.behaviors.export_theme+"</h1>"),t.append(r.theme.el),t.append(r.name.el),t.append(r.directory.el),t.append(r.author.el),t.append(r.author_uri.el),t.append(r.activate.el),t.append(r.with_images.el),t.append(o),o.on("click",function(){var t,s,o,u,a;t=r.theme.get_value()?r.theme.get_value():r.directory.get_value(),s=function(){var e={"thx-theme-name":r.name.get_value(),"thx-theme-slug":r.directory.get_value(),"thx-author":r.author.get_value(),"thx-author-uri":r.author_uri.get_value(),"thx-theme-template":"upfront","thx-activate_theme":r.activate.get_value()||"","thx-export_with_images":r.with_images.get_value()||"",add_global_regions:Upfront.Application.current_subapplication.layout.get("layout_slug")!=="blank"};return i.update_loading_text(Upfront.Settings.l10n.global.behaviors.creating_theme),n._create_theme(e)},i.render(),e("body").append(i.el),s().done(function(){n.export_single_layout(i,t).done(function(){n.load_theme(t)})})})},n)):(i.render(),e("body").append(i.el),n.export_single_layout(i,Upfront.themeExporter.currentTheme))},export_single_layout:function(e,t){var n=this,r=Upfront.Application,i=Upfront.Behaviors.LayoutEditor,s=_upfront_post_data.layout.specificity||_upfront_post_data.layout.item||_upfront_post_data.layout.type;return e.update_loading_text(Upfront.Settings.l10n.global.behaviors.exporting_layout+s),i._export_layout({theme:t}).done(function(){e.done(function(){i.export_modal&&i.export_modal.close(!0),i.clean_region_css()})})},first_save_dialog:function(e){var t=Upfront.Application,n=Upfront.Behaviors.LayoutEditor,r=t.layout.get("current_layout");e&&(!r||r=="archive-home")&&n.message_dialog(Upfront.Settings.l10n.global.behaviors.excellent_start,Upfront.Settings.l10n.global.behaviors.homepage_created)},message_dialog:function(t,n){var r=Upfront.Application,i=Upfront.Behaviors.LayoutEditor;i.message_modal||(i.message_modal=new Upfront.Views.Editor.Modal({to:e("body"),button:!0,top:120,width:540}),i.message_modal.render(),e("body").append(i.message_modal.el)),i.message_modal.open(function(e,r){r.addClass("upfront-message-modal"),e.html('<h1 class="upfront-modal-title">'+t+"</h1>"),e.append(n)},i)},_get_saved_layout:function(){var t=this,n=new e.Deferred;return Upfront.Application.is_builder()?Upfront.Util.post({action:"upfront_list_theme_layouts"}).success(function(e){t.saved_layouts=e.data,n.resolve(e.data)}).error(function(){n.reject()}):setTimeout(n.reject),n.promise()},_get_themes:function(){var t=this,n=new e.Deferred;return Upfront.Application.is_builder()?Upfront.Util.post({action:"upfront_thx-get-themes"}).success(function(e){t.themes=e,n.resolve(e)}).error(function(){n.reject()}):setTimeout(n.reject),n.promise()},_create_theme:function(t){var n=new e.Deferred;return Upfront.Application.is_builder()?Upfront.Util.post({action:"upfront_thx-create-theme",form:this._build_query(t)}).success(function(e){e&&e.error?n.reject(e.error):n.resolve()}).error(function(){n.reject()}):setTimeout(n.reject),n.promise()},export_element_styles:function(e){if(!Upfront.Application.is_builder())return!1;Upfront.Util.post({action:"upfront_thx-export-element-styles",data:e}).success(function(t){if(t&&t.error){Upfront.Views.Editor.notify(t.error);return}Upfront.data.styles[e.elementType]||(Upfront.data.styles[e.elementType]=[]),Upfront.data.styles[e.elementType].indexOf(e.stylename)===-1&&Upfront.data.styles[e.elementType].push(e.stylename),Upfront.Views.Editor.notify(Upfront.Settings.l10n.global.behaviors.style_exported)}).error(function(){Upfront.Views.Editor.notify(Upfront.Settings.l10n.global.behaviors.style_export_fail)})},_export_layout:function(t){var n,r,i,s=new e.Deferred,o={};return Upfront.Application.is_builder()?(n=_.findWhere(Upfront.Application.current_subapplication.get_layout_data().properties,{name:"typography"}),i=_.findWhere(Upfront.Application.current_subapplication.get_layout_data().properties,{name:"layout_style"}),r=_.extend({},Upfront.Util.model_to_json(Upfront.Application.current_subapplication.get_layout_data().properties)),r=_.reject(r,function(e){return _.contains(["typography","layout_style","global_regions"],e.name)}),o={typography:n?JSON.stringify(n.value):"",regions:JSON.stringify(Upfront.Application.current_subapplication.get_layout_data().regions),template:_upfront_post_data.layout.specificity||_upfront_post_data.layout.item||_upfront_post_data.layout.type,layout_properties:JSON.stringify(r),theme:Upfront.themeExporter.currentTheme,layout_style:i?i.value:"",theme_colors:{colors:Upfront.Views.Theme_Colors.colors.toJSON(),range:Upfront.Views.Theme_Colors.range},post_image_variants:Upfront.Content.ImageVariants.toJSON()},Upfront.themeExporter.layoutStyleDirty&&(o.layout_style=e("#layout-style").html(),Upfront.themeExporter.layoutStyleDirty=!1),t&&(o=_.extend(o,t)),Upfront.Util.post({action:"upfront_thx-export-layout",data:o}).success(function(e){e&&e.error?s.reject(e.error):s.resolve()}).error(function(){s.reject()}),s.promise()):(setTimeout(s.reject),s.promise())},clean_region_css:function(){var t=this,n=Upfront.Application.cssEditor,r=Upfront.Behaviors.LayoutEditor,i=[n.elementTypes.RegionContainer,n.elementTypes.Region],s=_upfront_post_data.layout,o=s.specificity||s.item||s.type,u=Upfront.Application.layout.get("regions"),a=[],f=[],l=function(t){if(!f[t]){Upfront.Views.Editor.notify(Upfront.Settings.l10n.global.behaviors.region_css_cleaned),c.resolve();return}var n=f[t].elementType,r=f[t].styleName;Upfront.Application.get_current()===Upfront.Settings.Application.MODE.THEME?data={action:"upfront_thx-delete-element-styles",data:{stylename:r,elementType:n}}:data={action:"upfront_delete_styles",styleName:r,elementType:n},Upfront.Util.post(data).done(function(){var i=Upfront.data.styles[n].indexOf(r);i!=-1&&Upfront.data.styles[n].splice(i,1),e("#upfront-style-"+r).remove(),l(t+1)})},c=new e.Deferred;return u.each(function(e){var t=e.is_main()?n.elementTypes.RegionContainer.id:n.elementTypes.Region.id,r=o+"-"+e.get("name")+"-style",i=e.get("scope")=="global";_.isArray(Upfront.data.styles[t])&&Upfront.data.styles[t].indexOf(r)!=-1&&a.push(r),r=t+"-"+e.get("name")+"-style",_.isArray(Upfront.data.styles[t])&&Upfront.data.styles[t].indexOf(r)!=-1&&a.push(r)}),r._get_saved_layout().done(function(e){_.each(i,function(t){_.each(Upfront.data.styles[t.id],function(n){var r=!1;_.each(e,function(e,t){if(t==o)return;var i=o.match(new RegExp("^"+t+"-"));n.match(new RegExp("^"+t))&&(!i||i&&!n.match(new RegExp("^"+o)))&&(r=!0)}),!_.contains(a,n)&&n.match(new RegExp("^"+o))&&!r&&f.push({elementType:t.id,styleName:n})})}),f.length>0&&(Upfront.Views.Editor.notify(Upfront.Settings.l10n.global.behaviors.cleaning_region_css),l(0))}),c.promise()},_build_query:function(e){return _.map(e,function(e,t){return t+"="+e}).join("&")},clean_global_regions:function(){Upfront.data.global_regions=!1},open_global_region_manager:function(){var t=Upfront.Behaviors.LayoutEditor;Upfront.Popup.open(function(n,r,i){var s=e(this);s.html('<p class="upfront-popup-placeholder">'+Upfront.Settings.l10n.global.behaviors.loading_content+"</p>"),Upfront.data.global_regions?t._render_global_region_manager(s):t._refresh_global_regions().done(function(){t._render_global_region_manager(s)})},{width:600},"global-region-manager")},_refresh_global_regions:function(){return Upfront.Util.post({action:"upfront_list_scoped_regions",scope:"global",storage_key:_upfront_save_storage_key}).done(function(e){Upfront.data.global_regions=e.data})},_render_global_region_manager:function(t){var n=Upfront.Behaviors.LayoutEditor,r=Upfront.Application.layout.get("regions"),i=[{title:Upfront.Settings.l10n.global.behaviors.global_regions,classname:"global",data:_.sortBy(Upfront.data.global_regions,function(e,t,n){return!e.container||e.name==e.container?t*3:_.indexOf(n,_.findWhere(n,{name:e.container}))*3+1})},{title:Upfront.Settings.l10n.global.behaviors.lightboxes,classname:"lightbox",data:Upfront.Util.model_to_json(r.filter(function(e){return e.get("sub")=="lightbox"}))}];t.html(""),_.each(i,function(r){var i=e('<div class="global-region-manager-wrap global-region-manager-'+r.classname+'"></div>'),s=e('<h3 class="global-region-manager-title">'+r.title+"</h3>"),o=e('<div class="global-region-manager-content upfront-scroll-panel"></div>');i.append([s,o]),n._render_regions(r.data,o),t.append(i),Upfront.Views.Mixins.Upfront_Scroll_Mixin.stop_scroll_propagation(o)}),t.on("click",".region-list-edit",function(e){e.preventDefault()}),t.on("click",".region-list-trash",function(i){i.preventDefault();var s=e(this).attr("data-name");e(this).closest(".global-region-manager-wrap").hasClass("global-region-manager-global")&&confirm("Deleting the global regions will remove it from all layouts. Continue?")&&Upfront.Util.post({action:"upfront_delete_scoped_regions",scope:"global",name:s,storage_key:_upfront_save_storage_key}).done(function(e){e.data&&(_.each(e.data,function(e){var t=r.get_by_name(e);r.remove(t)}),n._refresh_global_regions().done(function(){n._render_global_region_manager(t)}))})})},_render_regions:function(t,n){var r=e('<ul class="global-region-manager-lists"></ul>');_.each(t,function(e){var n=["global-region-manager-list"],i=!1;!e.container||e.name==e.container?n.push("region-list-main"):(i=_.find(t,function(t){return t.name==e.container}),n.push("region-list-sub"),n.push("region-list-sub-"+e.sub),i&&n.push("region-list-sub-has-main")),r.append('<li class="'+n.join(" ")+'">'+'<span class="region-list-name">'+e.title+"</span>"+'<span class="region-list-control">'+(Upfront.Application.get_current()!=Upfront.Settings.Application.MODE.THEME?'<a href="#" class="region-list-trash" data-name="'+e.name+'">'+Upfront.Settings.l10n.global.behaviors.trash+"</a>":"")+"</span>"+"</li>")}),n.append(r)}};define("scripts/upfront/behaviors/layout-editor",t)}(jQuery),function(e){define("scripts/upfront/behaviors/dragdrop",[],function(){var t=function(e,t){this.initialize(e,t)};return t.prototype={module_selector:"> .upfront-module-view > .upfront-module, > .upfront-module-group",object_selector:"> .upfront-object-view > .upfront-object",el_selector:"",view:!1,model:!1,$me:!1,$wrap:!1,$region:!1,$main:!1,$layout:!1,me:!1,wrap:!1,region:!1,current_region:!1,$container:!1,$current_container:!1,region_model:!1,current_region_model:!1,current_wrappers:!1,is_group:!1,is_object:!1,is_parent_group:!1,is_disabled:!1,$helper:!1,event:!1,ui:!1,breakpoint:!1,app:!1,ed:!1,drop_areas:!1,drop_areas_created:!1,drops:!1,drop:!1,drop_col:0,drop_left:0,drop_top:0,area_col:0,current_area_col:0,current_row_wraps:!1,wrapper_id:!1,wrap_only:!1,new_wrap_view:!1,move_region:!1,current_grid:!1,current_grid_pos:!1,compare_area:!1,compare_area_position:!1,compare_col:0,compare_row:0,_last_drag_position:!1,_last_drag_time:0,_last_coord:!1,_t:!1,_focus_t:!1,focus:!1,focus_coord:!1,initialize:function(e,t){this.view=e,this.model=t,this.app=Upfront.Application,this.ed=Upfront.Behaviors.GridEditor,this.drop_areas=[],this.drop_areas_created=[],this.drops=[],this.current_row_wraps=[],this.current_grid={},this.current_grid_pos={},this.compare_area={},this.compare_area_position={},this._last_coord={x:0,y:0},this.focus_coord={x:0,y:0},this.setup()},setup:function(){this.is_group=this.view.$el.hasClass("upfront-module-group"),this.is_object=this.view.$el.hasClass("upfront-object-view"),this.is_parent_group=typeof this.view.group_view!="undefined",this.is_disabled=this.is_parent_group&&!this.view.group_view.$el.hasClass("upfront-module-group-on-edit")||this.is_object&&this.view.object_group_view&&!this.view.object_group_view.$el.hasClass("upfront-object-group-on-edit"),this.$me=this.is_group?this.view.$el:this.view.$el.find(".upfront-editable_entity:first"),this.$main=e(Upfront.Settings.LayoutEditor.Selectors.main),this.$layout=this.$main.find(".upfront-layout"),this.el_selector=this.is_object?this.object_selector:this.module_selector;if(this.app.mode.current!==this.app.MODE.THEME&&this.model.get_property_value_by_name("disable_drag"))return!1;if(this.$me.hasClass("upfront-module-spacer")||this.$me.hasClass("upfront-object-spacer"))return!1;if(this.is_object&&typeof this.view.object_group_view=="undefined")return!1;if(this.$me.data("ui-draggable"))return(this.is_group||!this.is_disabled)&&this.$me.draggable("option","disabled",!1),!1;this.$me.draggable({revert:!0,revertDuration:0,zIndex:100,helper:"clone",disabled:this.is_disabled,cancel:".upfront-entity_meta, .upfront-element-controls",distance:10,appendTo:this.$main,iframeFix:!0,start:e.proxy(this.on_start,this),drag:e.proxy(this.on_drag,this),stop:e.proxy(this.on_stop,this)})},on_start:function(e,t){this.ed.time_start("drag start"),this.event=e,this.ui=t,this.breakpoint=Upfront.Views.breakpoints_storage.get_breakpoints().get_active().toJSON(),this.is_parent_group=typeof this.view.group_view!="undefined",this.prepare_drag(),this.ed.time_end("drag start"),this.ed.time_start("drag start - trigger"),Upfront.Events.trigger("entity:drag_start",this.view,this.model),this.ed.time_end("drag start")},on_drag:function(e,t){var n=this;this.event=e,this.ui=t,clearTimeout(this._t),this._t=setTimeout(function(){n.update_drop_timeout()},this.ed.timeout),this.update_drop_position(),this.ed.show_debug_element&&this.$helper.find(".upfront-debug-info").text("grid: "+this.current_grid.x+","+this.current_grid.y+" | "+"current: ("+this.current_grid_pos.left+","+this.current_grid_pos.top+"),("+this.current_grid_pos.right+","+this.current_grid_pos.bottom+") | "+"margin size: "+this.drop_top+"/"+this.drop_left)},on_stop:function(t,n){var r=this;this.ed.time_start("drag stop"),this.event=t,this.ui=n,clearTimeout(this._t),clearTimeout(this._focus_t),this.drop.is_me||this.render_drop(),this.clean_elements(),this.update_models(),this.update_views(),this.reset();var i=this.is_group?this.view.$el:this.view.$el.find(".upfront-editable_entity:first"),s="animationend.drop_ani webkitAnimationEnd.drop_ani MSAnimationEnd.drop_ani oAnimationEnd.drop_ani";i.one(s,function(){e(this).removeClass("upfront-dropped"),Upfront.Events.trigger("entity:drag_animate_stop",r.view,r.model),i.off(s)}).addClass("upfront-dropped"),Upfront.Events.trigger("entity:drag_stop",this.view,this.model),this.view.trigger("entity:drop",{col:this.drop_col,left:this.drop_left,top:this.drop_top},this.view,this.model),this.view.trigger("entity:self:drag_stop"),this.ed.time_end("drag stop")},update_vars:function(){var t=this.app.layout.get("regions");this.$helper=e(".ui-draggable-dragging"),this.$wrap=this.$me.closest(".upfront-wrapper"),this.$region=this.$me.closest(".upfront-region"),this.me=this.ed.get_el(this.$me),this.wrap=this.ed.get_wrap(this.$wrap),this.region=this.ed.get_region(this.$region),this.region_model=t.get_by_name(this.region.region),this.$container=this.$region.find(".upfront-modules_container > .upfront-editable_entities_container:first")},create_drop_point:function(){var t=this.ed;t.time_start("fn create_drop_point");var n=this.breakpoint,r=this,i=this.me,s=this.wrap,o=i.$el.data("margin"),u=i.col,a=i.$el.hasClass("upfront-image_module")?1:u>t.min_col?t.min_col:u,f=i.row>t.max_row?t.max_row:i.row,l=i.$el.hasClass("upfront-module-spacer")||i.$el.hasClass("upfront-object-spacer"),c=this.app.layout.get("regions"),h=Upfront.Util.find_sorted(i.$el.closest(".upfront-wrapper")),p=h.length>1,d=h.index(i.$el);_.each(this.drop_areas,function(o,u){if(_.contains(i.drop_areas_created,o))return;var h=o.$el.hasClass("upfront-region"),v=h?o.$el.get(0)==r.current_region.$el.get(0):!1;if(h&&!v)return;var m=o.$el.find(".upfront-editable_entities_container:first"),g=h?o.$el:o.$el.closest(".upfront-region"),y=g.data("name"),b=h?o:t.get_region(g),w=c.get_by_name(y),E=h?w:o.view?o.view.model:w.get("modules").get_by_element_id(o.$el.attr("id")),S=E.get("modules")||E.get("objects"),x=E.get("wrappers"),T=t.parse_modules_to_lines(S,x,n.id,o.col),N=g.hasClass("upfront-region-expand-lock"),C=o.grid.top,k=function(e,t){return!N||N&&t-e+1>=i.row},L=function(e){var n=Upfront.data.wrapper_views[e.model.cid];return n?t.get_wrap(n.$el):!1};_.each(T,function(u,f){_.each(u.wrappers,function(c,h){var v=Upfront.data.wrapper_views[c.model.cid];if(!v)return;var m=v.$el,g=t.get_wrap(m),y=c.spacer,w=h==0,E=s&&g._id==s._id,S=c.modules.length==1,x=E&&S,N=h>0?u.wrappers[h-1]:f>0?_.last(T[f-1].wrappers):!1,A=N?Upfront.data.wrapper_views[N.model.cid]:!1,O=A?A.$el:!1,M=O?t.get_wrap(O):!1,D=h==1||h==0&&f>0&&T[f-1].wrappers.length==1,P=M&&s&&M._id==s._id,H=N?N.spacer:!1,B=P&&N.modules.length==1,j=h+1<u.wrappers.length?u.wrappers[h+1]:f+1<T.length?T[f+1].wrappers[0]:!1,F=j?Upfront.data.wrapper_views[j.model.cid]:!1,I=F?F.$el:!1,q=I?t.get_wrap(I):!1,R=h+1==u.wrappers.length,U=q&&s&&q._id==s._id,z=j?j.spacer:!1,W=U&&j.modules.length==1,X=f+1<T.length?T[f+1].wrappers[0]:!1,V=X?Upfront.data.wrapper_views[X.model.cid]:!1,J=V?V.$el:!1,K=J?t.get_wrap(J):!1,Q=t.get_wrap_el_min(g),G=t.get_wrap_el_min(g,!1,!0),Y=M?t.get_wrap_el_min(M):!1,Z=q?t.get_wrap_el_min(q,!1,!0):!1,et=q?t.get_wrap_el_min(q):!1,tt=K?t.get_wrap_el_min(K,!1,!0):!1,nt=_.map(u.wrappers,L),rt=_.max(nt,function(e){return s&&s._id==e._id?-1:e.grid.bottom}),it=_.min(nt,function(e){return t.get_wrap_el_min(e,!1,!0).grid.top}),st=t.get_wrap_el_min(it,!1,!0),ot=_.find(nt,function(e){return s&&s._id==e._id});ot&&r.current_row_wraps===!1&&(r.current_row_wraps=nt);if(!l&&!y&&((!n||n.default)&&g.col>=a&&(q&&!R&&!x&&(I.find(r.el_selector).size()>1||!U)||M&&!w&&!x&&(O.find(r.el_selector).size()>1||!P)||q&&M&&!R&&!w||!M&&!q&&E&&m.find(r.el_selector).size()>1)||n&&!n.default&&E&&m.find(r.el_selector).size()>1)){var ut=g.grid.top,at=q&&!R&&et?et.grid.left-1:o.grid.right;$els=Upfront.Util.find_sorted(m,r.el_selector),$els.each(function(n){if(e(this).get(0)==i.$el.get(0))return;var s=e(this),o=t.get_el(s),u=o.outer_grid.top==g.grid.top?g.grid.top:ut,a=Math.ceil(o.grid_center.y),f=$els[n-1]?$els.eq(n-1):!1,l=f?t.get_el(f):!1,c=l&&l._id==i._id;r.drops.push({_id:t._new_id(),top:u,bottom:a,left:g.grid.left,right:at,priority:{top:c?l.outer_grid.top:o.outer_grid.top-1,bottom:o.grid.top-1,left:g.grid.left,right:at,index:c?3:5},priority_index:5,type:"inside",insert:["before",s],region:b,is_me:c,is_clear:!1,is_use:!1,is_switch:!1,switch_dir:!1,row_wraps:!1,me_in_row:!1}),ut=a+1});var ft=$els.last(),lt=ft.size()>0?t.get_el(ft):!1,ct=lt&&lt._id==i._id,ht=n&&!n.default&&tt?Math.ceil(tt.grid_center.y):rt.grid.bottom;r.drops.push({_id:t._new_id(),top:ut,bottom:ht,left:g.grid.left,right:at,priority:{top:ct?lt.outer_grid.top:g.grid.bottom,bottom:n&&!n.default&&tt?tt.grid.top:ht,left:g.grid.left,right:at,index:ct?3:5},priority_index:5,type:"inside",insert:["append",g.$el],region:b,is_me:ct,is_clear:!1,is_use:!1,is_switch:!1,switch_dir:!1,row_wraps:!1,me_in_row:!1})}if(n&&!n.default&&p&&d>0)return;if(!l&&w&&(!E||!!q&&!R)){var pt=g.grid.top==o.grid.top?o.grid.top-5:C,dt=t.get_wrap_el_min(g,!1,!0),vt=Math.ceil(dt.grid_center.y),mt=D&&P&&!p,gt=mt?M.grid.top:g.grid.top;k(gt,dt.grid.top-1)&&(r.drops.push({_id:t._new_id(),top:pt,bottom:vt,left:o.grid.left,right:o.grid.right,priority:{top:gt,bottom:st.grid.top-1,left:o.grid.left,right:o.grid.right,index:mt?2:3},priority_index:8,type:"full",insert:["before",g.$el],region:b,is_me:mt,is_clear:!0,is_use:!1,is_switch:!1,switch_dir:!1,row_wraps:!1,me_in_row:!1}),C=vt+1)}if((!l||l&&ot&&(x||!y&&(!q||R||!z)))&&(!q||R)&&(!x||!w)){var yt=!1,bt=Math.ceil(g.grid_center.x)+1,wt=!q||R?o.grid.right:g.grid.right,vt=E&&g.grid.bottom>rt.grid.bottom?g.grid.bottom:rt.grid.bottom;k(g.grid.top,vt)&&r.drops.push({_id:t._new_id(),top:g.grid.top,bottom:vt,left:x?g.grid.left:bt,right:wt,priority:{top:g.grid.top,bottom:vt,left:x?g.grid.left:bt+Math.ceil((wt-bt)/2),right:wt,index:x?1:4},priority_index:10,type:"side-after",insert:["after",g.$el],region:b,is_me:x,is_clear:!1,is_use:!1,is_switch:yt,switch_dir:yt?"left":!1,row_wraps:nt,me_in_row:ot?!0:!1})}if((!l||l&&ot&&(x||!y&&(w||!H)))&&(!x||q&&!R)&&(w||!B)){var Et=!1,St=!1,bt=M&&!w?Math.ceil(M.grid_center.x)+1:g.grid.left,wt=Math.ceil(g.grid_center.x),vt=E&&g.grid.bottom>rt.grid.bottom?g.grid.bottom:rt.grid.bottom;k(g.grid.top,vt)&&r.drops.push({_id:t._new_id(),top:g.grid.top,bottom:vt,left:bt,right:x&&et?et.grid.left-1:wt,priority:{top:g.grid.top,bottom:vt,left:M&&!w?bt+Math.ceil((M.grid.right-bt)/2):bt,right:x&&et?et.grid.left-1:g.grid.left+Math.ceil((wt-g.grid.left)/2)-1,index:x?1:4},priority_index:10,type:"side-before",insert:[Et?"after":"before",g.$el],region:b,is_me:x,is_clear:w,is_use:!1,is_switch:Et||St,switch_dir:Et?"left":St?"right":!1,row_wraps:nt,me_in_row:ot?!0:!1})}})});if(n&&!n.default&&p&&d>0)return;if(l)return;if(T.length>0){var A=T[T.length-1],O=_.last(A.wrappers),M=Upfront.data.wrapper_views[O.model.cid],D=t.get_wrap(M.$el),P=D&&A.wrappers.length==1,H=s&&P&&D._id==s._id&&!p,B=N?o.grid.bottom:o.grid.bottom-C>f?o.grid.bottom+5:C+f,j=_.map(A.wrappers,L),F=_.max(j,function(e){return s&&s._id==e._id?0:e.grid.bottom}),I=F.grid.bottom+1,q=!s||F&&s&&F._id!=s._id,R=q&&I>C?I:C;(k(R,B)||H)&&r.drops.push({_id:t._new_id(),top:C,bottom:B,left:o.grid.left,right:o.grid.right,priority:{top:R,bottom:B,left:o.grid.left,right:o.grid.right,index:H?2:3},priority_index:8,type:"full",insert:["append",m],region:b,is_me:H,is_clear:!0,is_use:!1,is_switch:!1,switch_dir:!1,row_wraps:!1,me_in_row:!1})}else{var B=N?o.grid.bottom:o.grid.bottom-o.grid.top>f?o.grid.bottom:o.grid.top+f;k(o.grid.top,B)&&r.drops.push({_id:t._new_id(),top:o.grid.top,bottom:B,left:o.grid.left,right:o.grid.right,priority:null,priority_index:8,type:"full",insert:["append",m],region:b,is_me:y=="shadow"&&i.region==y,is_clear:!0,is_use:!1,is_switch:!1,switch_dir:!1,row_wraps:!1,me_in_row:!1})}}),t.time_end("fn create_drop_point")},select_drop_point:function(t){var n=this.ed;if(!t||t.is_use)return;n.time_start("fn select_drop");var r=typeof this.drop=="object"&&!t.is_me?!0:!1;_.each(this.drops,function(e){e.is_use=e._id==t._id}),this.drop=t,n.show_debug_element&&(e(".upfront-drop-view-current").removeClass("upfront-drop-view-current"),e("#drop-view-"+t._id).addClass("upfront-drop-view-current")),e(".upfront-drop").remove();var i=this,s=this.me,o=e('<div class="upfront-drop upfront-drop-use"></div>'),u=function(){Upfront.Events.trigger("entity:drag:drop_change",i.view,i.model)},a=t.type=="inside"&&!t.insert[1].hasClass("upfront-module-group")?t.insert[1].parent():t.insert[1],f=t.insert[1].data("breakpoint_order")||0,l=s.width,c=s.height;switch(t.insert[0]){case"before":o.insertBefore(a);break;case"after":o.insertAfter(a);break;case"append":t.insert[1].append(o),f=t.insert[1].children().length}o.css("order",f);if(t.type=="full"||t.type=="inside"){o.css("width",(t.right-t.left+1)*n.col_size);if(!t.priority||t.is_me)t.is_me?(o.css("margin-top",s.height*-1),o.css("height",s.height)):o.css("height",(t.bottom-t.top+1)*n.baseline)}else if(t.type=="side-before"||t.type=="side-after"){var h=a.position();o.css("height",(t.bottom-t.top+1)*n.baseline),t.is_me&&(o.css("width",s.width),t.type=="side-before"?o.css("margin-right",s.width*-1):o.css("margin-left",s.width*-1)),o.css({position:"absolute",top:h.top,left:Upfront.Util.isRTL()?h.left+(t.type=="side-after"?0:a.width()):h.left+(t.type=="side-after"?a.width():0)})}else r&&u();n.time_end("fn select_drop")},prepare_drag:function(){var t=this.ed,n=this.breakpoint;this.$main.addClass("upfront-dragging"),this.view.$el.css("position",""),t.start(this.view,this.model),t.normalize(t.els,t.wraps),t.update_position_data(t.containment.$el),this.update_vars(),this.set_current_region(this.region);var r=this.$me,i=this.me,s=this.$helper,o=r.offset(),u=t.max_row*t.baseline,a=r.data("ui-draggable"),f=this.event.pageY-o.top,l=this.is_parent_group?t.get_position(this.view.group_view.$el):this.is_object?t.get_position(this.view.object_group_view.$el):t.get_region(this.$region),c=!1;f>u/2&&a._adjustOffsetFromHelper({top:Math.round((i.height>u?u:i.height)/2)}),r.css("visibility","hidden"),s.css("max-width",i.width),s.css("height",i.height),s.css("max-height",u),s.css("margin-left",r.css("margin-left")),this.area_col=l.col;if(this.is_parent_group||this.is_object)l.region=this.$region.data("name"),l.group=this.is_parent_group?this.view.group_view.$el.attr("id"):"",l.view=this.is_parent_group?this.view.group_view:this.view.object_group_view,this.drop_areas=[l],this.current_area_col=l.col;else if(n&&!n.default)this.drop_areas=[l];else{var h=!1,p;t.lightbox_cols=!1,_.each(t.regions,function(e){e.$el.hasClass("upfront-region-side-lightbox")&&e.$el.css("display")=="block"&&(h=e,t.lightbox_cols=e.col),e.$el.hasClass("upfront-region-shadow")&&(p=e)}),h?this.drop_areas=[h,p]:this.drop_areas=t.regions}this.current_row_wraps=!1,this.create_drop_point(),this.$wrap.css("min-height","1px"),e(".upfront-drop-me").css("height",(i.outer_grid.bottom-i.outer_grid.top)*t.baseline),this.show_debug_data(),this.select_drop_point(_.find(this.drops,function(e){return e.is_me})),this.$region.addClass("upfront-region-drag-active")},update_drop_timeout:function(){var e=this.breakpoint;this.update_compare_area(),this.update_focus_state(),(!e||e.default)&&!this.is_parent_group&&!this.is_object?this.update_current_region():this.set_current_region(),this.update_current_drop_point()},update_compare_area:function(){var e=this.ed,t=this.$helper,n=Math.ceil(t.outerHeight()/e.baseline)*e.baseline,r=t.outerWidth(),i=t.offset(),s=Upfront.Util.isRTL()?i.left+r:i.left,o=i.top,u=o+n,a=Upfront.Util.isRTL()?s-r:s+r,f=Upfront.Util.isRTL()?s-r/2:s+r/2,l=o+n/2,c=e.get_grid(s,o),h=c.x,p=c.y,d=e.get_grid(a,u),v=d.x-1,m=d.y-1,g=e.get_grid(this.event.pageX,this.event.pageY),y=this.me.col,b=this.focus?e.focus_compare_col:e.compare_col,w=this.focus?e.focus_compare_row:e.compare_row,E=g.y-w/2,E=E<p?p:E,S=g.x-b/2,S=S<h?h:S,x=S+b-1,x=x>v?v:x,T=E+w-1,T=T>m?m:T,T=T>E+e.max_row?E+e.max_row:T,N=[g.x,g.y,E,x,T,S];this.current_grid=g,this.current_grid_pos={top:p,left:h,right:v,bottom:m},this.compare_area={top:E,left:S,right:x,bottom:T},this.compare_area_position=N},update_focus_state:function(){var e=this,t=this.ed,n=this._last_coord?Math.sqrt(Math.pow(this.event.pageX-this._last_coord.x,2)+Math.pow(this.event.pageY-this._last_coord.y,2)):0,r=Date.now();if(this._last_drag_position&&n<=t.update_distance){this._focus_t||(this._focus_t=setTimeout(function(){e.focus=!0,e.focus_coord.x=e.event.pageX,e.focus_coord.y=e.event.pageY,e._last_drag_time=Date.now(),e.update_drop_timeout()},t.focus_timeout));return}clearTimeout(this._focus_t),this._focus_t=!1,this._last_drag_position=this.compare_area_position,this._last_coord.x=this.event.pageX,this._last_coord.y=this.event.pageY,this._last_drag_time=r;if(this.focus){var i=Math.sqrt(Math.pow(this.event.pageX-this.focus_coord.x,2)+Math.pow(this.event.pageY-this.focus_coord.y,2));i>t.focus_out_distance&&(this.focus=!1)}},update_current_drop_point:function(){var e=this,t=_.map(this.drops,function(t){if(t.region._id!=e.current_region._id)return!1;var n=e.get_area_compared(t);return{area:n,drop:t}}).filter(function(e){return e!==!1?!0:!1}),n=_.max(t,function(e){return e.area});if(n.area>0)var r=_.filter(t,function(e){return e.area==n.area}),i=_.sortBy(r,function(t,n,r){var i=t.drop.priority?e.get_area_compared(t.drop.priority):0;return i*1>=t.area?t.drop.priority.index:t.drop.priority_index}),s=_.first(i).drop;else var s=_.find(this.drops,function(e){return e.is_me});this.select_drop_point(s),this.update_drop_position()},update_drop_position:function(){if(!this.drop)return;var t=this.ed,n=this.drop,r=this.current_region?this.current_region.col:this.me.col,i=this.$me.hasClass("upfront-module-spacer")||this.$me.hasClass("upfront-object-spacer"),s=this.$wrap.find(this.el_selector).length==1,o=n.priority?n.priority.top-n.top:0,u=n.priority?n.priority.left-n.left:0,a=n.region.$el.hasClass("upfront-region-expand-lock"),f=n.priority?n.priority.bottom-n.priority.top+1:n.bottom-n.top+1;this.drop_top=0,this.drop_left=0;if(n.is_me||n.me_in_row&&s||i)this.drop_col=this.me.col;else if(n.type=="side-before"||n.type=="side-after"){var l=this.find_column_distribution(n.row_wraps,n.me_in_row&&s,!0,this.current_area_col,!1);this.drop_col=l.apply_col}else this.drop_col=n.priority?n.priority.right-n.priority.left+1:n.right-n.left+1;adjust_bottom=!0,t.show_debug_element&&e("#upfront-compare-area").css({top:(this.compare_area.top-1)*t.baseline,left:(this.compare_area.left-1)*t.col_size+(t.grid_layout.left-t.grid_layout.layout_left),width:(this.compare_area.right-this.compare_area.left+1)*t.col_size,height:(this.compare_area.bottom-this.compare_area.top+1)*t.baseline}).text("("+this.compare_area.left+","+this.compare_area.right+") "+"("+this.compare_area.top+","+this.compare_area.bottom+")")},update_current_region:function(){var t=this,n=this.ed,r=e(".upfront-region-container-wide, .upfront-region-container-clip").not(".upfront-region-container-shadow").last(),i=_.map(n.regions,function(e){var i,s,o,u,a,f=e.$el.closest(".upfront-region-container").get(0)==r.get(0),l=f&&(!e.$el.hasClass("upfront-region-side")||e.$el.hasClass("upfront-region-side-left")||e.$el.hasClass("upfront-region-side-right"))?999999:e.grid.bottom,c=e.$el.hasClass("upfront-region-drag-active"),h=e.$el.hasClass("upfront-region-side-top")||e.$el.hasClass("upfront-region-side-bottom"),a=t.get_area_compared({top:e.grid.top-5,bottom:l+5,left:e.grid.left,right:e.grid.right}),p=e.$el.data("type"),d=n.region_type_priority[p];return a*=d,h&&(a*=2),c&&(a*=1.5),{area:a,region:e}}),s=_.max(i,function(e){return e.area});s.area>0&&s.region.$el.get(0)!=this.current_region.$el.get(0)&&(this.set_current_region(s.region),n.update_position_data(this.$current_container,!1),this.create_drop_point()),n.show_debug_element&&_.each(i,function(e){e.region.$el.find(">.upfront-debug-info").text(e.area)})},set_current_region:function(t){var n=this.app.layout.get("regions");this.current_region=t&&t.$el?t:this.ed.get_region(this.$region),this.current_region.$el.hasClass("upfront-region-drag-active")||(e(".upfront-region-drag-active").removeClass("upfront-region-drag-active"),this.current_region.$el.addClass("upfront-region-drag-active")),this.current_region_model=n.get_by_name(this.current_region.region),this.current_wrappers=this.is_parent_group?this.view.group_view.model.get("wrappers"):this.is_object?this.view.object_group_view.model.get("wrappers"):this.current_region_model.get("wrappers"),this.$current_container=this.is_parent_group?this.view.group_view.$el.find(".upfront-editable_entities_container:first"):this.is_object?this.view.object_group_view.$el.find(".upfront-editable_entities_container:first"):this.current_region.$el.find(".upfront-modules_container > .upfront-editable_entities_container:first"),this.move_region=this.region._id!=this.current_region._id,!this.is_parent_group&&!this.is_object&&(this.current_area_col=this.current_region.col)},get_area_compared:function(e){var t=this.compare_area,n,r,i,s,o;return t.left>=e.left&&t.left<=e.right?i=t.left:t.left<e.left?i=e.left:t.left>e.right&&t.left-e.right<=1&&(i=e.right),t.right>=e.left&&t.right<=e.right?s=t.right:t.right>e.right?s=e.right:t.right<e.left&&e.left-t.right<=1&&(s=e.left),t.top>=e.top&&t.top<=e.bottom?n=t.top:t.top<e.top&&(n=e.top),t.bottom>=e.top&&t.bottom<=e.bottom?r=t.bottom:t.bottom>e.bottom&&(r=e.bottom),n&&r&&i&&s?o=(s-i+1)*(r-n+1):o=0,o?o:0},render_drop:function(){var t=this.ed,n=this.breakpoint,r=e(".upfront-drop-use");this.wrap_only=n&&!n.default?!0:!1;if(!n||n.default){if(this.drop.type!="inside"){var i=Upfront.Util.get_unique_id("wrapper");wrap_model=new Upfront.Models.Wrapper({name:"",properties:[{name:"wrapper_id",value:i},{name:"class",value:t.grid.class+this.drop_col}]}),wrap_view=new Upfront.Views.Wrapper({model:wrap_model}),(this.drop.type=="full"||this.drop.is_clear)&&wrap_model.add_class("clr"),this.current_wrappers.add(wrap_model),wrap_view.parent_view=this.view.parent_view,this.view.wrapper_view=wrap_view,wrap_view.render(),wrap_view.$el.append(this.view.$el),this.drop.type=="side-before"&&this.drop.is_clear&&r.nextAll(".upfront-wrapper").eq(0).removeClass("clr"),r.before(wrap_view.$el),this.new_wrap_view=wrap_view,Upfront.data.wrapper_views[wrap_model.cid]=wrap_view;if(!this.move_region){var s=this.current_wrappers.get_by_wrapper_id(this.$wrap.attr("id"));s&&wrap_model.set_property("breakpoint",Upfront.Util.clone(s.get_property_value_by_name("breakpoint")),!0)}}else{var o=r.closest(".upfront-wrapper"),i=o.attr("id");r.before(this.view.$el)}this.wrapper_id=i,this.model.set_property("wrapper_id",this.wrapper_id,!0),this.$wrap.find(this.el_selector).length==0&&(this.wrap&&this.wrap.grid.left==this.current_region.grid.left&&this.$wrap.nextAll(".upfront-wrapper").eq(0).addClass("clr"),this.$wrap.remove(),this.wrap_only=!0)}},update_models:function(){var t=this,n=this.ed,r=this.breakpoint,i=this.current_wrappers,s=this.$me,o=this.$wrap,u=Upfront.data.region_views[this.current_region_model.cid];_.each(n.wraps,function(e){var t=!r||r.default?e.$el.hasClass("clr"):e.$el.data("breakpoint_clear");e.$el.data("clear",t?"clear":"none")});if(!this.drop.is_me&&this.drop.type=="side-before"){var a=this.drop.insert[1];if(a.size()>0){var f=n.get_wrap(a),l=!r||r.default?a.hasClass("clr"):a.data("breakpoint_clear");(!l||this.drop.is_clear)&&a.data("clear","none")}}n.update_model_margin_classes(s,[n.grid.class+this.drop_col]);if(this.drop.type=="inside"||this.move_region){var c=this.current_wrappers.get_by_wrapper_id(o.attr("id"));c&&c.remove_property("breakpoint",!0),this.model.remove_property("breakpoint",!0)}if(!this.drop.is_me&&(!this.drop.me_in_row||!this.wrap_only)&&(this.drop.type=="side-before"||this.drop.type=="side-after")){var h=this.find_column_distribution(this.drop.row_wraps,!1,!0,this.current_area_col,!1),p=h.remaining_col-(this.drop_col-h.apply_col),d=0,v=!1,m=!1;_.each(this.drop.row_wraps,function(r){r.$el.find(t.el_selector).each(function(){if(e(this).hasClass("upfront-module-spacer")||e(this).hasClass("upfront-object-spacer")){var s=i.get_by_wrapper_id(r.$el.attr("id")),o=n.get_el_model(e(this));i.remove(s),t.model.collection.remove(o),d==0&&(v=!0,(t.drop.type=="side-after"||t.drop.type=="side-before")&&t.drop.insert[1].get(0)==r.$el.get(0)&&(m=!0))}else{var u=h.apply_col;p>0&&(u+=1,p-=1),n.update_model_margin_classes(e(this),[n.grid.class+u]),d==1&&v&&(t.drop.type=="side-before"&&t.drop.insert[1].get(0)==r.$el.get(0)?m=!0:m||r.$el.data("clear","clear"))}d++})}),m&&(t.new_wrap_view!==!1?t.new_wrap_view.$el.data("clear","clear"):t.$wrap.data("clear","clear"))}if(!this.drop.is_me&&!this.drop.me_in_row&&this.wrap_only&&this.current_row_wraps&&!_.isEqual(this.drop.row_wraps,this.current_row_wraps)){var h=this.find_column_distribution(this.current_row_wraps,!0,!1,this.area_col),p=h.remaining_col;h.total>0?_.each(this.current_row_wraps,function(r){if(t.wrap.$el.get(0)==r.$el.get(0))return;r.$el.find(t.el_selector).each(function(){if(e(this).hasClass("upfront-module-spacer")||e(this).hasClass("upfront-object-spacer"))return;var t=h.apply_col;p>0&&(t+=1,p-=1),n.update_model_margin_classes(e(this),[n.grid.class+t])})}):h.spacer_total>0&&_.each(this.current_row_wraps,function(r){if(t.wrap.$el.get(0)==r.$el.get(0))return;r.$el.find(t.el_selector).each(function(){if(!e(this).hasClass("upfront-module-spacer")&&!e(this).hasClass("upfront-object-spacer"))return;var s=i.get_by_wrapper_id(r.$el.attr("id")),o=n.get_el_model(e(this));i.remove(s),t.model.collection.remove(o,{update:!1})})})}this.is_parent_group?n.update_wrappers(this.view.group_view.model,this.view.group_view.$el):this.is_object?n.update_wrappers(this.view.object_group_view.model,this.view.object_group_view.$el):n.update_wrappers(this.current_region_model,this.current_region.$el),this.move_region&&(n.update_model_margin_classes(this.$container.find(".upfront-wrapper").find(this.el_selector)),n.update_wrappers(this.region_model,this.region.$el));if(!r||r.default)if(!this.move_region)this.view.parent_view.preserve_wrappers_breakpoint_order(),this.view.resort_bound_collection(),this.view.parent_view.normalize_child_spacing();else{var g=this.current_region_model.get("modules"),y=[];this.view.region_view._modules_view.preserve_wrappers_breakpoint_order(),this.model.collection.remove(this.model,{silent:!0}),this.model.get("shadow")&&(this.view.trigger("on_layout"),this.model.unset("shadow",{silent:!0})),this.view.region_view._modules_view.normalize_child_spacing(),u._modules_view.preserve_wrappers_breakpoint_order(),s.removeAttr("data-shadow"),this.$current_container.find(".upfront-wrapper").find(this.el_selector).each(function(){var n=e(this).attr("id"),r=g.get_by_element_id(n);!r&&n==s.attr("id")?y.push(t.model):r&&y.push(r)}),g.reset(y)}else{var b=[],w=0,E=this.drop.type!="inside",S=E?Upfront.Util.find_sorted(this.$current_container,"> .upfront-wrapper"):Upfront.Util.find_sorted(s.closest(".upfront-wrapper"),this.el_selector),x=E?0:s.closest(".upfront-wrapper").find(this.el_selector).length,T=!1;!this.drop.is_me&&this.drop.insert[0]=="append"&&E&&(T=S.length-1),S.each(function(){var r=E?n.get_wrap(e(this)):n.get_el(e(this));if(!r)return;T===w&&w++,!t.drop.is_me&&t.drop.insert[0]=="append"&&(!E&&T===!1&&e(this).closest(".upfront-wrapper").get(0)==t.drop.insert[1].get(0)&&(T=w+x-1),(E&&o.get(0)==this||!E&&s.get(0)==this)&&w--),!t.drop.is_me&&t.drop.insert[1].get(0)==this?(t.drop.insert[0]=="before"?(T=w,b.push({$el:e(this),order:w+1,clear:t.drop.type!="side-before"})):t.drop.type=="side-after"&&t.drop.insert[0]=="after"&&(T=w+1,b.push({$el:e(this),order:w,clear:r.outer_grid.left==t.current_region.grid.left})),w++):b.push({$el:e(this),order:w,clear:r.outer_grid.left==t.current_region.grid.left}),w++}),_.each(b,function(e){var u=e.$el.attr("id"),a=E?i.get_by_wrapper_id(u):n.get_el_model(e.$el),f,l;if(!a)return;if(E&&e.$el.get(0)==o.get(0)||!E&&e.$el.get(0)==s.get(0))e.order=T!==!1?T:e.order,e.clear=t.drop.is_clear;f=Upfront.Util.clone(a.get_property_value_by_name("breakpoint")||{}),_.isObject(f[r.id])||(f[r.id]={}),l=f[r.id],l.order=e.order,l.edited=!0,E&&(l.clear=e.clear),a.set_property("breakpoint",f)})}n.update_position_data(this.$current_container),n.normalize(n.els,n.wraps)},update_views:function(){var e=this.view,t=this.model;this.move_region&&(e.region=this.current_region_model,e.region_view=Upfront.data.region_views[e.region.cid],e.parent_view=e.region_view._modules_view,this.new_wrap_view.parent_view=e.parent_view,_.isUndefined(e._modules_view)||(e._modules_view.region_view=e.region_view,_.isUndefined(t.get("modules"))||t.get("modules").each(function(t){var n=Upfront.data.module_views[t.cid];if(!n)return;n.region=e.region,n.region_view=e.region_view})),e.trigger("region:updated"))},clean_elements:function(){e(".upfront-drop").remove(),e(".upfront-drop-view").remove(),e("#upfront-compare-area").remove(),this.$me.css({position:"",top:"",left:"","z-index":"",visibility:"visible"}),this.$wrap.css("min-height",""),this.$current_container.find(".upfront-wrapper").find(this.el_selector).css("max-height",""),e(".upfront-region-drag-active").removeClass("upfront-region-drag-active"),this.$main.removeClass("upfront-dragging")},reset:function(){this.drop_areas_created=[],this.drops=[],this.drop=!1},find_column_distribution:function(e,t,n,r,i){var n=n!==!1,s=_.filter(e,function(e){return e.$el.find("> .upfront-module-view > .upfront-module-spacer, > .upfront-object-view > .upfront-object-spacer").length>0}),o=_.reduce(s,function(e,t){return e+t.col},0),u=(t?e.length-1:e.length)-s.length,i=i!==!1,a=i?r-o:r,f=0,l=0;return n&&u++,u>0?(f=Math.floor(a/u),l=a-f*u):(f=a,l=0),{apply_col:f,remaining_col:l,total_col:a,spacers_col:o,total:u,spacer_total:s.length}},show_debug_data:function(){if(!this.ed.show_debug_element)return;var t=this.ed,n=this.$layout,r=this.$helper;_.each(t.els,function(e){e.$el.find(".upfront-debug-info").size()||e.$el.find(".upfront-editable_entity:first").append('<div class="upfront-debug-info"></div>'),e.$el.find(".upfront-debug-info").text("grid: ("+e.grid.left+","+e.grid.right+"),"+"("+e.grid.top+","+e.grid.bottom+") | "+"outer: ("+e.outer_grid.left+","+e.outer_grid.right+"),("+e.outer_grid.top+","+e.outer_grid.bottom+") | "+"center: "+e.grid_center.x+","+e.grid_center.y)}),_.each(this.drops,function(r){var i=e('<div class="upfront-drop-view"><div class="upfront-drop-priority-view"></div><span class="upfront-drop-view-pos"></span></div>');i.addClass("upfront-drop-view-"+r.type),r.is_me&&i.addClass("upfront-drop-view-me"),i.attr("id","drop-view-"+r._id),i.css({top:(r.top-1)*t.baseline,left:(r.left-1)*t.col_size+(t.grid_layout.left-t.grid_layout.layout_left),width:(r.right-r.left+1)*t.col_size,height:(r.bottom-r.top+1)*t.baseline}),r.priority&&i.find(".upfront-drop-priority-view").css({top:(r.priority.top-r.top)*t.baseline,left:(r.priority.left-r.left)*t.col_size,width:(r.priority.right-r.priority.left+1)*t.col_size,height:(r.priority.bottom-r.priority.top+1)*t.baseline}),i.find(".upfront-drop-view-pos").text("("+r.left+","+r.right+")"+"("+r.top+","+r.bottom+")"+"("+r.type+")"+(r.priority?"("+r.priority.left+","+r.priority.right+")"+"("+r.priority.top+","+r.priority.bottom+")":"")),n.append(i)}),n.append('<div id="upfront-compare-area"></div>'),r.find(".upfront-debug-info").size()||r.append('<div class="upfront-debug-info"></div>')}},t})}(jQuery),function(e){var t=function(e,t){};t.prototype={view:!1,model:!1},define("scripts/upfront/behaviors/resize",t)}(jQuery),function(e){define("scripts/upfront/behaviors/grid-editor",["scripts/upfront/behaviors/dragdrop","scripts/upfront/behaviors/resize"],function(t,n){var r={lightbox_cols:!1,main:{$el:null,top:0,left:0,right:0},grid_layout:{top:0,left:0,right:0},containment:{$el:null,top:0,left:0,right:0,col:0,grid:{top:0,left:0,right:0}},min_col:1,max_row:0,compare_col:2,compare_row:10,focus_compare_col:1,focus_compare_row:3,update_distance:10,timeout:0,focus_timeout:500,focus:!1,focus_out_distance:50,focus_coord:{x:0,y:0},_t:null,_t_focus:null,col_size:0,baseline:0,grid:null,region_type_priority:{wide:1,clip:1,full:1,fixed:2,lightbox:2},els:[],wraps:[],regions:[],drops:[],drop:null,el_selector:"",el_selector_direct:"",module_selector:".upfront-module-view > .upfront-module, .upfront-module-group",module_selector_direct:"> .upfront-module-view > .upfront-module, > .upfront-module-group",object_selector:".upfront-object-view > .upfront-object",object_selector_direct:"> .upfront-object-view > .upfront-object",_id:0,drag_instances:{},resize_instances:{},wrapper_resize_instances:{},show_debug_element:!1,resizing:!1,_new_id:function(){var e=Upfront.Behaviors.GridEditor;return e._id++,e._id},get_grid:function(e,t){var n=Upfront.Behaviors.GridEditor,r=Upfront.Util.isRTL()?Math.round((n.grid_layout.right-e)/n.col_size)+1:Math.round((e-n.grid_layout.left)/n.col_size)+1,i=Math.ceil((t-n.grid_layout.top)/n.baseline)+1;return{x:r,y:i}},get_position:function(t){var n=Upfront.Behaviors.GridEditor,r=e(t),i=parseFloat(r.css("width")),s=parseFloat(r.css("height")),o=r.offset(),u=o.top,a=u+s,f=Upfront.Util.isRTL()?o.left+i:o.left,l=Upfront.Util.isRTL()?f-i:f+i,c=n.get_grid(f,u),h=r.data("current_col")?r.data("current_col"):Math.round(i/n.col_size),p=Math.floor(s/n.baseline),d={top:Math.round(u),left:Math.round(f),bottom:Math.round(a),right:Math.round(l)},v={top:c.y,left:c.x,right:c.x+h-1,bottom:c.y+p-1};return{$el:r,_id:n._new_id(),position:d,outer_position:d,width:i,height:s,center:{y:Math.round(u+s/2),x:Upfront.Util.isRTL()?Math.round(f-i/2):Math.round(f+i/2)},col:h,row:p,grid:v,outer_grid:v,grid_center:{y:c.y+p/2-1,x:c.x+h/2-1}}},get_region_position:function(t){var n=Upfront.Behaviors.GridEditor,r=e(t),i=r.find(".upfront-modules_container"),s=n.get_position(i);return s.$el=r,s},init_margin:function(e){var t=Upfront.Behaviors.GridEditor,n=Math.round(parseFloat(e.$el.css("margin-left"))/t.col_size),r=Math.round(parseFloat(e.$el.css("margin-top"))/t.baseline);e.$el.data("margin",{original:{left:n,top:r},current:{left:n,top:r}})},get_affected_els:function(e,t,n,r){var i={top:[],left:[],bottom:[],right:[]},s=e.outer_grid;Array.isArray(n)?n.push(e):n=[e],r=r?!0:!1,_.each(_.reject(t,function(e){var t=_.find(n,function(t){return t.$el.get(0)==e.$el.get(0)});return t?!0:!1}),function(t){if(e.region!=t.region)return;if(e.group!=t.group)return;if(t.outer_grid.top>=s.top&&t.outer_grid.top<s.bottom||t.outer_grid.bottom>=s.top&&t.outer_grid.bottom<=s.bottom||s.top>=t.outer_grid.top&&s.top<t.outer_grid.bottom||s.bottom>=t.outer_grid.top&&s.bottom<=t.outer_grid.bottom)s.left>t.outer_grid.right&&i.left.push(t),s.right<t.outer_grid.left&&i.right.push(t);s.top>t.outer_grid.bottom&&i.top.push(t),s.bottom<t.outer_grid.top&&i.bottom.push(t)});if(r){var o=_.max(i.left,function(e){return e.outer_grid.right});i.left=_.filter(i.left,function(e){return e.outer_grid.right==o.outer_grid.right});var u=_.min(i.right,function(e){return e.outer_grid.left});i.right=_.filter(i.right,function(e){return e.outer_grid.left==u.outer_grid.left});var a=_.max(i.top,function(e){return e.outer_grid.top});i.top=_.filter(i.top,function(e){return e.outer_grid.top==a.outer_grid.top});var f=_.min(i.bottom,function(e){return e.outer_grid.top});i.bottom=_.filter(i.bottom,function(e){return e.outer_grid.top==f.outer_grid.top})}return i},get_affected_wrapper_els:function(e,t,n,r){var i=Upfront.Behaviors.GridEditor,s=i.get_affected_els(e,t,n,r),o={top:_.flatten(_.map(s.top,function(e){var t=_.reject(i.get_wrap_els(e),function(e){return n?_.find(n,function(t){return t.$el.get(0)==e.$el.get(0)}):!1}),r=i.get_wrap_el_max(e,n,!0);return _.filter(t,function(e){return e.outer_grid.bottom==r.outer_grid.bottom})})),bottom:_.flatten(_.map(s.bottom,function(e){var t=_.reject(i.get_wrap_els(e),function(e){return n?_.find(n,function(t){return t.$el.get(0)==e.$el.get(0)}):!1}),r=i.get_wrap_el_min(e,n,!0);return _.filter(t,function(e){return e.outer_grid.top==r.outer_grid.top})})),left:_.flatten(_.map(s.left,function(e){var t=_.reject(i.get_wrap_els(e),function(e){return n?_.find(n,function(t){return t.$el.get(0)==e.$el.get(0)}):!1}),r=i.get_wrap_el_max(e,n,!1);return _.filter(t,function(e){return e.outer_grid.right==r.outer_grid.right})})),right:_.flatten(_.map(s.right,function(e){var t=_.reject(i.get_wrap_els(e),function(e){return n?_.find(n,function(t){return t.$el.get(0)==e.$el.get(0)}):!1}),r=i.get_wrap_el_min(e,n,!1);return _.filter(t,function(e){return e.outer_grid.left==r.outer_grid.left})}))};return o},get_move_limit:function(e,t){var n=[t.grid.left,t.grid.right];return _.each(e.left,function(e){e.grid.right>n[0]&&(n[0]=e.grid.right+1)}),_.each(e.right,function(e){e.grid.left<n[1]&&(n[1]=e.grid.left-1)}),n},get_resize_limit:function(e,t){var n=[t.grid.left,t.grid.right];return _.each(e.left,function(e){e.grid.left>n[0]&&(n[0]=e.grid.left)}),_.each(e.right,function(e){e.grid.right<n[1]&&(n[1]=e.grid.right)}),n},get_max_size:function(e,t,n,r){var i=Upfront.Behaviors.GridEditor,s=i.get_class_num(e.$el,i.grid.class),r=/all|nw|se/.test(r)?r:"all",o=e.$el.data("margin"),u=i.get_affected_els(e,t,[],!0),a=i.get_move_limit(u,i.containment),f=r=="nw"?s+e.grid.left-a[0]:r=="se"?s+a[1]-e.grid.right:a[1]-a[0]+1,l=n.$el.hasClass("upfront-region-expand-lock"),c=u.bottom.length?_.min(u.bottom,function(e){return e.grid.top}):!1,h=c?c.grid.top-e.grid.top:n.grid.bottom-e.grid.top,p=r=="nw"?o.original.top+e.row:r=="se"?h:h+o.original.top;return{col:f,row:l||r=="nw"?p:!1}},get_wrap_els:function(t){var n=Upfront.Behaviors.GridEditor,r=t.$el.find(n.el_selector_direct);return _.map(r,function(t){var t=n.get_el(e(t));return _.find(n.els,function(e){return e._id==t._id})})},get_wrap_el_min:function(e,t,n){var r=Upfront.Behaviors.GridEditor,i=r.get_wrap_els(e),s=_.min(_.reject(i,function(e){return t?_.find(t,function(t){return t.$el.get(0)==e.$el.get(0)}):!1}),function(e){return n?e.grid.top:e.grid.left});return _.isObject(s)?s:!1},get_wrap_el_max:function(e,t,n){var r=Upfront.Behaviors.GridEditor,i=r.get_wrap_els(e),s=_.max(_.reject(i,function(e){return t?_.find(t,function(t){return t.$el.get(0)==e.$el.get(0)}):!1}),function(e){return n?e.grid.bottom:e.grid.right});return _.isObject(s)?s:!1},get_el:function(e){var t=Upfront.Behaviors.GridEditor;return _.find(t.els,function(t){return e.get(0)==t.$el.get(0)})},get_wrap:function(e){var t=Upfront.Behaviors.GridEditor;return _.find(t.wraps,function(t){return e.get(0)==t.$el.get(0)})},get_region:function(e){var t=Upfront.Behaviors.GridEditor;return _.find(t.regions,function(t){return e.get(0)==t.$el.get(0)})},get_drop:function(e){var t=Upfront.Behaviors.GridEditor;return _.find(t.drops,function(t){return e.get(0)==t.$el.get(0)})},get_class_num:function(e,t){var n=_.isString(e)?e:e.attr("class"),r=new RegExp("\\b"+t+"(\\d+)"),i=n.match(r);return i&&i[1]?parseInt(i[1]):0},get_el_model:function(e){var t=Upfront.Application,n=Upfront.Behaviors.GridEditor,r=t.layout.get("regions"),i=e.attr("id"),s=function(e){if(!e)return!1;var t=e.get_by_element_id(i),n;return t?t:(e.find(function(e){if(e.get("modules"))return n=s(e.get("modules")),n?!0:!1;if(e.get("objects"))return n=o(e.get("objects")),n?!0:!1}),n)},o=function(e){if(!e)return!1;var t=e.get_by_element_id(i),n;return t?t:(e.find(function(e){if(e.get("objects"))return n=o(e.get("objects")),n?!0:!1}),n)},u;return r.find(function(e){return u=s(e.get("modules")),u?!0:!1}),u?u:!1},update_class:function(e,t,n){var r=Upfront.Settings.LayoutEditor.CurrentBreakpoint,i=new RegExp("\\b"+t+"\\d+"),s,o;!r||r.default?e.hasClass(t+n)||(e.attr("class").match(i)?e.attr("class",e.attr("class").replace(i,t+n)):e.addClass(t+n)):(s=e.parent(),o=Math.round(s.width()/this.col_size),t=="c"?e.css("width",n/o*100+"%"):t=="ml"?e.css("margin-left",n/o*100+"%"):t=="mt"&&e.css("margin-top",n*this.baseline+"px"))},update_margin_classes:function(e){this.time_start("fn update_margin_classes");var t=e.data("margin"),n=Upfront.Behaviors.GridEditor;t.current!=t.original&&(n.update_class(e,n.grid.left_margin_class,t.current.left),n.update_class(e,n.grid.top_margin_class,t.current.top)),this.time_end("fn update_margin_classes")},update_model_classes:function(e,t){this.time_start("fn update_model_classes");var n=Upfront.Settings.LayoutEditor.CurrentBreakpoint,r=this.get_el_model(e);r&&(!n||n.default)&&r.replace_class(t.join(" ")),this.time_end("fn update_model_classes")},update_model_breakpoint:function(e,t){var n=Upfront.Settings.LayoutEditor.CurrentBreakpoint,r=this.get_el_model(e),i;r&&n&&!n.default&&(i=Upfront.Util.clone(r.get_property_value_by_name("breakpoint")||{}),_.isObject(i[n.id])||(i[n.id]={}),i[n.id]=_.extend(i[n.id],t),i[n.id].edited=!0,r.set_property("breakpoint",i))},update_model_margin_classes:function(t,n){var r=Upfront.Settings.LayoutEditor.CurrentBreakpoint,i=Upfront.Behaviors.GridEditor;t.each(function(){var t=e(this),s=t.data("margin"),o,u,a,f;if(s&&(s.original.left!=s.current.left||s.original.top!=s.current.top)||n)a=s?s.current.top:0,f=s?s.current.left:0,!r||r.default?(o=[i.grid.left_margin_class+f,i.grid.top_margin_class+a],n&&(o=_.union(o,n)),i.update_model_classes(t,o)):(u={left:f,top:a},n&&_.each(n,function(e){var t=e.match(/^([A-Za-z])(\d+)$/);t&&t[1]==i.grid.class&&(u.col=parseInt(t[2]))}),i.update_model_breakpoint(t,u))})},adjust_els_right:function(e,t,n){this.time_start("fn adjust_els_right");var r=Upfront.Behaviors.GridEditor;_.each(e,function(e){var i=e.$el.data("margin"),s=e.grid.left>t?e.grid.left-t-1:i.current.left;i.current.left!=s&&(i.current.left=s,n&&r.update_margin_classes(e.$el),e.$el.data("margin",i))}),this.time_end("fn adjust_els_right")},adjust_affected_right:function(e,t,n,r,i){this.time_start("fn adjust_affected_right");var s=Upfront.Behaviors.GridEditor,o=s.get_wrap_el_max(e,n),u=o?r&&r>o.grid.right?r:o.grid.right:r?r:e.grid.left-1;t=_.reject(t,function(e){return n?_.find(n,function(t){return t.$el.get(0)==e.$el.get(0)}):!1}),s.adjust_els_right(t,u,i),r+1==s.containment.grid.left&&s.get_wrap_els(e).length==0&&e.$el.nextAll(".upfront-wrapper:eq(0)").data("clear","clear"),this.time_end("fn adjust_affected_right")},adjust_els_bottom:function(e,t,n){this.time_start("fn adjust_els_bottom");var r=Upfront.Behaviors.GridEditor;_.each(e,function(e){var i=e.$el.data("margin"),s=e.grid.top>t?e.grid.top-t-1:0;i.current.top!=s&&(i.current.top=s,n&&r.update_margin_classes(e.$el),e.$el.data("margin",i))}),this.time_end("fn adjust_els_bottom")},adjust_affected_bottom:function(e,t,n,r,i){this.time_start("fn adjust_affected_bottom");var s=Upfront.Behaviors.GridEditor,o=s.get_wrap_el_max(e,n,!0),u=o?r&&r>o.grid.bottom?r:o.grid.bottom:r?r:e.grid.bottom-1;t=_.reject(t,function(e){return n?_.find(n,function(t){return t.$el.get(0)==e.$el.get(0)}):!1}),s.adjust_els_bottom(t,u,i),this.time_end("fn adjust_affected_bottom")},normalize:function(t,n){this.time_start("fn normalize");var r=Upfront.Application,i=Upfront.Behaviors.GridEditor,s=Upfront.Settings.LayoutEditor.CurrentBreakpoint,o=r.layout.get("regions"),u=[],a=[],f=[],l=[],c=s&&!s.default;n=_.filter(n,function(e){return e.$el.is(":visible")||e.height>0}),_.each(n,function(t){var r=t.$el.find(i.module_selector_direct+", "+i.object_selector_direct),h=i.get_region(t.$el.closest(".upfront-region")),p=t.$el.closest(".upfront-objects_container").length==0?t.$el.closest(".upfront-module-group"):!1,d=p!==!1&&p.length>0,v=d?i.get_el(p):!1,m=d?!1:t.$el.closest(".upfront-object-group"),g=m!==!1&&m.length>0,y=g?i.get_el(m):!1,b=c?t.$el.data("breakpoint_order"):t.$el.index(".upfront-wrapper"),w=!1,E=!1,S=!1,x=!1;r.each(function(t){if(this.offsetWidth<=0)return;var n=i.get_el(e(this)),r=!s||s.default?i.get_class_num(n.$el,i.grid.class):n.$el.data("breakpoint_col");n.col<r&&n.col>0&&i.update_model_margin_classes(n.$el,[i.grid.class+n.col])}),r.each(function(r){var s=i.get_el(e(this)),v=i.get_affected_els(s,n,[],!1),y=s.$el.data("margin");if(r==0&&(v.left.length>0||v.right.length>0)){var T=_.max(_.union(v.left,v.right),function(e){return e.outer_grid.bottom});if(T.outer_grid.bottom<s.grid.top){var N=i.get_el_model(s.$el),C=N.collection,k=C.indexOf(N),L=_.max(_.union(v.left,v.right),function(e){return e.outer_grid.left}),A=c?L.$el.data("breakpoint_order"):L.$el.index(".upfront-wrapper"),O=_.last(i.get_wrap_els(L)),M=i.get_el_model(O.$el),D=C.indexOf(M),P=s.grid.top-T.outer_grid.bottom;E=s.grid.top-P+1,S=h.grid.left,w=!0,s.outer_grid.top=E;if(!c&&D>k||c&&A>b)if(!c)x=D,t.$el.insertAfter(L.$el),l.push({collection:C,model:N,index:x});else{var H=d?i.get_el_model(p).get("wrappers"):o.get_by_name(s.region).get("wrappers"),B=t.$el.parent().find("> .upfront-wrapper").each(Upfront.Util.normalize_sort_elements_cb).sort(Upfront.Util.sort_elements_cb),j=!1;B.each(function(n){var r=H.get_by_wrapper_id(e(this).attr("id"));this==t.$el.get(0)?(j=!0,r.set_breakpoint_property("order",A)):(r.set_breakpoint_property("order",n-1),this==L.$el.get(0)&&(j=!1))})}d?a.push(p):g?f.push(m):u.push(s.region)}}else if(w&&!c&&x!==!1){var N=i.get_el_model(s.$el),C=N.collection;l.push({collection:C,model:N,index:x})}}),w&&(t.outer_grid.top=E,t.grid.top=E,t.outer_grid.left=S,t.$el.data("clear","clear"));if(c)return;r.size()>1&&r.each(function(){var r=i.get_el(e(this)),s=i.get_affected_els(t,n,[],!1);if(s.left.length==0&&s.right.length==0){var o=i.get_el_model(r.$el),l=g?Upfront.data.object_views[o.cid]:Upfront.data.module_views[o.cid],c=d&&l.group_view?l.group_view:g&&l.object_group_view?l.object_group_view:l.region_view,b=d&&v?v:g&&y?y:h,w=c.model.get("wrappers"),E=Upfront.Util.get_unique_id("wrapper"),S=new Upfront.Models.Wrapper({name:"",properties:[{name:"wrapper_id",value:E},{name:"class",value:i.grid.class+(r.grid.left+r.col-b.grid.left)}]}),x=new Upfront.Views.Wrapper({model:S});w.add(S),S.add_class("clr"),x.parent_view=l.parent_view,x.render(),r.$el.closest(".upfront-wrapper").before(x.$el),x.$el.append(l.$el),o.set_property("wrapper_id",E,!0),Upfront.data.wrapper_views[S.cid]=x,i.init_margin(r),d?a.push(p):g?f.push(m):u.push(r.region)}})}),_.each(n,function(e){var t=i.get_region(e.$el.closest(".upfront-region"));if(!t)return;!c&&e.outer_grid.left==t.grid.left&&!e.$el.hasClass("clr")&&e.$el.addClass("clr")}),_.each(_.uniq(u),function(e){var t=o.get_by_name(e),n=Upfront.data.region_views[t.cid];i.update_wrappers(t,n.$el)}),_.each(_.uniq(a),function(e){var t=i.get_el_model(e),n=Upfront.data.module_views[t.cid];i.update_wrappers(t,n.$el)}),_.each(_.uniq(f),function(e){var t=i.get_el_model(e),n=Upfront.data.object_views[t.cid];i.update_wrappers(t,n.$el)}),c||_.each(l,function(e){e.collection.remove(e.model,{silent:!0}),e.model.add_to(e.collection,e.index)}),_.each(n,function(e){e.$el.removeData("clear")}),this.time_end("fn normalize")},init:function(){var t=Upfront.Application,n=Upfront.Behaviors.GridEditor,r=e(Upfront.Settings.LayoutEditor.Selectors.main),i=r.offset(),s=r.find(".upfront-layout");n.baseline=Upfront.Settings.LayoutEditor.Grid.baseline,n.grid=Upfront.Settings.LayoutEditor.Grid,n.col_size=n.grid.column_width,n.max_row=Math.floor(e(window).height()*.5/n.baseline),n.main={$el:r,top:i.top,bottom:i.top+r.outerHeight(),left:i.left,right:i.left+r.outerWidth()};var o=15;e(document).on("scroll",function(e){if(n.resizing===!1||n.resizing==window.scrollY)return;window.scrollY>n.resizing?n.resizing+=o:n.resizing-=o,window.scrollTo(window.scrollX,n.resizing)})},start:function(e,t,n){this.time_start("fn start");var r=Upfront.Application,i=Upfront.Behaviors.GridEditor,s=i.main.$el.offset(),o=i.main.$el.find(".upfront-layout"),u=o.offset(),a=e.$el.find(".upfront-editable_entity").eq(0).is(".upfront-object"),f=n||e.$el.closest(".upfront-editable_entities_container"),l=f.offset();i.col_size=i.grid.column_width,i.el_selector=a?i.object_selector:i.module_selector,i.el_selector_direct=a?i.object_selector_direct:i.module_selector_direct,i.main.top=s.top,i.main.bottom=s.top+i.main.$el.outerHeight(),i.main.left=s.left,i.main.right=s.left+i.main.$el.outerWidth();var c=u.left+(o.outerWidth()-i.grid.size*i.col_size)/2;i.grid_layout={top:u.top,bottom:u.top+o.outerHeight(),left:c,right:c+i.grid.size*i.col_size,layout_left:u.left,layout_right:u.left+o.outerWidth()};var h=f.outerWidth(),p=f.outerHeight(),d=Math.round(h/i.col_size),v=Math.round(p/i.baseline),m=i.get_grid(l.left,l.top);i.containment={$el:f,top:l.top,bottom:l.top+p,left:l.left,right:l.left+h,col:d,grid:{top:m.y,bottom:m.y+v-1,left:m.x,right:m.x+d-1}},i.update_position_data(f),this.time_end("fn start")},update_position_data:function(e,t){this.time_start("fn update_position_data");var n=Upfront.Application,r=Upfront.Behaviors.GridEditor,i=r.main.$el.find(".upfront-layout"),s=r.el_selector==r.object_selector,o=!1,u=e.find("> .upfront-wrapper"),a=i.find(".upfront-region").not(".upfront-region-locked"),f=e.closest(".upfront-region"),l=f.data("name"),c=e.closest(".upfront-module-group"),h=c.length>0?c.attr("id"):!1;l!=="shadow"?(u=u.filter(":visible"),o=u.find(r.el_selector_direct)):o=e.find("> .upfront-module-view > .upfront-module"),r.els=_.map(o,r.get_position),_.each(r.els,function(e){e.region=l,e.group=h,r.init_margin(e)}),r.wraps=_.map(u,r.get_position),_.each(r.wraps,function(e){e.region=l,e.group=h}),!1!==t&&(r.regions=_.map(a,r.get_region_position),_.each(r.regions,function(e){e.region=e.$el.closest(".upfront-region").data("name"),e.group=!1})),this.time_end("fn update_position_data")},update_wrappers:function(t,n){this.time_start("fn update_wrappers");var r=Upfront.Application,i=Upfront.Behaviors.GridEditor,s=Upfront.Settings.LayoutEditor.CurrentBreakpoint,o=i.el_selector==i.object_selector,u=e(Upfront.Settings.LayoutEditor.Selectors.main),a=u.find(".upfront-layout"),f=t.get("wrappers");(n?n:a).find(".upfront-wrapper:visible").each(function(){var t=e(this),n=t.attr("id"),r=f.get_by_wrapper_id(n),o=t.data("clear"),u=_.map(t.find(i.el_selector_direct),function(t){var n=e(t);return!n||!n.length?!1:n}).filter(function(e){return e!==!1});if(u.length==0){r&&f.remove(r);return}if(t.hasClass("upfront-wrapper-preview"))return;if(t.height()<=0)return;if(!r)return;var a=!s||s.default?i.get_class_num(t,i.grid.class):t.data("breakpoint_col"),l=_.map(u,function(e){return{$el:e,col:!s||s.default?i.get_class_num(e,i.grid.class):e.data("breakpoint_col")}}),c=_.max(l,function(e){if(!e)return;return e.col}),h=c.col,p,d;i.update_class(t,i.grid.class,h),!s||s.default?(a!=h&&r.replace_class(i.grid.class+h),o&&o=="clear"||!o&&t.hasClass("clr")?r.add_class("clr"):r.remove_class("clr")):(p=Upfront.Util.clone(r.get_property_value_by_name("breakpoint")||{}),_.isObject(p[s.id])||(p[s.id]={}),p[s.id].col=h,o&&(p[s.id].clear=o=="clear"),r.set_property("breakpoint",p))}),f.each(function(t){e("#"+t.get_wrapper_id()).size()==0&&f.remove(t)}),Upfront.Events.trigger("entity:wrappers:update",t),this.time_end("fn update_wrappers")},create_resizable:function(t,n){var r=this,i=Upfront.Behaviors.GridEditor,s=t.$el.hasClass("upfront-module-group"),o=t.$el.hasClass("upfront-object-view"),u=s?t.$el:t.$el.find(">.upfront-editable_entity"),a=typeof t.group_view!="undefined",f=e(Upfront.Settings.LayoutEditor.Selectors.main),l=f.find(".upfront-layout"),c,h,p;if(Upfront.Application.mode.current!==Upfront.Application.MODE.THEME&&n.get_property_value_by_name("disable_resize"))return!1;if(u.hasClass("upfront-module-spacer")||u.hasClass("upfront-object-spacer"))return!1;if(o&&typeof t.object_group_view=="undefined")return!1;if(u.data("ui-resizable"))return u.resizable("option","disabled",!1),!1;u.append('<span class="upfront-icon-control upfront-icon-control-resize-s upfront-resize-handle-s ui-resizable-handle ui-resizable-s"></span>'),u.resizable({containment:"document",autoHide:!1,delay:50,handles:{s:".upfront-resize-handle-s"},start:function(r,s){i.start(t,n),i.resizing=window.scrollY;var o=i.get_el(u),a=u.data("margin"),f=e(this).data("ui-resizable");p=f.axis?f.axis:"se",h=e('<div class="upfront-resize-placeholder"></div>'),h.css({marginLeft:a.original.left/(o.col+a.original.left)*100+"%",marginTop:a.original.top*i.baseline,width:o.col/(o.col+a.original.left)*100+"%",height:s.originalSize.height}),c=e('<div class="upfront-resize" style="height:'+o.height+'px;"></div>'),c.css({height:o.height,width:o.width,minWidth:o.width,maxWidth:o.width,position:"absolute"}),p=="nw"?c.css({top:o.position.top,right:e("body").width()-o.position.right}):c.css({top:o.position.top,left:o.position.left}),e("body").append(c),_.each(i.els,function(e,t){i.els[t]=i.get_position(e.$el)}),_.each(i.wraps,function(e,t){i.wraps[t]=i.get_position(e.$el)}),i.normalize(i.els,i.wraps),i.update_position_data(i.containment.$el);var l=u.position(),d={left:l.left+a.original.left*i.col_size,top:l.top+a.original.top*i.baseline};u.css({marginLeft:0,marginTop:0,position:"absolute",left:d.left,top:d.top,minHeight:""}),f.originalPosition.left=d.left,f.originalPosition.top=d.top,f._updateCache({left:d.left,top:d.top}),h.insertBefore(u),t.trigger("entity:resize_start",{row:o.row,col:o.col,height:o.height,width:o.width},t,t.model),Upfront.Events.trigger("entity:resize_start",t,t.model)},resize:function(n,r){var s=u.closest(".upfront-wrapper"),o=u.closest(".upfront-region"),a=i.get_el(u),f=i.get_wrap(s),l=i.get_region(o),d=o.hasClass("upfront-region-expand-lock"),v=a.col,m=f?i.get_affected_wrapper_els(f,i.wraps,[],!0):i.get_affected_els(a,i.els,[],!0),g=i.get_move_limit(m,i.containment),y=v+(p=="nw"?a.grid.left-g[0]:g[1]-a.grid.right),b=m.bottom.length?_.min(m.bottom,function(e){return e.grid.top}):!1,w=b?b.grid.top-a.grid.top:l.grid.bottom-a.grid.top+1,E=Math.ceil(r.size.width/i.col_size),S=E>y?Math.round(y*i.col_size):r.size.width,x=(r.size.height>15?r.size.height:0)||r.originalSize.height,T=Math.ceil(x/i.baseline),N=E>y?y:E,C=d&&T>w&&w>0?w:T;Math.abs(e(window).height()-n.clientY)<50&&(x+=i.baseline*10,e(window).scrollTop(e(window).scrollTop()+i.baseline*10)),u.css({height:C*i.baseline,width:S,minWidth:S,maxWidth:S}),u.data("resize-col",N),u.data("resize-row",C),c.css({height:C*i.baseline,width:N*i.col_size,minWidth:N*i.col_size,maxWidth:N*i.col_size}),p=="nw"&&c.css({top:a.$el.find(">.upfront-resize-handle-nw").offset().top,marginTop:a.$el.find(">.upfront-resize-handle-se").offset().top+a.$el.find(">.upfront-resize-handle-se").height()-a.$el.find(">.upfront-resize-handle-nw").offset().top-C*i.baseline}),!d&&p!="nw"&&h.css("height",C*i.baseline),t.update_size_hint(N*i.col_size,C*i.baseline),t.trigger("entity:resizing",{row:C,col:N,height:C*i.baseline,width:N*i.col_size},t,t.model)},stop:function(e,s){Upfront.Events.trigger("entity:pre_resize_stop",t,t.model,s);var f=Upfront.Settings.LayoutEditor.CurrentBreakpoint,l=u.closest(".upfront-wrapper"),p=u.closest(".upfront-region"),d=i.get_el(u),v=u.data("margin"),m=i.get_wrap(l),g=p.hasClass("upfront-region-expand-lock"),y=m?i.get_affected_wrapper_els(m,i.wraps,[],!0):i.get_affected_els(d,i.els,[],!0),b=i.get_move_limit(y,i.containment),w=Math.ceil(s.originalSize.width/i.col_size),E=Math.ceil(s.originalSize.height/i.baseline),S=u.data("resize-col"),x=u.data("resize-row"),T=r.layout.get("regions"),N=T.get_by_name(p.data("name")),C=o?i.containment.$el:a?t.group_view.$el.find(".upfront-editable_entities_container:first"):p.find(".upfront-modules_container > .upfront-editable_entities_container:first"),k=o?".upfront-wrapper > .upfront-object-view > .upfront-object":".upfront-wrapper > .upfront-module-view > .upfront-module, .upfront-wrapper > .upfront-module-group",L,A;i.resizing=!1,h.remove(),c.remove(),u.css({width:"",minWidth:"",maxWidth:"",height:"",position:"",top:"",left:"",marginLeft:"",marginTop:""});if(!f||f.default){n.set_property("row",x);var O=n.get("objects");O&&O.length==1&&O.each(function(e){e.set_property("row",x)})}else{L=Upfront.Util.clone(n.get_property_value_by_name("breakpoint")||{}),_.isObject(L[f.id])||(L[f.id]={}),A=L[f.id],A.edited=!0,A.row=x,n.set_property("breakpoint",L);var O=n.get("objects");O&&O.length==1&&O.each(function(e){var t=Upfront.Util.clone(e.get_property_value_by_name("breakpoint")||{});_.isObject(t[f.id])||(t[f.id]={}),t[f.id].row=x,e.set_property("breakpoint",t)})}i.update_position_data(i.containment.$el),i.normalize(i.els,i.wraps),u.removeData("resize-col"),u.removeData("resize-row"),t.trigger("entity:resize_stop",{row:x,col:S,height:x*i.baseline,width:S*i.col_size},t,t.model),Upfront.Events.trigger("entity:resize_stop",t,t.model,s),Upfront.Events.trigger("entity:resized",t,t.model)}})},toggle_resizables:function(t){e(".upfront-editable_entity.ui-resizable").resizable("option","disabled",!t)},resize:function(t,n,r,i,s,o){var u=Upfront.Application,a=Upfront.Behaviors.GridEditor,s=/all|nw|se/.test(s)?s:"all",f=e(Upfront.Settings.LayoutEditor.Selectors.main),l=f.find(".upfront-layout");a.start(t,n);var c=t.$el.find(".upfront-editable_entity:first"),h=c.find(".upfront-editable_entity"),p=c.closest(".upfront-wrapper"),d=c.closest(".upfront-region"),v=c.data("margin"),m=a.get_el(c),g=a.get_wrap(p),y=a.get_region(d),b=d.hasClass("upfront-region-expand-lock"),w=g?a.get_affected_wrapper_els(g,a.wraps,[],!0):a.get_affected_els(m,a.els,[],!0),E=a.get_max_size(m,a.els,y,s),S=typeof t.group_view!="undefined",x=S?t.group_view.model:!1,T=u.layout.get("regions"),N=T.get_by_name(d.data("name")),C=(S?x:N).get("wrappers"),k=C.get_by_wrapper_id(p.attr("id")),L=Upfront.data.wrapper_views[k.cid];if(r<1||i<1)return!1;if(!o){c.css("min-height",""),h.css("min-height","");var A=Math.ceil(c.outerHeight()/a.baseline);i=i>A?i:A,c.css("min-height",i*a.baseline),h.css("min-height",(i-2)*a.baseline)}r=r?r>E.col?E.col:r:m.col,i=i?E.row&&i>E.row?E.row:i:m.row,a.normalize(a.els,a.wraps),a.update_position_data(a.containment.$el),a.update_class(c,a.grid.class,r),n.set_property("row",i);var O=n.get("objects");return O&&O.length==1&&O.each(function(e){e.set_property("row",i)}),s!="se"?n.replace_class([a.grid.class+r].join(" ")):n.replace_class(a.grid.class+r),typeof t.group_view!="undefined"?a.update_wrappers(t.group_view.model,t.group_view.$el):a.update_wrappers(N,y.$el),t.trigger("entity:resize_stop",{row:i,col:r},t,t.model),Upfront.Events.trigger("entity:resized",t,t.model),!0},create_wrapper_resizable:function(t,n){var r=this,i=Upfront.Behaviors.GridEditor,s=t.$el,o=e(Upfront.Settings.LayoutEditor.Selectors.main),u=o.find(".upfront-layout"),a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M,D;if(Upfront.Application.mode.current!==Upfront.Application.MODE.THEME&&n.get_property_value_by_name("disable_resize"))return!1;if(s.data("ui-resizable"))return s.resizable("option","disabled",!1),!1;s.resizable({containment:"document",autoHide:!1,delay:50,handles:{w:".upfront-resize-handle-wrapper-w",e:".upfront-resize-handle-wrapper-e"},start:function(r,o){i.time_start("fn wrapper_resize_start"),i.start(t,n),i.resizing=window.scrollY,f=Upfront.Views.breakpoints_storage.get_breakpoints().get_active().toJSON(),c=!_.isUndefined(t.parent_view.object_group_view),c?(p=t.parent_view.object_group_view,d=i.get_position(p.$el)):(h=!_.isUndefined(t.parent_view.group_view),p=h?t.parent_view.group_view:t.parent_view.region_view,d=h?i.get_position(p.$el):i.get_region(p.$el));var u=i.get_wrap(s),l=e(this).data("ui-resizable"),P=Upfront.Util.find_sorted(s.parent(),"> .upfront-wrapper"),H=i.get_affected_els(u,i.wraps,[],!0),B=p.model.get("wrappers"),j=c?p.model.get("objects"):p.model.get("modules"),F=i.parse_modules_to_lines(j,B,f.id,d.col),I;a=s.closest(".upfront-region"),N=l.axis?l.axis:"e",b=!1,I=!1,w=!1,E=!1,T=!1,v=s.find("> .upfront-module-group").length>0,L=u.col,C=i.min_col,k=i.min_col,_.each(F,function(e){_.each(e.wrappers,function(t,r){var s=!1;if(t.model!=n)return;M=r===0,D=r===e.wrappers.length-1,x=t.spacer,!M&&N=="w"?s=e.wrappers[r-1]:!D&&N=="e"&&(s=e.wrappers[r+1]),s!==!1&&(w=s.model,E=Upfront.data.wrapper_views[w.cid],b=E.$el,I=i.get_wrap(b),T=s.spacer)})}),A=[],s.find(i.el_selector_direct).each(function(){var t=i.get_el_model(e(this)),n=c?Upfront.data.object_views[t.cid]:Upfront.data.module_views[t.cid];if(!n)return;A.push({view:n,is_group:c?!1:e(this).hasClass("upfront-module-group"),el:i.get_el(e(this))})}),v&&_.each(A,function(e){if(!e.is_group)return;var t=i.get_group_min_col(e.view);C=t>C?t:C}),g=e('<div class="upfront-resize" style="height:'+u.height+'px;"></div>'),g.css({height:u.height,width:u.width,minWidth:u.width,maxWidth:u.width,position:"absolute"}),N=="w"?g.css({top:u.position.top,right:e("body").width()-u.position.right}):g.css({top:u.position.top,left:u.position.left}),e("body").append(g),O=[],b&&b.length&&(m=b.find("> .upfront-module-group").length>0,b.find(i.el_selector_direct).each(function(){var t=i.get_el_model(e(this)),n=c?Upfront.data.object_views[t.cid]:Upfront.data.module_views[t.cid];if(!n)return;O.push({view:n,is_group:c?!1:e(this).hasClass("upfront-module-group"),el:i.get_el(e(this))})}),m&&_.each(O,function(e){if(!e.is_group)return;var t=i.get_group_min_col(e.view);k=t>k?t:k}),L=u.col+I.col,!x&&!T?L-=k:x&&(L-=k,C=0),T&&(k=0)),y=e('<div class="upfront-resize-placeholder"></div>'),y.css({width:(I?I.col+u.col:u.col)/d.col*100+"%",height:o.originalSize.height,position:"relative"}),f&&!f.default&&y.css("order",s.css("order"));if(x||T)S=e('<div class="upfront-spacer-feed"></div>'),S.css({width:i.col_size,height:"auto",top:0,bottom:0,position:"absolute"}),y.append(S);_.each(i.els,function(e,t){i.els[t]=i.get_position(e.$el)}),_.each(i.wraps,function(e,t){i.wraps[t]=i.get_position(e.$el)}),i.normalize(i.els,i.wraps),i.update_position_data(i.containment.$el);var q=s.position(),R=b?b.position():!1;s.css({marginLeft:0,marginTop:0,position:"absolute",left:q.left,top:q.top,minHeight:""}),b&&b.css({marginLeft:0,marginTop:0,position:"absolute",top:R.top,left:R.left}),l.originalPosition.left=q.left,l.originalPosition.top=q.top,l._updateCache({left:q.left,top:q.top}),y.insertBefore(s),_.each(A,function(e){e.view.trigger("entity:resize_start",{row:e.el.row,col:e.el.col,height:e.el.height,width:e.el.width},e.view,e.view.model)}),_.each(O,function(e){e.view.trigger("entity:resize_start",{row:e.el.row,col:e.el.col,height:e.el.height,width:e.el.width},e.view,e.view.model)}),t.trigger("entity:wrapper:resize_start",{row:u.row,col:u.col,height:u.height,width:u.width},t,t.model),E&&E.trigger("entity:wrapper:resize_start",{row:I.row,col:I.col,height:I.height,width:I.width},E,E.model),Upfront.Events.trigger("entity:wrapper:resize_start",t,t.model,E,E.model),i.time_end("fn wrapper_resize_start")},resize:function(e,n){i.time_start("fn wrapper_resize_resizing");var r=i.get_wrap(s),o=b?i.get_wrap(b):!1,u=i.get_region(a),f=C*i.col_size,l=c>L?Math.round(L*i.col_size):f>n.size.width?f:n.size.width,c=Math.round(l/i.col_size),h=(n.size.height>15?n.size.height:0)||n.originalSize.height,p=N=="w"?n.originalPosition.left+n.originalSize.width-l:n.position.left,d=c>L?L:c,v=L-d+k,m=(L+k)*i.col_size-l;s.css({left:p,height:h,width:l,minWidth:l,maxWidth:l}),s.data("resize-col",d);if(x&&l<i.col_size){var y=.5*Math.round((i.col_size-l)/i.col_size*100)/100;S.css({left:N=="e"?0:"auto",right:N=="e"?"auto":0,backgroundColor:"rgba(200, 0, 0, "+y+")"})}if(b){b.css({width:m,minWidth:m,maxWidth:m}),N=="e"&&b.css("margin-left",o.width-m),b.data("resize-col",v);if(T&&m<i.col_size){var y=.5*Math.round((i.col_size-m)/i.col_size*100)/100;S.css({left:N=="w"?0:"auto",right:N=="w"?"auto":0,backgroundColor:"rgba(200, 0, 0, "+y+")"})}}g.css({height:h,width:d*i.col_size,minWidth:d*i.col_size,maxWidth:d*i.col_size}),_.each(A,function(e){e.view.trigger("entity:resizing",{row:e.el.row,col:d,height:e.el.height,width:d*i.col_size},e.view,e.view.model)}),_.each(O,function(e){e.view.trigger("entity:resizing",{row:e.el.row,col:v,height:e.el.height,width:v*i.col_size},e.view,e.view.model)}),t.trigger("entity:wrapper:resizing",{row:r.row,col:d,height:r.height,width:d*i.col_size},t,t.model),E&&E.trigger("entity:wrapper:resizing",{row:o.row,col:v,height:o.height,width:v*i.col_size},E,E.model),i.time_end("fn wrapper_resize_resizing")},stop:function(e,o){i.time_start("fn wrapper_resize_stop"),Upfront.Events.trigger("entity:wrapper:pre_resize_stop",t,t.model,o);var u=i.get_wrap(s),l=b?i.get_wrap(b):!1,h=Math.ceil(o.originalSize.width/i.col_size),d=s.data("resize-col"),v=b?b.data("resize-col"):0,m=r.layout.get("regions"),S=m.get_by_name(a.data("name")),C=N=="w"&&M,k=N=="e"&&D;i.resizing=!1,y.remove(),g.remove(),s.css({width:"",minWidth:"",maxWidth:"",height:"",position:"",top:"",left:"",marginLeft:"",marginTop:""}),b&&b.css({width:"",minWidth:"",maxWidth:"",height:"",position:"",top:"",left:"",marginLeft:"",marginTop:""}),!w&&(C||k)&&L-d>0?t.add_spacer(C?"left":"right",L-d,L,c):(d>0?f&&!f.default?(n.set_breakpoint_property("edited",!0,!0),n.set_breakpoint_property("col",d),_.each(A,function(e){e.view.model.set_breakpoint_property("edited",!0,!0),e.view.model.set_breakpoint_property("col",d)})):(n.replace_class(i.grid.class+d),_.each(A,function(e){e.view.model.replace_class(i.grid.class+d)})):x&&(n.collection.remove(n),_.each(A,function(e){e.view.model.collection.remove(e.view.model)})),w&&(v>0?f&&!f.default?(w.set_breakpoint_property("edited",!0,!0),w.set_breakpoint_property("col",v),_.each(O,function(e){e.view.model.set_breakpoint_property("edited",!0,!0),e.view.model.set_breakpoint_property("col",v)})):(w.replace_class(i.grid.class+v),_.each(O,function(e){e.view.model.replace_class(i.grid.class+v)})):T&&(w.collection.remove(w),_.each(O,function(e){e.view.model.collection.remove(e.view.model)})))),c?p.model.get("objects").each(function(e){e.set_breakpoint_property("edited",!0,!0)}):p.model.get("modules").each(function(e){e.set_breakpoint_property("edited",!0,!0)}),p.model.get("wrappers").each(function(e){e.set_breakpoint_property("edited",!0,!0)}),i.update_position_data(i.containment.$el),i.normalize(i.els,i.wraps),s.removeData("resize-col"),b&&b.removeData("resize-col"),_.each(A,function(e){e.view.trigger("entity:resize_stop",{row:e.el.row,col:d,height:e.el.height,width:d*i.col_size},e.view,e.view.model)}),_.each(O,function(e){e.view.trigger("entity:resize_stop",{row:e.el.row,col:v,height:e.el.height,width:v*i.col_size},e.view,e.view.model)}),t.trigger("entity:wrapper:resize_stop",{row:u.row,col:d,height:u.height,width:d*i.col_size},t,t.model),t.trigger("entity:wrapper:resize",{col:d},t,t.model),E&&(E.trigger("entity:wrapper:resize_stop",{row:l.row,col:v,height:l.height,width:d*i.col_size},E,E.model),E.trigger("entity:wrapper:resize",{col:v},E,E.model)),Upfront.Events.trigger("entity:wrapper:resize_stop",t,t.model,E,E.model,o),Upfront.Events.trigger("entity:wrapper:resized",t,t.model,E,E.model),i.time_end("fn wrapper_resize_stop")}})},get_group_min_col:function(e){var t=Upfront.Settings.LayoutEditor.CurrentBreakpoint,n=Upfront.Behaviors.GridEditor,r=e.model.get("modules"),i=e.model.get("wrappers"),s=!t||t.default?n.get_class_num(e.$el,n.grid.class):e.$el.data("breakpoint_col"),o=n.parse_modules_to_lines(r,i,t?t.id:"desktop",s),u=n.min_col;return _.each(o,function(e){var t=0;_.each(e.wrappers,function(e){e.spacer?t+=1:t+=n.min_col}),t>u&&(u=t)}),u},create_draggable:function(e,n){var r=Upfront.Behaviors.GridEditor;r.drag_instances[e.cid]?r.drag_instances[e.cid].setup():(r.drag_instances[e.cid]=new t(e,n),n.on("remove",function(){delete r.drag_instances[e.cid]}))},toggle_draggables:function(t){e(".upfront-editable_entity.ui-draggable").draggable("option","disabled",!t)},parse_modules_to_lines:function(e,t,n,r){var i=Upfront.Behaviors.GridEditor,s={},o=[],u=[],a=0,f=0;return e.each(function(e,o){var u=e.get_wrapper_id(),a=t.get_by_wrapper_id(u),f=a?a.get_property_value_by_name("breakpoint"):!1,l=f&&n in f?f[n]:{},c=a?a.get_property_value_by_name("class"):"",h=i.get_class_num(c,i.grid.class),p=!!c.match(/clr/),d=e.get_property_value_by_name("breakpoint"),v=d&&n in d?d[n]:{},m=e.get_property_value_by_name("default_hide"),g=e.get_property_value_by_name("hide"),y=e.get_property_value_by_name("class"),b=i.get_class_num(y,i.grid.class),w=!!y.match(/(upfront-module-spacer|upfront-object-spacer)/),E=o,S=o,x={};if(!a)return;n!="desktop"&&(g="hide"in v?v.hide:m,b="col"in v?parseInt(v.col,10):b,E="order"in v?parseInt(v.order,10)*1e4+E:E,h="col"in l?parseInt(l.col,10):h,S="order"in l?parseInt(l.order,10)*1e4+S:S,p="clear"in l?l.clear:p),g===!1&&(g=m);if(g&&w)return;x={model:e,col:b,order:E,spacer:w,hide:g},b>h&&(h=b),h>r&&(h=r),u in s?(s[u].modules.push(x),s[u].col=h):s[u]={model:a,modules:[x],order:S,col:h,clear:p,spacer:w}}),o=_.sortBy(s,function(e,t){return e.order}),_.each(o,function(e,t){if(t>0&&e.clear||a>0&&a+e.col>r)u[f].col=a,f++,a=0;_.isUndefined(u[f])&&(u[f]={wrappers:[],col:0}),a+=e.col,u[f].wrappers.push(e),u[f].col=a}),u},get_container_col:function(e,t){var n=Upfront.Behaviors.GridEditor,r=!_.isUndefined(e.group_view),i=!_.isUndefined(e.object_group_view),s=(r?e.group_view:i?e.object_group_view.parent_module_view:e.region_view).model.get_property_value_by_name("breakpoint"),o=s&&t.id in s?s[t.id]:{},u=i?e.object_group_view.parent_module_view.$el.find("> .upfront-module"):(r?e.group_view:e.region_view).$el,a=t.default?n.get_class_num(u,n.grid.class):_.isNumber(o.col)?o.col:t.columns;return a>t.columns?t.columns:a},normalize_module_remove:function(e,t,n,r,i){var s=Upfront.Application,o=Upfront.Behaviors.GridEditor,u=n.indexOf(t),a=Upfront.Views.breakpoints_storage.get_breakpoints().get_enabled(),f=!_.isUndefined(e.group_view),l=!_.isUndefined(e.object_group_view);_.each(a,function(r){var s=r.toJSON(),u=o.get_container_col(e,s),a=o.parse_modules_to_lines(n,i,s.id,u),f=!1,l=!1,c=[],h=[],p,d,v,m,g,y;_.each(a,function(e){if(p)return;v=!1,m=!1,_.each(e.wrappers,function(n){d&&!m&&(m=n),_.each(n.modules,function(r){t==r.model&&(d=n,p=e)}),d||(v=n)})});if(!p)return;m&&(y=m.model.get_property_value_by_name("class"),y.match(/clr/g)||(l=!0)),v&&(g=v.model.get_property_value_by_name("class"),g.match(/clr/g)&&!l&&(f=!0)),_.each(p.wrappers,function(e){if(e==d)return;c.push(e),e.spacer&&h.push(e)}),c.length>=2&&(l=!1);if(d.modules.length==1){var b=u,w=0,E=0;_.each(h,function(e){b-=e.col}),c.length==h.length?_.each(c,function(e,t){_.each(e.modules,function(e){n.remove(e.model)}),i.remove(e.model)}):(w=Math.floor(b/(c.length-h.length)),E=b-(c.length-h.length)*w,_.each(c,function(e,t){if(_.contains(h,e))return;var n=e.model.get_property_value_by_name("class"),r=e.model.get_property_value_by_name("breakpoint"),i=r&&s.id in r?r[s.id]:{},u=w;E>0&&(u+=1,E-=1),s.default?(e.model.replace_class(o.grid.class+u+(t==0&&!n.match(/clr/g)?" clr":"")),_.each(e.modules,function(e){e.model.replace_class(o.grid.class+u)})):(i.col=u,t==0&&!i.clear&&(i.clear=!0),e.model.set_property("breakpoint",Upfront.Util.clone(r)),_.each(e.modules,function(e){var t=e.model.get_property_value_by_name("breakpoint"),n=t&&s.id in t?t[s.id]:{};n.col=u,e.model.set_property("breakpoint",Upfront.Util.clone(t))}))}))}if(!s.default)return;if(f||l){var S=!1;_.each(f?v.modules:m.modules,function(e,t){var n=e.model.get_property_value_by_name("class"),r=o.get_class_num(n,o.grid.class),s=Upfront.data.module_views[e.model.cid],u=f?v:m,a=Upfront.data.wrapper_views[u.model.cid],l=S?Upfront.data.wrapper_views[S.cid]:a;if(t>0){var c=Upfront.Util.get_unique_id("wrapper");wrap_model=new Upfront.Models.Wrapper({name:"",properties:[{name:"wrapper_id",value:c},{name:"class",value:o.grid.class+r+" clr"}]}),wrap_view=new Upfront.Views.Wrapper({model:wrap_model}),i.add(wrap_model),wrap_view.parent_view=s.parent_view,wrap_view.render(),wrap_view.$el.append(s.$el),l.$el.after(wrap_view.$el),Upfront.data.wrapper_views[wrap_model.cid]=wrap_view,e.model.set_property("wrapper_id",c,!0),S=wrap_model}})}})},adapt_to_breakpoint:function(e,t,n,r,i){var s=Upfront.Application,o=Upfront.Behaviors.GridEditor,u=0,a=-1,f=[],l=[],c={},i=i===!0?!0:!1,h=0,p=0;e.each(function(e){var i=e.get_property_value_by_name("breakpoint")||{},s=e.get_property_value_by_name("class"),l=e.get_property_value_by_name("default_hide"),c=i[n]&&"hide"in i[n]?i[n].hide:l,h=o.get_class_num(s,o.grid.class),d=t.get_by_wrapper_id(e.get_wrapper_id()),v=d&&d.get_property_value_by_name("breakpoint")||{},m=d&&d.get_property_value_by_name("class"),g=d&&(!!m.match(/clr/)||u===0);if(!d)return;if(v&&v[n]&&v[n].edited||i&&i[n]&&i[n].edited){p++;return}if(c)return;u+=h,u>r&&(g=!0),g&&(u=h,a++,f[a]=[]),h=h>r?r:h,f[a].push({clear:g,spacer:!!s.match(/(upfront-module-spacer|upfront-object-spacer)/),module:e,col:h,left:0,wrapper:d,breakpoint:Upfront.Util.clone(i),wrapper_breakpoint:Upfront.Util.clone(v)})}),_.each(f,function(e){var t=_.map(e,function(e){return e.col}).reduce(function(e,t){return e+t}),s=_.map(e,function(e){return e.spacer?e.col:0}).reduce(function(e,t){return e+t});_.each(e,function(s,o){var u=0,a=0;_.isObject(s.breakpoint[n])||(s.breakpoint[n]={edited:!1}),_.isObject(s.wrapper_breakpoint[n])||(s.wrapper_breakpoint[n]={edited:!1}),s.breakpoint[n].edited?u=typeof s.breakpoint[n].col=="number"?s.breakpoint[n].col:s.col:(u=t===r?s.col:r/e.length,s.wrapper_breakpoint[n].edited&&_.isNumber(s.wrapper_breakpoint[n].col)&&(u=u>s.wrapper_breakpoint[n].col?s.wrapper_breakpoint[n].col:u),s.breakpoint[n].left=0,s.breakpoint[n].col=u,s.breakpoint[n].order=o,s.module.set_property("breakpoint",s.breakpoint,i)),_.isUndefined(c[s.wrapper.get_wrapper_id()])?h++:a=c[s.wrapper.get_wrapper_id()],a<u&&(a=u,s.wrapper_breakpoint[n].col=a,c[s.wrapper.get_wrapper_id()]=a,s.wrapper_breakpoint[n].edited||(s.wrapper_breakpoint[n].order=p+h,s.wrapper_breakpoint[n].clear=o===0),s.wrapper.set_property("breakpoint",s.wrapper_breakpoint,i))})})},adapt_region_to_breakpoint:function(e,t,n,r){var i=Upfront.Application,s=Upfront.Behaviors.GridEditor,o=Upfront.Views.breakpoints_storage.get_breakpoints().get_default().toJSON();line_col=0,r=r===!0?!0:!1,e.each(function(e){var i=Upfront.Util.clone(e.get_property_value_by_name("breakpoint")||{}),s=e.get_property_value_by_name("col"),u=e.get("sub");_.isObject(i[t])||(i[t]={edited:!1}),i[t].edited||(e.is_main()||!u||u.match(/^(left|right)$/)?i[t].col=o.columns:u.match(/^lightbox$/)&&s>n&&(i[t].col=n)),e.set_property("breakpoint",i,r)})},create_region_resizable:function(t,n){var r=this,i=Upfront.Behaviors.GridEditor,s=t.$el,o=e(Upfront.Settings.LayoutEditor.Selectors.main),u=o.find(".upfront-layout"),a=n.collection,f=a.indexOf(n),l=a.size()-1,c=n.get("sub"),h=n.get("container"),p,d,v,m={},g=function(){var e={top:n.get_property_value_by_name("top"),left:n.get_property_value_by_name("left"),bottom:n.get_property_value_by_name("bottom"),right:n.get_property_value_by_name("right"),width:n.get_property_value_by_name("width"),height:n.get_property_value_by_name("height")};return e.is_top=typeof e.top=="number",e.is_left=typeof e.left=="number",e.is_bottom=typeof e.bottom=="number",e.is_right=typeof e.right=="number",e};if(s.data("ui-resizable"))return!1;if(!n.is_main()&&c&&!c.match(/^(fixed|left|right)$/))return;n.is_main()?(p=["s"],d={s:".upfront-region-resize-handle-s"}):c=="left"?(p=["e","s"],d={e:".upfront-region-resize-handle-e",s:".upfront-region-resize-handle-s"}):c=="right"?(p=["w","s"],d={w:".upfront-region-resize-handle-w",s:".upfront-region-resize-handle-s"}):c=="fixed"&&(m=g(),m.is_top&&m.is_left||m.is_bottom&&m.is_right?(p=["nw","se"],d={nw:".upfront-region-resize-handle-nw",se:".upfront-region-resize-handle-se"}):(p=["ne","sw"],d={ne:".upfront-region-resize-handle-ne",sw:".upfront-region-resize-handle-sw"})),_.each(p,function(e){var t=e.match(/^(e|w|s|n)$/)?"upfront-icon-control-region upfront-icon-control-region-resize upfront-icon-control-region-resize-"+e:"upfront-icon-control upfront-icon-control-resize upfront-icon-control-resize-"+e;s.append('<div class="'+t+" upfront-region-resize-handle upfront-region-resize-handle-"+e+" ui-resizable-handle ui-resizable-"+e+'"></div>')}),s.resizable({containment:"document",handles:d,helper:"region-resizable-helper",disabled:!0,zIndex:9999999,start:function(n,r){var o=i.get_class_num(s,i.grid.class),u=e(this).data("ui-resizable"),a=r.helper;v=u.axis?u.axis:"se",i.resizing=window.scrollY,e(this).resizable("option","minWidth",i.col_size*3);if(c!="fixed")e(this).resizable("option","maxWidth",i.col_size*10);else{e(this).resizable("option","minHeight",i.baseline*3),s.css("position",""),t.update_region_position(),m=g();var f=s.position();u.originalPosition.left=f.left,u.originalPosition.top=f.top,u.originalSize.width=m.width,u.originalSize.height=m.height,u._updateCache({left:f.left,top:f.top}),a.css({marginLeft:0,marginTop:0,left:f.left,top:f.top,position:"fixed"})}Upfront.Events.trigger("entity:region:resize_start",t,t.model)},resize:function(e,n){var r=n.helper;if(c!="fixed")if(v=="s"){var u=Math.abs(Math.ceil(n.size.height/i.baseline)),a=Math.round(u*i.baseline);r.css({height:a,width:n.originalSize.width,minWidth:n.originalSize.width,maxWidth:n.originalSize.width}),t.update_size_hint(n.originalSize.width,a),s.data("resize-row",u)}else{var f=i.get_class_num(s,i.grid.class),l=s.prevAll(".upfront-region:first"),h=s.nextAll(".upfront-region:first"),p=l.size()>0?i.get_class_num(l,i.grid.class):0,d=h.size()>0?i.get_class_num(h,i.grid.class):0,g=f+(d>p?d:p),y=Math.abs(Math.ceil(n.size.width/i.col_size)),b=y>g?g:y,w=Math.round(b*i.col_size);r.css({height:n.originalSize.height,width:w,minWidth:w,maxWidth:w,marginLeft:v=="w"?n.size.width-w:0}),t.update_size_hint(w,n.originalSize.height),s.data("resize-col",b)}else{var E=s.offset(),S=o.offset(),x=s.height(),T=s.width(),N=max_width=!1,C,k;m.is_top&&(N=v=="nw"||v=="ne"?m.top+x:!1),!m.is_top&&m.is_bottom&&(N=v=="se"||v=="sw"?m.bottom+x:!1),m.is_left&&(max_width=v=="nw"||v=="sw"?m.left+T:!1),!m.is_left&&m.is_right&&(max_width=v=="se"||v=="ne"?m.right+T:!1),k=Math.round(N&&n.size.height>N?N:n.size.height),C=Math.round(max_width&&n.size.width>max_width?max_width:n.size.width),r.css({height:k,width:C}),t.update_size_hint(C,k,r),s.data("resize-height",k),s.data("resize-width",C)}},stop:function(e,r){var o=Upfront.Settings.LayoutEditor.CurrentBreakpoint,u,a;i.resizing=!1,s.css({width:"",minWidth:"",maxWidth:"",height:"",position:"",top:"",left:"",right:"",bottom:""});if(c!="fixed"){var f=s.data("resize-col"),l=s.data("resize-row");if(!o||o.default)f&&n.set_property("col",f),l&&n.set_property("row",l);else if(f||l)u=Upfront.Util.clone(n.get_property_value_by_name("breakpoint")||{}),_.isObject(u[o.id])||(u[o.id]={}),a=u[o.id],a.edited=!0,f&&(a.col=f),l&&(a.row=l),n.set_property("breakpoint",u);s.removeData("resize-col"),s.removeData("resize-row")}else{var h=s.data("resize-width"),p=s.data("resize-height"),f=Math.floor(h/i.col_size);(v=="nw"||v=="ne")&&m.is_top&&n.set_property("top",m.top+m.height-p),(v=="se"||v=="sw")&&!m.is_top&&m.is_bottom&&n.set_property("bottom",m.bottom+m.height-p),(v=="nw"||v=="sw")&&m.is_left&&n.set_property("left",m.left+m.width-h),(v=="se"||v=="ne")&&!m.is_left&&m.is_right&&n.set_property("right",m.right+m.width-h),n.set_property("width",h,!0),n.set_property("height",p,!0),n.set_property("col",f,!0),n.get("properties").trigger("change"),s.removeData("resize-width"),s.removeData("resize-height")}Upfront.Events.trigger("entity:region:resize_stop",t,t.model)}})},create_region_draggable:function(t,n){if(!n.get("container")||n.get("container")==n.get("name"))return;var r=this,i=Upfront.Behaviors.GridEditor,s=t.$el,o=e(Upfront.Settings.LayoutEditor.Selectors.main),u=o.find(".upfront-layout"),a=t.parent_view.get_container_view(n),f=n.get("sub"),l={},c=!1,h=function(){var e={top:n.get_property_value_by_name("top"),left:n.get_property_value_by_name("left"),bottom:n.get_property_value_by_name("bottom"),right:n.get_property_value_by_name("right"),width:n.get_property_value_by_name("width"),height:n.get_property_value_by_name("height")};return e.is_top=typeof e.top=="number",e.is_left=typeof e.left=="number",e.is_bottom=typeof e.bottom=="number",e.is_right=typeof e.right=="number",e},p={},d="";if(f!="fixed")return!1;if(s.data("ui-draggable"))return!1;s.draggable({disabled:!0,revert:!0,revertDuration:0,zIndex:100,helper:"clone",delay:15,scroll:!1,iframeFix:!0,start:function(e,t){var r=t.helper,i=s.width(),o=s.height();r.css("width",i),r.css("height",o),s.hide(),l=h(),c=n.get("restrict_to_container"),d=r.css("position")},drag:function(n,r){var i=r.helper,s=o.offset(),u=o.width(),f=a.$el.offset(),l=a.$el.height(),c=f.top+l,h=e(window).scrollTop(),v=e(window).height(),m=h+v,g=u/2+s.left,y=d=="fixed"||l>v?v/2:l/2,b=r.position.left,w=r.position.top,E=i.width(),S=i.height(),x=E/2+b,T=S/2+w,N,C,k,L;p={},d=="absolute"&&l>v&&c<=m&&(y=l-v/2),T<=y?(d=="fixed"||l<v||c>=m?N=0:N=l-v,k=w<N?N:w,p.top=k-N):(d=="fixed"||l>v&&f.top>=h?N=v-S:N=l-S,k=w>N?N:w,p.bottom=N-k),x<=g?(C=s.left,L=b<C?C:b,p.left=L-C):(C=u-E+s.left,L=b>C?C:b,p.right=C-L),t.update_position_hint(p,i),r.position.top=k,r.position.left=L},stop:function(e,t){s.show(),typeof p.top=="number"?(n.set_property("top",p.top,!0),n.remove_property("bottom",!0)):typeof p.bottom=="number"&&(n.set_property("bottom",p.bottom,!0),n.remove_property("top",!0)),typeof p.left=="number"?(n.set_property("left",p.left,!0),n.remove_property("right",!0)):typeof p.right=="number"&&(n.set_property("right",p.right,!0),n.remove_property("left",!0)),n.get("properties").trigger("change")}})},create_region_container_resizable:function(t,n){var r=this,i=Upfront.Behaviors.GridEditor,s=t.$el,o=e(Upfront.Settings.LayoutEditor.Selectors.main),u=n.get("sub"),a="s",f={},l=o.find(".upfront-layout");if(s.data("ui-resizable"))return!1;!n.is_main()&&u=="bottom"&&(a="n"),s.append('<div class="upfront-icon-control-region upfront-icon-control-region-resize upfront-icon-control-region-resize-'+a+" upfront-region-resize-handle upfront-region-resize-handle-"+a+" ui-resizable-handle ui-resizable-"+a+'"></div>'),f[a]=".upfront-region-resize-handle-"+a,s.resizable({containment:"document",handles:f,helper:"region-resizable-helper",disabled:!0,zIndex:9999999,start:function(e,n){Upfront.Events.trigger("entity:region_container:resize_start",t,t.model),Upfront.Events.trigger("command:region:edit_toggle",!1),i._prepare_resize_auto_scroll(n,l.find("> .upfront-regions"))},resize:function(r,o){var u=o.helper,a=(o.size.height>15?o.size.height:0)||o.originalSize.height,f=Math.ceil(a/i.baseline),l=e(this).data("ui-resizable");u.css({width:s.width(),height:f*i.baseline}),s.data("resize-row",f);var c=Upfront.data.region_views[n.cid];c&&c.update_size_hint(c.$el.width(),f*i.baseline),_.each(t.sub_model,function(e){var t=Upfront.data.region_views[e.cid];t&&(t.$el.hasClass("upfront-region-side-left")||t.$el.hasClass("upfront-region-side-right"))&&t.update_size_hint(t.$el.width(),f*i.baseline)}),i._start_resize_auto_scroll(r,o,a,l)},stop:function(e,r){var o=Upfront.Settings.LayoutEditor.CurrentBreakpoint,u=s.data("resize-row"),a,f;s.css({width:"",minHeight:"",height:"",maxHeight:"",position:"",top:"",left:""}),i._clear_resize_auto_scroll(),!o||o.default?n.set_property("row",u):(a=Upfront.Util.clone(n.get_property_value_by_name("breakpoint")||{}),_.isObject(a[o.id])||(a[o.id]={}),f=a[o.id],f.edited=!0,f.row=u,n.set_property("breakpoint",a)),s.removeData("resize-row"),Upfront.Events.trigger("entity:region_container:resize_stop",t,t.model),Upfront.Events.trigger("command:region:edit_toggle",!0),i.resizing=!1}})},_auto_scroll_t:!1,_auto_scroll_data:{},_auto_scroll_step:3,_auto_scroll_timeout:100,_prepare_resize_auto_scroll:function(t,n){var r=e(document).height(),i=e('<div class="upfront-auto-scroller"></div>');i.css({width:1,height:0,visibility:"hidden"}).appendTo(n?n:"body"),this._auto_scroll_data={document_height:r,position_top:t.originalPosition.top,position_height:t.originalSize.height,position_rest:r-(t.originalPosition.top+t.originalSize.height),$scroller:i}},_start_resize_auto_scroll:function(t,n,r,i){var s=this,o=e(window).height(),u=Math.abs(o-t.clientY),a=r-this._auto_scroll_data.position_height,f=a-this._auto_scroll_data.position_rest,l=0,c=this._auto_scroll_step*this.baseline,h=n.helper;clearTimeout(this._auto_scroll_t);if(u>50)return;this._auto_scroll_t=setTimeout(function(){l+=c,f+l>0&&s._auto_scroll_data.$scroller.height(f+l+u),i.size.height=r+l,i.parentData.height=e(document).height(),h.css("height",i.size.height),e(window).scrollTop(e(window).scrollTop()+c),i._trigger("resize",t,n)},this._auto_scroll_timeout)},_clear_resize_auto_scroll:function(){this._auto_scroll_data.$scroller.remove(),clearTimeout(this._auto_scroll_t)},toggle_region_resizable:function(t){var n=e(Upfront.Settings.LayoutEditor.Selectors.main),r;t?(n.hasClass("upfront-region-fixed-editing")?r=e(".upfront-region-side-fixed"):r=e(".upfront-region-center, .upfront-region-side-left, .upfront-region-side-right, .upfront-region-container-wide, .upfront-region-container-clip, .upfront-region-sub-container"),r.each(function(){e(this).data("ui-resizable")&&e(this).resizable("option","disabled",!1)})):e(".upfront-region, .upfront-region-container").each(function(){e(this).data("ui-resizable")&&e(this).resizable("option","disabled",!0)})},toggle_region_draggable:function(t){var n=e(Upfront.Settings.LayoutEditor.Selectors.main),r;t?(n.hasClass("upfront-region-fixed-editing")?r=e(".upfront-region-side-fixed"):r=e(".upfront-region-side-left, .upfront-region-side-right, .upfront-region-container-wide, .upfront-region-container-clip"),r.each(function(){e(this).data("ui-draggable")&&e(this).draggable("option","disabled",!1)})):e(".upfront-region, .upfront-region-container").each(function(){e(this).data("ui-draggable")&&e(this).draggable("option","disabled",!0)})},edit_structure:function(){var t=Upfront.Behaviors.GridEditor,n=Upfront.Application,r=Upfront.Settings.LayoutEditor.Grid,i=e('<div class="upfront-edit-grid-wrap clearfix" />'),s=e('<div class="upfront-edit-grid upfront-edit-grid-recommended" />'),o=e('<div class="upfront-edit-grid upfront-edit-grid-custom" />'),u=e('<div class="upfront-edit-page-color" />'),a=e('<div class="upfront-grid-width-preview">Grid width: <span class="upfront-grid-width" /></div>'),f=e('<div class="upfront-grid-width-preview">( Grid width: <span class="upfront-grid-width" /> )</div>'),l=r.column_width!=r.column_widths[r.size_name]||r.type_padding!=r.type_paddings[r.size_name]||r.baseline!=r.baselines[r.size_name]||!/^(0|5|10|15)$/.test(r.column_padding),c=function(){var e=p.grid.get_value()=="custom",n={column_width:e?p.custom_width.get_value():r.column_widths[r.size_name],column_padding:e?p.custom_padding.get_value():p.recommended_padding.get_value(),baseline:e?p.custom_baseline.get_value():r.baselines[r.size_name],type_padding:e?p.custom_type_padding.get_value():r.type_paddings[r.size_name]},i=n.column_width*r.size;a.find(".upfront-grid-width").text(i+"px"),f.find(".upfront-grid-width").text(i+"px"),t.update_grid(n)},h=new Upfront.Views.Editor.Command_ToggleGrid,p={structure:new Upfront.Views.Editor.Field.Radios({label:Upfront.Settings.l10n.global.behaviors.structure,layout:"vertical",default_value:n.layout.get("layout_slug")||"blank",icon_class:"upfront-structure-field-icon",values:[{label:"",value:"blank",icon:"blank"},{label:"",value:"wide",icon:"wide-no-sidebar"},{label:"",value:"wide-right-sidebar",icon:"wide-right-sidebar"},{label:"",value:"wide-left-sidebar",icon:"wide-left-sidebar"},{label:"",value:"clip",icon:"clip-no-sidebar"},{label:"",value:"clip-right-sidebar",icon:"clip-right-sidebar"},{label:"",value:"clip-left-sidebar",icon:"clip-left-sidebar"},{label:"",value:"full",icon:"full"},{label:"",value:"full-extended",icon:"full-extended"}],change:function(){if(Upfront.themeExporter.currentTheme==="upfront"){var e=p.structure.get_value(),t=n.layout.get("layout_slug");if(t&&t!=e||!t&&e!="blank")n.layout.set("layout_slug",e),Upfront.Application.get_gridstate()&&h.on_click(),n.create_layout(_upfront_post_data.layout,{layout_slug:e}),Upfront.Events.once("layout:render",function(){Upfront.Application.get_gridstate()||h.on_click()})}}}),grid:new Upfront.Views.Editor.Field.Radios({label:Upfront.Settings.l10n.global.behaviors.grid_settings,layout:"horizontal-inline",default_value:l?"custom":"recommended",values:[{label:Upfront.Settings.l10n.global.behaviors.recommended_settings,value:"recommended"},{label:Upfront.Settings.l10n.global.behaviors.custom_settings,value:"custom"}],change:function(){var e=this.get_value();e=="custom"?(o.show(),s.hide()):(s.show(),o.hide()),c()}}),recommended_padding:new Upfront.Views.Editor.Field.Select({default_value:r.column_padding,values:[{label:Upfront.Settings.l10n.global.behaviors.padding_large,value:"15"},{label:Upfront.Settings.l10n.global.behaviors.padding_medium,value:"10"},{label:Upfront.Settings.l10n.global.behaviors.padding_small,value:"5"},{label:Upfront.Settings.l10n.global.behaviors.no_padding,value:"0"}],change:c}),bg_color:new Upfront.Views.Editor.Field.Color({model:n.layout,label:Upfront.Settings.l10n.global.behaviors.page_bg_color,label_style:"inline",property:"background_color",spectrum:{move:function(e){var t=e.toRgb(),r="rgba("+t.r+","+t.g+","+t.b+","+e.alpha+")";n.layout.set_property("background_color",r)}}}),custom_width:new Upfront.Views.Editor.Field.Number({label:Upfront.Settings.l10n.global.behaviors.column_width,label_style:"inline",min:40,max:100,default_value:r.column_width,change:c}),custom_padding:new Upfront.Views.Editor.Field.Number({label:Upfront.Settings.l10n.global.behaviors.column_padding,label_style:"inline",min:0,max:100,default_value:r.column_padding,change:c}),custom_baseline:new Upfront.Views.Editor.Field.Number({label:Upfront.Settings.l10n.global.behaviors.baseline_grid,label_style:"inline",min:5,max:100,default_value:r.baseline,change:c}),custom_type_padding:new Upfront.Views.Editor.Field.Number({label:Upfront.Settings.l10n.global.behaviors.additional_type_padding,label_style:"inline",min:0,max:100,default_value:r.type_padding,change:c}),floated:new Upfront.Views.Editor.Field.Checkboxes({multiple:!1,default_value:!0,values:[{label:Upfront.Settings.l10n.global.behaviors.allow_floats_outside_main_grid,value:!0}]})};t.structure_modal||(t.structure_modal=new Upfront.Views.Editor.Modal({to:e("body"),button:!0,top:120,width:540}),t.structure_modal.render(),e("body").append(t.structure_modal.el)),Upfront.Application.get_gridstate()||h.on_click(),t.structure_modal.open(function(e,t){t.addClass("upfront-structure-modal"),_.each(p,function(e){e.render(),e.delegateEvents()}),e.html(""),Upfront.themeExporter.currentTheme==="upfront"&&e.append(p.structure.el),e.append(p.grid.el),s.append(p.recommended_padding.el),s.append(a),i.append(s),o.append(p.custom_width.el),o.append(f),o.append(p.custom_padding.el),o.append(p.custom_baseline.el),o.append(p.custom_type_padding.el),u.append(p.bg_color.el),i.append(o),i.append(u),e.append(i),e.append(p.floated.el),p.grid.trigger("changed")},t).always(function(){Upfront.Application.get_gridstate()&&h.on_click()})},update_grid:function(t){var n=Upfront.Application,r=[],i=Upfront.Settings.LayoutEditor.Grid,s="#page",o=n.layout.get_property_value_by_name("grid")||{column_widths:{},column_paddings:{},baselines:{},type_paddings:{}},u=Upfront.Settings.LayoutEditor.CurrentBreakpoint||Upfront.Settings.LayoutEditor.Grid.size_name,a=Upfront.Views.breakpoints_storage.get_breakpoints().findWhere({id:_.isObject(u)?u.id:u}),f=!1;t.column_width&&(o.column_widths[i.size_name]=t.column_width,a.get_property_value_by_name("column_width")!=t.column_width&&(a.set_property("column_width",t.column_width),f=!0)),"column_padding"in t&&(o.column_paddings[i.size_name]=t.column_padding,a.get_property_value_by_name("column_padding")!=t.column_padding&&(a.set_property("column_padding",t.column_padding),f=!0)),t.baseline&&(t.baseline!=i.baseline&&(clearTimeout(this._load_editor_css),this._load_editor_css=setTimeout(function(){Upfront.Util.post({action:"upfront_load_editor_grid",baseline:t.baseline},"text").success(function(t){e("#upfront-editor-grid-inline").length?e("#upfront-editor-grid-inline").html(t):e("head").append('<style id="upfront-editor-grid-inline">'+t+"</style>")})},1e3)),o.baselines[i.size_name]=t.baseline,a.get_property_value_by_name("baseline")!=t.baseline&&(a.set_property("baseline",t.baseline),f=!0)),t.type_padding&&(o.type_paddings[i.size_name]=t.type_padding,a.get_property_value_by_name("type_padding")!=t.type_padding&&(a.set_property("type_padding",t.type_padding),f=!0)),Upfront.Settings.LayoutEditor.Grid=_.extend(i,t),n.layout.set_property("grid",o),n.layout_view.update_grid_css(),this.init(),f&&Upfront.Application.get_current()==Upfront.Settings.Application.MODE.THEME&&a.trigger("change:enabled",a)},apply_grid:function(){var e=Upfront.Behaviors.GridEditor,t=Upfront.Application,n=Upfront.Settings.LayoutEditor.Grid,r=t.layout.get_property_value_by_name("grid");if(!r||!r.column_widths||!r.column_widths[n.size_name])return;return e.update_grid({column_width:r.column_widths[n.size_name],column_padding:r.column_paddings[n.size_name],baseline:r.baselines[n.size_name],type_padding:r.type_paddings[n.size_name]})},time_start:function(e){this.show_debug_element&&console.time(e)},time_end:function(e){this.show_debug_element&&console.timeEnd(e)},set_timeout:function(e){this.timeout=e},set_compare_size:function(e,t){this.compare_col=e,this.compare_row=t},toggle_debug:function(){this.show_debug_element=!this.show_debug_element,this.show_debug_element?this.render_debug():this.delete_debug()},render_debug:function(){var t=this,n=e(Upfront.Settings.LayoutEditor.Selectors.main);$modal=e('<div id="behavior-debug" class="upfront-inline-modal"></div>'),$wrap=e('<div class="upfront-inline-modal-wrap"></div>'),field_delay=new Upfront.Views.Editor.Field.Number({name:"delay",label:Upfront.Settings.l10n.global.behaviors.delay_before_drag,label_style:"inline",min:0,max:2e3,step:1,default_value:300,change:function(){e(".upfront-module.ui-draggable, .upfront-module-group.ui-draggable, .upfront-object.ui-draggable").draggable("option","delay",this.get_value())}}),field_timeout=new Upfront.Views.Editor.Field.Number({name:"timeout",label:Upfront.Settings.l10n.global.behaviors.delay_before_changing_position,label_style:"inline",min:0,max:2e3,step:1,default_value:t.timeout,change:function(){t.timeout=parseInt(this.get_value())}}),field_debug=new Upfront.Views.Editor.Field.Checkboxes({name:"debug",multiple:!1,default_value:!0,values:[{label:Upfront.Settings.l10n.global.behaviors.show_debug_info,value:!0}],change:function(){t.show_debug_element=this.get_value()?!0:!1}}),$close=e('<a href="#" class="upfront-close-debug">'+Upfront.Settings.l10n.global.behaviors.close+"</a>"),n.addClass("show-debug"),field_delay.render(),$wrap.append(field_delay.$el),field_timeout.render(),$wrap.append(field_timeout.$el),field_debug.render(),$wrap.append(field_debug.$el),$wrap.append($close),$modal.append($wrap),e("body").append($modal),$modal.css({top:"auto",left:"auto",bottom:0,right:0,position:"fixed"}),$wrap.css({width:360,top:0,padding:"10px",position:"relative"}),$close.on("click",function(){t.show_debug_element=!1,t.delete_debug()})},delete_debug:function(){var t=e(Upfront.Settings.LayoutEditor.Selectors.main);t.removeClass("show-debug"),e("#behavior-debug").remove()}};return r})}(jQuery),function(e){define("behaviors",["scripts/upfront/behaviors/layout-editor","scripts/upfront/behaviors/grid-editor"],function(e,t){return{Behaviors:{LayoutEditor:e,GridEditor:t}}})}(jQuery);var DateFormat={};!function(e){var t=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],n=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],r=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],i=["January","February","March","April","May","June","July","August","September","October","November","December"],s={Jan:"01",Feb:"02",Mar:"03",Apr:"04",May:"05",Jun:"06",Jul:"07",Aug:"08",Sep:"09",Oct:"10",Nov:"11",Dec:"12"},o=/\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}\.?\d{0,3}[Z\-+]?(\d{2}:?\d{2})?/;e.format=function(){function e(e){return t[parseInt(e,10)]||e}function u(e){return n[parseInt(e,10)]||e}function a(e){var t=parseInt(e,10)-1;return r[t]||e}function l(e){var t=parseInt(e,10)-1;return i[t]||e}function h(e){return s[e]||e}function p(e){var t,n,r,i,s,o=e,u="";return-1!==o.indexOf(".")&&(i=o.split("."),o=i[0],u=i[1]),s=o.split(":"),3===s.length?(t=s[0],n=s[1],r=s[2].replace(/\s.+/,"").replace(/[a-z]/gi,""),o=o.replace(/\s.+/,"").replace(/[a-z]/gi,""),{time:o,hour:t,minute:n,second:r,millis:u}):{time:"",hour:"",minute:"",second:"",millis:""}}function v(e,t){for(var n=t-String(e).length,r=0;n>r;r++)e="0"+e;return e}return{parseDate:function(e){var t={date:null,year:null,month:null,dayOfMonth:null,dayOfWeek:null,time:null};if("number"==typeof e)return this.parseDate(new Date(e));if("function"==typeof e.getFullYear)t.year=String(e.getFullYear()),t.month=String(e.getMonth()+1),t.dayOfMonth=String(e.getDate()),t.time=p(e.toTimeString());else if(-1!=e.search(o))values=e.split(/[T\+-]/),t.year=values[0],t.month=values[1],t.dayOfMonth=values[2],t.time=p(values[3].split(".")[0]);else switch(values=e.split(" "),6===values.length&&isNaN(values[5])&&(values[values.length]="()"),values.length){case 6:t.year=values[5],t.month=h(values[1]),t.dayOfMonth=values[2],t.time=p(values[3]);break;case 2:subValues=values[0].split("-"),t.year=subValues[0],t.month=subValues[1],t.dayOfMonth=subValues[2],t.time=p(values[1]);break;case 7:case 9:case 10:t.year=values[3],t.month=h(values[1]),t.dayOfMonth=values[2],t.time=p(values[4]);break;case 1:subValues=values[0].split(""),t.year=subValues[0]+subValues[1]+subValues[2]+subValues[3],t.month=subValues[5]+subValues[6],t.dayOfMonth=subValues[8]+subValues[9],t.time=p(subValues[13]+subValues[14]+subValues[15]+subValues[16]+subValues[17]+subValues[18]+subValues[19]+subValues[20]);break;default:return null}return t.date=new Date(t.year,t.month-1,t.dayOfMonth),t.dayOfWeek=String(t.date.getDay()),t},date:function(t,n){try{var r=this.parseDate(t);if(null===r)return t;for(var i=(r.date,r.year),s=r.month,o=r.dayOfMonth,f=r.dayOfWeek,c=r.time,h="",p="",d="",g=!1,y=0;y<n.length;y++){var b=n.charAt(y),w=n.charAt(y+1);if(g)"'"==b?(p+=""===h?"'":h,h="",g=!1):h+=b;else switch(h+=b,d="",h){case"ddd":p+=e(f),h="";break;case"dd":if("d"===w)break;p+=v(o,2),h="";break;case"d":if("d"===w)break;p+=parseInt(o,10),h="";break;case"D":o=1==o||21==o||31==o?parseInt(o,10)+"st":2==o||22==o?parseInt(o,10)+"nd":3==o||23==o?parseInt(o,10)+"rd":parseInt(o,10)+"th",p+=o,h="";break;case"MMMM":p+=l(s),h="";break;case"MMM":if("M"===w)break;p+=a(s),h="";break;case"MM":if("M"===w)break;p+=v(s,2),h="";break;case"M":if("M"===w)break;p+=parseInt(s,10),h="";break;case"y":case"yyy":if("y"===w)break;p+=h,h="";break;case"yy":if("y"===w)break;p+=String(i).slice(-2),h="";break;case"yyyy":p+=i,h="";break;case"HH":p+=v(c.hour,2),h="";break;case"H":if("H"===w)break;p+=parseInt(c.hour,10),h="";break;case"hh":hour=0===parseInt(c.hour,10)?12:c.hour<13?c.hour:c.hour-12,p+=v(hour,2),h="";break;case"h":if("h"===w)break;hour=0===parseInt(c.hour,10)?12:c.hour<13?c.hour:c.hour-12,p+=parseInt(hour,10),h="";break;case"mm":p+=v(c.minute,2),h="";break;case"m":if("m"===w)break;p+=c.minute,h="";break;case"ss":p+=v(c.second.substring(0,2),2),h="";break;case"s":if("s"===w)break;p+=c.second,h="";break;case"S":case"SS":if("S"===w)break;p+=h,h="";break;case"SSS":p+=c.millis.substring(0,3),h="";break;case"a":p+=c.hour>=12?"PM":"AM",h="";break;case"p":p+=c.hour>=12?"p.m.":"a.m.",h="";break;case"E":p+=u(f),h="";break;case"'":h="",g=!0;break;default:p+=b,h=""}}return p+=d}catch(E){return console&&console.log&&console.log(E),t}},prettyDate:function(e){var t,n,r;return("string"==typeof e||"number"==typeof e)&&(t=new Date(e)),"object"==typeof e&&(t=new Date(e.toString())),n=((new Date).getTime()-t.getTime())/1e3,r=Math.floor(n/86400),isNaN(r)||0>r?void 0:60>n?"just now":120>n?"1 minute ago":3600>n?Math.floor(n/60)+" minutes ago":7200>n?"1 hour ago":86400>n?Math.floor(n/3600)+" hours ago":1===r?"Yesterday":7>r?r+" days ago":31>r?Math.ceil(r/7)+" weeks ago":r>=31?"more than 5 weeks ago":void 0},toBrowserTimeZone:function(e,t){return this.date(new Date(e),t||"MM/dd/yyyy HH:mm:ss")}}}()}(DateFormat),function(e){e.format=DateFormat.format}(jQuery),define("jquery-df",function(){}),function(e,t){function i(t){var n,r=e(t.ownerDocument);return t=e(t),n=t.offset(),{x:n.left+t.outerWidth()/2-r.scrollLeft(),y:n.top+t.outerHeight()/2-r.scrollTop()}}var n=/^key/,r=/^(?:mouse|contextmenu)|click/;e.fn.simulate=function(t,n){return this.each(function(){new e.simulate(this,t,n)})},e.simulate=function(t,n,r){var i=e.camelCase("simulate-"+n);this.target=t,this.options=r,this[i]?this[i]():this.simulateEvent(t,n,r)},e.extend(e.simulate,{keyCode:{BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38},buttonCode:{LEFT:0,MIDDLE:1,RIGHT:2}}),e.extend(e.simulate.prototype,{simulateEvent:function(e,t,n){var r=this.createEvent(t,n);this.dispatchEvent(e,t,r,n)},createEvent:function(e,t){if(n.test(e))return this.keyEvent(e,t);if(r.test(e))return this.mouseEvent(e,t)},mouseEvent:function(n,r){var i,s,o,u;return r=e.extend({bubbles:!0,cancelable:n!=="mousemove",view:window,detail:0,screenX:0,screenY:0,clientX:1,clientY:1,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,button:0,relatedTarget:t},r),document.createEvent?(i=document.createEvent("MouseEvents"),i.initMouseEvent(n,r.bubbles,r.cancelable,r.view,r.detail,r.screenX,r.screenY,r.clientX,r.clientY,r.ctrlKey,r.altKey,r.shiftKey,r.metaKey,r.button,r.relatedTarget||document.body.parentNode),i.pageX===0&&i.pageY===0&&Object.defineProperty&&(s=i.relatedTarget.ownerDocument||document,o=s.documentElement,u=s.body,Object.defineProperty(i,"pageX",{get:function(){return r.clientX+(o&&o.scrollLeft||u&&u.scrollLeft||0)-(o&&o.clientLeft||u&&u.clientLeft||0)}}),Object.defineProperty(i,"pageY",{get:function(){return r.clientY+(o&&o.scrollTop||u&&u.scrollTop||0)-(o&&o.clientTop||u&&u.clientTop||0)}}))):document.createEventObject&&(i=document.createEventObject(),e.extend(i,r),i.button={0:1,1:4,2:2}[i.button]||i.button),i},keyEvent:function(n,r){var i;r=e.extend({bubbles:!0,cancelable:!0,view:window,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,keyCode:0,charCode:t},r);if(document.createEvent)try{i=document.createEvent("KeyEvents"),i.initKeyEvent(n,r.bubbles,r.cancelable,r.view,r.ctrlKey,r.altKey,r.shiftKey,r.metaKey,r.keyCode,r.charCode)}catch(s){i=document.createEvent("Events"),i.initEvent(n,r.bubbles,r.cancelable),e.extend(i,{view:r.view,ctrlKey:r.ctrlKey,altKey:r.altKey,shiftKey:r.shiftKey,metaKey:r.metaKey,keyCode:r.keyCode,charCode:r.charCode})}else document.createEventObject&&(i=document.createEventObject(),e.extend(i,r));if(!!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase())||{}.toString.call(window.opera)==="[object Opera]")i.keyCode=r.charCode>0?r.charCode:r.keyCode,i.charCode=t;return i},dispatchEvent:function(e,t,n){e[t]?e[t]():e.dispatchEvent?e.dispatchEvent(n):e.fireEvent&&e.fireEvent("on"+t,n)},simulateFocus:function(){function i(){n=!0}var t,n=!1,r=e(this.target);r.bind("focus",i),r[0].focus(),n||(t=e.Event("focusin"),t.preventDefault(),r.trigger(t),r.triggerHandler("focus")),r.unbind("focus",i)},simulateBlur:function(){function i(){n=!0}var t,n=!1,r=e(this.target);r.bind("blur",i),r[0].blur(),setTimeout(function(){r[0].ownerDocument.activeElement===r[0]&&r[0].ownerDocument.body.focus(),n||(t=e.Event("focusout"),t.preventDefault(),r.trigger(t),r.triggerHandler("blur")),r.unbind("blur",i)},1)}}),e.extend(e.simulate.prototype,{simulateDrag:function(){var e=0,t=this.target,n=this.options,r=i(t),s=Math.floor(r.x),o=Math.floor(r.y),u=n.dx||0,a=n.dy||0,f=n.moves||3,l={clientX:s,clientY:o};this.simulateEvent(t,"mousedown",l);for(;e<f;e++)s+=u/f,o+=a/f,l={clientX:Math.round(s),clientY:Math.round(o)},this.simulateEvent(document,"mousemove",l);this.simulateEvent(t,"mouseup",l),this.simulateEvent(t,"click",l)}})}(jQuery),define("jquery-simulate",function(){}),function(e,t){typeof exports=="object"&&e.require?module.exports=t(require("underscore"),require("backbone")):typeof define=="function"&&define.amd?define("scripts/backbone-query-parameters/backbone-query-parameters",["underscore","backbone"],function(n,r){return t(n||e._,r||e.Backbone)}):t(_,Backbone)}(this,function(e,t){function c(n,r){function s(e){return String(e).replace(i,encodeURIComponent(i))}var i=t.Router.arrayValueSplit;if(!n)return"";r=r||"";var o=[];return e.each(n,function(t,n){n=r+n;if(e.isString(t)||e.isNumber(t)||e.isBoolean(t)||e.isDate(t))t!=null&&o.push(n+"="+s(encodeURIComponent(t)));else if(e.isArray(t)){var u="";for(var a=0;a<t.length;a++){var f=t[a];f!=null&&(u+=i+s(f))}u&&o.push(n+"="+u)}else{var l=c(t,n+".");l&&o.push(l)}}),o.join("&")}function h(e){try{return decodeURIComponent(e.replace(/\+/g," "))}catch(t){return e}}function p(t,n){var r=t.split("&");e.each(r,function(e){var t=e.split("=");n(t.shift(),t.join("="))})}var n=/^\?(.*)/,r=/\((.*?)\)/g,i=/(\(\?)?:\w+/g,s=/\*\w+/g,o=/[\-{}\[\]+?.,\\\^$|#\s]/g,u=/^([^\?]*)/,a=/[\:\*]([^\:\?\/]+)/g,f=/^[#\/]|\s+$/g,l=/\/$/;t.Router.arrayValueSplit="|",e.extend(t.History.prototype,{getFragment:function(e,t){if(e==null)if(this._hasPushState||!this._wantsHashChange||t){e=this.location.pathname;var n=this.root.replace(l,""),r=this.location.search;e.indexOf(n)||(e=e.substr(n.length)),r&&this._hasPushState&&(e+=r)}else e=this.getHash();return e.replace(f,"")},getQueryParameters:function(t,r){t=this.getFragment(t,r);var i=t.replace(u,""),s=i.match(n);if(s){i=s[1];var o={};return p(i,function(t,n){n=h(n),o[t]?e.isString(o[t])?o[t]=[o[t],n]:o[t].push(n):o[t]=n}),o}return{}}}),e.extend(t.Router.prototype,{initialize:function(e){this.encodedSplatParts=e&&e.encodedSplatParts},_routeToRegExp:function(t){var n=s.exec(t)||{index:-1},u=i.exec(t)||{index:-1},f=t.match(a)||[];t=t.replace(o,"\\$&").replace(r,"(?:$1)?").replace(i,function(e,t){return t?e:"([^\\/\\?]+)"}).replace(s,"([^??]*?)"),t+="(\\?.*)?";var l=new RegExp("^"+t+"$");return n.index>=0&&(u>=0?l.splatMatch=n.index-u.index:l.splatMatch=-1),l.paramNames=e.map(f,function(e){return e.substring(1)}),l.namedParameters=this.namedParameters,l},_extractParameters:function(r,i){var s=r.exec(i).slice(1),o={};s.length>0&&e.isUndefined(s[s.length-1])&&s.splice(s.length-1,1);var u=s.length&&s[s.length-1]&&s[s.length-1].match(n);if(u){var a=u[1],f={};if(a){var l=this;p(a,function(e,t){l._setParamValue(e,t,f)})}s[s.length-1]=f,e.extend(o,f)}var c=s.length;if(r.splatMatch&&this.encodedSplatParts){if(r.splatMatch<0)return s;c-=1}for(var d=0;d<c;d++)e.isString(s[d])&&(s[d]=h(s[d]),r.paramNames&&r.paramNames.length>=d-1&&(o[r.paramNames[d]]=s[d]));return t.Router.namedParameters||r.namedParameters?[o]:s},_setParamValue:function(e,t,n){e=e.replace("[]",""),e=e.replace("%5B%5D","");var r=e.split("."),i=n;for(var s=0;s<r.length;s++){var o=r[s];s===r.length-1?i[o]=this._decodeParamValue(t,i[o]):i=i[o]=i[o]||{}}},_decodeParamValue:function(n,r){var i=t.Router.arrayValueSplit;if(i&&n.indexOf(i)>=0){var s=n.split(i);for(var o=s.length-1;o>=0;o--)s[o]?s[o]=h(s[o]):s.splice(o,1);return s}return n=h(n),r?e.isArray(r)?(r.push(n),r):[r,n]:n},toFragment:function(t,n){return n&&(e.isString(n)||(n=c(n)),n&&(t+="?"+n)),t}})}),function(e){e.fn.responsiveElement=function(){return this.each(function(){function h(t){var n=_.isString(t)&&t!=""?e(t):e(".upfront-layout");return v(n)}function p(e){return v(e.$el.parent())}function d(e){if(n.match(/\.upfront-region-container/))h();else{var t=e.$el.hasClass(".upfront-region")?e.$el:e.$el.closest(".upfront-region");v(n.match(/\.upfront-region/)?t.parent():t)}}function v(c,h){var p=e("#"+t),d=!1;if(r&&!i)return;c.find(n+":visible").each(function(){var t=h?e(this).closest(".upfront-module"):e(this);id=e(this).attr("id")||"bind-"+Math.floor(Math.random()*1e5),width=parseFloat(t.css("width")),height=parseFloat(t.css("height")),e(this).attr("id")||e(this).attr("id",id);var n=(s&&width>=s||!s)&&(o&&width<=o||!o)&&(u&&height>=u||!u)&&(a&&height<=a||!a);typeof l[id]=="undefined"&&(l[id]=""),n?l[id]==""&&(l[id]=f.replace(/\( ?this ?\)/igm,"#"+id),d=!0):l[id]!=""&&(l[id]="",d=!0)});if(!d)return;var v=e.map(l,function(e,t){return e});p.length?p.html(v.join("\n")):(p=e('<style id="'+t+'">'+v.join("\n")+"</style>"),e("body").append(p))}function m(e){if(typeof e=="undefined")return!1;var t=/^(\d+)px$/i,n=/^(\d+)col$/i,r=/^(\d+)row$/i;if(e.match(t))return e.match(t)[1]}var t="responsive-"+Math.floor(Math.random()*1e5),n=e(this).attr("data-bind"),r=e(this).attr("data-editor")==1,i=!1,s=m(e(this).attr("data-min-width")),o=m(e(this).attr("data-max-width")),u=m(e(this).attr("data-min-height")),a=m(e(this).attr("data-max-height")),f=e(this).html(),l={},c;c=_.throttle(function(t){t.target==this?h():v(e(t.target),!0)},100),e(window).on("load",h),e(window).on("resize",c),e(document).on("upfront-load",function(){typeof Upfront.Events!="undefined"&&Upfront.Events.once("layout:render",function(){i=!0,h(),Upfront.Events.on("layout:after_render",function(){h()}),Upfront.Events.on("entity:modules:render_module",p),Upfront.Events.on("entity:regions:render_region",d),Upfront.Events.on("entity:regions:render_container",p),Upfront.Events.on("upfront:wrappers:after_fix_height",p),Upfront.Events.on("entity:region_container:resize_stop",p),Upfront.Events.on("upfront:editor:image_on",function(e){h()}),Upfront.Events.on("upfront:editor:image_align",function(e,t){h()})})})})},e('[type="text/responsive_css"]').responsiveElement()}(jQuery),define("responsive",function(){}),window.findAndReplaceDOMText=function(){function i(e){return r.call(e)=="[object Array]"}function s(e){return String(e).replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")}function o(){return u.apply(null,arguments)||a.apply(null,arguments)}function u(e,t,n,r,i){if(t&&!t.nodeType&&arguments.length<=2)return!1;var s=typeof n=="function";s&&(n=function(e){return function(t,n){return e(t.text,n.startIndex)}}(n));var u=a(t,{find:e,wrap:s?null:n,replace:s?n:"$"+(r||"&"),prepMatch:function(e,t){if(!e[0])throw"findAndReplaceDOMText cannot handle zero-length matches";if(r>0){var n=e[r];e.index+=e[0].indexOf(n),e[0]=n}return e.endIndex=e.index+e[0].length,e.startIndex=e.index,e.index=t,e},filterElements:i});return o.revert=function(){return u.revert()},!0}function a(e,t){return new f(e,t)}function f(t,n){n.portionMode=n.portionMode||e,this.node=t,this.options=n,this.prepMatch=n.prepMatch||this.prepMatch,this.reverts=[],this.matches=this.search(),this.matches.length&&this.processMatches()}var e="retain",t="first",n=document,r={}.toString;return o.Finder=f,f.prototype={search:function(){var e,t=0,n=this.options.find,r=this.getAggregateText(),i=[];n=typeof n=="string"?RegExp(s(n),"g"):n;if(n.global)while(e=n.exec(r))i.push(this.prepMatch(e,t++));else(e=r.match(n))&&i.push(this.prepMatch(e,0));return i},prepMatch:function(e,t){if(!e[0])throw new Error("findAndReplaceDOMText cannot handle zero-length matches");return e.endIndex=e.index+e[0].length,e.startIndex=e.index,e.index=t,e},getAggregateText:function(){function t(n){if(n.nodeType===3)return n.data;if(e&&!e(n))return"";var r="";if(n=n.firstChild)do r+=t(n);while(n=n.nextSibling);return r}var e=this.options.filterElements;return t(this.node)},processMatches:function(){var e=this.matches,t=this.node,n=this.options.filterElements,r,i,s=[],o=t,u=e.shift(),a=0,f=0,l=0,c,h=[t];e:for(;;){o.nodeType===3&&(!i&&o.length+a>=u.endIndex?i={node:o,index:l++,text:o.data.substring(u.startIndex-a,u.endIndex-a),indexInMatch:a-u.startIndex,indexInNode:u.startIndex-a,endIndexInNode:u.endIndex-a,isEnd:!0}:r&&s.push({node:o,index:l++,text:o.data,indexInMatch:a-u.startIndex,indexInNode:0}),!r&&o.length+a>u.startIndex&&(r={node:o,index:l++,indexInMatch:0,indexInNode:u.startIndex-a,endIndexInNode:u.endIndex-a,text:o.data.substring(u.startIndex-a,u.endIndex-a)}),a+=o.data.length),c=o.nodeType===1&&n&&!n(o);if(r&&i){o=this.replaceMatch(u,r,s,i),a-=i.node.data.length-i.endIndexInNode,r=null,i=null,s=[],u=e.shift(),l=0,f++;if(!u)break}else if(!c&&(o.firstChild||o.nextSibling)){o.firstChild?(h.push(o),o=o.firstChild):o=o.nextSibling;continue}for(;;){if(o.nextSibling){o=o.nextSibling;break}o=h.pop();if(o===t)break e}}},revert:function(){for(var e=this.reverts.length;e--;)this.reverts[e]();this.reverts=[]},prepareReplacementString:function(e,n,r,i){var s=this.options.portionMode;return s===t&&n.indexInMatch>0?"":(e=e.replace(/\$(\d+|&|`|')/g,function(e,t){var n;switch(t){case"&":n=r[0];break;case"`":n=r.input.substring(0,r.startIndex);break;case"'":n=r.input.substring(r.endIndex);break;default:n=r[+t]}return n}),s===t?e:n.isEnd?e.substring(n.indexInMatch):e.substring(n.indexInMatch,n.indexInMatch+n.text.length))},getPortionReplacementNode:function(e,t,r){var i=this.options.replace||"$&",s=this.options.wrap;if(s&&s.nodeType){var o=n.createElement("div");o.innerHTML=s.outerHTML||(new XMLSerializer).serializeToString(s),s=o.firstChild}if(typeof i=="function")return i=i(e,t,r),i&&i.nodeType?i:n.createTextNode(String(i));var u=typeof s=="string"?n.createElement(s):s;return i=n.createTextNode(this.prepareReplacementString(i,e,t,r)),i.data?u?(u.appendChild(i),u):i:i},replaceMatch:function(e,t,r,i){var s=t.node,o=i.node,u,a;if(s===o){var f=s;t.indexInNode>0&&(u=n.createTextNode(f.data.substring(0,t.indexInNode)),f.parentNode.insertBefore(u,f));var l=this.getPortionReplacementNode(i,e);return f.parentNode.insertBefore(l,f),i.endIndexInNode<f.length&&(a=n.createTextNode(f.data.substring(i.endIndexInNode)),f.parentNode.insertBefore(a,f)),f.parentNode.removeChild(f),this.reverts.push(function(){u===l.previousSibling&&u.parentNode.removeChild(u),a===l.nextSibling&&a.parentNode.removeChild(a),l.parentNode.replaceChild(f,l)}),l}u=n.createTextNode(s.data.substring(0,t.indexInNode)),a=n.createTextNode(o.data.substring(i.endIndexInNode));var c=this.getPortionReplacementNode(t,e),h=[];for(var p=0,d=r.length;p<d;++p){var v=r[p],m=this.getPortionReplacementNode(v,e);v.node.parentNode.replaceChild(m,v.node),this.reverts.push(function(e,t){return function(){t.parentNode.replaceChild(e.node,t)}}(v,m)),h.push(m)}var g=this.getPortionReplacementNode(i,e);return s.parentNode.insertBefore(u,s),s.parentNode.insertBefore(c,s),s.parentNode.removeChild(s),o.parentNode.insertBefore(g,o),o.parentNode.insertBefore(a,o),o.parentNode.removeChild(o),this.reverts.push(function(){u.parentNode.removeChild(u),c.parentNode.replaceChild(s,c),a.parentNode.removeChild(a),g.parentNode.replaceChild(o,g)}),g}},o}(),define("findandreplace",function(){}),function(e){define("upfront/objects/loading",[],function(){var e=Upfront.Models.ObjectModel.extend({init:function(){this.init_property("type","LoadingModel"),this.init_property("view_class","LoadingView"),this.init_property("element_id",Upfront.Util.get_unique_id("please_wait")),this.init_property("content","Please, wait..."),this.init_property("class","c24")}}),t=Upfront.Views.ObjectView.extend({model:e,get_content_markup:function(){return'<img src="'+Upfront.Settings.root_url+'/img/loading.gif" /> '+"<i>"+this.model.get_content()+"</i>"+""}});Upfront.Models.LoadingModel=e,Upfront.Views.LoadingView=t})}(jQuery),function(){define("objects",["upfront/objects/loading"],function(){if(!Upfront||!Upfront.Application.LayoutEditor||!Upfront.Application.LayoutEditor.add_object)return Upfront.Util.log("Unable to add object"),!1})}(),function(e){define("scripts/upfront/upfront-media/insert-options-item-control",[],function(){var e=Upfront.Settings.l10n.media,t={uf_insert:"image_insert",wp_insert:"wp_default"},n=Backbone.View.extend({initialize:function(e){},render:function(){var n=new Upfront.Views.Editor.Field.Radios({label:e.insert_options,model:this.model,name:"insert_option",layout:"horizontal-inline",default_value:this.model.at(0).get("insert_option")||"image_insert",values:[{label:e.image_inserts,value:t.uf_insert},{label:e.wp_default,value:t.wp_insert}],change:function(e){this.model.at(0).set("insert_option",e)}});return n.render(),this.$el.html(n.el),this}});return{Options_Control:n,INSERT_OPTIONS:t}})}(jQuery),function(e,t){define("media",["scripts/upfront/upfront-media/insert-options-item-control"],function(n){var r={FULL:"full",to_size:function(e){return e.width+"x"+e.height}},i=Upfront.Settings.l10n.media,s=n.INSERT_OPTIONS,o=Backbone.Collection.extend({defaults:{thumbnail:"",title:""}}),u=Backbone.Collection.extend({model:a,initialize:function(){Upfront.Events.on("media_manager:media:labels_loaded",this.global_labels_loaded,this)},get_shared_labels:function(){var e=h.get("label"),t=[],n=[],r={};return this.each(function(e){r[e.get("ID")]=e.get("labels")||[]}),t=_.intersection.apply(this,_(r).values()),e.each(function(e){(t.indexOf(e.get("value"))>=0||t.indexOf(parseInt(e.get("value"),10))>=0)&&n.push(e)}),n},get_additional_sizes:function(){if(!h.multiple_sizes)return!1;var e=this.invoke("get","additional_sizes"),t=[];return _(e).each(function(e,n){var i=[];n||(t=_(e).map(function(e){return r.to_size(e)})),_(e).each(function(e){i.push(r.to_size(e))}),t=_.intersection(t,i)}),t.push(r.FULL),t},is_used_label:function(e){return _(this.get_shared_labels()).invoke("get","value").indexOf(e.get("value"))>=0},update_label_state:function(e){return this.is_used_label(e)?this.disassociate_label(e):this.associate_label(e)},associate_label:function(e){this._update_label("",e)},disassociate_label:function(e){this._update_label("dis",e)},_update_label:function(e,t){e=e||"";var n=this,r=t.get("value"),i={action:"upfront-media-"+e+"associate_label",term:r,post_ids:this.invoke("get","ID")};Upfront.Util.post(i).success(function(e){n.each(function(t){var n=e.data[t.get("ID")];n&&t.set({labels:n},{silent:!0})}),n.trigger("change")})},add_new_label:function(e){var t=this,n={action:"upfront-media-add_label",term:e,post_ids:this.invoke("get","ID")};Upfront.Util.post(n).success(function(e){t.each(function(t){var n=e.data[t.get("ID")];n&&t.set({labels:n},{silent:!0})}),Upfront.Events.trigger("media_manager:media:labels_updated"),t.trigger("change")})},delete_media_items:function(){var e=this,t={action:"upfront-media-remove_item",post_ids:this.invoke("get","ID")};Upfront.Util.post(t).success(function(t){e.reset([]),Upfront.Events.trigger("media_manager:media:list",h)})},global_labels_loaded:function(){this.trigger("change")}}),a=Backbone.Model.extend({defaults:{thumbnail:"<span class='upfront-image-upload-placeholder'></span>",insert_option:"image_insert"}}),f=Backbone.Collection.extend({model:M}),l=Backbone.Model.extend({}),c=Backbone.Model.extend({CONST:{CUTOFF_SIZE:8,CUTOFF_BIT:3},labels_cache:!1,default_media_types:["images","videos","audios","other"],allowed_media_types:[],image_sizes:!0,showing_titles:!0,current_keys:new Array,current_models:new Array,current_page:1,max_pages:1,max_items:1,media_limit:20,initialize:function(){this.to_defaults(),Upfront.Events.on("media_manager:media:filters_updated",this.update_active_filters,this),Upfront.Events.on("media_manager:media:labels_updated",this.reload_labels,this),Upfront.Events.on("media_manager:media:toggle_titles",this.toggle_titles,this)},to_defaults:function(){var e=new f([]),t=this.allowed_media_types.indexOf("other")>=0;this.allowed_media_types.length||(this.allowed_media_types=this.default_media_types),this.allowed_media_types.indexOf("images")>=0&&e.add(new l({filter:i.filter.images,value:"images",state:!t}),{silent:!0}),this.allowed_media_types.indexOf("videos")>=0&&e.add(new l({filter:i.filter.videos,value:"videos",state:!t}),{silent:!0}),this.allowed_media_types.indexOf("audios")>=0&&e.add(new l({filter:i.filter.audios,value:"audios",state:!t}),{silent:!0}),this.allowed_media_types.indexOf("other")>=0&&e.add(new l({filter:i.filter.all,value:"other",state:t}),{silent:!0}),this.set("type",e,{silent:!0}),this.set("recent",new f([new l({filter:"5",value:5,state:!1}),new l({filter:"10",value:10,state:!1}),new l({filter:"20",value:20,state:!1}),new l({filter:"40",value:40,state:!1}),new l({filter:"100",value:100,state:!1})]),{silent:!0}),this.set("order",new f([new l({filter:i.filter.newest,value:"date_desc",state:!0}),new l({filter:i.filter.oldest,value:"date_asc",state:!1}),new l({filter:i.filter.a_z,value:"title_asc",state:!1}),new l({filter:i.filter.z_a,value:"title_desc",state:!1})]),{silent:!0}),this.set({search:new f([])},{silent:!0}),this.themeImages=!1,this.current_page=1,this.set_labels_to_defaults()},set_max_pages:function(e){this.max_pages=e||1},set_max_items:function(e){this.max_items=e||1},prev_page:function(){if(this.current_page>1)return this.set_page(this.current_page-1)},next_page:function(){if(this.current_page<this.max_pages)return this.set_page(this.current_page+1)},set_page:function(e){return e?e>=1&&e<this.max_pages?e==this.current_page?!1:(this.current_page=e,!0):!1:!1},toggle_titles:function(){this.showing_titles=!this.showing_titles},set_labels_to_defaults:function(){if(this.labels_cache){var e=[];_(this.labels_cache).each(function(t){e.push(new l({filter:t.name,value:t.term_id,state:!1}))}),this.set("label",new f(e),{silent:!0}),Upfront.Events.trigger("media_manager:media:labels_loaded")}else this.reload_labels()},reload_labels:function(){var e=this;Upfront.Util.post({action:"upfront-media-get_labels"}).success(function(t){var n=[];t.data&&(e.labels_cache=t.data,e.set_labels_to_defaults())})},update_active_filters:function(e,t){if(!e||!this.get(e))this.to_defaults(),Upfront.Events.trigger("media_manager:media:filters_reset");else{var n=t&&t.get?t.get(e).toArray():t,r=this.get(e);_(n).each(function(e){if(e.get("state")){var t=r.where({filter:e.get("filter")});t.length&&t[0].set({state:e.get("state")},{silent:!0})}})}Upfront.Events.trigger("media_manager:media:list",this)},to_request_json:function(){var e={},t=this;return _(this.attributes).each(function(n,r){var i=t.get(r).where({state:!0});e[r]=_(i).invoke("get","value")}),e.page=this.current_page,e},to_list:function(){var e={},t=this;return _(this.attributes).each(function(n,r){var i=t.get(r).where({state:!0}),s=[];s=_(i).filter(function(e){var t=e.get("value");return"other"!==t&&"date_desc"!==t}),e[r]=_(s).invoke("get","filter")}),e},has_upload:function(){return this.themeImages?Upfront.Application.is_builder():!0}}),h=new c,p=Backbone.View.extend({className:"upfront-media-controls",is_search_active:!1,initialize:function(e){Upfront.Events.on("media:item:selection_changed",this.switch_controls,this),Upfront.Events.on("media:search:requested",this.switch_to_search,this),this.options=e.options},render:function(){this.render_filters()},render_filters:function(){this.control=this.is_search_active?new w:new E,this.control.render(),this.$el.empty().append(this.control.$el),this.is_search_active?this.$el.removeClass("upfront-media-controls-search-selected").addClass("upfront-media-controls-search"):this.$el.removeClass("upfront-media-controls-search")},render_media:function(e){var t=new g({model:new u(e),options:this.options});t.render(),this.$el.empty(),this.is_search_active?(this.control=new w,this.control.render(),this.$el.append(this.control.$el),this.$el.removeClass("upfront-media-controls-search").addClass("upfront-media-controls-search-selected")):this.$el.removeClass("upfront-media-controls-search-selected"),this.$el.append(t.$el)},switch_controls:function(e){var t=e.where({selected:!0});t.length?this.render_media(t):this.render_filters()},switch_to_search:function(e){this.is_search_active=e&&e.get("state"),this.render_filters()},remove:function(){this.control&&this.control.remove(),Upfront.Events.off("media:item:selection_changed",this.switch_controls),Upfront.Events.off("media:search:requested",this.switch_to_search)}}),d=Backbone.View.extend({className:"upfront-media-aux_controls",initialize:function(){Upfront.Events.on("media:item:selection_changed",this.switch_controls,this)},render:function(){this.render_selection()},render_selection:function(){var e=new v({model:this.model});e.render(),this.$el.empty().append(e.$el),this.$el.removeClass("upfront-media-aux_controls-has-select")},render_delete:function(e){var t=new m({model:new u(e)});t.render(),this.render_selection(),this.$el.append(t.$el),this.$el.addClass("upfront-media-aux_controls-has-select")},switch_controls:function(e){var t=e&&e.where?e.where({selected:!0}):[];t.length?this.render_delete(t):this.render_selection()},remove:function(){Upfront.Events.off("media:item:selection_changed",this.switch_controls)}}),v=Backbone.View.extend({className:"select_control_container",events:{"click a.none":"select_none","click a.all":"select_all"},initialize:function(){this.display_values=[{label:"20",value:20},{label:"40",value:40},{label:"60",value:60},{label:"80",value:80},{label:"100",value:100}]},render:function(){var e=this;e.$el.empty().append(i.select+' <a href="#all" class="all">'+i.all+'</a>&nbsp;|&nbsp;<a href="#none" class="none">'+i.none+"</a>"),e.select_display_field=new Upfront.Views.Editor.Field.Select({label:i.display+":",className:"upfront-field-wrap upfront-field-wrap-select upfront-filter_display_control",name:"display-selection",width:"70px",values:e.display_values,multiple:!1,default_value:h.media_limit,change:function(){e.select_display(this.get_value())}}),e.select_display_field.render(),e.$el.append(e.select_display_field.$el)},select_display:function(e){h.media_limit=e,Upfront.Events.trigger("media_manager:media:list",h)},select_none:function(e){e.preventDefault(),e.stopPropagation();var t=this.model.where({selected:!0});if(t.length){this.model.each(function(e){e.set({selected:!1},{silent:!0})}),this.model.trigger("change"),Upfront.Events.trigger("media:item:selection_changed",this.model);var n=new u(h.current_models);Upfront.Events.trigger("media:item:selection_changed",n)}},select_all:function(e){e.preventDefault(),e.stopPropagation();var t=[];this.model.each(function(e){e.set({selected:!0},{silent:!0}),t.push(e)}),this.model.trigger("change"),Upfront.Events.trigger("media:item:selection_changed",this.model);var n=new u(h.current_models);Upfront.Events.trigger("media:item:selection_changed",n)}}),m=Backbone.View.extend({className:"delete_control_container",events:{click:"delete_selection"},render:function(){this.$el.empty().append('<a href="#delete">'+i.del_command+"</a>")},delete_selection:function(e){e.preventDefault(),e.stopPropagation();if(confirm(i.confirm_delete_items)){var t=!1;this.model.each(function(e){e.get("parent")&&(t=!0)});if(!t||t&&confirm(i.item_in_use_nag))h.current_keys=[],h.current_models=[],this.model.delete_media_items()}}}),g=Backbone.View.extend({className:"upfront-item-control",options:{insert_options:!1,hide_sizes:!1},templates:{caption:_.template('<label class="upfront-field-label upfront-field-label-block">{{title}}</label>'),shared_label:_.template('<a href="#remove" class="upfront-icon upfront-icon-media-label-delete" data-idx="{{value}}">{{filter}}</a>'),additional_size:_.template('<option value="{{size}}">{{size}}</option>')},events:{"click .existing_labels a":"drop_label"},initialize:function(e){this.model.on("change",this.render,this),this.options=_.extend(this.options,e.options)},render:function(){var e=this,t=_(["change_title","size_hints","add_labels","existing_labels","insert_options","additional_sizes"]),n=_(["render_title","render_size_hint","render_labels_adding","render_shared_labels","render_additional_sizes","render_insert_options"]);this.$el.empty(),this.options.insert_options||(t=_(t.reject(function(e){return e==="insert_options"})),n=_(n.reject(function(e){return e==="render_insert_options"}))),t.each(function(t){e.$el.append('<div class="'+t+'" />')}),n.each(function(t){e[t]()})},render_size_hint:function(){var n=this,r=this.$el.find(".size_hints"),s,o;r.empty();if(this.model.length===1){var u=this.model.at(0).get("image"),a=e('<div class="upfront-size-hints upfront-field-wrap upfront-field-wrap-text"><label class="upfront-field-label upfront-field-label-block">'+i.natural_size+"</label></div>");u!==t&&(a.append('<span class="upfront-size-hint-width">'+i.width_label+": <span>"+u.width+i.px_label+"</span></span>"),a.append('<span class="upfront-size-hint-height">'+i.height_label+": <span>"+u.height+i.px_label+"</span></span>"),r.append(a))}},render_title:function(){var e=this,t=this.$el.find(".change_title");t.empty(),this.model.length>1?t.append('<span class="selected_length">'+i.files_selected.replace(/%d/,this.model.length)+"</span>"):(this.title_field=new Upfront.Views.Editor.Field.Text({model:this.model.at(0),label:i.media_title,name:"post_title",change:function(){e.change_title()}}),this.title_field.render(),t.append(this.title_field.$el))},render_labels_adding:function(){var e=this,t=this.$el.find(".add_labels"),n=new y({model:this.model});t.empty().append(this.templates.caption({title:i.add_labels})),n.render(),t.append(n.$el),this.$el.on("click",function(e){e.stopPropagation(),n.trigger("filters:selection:click")})},render_shared_labels:function(){var e=this,t=this.$el.find(".existing_labels"),n=this.model.get_shared_labels(),r=n.length>1?i.current_labels:"";t.empty().append(this.templates.caption({title:r})),_(n).each(function(n){t.append(e.templates.shared_label(n.toJSON()))})},render_additional_sizes:function(){var e=this,t=this.$el.find(".additional_sizes"),n=this.model.get_additional_sizes(),o=i.additional_sizes,u=[];t.empty();if(this.options.insert_options&&this.model.at(0).get("insert_option")===s.wp_insert||!this.options.hide_sizes&&!this.options.insert_options){if(!n.length)return!1;_(n).each(function(e){u.push({label:e===r.FULL?i.size_full:e,value:e})}),this.size_field=new Upfront.Views.Editor.Field.Select({model:this.model.at(0),label:o,name:"selected_size",width:"100%",values:u,default_value:r.FULL,change:function(){e.select_size()}}),this.size_field.render(),t.append(this.size_field.$el),this.size_field.$el.on("click",function(e){e.stopPropagation()})}this.model.length<2&&this.add_url_label(t)},add_url_label:function(e){var t=new Upfront.Views.Editor.Field.Text({model:this.model.at(0),label:i.url,name:"document_url"});t.render(),e.append(t.$el)},select_size:function(e){var t=this.size_field.get_value()||r.FULL;this.model.each(function(e){e.set({selected_size:t},{silent:!0})})},change_title:function(e){var t=this.model.at(0);t.set({post_title:this.title_field.get_value()});var n=this,r={action:"upfront-media-update_media_item",data:t.toJSON()};Upfront.Util.post(r).done(function(){t.trigger("change")}),t.trigger("appearance:update")},drop_label:function(t){t.preventDefault(),t.stopPropagation();var n=e(t.target),r=n.attr("data-idx"),i=this.model.get_shared_labels(),s=_(i).invoke("get","value").indexOf(r),o=s>=0&&i[s]?i[s]:!1;o&&this.model.update_label_state(o)},render_insert_options:function(){var e=this.$(".insert_options"),t=new n.Options_Control({model:this.model});t.render(),e.html(t.el)}}),y=Backbone.View.extend({className:"upfront-additive_multiselection",selection:"",events:{"click :text":"stop_prop","click .title":"show_labels","keyup .search_labels :text":"update_selection","click .add_labels a":"add_new_labels"},stop_prop:function(e){e.stopPropagation()},show_labels:function(e){e.stopPropagation(),e.preventDefault(),this.$el.addClass("active")},hide_labels:function(e){this.$el.removeClass("active")},render:function(){this.$el.empty().append('<div class="title">'+i.please_select_labels+"</div>").append('<div class="search_labels" />').append('<div class="labels_list"><ul></ul></div>').append('<div class="add_labels" />'),this.render_search(),this.render_labels(),this.render_addition(),this.on("filters:selection:click",function(){this.hide_labels()},this)},render_search:function(){var e=this.$el.find(".search_labels");e.empty().append('<input type="text" class="upfront-field upfront-field-text" value="'+this.selection+'"/>')},render_labels:function(){var e=this,t=this.$el.find(".labels_list ul"),n=h.get("label"),r=this.model.get_shared_labels(),i=!1;t.empty(),n.each(function(n){var s=new b({model:n});s.shared=r,s.media_items=e.model,s.selection=e.selection,s.render(),s.$el.find("input").size()>0&&(i=!0,t.append(s.$el))}),i?t.removeClass("empty"):t.addClass("empty")},render_addition:function(){var e=this.$el.find(".add_labels");e.empty(),this.selection?e.append('<b class="add_value">'+this.selection+'</b> <a class="add_link" href="#add">'+i.add+"</a>").removeClass("empty"):e.addClass("empty")},update_selection:function(e){e.preventDefault(),e.stopPropagation();var t=this.$el.find(".search_labels :text"),n=t.val();this.selection=n,this.render_labels(),this.render_addition()},add_new_labels:function(e){e.preventDefault(),e.stopPropagation();var t=this.$el.find(".search_labels :text"),n=t.val();this.model.add_new_label(n)}}),b=Backbone.View.extend({tagName:"li",events:{click:"toggle_label_assignment"},render:function(){var e=this,t=this.media_items.is_used_label(this.model),n=_.template('<input type="checkbox" id="{{id}}" class="upfront-field-checkbox" value="{{value}}" checked />'),r=_.template('<input type="checkbox" id="{{id}}" class="upfront-field-checkbox" value="{{value}}" />'),i=_.template('<label for="{{id}}">{{name}}</label>'),s=this.model.get("filter")||"",o=this.selection?new RegExp("^("+this.selection+")","i"):!1,u=this.model.toJSON();this.$el.empty();if(!s.match(o))return!1;u.id=this.cid,u.name=s.replace(o,'<span class="selection">$1</span>'),this.$el.append(i(u)).append((t?n:r)(u))},toggle_label_assignment:function(e){e.preventDefault(),e.stopPropagation(),this.media_items.update_label_state(this.model)}}),w=Backbone.View.extend({className:"upfront-search_filter-control",events:{"click a":"clear_search"},render:function(){var e=h.get("search").first(),t=e.toJSON();t.total=h.max_items,this.$el.empty().append(_.template(i.showing_total_results+' <b class="search-text">{{value}}</b> <a href="#clear" class="clear_search">'+i.clear_search+"</a>",t))},clear_search:function(e){e.preventDefault(),e.stopPropagation();var t=new l({filter:!1,value:!1,state:!1});h.set({search:new f([t])}),Upfront.Events.trigger("media_manager:media:list",h),Upfront.Events.trigger("media:search:requested",t)}}),E=Backbone.View.extend({className:"upfront-filter-control",events:{click:"stop_prop"},stop_prop:function(e){e.stopPropagation(),this.filter_selection&&this.filter_selection.trigger("filters:outside_click")},initialize:function(){this.filter_selection=new x,this.filters_selected=new S({model:h})},render:function(){this.filter_selection.render(),this.filters_selected.render(),this.$el.empty().append(this.filter_selection.$el).append(this.filters_selected.$el)},toggle_titles:function(e){e.stopPropagation(),Upfront.Events.trigger("media_manager:media:toggle_titles")},remove:function(){this.filters_selected.remove()}}),S=Backbone.View.extend({className:"upfront-filter_selected-control",events:{"click a.filter":"drop_filter","click a.all_filters":"drop_all"},initialize:function(){Upfront.Events.on("media_manager:media:list",this.set_filters,this)},render:function(){this.$el.empty();var e=this,t=_(this.model.to_list()),n=_([]),r=_.template(' <a href="#" class="filter upfront-icon upfront-icon-media-label-delete" data-type="{{type}}" data-filter="{{filter}}">{{filter}}</a>');t.each(function(e,t){_(e).each(function(e){n.push({filter:e,type:t})})});if(!n.size())return!1;this.$el.append('<label class="upfront-field-label upfront-field-label-block">'+i.active_filters+"</label>"),n.each(function(t){e.$el.append(r(t))}),this.$el.append(" <a href='#' class='all_filters'>"+i.clear_all_filters+"</a>")},set_filters:function(e){this.model=e,this.render()},drop_filter:function(t){t.preventDefault(),t.stopPropagation();var n=e(t.target),r=this.model,i=n.attr("data-type"),s=n.attr("data-filter");if(i&&r.get(i)){var o=r.get(i).where({filter:s});o&&o.length&&_(o).invoke("set",{state:!1},{silent:!0})}else _(this.model.attributes).each(function(e,t){var n=r.get(t).where({filter:s});n.length&&(i=t,_(n).invoke("set",{state:!1},{silent:!0}))});Upfront.Events.trigger("media_manager:media:filters_updated",i,this.model)},drop_all:function(e){e.preventDefault(),e.stopPropagation(),Upfront.Events.trigger("media_manager:media:filters_updated",!1,!1)},remove:function(){Upfront.Events.off("media_manager:media:list",this.set_filters)}}),x=Backbone.View.extend({className:"upfront-filter_selection-control clearfix",initialize:function(){this.controls=_([new D,new P,new H]),this.on("filters:outside_click",function(){this.controls.each(function(e){e.trigger("filters:selection:click")})},this)},render:function(){var e=this,t=_.template("<li style='display:none'><a href='#' data-idx='{{idx}}'>{{name}}</a></li>"),n=[{label:i.select_filter,value:"false"}];this.controls.each(function(e,t){n.push({label:e.get_name(),value:t})}),this.$el.empty(),this.$el.append('<div class="upfront-filter_control" />'),this.$control=this.$el.find("div.upfront-filter_control"),this.control_field=new Upfront.Views.Editor.Field.Select({label:i.filter_label,name:"filter-selection",width:"100%",values:n,multiple:!1,default_value:"false",change:function(){e.select_control(this.get_value())}}),this.control_field.render(),this.$el.prepend(this.control_field.$el)},select_control:function(e){this.$control.empty();if("false"===e)return!1;var t=this.controls.toArray()[e];return t.render(),this.$control.append(t.$el),!1}}),T=Backbone.View.extend({tagName:"ul",get_name:function(){return this.filter_name},initialize_model:function(){this.model=h.get(this.filter_type),this.model.on("change",this.apply_changes,this)},render:function(){var e=this;this.$el.empty(),this.model.each(function(t){if(e.allowed_values&&e.allowed_values.indexOf(t.get("value"))<0)return!1;var n=new k({model:t});n.render(),e.$el.append(n.$el)})},apply_changes:function(){var e={},t=[];e=this.model.where({state:!0}),Upfront.Events.trigger("media_manager:media:filters_updated",this.filter_type,e)},update_selection:function(){var e=h.get(this.filter_type);return e?this.model.each(function(t){var n=e.where({filter:t.get("filter"),state:!0});t.set({state:!!n.length})}):this.model.invoke("set",{state:!1}),this.render(),!1}}),N=T.extend({tagName:"div",className:"upfront-additive_multiselection",events:{click:"stop_prop","keyup :text.filter":"show_matching_labels"},stop_prop:function(e){e.stopPropagation(),this.$el.addClass("active")},update_state:function(e){this.$el.removeClass("active")},render:function(){var e=this,t=this.selection||"";this.$el.empty().append('<div class="title">'+i.please_select_labels+"</div>").append('<input type="text" class="filter upfront-field upfront-field-text" value="'+t+'" />').append('<div class="labels_list"><ul></ul></div>'),this.render_items(),this.on("filters:selection:click",function(){this.update_state()},this)},render_items:function(){var e=this,t=this.$el.find("div.labels_list ul");t.empty();if(!this.$el.is(".active"))return!1;this.model.each(function(n){if(e.allowed_values&&e.allowed_values.indexOf(n.get("value"))<0)return!1;var r=new A({model:n});r.selection=e.selection,r.render(),n.on("change:state",e.update_state,e),t.append(r.$el)})},show_matching_labels:function(e){var t=this.$el.find(":text.filter"),n=t.val();this.selection=n,this.render_items()}}),C=T.extend({render:function(){var e=this;this.$el.empty(),this.model.each(function(t){if(e.allowed_values&&e.allowed_values.indexOf(t.get("value"))<0)return!1;var n=new L({model:t});n.render(),e.$el.append(n.$el),n.on("model:unique_state:change",e.change_state,e)})},change_state:function(e){this.model.each(function(t){t.get("value")!=e.get("value")&&t.set({state:!1},{silent:!0})}),e.set({state:!0},{silent:!0}),this.apply_changes(),this.render()}}),k=Backbone.View.extend({tagName:"li",events:{click:"on_click"},initialize:function(){this.model.on("change",this.render,this)},render:function(){var e=this.model.get("filter");if("other"===this.model.get("value"))return!1;this.model.get("state")&&(e="<b>"+e+"</b>"),this.$el.empty().append(e)},on_click:function(e){e.preventDefault(),e.stopPropagation(),this.model.set({state:!this.model.get("state")})}}),L=k.extend({on_click:function(e){e.preventDefault(),e.stopPropagation(),this.model.set({state:!this.model.get("state")},{silent:!0}),this.trigger("model:unique_state:change",this.model)}}),A=k.extend({render:function(){var e=_.template('<input type="checkbox" for="{{id}}" class="upfront-field-checkbox" name="{{filter}}" value="{{value}}" checked />'),t=_.template('<input type="checkbox" for="{{id}}" class="upfront-field-checkbox" name="{{filter}}" value="{{value}}" />'),n=_.template('<label for="{{id}}">{{name}}</label>'),r=this.model.get("filter")||"",i=this.selection?new RegExp("^("+this.selection+")","i"):!1,s=this.model.toJSON();this.$el.empty();if(i&&!r.match(i))return!1;s.id=this.cid,s.name=r.replace(i,'<span class="selection">$1</span>'),this.$el.append(n(s)).append((this.model.get("state")?e:t)(s))}}),O=Backbone.View.extend({render:function(){var e=this;this.$el.empty(),this.model.each(function(t){var n=new M({model:t});n.render(),e.$el.append(n.$el)})}}),M=Backbone.View.extend({render:function(){this.$el.empty().append(this.model.get("filter"))}}),D=T.extend({initialize:function(){this.filter_name=i.media_type,this.filter_type="type",this.initialize_model(),Upfront.Events.on("media_manager:media:filters_updated",this.update_selection,this),Upfront.Events.on("media_manager:media:filters_reset",this.initialize_model,this)},apply_changes:function(e){var t=this.model.where({state:!0}),n=this.model.where({value:"other"}),r=e.previousAttributes();if(!n.length)return;n=n[0];if(r&&r.value&&"other"===r.value){var i=!!r.state;this.model.each(function(e){e.set({state:i},{silent:!0})}),n.set({state:!i},{silent:!0})}else n.get("state")&&n.set({state:!1},{silent:!0});T.prototype.apply_changes.call(this)}}),P=C.extend({allowed_values:["title_desc","title_asc"],initialize:function(){this.filter_name=i.file_name,this.filter_type="order",this.initialize_model(),Upfront.Events.on("media_manager:media:filters_updated",this.update_selection,this),Upfront.Events.on("media_manager:media:filters_reset",this.initialize_model,this)}}),H=N.extend({initialize:function(){this.filter_name=i.labels,this.filter_type="label",this.initialize_model(),Upfront.Events.on("media_manager:media:filters_updated",this.update_selection,this),Upfront.Events.on("media_manager:media:filters_reset",this.initialize_model,this),Upfront.Events.on("media_manager:media:labels_loaded",this.reinitialize_model,this)},reinitialize_model:function(){this.initialize_model(),this.render()}}),B=Backbone.View.extend({events:{"click .library":"switch_to_library","click .upload":"switch_to_upload","click .shortcode":"switch_to_shortcode","click .markup":"switch_to_markup"},switch_template:_.template('<ul class="upfront-tabs upfront-media_manager-tabs"> <li class="library">'+i.library+'</li> <li class="embed">'+i.embed+"</li> </ul> "),upload_template:_.template('<button type="button" class="upload">'+i.upload+"</button>"),initialize:function(){Upfront.Events.on("media_manager:media:show_library",this.switch_to_library,this)},render:function(){this.$el.empty().append(this.switch_template({})+(h.has_upload()?this.upload_template({}):"")),this.$el.addClass("clearfix"),this.switch_to_library()},remove:function(){this.undelegateEvents(),this.$el.empty()},switch_to_library:function(e){var t={};this.$el.find("li").removeClass("active").filter(".library").addClass("active"),e&&e.preventDefault?(e.preventDefault(),e.stopPropagation()):e&&(t=e),this.trigger("media_manager:switcher:to_library",t)},switch_to_embed:function(e){return!1},switch_to_upload:function(e){e.preventDefault(),e.stopPropagation(),this.trigger("media_manager:switcher:to_upload")},switch_to_shortcode:function(e){e.preventDefault(),e.stopPropagation(),this.$el.find("li").removeClass("active").filter(".shortcode").addClass("active"),this.trigger("media_manager:switcher:to_shortcode")},switch_to_markup:function(e){e.preventDefault(),e.stopPropagation(),this.$el.find("li").removeClass("active").filter(".markup").addClass("active"),this.trigger("media_manager:switcher:to_markup")},is_in_editing_mode:function(){var e=Upfront.Application.sidebar.prevented_usage_type;return!e.match(/media/)}}),j=Backbone.View.extend({_request_in_progress:!1,initialize:function(e){e=_.extend({type:"PostImage",multiple_selection:!1},e);var t=e.type,n=e.multiple_selection,r=e.button_text;this.popup_data=e.data,h.to_defaults(),this.switcher_view=new B({el:this.popup_data.$top}),this.listenTo(this.switcher_view,"media_manager:switcher:to_library",this.render_library,this),this.listenTo(this.switcher_view,"media_manager:switcher:to_embed",this.render_embed,this),this.listenTo(this.switcher_view,"media_manager:switcher:to_upload",this.render_upload,this),this.listenTo(this.switcher_view,"media_manager:switcher:to_shortcode",this.render_shortcode,this),this.listenTo(this.switcher_view,"media_manager:switcher:to_markup",this.render_markup,this),this.command_view=new F({el:this.popup_data.$bottom,button_text:r,ck_insert:e.ck_insert}),this.library_view=new J(e.collection,e),this.library_view.multiple_selection=n,e.themeImages&&(h.themeImages=!0,this.library_view.multiple_selection=!1)},remove:function(){this.library_view.remove(),this.switcher_view.remove(),Upfront.Events.off("media_manager:media:list",this.switch_media_type,this)},render:function(){this.switcher_view.render(),this.command_view.render(),this.render_library(),Upfront.Events.off("media_manager:media:list",this.switch_media_type).on("media_manager:media:list",this.switch_media_type,this)},render_library:function(){this.load(),this.library_view.render(),this.$el.empty().append(this.library_view.$el);if(arguments.length){var e=arguments[0],t=this;"ID"in e&&this.library_view.media_collection.once("reset",function(){var n=t.library_view.media_collection.where({ID:e.ID});n.length&&n[0].set({selected:!0})})}},render_embed:function(){return!1},render_upload:function(e){this.library_view.$el.is(":visible")||this.render_library();if(!window._upfront_media_upload||!_upfront_media_upload.image_ref)return alert(i.disabled),!1;var t=this,n=0,r=0,s=0,o=[],u=t.library_view._subviews.media,f=h.themeImages?_upfront_media_upload.theme:_upfront_media_upload.normal;this.$("#fileupload").remove(),this.$el.append('<input id="fileupload" type="file" style="display:none" name="media" data-url="'+f+'" multiple >'),this.$("#fileupload").off("click").on("click",function(e){e.stopPropagation()}).fileupload({dataType:"json",add:function(e,t){var r=t.files[0],i=n,s=r.name||"tmp";n+=1,o[i]=new a({progress:0}),o[i].set({post_title:s}),u.model.add(o[i],{at:0}),t.submit(),o[i].on("upload:abort",function(){t.abort(),o[i].get("ID")&&Upfront.Util.post({action:"upfront-media-remove_item",item_id:o[i].get("ID")}).always(function(){u.model.trigger("change")}),u.model.remove(o[i]),u.model.trigger("change")}),o[i].trigger("upload:start",r)},progressall:function(e,t){var n=r;r+=1;var i=parseInt(t.loaded/t.total*100,10);o[n]&&o[n].trigger("upload:progress",i)},done:function(e,n){var r=s;s+=1;if(h.themeImages)return o[r].set(n.result.data,{silent:!0}),o[r].trigger("upload:finish",t);var i=n.result.data||[],u=i[0];o[r].set({ID:u},{silent:!0}),Upfront.Util.post({action:"upfront-media-get_item",item_id:u}).done(function(e){o[r].set(e.data,{silent:!0}),o[r].trigger("upload:finish",t)}).fail(function(){Upfront.Events.trigger("media_manager:media:list",h)})},fail:function(e,t){t.jqXHR.responseJSON&&t.jqXHR.responseJSON.error&&Upfront.Views.Editor.notify(t.jqXHR.responseJSON.error,"error"),Upfront.Events.trigger("media_manager:media:list",h)}}).trigger("click")},render_shortcode:function(){},render_markup:function(){},load:function(e){this._request_in_progress=!0,e=e&&e.type?e:h.to_request_json(),e.media_limit=h.media_limit,e.action=h.themeImages?"upfront-media-list_theme_images":"upfront-media-list_media";var t=this;this.library_view.media_view&&this.library_view.media_view.start_loading&&this.library_view.media_view.start_loading(),Upfront.Util.post(e).done(function(e){h.set_max_pages(e.data.meta.max_pages),h.set_max_items(e.data.meta.max_items),t.library_view.update(e.data.items),t.command_view.render()}).fail(function(e){t.library_view.update([]),t.command_view.render()}).always(function(){t._request_in_progress=!1})},switch_media_type:function(e){if(this._request_in_progress)return!1;this.load(e.to_request_json())}}),F=Backbone.View.extend({initialize:function(e){this.options=e},render:function(){var e=this.options.button_text,t=new I,n=new q,r=this.options.ck_insert?new U({button_text:e}):new R({button_text:e});t.render(),n.render(),r.render(),this.$el.empty().append(t.$el).append(r.$el).append(n.$el)},switch_to_upload:function(e){this.trigger("media_manager:switcher:to_upload")}}),I=Backbone.View.extend({events:{"click .upfront-pagination_item-prev":"prev_page","click .upfront-pagination_item-next":"next_page","click .upfront-pagination_page-item":"set_page","click .upfront-pagination_page-current":"stop_prop","keypress .upfront-pagination_page-current":"set_page_keypress"},stop_prop:function(e){e.stopPropagation()},render:function(){var e="";h.max_pages>1&&(e+='<div id="upfront-entity_list-pagination">',e+='<a class="upfront-pagination_item upfront-pagination_item-skip upfront-pagination_item-prev"></a>',e+='<div class="upfront-pagination_navigation">',e+='<input type="text" class="upfront-pagination_page-current" value="'+h.current_page+'" />',e+="&nbsp;"+i.n_of_x+"&nbsp;",e+='<a class="upfront-pagination_page-item" data-idx="'+(h.max_pages-1)+'">'+(h.max_pages-1)+"</a>",e+="</div>",e+='<a class="upfront-pagination_item upfront-pagination_item-skip upfront-pagination_item-next"></a>',e+="<small>("+_.template(i.entity_list_info,{items:h.max_items,pages:h.max_pages-1})+")</small>",e+="</div>"),this.$el.empty().append(e)},prev_page:function(e){e.preventDefault(),e.stopPropagation(),h.prev_page()&&Upfront.Events.trigger("media_manager:media:list",h)},next_page:function(e){e.preventDefault(),e.stopPropagation(),h.next_page()&&Upfront.Events.trigger("media_manager:media:list",h)},set_page:function(t){t.preventDefault(),t.stopPropagation(),h.set_page(e(t.target).data("idx"))&&Upfront.Events.trigger("media_manager:media:list",h)},set_page_keypress:function(t){t.stopPropagation();var n=String.fromCharCode(t.which),r=parseInt(n,10);if(13!==t.which)return!0;var n=e.trim(e(t.target).val()),r=parseInt(n,10);if(!r)return!1;r>h.max_pages&&(r=h.max_pages),h.set_page(r)&&Upfront.Events.trigger("media_manager:media:list",h)}}),q=Backbone.View.extend({className:"search_container clearfix",events:{"click .search":"do_search","click .clear":"clear_search","keyup :text":"on_keyup"},render:function(){var e=h.get("search"),t=e.length?e.first():!1,n=!!t&&t.get("state");this.$el.empty().append('<input type="text" placeholder="'+i.search+'" value="'+(n&&t?t.get("value"):"")+'" />'),n?(this.$el.append('<a href="#clear" class="clear upfront-icon upfront-icon-popup-search-clear"></a>'),this.$el.addClass("has_search")):this.$el.removeClass("has_search"),this.$el.append('<div class="search upfront-icon upfront-icon-popup-search" id="upfront-search_action"></div>')},do_search:function(e){e.preventDefault(),e.stopPropagation();var t=this.$el.find(":text"),n=t.val(),r=new l({filter:n,value:n,state:!0});n||(r=new l({filter:!1,value:!1,state:!1})),h.to_defaults(),h.current_keys=[],h.current_models=[],h.set("search",new f([r])),Upfront.Events.trigger("media_manager:media:list",h),Upfront.Events.trigger("media:search:requested",r),this.render();var i=new u(h.current_models);Upfront.Events.trigger("media:item:selection_changed",i)},clear_search:function(e){e.preventDefault(),e.stopPropagation();var t=this.$el.find(":text");t.val(""),this.do_search(e)},on_keyup:function(e){e.keyCode==13?this.$el.find(".search").trigger("click"):e.keyCode==27&&this.$el.find(".clear").trigger("click")}}),R=Backbone.View.extend({className:"use_selection_container",events:{"click a":"use_selection"},initialize:function(e){this.options=e,Upfront.Events.on("media:item:selection_changed",this.update_model,this)},render:function(){var e=this.options.button_text||"Ok";this.$el.empty().append('<a href="#use" class="use">'+e+"</a>")},update_model:function(e){for(key in e.models){var n=e.models[key],r=h.current_keys.indexOf(n.attributes.ID);if(r==-1)n.attributes.selected&&(h.current_keys.push(n.attributes.ID),h.current_models.push(n));else if(!n.attributes.selected||n.attributes.selected==t)h.current_keys.splice(r,1),h.current_models.splice(r,1)}},use_selection:function(e){e.preventDefault(),e.stopPropagation();var t=new u(h.current_models);Upfront.Popup.close(t)}}),U=R.extend({use_selection:function(e){e.preventDefault(),e.stopPropagation(),this.model&&this.model.length>1?this.open_dialog():Upfront.Popup.close(this.model)},open_dialog:function(){var t=e('<div id="media-manager-multi-dialog" class="upfront-ui" />');t.append('<h3 class="multi-dialog-title">'+i.insertion_question+"</h3>"),t.append('<ul class="multi-dialog-choices"><li class="multi-dialog-choice upfront-icon upfront-icon-media-insert-multi-plain" data-choice="plain">'+i.plain_images+"</li>"+'<li class="multi-dialog-choice upfront-icon upfront-icon-media-insert-multi-slider" data-choice="slider">'+i.image_slider+"</li>"+'<li class="multi-dialog-choice upfront-icon upfront-icon-media-insert-multi-gallery" data-choice="gallery">'+i.image_gallery+"</li>"+"</ul>"),Upfront.Popup.$popup.find("#upfront-popup-content").append(t),t.on("click",".multi-dialog-choice",this,this.select_dialog)},select_dialog:function(t){t.preventDefault(),t.stopPropagation();var n=e("#media-manager-multi-dialog"),r=e(this).attr("data-choice")||"plain",i=t.data;i.model.type=r,n.remove(),Upfront.Popup.close(i.model)}}),z=Backbone.View.extend({className:"upfront-embed_media clearifx",initialize:function(){this.model=new a},render:function(){this.embed_pane=new W({model:this.model}),this.embed_pane.on("embed:editable:updated",this.embed_updated,this),this.preview_pane=new X({model:this.model}),this.embed_pane.render(),this.preview_pane.render(),this.$el.empty().append(this.embed_pane.$el).append(this.preview_pane.$el)},embed_updated:function(){this.preview_pane.render_progress();var e=this;Upfront.Util.post(_.extend({action:"upfront-media-embed",media:this.model.get("original_url")},_upfront_media_upload.embed_ref)).done(function(t){e.model.set(t.data,{silent:!0}),e.preview_pane.trigger("embed:media:imported"),e.embed_pane.clear_updating_flag(),e.embed_pane.render(),e.preview_pane.render()})}}),W=Backbone.View.extend({className:"upfront-pane",embed_is_being_updated:!1,events:{"click button":"save"},initialize:function(){this.editables=_([new nt({model:this.model}),new rt({model:this.model}),new it({model:this.model})])},render:function(){this.$el.empty();var e=this;this.editables.each(function(t){t.render(),t.on("embed:updated",e.editable_updated,e),e.$el.append(t.$el)}),this.$el.append('<button type="button">'+i.ok+"</button>")},editable_updated:function(){this.embed_is_being_updated=!0,this.trigger("embed:editable:updated")},clear_updating_flag:function(){this.embed_is_being_updated=!1},save:function(){if(!this.model)return!1;var e=this;if(!this.model.get("ID")&&this.embed_is_being_updated)return setTimeout(function(){e.save()},500),!1;var t={action:"upfront-media-update_media_item",data:this.model.toJSON()};Upfront.Util.post(t).done(function(){e.model.trigger("change"),Upfront.Events.trigger("media_manager:media:show_library",t.data)})}}),X=Backbone.View.extend({className:"upfront-pane",initialize:function(){},render:function(){this.preview_view=new V({model:this.model}),this.labels_view=new Y({model:this.model}),this.on("embed:media:imported",this.update_media_preview,this),this.preview_view.render(),this.$el.empty().append(this.preview_view.$el)},render_progress:function(){this.$el.empty().append('<div class="preview_loader" />');var e=this.$el.find(".preview_loader");e.css({position:"relative",minHeight:"250px",width:"100%"}),this.loading=new Upfront.Views.Editor.Loading({loading:i.loading_embeddable_preview,done:"Loaded"}),this.loading.render(),e.append(this.loading.$el)},update_media_preview:function(){this.preview_view.render(),this.labels_view.render(),this.labels_view.delegateEvents()}}),V=Backbone.View.extend({className:"upfront-media_manager-embed-preview",template:_.template('{{thumbnail}} <div class="progress"></div>'),render:function(){if(!this.model.get("original_url"))return this.$el.empty();var e=this,t=this.is_image(),n=t?this.model.get("thumbnail"):this.get_media_thumbnail();this.$el.empty().append(this.template({thumbnail:n}))},is_image:function(){return(this.model.get("original_url")||"").match(/\.(jpe?g|gif|png)$/i)},get_media_thumbnail:function(){return this.model.get("thumbnail")}}),J=j.extend({className:"upfront-media_manager upfront-media_manager-post_image clearfix",_subviews:{media:!1,aux:!1,controls:!1},initialize:function(e,t){var n=n||{};e.models?e=new o(e):e=new o,this.media_collection=e,this.options=t},render:function(){this._subviews.media||(this._subviews.media=new K({model:this.media_collection}));var e=this._subviews.media;this._subviews.aux||(this._subviews.aux=new d({model:this.media_collection}));var t=this._subviews.aux;this._subviews.controls||(this._subviews.controls=new p({model:this.media_collection,options:this.options}));var n=this._subviews.controls;e.multiple_selection=this.multiple_selection,n.render(),t.render(),e.render(),this.$el.empty().append(n.$el).append(t.$el).append(e.$el),this.media_view=e,this.media_view.start_loading()},update:function(e){var t=this;this.media_view.model.reset(e),this.media_view.end_loading(function(){t.media_view.render()})},remove:function(){_.each(this._subviews,function(e,t){if(!e)return!0;e.remove(),this._subviews[t]=!1},this)}}),K=Backbone.View.extend({tagName:"ul",className:"upfront-media_collection",initialize:function(){this.model.on("add",this.render,this),this.model.on("remove",this.render,this),this.model.on("change",this.update,this),this.model.on("change:selected",this.propagate_selection,this)},render:function(){this.subviews=[];var e=this;this.$el.empty();if(!this.model.length)this.$el.append("&nbsp;");else{this.model.each(function(t){var n=new Q({model:t});e.subviews.push(n),n.parent_view=e,n.render(),e.$el.append(n.$el);if(h.current_keys.length){var r=h.current_keys.indexOf(t.attributes.ID);r!=-1&&(t.set({selected:!0},{silent:!0}),t.trigger("appearance:update"))}});var t=new u(h.current_models);Upfront.Events.trigger("media:item:selection_changed",t)}},update:function(){this.model.length&&this.model.each(function(e){e.trigger("appearance:update")})},start_loading:function(){this.loading=new Upfront.Views.Editor.Loading({loading:i.loading_media_files,timeout:500,done:"Loaded"}),this.loading.render(),this.loading.$el.insertAfter(this.$el)},end_loading:function(e){this.loading&&this.loading.done?this.loading.done(e):e()},propagate_selection:function(e){if(!this.multiple_selection){var t=this.model.where({selected:!0}),n=!0===e.get("selected");t.length&&_(t).each(function(e){e.set({selected:!1},{silent:!0}),e.trigger("appearance:update")}),n&&e.set({selected:!0},{silent:!0}),e.trigger("appearance:update")}Upfront.Events.trigger("media:item:selection_changed",this.model);var r=new u(h.current_models);Upfront.Events.trigger("media:item:selection_changed",r)},remove:function(){_.each(this.subviews,function(e){e.remove()})}}),Q=Backbone.View.extend({tagName:"li",className:"upfront-media_item",events:{click:"toggle_item_selection"},initialize:function(){this.template=_.template("<div class='thumbnail'>{{thumbnail}}</div> <div class='title'>{{post_title}}</div> <div class='upfront-media_item-editor-container' />"),Upfront.Events.on("media_manager:media:toggle_titles",this.toggle_title,this),this.model.on("appearance:update",this.update,this),this.model.on("upload:start",this.upload_start,this),this.model.on("upload:progress",this.upload_progress,this),this.model.on("upload:finish",this.upload_finish,this)},render:function(){this.$el.empty().append(this.template(this.model.toJSON())),this.update(),this.toggle_title()},update:function(){this.model.get("parent")?this.$el.addClass("has-parent"):this.$el.removeClass("has-parent"),this.model.get("selected")&&!this.$el.hasClass("selected")?this.$el.addClass("selected"):this.model.get("selected")||this.$el.removeClass("selected"),this.$el.find(".title").text(this.model.get("post_title"))},toggle_title:function(){var e=h.showing_titles,t=this.$el.find(".title");e&&!t.is(":visible")?t.show():t.hide()},toggle_item_selection:function(e){e.stopPropagation(),e.preventDefault(),this.model.set({selected:!this.model.get("selected")})},upload_start:function(e){this.parent_view.$el.scrollTop(0),this.$el.find(".thumbnail").append('<div class="upfront-media-progress-bar" />')},upload_progress:function(e){this.$el.find(".upfront-media-progress-bar").css("width",e+"%")},upload_finish:function(e){this.$el.find(".thumbnail .upfront-image-upload-placeholder").replaceWith(this.model.get("thumbnail")),this.$el.find(".upfront-media-progress-bar").remove(),h.current_keys.push(this.model.attributes.ID),h.current_models.push(this.model),e.render_library()},remove:function(){Upfront.Events.off("media_manager:media:toggle_titles",this.toggle_title)}}),G=Backbone.View.extend({className:"upfront-media_item-editor",events:{"click button":"save"},initialize:function(e){this.editables=_([new rt({model:this.model})]),e&&e.media&&(this.media=e.media)},render:function(){this.$el.empty();var e=this;this.editables.each(function(t){t.render(),e.$el.append(t.$el)});var t=new Y({model:this.model});t.render(),this.$el.append(t.$el),this.$el.append('<button type="button">'+i.ok+"</button>");if(!this.media)return!0;var n=this.media.type||"application/octet-stream",r=n.match(/^image/i);if(r)return!0;var s=new Z({model:this.model,media:this.media});s.render(),this.$el.append(s.$el)},save:function(){this.editables.invoke("update");var e=this,t={action:"upfront-media-update_media_item",data:this.model.toJSON()};Upfront.Util.post(t).done(function(){e.model.trigger("change")})}}),Y=Backbone.View.extend({className:"upfront-media_labels",events:{"click button":"create_label","click a.own_label":"drop_label","click a.all_label":"add_label"},initialize:function(){this.labels=h.get("label"),Upfront.Events.on("media_manager:media:labels_loaded",this.reset_labels,this)},reset_labels:function(){this.labels=h.get("label"),this.render()},render:function(){var e=_.template('<a class="own_label" href="#" data-idx="{{value}}">{{filter}}</a> '),t=_.template('<a class="all_label" href="#" data-idx="{{value}}">{{filter}}</a> '),n=this,r=this.model.get("labels"),s=[],o=[];this.$el.empty(),this.labels&&this.labels.each(function(n){r&&r.length&&r.indexOf(n.get("value"))>=0?s.push(e(n.toJSON())):o.push(t(n.toJSON()))}),n.$el.append(i.applied_labels+"&nbsp;"),_(s).each(function(e){n.$el.append(e)}),this.$el.append('<input type="text" placeholder="label..." /><button type="button">'+i.add+"</button>"),n.$el.append("All labels: "),_(o).each(function(e){n.$el.append(e)})},create_label:function(e){e.preventDefault(),e.stopPropagation();var t=this.$el.find(":text").val(),n={action:"upfront-media-add_label",term:t,post_id:this.model.get("ID")};Upfront.Util.post(n).success(function(e){Upfront.Events.trigger("media_manager:media:labels_updated")})},add_label:function(e){e.preventDefault(),e.stopPropagation(),this._update_labels(e)},drop_label:function(e){e.preventDefault(),e.stopPropagation(),this._update_labels(e,"dis")},_update_labels:function(t,n){n=n||"",t.preventDefault(),t.stopPropagation();var r=this,i=e(t.target),s=i.attr("data-idx"),o={action:"upfront-media-"+n+"associate_label",term:s,post_id:this.model.get("ID")};Upfront.Util.post(o).success(function(e){var t=r.model.get("ID"),n=e.data||{},i=n[t]||n;r.model.set("labels",i,{silent:!0}),r.render()})}}),Z=Backbone.View.extend({className:"upload_type-nag",events:{"click .keep":"keep_file","click .remove":"remove_file"},render:function(){this.$el.empty().append(i.video_recommendation_nag).append('<a href="#" class="button keep">'+i.keep_file+"</a>").append('<a href="#" class="button remove">'+i.remove_file+"</a>")},keep_file:function(e){e.preventDefault(),e.stopPropagation()},remove_file:function(e){e.preventDefault(),e.stopPropagation(),this.model.trigger("upload:abort")}}),et=Backbone.View.extend({className:"upfront-media_item-editable",events:{change:"update"},template:_.template("<label>{{label}}<input type='text' name='{{name}}' value='{{value}}' placeholder='{{placeholder}}' /></label>"),get_name:function(){},get_label:function(){},get_placeholder:function(){},get_value:function(){return this.$el.find('[name="'+this.get_name()+'"]:first').val()},render:function(){var e=this.get_name()||"",t=this.get_label()||"",n=this.get_placeholder()||"",r=this.model.get(this.get_name())||"",i={name:e,label:t,placeholder:n,value:r};this.$el.empty().append(this.template(i))},update:function(){var e={};e[this.get_name()]=this.get_value(),this.model.set(e,{silent:!0})}}),tt=et.extend({update:function(){var e={};e[this.get_name()]=this.get_value(),this.model.set(e,{silent:!0}),this.trigger("embed:updated")}}),nt=tt.extend({get_name:function(){return"original_url"},get_label:function(){return i.media_url},get_placeholder:function(){return"http://sample.com/path-to-image/image.jpg"}}),rt=et.extend({get_name:function(){return"post_title"},get_label:function(){return i.image_title},get_placeholder:function(){return i.your_image_title}}),it=et.extend({get_label:function(){return i.labels},render:function(){var e=new u([this.model]),t=new y({model:e});t.render(),e.on("change",t.render_labels,t),this.$el.empty().append("<label>"+this.get_label()+"</label>").append(t.$el)}}),st=Backbone.View.extend({initialize:function(e){this.options=e},open:function(t){t=_.extend({media_type:["images"],multiple_sizes:!0,multiple_selection:!0,button_text:i.ok,ck_insert:!1,hold_editor:!1},t);var n=this,r=!1,s=t.media_type,o=t.multiple_selection,u=t.button_text;return h.allowed_media_types=s,h.multiple_sizes=t.multiple_sizes,r=Upfront.Popup.open(function(e,r,i){n.out=this,n.popup_data=e,n.popup_data.$top=r,n.popup_data.$bottom=i,n.load(t)},{width:800,hold_editor:t.hold_editor},"media-manager"),r.always(_.bind(this.cleanup_active_filters,this)),r.progress(e.proxy(this.clean_up,this)),Upfront.Events.trigger("upfront:element:edit:start","media-upload"),r},clean_up:function(e){e==="before_close"&&Upfront.Events.trigger("upfront:element:edit:stop","media-upload")},cleanup_active_filters:function(){h.allowed_media_types=[],h.current_keys=[],h.current_models=[],h.media_limit=20,this.cleanup_manager_view()},cleanup_manager_view:function(){this.media_manager&&(this.media_manager.undelegateEvents(),this.media_manager.remove(),this.media_manage_options=t)},load:function(e){return this.cleanup_manager_view(),_.isUndefined(this.media_manage_options)?(this.media_manage_options=_.extend({el:this.out,data:this.popup_data},e),this.media_manager=new j(this.media_manage_options)):_.isEqual(this.media_manage_options,_.extend({el:this.out,data:this.popup_data},e))||(this.media_manage_options=_.extend({el:this.out,data:this.popup_data},e),this.media_manager=new j(this.media_manage_options)),this.media_manager.render(),!1},results_html:function(e){var t="";return e&&e.each&&e.each(function(n){var i=n.toJSON(),s=n.get("selected_size")||r.FULL,o=n.get("additional_sizes");s&&r.FULL!=s&&_(o).each(function(e){if(r.to_size(e)!=s)return!0;i.image=e}),e.type=="gallery"&&(i.link={href:"#","class":"popup"}),i.type=e.type,t+=_.template(i.link?Upfront.Media.Templates.image_link:Upfront.Media.Templates.image,i)}),e&&e.length&&e.length>1&&(e.type=="plain"?t=_.template(Upfront.Media.Templates.multiple,{content:t}):e.type=="gallery"?t=_.template(Upfront.Media.Templates.gallery,{content:t}):e.type=="slider"&&(t=_.template(Upfront.Media.Templates.slider,{content:t}))),t}});Upfront.Media={Manager:new st,Templates:{image:'<p class="upfront-inserted_image-wrapper upfront-inserted_image-{{type}}"><img src="{{image.src}}" title="{{post_title}}" alt="{{post_title}}" height="{{image.height}}" width="{{image.width}}" /></p>',image_link:'<p class="upfront-inserted_image-wrapper upfront-inserted_image-{{type}}"><a href="{{link.href}}" class="{{link.class}}"><img src="{{image.src}}" title="{{post_title}}" alt="{{post_title}}" height="{{image.height}}" width="{{image.width}}" /></a></p>',embeddable:"<div>{{post_content}}<br />{{post_title}}</div>",gallery:"[upfront-gallery]{{content}}[/upfront-gallery]",slider:"[upfront-slider]{{content}}[/upfront-slider]",multiple:"{{content}}"},Transformations:{_transformations:_([]),add:function(e){this._transformations.push(e)},apply:function(e){return this._transformations.each(function(t){e=t.apply(this,[e])}),e}},Ref:(window._upfront_media_upload||{image_ref:""}).image_ref}})}(jQuery),function(e,t){var n=["text!upfront/templates/content.html","upfront/post-editor/upfront-post-content","upfront/post-editor/upfront-post-layout"];define("content",n,function(t,n){var r=function(t){var r=this;this.postId=t.post_id,this.autostart=t.autostart||!1,this.content_mode=t.content_mode,this.changed={},_.extend(this,Backbone.Events),Upfront.data.posts[this.postId]&&(this.post=Upfront.data.posts[this.postId],this.post.meta.length||this.post.meta.fetch(),this.loadingPost=new e.Deferred,this.loadingPost.resolve(this.post)),this.contentEditor=!1,this.getPost().done(function(){r.contentEditor=new n.PostContentEditor({post:r.post,content_mode:r.content_mode}),r.listenTo(r.contentEditor,"cancel",r.cancelChanges),r.listenTo(r.contentEditor,"publish",r.publish),r.listenTo(r.contentEditor,"draft",r.saveDraft),r.listenTo(r.contentEditor,"auto-draft",r.saveAutoDraft),r.listenTo(r.contentEditor,"trash",r.trash),r.listenTo(r.contentEditor,"edit:start",r.editStart),r.listenTo(r.contentEditor,"edit:stop",r.editStop),r.listenTo(r.contentEditor,"change:title",r.changeTitle),r.listenTo(r.contentEditor,"change:content",r.changeContent),r.listenTo(r.contentEditor,"change:author",r.changeAuthor),r.listenTo(r.contentEditor,"change:date",r.changeDate),r.listenTo(r.contentEditor,"bar:date:updated",r.changeDate)})};r.prototype={_partViews:[],addPartView:function(t,n,r,i){var s=new e.Deferred;return this._partViews.push({type:t,el:n,model:r,parentModel:i,deferred:s}),this.setPartViews(),s.promise()},setPartViews:function(){if(!this.contentEditor)return;var e=this._partViews.pop();if(!e)return;var t=this.contentEditor.setView(e.type,e.el,e.model,e.parentModel);e.deferred.resolve(t)},setDefaults:function(){this.mode="content"},getPost:function(){var t=e.Deferred();this.post&&(t.resolve(this.post),this.loadingPost=t.promise());if(this.loadingPost)return this.loadingPost;var n=Upfront.data.posts[this.postId];return n?(this.post=n,t.resolve(n),this.loadingPost=t.promise(),this.loadingPost):this.fetchPost()},fetchPost:function(){var t=this,n=e.Deferred();return this.post=new Upfront.Models.Post({ID:this.postId}),t.loadingPost=n.promise(),this.post.fetch({withMeta:!0,filterContent:!0}).done(function(e){Upfront.data.posts||(Upfront.data.posts={}),Upfront.data.posts[t.postId]=t.post,n.resolve(t.post)}),this.loadingPost},stopEditContents:function(){this.contentEditor.stopEditors(),this.trigger("stop")},cancelChanges:function(){this.stopEditContents(),this.trigger("post:cancel")},publish:function(e){this.save(e,"publish",Upfront.Settings.l10n.global.content.publishing.replace(/%s/,this.post.get("post_type")),Upfront.Settings.l10n.global.content.published.replace(/%s/,this.capitalize(this.post.get("post_type"))))},saveDraft:function(e){this.save(e,"draft",Upfront.Settings.l10n.global.content.saving.replace(/%s/,this.post.get("post_type")),Upfront.Settings.l10n.global.content.drafted.replace(/%s/,this.capitalize(this.post.get("post_type"))))},saveAutoDraft:function(e){this.save(e,"auto-draft")},trash:function(){var t=this,n=this.post.get("post_type"),r=e(Upfront.Settings.LayoutEditor.Selectors.main),i=new Upfront.Views.Editor.Loading({loading:Upfront.Settings.l10n.global.content.deleting.replace(/%s/,n),done:Upfront.Settings.l10n.global.content.here_we_are,fixed:!1});i.render(),r.append(i.$el),this.post.set("post_status","trash").save().done(function(){i.$el.remove(),Upfront.Views.Editor.notify(Upfront.Settings.l10n.global.content.deleted.replace(/%s/,n)),t.stopEditContents(),t.trigger("post:trash"),Upfront.Application.sidebar.toggleSidebar(),Upfront.Application.navigate("/",!0)})},save:function(t,n,r,i){var s=this,o=this.changed,u=!0,a=!u,f=n==="auto-draft",l=this.post.get("post_name"),c=e(Upfront.Settings.LayoutEditor.Selectors.main),h=new Upfront.Views.Editor.Loading({loading:r,done:Upfront.Settings.l10n.global.content.here_we_are,fixed:!0}),p=!1;f?n="draft":(h.render(),c.append(h.$el)),t.title&&this.post.set("post_title",t.title),t.excerpt&&this.post.set("post_excerpt",t.content),t.content&&this.post.set("post_content",t.content),t.author&&this.post.set("post_author",t.author),t.inserts&&this.post.meta.setValue("_inserts_data",t.inserts),t.date&&this.post.set("post_date",t.date),t.visibility&&(this.post.setVisibility(t.visibility),t.pass&&this.post.set("post_password",t.pass)),this.post.set("post_status",n),e("body").hasClass("is_new")&&this.post.set("post_name",""),this.post.save().done(function(e){s.post.is_new&&l.length&&s.post.set("post_name",l).save(),s.post.set("post_name",e.data.post_name),s.post.permalink=e.data.permalink,a&&(f||(h.done(),Upfront.Views.Editor.notify(i),s.stopEditContents(),s.trigger("post:saved"))),p=!0}),u?s.post.meta.save().done(function(){p&&(f||(h.done(),Upfront.Views.Editor.notify(i),s.stopEditContents(),s.trigger("post:saved"))),a=!0}):a=!0,this.post.is_new=!1},capitalize:function(e){return e.charAt(0).toUpperCase()+e.slice(1)},preventLinkNavigation:function(e){e.preventDefault()},editStart:function(){this.trigger("editor:edit:start")},editStop:function(){this.trigger("editor:edit:stop")},changeTitle:function(e){this.trigger("editor:change:title",e)},changeContent:function(e,t){this.trigger("editor:change:content",e,t)},changeAuthor:function(e){this.trigger("editor:change:author",e)},changeDate:function(e){this.trigger("editor:change:date",e)}},_.extend(r.prototype,Backbone.Events.prototype);var i=Backbone.View.extend(_.extend({},r.prototype,{tpl:Upfront.Util.template(t),events:{dblclick:"editContents","click a":"preventLinkNavigation"},initialize:function(t){var n=this;this.postId=t.post_id,this.setElement(t.node),this.autostart=t.autostart||!1,this.content_mode=t.content_mode,this.changed={},Upfront.data.posts[this.postId]&&(this.post=Upfront.data.posts[this.postId],this.post.meta.length||this.post.meta.fetch(),this.loadingPost=new e.Deferred,this.loadingPost.resolve(this.post)),this.postView=t.view,this.getPost(),this.getPostLayout()},getPostLayout:function(){if(this.loadingLayout)return this.loadingLayout;var t=this,n=e.Deferred(),r;return t.postView.postLayout&&t.postView.parts[t.postId]?(r={postLayout:t.postView.postLayout,partOptions:t.postView.partOptions||{}},t.layoutData=!0,t.parts=t.postView.parts[t.postId],n.resolve(r),this.loadingLayout=n.promise(),this.loadingLayout):(this.loadingLayout=this.fetchPostLayout(),this.loadingLayout)},fetchPostLayout:function(){var t=e.Deferred(),n=this,r=n.postView.property("type")=="ThisPostModel"?"single":"archive",i=r=="single"?this.postId:n.postView.property("element_id").replace("uposts-object-",""),s={hide_featured_image:n.postView.property("hide_featured_image"),full_featured_image:n.postView.property("full_featured_image")};return this.getPost().done(function(){Upfront.Util.post({action:"upfront_get_postlayout",type:r,id:i,layout_cascade:Upfront.Application.current_subapplication.get_layout_data().layout,post_id:n.postId,post_type:n.post.get("post_type"),properties:s}).done(function(e){var r=e.data;r.partOptions||(r.partOptions={}),_.extend(n.postView,r),n.postView.parts||(n.postView.parts={}),n.postView.parts[n.postId]=r.partContents,n.parts=r.partContents,n.layoutData=!0,t.resolve(r)}).fail(function(e){console.log("error!!")})}),t.promise()},render:function(){var e=this,t=n.getMarkupper();if(!this.layoutData)return this.$el.html(Upfront.Settings.l10n.global.content.loading),this.loadingLayout.done(function(){e.render()});var r=this.postView.postLayout||{},i=this.postView.partOptions||{},s={wrappers:r,wrappersLength:r.length,extraClasses:{},attributes:{}};_.each(r,function(n){n.objectsLength=n.objects.length,_.each(n.objects,function(n){var r=i&&i[n.slug]&&i[n.slug].attributes?i[n.slug].attributes:{},o="";_.each(r,function(e,t){o+=t+'="'+e+'" '}),s.attributes[n.slug]=o,s.extraClasses[n.slug]=i&&i[n.slug]&&i[n.slug].extraClasses?i[n.slug].extraClasses:"",n.slug in e.parts.classes&&e.parts.classes[n.slug]&&e.parts.classes[n.slug].length&&(s.extraClasses[n.slug]=e.parts.classes[n.slug].join(" ")),n.markup=t.markup(n.slug,e.parts.replacements,e.getTemplate(n.slug))})}),this.$el.html(this.tpl(s)),this.setContentPadding(),this.trigger("rendered")},getTemplate:function(e){var t=this.postView.partTemplates;return e=="contents"&&this.content_mode=="post_excerpt"&&(e="excerpt"),t&&t[e]?t[e]:Upfront.data.thisPost.templates[e]},editContents:function(t,r){var i=this,s=function(){arguments.callee.iter=arguments.callee.iter||0,arguments.callee.iter++,arguments.callee.iter<30&&setTimeout(function(){i.editContents(t,r)},100)};if(this.contentEditor||Upfront.Application.is_builder())return;if(!this.layoutData||!this.post){s();return}if(this.$el.find(".upfront-content-marker").length<1){this.render(),s();return}var o=t?e(t.currentTarget):r;this.contentEditor=new n.PostContentEditorLegacy({post:this.post,postView:this.postView,content_mode:this.content_mode,el:this.el,triggeredBy:o,authorTpl:this.getTemplate("author"),partOptions:this.postView.partOptions,rawContent:this.parts.replacements["%raw_content%"],rawExcerpt:this.parts.replacements["%raw_excerpt%"]}),this.$el.closest(".upfront-wrapper").addClass("upfront-postcontent-editor"),Upfront.Events.trigger("post:content:edit:start",this.contentEditor),this.listenTo(this.contentEditor,"cancel",this.cancelChanges),this.listenTo(this.contentEditor,"publish",this.publish),this.listenTo(this.contentEditor,"draft",this.saveDraft),this.listenTo(this.contentEditor,"auto-draft",this.saveAutoDraft),this.listenTo(this.contentEditor,"trash",this.trash),this.contentEditor.focus(this.contentEditor.parts.titles,!0)},stopEditContents:function(){this.stopListening(this.contentEditor),this.contentEditor.stop(),this.contentEditor=!1,this.$el.closest(".upfront-wrapper").removeClass("upfront-postcontent-editor"),Upfront.Events.trigger("post:content:edit:stop",this.contentEditor)},cancelChanges:function(){this.stopEditContents(),this.render()},trash:function(){var e=this,t=this.post.get("post_type"),n=new Upfront.Views.Editor.Loading({loading:Upfront.Settings.l10n.global.content.deleting.replace(/%s/,t),done:Upfront.Settings.l10n.global.content.here_we_are,fixed:!1});n.render(),this.$el.append(n.$el),this.post.set("post_status","trash").save().done(function(){n.$el.remove(),Upfront.Views.Editor.notify(Upfront.Settings.l10n.global.content.deleted.replace(/%s/,t)),e.stopEditContents(),e.postView.property("type")=="UpostsModel"&&e.postView.refreshMarkup(),Upfront.Application.sidebar.toggleSidebar(),Upfront.Application.navigate("/",!0)})},save:function(e,t,n,i){var s=this,o=function(){s.fetchPostLayout().then(function(){s.render()})};this.once("post:saved",o),e.content&&this.postView.property("content_type")=="excerpt"&&(e.excerpt=e.content,e.content=!1),r.prototype.save.call(this,e,t,n,i)},setContentPadding:function(){var t=Upfront.Behaviors.GridEditor.col_size,n=this.postView.partOptions,r=n.contents?n.contents.padding_right*t:0,i=n.contents?n.contents.padding_left*t:0,s=this.postView.$(".upfront-post-padding"),o="#"+this.postView.property("element_id")+" .upfront-content-marker-contents>* {";s.length||(s=e('<style class="upfront-post-padding"></style>'),this.postView.$el.append(s)),o+="padding-left: "+i+"px; padding-right: "+r+"px;}",s.html(o)}}));Upfront.Content||(Upfront.Content={}),Upfront.Content.PostEditor=r,Upfront.Content.PostEditorLegacy=i})}(jQuery),function(e){define("scripts/upfront/bg-settings/mixins",[],function(){return{bind_toggles:function(){this.on("show",function(){this.$el.show()}),this.on("hide",function(){this.$el.hide()})},save_fields:function(){},preview_color:function(e){var t=e.toRgb(),n="rgba("+t.r+","+t.g+","+t.b+","+e.alpha+")";n=e.get_is_theme_color()!==!1?e.theme_color:n,this.model.set_breakpoint_property("background_color",n)},update_color:function(e){this.preview_color(e),this._default_color=this.model.get_breakpoint_property_value("background_color",!0)},reset_color:function(){this.model.set_breakpoint_property("background_color",this._default_color)},upload_image:function(){var t=this;Upfront.Views.Editor.ImageSelector.open().done(function(n){var r={},i;_.each(n,function(e,t){r=e,i=t}),e("<img>").attr("src",r.full[0]).load(function(){Upfront.Views.Editor.ImageSelector.close(),t.model.set_breakpoint_property("background_image",r.full[0]),t.model.set_breakpoint_property("background_image_ratio",Math.round(r.full[2]/r.full[1]*100)/100)})})}}})}(jQuery),function(e){var t=Upfront.Settings&&Upfront.Settings.l10n?Upfront.Settings.l10n.global.views:Upfront.mainData.l10n.global.views;define("scripts/upfront/bg-settings/color-item",["scripts/upfront/bg-settings/mixins"],function(e){var n=Upfront.Views.Editor.Settings.Item.extend(_.extend({},e,{group:!1,initialize:function(e){var n=this;e.fields=[new Upfront.Views.Editor.Field.Color({model:this.model,label:t.bg_color_short,property:"background_color",use_breakpoint_property:!0,default_value:"#ffffff",spectrum:{move:function(e){n.preview_color(e)},change:function(e){n.update_color(e)},hide:function(e){n.reset_color()}},rendered:function(){this.$el.addClass("uf-bgsettings-color-pick")}})],this.$el.addClass("uf-bgsettings-item uf-bgsettings-coloritem"),this.bind_toggles(),this.constructor.__super__.initialize.call(this,e)}}));return n})}(jQuery),function(e){var t=Upfront.Settings&&Upfront.Settings.l10n?Upfront.Settings.l10n.global.views:Upfront.mainData.l10n.global.views;define("scripts/upfront/bg-settings/image-item",["scripts/upfront/bg-settings/mixins"],function(e){var n=Upfront.Views.Editor.Settings.Item.extend(_.extend({},e,{group:!1,initialize:function(e){var n=this,r={default_value:50,min:0,max:100,step:1},i=["bg_tile"],s=["bg_color","bg_position_x","bg_position_y","bg_position_x_num","bg_position_y_num"],o={pick_image:new Upfront.Views.Editor.Field.Button({label:t.pick_image,compact:!0,classname:"uf-button-alt uf-bgsettings-image-pick",on_click:function(){n.upload_image()}}),bg_style:new Upfront.Views.Editor.Field.Select({model:this.model,label:t.image_type,className:"upfront-field-wrap upfront-field-wrap-select background-image-field",property:"background_style",use_breakpoint_property:!0,default_value:"full",icon_class:"upfront-region-field-icon",values:this.get_bg_style_values(),change:function(){var e=this.get_value();e=="tile"?(_.each(i,function(e){o[e].$el.show()}),_.each(s,function(e){o[e].$el.hide()})):e=="fixed"?(_.each(i,function(e){o[e].$el.hide()}),_.each(s,function(e){o[e].$el.show()})):(_.each(i,function(e){o[e].$el.hide()}),_.each(s,function(e){o[e].$el.hide()})),n._bg_style=e,n.update_image()},rendered:function(){this.$el.addClass("uf-bgsettings-image-style")}}),bg_default:new Upfront.Views.Editor.Field.Select({model:this.model,label:t.featured_default,className:"upfront-field-wrap upfront-field-wrap-select background-image-field",property:"background_default",use_breakpoint_property:!0,default_value:"color",icon_class:"upfront-region-field-icon",values:[{label:t.color,value:"color"},{label:t.image,value:"image"}],change:function(){var e=this.get_value(),t=n.model.get_breakpoint_property_value("background_image",!0);e=="image"?(o.pick_image.$el.show(),o.bg_color.$el.hide(),this.$el.addClass("uf-bgsettings-image-default-image"),t||n.upload_image()):(o.pick_image.$el.hide(),o.bg_color.$el.show(),this.$el.addClass("uf-bgsettings-image-default-color")),this.model.set_breakpoint_property(this.property_name,e),n.update_image()},rendered:function(){var e=this.get_saved_value();this.$el.addClass("uf-bgsettings-image-default"),e=="image"?this.$el.addClass("uf-bgsettings-image-default-image"):this.$el.addClass("uf-bgsettings-image-default-color")}}),bg_tile:new Upfront.Views.Editor.Field.Checkboxes({model:this.model,layout:"horizontal-inline",default_value:["y","x"],values:[{label:t.tile_vertically,value:"y"},{label:t.tile_horizontally,value:"x"}],change:function(){var e=this.get_value();n._bg_tile=e,n.update_image()},rendered:function(){this.$el.addClass("uf-bgsettings-image-tile")}}),bg_color:new Upfront.Views.Editor.Field.Color({model:this.model,label:t.bg_color_short,property:"background_color",use_breakpoint_property:!0,default_value:"#ffffff",spectrum:{move:function(e){n.preview_color(e)},change:function(e){n.update_color(e)},hide:function(e){n.reset_color()}},rendered:function(){this.$el.addClass("uf-bgsettings-image-color")}}),bg_position_y:new Upfront.Views.Editor.Field.Slider(_.extend({model:this.model,label:t.image_position,orientation:"vertical",property:"background_position_y",use_breakpoint_property:!0,range:!1,change:function(){var e=this.get_value();o.bg_position_y_num.get_field().val(e),n._bg_position_y=e,this.model.set_breakpoint_property(this.property_name,e),n.update_image()},rendered:function(){this.$el.addClass("uf-bgsettings-image-pos-y")}},r)),bg_position_x:new Upfront.Views.Editor.Field.Slider(_.extend({model:this.model,property:"background_position_x",use_breakpoint_property:!0,range:!1,change:function(){var e=this.get_value();o.bg_position_x_num.get_field().val(e),n._bg_position_x=e,this.model.set_breakpoint_property(this.property_name,e),n.update_image()},rendered:function(){this.$el.addClass("uf-bgsettings-image-pos-x")}},r)),bg_position_y_num:new Upfront.Views.Editor.Field.Number(_.extend({model:this.model,label:"Y:",label_style:"inline",suffix:"%",change:function(){var e=this.get_value(),t=o.bg_position_y;t.$el.find("#"+t.get_field_id()).slider("value",e),t.get_field().val(e),t.trigger("changed")},rendered:function(){this.$el.addClass("uf-bgsettings-image-pos-y-num")}},r)),bg_position_x_num:new Upfront.Views.Editor.Field.Number(_.extend({model:this.model,label:"X:",label_style:"inline",suffix:"%",change:function(){var e=this.get_value(),t=o.bg_position_x;t.$el.find("#"+t.get_field_id()).slider("value",e),t.get_field().val(e),t.trigger("changed")},rendered:function(){this.$el.addClass("uf-bgsettings-image-pos-x-num")}},r))};this.$el.addClass("uf-bgsettings-item uf-bgsettings-imageitem"),e.fields=_.map(o,function(e){return e}),this.on("show",function(){var e=n.model.get_breakpoint_property_value("background_type",!0),t=n.model.get_breakpoint_property_value("background_image",!0),r=n.model.get_breakpoint_property_value("background_default",!0);n._bg_style=o.bg_style.get_value(),n._bg_tile=o.bg_tile.get_value(),n._bg_position_y=o.bg_position_y.get_value(),o.bg_position_y.trigger("changed"),n._bg_position_x=o.bg_position_x.get_value(),o.bg_position_x.trigger("changed"),o.bg_style.trigger("changed"),e=="featured"?(o.bg_default.$el.show(),o.bg_default.trigger("changed")):(o.bg_default.$el.hide(),t||n.upload_image())}),this.bind_toggles(),this.constructor.__super__.initialize.call(this,e)},update_image:function(){var e=this._bg_style,t=this._bg_tile,n=_.contains(t,"y"),r=_.contains(t,"x"),i=this._bg_position_y,s=this._bg_position_x;e=="full"?this.model.set_breakpoint_property("background_style","full"):e=="tile"?(this.model.set_breakpoint_property("background_style","tile"),r&&n?this.model.set_breakpoint_property("background_repeat","repeat"):n?this.model.set_breakpoint_property("background_repeat","repeat-y"):r?this.model.set_breakpoint_property("background_repeat","repeat-x"):this.model.set_breakpoint_property("background_repeat","no-repeat")):e=="fixed"?(this.model.set_breakpoint_property("background_style","fixed"),this.model.set_breakpoint_property("background_repeat","no-repeat"),this.model.set_breakpoint_property("background_position",s+"% "+i+"%")):this.model.set_breakpoint_property("background_style",e)},get_bg_style_values:function(){var e=[{label:t.full_width_bg,value:"full",icon:"bg-image-full"},{label:t.tiled_pattern,value:"tile",icon:"bg-image-tile"},{label:t.fixed_position,value:"fixed",icon:"bg-image-fixed"}];return this.model instanceof Upfront.Models.Region&&e.push({label:t.parallax,value:"parallax",icon:"bg-image-full"}),e}}));return n})}(jQuery),define("text!scripts/upfront/templates/map-editor.html",[],function(){return'\n<div class="upfront_map-editor-complex-wrapper">\n	<div class="upfront-css-top">\n		<div class="upfront_map-custom_map_code" data-for="script">{{ l10n.custom_map_code }}</div>\n		<i class="upfront-icon-info">{{ l10n.paste_below }}</i>\n		<div class="upfront_map-jsalert error javascript"><i class="upfront-icon-button" title="{{ l10n.code_error }}"></i></div>\n		<a class="upfront-css-close" href="#">{{ l10n.close }}</a>\n	</div>\n	<div class="upfront-css-body">\n		<div class="upfront_map-editor-section upfront_map-script active">\n			<div class="upfront_map-ace" data-type="script" >{{script}}</div>\n		</div>\n		<button>{{ l10n.save }}</button>\n	</div>\n</div>\n'}),function($){var l10n=Upfront.Settings&&Upfront.Settings.l10n?Upfront.Settings.l10n.global.views:Upfront.mainData.l10n.global.views;define("scripts/upfront/inline-panels/map-editor",["text!scripts/upfront/templates/map-editor.html"],function(editorTpl){var MapEditorView=Upfront.Views.ObjectView.extend({is_editing:!1,script_error:!1,SYNTAX_TYPES:{script:"json"},MIN_HEIGHT:200,editorTpl:_.template(editorTpl),content_editable_selector:".editable",initialize:function(){var e=this.fallback("script");this.checkJSon(e)},on_render:function(){this.start_json_editor()},start_json_editor:function(){if(this.is_editing)return!1;this.is_editing=!0;var e=$("#upfront_map-editor"),t=this;e.length||(e=$('<section id="upfront_map-editor" class="upfront-ui upfront_map-editor upfront_map-editor-complex"></section>'),$("body").append(e)),require([Upfront.Settings.ace_url],function(){t.createEditor(e)})},on_edit:function(){if(this.is_editing)return!1;var e=this.$el.find(".upfront_map-element "+this.content_editable_selector);if(e.length)return this.bootContentEditors(e);this.is_editing=!0;var t=$("#upfront_map-editor");t.length||(t=$('<section id="upfront_map-editor" class="upfront-ui upfront_map-editor upfront_map-editor-complex"></section>'),$("body").append(t)),this.createEditor(t)},bootContentEditors:function(e){if(!e||!e.length)return!1;var t=$(this.fallback("markup")),n=this;e.each(function(e){var r=$(this),i=e<=0;if(r.data("ueditor"))return!0;r.ueditor({autostart:i,placeholder:"",disableLineBreak:!0}).on("start",function(){n.is_editing=!0}).on("stop",function(){n.is_editing=!1}).on("syncAfter",function(){var i=$(t.find(n.content_editable_selector)[e]);if(!i.length)return!1;i.html(r.html()),n.property("markup",$("<div />").append(t).html())})})},startResizable:function(e){var t=this,n=e.find(".upfront-css-body"),r=0,i=e.find(".upfront_map-editor-complex-wrapper"),s=function(s,o){var u=o?o.size.height:e.find(".upfront_map-editor-complex-wrapper").height(),a=u-r;n.height(a),_.each(t.editors,function(e){e.resize()}),i.css({width:"",height:"",left:"",top:""})};i.find(".upfront-css-top").removeClass("ui-resizable-handle").addClass("ui-resizable-handle").removeClass("ui-resizable-n").addClass("ui-resizable-n"),r=e.find(".upfront-css-top").outerHeight(),s(),i.resizable({handles:{n:".upfront-css-top"},resize:s,minHeight:200,delay:100})},createEditor:function(e){var t=this;e.html(this.editorTpl({markup:this.fallback("markup"),style:this.fallback("style"),script:this.fallback("script"),l10n:l10n.template})),$("#page").css("padding-bottom","200px"),e.show(),this.resizeHandler=this.resizeHandler||function(){e.width($(window).width()-$("#sidebar-ui").width()-1)},$(window).on("resize",this.resizeHandler),this.resizeHandler(),this.editors={},this.timers={},e.find(".upfront_map-ace").each(function(){var n=$(this),r=n.html(),i=ace.edit(this),s=n.data("type");i.getSession().setUseWorker(!1),i.setTheme("ace/theme/monokai"),i.getSession().setMode("ace/mode/"+t.SYNTAX_TYPES[s]),i.setShowPrintMargin(!1),"markup"===s&&r&&i.getSession().setValue(r),i.on("change",function(){t.timers[s]&&clearTimeout(t.timers[s]),t.timers[s]=setTimeout(function(){var n=i.getValue();s=="script"&&t.checkJSon(n),t.script_error?e.find(".upfront_map-jsalert").show().find("i").attr("title",l10n.create.js_error+" "+t.script_error):e.find(".upfront_map-jsalert").hide(),t.property(s,n,!1)},1e3)}),i.renderer.scrollBar.width=5,i.renderer.scroller.style.right="5px",t.editors[s]=i}),this.currentEditor=this.editors.markup;var n=e.find(".upfront-css-top"),r=e.find(".upfront-css-body");r.height(this.MIN_HEIGHT-n.outerHeight()),this.startResizable(e),e.find("button").on("click",function(e){_.each(t.editors,function(e,n){t.property(n,e.getValue())}),t.property("map_styles",t.fallback("script"),!1),t.is_editing=!1,t.destroyEditor()}),e.on("click",".upfront-css-type",function(e){t.hiliteElement(e)}).on("click",".upfront-css-close",function(e){e.preventDefault(),t.destroyEditor(),$("#page").css("padding-bottom",0)})},destroyEditor:function(){var e=this;this.editors&&this.editors.length&&(_.each(this.editors,function(e){e.destroy()}),e.editors=!1),this.currentEditor=!1,$("#upfront_map-editor").html("").hide(),$(window).off("resize",this.resizeHandler),this.is_editing=!1},hiliteElement:function(e){e.preventDefault();var t=this.$el.find(".upfront-object-content"),n=t.offset().top-50;$(document).scrollTop(n>0?n:0),this.blink(t,4)},blink:function(e,t){var n=this;e.css("outline","3px solid #3ea"),setTimeout(function(){e.css("outline","none"),t--,t>0&&setTimeout(function(){n.blink(e,t-1)},100)},100)},checkJSon:function(json){this.script_error=!1;try{eval(json)}catch(e){this.script_error=e.message}},fallback:function(e){return this.model.get_property_value_by_name(e)||Upfront.data.upfront_code.defaults.fallbacks[e]},property:function(e,t,n){return typeof t!="undefined"?(typeof n=="undefined"&&(n=!0),this.model.set_property(e,t,n)):this.model.get_property_value_by_name(e)}});return MapEditorView})}(jQuery),function(e){var t=Upfront.Settings&&Upfront.Settings.l10n?Upfront.Settings.l10n.global.views:Upfront.mainData.l10n.global.views;define("scripts/upfront/bg-settings/map-item",["scripts/upfront/bg-settings/mixins","scripts/upfront/inline-panels/map-editor"],function(n,r){var i=Upfront.Views.Editor.Settings.Item.extend(_.extend({},n,{events:{"click .open-map-code-panel-button":"init_code_panel"},group:!1,initialize:function(n){var r=this,i=this.model.get_property_value_by_name("background_map_center"),s=function(){var e=this.get_value();this.model.set_breakpoint_property(this.property_name,e)};i||(this.model.init_property("background_map_center",[-37.818,144.976]),this.model.init_property("background_map_zoom",10),this.model.init_property("background_map_style","ROADMAP"),this.model.init_property("background_map_controls",""),this.model.init_property("background_show_markers",""),this.model.init_property("background_use_custom_map_code",""));var o={location:new Upfront.Views.Editor.Field.Text({model:this.model,label:t.location+":",property:"background_map_location",use_breakpoint_property:!0,placeholder:"e.g 123 Nice St",change:function(){var e=this.get_value();this.model.set_breakpoint_property(this.property_name,e,!0),r._location=e,r._location_changed=!0},rendered:function(){this.$el.addClass("uf-bgsettings-map-location")}}),refresh:new Upfront.Views.Editor.Field.Button({label:"",compact:!0,classname:"upfront-field-icon upfront-field-icon-refresh-2 upfront-refresh-map",on_click:function(){var e=r.$el.find('input[name="background_map_location"]');e.length&&(r._location=e.val()),r._location_changed=!0,r.geocode_location()}}),zoom:new Upfront.Views.Editor.Field.Slider({model:this.model,label:t.zoom+":",property:"background_map_zoom",use_breakpoint_property:!0,default_value:8,min:1,max:19,step:1,change:s,rendered:function(){this.$el.addClass("uf-bgsettings-map-zoom")}}),style:new Upfront.Views.Editor.Field.Select({model:this.model,label:t.map_style+":",property:"background_map_style",use_breakpoint_property:!0,values:[{label:t.roadmap,value:"ROADMAP"},{label:t.satellite,value:"SATELLITE"},{label:t.hybrid,value:"HYBRID"},{label:t.terrain,value:"TERRAIN"}],change:s,rendered:function(){this.$el.addClass("uf-bgsettings-map-style")}}),controls:new Upfront.Views.Editor.Field.Select({model:this.model,label:t.controls+":",placeholder:t.choose_ctrl,property:"background_map_controls",use_breakpoint_property:!0,multiple:!0,default_value:["pan"],values:[{label:t.pan,value:"pan"},{label:t.zoom,value:"zoom"},{label:t.map_type,value:"map_type"},{label:t.scale,value:"scale"},{label:t.street_view,value:"street_view"},{label:t.overview_map,value:"overview_map"}],change:s,rendered:function(){this.$el.addClass("uf-bgsettings-map-controls")}}),show_markers:new Upfront.Views.Editor.Field.Checkboxes({model:this.model,label:t.show_markers,property:"background_show_markers",use_breakpoint_property:!0,hide_label:!0,values:[{label:t.show_markers,value:1}],multiple:!1,change:s,rendered:function(){this.$el.addClass("uf-bgsettings-map-show-marker")}}),custom_map_code:new Upfront.Views.Editor.Field.Checkboxes({model:this.model,label:t.custom_map_code,property:"background_use_custom_map_code",hide_label:!0,values:[{label:t.custom_map_code+'<span class="checkbox-info" title="'+t.custom_map_code_info+'"></span>',value:1}],multiple:!1,change:function(){var t=this.get_value();this.property.set({value:t}),t==1?e(".open-map-code-panel-button",this.$el.parent()).show():e(".open-map-code-panel-button",this.$el.parent()).hide()},rendered:function(){this.$el.addClass("uf-bgsettings-map-custom-map-code")}}),open_map_code_panel:new Upfront.Views.Editor.Field.Button({model:r.model,label:t.open_map_code_panel,className:"open-map-code-panel-button",compact:!0})};this.$el.addClass("uf-bgsettings-item uf-bgsettings-mapitem"),n.fields=_.map(o,function(e){return e}),this._location=o.location.get_value(),this.$el.on("keypress",'input[name="background_map_location"]',function(t){t.keyCode===13&&(r._location=e(this).val(),r._location_changed=!0,r.geocode_location())}),this.bind_toggles(),this.constructor.__super__.initialize.call(this,n)},render:function(){Upfront.Views.Editor.Settings.Item.prototype.render.call(this),e('[name="background_use_custom_map_code"]',this.$el).trigger("change")},geocode_location:function(){if(this._geocoding==1||!this._location_changed)return;var e=this,t=this._location,n=new google.maps.Geocoder;if(!t)return;this._geocoding=!0,n.geocode({address:t},function(t,n){if(n!=google.maps.GeocoderStatus.OK)return e._geocoding=!1,e._location_changed=!1,!1;var r=t[0].geometry.location;e.model.set_breakpoint_property("background_map_center",[r.lat(),r.lng()]),e._geocoding=!1,e._location_changed=!1})},init_code_panel:function(){var e=new r({model:this.model});e.render()}}));return i})}(jQuery),function(e){var t=Upfront.Settings&&Upfront.Settings.l10n?Upfront.Settings.l10n.global.views:Upfront.mainData.l10n.global.views;define("scripts/upfront/bg-settings/slider-item",["scripts/upfront/bg-settings/mixins"],function(n){var r=Upfront.Views.Editor.Settings.Item.extend(_.extend({},n,{group:!1,initialize:function(e){var n=this,r=function(){var e=this.get_value();this.model.set_breakpoint_property(this.property_name,e)},s={transition:new Upfront.Views.Editor.Field.Select({model:this.model,label:t.slider_transition,property:"background_slider_transition",use_breakpoint_property:!0,default_value:"crossfade",icon_class:"upfront-region-field-icon",values:[{label:t.slide_down,value:"slide-down",icon:"bg-slider-slide-down"},{label:t.slide_up,value:"slide-up",icon:"bg-slider-slide-up"},{label:t.slide_left,value:"slide-left",icon:"bg-slider-slide-left"},{label:t.slide_right,value:"slide-right",icon:"bg-slider-slide-right"},{label:t.crossfade,value:"crossfade",icon:"bg-slider-crossfade"}],change:r,rendered:function(){this.$el.addClass("uf-bgsettings-slider-transition")}}),rotate:new Upfront.Views.Editor.Field.Checkboxes({model:this.model,property:"background_slider_rotate",use_breakpoint_property:!0,default_value:!0,layout:"horizontal-inline",multiple:!1,values:[{label:t.autorotate_each+" ",value:!0}],change:function(){var e=this.get_value();this.property.set({value:e?!0:!1})},rendered:function(){this.$el.addClass("uf-bgsettings-slider-rotate")}}),rotate_time:new Upfront.Views.Editor.Field.Number({model:this.model,property:"background_slider_rotate_time",use_breakpoint_property:!0,default_value:5,min:1,max:60,step:1,suffix:"sec",change:r,rendered:function(){this.$el.addClass("uf-bgsettings-slider-time")}}),control:new Upfront.Views.Editor.Field.Radios({model:this.model,property:"background_slider_control",use_breakpoint_property:!0,default_value:"always",layout:"horizontal-inline",values:[{label:t.always_show_ctrl,value:"always"},{label:t.show_ctrl_hover,value:"hover"}],change:r,rendered:function(){this.$el.addClass("uf-bgsettings-slider-control")}})};this.$el.addClass("uf-bgsettings-item uf-bgsettings-slideritem"),e.fields=_.map(s,function(e){return e}),this.slides_item=new i({model:this.model,title:t.slides_order+":"}),_.isUndefined(e.slides_item_el)?this.on("panel:set",function(){n.panel.settings.push(n.slides_item),n.slides_item.panel=n.panel,n.slides_item.trigger("panel:set")}):(this.slides_item.render(),e.slides_item_el.append(this.slides_item.$el)),this.on("show",function(){var e=this.model.get_breakpoint_property_value("background_slider_images",!0);e||n.upload_slider_images(),n.slides_item.trigger("show")}),this.on("hide",function(){n.slides_item.trigger("hide")}),this.bind_toggles(),this.constructor.__super__.initialize.call(this,e)},upload_slider_images:function(){var e=this;Upfront.Views.Editor.ImageSelector.open({multiple:!0}).done(function(t){var n=[];_.each(t,function(e,t){t=parseInt(t,10),t&&n.push(t)}),e.model.set_breakpoint_property("background_slider_images",n),e.slides_item.update_slider_slides(),Upfront.Views.Editor.ImageSelector.close()})}})),i=Upfront.Views.Editor.Settings.Item.extend(_.extend({},n,{initialize:function(t){var n=this;this.$el.on("click",".upfront-region-bg-slider-add-image",function(e){e.preventDefault(),e.stopPropagation(),Upfront.Views.Editor.ImageSelector.open({multiple:!0}).done(function(e){var t=_.clone(n.model.get_breakpoint_property_value("background_slider_images",!0)||[]);_.each(e,function(e,n){n=parseInt(n,10),n&&t.push(n)}),n.model.set_breakpoint_property("background_slider_images",t),Upfront.Views.Editor.ImageSelector.close(),n.update_slider_slides()})}),this.$el.on("click",".upfront-region-bg-slider-delete-image",function(t){t.preventDefault(),t.stopPropagation();var r=e(this).closest(".upfront-region-bg-slider-image"),i=r.data("image-id"),s=r.index(),o=_.clone(n.model.get_breakpoint_property_value("background_slider_images",!0)||[]);_.isString(i)&&i.match(/^[0-9]+$/)&&(i=parseInt(i,10)),s!=-1&&o.length>0&&o.splice(s,1),n.model.set_breakpoint_property("background_slider_images",o),r.remove()}),this.on("show",function(){n.update_slider_slides()}),this.$el.addClass("uf-bgsettings-item uf-bgsettings-slider-slidesitem"),this.bind_toggles(),this.constructor.__super__.initialize.call(this,t)},update_slider_slides:function(){var n=this,r=n.model.get_breakpoint_property_value("background_slider_images",!0),i=e('<div class="upfront-region-bg-slider-add-image upfront-icon upfront-icon-region-add-slide">'+t.add_slide+"</div>"),s=this.$el.find(".upfront-settings-item-content");s.html(""),r.length>0?Upfront.Views.Editor.ImageEditor.getImageData(r).done(function(t){var o=t.data.images;_.each(r,function(t){var n=_.isNumber(t)||t.match(/^\d+$/)?o[t]:_.find(o,function(e){return e.full[0].split(/[\\/]/).pop()==t.split(/[\\/]/).pop()}),r=e('<div class="upfront-region-bg-slider-image" />');r.data("image-id",t),typeof n.thumbnail!="undefined"&&r.css({background:'url("'+n.thumbnail[0]+'") no-repeat 50% 50%',backgroundSize:"100% auto"}),r.append('<span href="#" class="upfront-region-bg-slider-delete-image">&times;</span>'),s.append(r)}),s.hasClass("ui-sortable")?s.sortable("refresh"):s.sortable({items:">  .upfront-region-bg-slider-image",update:function(){var t=[];s.find(".upfront-region-bg-slider-image").each(function(){var n=e(this).data("image-id");n=parseInt(n,10),n&&t.push(n)}),n.model.set_breakpoint_property("background_slider_images",t)}}),s.append(i)}):s.append(i)}}));return r})}(jQuery),function(e){var t=Upfront.Settings&&Upfront.Settings.l10n?Upfront.Settings.l10n.global.views:Upfront.mainData.l10n.global.views;define("scripts/upfront/bg-settings/video-item",["scripts/upfront/bg-settings/mixins"],function(e){var n=Upfront.Views.Editor.Settings.Item.extend(_.extend({},e,{group:!1,initialize:function(e){var n=this,r={mute:new Upfront.Views.Editor.Field.Checkboxes({model:this.model,property:"background_video_mute",use_breakpoint_property:!0,default_value:1,layout:"horizontal-inline",multiple:!1,values:[{label:t.mute_on_play,value:1}],change:function(){var e=this.get_value();this.model.set_breakpoint_property(this.property_name,e?1:0)},rendered:function(){this.$el.addClass("uf-bgsettings-video-mute")}}),autoplay:new Upfront.Views.Editor.Field.Checkboxes({model:this.model,property:"background_video_autoplay",use_breakpoint_property:!0,default_value:1,layout:"horizontal-inline",multiple:!1,values:[{label:t.autoplay,value:1}],change:function(){var e=this.get_value();this.model.set_breakpoint_property(this.property_name,e?1:0)},rendered:function(){this.$el.addClass("uf-bgsettings-video-autoplay")}}),style:new Upfront.Views.Editor.Field.Radios({model:this.model,property:"background_video_style",use_breakpoint_property:!0,layout:"horizontal-inline",default_value:["crop"],values:[{label:t.scale_and_crop,value:"crop"},{label:t.no_crop_embed,value:"full"},{label:t.no_crop_bg,value:"inside"}],change:function(){var e=this.get_value();e=="inside"?r.color.$el.show():r.color.$el.hide(),this.model.set_breakpoint_property(this.property_name,e)},rendered:function(){this.$el.addClass("uf-bgsettings-video-style")}}),color:new Upfront.Views.Editor.Field.Color({model:this.model,label:t.area_bg_color+":",label_style:"inline",property:"background_color",use_breakpoint_property:!0,default_value:"#ffffff",spectrum:{move:function(e){n.preview_color(e)},change:function(e){n.update_color(e)},hide:function(e){n.reset_color()}},rendered:function(){this.$el.addClass("uf-bgsettings-video-color")}}),video:new Upfront.Views.Editor.Field.Text({model:this.model,label:t.video_url,property:"background_video",use_breakpoint_property:!0,default_value:"",placeholder:t.video_source,change:function(){var e=this.get_value();e&&(n.model.set_breakpoint_property("background_video_embed",""),n.get_video_embed(e).done(function(e){if(!e.data||!e.data.width||!e.data.height)return;n.model.set_breakpoint_property("background_video_width",e.data.width),n.model.set_breakpoint_property("background_video_height",e.data.height),n.model.set_breakpoint_property("background_video_embed",e.data.html)})),this.model.set_breakpoint_property(this.property_name,e)},rendered:function(){this.$el.addClass("uf-bgsettings-video-url")}})};this.$el.addClass("uf-bgsettings-item uf-bgsettings-videoitem"),e.fields=_.map(r,function(e){return e}),this.on("show",function(){r.style.trigger("changed")}),this.bind_toggles(),this.constructor.__super__.initialize.call(this,e)},get_video_embed:function(e){return Upfront.Util.post({action:"upfront-media-get_embed_raw",media:e})}}));return n})}(jQuery),function(e){var t=Upfront.Settings&&Upfront.Settings.l10n?Upfront.Settings.l10n.global.views:Upfront.mainData.l10n.global.views;define("bg-settings",["scripts/upfront/bg-settings/color-item","scripts/upfront/bg-settings/image-item","scripts/upfront/bg-settings/map-item","scripts/upfront/bg-settings/slider-item","scripts/upfront/bg-settings/video-item"],function(e,n,r,i,s){var o=Upfront.Views.Editor.Settings.Item.extend({initialize:function(e){var n=this,r=this.model.get_breakpoint_property_value("background_image",!0),i=[{label:t.solid_color,value:"color",icon:"color"},{label:t.image,value:"image",icon:"image"},{label:t.video,value:"video",icon:"video"},{label:t.image_slider,value:"slider",icon:"slider"},{label:t.map,value:"map",icon:"map"}];_upfront_post_data.post_id&&i.push({label:t.featured_image,value:"featured",icon:"feat"}),_.isArray(e.enable_types)&&(i=_.filter(i,function(t){return _.contains(e.enable_types,t.value)})),e.fields=[new Upfront.Views.Editor.Field.Checkboxes({model:this.model,property:"use_padding",use_breakpoint_property:!0,default_value:0,layout:"horizontal-inline",multiple:!1,values:[{label:t.use_theme_padding,value:1}],change:function(){var e=this.get_value();this.model.set_breakpoint_property(this.property_name,e?1:0)}}),new Upfront.Views.Editor.Field.Select({model:this.model,className:"upfront-field-wrap upfront-field-wrap-select background-type-field",label:t.group_bg,property:"background_type",use_breakpoint_property:!0,default_value:r?"image":"color",icon_class:"upfront-region-field-icon",values:i,change:function(){var e=this.get_value();n.panel.parent_view.toggle_setting(e),this.model.set_breakpoint_property(this.property_name,e)}})],this.$el.addClass("uf-bgsettings-item"),this.constructor.__super__.initialize.call(this,e)}}),u=Upfront.Views.Editor.Settings.Settings.extend({initialize:function(t){this.options=t,this.has_tabs=!1;var u=this,a={color:e,image:n,featured:n,slider:i,video:s,map:r};_.isUndefined(t.enable_types)||(this.enable_types=t.enable_types),this.settings={},_.each(a,function(e,t){if(!_.contains(u.enable_types,t))return;u.settings[t]=new e({model:u.model}),u.settings[t].once("rendered",function(){this.trigger("hide")})});var f={model:this.model,enable_types:this.enable_types};this.bg_title?f.title=this.bg_title:f.group=!1;var l=new o(f);this.panels=_([new Upfront.Views.Editor.Settings.Panel({model:this.model,settings:_.union([l],_.map(this.settings,function(e){return e}))})]),this.once("open",function(){var e=u.model.get_breakpoint_property_value("background_type",!0),t=u.model.get_breakpoint_property_value("background_image",!0);e?u.toggle_setting(e):u.toggle_setting(t?"image":"color")})},toggle_setting:function(e){_.each(this.settings,function(t,n){n==e?t.trigger("show"):t.trigger("hide")})}});Upfront.Views.Editor.BgSettings={Settings:u,BgItem:o,ColorItem:e,ImageItem:n,MapItem:r,SliderItem:i,VideoItem:s}})}(jQuery),define("elements/upfront-accordion/js/model",[],function(){var e=Upfront.Models.ObjectModel.extend({init:function(){var e=_.clone(Upfront.data.uaccordion.defaults),t=Upfront.data.uaccordion.defaults;e.accordion=[],e.accordion[0]={},e.accordion[0].content=_.clone(t.accordion[0].content),e.accordion[0].title=_.clone(t.accordion[0].title),e.accordion[1]={},e.accordion[1].content=_.clone(t.accordion[1].content),e.accordion[1].title=_.clone(t.accordion[1].title),e.element_id=Upfront.Util.get_unique_id("uaccordion-object"),this.init_properties(e)}});return e}),define("elements/upfront-accordion/js/element",["elements/upfront-accordion/js/model"],function(e){var t=Upfront.Settings.l10n.accordion_element,n=Upfront.Views.Editor.Sidebar.Element.extend({priority:140,render:function(){this.$el.addClass("upfront-icon-element upfront-icon-element-accordion"),this.$el.html(t.element_name)},add_element:function(){var t=new e,n=new Upfront.Models.Module({name:"",properties:[{name:"element_id",value:Upfront.Util.get_unique_id("module")},{name:"class",value:"c9 upfront-accordion_module"},{name:"has_settings",value:0},{name:"row",value:Upfront.Util.height_to_row(225)}],objects:[t]});this.add_module(n)}});return n}),define("scripts/upfront/element-settings/settings-container",[],function(){var e=Backbone.View.extend({save_settings:function(){if(!this.settings)return;var e=this;this.settings.each(function(t){if(!t.handlesSaving&&(t.fields||t.settings).size()>0)t.save_fields();else if(!t.handlesSaving){var n=e.model.get_property_value_by_name(t.get_name());n!=t.get_value()&&e.model.set_property(t.get_name(),t.get_value())}}),this.on_save&&this.on_save(),this.onSaveSettings&&this.onSaveSettings()},cleanUp:function(){this.settings&&this.settings.each(function(e){e.remove()}),this.$el.off(),this.remove()}});return e}),function(e){define("scripts/upfront/element-settings/root-panel-mixin",[],function(){var t={className:"uf-settings-panel upfront-settings_panel",events:{"click .uf-settings-panel__title":"toggleBody"},getTitle:function(){var e=this.options.title?this.options.title:this.title;return e=e?e:"Default Panel Title",e},getBody:function(){var t=e("<div />");return t.append("<p>Implement getBody() in child class</p>"),t},toggleBody:function(){this.$el.find(".uf-settings-panel__body").toggle(),this.$el.toggleClass("uf-settings-panel--expanded")},hideBody:function(){this.$el.find(".uf-settings-panel__body").hide(),this.$el.removeClass("uf-settings-panel--expanded")},showBody:function(){this.$el.find(".uf-settings-panel__body").show(),this.$el.addClass("uf-settings-panel--expanded")},render:function(){var e;this.$el.html('<div class="uf-settings-panel__title">'+this.getTitle()+"</div>"),e=this.getBody(),e.addClass("uf-settings-panel__body"),this.$el.append(e),this.$el.addClass("uf-settings-panel--expanded")}};return t})}(jQuery),define("text!elements/upfront-slider/tpl/backend.html",[],function(){return'<div>\n<script type="text/template" id="slides-setting-tpl">\n<div class="uslider-slides-setting">\n{[ slides.each(function(slide){ ]}\n<div class="uslider_content_imgslide uslider_content_slide" rel="{{slide.id}}">\n		<img src="{{slide.get(\'src\')}}" />\n		<span class="remove-slide"></span>\n	</div>\n{[ }) ]}\n<div class="uslider-add upfront-region-bg-slider-add-image upfront-icon upfront-icon-region-add-slide">{{l10n.add_slide}}</div>\n</div>\n</script>\n\n\n<script type="text/template" id="startingTpl">\n	<div class="upfront-image-starting-select upfront-ui upfront-initial-overlay-wrapper" style="min-height:{{startingHeight}}px">\n		<div class="uslider-starting-centered upfront-initial-overlay-wrapper" style="height: 100px">\n			<div class="uslider-starting-title">{{l10n.choose_type}}</div>\n			<div class="uslider-starting-info">{{l10n.can_change}}</div>\n			<a href="#" class="button upfront-image-select">{{l10n.choose_img}}</a>\n		</div>\n	</div>\n</script>\n\n\n</div>\n'}),function(e){define("scripts/upfront/settings/fields/slides",["text!elements/upfront-slider/tpl/backend.html"],function(t){var n=Upfront.Settings.l10n.slider_element,r=Upfront.Views.Editor.Field.Field.extend({template:_.template(e(t).find("#slides-setting-tpl").html()),events:{"click .uslider-add":"addSlides","click .remove-slide":"onRemoveSlide"},initialize:function(){this.listenTo(this.model.slideCollection,"add remove sort reset",this.render)},onRemoveSlide:function(t){this.model.view.removeSlide(e(t.currentTarget).parent())},render:function(){var t=this;this.$el.html(this.template({slides:this.model.slideCollection,l10n:n})),this.$(".uslider-slides-setting").sortable({items:".uslider_content_imgslide",start:function(e,t){t.item.addClass("uslider-is-dragged")},stop:function(e,n){var r=n.item.attr("rel"),i=t.getSlidePosition(r),s=!1;i!=-1&&(s=t.model.slideCollection.get(r),t.model.slideCollection.remove(r,{silent:!0}),t.model.slideCollection.add(s,{at:i}))}}),setTimeout(function(){var t=e("#settings");t.height(t.find(".upfront-settings_panel:visible").outerHeight())},100)},addSlides:function(){this.model.trigger("addRequest")},getSlidePosition:function(t){var n=0,r=!1;return this.$("div.uslider_content_slide").each(function(s){e(this).attr("rel")==t&&(r=n),n++}),r!==!1?r:-1},get_name:function(){return"slides"},get_value:function(){return this.model.slideCollection.toJSON()}});return r})}(jQuery),define("scripts/upfront/settings/field-factory",["scripts/upfront/settings/fields/slides"],function(e){var t=function(){var t={SlidesField:e};this.createField=function(e,n){var r=Upfront.Views.Editor.Field[e];_.isUndefined(r)&&(r=t[e]),e==="Settings_CSS"&&(r=Upfront.Views.Editor.Settings.Settings_CSS);if(_.isUndefined(r))throw"There is no '"+e+"' field class defined.";return _.isFunction(n.values)&&(n.values=n.values()),new r(n)}};return fieldFactory=new t,fieldFactory}),function(e){define("scripts/upfront/settings/modules/base-module",[],function(){var e=Backbone.View.extend({initialize:function(e){var t=this;t.options=e,this.fields=e.fields?_(e.fields):_([]),this.on("panel:set",function(){t.fields.each(function(e){e.panel=t.panel,e.trigger("panel:set")})})},render:function(){this.$el.html(""),this.options.title&&this.options.toggle!==!0&&this.$el.append('<div class="upfront-settings-item-title">'+this.options.title+"</div>"),this.$el.append('<div class="upfront-settings-item-content"></div>');var e=this.$el.find(".upfront-settings-item-content");this.fields.each(function(t){t.render(),t.delegateEvents(),e.append(t.el)}),this.trigger("rendered")},save_fields:function(){var e=_([]);this.fields.each(function(t,n,r){if(t.property){var i=t.get_value(),s=t.get_saved_value();!t.multiple&&i!=s?e.push(t):t.multiple&&(i.length!=s.length||_.difference(i,s).length!==0)&&e.push(t)}}),e.each(function(e,t,n){e.use_breakpoint_property?e.model.set_breakpoint_property(e.property_name,e.get_value(),!0):e.property.set({value:e.get_value()},{silent:!0})}),e.size()>0&&(this.panel.is_changed=!0)},remove:function(){this.fields&&this.fields.each(function(e){e.remove()}),Backbone.View.prototype.remove.call(this)}});return e})}(jQuery),define("scripts/upfront/settings/modules/typography",["scripts/upfront/settings/modules/base-module"],function(e){var t=Upfront.Settings.l10n.preset_manager,n=e.extend({className:"settings_module typography_settings_item",group:!0,get_title:function(){return this.options.title},initialize:function(e){this.options=e||{},this.fieldCounter=0,this.currentElement="";var n=this,r=this.options.state,i="no-toggle";typeof n.options.elements!="undefined"&&this.fieldCounter++,typeof this.options.default_element!="undefined"&&(this.currentElement=this.options.default_element+"-"),typeof this.model.get(r+"-element-type")!="undefined"&&typeof this.options.elements!="undefined"&&(this.currentElement=this.model.get(r+"-element-type")+"-"),this.options.toggle===!0&&(this.fieldCounter++,i="element-toggled"),this.fields=_([new Upfront.Views.Editor.Field.Typeface_Chosen_Select({name:this.currentElement+this.options.fields.typeface,model:this.model,values:Upfront.Views.Editor.Fonts.theme_fonts_collection.get_fonts_for_select(),default_value:this.model.get(this.currentElement+this.options.fields.typeface),label:t.typeface,select_width:"225px",label_style:"inline",className:r+"-font-face static typeFace "+i,change:function(e){n.model.set(n.currentElement+n.options.fields.typeface,e),n.fields._wrapped[1+n.fieldCounter].stopListening(),n.fields._wrapped[1+n.fieldCounter]=new Upfront.Views.Editor.Field.Typeface_Style_Chosen_Select({model:this.model,name:n.currentElement+n.options.fields.fontstyle,values:Upfront.Views.Editor.Fonts.theme_fonts_collection.get_variants_for_select(n.model.get(n.currentElement+n.options.fields.typeface)),label:t.weight_style,font_family:n.model.get(n.options.fields.typeface),select_width:"225px",label_style:"inline",className:r+"-font-style static weightStyle "+i,change:function(e){var t=Upfront.Views.Font_Model.parse_variant(e),r={};r[n.currentElement+n.options.fields.fontstyle]=e,r[n.currentElement+n.options.fields.weight]=t.weight,r[n.currentElement+n.options.fields.style]=t.style,n.model.set(r)},show:function(e){e!==null&&n.fields._wrapped[1+n.fieldCounter].set_option_font(e)}}),n.$el.empty(),n.render()}}),new Upfront.Views.Editor.Field.Typeface_Style_Chosen_Select({model:this.model,name:this.currentElement+this.options.fields.fontstyle,values:Upfront.Views.Editor.Fonts.theme_fonts_collection.get_variants_for_select(n.model.get(this.currentElement+n.options.fields.typeface)),default_value:this.model.get(this.currentElement+this.options.fields.fontstyle),label:t.weight_style,font_family:n.model.get(this.options.fields.typeface),select_width:"225px",label_style:"inline",className:r+"-font-style static weightStyle "+i,change:function(e){var t=Upfront.Views.Font_Model.parse_variant(e);n.model.set(n.currentElement+n.options.fields.fontstyle,e),n.model.set(n.currentElement+n.options.fields.weight,t.weight),n.model.set(n.currentElement+n.options.fields.style,t.style)},show:function(e){e!==null&&n.fields._wrapped[1+n.fieldCounter].set_option_font(e)}}),new Upfront.Views.Editor.Field.Number({model:this.model,className:r+"-font-size fontSize "+i,name:this.currentElement+this.options.fields.size,default_value:this.model.get(this.currentElement+this.options.fields.size),label:t.size,label_style:"inline",suffix:t.px,change:function(e){n.model.set(n.currentElement+n.options.fields.size,e)}}),new Upfront.Views.Editor.Field.Number({model:this.model,className:r+"-font-lineheight lineHeight "+i,name:this.currentElement+this.options.fields.line_height,label:t.line_height,label_style:"inline",default_value:this.model.get(this.currentElement+this.options.fields.line_height),min:0,step:.1,change:function(e){n.model.set(n.currentElement+n.options.fields.line_height,e)}}),new Upfront.Views.Editor.Field.Color({model:this.model,className:r+"-font-color upfront-field-wrap upfront-field-wrap-color sp-cf fontColor "+i,name:this.currentElement+this.options.fields.color,default_value:this.model.get(this.currentElement+this.options.fields.color),blank_alpha:0,label_style:"inline",label:t.color,spectrum:{preferredFormat:"rgb",change:function(e){if(!e)return!1;var t=e.get_is_theme_color()!==!1?e.theme_color:e.toRgbString();n.model.set(n.currentElement+n.options.fields.color,t)},move:function(e){if(!e)return!1;var t=e.get_is_theme_color()!==!1?e.theme_color:e.toRgbString();n.model.set(n.currentElement+n.options.fields.color,t)}}})]),typeof n.options.elements!="undefined"&&this.fields.unshift(new Upfront.Views.Editor.Field.Select({model:this.model,label:t.type_element,label_style:"inline",name:r+"-element-type",className:r+"-select-element selectElement "+i,values:n.options.elements,change:function(e){n.model.set(r+"-element-type",e),n.$el.empty(),n.render()},show:function(e){n.currentElement=e+"-";var t=n.get_field_values(e);n.update_fields(t)}})),this.options.toggle===!0&&(this.group=!1,this.fields.unshift(new Upfront.Views.Editor.Field.Checkboxes({model:this.model,className:"useTypography checkbox-title "+i,name:n.options.fields.use,label:"",multiple:!1,values:[{label:t.typography,value:"yes",checked:this.model.get(n.options.fields.use)}],change:function(e){console.log("triggered change on checkbox"),n.model.set(n.options.fields.use,e),n.reset_fields(e)},show:function(e,t){var n=t.closest(".state_modules");e=="yes"?(n.find("."+r+"-select-element").show(),n.find("."+r+"-font-face").show(),n.find("."+r+"-font-style").show(),n.find("."+r+"-font-size").show(),n.find("."+r+"-font-lineheight").show(),n.find("."+r+"-font-color").show()):(n.find("."+r+"-select-element").hide(),n.find("."+r+"-font-face").hide(),n.find("."+r+"-font-style").hide(),n.find("."+r+"-font-size").hide(),n.find("."+r+"-font-lineheight").hide(),n.find("."+r+"-font-color").hide())}})))},reset_fields:function(e){var t,n=this;typeof e!="undefined"&&e==="yes"&&(typeof this.options.elements!="undefined"?_.each(this.options.elements,function(e){var r=e.value+"-";t=n.get_static_field_values(n.options.prepend,r),n.update_fields(t),n.save_static_values(t,r)}):(t=this.get_static_field_values(this.options.prepend,""),n.update_fields(t),this.save_static_values(t,"")),this.$el.empty(),this.render())},save_static_values:function(e,t){var n=Upfront.Views.Font_Model.parse_variant(e.fontstyle);this.model.set(t+this.options.fields.typeface,e.typeface),this.model.set(t+this.options.fields.fontstyle,e.fontstyle),this.model.set(t+this.options.fields.weight,n.weight),this.model.set(t+this.options.fields.style,n.style),this.model.set(t+this.options.fields.size,e.fontsize),this.model.set(t+this.options.fields.line_height,e.line_height),this.model.set(t+this.options.fields.color,e.color)},get_static_field_values:function(e,t){var n={},r="";return typeof this.options.prefix!="undefined"&&(r=this.options.prefix+"-"),n.typeface=this.model.get(this.clear_prepend(t+r+this.options.fields.typeface,e))||"",n.fontstyle=this.model.get(this.clear_prepend(t+r+this.options.fields.fontstyle,e))||"",n.fontsize=this.model.get(this.clear_prepend(t+r+this.options.fields.size,e))||"",n.line_height=this.model.get(this.clear_prepend(t+r+this.options.fields.line_height,e))||"",n.color=this.model.get(this.clear_prepend(t+r+this.options.fields.color,e))||"",n},clear_prepend:function(e,t){return e.replace(t,"")},get_field_values:function(e){var t={};if(typeof this.options.global_typography!="undefined"&&this.options.global_typography===!0){var n=Upfront.mainData.global_typography[this.normalize_elements_selector(e)];n=n||{},t.typeface=this.model.get(this.currentElement+this.options.fields.typeface)||n.font_face||"",t.fontstyle=this.model.get(this.currentElement+this.options.fields.fontstyle)||n.weight+" "+n.style||"",t.fontsize=this.model.get(this.currentElement+this.options.fields.size)||n.size||"",t.line_height=this.model.get(this.currentElement+this.options.fields.line_height)||n.line_height||"",t.color=this.model.get(this.currentElement+this.options.fields.color)||n.color||""}else t.typeface=this.model.get(this.currentElement+this.options.fields.typeface)||"",t.fontstyle=this.model.get(this.currentElement+this.options.fields.fontstyle)||"",t.fontsize=this.model.get(this.currentElement+this.options.fields.size)||"",t.line_height=this.model.get(this.currentElement+this.options.fields.line_height)||"",t.color=this.model.get(this.currentElement+this.options.fields.color)||"";return t},update_fields:function(e){this.fields._wrapped[this.fieldCounter].set_value(e.typeface),this.fields._wrapped[this.fieldCounter].set_option_font(e.typeface),this.fields._wrapped[this.fieldCounter+1].options.values=Upfront.Views.Editor.Fonts.theme_fonts_collection.get_variants_for_select(e.typeface),this.fields._wrapped[this.fieldCounter+1].set_value(e.fontstyle),this.fields._wrapped[this.fieldCounter+1].set_option_font(e.fontstyle),this.fields._wrapped[this.fieldCounter+2].set_value(e.fontsize),this.fields._wrapped[this.fieldCounter+3].set_value(e.line_height),this.fields._wrapped[this.fieldCounter+4].set_value(e.color),this.fields._wrapped[this.fieldCounter+4].update_input_border_color(e.color)},normalize_elements_selector:function(e){return e==="a-hover"?"a:hover":e==="blockquote-alternative"?"blockquote.upfront-quote-alternative":e}});return n}),define("scripts/upfront/settings/modules/border",["scripts/upfront/settings/modules/base-module"],function(e){var t=Upfront.Settings.l10n.preset_manager,n=e.extend({className:"settings_module border_settings_item clearfix",group:!1,initialize:function(e){this.options=e||{},this.fieldCounter=0,this.currentElement="";var n=this,r=this.options.state,i="";typeof this.options.elements!="undefined"&&this.fieldCounter++,typeof this.options.default_element!="undefined"&&(this.currentElement=this.options.default_element+"-",i="border-with-fields"),this.fields=_([new Upfront.Views.Editor.Field.Checkboxes({model:this.model,className:"useBorder checkbox-title",name:n.options.fields.use,label:"",default_value:1,multiple:!1,values:[{label:n.options.label||t.border,value:"yes"}],change:function(e){n.model.set(n.options.fields.use,e),n.reset_fields(e)},show:function(e,t){var n=t.closest(".state_modules");e=="yes"?(n.find("."+r+"-border-width").show(),n.find("."+r+"-border-type").show(),n.find("."+r+"-border-color").show(),n.find("."+r+"-border-select-element").css("opacity","1")):(n.find("."+r+"-border-width").hide(),n.find("."+r+"-border-type").hide(),n.find("."+r+"-border-color").hide(),n.find("."+r+"-border-select-element").css("opacity","0.5"))}}),new Upfront.Views.Editor.Field.Number({model:this.model,className:r+"-border-width borderWidth "+i,name:this.currentElement+n.options.fields.width,label:"",default_value:1,suffix:t.px,values:[{label:"",value:"1"}],change:function(e){n.model.set(n.currentElement+n.options.fields.width,e),typeof n.options.elements!="undefined"&&_.each(n.options.elements,function(t){n.model.set(t.value+"-"+n.options.fields.width,e)}),this.trigger("change")}}),new Upfront.Views.Editor.Field.Select({model:this.model,className:r+"-border-type borderType "+i,name:this.currentElement+n.options.fields.type,default_value:"solid",values:[{label:t.solid,value:"solid"},{label:t.dashed,value:"dashed"},{label:t.dotted,value:"dotted"}],change:function(e){n.model.set(n.currentElement+n.options.fields.type,e),typeof n.options.elements!="undefined"&&_.each(n.options.elements,function(t){n.model.set(t.value+"-"+n.options.fields.type,e)})}}),new Upfront.Views.Editor.Field.Color({model:this.model,className:r+"-border-color upfront-field-wrap upfront-field-wrap-color sp-cf borderColor "+i,name:this.currentElement+n.options.fields.color,blank_alpha:0,label_style:"inline",label:t.color,default_value:"#000",spectrum:{preferredFormat:"rgb",change:function(e){if(!e)return!1;var t=e.get_is_theme_color()!==!1?e.theme_color:e.toRgbString();n.model.set(n.currentElement+n.options.fields.color,t),typeof n.options.elements!="undefined"&&_.each(n.options.elements,function(e){n.model.set(e.value+"-"+n.options.fields.color,t)})},move:function(e){if(!e)return!1;var t=e.get_is_theme_color()!==!1?e.theme_color:e.toRgbString();n.model.set(n.currentElement+n.options.fields.color,t),typeof n.options.elements!="undefined"&&_.each(n.options.elements,function(e){n.model.set(e.value+"-"+n.options.fields.color,t)})}}})]),typeof n.options.elements!="undefined"&&this.fields.unshift(new Upfront.Views.Editor.Field.Select({className:r+"-border-select-element border_selectElement",name:"tagsToApply",default_value:n.model.get("tagsToApply")||"field-button",values:n.options.elements,change:function(){var e=this.get_value();n.model.set({tagsToApply:e}),n.currentElement=e+"-"}}))},reset_fields:function(e){var t,n=this;typeof e!="undefined"&&e==="yes"&&(typeof this.options.elements!="undefined"?_.each(this.options.elements,function(e){var r=e.value+"-";t=n.get_static_field_values(n.options.prepend,r),n.update_fields(t),n.save_static_values(t,r)}):(t=this.get_static_field_values(this.options.prepend,""),this.update_fields(t),this.save_static_values(t,"")),this.$el.empty(),this.render())},save_static_values:function(e,t){this.model.set(t+this.options.fields.width,e.width),this.model.set(t+this.options.fields.type,e.type),this.model.set(t+this.options.fields.color,e.color)},get_static_field_values:function(e,t){var n={},r="";return typeof this.options.prefix!="undefined"&&(r=this.options.prefix+"-"),n.width=this.model.get(this.clear_prepend(t+r+this.options.fields.width,e))||"",n.type=this.model.get(this.clear_prepend(t+r+this.options.fields.type,e))||"",n.color=this.model.get(this.clear_prepend(t+r+this.options.fields.color,e))||"",n},clear_prepend:function(e,t){return e.replace(t,"")},update_fields:function(e){this.fields._wrapped[this.fieldCounter+1].set_value(e.width),this.fields._wrapped[this.fieldCounter+2].set_value(e.type),this.fields._wrapped[this.fieldCounter+3].set_value(e.color),this.fields._wrapped[this.fieldCounter+3].update_input_border_color(e.color)}});return n}),define("scripts/upfront/settings/modules/hov-animation",["scripts/upfront/settings/modules/base-module"],function(e){var t=Upfront.Settings.l10n.preset_manager,n=e.extend({className:"settings_module hov_animation_settings_item clearfix",group:!1,initialize:function(e){this.options=e||{};var n=this,r=this.options.state,i="no-toggle";n.options.toggle===!0&&(i="element-toggled"),this.fields=_([new Upfront.Views.Editor.Field.Number({model:this.model,className:r+"-duration duration "+i,name:n.options.fields.duration,min:0,label:t.animate_hover_changes,step:.1,values:[{label:"",value:"12"}],change:function(e){n.model.set(n.options.fields.duration,e)}}),new Upfront.Views.Editor.Field.Select({model:this.model,name:n.options.fields.easing,label:t.sec,step:.1,label_style:"inline",values:[{label:"ease",value:"ease"},{label:"linear",value:"linear"},{label:"ease-in",value:"ease-in"},{label:"ease-out",value:"ease-out"},{label:"ease-in-out",value:"ease-in-out"}],className:r+"-transition transition "+i,change:function(e){n.model.set(n.options.fields.easing,e)}})]),this.options.toggle===!0&&(this.group=!1,this.fields.unshift(new Upfront.Views.Editor.Field.Checkboxes({model:this.model,className:"useAnimation checkbox-title",name:n.options.fields.use,label:"",default_value:1,multiple:!1,values:[{label:t.animate_hover_changes,value:"yes"}],change:function(e){n.model.set(n.options.fields.use,e)},show:function(e,t){var n=t.closest(".state_modules");e=="yes"?(n.find("."+r+"-transition").show(),n.find("."+r+"-duration").show()):(n.find("."+r+"-transition").hide(),n.find("."+r+"-duration").hide())}})))}});return n}),define("scripts/upfront/settings/modules/radius",["scripts/upfront/settings/modules/base-module"],function(e){var t=Upfront.Settings.l10n.preset_manager,n=e.extend({className:"settings_module corner_radius_settings_item clearfix",group:!1,get_title:function(){return this.options.title},initialize:function(e){this.options=e||{},this.options.max_value&&this.options.max_value<200&&(this.options.max_value=200),this.options.max_value||(this.options.max_value=200);var n=this,r=this.options.state,i=function(){var e=this.get_value(),t={};t[n.options.fields.radius1]=e,t[n.options.fields.radius2]=e,t[n.options.fields.radius3]=e,t[n.options.fields.radius4]=e,t[n.options.fields.radius]=e,n.model.set(t,{silent:!0}),n.model.set(n.options.fields.radius_number,e),n.$el.find("input[name="+n.options.fields.radius1+"]").val(e),n.$el.find("input[name="+n.options.fields.radius2+"]").val(e),n.$el.find("input[name="+n.options.fields.radius3+"]").val(e),n.$el.find("input[name="+n.options.fields.radius4+"]").val(e),n.$el.find("input[name="+n.options.fields.radius_number+"]").val(e),n.$el.closest(".state_modules").find("."+r+"-radius-slider").css("opacity",1)},o=_.throttle(i,16),u=function(e){s=n.fields._wrapped[2],s.$el.find("#"+s.get_field_id()).slider("value",e),s.get_field().val(e),i.apply(s),e>n.options.max_value?n.$el.closest(".state_modules").find("."+r+"-radius-slider").css("opacity",.6):n.$el.closest(".state_modules").find("."+r+"-radius-slider").css("opacity",1)},a=_.throttle(u,16);this.fields=_([new Upfront.Views.Editor.Field.Checkboxes({model:this.model,className:"useRadius checkbox-title",name:n.options.fields.use,label:"",default_value:1,multiple:!1,values:[{label:t.rounded_corners,value:"yes"}],change:function(e){n.model.set(n.options.fields.use,e),n.reset_fields(e)},show:function(e,t){var i=t.closest(".state_modules"),s=n.model.get(n.options.fields.lock);e=="yes"?s=="yes"?(i.find("."+r+"-radius-slider").show(),i.find("."+r+"-radius-slider-number").show()):(i.find("."+r+"-radius-slider").hide(),i.find("."+r+"-radius-slider-number").hide(),i.find("."+r+"-radius1").show(),i.find("."+r+"-radius2").show(),i.find("."+r+"-radius3").show(),i.find("."+r+"-radius4").show()):(i.find("."+r+"-radius1").hide(),i.find("."+r+"-radius2").hide(),i.find("."+r+"-radius3").hide(),i.find("."+r+"-radius4").hide(),i.find("."+r+"-radius-slider").hide(),i.find("."+r+"-radius-slider-number").hide())}}),new Upfront.Views.Editor.Field.Checkboxes({model:this.model,className:r+"-radius-lock border_radius_lock",name:n.options.fields.lock,label:"",default_value:0,multiple:!1,values:[{label:"",value:"yes"}],show:function(e){n.model.set(n.options.fields.lock,e);var t=n.$el.closest(".state_modules"),i=n.model.get(n.options.fields.use);e=="yes"&&i=="yes"?(t.find("."+r+"-radius-slider").show(),t.find("."+r+"-radius-slider-number").show(),t.find("."+r+"-radius1").hide(),t.find("."+r+"-radius2").hide(),t.find("."+r+"-radius3").hide(),t.find("."+r+"-radius4").hide()):i=="yes"&&(t.find("."+r+"-radius-slider").hide(),t.find("."+r+"-radius-slider-number").hide(),t.find("."+r+"-radius1").show(),t.find("."+r+"-radius2").show(),t.find("."+r+"-radius3").show(),t.find("."+r+"-radius4").show())}}),new Upfront.Views.Editor.Field.Slider({className:r+"-radius-slider upfront-field-wrap upfront-field-wrap-slider radius-slider",model:this.model,name:n.options.fields.radius,suffix:t.px,min:0,max:n.options.max_value,step:10,change:o,show:function(){var e=n.model.get(n.options.fields.radius_number);e>n.options.max_value?n.$el.closest(".state_modules").find("."+r+"-radius-slider").css("opacity",.6):n.$el.closest(".state_modules").find("."+r+"-radius-slider").css("opacity",1)}}),new Upfront.Views.Editor.Field.Number({model:this.model,className:r+"-radius-slider-number border_radius_number",name:n.options.fields.radius_number,label:"",min:0,max:1e3,default_value:0,values:[{label:"",value:"0"}],change:a}),new Upfront.Views.Editor.Field.Number({model:this.model,className:r+"-radius1 border_radius border_radius1",name:n.options.fields.radius1,label:"",min:0,max:1e3,default_value:0,values:[{label:"",value:"0"}],change:function(e){n.model.set(n.options.fields.radius1,e)}}),new Upfront.Views.Editor.Field.Number({model:this.model,className:r+"-radius2 border_radius border_radius2 border_radius2_static",name:n.options.fields.radius2,label:"",min:0,max:1e3,default_value:0,values:[{label:"",value:"0"}],change:function(e){n.model.set(n.options.fields.radius2,e)}}),new Upfront.Views.Editor.Field.Number({model:this.model,className:r+"-radius4 border_radius border_radius4",name:n.options.fields.radius4,label:"",min:0,max:1e3,default_value:0,values:[{label:"",value:"0"}],change:function(e){n.model.set(n.options.fields.radius4,e)}}),new Upfront.Views.Editor.Field.Number({model:this.model,className:r+"-radius3 border_radius border_radius3",name:n.options.fields.radius3,label:"",min:0,max:1e3,default_value:0,values:[{label:"",value:"0"}],change:function(e){n.model.set(n.options.fields.radius3,e)}})])},reset_fields:function(e){if(typeof e!="undefined"&&e==="yes"){var t=this.get_static_field_values(e,this.options.prepend);this.update_fields(e,t),this.save_static_values(e,t),this.$el.empty(),this.render()}},save_static_values:function(e,t){this.model.set(this.options.fields.lock,t.lock),this.model.set(this.options.fields.radius,t.radius),this.model.set(this.options.fields.radius_number,t.radius_number),this.model.set(this.options.fields.radius1,t.radius1),this.model.set(this.options.fields.radius2,t.radius2),this.model.set(this.options.fields.radius3,t.radius3),this.model.set(this.options.fields.radius4,t.radius4)},get_static_field_values:function(e,t){var n={},r="";return typeof this.options.prefix!="undefined"&&(r=this.options.prefix+"-"),n.lock=this.model.get(this.clear_prepend(r+this.options.fields.lock,t))||"",n.radius=this.model.get(this.clear_prepend(r+this.options.fields.radius,t))||"",n.radius_number=this.model.get(this.clear_prepend(r+this.options.fields.radius_number,t))||"",n.radius1=this.model.get(this.clear_prepend(r+this.options.fields.radius1,t))||"",n.radius2=this.model.get(this.clear_prepend(r+this.options.fields.radius2,t))||"",n.radius3=this.model.get(this.clear_prepend(r+this.options.fields.radius3,t))||"",n.radius4=this.model.get(this.clear_prepend(r+this.options.fields.radius4,t))||"",n},clear_prepend:function(e,t){return e.replace(t,"")},update_fields:function(e,t){s=this.fields._wrapped[2],s.$el.find("#"+s.get_field_id()).slider("value",t.radius),s.get_field().val(t.radius),s.trigger("changed")}});return n}),define("scripts/upfront/settings/modules/selectbox",["scripts/upfront/settings/modules/base-module"],function(e){var t=e.extend({className:"settings_module selectbox_settings_item clearfix",group:!0,get_title:function(){return this.options.title},initialize:function(e){this.options=e||{},typeof this.options.title=="undefined"&&(this.group=!1);var t=this,n=this.options.custom_class,r=this.options.state;this.fields=_([new Upfront.Views.Editor.Field.Select({model:this.model,className:r+"-select select-module "+n,name:t.options.fields.name,default_value:t.options.default_value,label:t.options.label,values:t.options.values,change:function(e){t.model.set(t.options.fields.name,e)}})])}});return t}),define("scripts/upfront/settings/modules/checkbox",["scripts/upfront/settings/modules/base-module"],function(e){var t=Upfront.Settings.l10n.preset_manager,n=e.extend({className:"settings_module checkbox_settings_item clearfix",group:!1,initialize:function(e){this.options=e||{};var t=this,n=this.options.state,r=Upfront.Views.Editor.Field.Text.extend({get_field_html:function(){return'<button class="checkbox-tooltip" title="'+t.options.tooltip_label+'">&nbsp;</button>'}});this.fields=_([new Upfront.Views.Editor.Field.Checkboxes({model:this.model,className:"checkbox-module checkbox-title",name:t.options.fields.checkbox,label:"",default_value:1,multiple:!1,values:[{label:t.options.label,value:"yes"}],change:function(e){t.model.set(t.options.fields.checkbox,e)},show:function(e,t){}})]),typeof t.options.tooltip!="undefined"&&t.options.tooltip&&this.fields.push(new r({model:this.model,label:"",className:"tooltip-icon"}))}});return n}),define("scripts/upfront/settings/modules/caption-location",["scripts/upfront/settings/modules/base-module"],function(e){var t=Upfront.Settings.l10n.image_element,n=e.extend({className:"settings_module image-caption-location caption_location clearfix",group:!1,initialize:function(e){this.options=e||{};var n=this,r=this.options.state;this.fields=_([new Upfront.Views.Editor.Field.Checkboxes({model:this.model,className:"useCaptions checkbox-title",name:"use_captions",label:"",default_value:1,multiple:!1,values:[{label:t.settings.show_caption,value:"yes"}],change:function(e){n.model.set("use_captions",e)},show:function(e,t){var n=t.closest(".state_modules");e=="yes"?(n.find("."+r+"-caption-select").show(),n.find("."+r+"-caption-trigger").show()):(n.find("."+r+"-caption-select").hide(),n.find("."+r+"-caption-trigger").hide())}}),new Upfront.Views.Editor.Field.Radios({className:r+"-caption-trigger field-caption_trigger upfront-field-wrap upfront-field-wrap-multiple upfront-field-wrap-radios over_image_field",model:this.model,name:"caption-trigger",label:"",layout:"horizontal-inline",values:[{label:t.settings.always,value:"always_show"},{label:t.settings.hover,value:"hover_show"}],change:function(e){n.model.set("caption-trigger",e)},init:function(){n.listenTo(this.model,"change",n.render)},rendered:function(){_.delay(this.options.disable_hover_show,200)},disable_hover_show:function(){n.$el.find("[value='hover_show']").attr("disabled",!1),"below_image"===n.model.get("caption-position")&&n.$el.find("[value='hover_show']").attr("disabled",!0)}}),new Upfront.Views.Editor.Field.Select({model:this.model,className:r+"-caption-select caption_select",name:"caption-position-value",default_value:"topOver",label:t.ctrl.caption_position,values:[{label:t.ctrl.over_top,value:"topOver",icon:"topOver"},{label:t.ctrl.over_bottom,value:"bottomOver",icon:"bottomOver"},{label:t.ctrl.cover_top,value:"topCover",icon:"topCover"},{label:t.ctrl.cover_middle,value:"middleCover",icon:"middleCover"},{label:t.ctrl.cover_bottom,value:"bottomCover",icon:"bottomCover"},{label:t.ctrl.below,value:"below",icon:"below"}],change:function(e){n.model.set("caption-position-value",e);switch(e){case"topOver":n.model.set("caption-position","over_image"),n.model.set("caption-alignment","top");break;case"bottomOver":n.model.set("caption-position","over_image"),n.model.set("caption-alignment","bottom");break;case"topCover":n.model.set("caption-position","over_image"),n.model.set("caption-alignment","fill");break;case"middleCover":n.model.set("caption-position","over_image"),n.model.set("caption-alignment","fill_middle");break;case"bottomCover":n.model.set("caption-position","over_image"),n.model.set("caption-alignment","fill_bottom");break;case"below":n.model.set("caption-position","below_image"),n.model.set("caption-alignment",!1),n.model.set("caption-trigger","always_show")}}})])}});return n}),define("scripts/upfront/settings/modules/gallery-caption-location",["scripts/upfront/settings/modules/base-module"],function(e){var t=Upfront.Settings.l10n.gallery_element,n=e.extend({className:"settings_module caption_location gallery-caption-location clearfix",group:!1,initialize:function(e){this.options=e||{};var n=this,r=this.options.state;this.fields=_([new Upfront.Views.Editor.Field.Checkboxes({model:this.model,className:"useCaptions checkbox-title",name:"use_captions",label:"",default_value:1,multiple:!1,values:[{label:t.panel.show_caption,value:"yes"}],change:function(e){n.model.set("use_captions",e)},show:function(e,t){var i=t.closest(".state_modules");if(e=="yes"){i.find("."+r+"-caption-select").show(),i.find("."+r+"-caption-trigger").show(),i.find("."+r+"-caption-height").show();var s=n.model.get("caption-height",e);s==="fixed"&&i.find("."+r+"-caption-height-number").show()}else i.find("."+r+"-caption-select").hide(),i.find("."+r+"-caption-trigger").hide(),i.find("."+r+"-caption-height").hide(),i.find("."+r+"-caption-height-number").hide()}}),new Upfront.Views.Editor.Field.Select({model:this.model,className:r+"-caption-select caption_select",name:"captionType",default_value:"below",label:t.panel.caption_location,values:[{value:"over",label:t.panel.over,icon:"over"},{value:"below",label:t.panel.under,icon:"below"}],change:function(e){n.model.set("captionType",e),e=="below"&&n.model.set("showCaptionOnHover","0")},show:function(e,t){var n=t.closest(".state_modules");e==="below"||typeof e=="undefined"?n.find(".gallery-caption-on-hover").hide():n.find(".gallery-caption-on-hover").show()}}),new Upfront.Views.Editor.Field.Radios({className:r+"-caption-trigger field-caption_trigger gallery-caption-on-hover upfront-field-wrap upfront-field-wrap-multiple upfront-field-wrap-radios over_image_field",model:this.model,name:"showCaptionOnHover",label:"",layout:"horizontal-inline",values:[{label:t.panel.always,value:"0"},{label:t.panel.hover,value:"1"}],change:function(e){n.model.set("showCaptionOnHover",e)}}),new Upfront.Views.Editor.Field.Radios({className:r+"-caption-height field-caption-height upfront-field-wrap upfront-field-wrap-multiple upfront-field-wrap-radios",model:this.model,name:"caption-height",label:t.panel.caption_height,layout:"horizontal-inline",values:[{label:t.panel.auto,value:"auto"},{label:t.panel.fixed,value:"fixed"}],change:function(e){n.model.set("caption-height",e)},show:function(e,t){var i=t.closest(".state_modules"),s=n.model.get("use_captions");s==="yes"&&(e==="fixed"?i.find("."+r+"-caption-height-number").show():i.find("."+r+"-caption-height-number").hide())}}),new Upfront.Views.Editor.Field.Number({model:this.model,className:r+"-caption-height-number caption-height-number",name:"thumbCaptionsHeight",min:1,label:"",default_value:20,values:[{label:"px",value:"1"}],change:function(e){n.model.set("thumbCaptionsHeight",e)}})]),this.listenToOnce(this,"rendered",function(){setTimeout(function(){if(n.model.get("use_captions")==="yes"){n.$el.find("."+r+"-caption-select").show(),n.$el.find("."+r+"-caption-trigger").show(),n.$el.find("."+r+"-caption-height").show();var e=n.model.get("caption-height");e==="fixed"&&n.$el.find("."+r+"-caption-height-number").show()}else n.$el.find("."+r+"-caption-select").hide(),n.$el.find("."+r+"-caption-trigger").hide(),n.$el.find("."+r+"-caption-height").hide(),n.$el.find("."+r+"-caption-height-number").hide()},500)})}});return n}),define("scripts/upfront/settings/modules/colors",["scripts/upfront/settings/modules/base-module"],function(e){var t=Upfront.Settings.l10n.preset_manager,n=e.extend({className:"settings_module colors_settings_item clearfix",group:!0,get_title:function(){return this.options.title},initialize:function(e){this.options=e||{},this.fieldCounter=0;var n=this,r=this.options.state,i="single",s="no-toggle",o=[];this.options.toggle===!0&&this.fieldCounter++,this.options.single!==!0&&(i="two"),_.each(this.options.abccolors,function(e){n.options.toggle===!0&&(s="element-toggled");var t=new Upfront.Views.Editor.Field.Color({className:r+"-color-field upfront-field-wrap-color color-module module-color-field "+s+" "+i,blank_alpha:0,model:n.model,name:e.name,default_value:n.model.get(e.name),label_style:"inline",label:e.label,spectrum:{preferredFormat:"hex",change:function(t){if(!t)return!1;var r=t.get_is_theme_color()!==!1?t.theme_color:t.toRgbString();n.model.set(e.name,r)},move:function(t){if(!t)return!1;var r=t.get_is_theme_color()!==!1?t.theme_color:t.toRgbString();n.model.set(e.name,r)}}});o.push(t)}),this.fields=_(o),this.options.toggle===!0&&(this.group=!1,this.fields.unshift(new Upfront.Views.Editor.Field.Checkboxes({model:this.model,className:"useColors checkbox-title",name:n.options.fields.use,label:"",multiple:!1,values:[{label:t.color,value:"yes",checked:this.model.get(n.options.fields.use)}],change:function(e){n.model.set(n.options.fields.use,e),n.reset_fields(e)},show:function(e,t){var n=t.closest(".state_modules");e=="yes"?n.find("."+r+"-color-field").show():n.find("."+r+"-color-field").hide()}})))},reset_fields:function(e){var t=this;typeof e!="undefined"&&e==="yes"&&(_.each(this.options.abccolors,function(e){var n=t.get_static_field_value(e,t.options.prepend);t.update_field(e,n),t.save_static_value(e,n),this.fieldCounter++}),this.$el.empty(),this.render())},save_static_value:function(e,t){this.model.set(e.name,t.color)},get_static_field_value:function(e,t){var n={},r="";return typeof this.options.prefix!="undefined"&&(r=this.options.prefix+"-"),n.color=this.model.get(this.clear_prepend(r+e.name,t))||"",n},clear_prepend:function(e,t){return e.replace(t,"")},update_field:function(e,t){this.fields._wrapped[this.fieldCounter].set_value(t.color),this.fields._wrapped[this.fieldCounter].update_input_border_color(t.color)},render:function(){var e=this;this.constructor.__super__.render.call(this),this.fields.each(function(t){if(typeof t.spectrumOptions!="undefined"){var n=e.model.get(t.name);t.set_value(n),t.update_input_border_color(Upfront.Util.colors.to_color_value(n))}})}});return n}),define("scripts/upfront/settings/modules/element-style",["scripts/upfront/settings/modules/base-module"],function(e){var t=Upfront.Settings.l10n.preset_manager,n=e.extend({className:"upfront-settings-item-anchor",initialize:function(e){this.options=e;var t=this,n=new Upfront.Views.Editor.Field.Text({model:this.model,property:"theme_style",label:"Element style:"}),r=new Upfront.Views.Editor.Field.Button({label:"Show style",compact:!0,on_click:function(){t.openCssEditor()},display:"inline"}),i=new Upfront.Views.Editor.Field.Button({label:"Remove style",compact:!0,on_click:function(){t.removeStyle()},display:"inline"});this.listenTo(n,"rendered",function(){n.$el.find("input").attr("readonly","readonly")}),this.fields=_([n,r,i]),this.on("panel:set",function(){t.fields.each(function(e){e.panel=t.panel,e.trigger("panel:set")})})},openCssEditor:function(){var e=this.model.get_property_value_by_name("theme_style");Upfront.Application.cssEditor.init({model:this.model,stylename:e,sidebar:!1,toolbar:!1,readOnly:!0})},removeStyle:function(){this.$el.find("input[type=text]").val(""),this.$el.hide(),this.model.set_property("theme_style","")}});return n}),define("scripts/upfront/settings/modules/padding",["scripts/upfront/settings/modules/base-module"],function(e){var t=Upfront.Settings.l10n.preset_manager,n=e.extend({className:"padding-settings sidebar-settings clearfix",initialize:function(e){this.options=e||{};var n=this,r=Upfront.Settings.LayoutEditor.Grid.column_padding;this.listenTo(Upfront.Events,"upfront:paddings:updated",this.refresh),this.fields=_([new Upfront.Views.Editor.Field.Checkboxes({model:this.model,className:"use-padding checkbox-title",use_breakpoint_property:!0,property:"use_padding",label:"",default_value:this.model.get_breakpoint_property_value("top_padding_use")||this.model.get_breakpoint_property_value("bottom_padding_use")||this.model.get_breakpoint_property_value("left_padding_use")||this.model.get_breakpoint_property_value("right_padding_use"),multiple:!1,values:[{label:"Customize Padding",value:"yes"}],change:function(e){n.model.set_breakpoint_property("use_padding",e),typeof e=="undefined"&&(n.model.set_breakpoint_property("left_padding_num",r,!0),n.model.set_breakpoint_property("top_padding_num",r,!0),n.model.set_breakpoint_property("right_padding_num",r,!0),n.model.set_breakpoint_property("bottom_padding_num",r,!0),padding_left.get_field().val(r),padding_top.get_field().val(r),padding_right.get_field().val(r),padding_bottom.get_field().val(r),n.disable_paddings())},show:function(e,t){var r=t.closest(".upfront-settings-item-content"),i=n.model.get_breakpoint_property_value("lock_padding");e=="yes"?i=="yes"?(r.find(".padding-slider").show(),r.find(".padding-number").show()):(r.find(".padding-top").show(),r.find(".padding-bottom").show(),r.find(".padding-left").show(),r.find(".padding-right").show()):(r.find(".padding-top").hide(),r.find(".padding-bottom").hide(),r.find(".padding-left").hide(),r.find(".padding-right").hide(),r.find(".padding-slider").hide(),r.find(".padding-number").hide())}}),lock_padding=new Upfront.Views.Editor.Field.Checkboxes({model:this.model,className:"padding-lock",use_breakpoint_property:!0,property:"lock_padding",label:"",default_value:0,multiple:!1,values:[{label:"",value:"yes"}],show:function(e){n.model.set_breakpoint_property("lock_padding",e);var t=n.$el,r=n.model.get_breakpoint_property_value("use_padding"),i=n.model.get_breakpoint_property_value("padding_number");e=="yes"&&r=="yes"?(t.find(".padding-slider").show(),t.find(".padding-number").show(),t.find(".padding-top").hide(),t.find(".padding-bottom").hide(),t.find(".padding-left").hide(),t.find(".padding-right").hide(),n.model.set_breakpoint_property("left_padding_num",i),n.model.set_breakpoint_property("top_padding_num",i),n.model.set_breakpoint_property("right_padding_num",i),n.model.set_breakpoint_property("bottom_padding_num",i),padding_left.get_field().val(i),padding_top.get_field().val(i),padding_right.get_field().val(i),padding_bottom.get_field().val(i),typeof Upfront.data.currentEntity.paddingControl!="undefined"&&Upfront.data.currentEntity.paddingControl.refresh()):r=="yes"&&(t.find(".padding-slider").hide(),t.find(".padding-number").hide(),t.find(".padding-top").show(),t.find(".padding-bottom").show(),t.find(".padding-left").show(),t.find(".padding-right").show())},change:function(e){n.model.set_property("lock_padding",e)}}),locked_slider=new Upfront.Views.Editor.Field.Slider({className:"padding-slider upfront-field-wrap",model:this.model,use_breakpoint_property:!0,property:"padding_slider",default_value:this.model.get_breakpoint_property_value("padding_slider")||r,suffix:t.px,step:5,min:0,max:250,change:function(e){n.model.set_breakpoint_property("padding_slider",e),n.model.set_breakpoint_property("padding_number",e,!0),n.model.set_breakpoint_property("left_padding_num",e,!0),n.model.set_breakpoint_property("top_padding_num",e,!0),n.model.set_breakpoint_property("right_padding_num",e,!0),n.model.set_breakpoint_property("bottom_padding_num",e,!0),locked_num.get_field().val(e),padding_left.get_field().val(e),padding_top.get_field().val(e),padding_right.get_field().val(e),padding_bottom.get_field().val(e),n.enable_lock_padding(),n.re_render_entity()},show:function(){var e=n.model.get_property_value_by_name("padding_number");e>250?n.$el.find(".padding-slider").css("opacity",.6):n.$el.find(".padding-slider").css("opacity",1)}}),locked_num=new Upfront.Views.Editor.Field.Number({className:"padding-number",model:this.model,use_breakpoint_property:!0,property:"padding_number",default_value:this.model.get_breakpoint_property_value("padding_number")||r,label:"",step:5,min:0,change:function(e){n.model.set_breakpoint_property("padding_slider",e),n.model.set_breakpoint_property("padding_number",e),locked_slider.$el.find("#"+locked_slider.get_field_id()).slider("value",e),n.model.set_breakpoint_property("left_padding_num",e,!0),n.model.set_breakpoint_property("top_padding_num",e,!0),n.model.set_breakpoint_property("right_padding_num",e,!0),n.model.set_breakpoint_property("bottom_padding_num",e,!0),padding_left.get_field().val(e),padding_top.get_field().val(e),padding_right.get_field().val(e),padding_bottom.get_field().val(e),n.enable_lock_padding(),n.re_render_entity(),e>250?n.$el.find(".padding-slider").css("opacity",.6):n.$el.find(".padding-slider").css("opacity",1)}}),padding_top=new Upfront.Views.Editor.Field.Number({model:this.model,className:"padding-top",use_breakpoint_property:!0,property:"top_padding_num",label:"",step:5,min:0,default_value:this.model.get_breakpoint_property_value("top_padding_num")||r,change:function(e){n.model.set_breakpoint_property("top_padding_num",e),n.enable_padding("top_padding_use")},focus:function(){n.$el.find(".padding-bottom label").css("border-top","3px solid #7bebc6")},blur:function(){n.$el.find(".padding-bottom label").css("border","1px dotted #7d99b3")}}),padding_left=new Upfront.Views.Editor.Field.Number({model:this.model,className:"padding-left",use_breakpoint_property:!0,property:"left_padding_num",label:"",step:5,min:0,default_value:this.model.get_breakpoint_property_value("left_padding_num")||r,change:function(e){n.model.set_breakpoint_property("left_padding_num",e),n.enable_padding("left_padding_use")},focus:function(){n.$el.find(".padding-bottom label").css("border-left","3px solid #7bebc6")},blur:function(){n.$el.find(".padding-bottom label").css("border","1px dotted #7d99b3")}}),padding_right=new Upfront.Views.Editor.Field.Number({model:this.model,className:"padding-right",use_breakpoint_property:!0,property:"right_padding_num",label:"",step:5,min:0,default_value:this.model.get_breakpoint_property_value("right_padding_num")||r,change:function(e){n.model.set_breakpoint_property("right_padding_num",e),n.enable_padding("right_padding_use")},focus:function(){n.$el.find(".padding-bottom label").css("border-right","3px solid #7bebc6")},blur:function(){n.$el.find(".padding-bottom label").css("border","1px dotted #7d99b3")}}),padding_bottom=new Upfront.Views.Editor.Field.Number({model:this.model,className:"padding-bottom",use_breakpoint_property:!0,property:"bottom_padding_num",label:"",step:5,min:0,default_value:this.model.get_breakpoint_property_value("bottom_padding_num")||r,change:function(e){n.model.set_breakpoint_property("bottom_padding_num",e),n.enable_padding("bottom_padding_use")},focus:function(){n.$el.find(".padding-bottom label").css("border-bottom","3px solid #7bebc6")},blur:function(){n.$el.find(".padding-bottom label").css("border","1px dotted #7d99b3")}})])},refresh:function(){this.model.set_breakpoint_property("use_padding","yes");var e=this.model.get_breakpoint_property_value("lock_padding"),t=this.fields._wrapped[1].get_field(),n=this.model.get_breakpoint_property_value("top_padding_num"),r=this.model.get_breakpoint_property_value("bottom_padding_num"),i=this.model.get_breakpoint_property_value("left_padding_num"),s=this.model.get_breakpoint_property_value("right_padding_num");e?t.attr("checked","checked"):t.removeAttr("checked"),t.trigger("change"),this.fields._wrapped[4].get_field().val(n),this.fields._wrapped[5].get_field().val(i),this.fields._wrapped[6].get_field().val(s),this.fields._wrapped[7].get_field().val(r)},enable_padding:function(e){this.model.set_breakpoint_property(e,"yes"),Upfront.Events.trigger("upfront:paddings:updated")},disable_paddings:function(){this.model.set_breakpoint_property("top_padding_use",""),this.model.set_breakpoint_property("bottom_padding_use",""),this.model.set_breakpoint_property("left_padding_use",""),this.model.set_breakpoint_property("right_padding_use",""),Upfront.Events.trigger("upfront:paddings:updated")},enable_lock_padding:function(){var e=this.model instanceof Upfront.Models.ModuleGroup;this.enable_padding("top_padding_use"),this.enable_padding("bottom_padding_use"),e||(this.enable_padding("left_padding_use"),this.enable_padding("right_padding_use"))},re_render_entity:function(){var e=Upfront.data.currentEntity;clearTimeout(this.refresh_timer),this.refresh_timer=setTimeout(function(){typeof e.render=="function"&&e.render()},200)}});return n}),define("scripts/upfront/settings/modules/anchor",["scripts/upfront/settings/modules/base-module"],function(e){var t=Upfront.Settings.l10n.preset_manager,n=Upfront.Views.Editor.Field.Field.extend({className:"upfront-field-complex_field-boolean_toggleable_text upfront-field-multiple",tpl:'<input id="upfront-anchor-element-checkbox" type="checkbox" class = "upfront-field-checkbox" /> <label for="upfront-anchor-element-checkbox"><span class="upfront-field-label-text">{{element_label}}</span></label> <div class="upfront-embedded_toggleable" style="display:none">{{field}}<div class="upfront-embedded_toggleable-notice">'+Upfront.Settings.l10n.global.views.anchor_nag+"</div></div>",initialize:function(e){Upfront.Views.Editor.Field.Field.prototype.initialize.call(this,e),this.options.field=new Upfront.Views.Editor.Field.Text(this.options)},render:function(){var e=this;this.$el.empty(),this.$el.append(this.get_field_html()),this.$el.on("click",":checkbox",function(t){t.stopPropagation(),e.field_toggle.apply(e)}),this.model.get_property_value_by_name(this.options.field.get_name())&&(this.$el.find(":checkbox").attr("checked",!0),this.check_value(),this.field_toggle()),this.$el.on("keyup",'[name="'+this.options.field.get_name()+'"]',function(t){t.stopPropagation(),e.check_value.apply(e)}),setTimeout(function(){e.trigger("anchor:updated")},50)},field_toggle:function(){this.$el.find(":checkbox").is(":checked")?this.$el.find(".upfront-embedded_toggleable").show():this.$el.find(".upfront-embedded_toggleable").hide(),this.property.set({value:this.get_value()}),this.trigger("anchor:updated")},check_value:function(){var e=this.$el.find('[name="'+this.options.field.get_name()+'"]'),t=this.$el.find(".upfront-embedded_toggleable"),n=e.length&&e.val?e.val():"";t.removeClass("error").removeClass("ok"),n.length&&!n.match(/^[a-zA-Z]+$/)?t.addClass("error"):n.length&&t.addClass("ok"),this.property.set({value:this.get_value()})},get_field_html:function(){this.options.field.render();var e=this.options.field.$el;return _.template(this.tpl,_.extend({},this.options,{field:e.html()}))},get_value:function(){var e={},t=this.$el.find(":checkbox"),n=this.$el.find('[name="'+this.options.field.get_name()+'"]'),r=n.val().replace(/[^a-zA-Z]/g,"");return t.is(":checked")&&r?r:""}}),r=e.extend({className:"upfront-settings-item-anchor",initialize:function(e){this.options=e;var t=new n({element_label:Upfront.Settings.l10n.global.views.make_element_anchor,className:"upfront-field-complex_field-boolean_toggleable_text upfront-field-multiple checkbox-title",model:this.model,property:"anchor"});t.on("anchor:updated",function(){this.trigger("anchor:item:updated")},this),this.fields=_([t])},save_fields:function(){this.fields.invoke("check_value"),e.prototype.save_fields.call(this)}});return r}),define("elements/upfront-newnavigation/js/menu-util",[],function(){var e=Upfront.Settings.l10n.newnavigation_element,t=function(){var e=this,t=Upfront.mainData.menus,n=_.map(t,function(e,t){return{label:e.name,value:e.term_id}});this.getMenuById=function(e){var n=e+"",r=parseInt(n,10),i=_.findWhere(t,{term_id:r});return _.isUndefined(i)&&(i=_.findWhere(t,{term_id:n})),i},this.getMenuSlugById=function(e){return(this.getMenuById(e)||{}).slug},this.getSelectMenuOptions=function(){return n},this.addMenu=function(e){e.term_id=e.term_id+"",t.push(e),n.unshift({label:e.slug,value:e.term_id})},this.deleteMenu=function(e){n=_.reject(n,function(t){return t.value===e}),t=_.reject(t,function(t){return t.term_id===e})},Upfront.Events.on("menu_element:menu_created",function(t){e.addMenu(t)}),Upfront.Events.on("menu_element:delete",function(t){e.deleteMenu(t)})},n=new t;return n}),define("text!scripts/upfront/settings/modules/menu-structure/menu-item-editor.tpl",[],function(){return'<form>\n	<label>{{Upfront.Settings.l10n.global.content.menu_item_label}}</label>\n	<input type="text" class="menu-item-title" value="{{ title }}">\n	<label class="item-links-to-label">{{Upfront.Settings.l10n.global.content.links_to}}</label>\n	<div class="menu-item-type-editor">\n		{[if(type == \'external\') { ]}\n			<input type="text" class="menu-item-external-input" value="{{url}}" placeholder="{{Upfront.Settings.l10n.global.content.type_link_url}}" >\n		{[ } ]}\n		{[if(type == \'entry\') { ]}\n			<span class="menu-item-entry-display">{{url}}</span>\n			<span class="menu-item-entry-input" >{{Upfront.Settings.l10n.global.content.edit_link}}</span>\n		{[ } ]}\n		{[if(type == \'anchor\') { ]}\n		<div class="anchor-selector">\n		</div>\n		{[ } ]}\n		{[if(type == \'email\') { ]}\n		<div class="upfront-field-wrap ulinkpanel-external-wrap">\n			<input type="text" value="{{url}}" placeholder="johnsmith@example.com" class="menu-item-email-input">\n		</div>\n		{[ } ]}\n		{[if(type == \'lightbox\') { ]}\n			{[ if(lightboxes.length) { ]}\n				<div class="lightbox-selector">\n				</div>\n			{[ } else { ]}\n\n			{[ } ]}\n\n				<div class="new-lightbox">\n						<label>{{Upfront.Settings.l10n.global.content.create_lightbox}}</label>\n						<input type="text" name="menu-item-lightbox-input" class="menu-item-lightbox-input upfront-field upfront-field-text upfront-field-empty" value="" placeholder="{{Upfront.Settings.l10n.global.content.lightbox_name}}" />\n				</div>\n		{[ } ]}\n		{[if(type !== \'lightbox\' && type !== \'anchor\') { ]}\n			<label class="menu-item-target-label">{{Upfront.Settings.l10n.global.content.link_opens_in}}</label>\n		{[ } ]}\n	</div>\n</form>\n'}),function(e){define("scripts/upfront/settings/modules/menu-structure/menu-item-editor",["text!scripts/upfront/settings/modules/menu-structure/menu-item-editor.tpl"],function(t){var n=function(){var e=[],t=Upfront.Application.layout.get("regions");return _.each(t.models,function(t){t.attributes.sub=="lightbox"&&e.push({id:"#"+t.get("name"),label:t.get("title")})}),e},r=function(){var e=Upfront.Application.layout.get("regions"),t=[],n;return n=function(e){e.each(function(e){var r=e.get_property_value_by_name("anchor");r&&r.length&&t.push({id:"#"+r,label:r}),e.get("objects")?e.get("objects").each(function(e){var n=e.get_property_value_by_name("anchor");n&&n.length&&t.push({id:"#"+n,label:n})}):e.get("modules")&&n(e.get("modules"))})},e.each(function(e){n(e.get("modules"))}),t},i=function(){var e=[];return _.each(Upfront.data.ugallery.postTypes,function(t){t.name!="attachment"&&e.push({name:t.name,label:t.label})}),e},s=Backbone.View.extend({className:"menu-item-editor",events:{"click .menu-item-entry-input":"showPagePostSelector","keydown .menu-item-lightbox-input":"onLightboxNameInputChange","keydown .menu-item-external-input":"onUrlNameKeydown","change .menu-item-external-input":"onUrlNameChange","keydown .menu-item-email-input":"onEmailNameKeydown","change .menu-item-email-input":"onEmailNameChange","keydown .menu-item-title":"onItemNameKeydown","change .menu-item-title":"onItemNameChange"},initialize:function(e){this.options=e||{},this.type=Upfront.Util.guessLinkType(this.model.get("menu-item-url"))},render:function(){return this.$el.html(_.template(t,{title:this.model.get("menu-item-title"),type:this.type,lightboxes:n(),url:this.model.get("menu-item-url")})),this.renderTypeSelect(),this.type==="anchor"&&this.renderAnchorSelect(),this.type==="lightbox"&&n()&&this.renderLightBoxesSelect(),this.type!=="anchor"&&this.type!=="anchor"&&this.renderLinkTargetSelect(),this},renderTypeSelect:function(){var e=this,t=[];_.each(["unlink","external","entry","anchor","lightbox","email"],function(e){t.push(this.getLinkTypeValue(e))},this),this.typeSelect=new Upfront.Views.Editor.Field.Select({label:"",values:t,default_value:this.type||"external",change:function(t){e.onTypeChange(t)}}),this.typeSelect.render(),this.$el.find(".item-links-to-label").after(this.typeSelect.el)},renderLinkTargetSelect:function(){var e=this,t=new Upfront.Views.Editor.Field.Select({label:"",values:[{value:"",label:"Same Browser Tab"},{value:"_blank",label:"New Browser Tab"}],default_value:this.model.get("menu-item-target"),change:function(t){e.onTargetChange(t)}});t.render(),this.$el.find(".menu-item-target-label").after(t.el)},getLinkTypeValue:function(e){var t=Upfront.Settings.l10n.global.content;switch(e){case"unlink":return{value:"unlink",label:t.no_link};case"external":return{value:"external",label:t.url};case"email":return{value:"email",label:t.email_address};case"entry":return{value:"entry",label:t.post_or_page};case"anchor":return{value:"anchor",label:t.anchor};case"image":return{value:"image",label:t.larger_image};case"lightbox":return{value:"lightbox",label:t.lightbox}}},showPagePostSelector:function(e){e&&e.preventDefault();var t=this,n={postTypes:i()};Upfront.Views.Editor.PostSelector.open(n).done(function(e){t.model.set({"menu-item-url":e.get("permalink")}),t.saveItem(),t.render()})},saveItem:function(){var e=this;Upfront.Util.post({action:"upfront_update_single_menu_item",menuId:this.options.menuId,menuItemData:this.model.toJSON()}).done(function(){e.trigger("change")})},onTypeChange:function(e){this.model.set({"menu-item-url":""}),this.type=e,this.render(),this.type==="entry"?this.showPagePostSelector():this.type==="unlink"&&this.saveItem(),this.$el.parent().find(".menu-item-type").first().text(this.getLinkTypeLabel(e))},onTargetChange:function(e){this.model.set({"menu-item-target":e}),this.saveItem()},renderAnchorSelect:function(){var e=this,t=[{label:"Choose Anchor...",value:""}];_.each(r(),function(e){t.push({label:e.label,value:e.id})});var n=this.model.get("menu-item-url");n=n?n:"",n=n.match(/^#/)?n:"",this.anchorSelect=new Upfront.Views.Editor.Field.Select({label:"",values:t,default_value:n,change:function(){e.model.set({"menu-item-url":this.get_value()}),e.saveItem()}}),this.anchorSelect.render(),this.$el.find(".anchor-selector").append(this.anchorSelect.el)},renderLightBoxesSelect:function(){var e=this,t=[{label:"Choose Lightbox...",value:""}];_.each(n()||[],function(e){t.push({label:e.label,value:e.id})});var r=this.model.get("menu-item-url");r=r?r:"",r=r.match(/^#/)?r:"",this.lightboxSelect=new Upfront.Views.Editor.Field.Select({label:"",values:t,default_value:r,change:function(){e.model.set({"menu-item-url":this.get_value()}),e.saveItem()}}),this.lightboxSelect.render(),this.$el.find(".lightbox-selector").append(this.lightboxSelect.el)},onLightboxNameInputChange:function(e){e.which==13&&(e.preventDefault(),this.createLightBox())},createLightBox:function(){var t=e.trim(this.$(".menu-item-lightbox-input").val());if(!t)return Upfront.Views.Editor.notify(l10n.ltbox_empty_name_nag,"error"),!1;this.model.set({"menu-item-url":"#"+Upfront.Application.LayoutEditor.createLightboxRegion(t)}),this.saveItem(),this.render()},onUrlNameKeydown:function(e){e.which==13&&(e.preventDefault(),this.onUrlNameChange())},onUrlNameChange:function(){this.model.set({"menu-item-url":e.trim(this.$el.find(".menu-item-external-input").val())}),this.saveItem()},onEmailNameKeydown:function(e){e.which==13&&(e.preventDefault(),this.onEmailNameChange())},onEmailNameChange:function(){this.model.set({"menu-item-url":"mailto:"+e.trim(this.$el.find(".menu-item-email-input").val())}),this.saveItem()},onItemNameKeydown:function(e){e.which==13&&(e.preventDefault(),this.onItemNameChange())},onItemNameChange:function(){var t=e.trim(this.$el.find(".menu-item-title").val());this.model.set({"menu-item-title":t}),this.$el.parent().find(".menu-item-title").first().text(t),this.saveItem()},getLinkTypeLabel:function(e){var t=Upfront.Settings.l10n.global.content;switch(e){case"unlink":return t.no_link;case"external":return t.url;case"email":return t.email_address;case"entry":return t.post_or_page;case"anchor":return t.anchor;case"image":return t.larger_image;case"lightbox":return t.lightbox}}});return s})}(jQuery),define("text!scripts/upfront/settings/modules/menu-structure/menu-item.tpl",[],function(){return'<div class="menu-item-header">\n	<span class="menu-item-title" title="{{ title }}">{{ title }}</span>\n	<span class="menu-item-type" title="{{ type }}">{{ type }}</span>\n	<i class="menu-item-delete">x</i>\n</div>\n'}),define("scripts/upfront/settings/modules/menu-structure/menu-item",["scripts/upfront/settings/modules/menu-structure/menu-item-editor","text!scripts/upfront/settings/modules/menu-structure/menu-item.tpl"],function(e,t){var n=Backbone.View.extend({className:"menu-structure-module-item",events:{"click .menu-item-header":"toggleEditor","click .menu-item-delete":"deleteItem"},initialize:function(e){this.options=e||{},this.subViews=[],this.depth=this.options.depth||0,this.parent_view=e.parent_view;var t=this.model.get("sub");t&&_.each(t,function(e){this.subViews.unshift(new n({model:new Backbone.Model(e),depth:this.depth+1,menuId:this.options.menuId}))},this)},render:function(){var n=this;this.$el.html(_.template(t,{title:this.model.get("menu-item-title"),type:this.getLinkTypeLabel(Upfront.Util.guessLinkType(this.model.get("menu-item-url")))})),this.$el.data("menu-item-object-id",this.model.get("menu-item-object-id")),this.$el.data("menu-item-depth",this.depth),this.$el.addClass("menu-structure-item-depth-"+this.depth);var r=new e({model:this.model,menuId:this.options.menuId});return this.$el.append(r.render().el),this.listenTo(r,"change",function(){n.trigger("change",n.model.toJSON())}),setTimeout(function(){_.each(n.subViews,function(e){n.$el.after(e.render().el)})},100),this.delegateEvents(),this},toggleEditor:function(){this.$el.toggleClass("menu-item-expanded"),this.$el.find(".menu-item-editor").toggle()},getLinkTypeLabel:function(e){var t=Upfront.Settings.l10n.global.content;switch(e){case"unlink":return t.no_link;case"external":return t.url;case"email":return t.email_address;case"entry":return t.post_or_page;case"anchor":return t.anchor;case"image":return t.larger_image;case"lightbox":return t.lightbox}},deleteItem:function(e){e.preventDefault(),e.stopPropagation(),typeof this.model.get("menu-item-db-id")!="undefined"&&Upfront.Util.post({action:"upfront_new_delete_menu_item",menu_item_id:this.model.get("menu-item-db-id")}).success(function(e){Upfront.Events.trigger("menu_element:edit")}).error(function(e){Upfront.Util.log("Error Deleting Menu Item")})}});return n}),define("text!scripts/upfront/settings/modules/menu-structure/menu-structure.tpl",[],function(){return'<div class="menu-structure-header">\n	<span class="upfront-settings-item-title">MENU STRUCTURE</span>\n	<span class="add-menu-item">Add item</span>\n</div>\n<div class="menu-structure-body"></div>\n'}),function(e){define("scripts/upfront/settings/modules/menu-structure",["elements/upfront-newnavigation/js/menu-util","scripts/upfront/settings/modules/menu-structure/menu-item","text!scripts/upfront/settings/modules/menu-structure/menu-structure.tpl"],function(t,n,r){var i=Upfront.Settings.l10n.preset_manager,s=!1,o=Backbone.View.extend({className:"settings_module menu_structure_module clearfix",handlesSaving:!0,events:{"mouseenter .menu-item-header":"enableSorting","mouseleave .menu-item-header":"disableSortingOnHeaderLeave","click .add-menu-item":"addItem"},initialize:function(e){var t=this;this.options=e||{},this.listenTo(this.model.get("properties"),"change",function(){t.reloadItems()}),Upfront.Events.on("menu_element:edit",function(e){t.reloadItems()}),this.setup()},reloadItems:function(){this.setup(),this.render()},setup:function(){this.menuId=this.model.get_property_value_by_name("menu_id"),this.menuItems=[],this.menuItemViews=[],this.menu=t.getMenuById(this.menuId);if(this.menuId===!1)return;this._load_items()},_has_promise:function(e){var t=JSON.stringify(e);return!!(this._promises||{})[t]},_add_promise:function(e,t){var n=JSON.stringify(e);return this._promises=this._promises||{},this._promises[n]=t,!0},_drop_promise:function(e){var t=JSON.stringify(e);return this._promises=this._promises||{},this._promises[t]=!1,!0},_load_items:function(){var e=this,t={action:"upfront_new_load_menu_array",data:this.menuId+""},r;return this._has_promise(t)?!0:(r=Upfront.Util.post(_.extend({},t)),this._add_promise(t,r),r.success(function(r){e.menuItems=r.data||[],_.each(e.menuItems,function(t,r){var i=new n({model:new Backbone.Model(t),menuId:e.menuId});e.menuItemViews.push(i),e.listenTo(i,"change",function(t){e.menuItems[r]=t,e.model.trigger("change")})}),e.model.set_property("menu_items",r.data,!0),e.model.trigger("change"),e.render(),e._drop_promise(t)}).error(function(e){Upfront.Util.log("Error loading menu items")}),!0)},render:function(){var e=this,t;this.$el.html(r);if(this.menuId===!1)return;t=this.$el.find(".menu-structure-body"),_.each(this.menuItemViews,function(e){t.append(e.render().el)});if(s){var n=e.$el.closest(".uf-settings-panel--expanded"),i=n.closest("#sidebar-scroll-wrapper");i.scrollTop(n.height()-175),s=!1}},enableSorting:function(t){if(this.sortingInProggres===!0)return;var n=this.$el.find(".menu-structure-module-item"),r=e(t.target).parent(),i=!1,s=this,o;n.addClass("menu-structure-sortable-item"),n.each(function(){if(i)return;if(!_.isUndefined(o)&&e(this).data("menuItemDepth")<=o){i=!0;return}if(!_.isUndefined(o)&&e(this).data("menuItemDepth")>o){e(this).addClass("hovered-item-group-member"),e(this).removeClass("menu-structure-sortable-item");return}_.isUndefined(o)&&e(this).is(r)&&(o=e(this).data("menuItemDepth"),e(this).addClass("hovered-item-group-member"),e(this).removeClass("menu-structure-sortable-item"))}),this.$el.find(".hovered-item-group-member").wrapAll('<div class="menu-structure-sortable-item"></div>'),this.$el.sortable({axis:"y",items:".menu-structure-sortable-item",start:function(e,t){s.sortingInProggres=!0,s.watchItemDepth(t.item)},stop:function(e,t){s.stopWatchingItemDepth(t.item),s.updateItemsPosition(t.item),s.sortingInProggres=!1}})},disableSortingOnHeaderLeave:function(){if(this.sortingInProggres===!0)return;this.disableSorting()},disableSorting:function(){var e=this.$el.find(".menu-structure-module-item"),t=this.$el.find(".hovered-item-group-member");t.unwrap(),t.removeClass("hovered-item-group-member"),e.removeClass("menu-structure-sortable-item"),this.$el.sortable("destroy")},watchItemDepth:function(e){var t=this,n;this.$el.on("mousemove",function(r){if(_.isUndefined(n)){n=r.pageX;return}if(Math.abs(n-r.pageX)<15)return;t.updateSortableDepth(n,r.pageX,e),n=r.pageX})},updateSortableDepth:function(e,t,n){var r=n.hasClass("menu-structure-module-item")?n.data("menuItemDepth"):n.children().first().data("menu-item-depth"),i=n.prev().data("menu-item-depth"),s=n.nextAll().not(".ui-sortable-placeholder").first().data("menu-item-depth");e>t&&this.decreaseGroupDepth(r,i,s,n),e<t&&this.increaseGroupDepth(r,i,s,n)},decreaseGroupDepth:function(t,n,r,i){var s=this;if(n<t&&r<t||n===t&&r<t||_.isUndefined(r)||r<t){if(i.hasClass("menu-structure-module-item")){if(i.data("menuItemDepth")===0)return;this.decreaseItemDepth(i);return}if(i.children().first().data("menuItemDepth")===0)return;i.children().each(function(){s.decreaseItemDepth(e(this))})}},increaseGroupDepth:function(t,n,r,i){var s=this;if(n>=t||n===t&&r<t){if(i.hasClass("menu-structure-module-item")){this.increaseItemDepth(i);return}i.children().each(function(){s.increaseItemDepth(e(this))})}},decreaseItemDepth:function(e){e.removeClass("menu-structure-item-depth-"+e.data("menuItemDepth")),e.data("menu-item-depth",e.data("menuItemDepth")-1),e.addClass("menu-structure-item-depth-"+e.data("menuItemDepth"))},increaseItemDepth:function(e){e.removeClass("menu-structure-item-depth-"+e.data("menuItemDepth")),e.data("menuItemDepth",e.data("menuItemDepth")+1),e.addClass("menu-structure-item-depth-"+e.data("menuItemDepth"))},stopWatchingItemDepth:function(){this.$el.off("mousemove")},flattenItem:function(e){var t=this,n=[e];return e.sub&&_.each(e.sub,function(e){n=_.union(n,t.flattenItem(e))}),n},updateItemsPosition:function(){var t=this,n=[];_.each(this.menuItems,function(e){n=_.union(n,t.flattenItem(e))});var r=this.$el.find(".menu-structure-module-item"),i=[],s=[0],o=0,u=1,a=0,f,l;r.each(function(){var t=_.findWhere(n,{"menu-item-object-id":e(this).data("menuItemObjectId")}),r=e(this).data("menuItemDepth");if(r>a)s.push(o),a+=1;else if(r!==a&&r<a){f=a-r;for(l=0;l<f;l++)s=_.initial(s);a=r}i.push(_.extend(t,{"menu-item-parent-id":_.last(s)||0,"menu-item-position":u})),u+=1,o=t["menu-item-object-id"]}),Upfront.Util.post({action:"upfront_update_menu_items",data:{items:i,menuId:this.menuId}}).done(function(){t.setup()}).fail(function(e){Upfront.Util.log("Failed saving menu items.")})},addItem:function(){var e=this,t={"menu-item-object":"custom","menu-item-parent-id":0,"menu-item-target":"","menu-item-title":"New Item","menu-item-type":"custom","menu-item-url":""};Upfront.Util.post({action:"upfront_update_single_menu_item",menuId:this.menuId,menuItemData:t}).done(function(n){t["menu-item-db-id"]=n.data.itemId,t["menu-item-object-id"]=n.data.itemId+"",Upfront.Util.post({action:"upfront_update_single_menu_item",menuId:e.menuId,menuItemData:t}).done(function(){e.model.get_property_value_by_name("menu_items").unshift(t),e.model.get("properties").trigger("change"),s=!0})}).fail(function(e){Upfront.Util.log("Failed saving menu items.")})},save_fields:function(){}});return o})}(jQuery),define("elements/upfront-newnavigation/js/settings/menu-style",[],function(){var e=Upfront.Settings.l10n.newnavigation_element,t=Upfront.Views.Editor.Settings.Item.extend({className:"settings_module menustyle_settings_item clearfix",group:!0,get_title:function(){return this.options.title},initialize:function(t){this.options=t||{};var n=this,r=this.options.state;this.fields=_([new Upfront.Views.Editor.Field.Select({model:this.model,className:r+"-select select-module menu_style",name:"menu_style",default_value:this.model.get("menu_style"),label:e.mnu.style,values:[{label:e.mnu.horiz,value:"horizontal"},{label:e.mnu.vert,value:"vertical"},{label:e.mnu.triggered,value:"burger"}],change:function(e){n.model.set("menu_style",e),e!=="burger"?(n.fields._wrapped[3].$el.hide(),n.fields._wrapped[3].set_value("over")):n.model.get("burger_alignment")==="top"&&n.fields._wrapped[3].$el.show()},show:function(e,t){e==="burger"?t.parent().find(".burger_alignment").show():t.parent().find(".burger_alignment").hide()}}),new Upfront.Views.Editor.Field.Select({model:this.model,className:r+"-select select-module menu_alignment",name:"menu_alignment",default_value:this.model.get("menu_alignment"),label:e.mnu.alignment,values:[{label:e.mnu.left,value:"left"},{label:e.mnu.center,value:"center"},{label:e.mnu.right,value:"right"}],change:function(e){n.model.set("menu_alignment",e)}}),new Upfront.Views.Editor.Field.Select({model:this.model,className:r+"-select select-module burger_alignment",name:"burger_alignment",default_value:this.model.get("burger_alignment"),label:e.mnu.show_on_click,values:[{label:e.mnu.left,value:"left",icon:"burger-left"},{label:e.mnu.right,value:"right",icon:"burger-right"},{label:e.mnu.top,value:"top",icon:"burger-top"},{label:e.mnu.whole,value:"whole",icon:"burger-whole"}],change:function(e){n.model.set("burger_alignment",e),e==="left"||e==="right"||e==="whole"?(n.fields._wrapped[3].$el.hide(),n.fields._wrapped[3].set_value("over")):n.fields._wrapped[3].$el.show()}}),new Upfront.Views.Editor.Field.Radios({model:this.model,default_value:this.model.get("burger_over"),name:"burger_over",label:"",layout:"vertical",values:[{label:e.mnu.over,value:"over"},{label:e.mnu.push,value:"pushes"}],change:function(e){n.model.set("burger_over",e)}})]),this.listenTo(this,"rendered",function(){var e=n.model.get("burger_alignment");e==="left"||e==="right"||e==="whole"?(n.fields._wrapped[3].$el.hide(),n.fields._wrapped[3].set_value("over")):n.fields._wrapped[3].$el.show();var t=n.model.get("menu_style");t!=="burger"&&(n.fields._wrapped[3].$el.hide(),n.fields._wrapped[3].set_value("over"))})}});return t}),define("scripts/upfront/settings/module-factory",["scripts/upfront/settings/modules/typography","scripts/upfront/settings/modules/border","scripts/upfront/settings/modules/hov-animation","scripts/upfront/settings/modules/radius","scripts/upfront/settings/modules/selectbox","scripts/upfront/settings/modules/checkbox","scripts/upfront/settings/modules/caption-location","scripts/upfront/settings/modules/gallery-caption-location","scripts/upfront/settings/modules/colors","scripts/upfront/settings/modules/element-style","scripts/upfront/settings/modules/padding","scripts/upfront/settings/modules/anchor","scripts/upfront/settings/modules/menu-structure","elements/upfront-newnavigation/js/settings/menu-style"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p){var d=function(){var d={Typography:e,Border:t,HovAnimation:n,Radius:r,Selectbox:i,Checkbox:s,CaptionLocation:o,GalleryCaptionLocation:u,Colors:a,ElementStyle:f,Padding:l,Anchor:c,MenuStructure:h,MenuStyle:p};this.createModule=function(e,t,n){var r=_.extend({},t,{model:n});return typeof e=="string"?new d[e](r):new e(r)}};return moduleFactory=new d,moduleFactory}),function(e){define("scripts/upfront/element-settings/root-settings-panel",["scripts/upfront/element-settings/settings-container","scripts/upfront/element-settings/root-panel-mixin","scripts/upfront/settings/field-factory","scripts/upfront/settings/module-factory"],function(t,n,r,i){var s=Upfront.Settings&&Upfront.Settings.l10n?Upfront.Settings.l10n.global.views:Upfront.mainData.l10n.global.views,o=t.extend(_.extend({},n,{initialize:function(e){var t=this,n=[];this.options=e,this.settings=_(this.settings),this.settings.each(function(e){var s;e.type==="SettingsItem"?s=new Upfront.Views.Editor.Settings.Item({title:e.title,model:t.model,className:e.className,fields:[]}):s=i.createModule(e.type,e||{},t.model),e.identifier&&(s.identifier=e.identifier),_.each(e.fields,function(n){var i;"change"in n&&(n.preservedChangeCallback||(n.preservedChangeCallback=n.change),n.change=function(e){n.preservedChangeCallback(e,t)},Upfront.Events.once("entity:settings:deactivate",function(){n.change=n.preservedChangeCallback})),"show"in n&&(n.preservedShowCallback||(n.preservedShowCallback=n.show),n.show=function(e){n.preservedShowCallback(e,t)},Upfront.Events.once("entity:settings:deactivate",function(){n.show=n.preservedShowCallback})),i=r.createField(n.type,_.extend({model:t.model},_.omit(n,["type"]))),e.triggerChange&&t.listenTo(i,"change changed",function(){t.save_settings(),t.model.trigger("change")}),n.identifier&&(i.identifier=n.identifier),s.fields.push(i)}),s.panel=t,s.trigger("panel:set"),n.push(s)}),this.settings=_(n)},getBody:function(){var t=e("<div />"),n=this;return this.settings.each(function(e){e.panel||(e.panel=n),e.render(),t.append(e.el)}),t}}));return o})}(jQuery),define("scripts/upfront/settings/fields/select-preset",[],function(){var e=Upfront.Settings.l10n.preset_manager,t=Upfront.Views.Editor.Field.Chosen_Select.extend({className:"preset select-preset-field",render:function(){Upfront.Views.Editor.Field.Chosen_Select.prototype.render.call(this);var t=this,n="",r=this.$el.find(".upfront-chosen-select").val();r=="default"&&Upfront.Application.get_current()===Upfront.Application.MODE.THEME?n="230px":n="175px",this.$el.find(".upfront-chosen-select").chosen({search_contains:!0,width:n});var i=['<a href="#" title="'+e.add_preset_label+'" class="upfront-preset-add">'+e.add_label+"</a>"];return this.$el.find(".chosen-search").append(i.join("")),this.$el.on("click",".upfront-preset-add",function(n){n.preventDefault();var r=t.$el.find(".chosen-search input").val();if(r.trim()===""){alert(e.not_empty_label);return}if(r.match(/[^A-Za-z0-9 ]/)){alert(e.special_character_label);return}if(!r.match(/^[A-Za-z][A-Za-z0-9 ]*$/)){alert(e.invalid_preset_label);return}t.trigger("upfront:presets:new",r.trim())}),this},get_value_html:function(e,t){var n="",r=this.get_saved_value()?this.get_saved_value():"default";return e.value===this.clear_preset_name(r)&&(n=' selected="selected"'),['<option value="',e.value,'"',n,">",e.label,"</option>"].join("")},clear_preset_name:function(e){return e=e.replace(" ","-"),e=e.replace(/[^-a-zA-Z0-9]/,""),e}});return t}),define("scripts/upfront/settings/modules/select-preset",["scripts/upfront/settings/modules/base-module","scripts/upfront/settings/fields/select-preset"],function(e,t){var n=Upfront.Settings.l10n.preset_manager,r=e.extend({className:"select-presets",initialize:function(e){this.options=e||{},this.group=!1;var r=this;this.selectPresetField=new t({model:this.model,label:n.select_preset_label,property:"preset",values:this.get_presets(),change:function(e){r.model.set_property("preset",this.get_value())}}),this.fields=_([this.selectPresetField]),this.listenTo(this.selectPresetField,"upfront:presets:new",this.createPreset),this.listenTo(this.selectPresetField,"changed",this.changePreset)},changePreset:function(){this.trigger("upfront:presets:change",this.selectPresetField.get_value())},createPreset:function(e){this.trigger("upfront:presets:new",e)},get_title:function(){return n.select_preset},get_presets:function(){var e=[];return _.each(this.options.presets.models,function(t){if(typeof t.get("legacy")!="undefined")return;"undefined"==typeof t.get("name")?e.push({label:t.get("id"),value:t.get("id")}):e.push({label:t.get("name"),value:t.get("id")})}),e}});return r}),define("scripts/upfront/settings/fields/show-state",[],function(){var e=Upfront.Views.Editor.Field.Button.extend({className:"state_settings_button",initialize:function(e){this.options=e||{},this.label=this.options.state,this.options.compact=!0,this.$el.addClass("state_settings_button_"+this.options.state.toLowerCase())},on_click:function(){this.trigger("upfront:presets:state_show",this.options.state.toLowerCase())}});return e}),define("scripts/upfront/settings/modules-container",["scripts/upfront/settings/module-factory"],function(e){var t=Backbone.View.extend({initialize:function(t){this.options=t||{};var n=[],r=this,i=this.options.modules;_.isUndefined(i)&&(i=this.modules),typeof this.getAdditionalModules=="function"&&(i=this.getAdditionalModules(_.clone(i))),_.each(i,function(t){t.options=t.options||{},"change"in t.options&&(t.options.preservedChangeCallback||(t.options.preservedChangeCallback=t.options.change),t.options.change=function(e){t.options.preservedChangeCallback(e,r)},Upfront.Events.once("entity:settings:deactivate",function(){t.options.change=t.options.preservedChangeCallback}));var i=e.createModule(t.moduleType,t.options||{},this.options.model);i.panel=this,n.push(i)},this),this.modules=_(n),this.onInitialize&&this.onInitialize(t)},render:function(){this.$el.html(""),this.$el.append('<div class="upfront-settings-item-content"></div>');var e=this.$el.find(".upfront-settings-item-content");this.modules.each(function(t){t.render(),t.delegateEvents(),e.append(t.el)})},save_settings:function(){if(!this.modules)return;var e=this;this.modules.each(function(e){e.fields.size()>0&&e.save_fields()})}});return t}),define("scripts/upfront/preset-settings/state-settings",["scripts/upfront/settings/modules-container"],function(e){var t=e.extend({onInitialize:function(e){this.options.state!=="Global"?this.$el.addClass("state_modules state_settings state_settings_"+this.options.state.toLowerCase()):this.$el.addClass("state_modules global_modules")}});return t}),define("scripts/upfront/settings/modules/edit-preset",["scripts/upfront/settings/modules/base-module","scripts/upfront/settings/fields/show-state","scripts/upfront/preset-settings/state-settings"],function(e,t,n){var r=Upfront.Settings.l10n.preset_manager,i=e.extend({className:"preset_specific",initialize:function(e){this.options=e||{},this.listenTo(this.model,"change",this.onPresetUpdate);var i=this,s=!1,o=!1;if(Upfront.Application.get_current()!==Upfront.Application.MODE.THEME&&this.options.model.get("theme_preset")===!0||this.options.model.get("id")==="default")if(Upfront.Application.get_current()===Upfront.Application.MODE.THEME||this.options.model.get("id")!=="default"&&this.options.model.get("theme_preset")!==!0)var u=[];else var u=[new Upfront.Views.Editor.Field.Button({model:this.model,label:"Reset",className:"delete_preset",compact:!0,on_click:function(){i.resetPreset()}})];else var u=[new Upfront.Views.Editor.Field.Button({model:this.model,label:r.delete_label,className:"delete_preset",compact:!0,on_click:function(){confirm("Are you sure to delete this preset?")&&i.deletePreset()}})];_.each(this.options.stateModules,function(e,t){if(t==="Global"){var r=new n({model:this.model,modules:e,state:t});u.push(r)}},this),_.each(this.options.stateModules,function(e,n){if(n!=="Global"){var r=new t({state:n});u.push(r),this.listenTo(r,"upfront:presets:state_show",this.showState),s||(s=r)}},this),_.each(this.options.stateModules,function(e,t){if(t!=="Global"){var r=new n({model:this.model,modules:e,state:t});u.push(r),o?r.$el.hide():o=r}},this),setTimeout(function(){i.$el.find(".state_settings_button").wrapAll('<div class="state_settings_button_wrapper">');var e=i.$el.find(".state_settings_button_wrapper");e.prev().hasClass("delete_preset")&&e.addClass("move-wrapper-top")},50),s&&s.$el.addClass("active"),o&&o.$el.show(),this.fields=_(u)},onPresetUpdate:function(){this.trigger("upfront:presets:update",this.model.toJSON())},deletePreset:function(){this.trigger("upfront:presets:delete",this.model)},resetPreset:function(){this.trigger("upfront:presets:reset",this.model)},showState:function(e){this.$el.find(".state_settings_button").removeClass("active"),this.$el.find(".state_settings_button_"+e).addClass("active"),this.$el.find(".state_settings").hide(),this.$el.find(".state_settings_"+e).show(),this.trigger("upfront:presets:state_show",e)}});return i}),define("scripts/upfront/settings/modules/migrate-preset",["scripts/upfront/settings/modules/base-module"],function(e){var t=Upfront.Settings.l10n.preset_manager,n=e.extend({className:"migrate-preset-overlay",initialize:function(e){this.options=e||{};var n=this,r=Upfront.Views.Editor.Field.Text.extend({get_field_html:function(){return""}}),i=Upfront.Views.Editor.Field.Chosen_Select.extend({className:"preset select-preset-field-overlay",render:function(){Upfront.Views.Editor.Field.Chosen_Select.prototype.render.call(this);var e=this,t=this.$el.find(".upfront-chosen-select").val();return this.$el.find(".upfront-chosen-select").chosen({search_contains:!0,width:"171px"}),this},get_value_html:function(e,t){var n="",r=this.get_saved_value()?this.get_saved_value():"default";return this.model.get_property_value_by_name("usingNewAppearanche")||(r=""),e.value===this.clear_preset_name(r)&&(n=' selected="selected"'),['<option value="',e.value,'"',n,">",e.label,"</option>"].join("")},clear_preset_name:function(e){return e=e.replace(" ","-"),e=e.replace(/[^-a-zA-Z0-9]/,""),e},on_change:function(e){this.trigger("change",this.get_value())}});this.selectPresetField=new i({model:this.model,label:"",values:this.get_presets(),change:function(e){}}),this.listenTo(this.selectPresetField,"change",this.previewPreset);var s=[new Upfront.Views.Editor.Settings.Item({model:this.model,className:"new-preset-module",fields:[new r({model:this.model,label:t.convert_preset_info,className:"migrate-preset-info migrate-info-icon"}),new r({model:this.model,label:t.select_preset_info,className:"migrate-preset-info"}),this.selectPresetField,new Upfront.Views.Editor.Field.Button({model:this.model,label:t.apply_label,className:"migrate-preset-apply",compact:!0,on_click:function(){n.trigger("upfront:presets:change",n.selectPresetField.get_value())}}),new r({model:this.model,label:t.save_as_preset_button_info,className:"migrate-preset-info save-as-preset-info"}),new Upfront.Views.Editor.Field.Button({model:this.model,label:t.convert_style_to_preset,className:"migrate-preset-button",compact:!0,on_click:function(){n.show_new_preset_fields()}}),new Upfront.Views.Editor.Field.Button({model:this.model,label:t.cancel_label,className:"new-preset-button-cancel",compact:!0,on_click:function(){n.hide_new_preset_fields()}}),new Upfront.Views.Editor.Field.Text({model:this.model,label:"",default_value:n.suggestPresetName(this.options.elementPreset),className:"new-preset-button-input"}),new Upfront.Views.Editor.Field.Button({model:this.model,label:t.ok_label,className:"new-preset-button-submit",compact:!0,on_click:function(){var e=n.$el.find(".new-preset-button-input input").val();if(e.trim()===""){alert(t.not_empty_label);return}if(e.match(/[^A-Za-z0-9 ]/)){alert(t.special_character_label);return}if(!e.match(/^[A-Za-z][A-Za-z0-9 ]*$/)){alert(t.invalid_preset_label);return}n.trigger("upfront:presets:new",e.trim())}})]})];setTimeout(function(){n.hide_new_preset_fields()},20),this.fields=_(s)},suggestPresetName:function(e){var n=this.capitalisePreset(e.replace(/-preset/,"")),r=n+t.preset,i=r,s=1,o=this.get_all_preset_names();while(0<o.indexOf(i))i=r+s,s++;return i},capitalisePreset:function(e){return e.charAt(0).toUpperCase()+e.slice(1).toLowerCase()},hide_new_preset_fields:function(){var e=this;e.$el.find(".new-preset-button-cancel").hide(),e.$el.find(".new-preset-button-input").hide(),e.$el.find(".new-preset-button-submit").hide(),e.$el.find(".migrate-preset-button").show(),e.$el.find(".existing-preset-overlay-layout").remove()},show_new_preset_fields:function(){var e=this;e.$el.find(".new-preset-button-cancel").show(),e.$el.find(".new-preset-button-input").show(),e.$el.find(".new-preset-button-submit").show(),e.$el.find(".migrate-preset-button").hide(),e.$el.find(".existing-preset-module").append('<div class="existing-preset-overlay-layout">&nbsp;</div>')},previewPreset:function(e){this.trigger("upfront:presets:preview",e)},get_all_preset_names:function(){var e=[];return _.each(this.options.presets.models,function(t){var n="undefined"==typeof t.get("name")?t.get("id"):t.get("name");e.push(n)}),e},get_presets:function(){var e=[{label:"No preset",value:""}];return _.each(this.options.presets.models,function(t){if(typeof t.get("legacy")!="undefined")return;"undefined"==typeof t.get("name")?e.push({label:t.get("id"),value:t.get("id")}):e.push({label:t.get("name"),value:t.get("id")})}),e}});return n}),function(e){define("scripts/upfront/preset-settings/preset-css-editor",["text!upfront/templates/popup.html"],function(t){var n=Upfront.Settings&&Upfront.Settings.l10n?Upfront.Settings.l10n.global.views:Upfront.mainData.l10n.global.views,r=Backbone.View.extend({className:"upfront-ui",id:"upfront-csseditor",tpl:_.template(e(t).find("#csseditor-tpl").html()),prepareAce:!1,ace:!1,events:{"click .upfront-css-save-ok":"save","click .upfront-css-close":"close","click .upfront-css-theme_image":"openThemeImagePicker","click .upfront-css-media_image":"openImagePicker","click .upfront-css-font":"startInsertFontWidget","click .upfront-css-selector":"addSelector","click .upfront-css-type":"scrollToElement","mouseenter .upfront-css-selector":"hiliteElement","mouseleave .upfront-css-selector":"unhiliteElement"},elementTypes:{UaccordionModel:{label:n.accordion,id:"accordion"},UcommentModel:{label:n.comments,id:"comment"},UcontactModel:{label:n.contact_form,id:"contact"},UgalleryModel:{label:n.gallery,id:"gallery",preset_container:"inline"},UimageModel:{label:n.image,id:"image"},LoginModel:{label:n.login,id:"upfront-login_element"},LikeBox:{label:n.like_box,id:"Like-box-object"},MapModel:{label:n.map,id:"upfront-map_element"},UnewnavigationModel:{label:n.navigation,id:"nav",preset_container:"inline"},ButtonModel:{label:n.button,id:"button",preset_container:"inline"},PostsModel:{label:n.posts,id:"posts",preset_container:"inline"},UsearchModel:{label:n.search,id:"search"},USliderModel:{label:n.slider,id:"slider"},SocialMediaModel:{label:n.social,id:"SocialMedia"},UtabsModel:{label:n.tabs,id:"tab",preset_container:"inline"},ThisPageModel:{label:n.page,id:"this_page"},ThisPostModel:{label:n.post,id:"this_post"},UwidgetModel:{label:n.widget,id:"widget"},UyoutubeModel:{label:n.youtube,id:"youtube"},PlainTxtModel:{label:n.text,id:"text",preset_container:"inline"}},postElementTypes:{post_data:{label:n.post_data,id:"post_data"},author:{label:n.author,id:"author"},featured_image:{label:n.featured_image,id:"featured_image"},taxonomy:{label:n.taxonomy,id:"taxonomy"},comments:{label:n.comments,id:"comments"},meta:{label:n.meta,id:"meta"}},initialize:function(t){var r=this,i=e.Deferred();this.options=t||{},this.model=t.model,this.sidebar=t.sidebar!==!1,this.global=t.global===!0,this.prepareAce=i.promise(),require(["//cdnjs.cloudflare.com/ajax/libs/ace/1.1.01/ace.js"],function(){i.resolve()}),this.resizeHandler=this.resizeHandler||function(){r.$el.width(e(window).width()-e("#sidebar-ui").width()-1)},Upfront.Events.on("element:settings:saved",this.close,this),Upfront.Events.on("element:settings:canceled",this.close,this),e(window).on("resize",this.resizeHandler),this.dataPartType=this.model.get_property_value_by_name("data_type"),this.modelType=this.options.model.get_property_value_by_name("type"),this.elementType=this.elementTypes[this.modelType]||{label:"Unknown",id:"unknown"},this.createSelectors(Upfront.Application.LayoutEditor.Objects),this.selectors=this.elementSelectors[this.modelType]||{},this.modelType==="PostDataModel"&&(this.elementType=this.postElementTypes[this.dataPartType]||{label:n.post_data,id:"post_data"},this.selectors=this.elementSelectors["post_"+this.dataPartType]||{}),this.element_id=t.element_id?t.element_id:this.model.get_property_value_by_name("element_id"),typeof t.change=="function"&&this.listenTo(this,"change",t.change);if(this.options.doNotRender===!0)return;this.render(),this.startResizable()},close:function(t){t&&t.preventDefault(),e(window).off("resize",this.resizeHandler),this.editor&&this.editor.destroy(),e("#page").css("padding-bottom",0),this.remove()},render:function(){var t=this;e("#page").append(this.$el),this.sidebar?this.$el.removeClass("upfront-css-no-sidebar"):this.$el.addClass("upfront-css-no-sidebar"),this.$el.html(this.tpl({name:this.stylename,elementType:this.elementType.label,selectors:this.selectors,show_style_name:!1,showToolbar:!0})),this.resizeHandler(".");var n=this.$el.height()-this.$(".upfront-css-top").outerHeight();this.$(".upfront-css-body").height(n),this.prepareAce.done(function(){t.startAce()}),this.prepareSpectrum(),this.$el.show()},renderCss:function(t){var n,r=this.get_css_selector();return n=this.stylesAddSelector(e.trim(t),"#page "+r),n=Upfront.Util.colors.convert_string_ufc_to_color(n.replace(new RegExp(Upfront.Util.preg_quote(this.get_css_selector())+" .upfront-button","g"),this.get_css_selector()+".upfront-button")),n},cleanUpStyles:function(e){if(!this.get_css_selector())return"";var t=new RegExp(Upfront.Util.preg_quote(this.get_css_selector())+"\\s*","g");return e=e.replace(new RegExp("#page "+Upfront.Util.preg_quote(this.get_css_selector())+"\\s*","g"),""),e=e.replace(t,""),e=e.replace(/\\'/g,"'"),e=e.replace(/\\'/g,"'"),e=e.replace(/\\'/g,"'"),e=e.replace(/\\"/g,'"'),e=e.replace(/\\"/g,'"'),e=e.replace(/\\"/g,'"'),e=e.replace(/\.tablet-breakpoint/g,""),e=e.replace(/\.mobile-breakpoint/g,""),e=e.replace(/#page/g,""),e=Upfront.Util.colors.convert_string_color_to_ufc(e.replace(/div#page.upfront-layout-view .upfront-editable_entity.upfront-module/g,"#page")),e},startAce:function(){var t=this,n=ace.edit(this.$(".upfront-css-ace")[0]),r=n.getSession();r.setUseWorker(!1),n.setShowPrintMargin(!1),r.setMode("ace/mode/css"),n.setTheme("ace/theme/monokai"),n.on("change",function(e){var r=t.renderCss(n.getValue());t.trigger("change",r)});var i=this.options.preset.get("preset_style")?this.options.preset.get("preset_style"):"";i=this.cleanUpStyles(i),n.setValue(e.trim(i),-1),n.renderer.scrollBar.width=5,n.renderer.scroller.style.right="5px",n.focus(),this.editor=n},prepareSpectrum:function(){var e=this,t=new Upfront.Views.Editor.Field.Color({default_value:"#ffffff",showAlpha:!0,showPalette:!0,maxSelectionSize:9,localStorageKey:"spectrum.recent_bgs",preferredFormat:"hex",chooseText:"Ok",showInput:!0,allowEmpty:!0,autohide:!1,spectrum:{show:function(){},choose:function(t){var n;t.get_is_theme_color()!==!1?n=t.theme_color:n=t.alpha<1?t.toRgbString():t.toHexString(),e.editor.insert(n),e.editor.focus()}}});t.render(),e.$(".upfront-css-color").html(t.el)},createSelectors:function(e){var t=this,n={};_.each(e,function(e){n[e.cssSelectorsId]=e.cssSelectors||{}}),t.elementSelectors=n},createSelector:function(e,t,n){var r=new e,i=new t({model:r});this.elementSelectors[n]=i.cssSelectors||{},i.remove()},startResizable:function(){var t=this,n=t.$(".upfront-css-body"),r=0,i=t.$(".upfront-css-selectors"),s=t.$(".upfront-css-save-form"),o=this.$(".upfront-css-resizable"),u=function(u,a){var f=a?a.size.height:t.$(".upfront-css-resizable").height(),l=f-r;n.height(l),t.editor&&t.editor.resize(),i.height(l-s.outerHeight()),o.css({width:"",height:"",left:"",top:""}),e("#page").css("padding-bottom",f)};o.find(".upfront-css-top").removeClass("ui-resizable-handle").addClass("ui-resizable-handle").removeClass("ui-resizable-n").addClass("ui-resizable-n"),r=t.$(".upfront-css-top").outerHeight(),u(),o.resizable({handles:{n:".upfront-css-top"},resize:u,minHeight:200,delay:100})},remove:function(){Backbone.View.prototype.remove.call(this),e(window).off("resize",this.resizeHandler)},openThemeImagePicker:function(){this._open_media_popup({themeImages:!0})},openImagePicker:function(){this._open_media_popup()},_open_media_popup:function(e){e=_.isObject(e)?e:{};var t=this,n=_.extend({},e);Upfront.Media.Manager.open(n).done(function(e,n){Upfront.Events.trigger("upfront:element:edit:stop");if(!n)return;if(n.length==0)return;var r=n.models[0],i=r.get("image")?r.get("image"):n.models[0],s="src"in i?i.src:"get"in i?i.get("original_url"):!1;t.editor.insert('url("'+s+'")'),t.editor.focus()})},startInsertFontWidget:function(){var t=new i({editor:this.editor,collection:Upfront.Views.Editor.Fonts.theme_fonts_collection});e("#insert-font-widget").html(t.render().el)},scrollToElement:function(){var t=e("#"+this.element_id);if(!t.length)return;var n=t.offset().top-50;e(document).scrollTop(n>0?n:0),this.blink(t,4)},hiliteElement:function(t){var n=this.get_css_selector();this.elementType.id!=="posts"&&(n+=" ");var r=n+e(t.target).data("selector");if(!r.length)return;var i=e("#"+this.element_id+r);i.addClass("upfront-css-hilite")},unhiliteElement:function(t){var n=this.get_css_selector();this.elementType.id!=="posts"&&(n+=" ");var r=n+e(t.target).data("selector");if(!r.length)return;var i=e("#"+this.element_id+r);i.removeClass("upfront-css-hilite")},addSelector:function(t){var n=e(t.target).data("selector");this.editor.insert(n),this.editor.focus()},get_css_selector:function(){if(this.is_global_stylesheet)return"";if(typeof this.options.preset.get("id")=="undefined"||!this.options.preset.get("id"))return"";var e="."+this.options.preset.get("id");return this.dataPartType&&(e=e+".upost-data-object-"+this.dataPartType),typeof this.elementType.preset_container=="undefined"&&(e+=" "),e},updateStyles:function(e){var t=this.get_style_element();Upfront.Util.Transient.push("css-"+this.element_id,t.html()),e=Upfront.Util.colors.convert_string_ufc_to_color(e),t.html(this.stylesAddSelector(e,this.is_default_style?"":"#page "+this.get_css_selector()).replace(/#page/g,"div#page.upfront-layout-view .upfront-editable_entity.upfront-module")),this.trigger("updateStyles",this.element_id)},stylesAddSelector:function(t,n){if(this.is_global_stylesheet&&empty(n))return t;var r=this,i=t.split("}"),s="";return _.each(i,function(t){var i=e.trim(t).split("{");if(i.length!=2)return!0;var o=i[0].split(","),u=[];_.each(o,function(t){t=e.trim(t);var i=t.replace(/:[^\s]+/,""),s=i[0]==="@"||r.recursiveExistence(n,i),o=s?"":" ";u.push(""+n+o+t+"")}),s+=u.join(", ")+" {"+i[1]+"\n}\n"}),s},recursiveExistence:function(t,n){var r=n.split(" "),i=this;while(r.length>0){try{if(!!e(t+r.join(" ")).closest("#"+i.element_id).length)return!0}catch(s){}r.pop()}return!1},save:function(t){t&&t.preventDefault();var r=this,i=e.trim(this.editor.getValue()),s;return this.is_global_stylesheet===!1&&this.stylename===this.get_temp_stylename()?Upfront.Views.Editor.notify(n.style_name_nag,"error"):Upfront.Views.Editor.notify(n.preset_style_saved.replace(/%s/,this.elementType.id))}}),i=Backbone.View.extend({initialize:function(e){var t=this;this.editor=e.editor,this.fields=[new Upfront.Views.Editor.Field.Typeface_Chosen_Select({label:"",compact:!0,values:Upfront.Views.Editor.Fonts.theme_fonts_collection.get_fonts_for_select(),additional_classes:"choose-typeface",select_width:"230px"}),new Upfront.Views.Editor.Field.Typeface_Style_Chosen_Select({label:"",compact:!0,values:[],additional_classes:"choose-variant",select_width:"120px"}),new Upfront.Views.Editor.Field.Button({label:n.insert_font,compact:!0,on_click:function(){t.finish()}})]},render:function(){return e("#insert-font-widget").html("").addClass("open"),this.$el.html(""),_.each(this.fields,function(e){e.render(),this.$el.append(e.el)},this),this.listenTo(this.fields[0],"changed",function(){var e=Upfront.Views.Editor.Fonts.theme_fonts_collection.get_variants(this.fields[0].get_value());this.render_variants(e)}),this.listenTo(this.fields[1],"changed",function(){this.preview_font()}),this},render_variants:function(e){var t=this.$el.find(".choose-variant select");t.find("option").remove(),t.append('<option value="">'+n.choose_variant+"</option>"),_.each(e,function(e){t.append('<option value="'+e+'">'+e+"</option>")}),t.trigger("chosen:updated")},preview_font:function(){this.replaceFont({font_family:this.fields[0].get_value(),variant:Upfront.Views.Font_Model.parse_variant(this.fields[1].get_value())})},replaceFont:function(e){var t;this.style_doc=this.editor.getSession().getDocument(),this.last_selected_font=e,this.font_family_range?this.font_family_range.end=this.end_point:this.font_family_range=this.editor.getSelection().getRange(),this.end_point=this.style_doc.replace(this.font_family_range,e.font_family),this.reset_properties(),t=[],e.variant.weight&&t.push("    font-weight: "+e.variant.weight+";"),e.variant.style&&t.push("    font-style: "+e.variant.style+";"),t.length>0&&this.style_doc.insertLines(this.font_family_range.start.row+1,t)},reset_properties:function(){var e,t,n;this.style_doc=this.editor.getSession().getDocument(),n={},e=this.font_family_range.start.row+1,t=this.style_doc.getLine(e);while(t.indexOf("}")<0){t.indexOf("font-weight")!==-1&&(n.weight=e,this.starting_weight||(this.starting_weight=t)),t.indexOf("font-style")!==-1&&(n.style=e,this.starting_style||(this.starting_style=t)),e++,t=this.style_doc.getLine(e);if(!t)break}n.weight&&n.style&&(n.weight>n.style?(this.style_doc.removeLines(n.weight,n.weight),this.style_doc.removeLines(n.style,n.style)):(this.style_doc.removeLines(n.style,n.style),this.style_doc.removeLines(n.weight,n.weight)),n.weight=!1,n.style=!1),n.weight&&this.style_doc.removeLines(n.weight,n.weight),n.style&&this.style_doc.removeLines(n.style,n.style)},finish:function(){e("#insert-font-widget").html('<a class="upfront-css-font" href="#">'+n.insert_font+"</a>").removeClass("open")}});return r})}(jQuery),define("scripts/upfront/settings/modules/preset-css",["scripts/upfront/settings/modules/base-module","scripts/upfront/preset-settings/preset-css-editor"],function(e,t){var n=Upfront.Settings.l10n.preset_manager,r=e.extend({className:"upfront-settings-css",events:{"click input[name=preset_css]":"openEditor"},initialize:function(t){var r=this;e.prototype.initialize.call(this,t),this.fields=_([new Upfront.Views.Editor.Field.Button({model:r.model,className:"edit_preset_label",compact:!0,label:n.edit_preset_label}),new Upfront.Views.Editor.Field.Button({model:r.model,className:"edit_preset_css",compact:!0,name:"preset_css",label:n.edit_preset_css})])},onPresetUpdate:function(e){this.trigger("upfront:presets:update",e)},updateCss:function(e,t,n){t.replace(/'/g,'"'),e.set({preset_style:t})},openEditor:function(e){var n=this;e.preventDefault(),Upfront.Events.trigger("entity:settings:beforedeactivate");var r=Upfront.Application.cssEditor.getElementType(this.model),i=r.label.toLowerCase()+"-preset-"+this.options.preset.get("id");this.presetCSSEditor=new t({model:this.model,preset:this.options.preset,stylename:i});var s=_.debounce(this.updateCss,1e3);this.listenTo(this.presetCSSEditor,"upfront:presets:update",this.onPresetUpdate),this.listenTo(this.presetCSSEditor,"change",function(e){s(n.options.preset,e,n)}),Upfront.Events.trigger("entity:settings:deactivate")}});return r}),function(e){define("scripts/upfront/preset-settings/util",[],function(){var t=function(e){return e.breakpoint&&e.breakpoint.tablet&&(e.tablet=[],_.each(e.breakpoint.tablet,function(t,n){e.tablet[n]=t})),e.breakpoint&&e.breakpoint.mobile&&(e.mobile=[],_.each(e.breakpoint.mobile,function(t,n){e.mobile[n]=t})),e},n=function(e,n,r){var i=Upfront.Util.template(n);return typeof e.preset_style!="undefined"&&(e.preset_style=e.preset_style.replace(/#page/g,"#page.upfront-layout-view .upfront-editable_entity.upfront-module"),r==="thispost"&&(e.preset_style=e.preset_style.replace(/.default/g,".default.upfront-this_post")),r==="ucomment"&&(e.preset_style=e.preset_style.replace(/.default/g,".default.upfront-comment")),e.preset_style=Upfront.Util.colors.convert_string_ufc_to_color(e.preset_style,!0)),i({properties:t(e)}).replace(/#page/g,"div#page.upfront-layout-view").replace(new RegExp(e.id+" .upfront-button","g"),e.id+".upfront-button").replace(/\\'/g,"'").replace(/\\'/g,"'").replace(/\\'/g,"'").replace(/\\"/g,'"').replace(/\\"/g,'"').replace(/\\"/g,'"')},r={generateCss:n,generatePresetsToPage:function(e,n){_.each(Upfront.mainData[e+"Presets"],function(i){r.updatePresetStyle(e,t(i),n)})},getPresetProperties:function(t,n){var r=Upfront.mainData[t+"Presets"]||[],i={};return e.each(r,function(e,t){if(!t||!t.id||n!==t.id)return!0;i=_.extend({},t)}),i},updatePresetStyle:function(t,r,i){var s=t+"-preset-"+r.id,o=_.extend({},r);_.each(o,function(e,t){Upfront.Util.colors.is_theme_color(e)&&(o[t]=e)}),e("style#"+s).length===0&&e("body").append('<style class="preset-style" id="'+s+'"></style>'),e("style#"+s).text(Upfront.Util.colors.convert_string_ufc_to_color(n(o,i,t),!0))}};return r})}(jQuery),function(e){define("scripts/upfront/preset-settings/preset-manager",["scripts/upfront/element-settings/root-settings-panel","scripts/upfront/settings/modules/select-preset","scripts/upfront/settings/modules/edit-preset","scripts/upfront/settings/modules/migrate-preset","scripts/upfront/settings/modules/preset-css","scripts/upfront/preset-settings/util","scripts/upfront/preset-settings/preset-css-editor"],function(t,n,r,i,s,o,u){var a=Upfront.Settings.l10n.preset_manager,f=t.extend({className:"uf-settings-panel upfront-settings_panel preset-manager-panel",initialize:function(e){var t=this;this.options=e,_.each(this.options,function(e,t){this[t]=e},this);var n=!1;_.each(Upfront.mainData[this.mainDataCollection],function(e,t){e.id==="default"&&(n=!0)}),n||(Upfront.mainData[this.mainDataCollection]=_.isArray(Upfront.mainData[this.mainDataCollection])?Upfront.mainData[this.mainDataCollection]:[],Upfront.mainData[this.mainDataCollection].unshift(this.getPresetDefaults("default"))),this.presets=new Backbone.Collection(Upfront.mainData[this.mainDataCollection]||[]);var r=function(e){Upfront.Util.post({action:"upfront_save_"+this.ajaxActionSlug+"_preset",data:e}).done(function(){t.model.trigger("preset:updated",e.id)})};this.debouncedSavePreset=_.debounce(r,1e3),this.createBackup(),this.defaultOverlay(),this.listenToOnce(Upfront.Events,"element:settings:canceled",function(){this.updateCanceledPreset(this.backupPreset)}),this.listenToOnce(Upfront.Events,"upfront:layout_size:change_breakpoint",this.cancelPresetChanges)},createBackup:function(){var e=this.property("preset")?this.clear_preset_name(this.property("preset")):"default",t=this.presets.findWhere({id:e});typeof t=="undefined"&&(t=this.presets.findWhere({id:"default"})),typeof this.backupPreset=="undefined"&&(this.backupPreset=Upfront.Util.clone(t.toJSON()))},defaultOverlay:function(){var e=this,t=this.property("preset")?this.clear_preset_name(this.property("preset")):"default";t==="default"&&setTimeout(function(){e.$el.find(".preset_specific").next().andSelf().wrapAll('<div class="default-overlay-wrapper" />'),e.$el.find(".default-overlay-wrapper").append('<div class="default-overlay"><div class="overlay-title">'+a.default_overlay_title+"</div>"+'<div class="overlay-text">'+a.default_overlay_text+"</div>"+'<div class="overlay-button"><button type="button" class="overlay-button-input">'+a.default_overlay_button+"</button></div>"+"</div>"),e.$el.find(".delete_preset input").prop("disabled",!0),e.$el.find(".delete_preset input").css({opacity:.6})},100),this.$el.on("click",".overlay-button-input",function(t){t.preventDefault(),e.$el.find(".default-overlay").remove(),e.$el.find(".default-overlay-wrapper").css("min-height","30px"),e.$el.find(".delete_preset input").prop("disabled",!1),e.$el.find(".delete_preset input").css({opacity:1})})},updateMainDataCollectionPreset:function(e){var t;_.each(Upfront.mainData[this.mainDataCollection],function(n,r){n.id===e.id&&(t=r)}),typeof t!="undefined"?Upfront.mainData[this.mainDataCollection][t]=e:Upfront.mainData[this.mainDataCollection].push(e)},migratePresetProperties:function(e){return e},migrateElementStyle:function(e,t){return e},migrateDefaultStyle:function(e){return e},setupItems:function(){this.trigger("upfront:presets:setup-items",this);var e=this.clear_preset_name(this.model.decode_preset()||"default"),t=this.presets.findWhere({id:e}),o,u,a;typeof t=="undefined"&&(t=this.presets.findWhere({id:"default"})),this.selectPresetModule&&this.selectPresetModule.stopListening&&(this.selectPresetModule.stopListening(),this.stopListening(this.selectPresetModule)),this.selectPresetModule=new n({model:this.model,presets:this.presets}),this.options.hasBreakpointSettings===!0&&(o=Upfront.Views.breakpoints_storage.get_breakpoints().get_active(),u=t.get("breakpoint")||{},a=u[o.id]||{},_.each(this.options.breakpointSpecificPresetSettings,function(e){if(!_.isUndefined(a[e.name])){var n={};n[e.name]=a[e.name],t.set(n,{silent:!0})}},this)),this.editPresetModule&&this.editPresetModule.stopListening&&(this.editPresetModule.stopListening(),this.stopListening(this.editPresetModule)),this.editPresetModule=new r({model:t,stateModules:this.stateModules}),this.presetCssModule&&this.presetCssModule.stopListening&&(this.presetCssModule.stopListening(),this.stopListening(this.presetCssModule)),this.presetCssModule=new s({model:this.model,preset:t}),this.migratePresetModule=new i({model:this.model,presets:this.presets,elementPreset:this.styleElementPrefix}),this.listenTo(this.selectPresetModule,"upfront:presets:new",this.createPreset),this.listenTo(this.selectPresetModule,"upfront:presets:change",this.changePreset),this.listenTo(this.editPresetModule,"upfront:presets:delete",this.deletePreset),this.listenTo(this.editPresetModule,"upfront:presets:reset",this.resetPreset),this.listenTo(this.editPresetModule,"upfront:presets:update",this.updatePreset),this.listenTo(this.editPresetModule,"upfront:presets:state_show",this.stateShow),this.listenTo(this.presetCssModule,"upfront:presets:update",this.updatePreset),this.listenTo(this.selectPresetModule,"upfront:presets:migrate",this.migratePreset),this.listenTo(this.migratePresetModule,"upfront:presets:preview",this.previewPreset),this.listenTo(this.migratePresetModule,"upfront:presets:change",this.applyExistingPreset),this.listenTo(this.migratePresetModule,"upfront:presets:new",this.migratePreset),this.settings=_([this.selectPresetModule,this.editPresetModule,this.presetCssModule])},getTitle:function(){return"Appearance"},getPresetDefaultsMigration:function(e){var t=this.styleElementPrefix.replace(/-preset/,"");return t==="tab"||t==="accordion"||t==="contact"||t==="button"?_.extend({},{id:e.toLowerCase().replace(/ /g,"-"),name:e}):_.extend(this.presetDefaults,{id:e.toLowerCase().replace(/ /g,"-"),name:e})},getPresetDefaults:function(e){return _.extend(this.presetDefaults,{id:e.toLowerCase().replace(/ /g,"-"),name:e,preset_style:""})},updateCanceledPreset:function(e){o.updatePresetStyle(this.styleElementPrefix.replace(/-preset/,""),e,this.styleTpl),this.debouncedSavePreset(e),this.updateMainDataCollectionPreset(e)},updatePreset:function(e){var t,n,r,i;this.options.hasBreakpointSettings===!0&&(r=Upfront.Views.breakpoints_storage.get_breakpoints().get_active(),i=e.breakpoint||{},i[r.id]=i[r.id]||{},_.each(this.options.breakpointSpecificPresetSettings,function(t){i[r.id][t.name]=e[t.name],delete e[t.name]},this),e.breakpoint=i),o.updatePresetStyle(this.styleElementPrefix.replace(/-preset/,""),e,this.styleTpl),this.debouncedSavePreset(e),this.updateMainDataCollectionPreset(e)},migratePreset:function(t){var n=this.presets.findWhere({id:t.toLowerCase().replace(/ /g,"-")}),r="";if(typeof n!="undefined"){Upfront.Views.Editor.notify(a.preset_already_exist.replace(/%s/,t),"error");return}var i=this.property("theme_style");i||(i="_default"),i!=="_default"&&(Upfront.Application.cssEditor.init({model:this.model,stylename:"_default",no_render:!0}),r=e.trim(Upfront.Application.cssEditor.get_style_element().html().replace(/div#page.upfront-layout-view .upfront-editable_entity.upfront-module/g,"#page")),r=r.replace(/#page/g,""),r=this.migrateDefaultStyle(r),r=Upfront.Application.stylesAddSelectorMigration(e.trim(r),"#page ."+t.toLowerCase().replace(/ /g,"-"))),Upfront.Application.cssEditor.init({model:this.model,stylename:i,no_render:!0});var s=e.trim(Upfront.Application.cssEditor.get_style_element().html().replace(/div#page.upfront-layout-view .upfront-editable_entity.upfront-module/g,"#page"));s=s.replace(new RegExp(i,"g"),t.toLowerCase().replace(/ /g,"-")),i!=="_default"?s=r+s:(s=this.migrateDefaultStyle(s),s=Upfront.Application.stylesAddSelectorMigration(e.trim(s),"#page ."+t.toLowerCase().replace(/ /g,"-"))),s=this.migrateElementStyle(s,"#page ."+t.toLowerCase().replace(/ /g,"-")),newPreset=new Backbone.Model(this.getPresetDefaultsMigration(t)),typeof s!="undefined"&&newPreset.set({preset_style:s}),this.migratePresetProperties(newPreset),this.property("preset",newPreset.id),this.presets.add(newPreset),presetOptions=newPreset,properties=newPreset.toJSON(),this.property("theme_style",""),o.updatePresetStyle(this.styleElementPrefix.replace(/-preset/,""),properties,this.styleTpl),this.debouncedSavePreset(properties),this.updateMainDataCollectionPreset(properties),this.property("usingNewAppearance",!0),this.model.get("properties").trigger("change"),Upfront.Views.Editor.notify(a.preset_created.replace(/%s/,t)),this.render()},createPreset:function(e){var t=this.presets.findWhere({id:e.toLowerCase().replace(/ /g,"-")});if(typeof t!="undefined"){Upfront.Views.Editor.notify(a.preset_already_exist.replace(/%s/,e),"error");return}var n=this.getPresetDefaults(e);this.presets.add(n),this.model.set_property("preset",n.id),this.updatePreset(n),this.model.encode_preset(n.id),Upfront.Views.Editor.notify(a.preset_created.replace(/%s/,e)),this.render()},deletePreset:function(e){var t;Upfront.Util.post({data:e.toJSON(),action:"upfront_delete_"+this.ajaxActionSlug+"_preset"}),_.each(Upfront.mainData[this.mainDataCollection],function(n,r){n.id===e.get("id")&&(t=r)}),Upfront.mainData[this.mainDataCollection].splice(t,1),this.model.set_property("preset","default"),this.model.encode_preset("default"),this.presets.remove(e),this.render(),this.defaultOverlay()},resetPreset:function(e){var t,n=this;Upfront.Util.post({data:e.toJSON(),action:"upfront_reset_"+this.ajaxActionSlug+"_preset"}).success(function(t){var r=t.data;if(_.isEmpty(t.data)||t.data===!1)r=n.getPresetDefaults("default");o.updatePresetStyle(n.styleElementPrefix.replace(/-preset/,""),r,n.styleTpl),n.updateMainDataCollectionPreset(r),n.presets=new Backbone.Collection(Upfront.mainData[n.mainDataCollection]||[]),Upfront.Views.Editor.notify(a.preset_reset.replace(/%s/,e.get("id"))),n.$el.empty(),n.render()}).error(function(e){Upfront.Views.Editor.notify(e)})},applyExistingPreset:function(e){this.property("usingNewAppearance",!0),this.changePreset(e),this.defaultOverlay()},changePreset:function(e){this.stopListening(),this.model.set_property("theme_style",""),this.model.encode_preset(e),this.render(),this.defaultOverlay(),Upfront.Views.Editor.notify(a.preset_changed.replace(/%s/,e))},previewPreset:function(t){var n=this.property("element_id"),r=this.styleElementPrefix.replace(/-preset/,""),i=this.model.get_property_value_by_name("theme_style"),s;t===""&&i?e("#"+n).addClass(i):i&&(e("#"+n).removeClass(i),e("#"+n).find("."+i).removeClass(i)),r==="accordion"?(s=e("#"+n).find(".upfront-accordion-container"),s.removeClass(this.getPresetClasses(r)),t!==""?s.addClass(r+"-preset-"+t):s.addClass(r+"-preset-"+this.model.get_property_value_by_name("preset"))):r==="tab"?(s=e("#"+n).find(".upfront-tabs-container"),s.removeClass(this.getPresetClasses(r)),t!==""?s.addClass(r+"-preset-"+t):s.addClass(r+"-preset-"+this.model.get_property_value_by_name("preset"))):r==="button"?(s=e("#"+n).find(".upfront_cta"),s.removeClass(this.getPresetClasses(r)),t!==""?s.addClass(r+"-preset-"+t):s.addClass(r+"-preset-"+this.model.get_property_value_by_name("preset"))):_.contains(["image","text","gallery","slider","contact"],r)?(typeof this.actualModelData=="undefined"&&(this.actualModelData=Upfront.Util.model_to_json(this.model)),t!==""?(this.model.set_property("usingNewAppearance",!0,!0),this.model.set_property("theme_style","",!0),this.model.set_property("preset",t,!0),this.model.trigger("change"),this.previousPresetClass=t):(actualProperties=new Upfront.Collections.Properties(this.actualModelData.properties),actualProperties._events=this.model.get("properties")._events,this.model.set("properties",actualProperties),e(".upfront-active_entity").removeClass(this.previousPresetClass))):(e("#"+n).removeClass(this.getPresetClasses()),t!==""&&e("#"+n).addClass(t))},getPresetClasses:function(e){var t="";return _.map(this.presets.models,function(n){typeof e!="undefined"&&e?t+=e+"-preset-"+n.get("id")+" ":t+=n.get("id")+" "}),t},stateShow:function(e){this.trigger("upfront:presets:state_show",e)},getModifiedProperties:function(){return!0},migrateToDefault:function(){var e=this.getModifiedProperties(),t=this.property("usingNewAppearance");return!e&&!t&&(this.property("usingNewAppearance",!0),this.property("preset","default"),this.defaultOverlay()),!1},getBody:function(){this.setupItems();var t=e("<div />"),n=this;return this.migrateToDefault(),this.property("usingNewAppearance")!==!0&&(this.settings=_([this.migratePresetModule])),this.settings.each(function(e){e.panel||(e.panel=n),e.render(),t.append(e.el)}),t},clear_preset_name:function(e){return e=e.replace(" ","-"),e=e.replace(/[^-a-zA-Z0-9]/,""),e},property:function(e,t,n){return typeof t!="undefined"?(typeof n=="undefined"&&(n=!0),this.model.set_property(e,t,n)):this.model.get_property_value_by_name(e)},save_settings:function(){}});return f})}(jQuery),function(e){define("scripts/upfront/settings/root-modules-panel",["scripts/upfront/settings/modules-container","scripts/upfront/element-settings/root-panel-mixin"],function(t,n){var r=t.extend(_.extend({},n,{getBody:function(){var t=e("<div />");t.append('<div class="upfront-settings-item-content"></div>');var n=t.find(".upfront-settings-item-content");return this.modules.each(function(e){e.render(),e.delegateEvents(),n.append(e.el)}),t}}));return r})}(jQuery),define("scripts/upfront/element-settings/advanced-settings",["scripts/upfront/settings/root-modules-panel"],function(e){var t=e.extend({className:"uf-settings-panel upfront-settings_panel advanced-settings",modules:[{moduleType:"Padding"},{moduleType:"Anchor"}],getAdditionalModules:function(e){var t=_.contains(["UtabsView","UaccordionView","ButtonView"],this.model.get_property_value_by_name("view_class")),n;return t?(n=this.model.get_property_value_by_name("theme_style"),!n||n==="_default"?e:(e.unshift({moduleType:"ElementStyle"}),e)):e},title:"Advanced Settings"});return t}),function(e){define("scripts/upfront/element-settings/settings",["scripts/upfront/preset-settings/preset-manager","scripts/upfront/element-settings/advanced-settings"],function(e,t){var n=Upfront.Settings&&Upfront.Settings.l10n?Upfront.Settings.l10n.global.views:Upfront.mainData.l10n.global.views,r=Backbone.View.extend({id:"settings",events:{"click .upfront-save_settings":"saveSettings","click .upfront-cancel_settings":"cancelSettings"},initialize:function(n){this.options=n;var r=this,i={},s,o,u;this.hasBreakpointSettings===!0&&(s=Upfront.Views.breakpoints_storage.get_breakpoints().get_active(),o=this.model.get_property_value_by_name("breakpoint")||{},u=o[s.id]||{},_.each(this.breakpointSpecificSettings,function(e){_.isUndefined(u[e.name])||this.model.set_property(e.name,u[e.name],!0)},this)),_.each(this.panels,function(t,n){if(n==="Appearance"){this.appearancePanel=new e(_.extend({hasBreakpointSettings:this.hasBreakpointSettings,breakpointSpecificPresetSettings:this.breakpointSpecificPresetSettings,model:this.model},t)),this.listenTo(this.appearancePanel,"upfront:presets:state_show",this.stateShow),i.Appearance=this.appearancePanel;return}_.isFunction(t)&&(i[n]=new t({model:this.model}))},this),i.Advanced=new t({model:this.model}),this.panels=i,this.on("open",function(){r.model.trigger("settings:open",r)}),this.listenTo(Upfront.Events,"element:settings:render",this.setScrollMaxHeight)},saveSettings:function(){var e,t;this.removePreviewClasses(),this.hasBreakpointSettings===!0&&this.breakpointSpecificSettings&&(e=Upfront.Views.breakpoints_storage.get_breakpoints().get_active(),t=this.model.get_property_value_by_name("breakpoint")||{},t[e.id]=t[e.id]||{},_.each(this.breakpointSpecificSettings,function(n){t[e.id][n.name]=this.model.get_property_value_by_name(n.name),t[e.id].width=e.get("width")},this),this.model.set_property("breakpoint",t,!0)),_.each(this.panels,function(e){e.save_settings()}),this.model.get("properties").trigger("change"),Upfront.Events.trigger("element:settings:saved"),Upfront.Events.trigger("element:settings:deactivate"),Upfront.Application.is_builder()?Upfront.Events.trigger("command:layout:export_theme"):_upfront_post_data.layout.specificity&&_upfront_post_data.layout.item&&!_upfront_post_data.layout.item.match(/-page/)?Upfront.Events.trigger("command:layout:save_as"):Upfront.Events.trigger("command:layout:save"),this.onSaveSettings&&this.onSaveSettings()},cancelSettings:function(){this.removePreviewClasses(),Upfront.Events.trigger("element:settings:canceled")},stateShow:function(e){var t=this.for_view.$el.find(".upfront-object");e!=="static"?(this.removePreviewClasses(),t.addClass("live-preview-"+e)):this.removePreviewClasses()},removePreviewClasses:function(){var e=this.for_view.$el.find(".upfront-object");e.removeClass("live-preview-hover live-preview-focus live-preview-active")},render:function(){var e=this;this.$el.html('<div class="upfront-settings-title">'+this.title+'</div><div id="sidebar-scroll-wrapper" />'),Upfront.Events.trigger("settings:prepare"),_.each(this.panels,function(t){t.render(),t.parent_view=e,e.$el.find("#sidebar-scroll-wrapper").append(t.el)}),this.$el.addClass("upfront-ui"),this.$el.append("<div class='upfront-settings-button_panel'><button type='button' class='upfront-cancel_settings'>"+n.cancel+"</button>"+"<button type='button' class='upfront-save_settings'><i class='icon-ok'></i> "+n.save_element+"</button>"+"</div>")},setScrollMaxHeight:function(){var e=this.$el.height(),t=this.$el.find(">.upfront-settings-title").outerHeight(!0),n=this.$el.find(">.upfront-settings-button_panel").outerHeight(!0);this.$el.find("#sidebar-scroll-wrapper").css("max-height",e-t-n+"px")},cleanUp:function(){this.panels&&_.each(this.panels,function(e){e.cleanUp&&e.cleanUp()}),this.remove()}});return r})}(jQuery),define("text!elements/upfront-accordion/tpl/preset-style.html",[],function(){return"#page .upfront-accordion-container.accordion-preset-<?php echo $properties['id'] ?> .accordion-panel-title,\n#page .upfront-accordion-container.accordion-preset-<?php echo $properties['id'] ?> .accordion-panel-title p {\n	<?php if(!empty($properties['static-header-bg-color'])) { ?>background: <?php echo $properties['static-header-bg-color'] ?>; <?php } ?>\n	<?php if(!empty($properties['static-font-color'])) { ?>color: <?php echo $properties['static-font-color']  ?>; <?php } ?>\n	<?php if(!empty($properties['static-font-family'])) { ?>font-family: <?php echo $properties['static-font-family']  ?>; <?php } ?>\n	<?php if(!empty($properties['static-font-size'])) { ?>font-size: <?php echo $properties['static-font-size']  ?>px; <?php } ?>\n	<?php if(!empty($properties['static-weight'])) { ?>font-weight: <?php echo $properties['static-weight']  ?>;<?php } ?>\n	<?php if(!empty($properties['static-style'])) { ?>font-style: <?php echo $properties['static-style']  ?>;<?php } ?>\n	<?php if(!empty($properties['static-line-height'])) { ?>line-height: <?php echo $properties['static-line-height']  ?>;<?php } ?>\n	<?php if(!empty($properties['static-useborder'])) { ?>\n        <?php if(!empty($properties['static-borderwidth']) && !empty($properties['static-bordertype']) && !empty($properties['static-bordercolor'])) { ?>border: <?php echo $properties['static-borderwidth'] ?>px <?php echo $properties['static-bordertype'] ?> <?php echo $properties['static-bordercolor'] ?>;<?php } ?>\n    <?php } else { ?>\n        border: none;\n    <?php } ?>\n	<?php if(!empty($properties['hover-use-animation'])) { ?>\n		transition: all <?php echo $properties['hover-transition-duration']  ?>s <?php echo $properties['hover-transition-easing']  ?>;\n	<?php } else { ?>\n		transition: none;\n	<?php } ?>\n}\n\n#page .upfront-accordion-container.accordion-preset-<?php echo $properties['id'] ?> .accordion-panel-title:hover,\n#page .upfront-accordion-container.accordion-preset-<?php echo $properties['id'] ?> .accordion-panel-title:hover p,\n#page .upfront-accordion.<?php echo $properties['id']  ?>.live-preview-hover .upfront-accordion-container .accordion-panel-title {\n	<?php if(!empty($properties['hover-use-colors'])) { ?>\n		<?php if(!empty($properties['hover-header-bg-color'])) { ?>background: <?php echo $properties['hover-header-bg-color'] ?>; <?php } ?>\n	<?php } else { ?>\n		<?php if(!empty($properties['static-header-bg-color'])) { ?>background: <?php echo $properties['static-header-bg-color'] ?>; <?php } ?>\n	<?php } ?>\n	<?php if(!empty($properties['hover-use-typography'])) { ?>\n		<?php if(!empty($properties['hover-font-color'])) { ?>color: <?php echo $properties['hover-font-color']  ?>; <?php } ?>\n		<?php if(!empty($properties['hover-font-family'])) { ?>font-family: <?php echo $properties['hover-font-family']  ?>; <?php } ?>\n		<?php if(!empty($properties['hover-font-size'])) { ?>font-size: <?php echo $properties['hover-font-size']  ?>px; <?php } ?>\n		<?php if(!empty($properties['hover-weight'])) { ?>font-weight: <?php echo $properties['hover-weight']  ?>;<?php } ?>\n		<?php if(!empty($properties['hover-style'])) { ?>font-style: <?php echo $properties['hover-style']  ?>;<?php } ?>\n		<?php if(!empty($properties['hover-line-height'])) { ?>line-height: <?php echo $properties['hover-line-height']  ?>;<?php } ?>\n	<?php } else { ?>\n		<?php if(!empty($properties['static-font-color'])) { ?>color: <?php echo $properties['static-font-color']  ?>; <?php } ?>\n		<?php if(!empty($properties['static-font-family'])) { ?>font-family: <?php echo $properties['static-font-family']  ?>; <?php } ?>\n		<?php if(!empty($properties['static-font-size'])) { ?>font-size: <?php echo $properties['static-font-size']  ?>px; <?php } ?>\n		<?php if(!empty($properties['static-weight'])) { ?>font-weight: <?php echo $properties['static-weight']  ?>;<?php } ?>\n		<?php if(!empty($properties['static-style'])) { ?>font-style: <?php echo $properties['static-style']  ?>;<?php } ?>\n		<?php if(!empty($properties['static-line-height'])) { ?>line-height: <?php echo $properties['static-line-height']  ?>;<?php } ?>\n	<?php } ?>\n	<?php if(!empty($properties['hover-useborder'])) { ?>\n        <?php if(!empty($properties['hover-borderwidth']) && !empty($properties['hover-bordertype']) && !empty($properties['hover-bordercolor'])) { ?>border: <?php echo $properties['hover-borderwidth'] ?>px <?php echo $properties['hover-bordertype'] ?> <?php echo $properties['hover-bordercolor'] ?>;<?php } ?>\n    <?php } else { ?>\n        border: none;\n    <?php } ?>\n}\n\n#page .upfront-accordion-container.accordion-preset-<?php echo $properties['id'] ?> .accordion-panel-active .accordion-panel-title,\n#page .upfront-accordion-container.accordion-preset-<?php echo $properties['id'] ?> .accordion-panel-active .accordion-panel-title p,\n#page .upfront-accordion.<?php echo $properties['id']  ?>.live-preview-active .upfront-accordion-container .accordion-panel-title {\n	<?php if(!empty($properties['active-use-color'])) { ?>\n		<?php if(!empty($properties['active-header-bg-color'])) { ?>background: <?php echo $properties['active-header-bg-color'] ?>; <?php } ?>\n	<?php } else { ?>\n		<?php if(!empty($properties['static-header-bg-color'])) { ?>background: <?php echo $properties['static-header-bg-color'] ?>; <?php } ?>\n	<?php } ?>\n	<?php if(!empty($properties['active-use-typography'])) { ?>\n		<?php if(!empty($properties['active-font-color'])) { ?>color: <?php echo $properties['active-font-color']  ?>; <?php } ?>\n		<?php if(!empty($properties['active-font-family'])) { ?>font-family: <?php echo $properties['active-font-family']  ?>; <?php } ?>\n		<?php if(!empty($properties['active-font-size'])) { ?>font-size: <?php echo $properties['active-font-size']  ?>px; <?php } ?>\n		<?php if(!empty($properties['active-weight'])) { ?>font-weight: <?php echo $properties['active-weight']  ?>;<?php } ?>\n		<?php if(!empty($properties['active-style'])) { ?>font-style: <?php echo $properties['active-style']  ?>;<?php } ?>\n		<?php if(!empty($properties['active-line-height'])) { ?>line-height: <?php echo $properties['active-line-height']  ?>;<?php } ?>\n	<?php } else { ?>\n		<?php if(!empty($properties['static-font-color'])) { ?>color: <?php echo $properties['static-font-color']  ?>; <?php } ?>\n		<?php if(!empty($properties['static-font-family'])) { ?>font-family: <?php echo $properties['static-font-family']  ?>; <?php } ?>\n		<?php if(!empty($properties['static-font-size'])) { ?>font-size: <?php echo $properties['static-font-size']  ?>px; <?php } ?>\n		<?php if(!empty($properties['static-weight'])) { ?>font-weight: <?php echo $properties['static-weight']  ?>;<?php } ?>\n		<?php if(!empty($properties['static-style'])) { ?>font-style: <?php echo $properties['static-style']  ?>;<?php } ?>\n		<?php if(!empty($properties['static-line-height'])) { ?>line-height: <?php echo $properties['static-line-height']  ?>;<?php } ?>\n	<?php } ?>\n	<?php if(!empty($properties['active-useborder'])) { ?>\n        <?php if(!empty($properties['active-borderwidth']) && !empty($properties['active-bordertype']) && !empty($properties['active-bordercolor'])) { ?>border: <?php echo $properties['active-borderwidth'] ?>px <?php echo $properties['active-bordertype'] ?> <?php echo $properties['active-bordercolor'] ?>;<?php } ?>\n    <?php } else { ?>\n        border: none;\n    <?php } ?>\n	transition: none;\n}\n#page .upfront-accordion-container.accordion-preset-<?php echo $properties['id'] ?> .accordion-panel-content,\n#page .upfront-accordion-container.accordion-preset-<?php echo $properties['id'] ?> .accordion-panel-content p {\n	<?php if (!empty($properties['active-content-bg-color'])) { ?>\n		background: <?php echo $properties['active-content-bg-color'] ?>;\n	<?php } ?>\n	<?php if(!empty($properties['global-useborder'])) { ?>\n        <?php if(!empty($properties['global-borderwidth']) && !empty($properties['global-bordertype']) && !empty($properties['global-bordercolor'])) { ?>border: <?php echo $properties['global-borderwidth'] ?>px <?php echo $properties['global-bordertype'] ?> <?php echo $properties['global-bordercolor'] ?>;<?php } ?>\n	<?php } ?>\n}\n#page .upfront-accordion-container.accordion-preset-<?php echo $properties['id'] ?> .accordion-panel-title:after {\n	border-top-color: <?php echo $properties['static-triangle-icon-color'] ?>;\n	border-left-color: transparent;\n}\n#page .upfront-accordion-container.accordion-preset-<?php echo $properties['id'] ?> .accordion-panel-title:hover:after {\n	<?php if(!empty($properties['hover-use-colors'])) { ?>\n	border-top-color: <?php echo $properties['hover-triangle-icon-color'] ?>;\n	<?php } else { ?>\n	border-top-color: <?php echo $properties['static-triangle-icon-color'] ?>;\n	<?php } ?>\n	border-left-color: transparent;\n}\n#page .upfront-accordion-container.accordion-preset-<?php echo $properties['id'] ?> .accordion-panel-active .accordion-panel-title:after {\n	border-top-color: transparent;\n	<?php if(!empty($properties['active-use-color'])) { ?>\n		border-left-color: <?php echo $properties['active-triangle-icon-color'] ?>;\n	<?php } else { ?>\n		border-left-color: <?php echo $properties['static-triangle-icon-color'] ?>;\n	<?php } ?>\n}\n\n<?php if(!empty($properties['preset_style'])) { ?><?php echo $properties['preset_style'] ?><?php } ?>\n"}),define("elements/upfront-accordion/js/settings",["scripts/upfront/element-settings/settings","scripts/upfront/preset-settings/util","text!elements/upfront-accordion/tpl/preset-style.html"],function(e,t,n){var r=Upfront.Settings.l10n.accordion_element,i=e.extend({panels:{Appearance:{mainDataCollection:"accordionPresets",styleElementPrefix:"accordion-preset",ajaxActionSlug:"accordion",panelTitle:r.settings,styleTpl:n,presetDefaults:Upfront.mainData.presetDefaults.accordion,stateModules:{Global:[{moduleType:"Colors",options:{title:r.content_area_colors_label,multiple:!1,single:!0,abccolors:[{name:"active-content-bg-color",label:r.content_area_bg_label}]}},{moduleType:"Border",options:{state:"static",title:"",fields:{use:"global-useborder",width:"global-borderwidth",type:"global-bordertype",color:"global-bordercolor"}}}],Static:[{moduleType:"Colors",toggle:!1,options:{title:r.colors_label,abccolors:[{name:"static-header-bg-color",label:r.header_bg_label},{name:"static-triangle-icon-color",label:r.triangle_icon_label}]}},{moduleType:"Typography",toggle:!1,options:{state:"static",title:r.typography_tab_label,fields:{typeface:"static-font-family",fontstyle:"static-font-style",weight:"static-weight",style:"static-style",size:"static-font-size",line_height:"static-line-height",color:"static-font-color"}}},{moduleType:"Border",options:{state:"static",title:"",fields:{use:"static-useborder",width:"static-borderwidth",type:"static-bordertype",color:"static-bordercolor"}}}],Hover:[{moduleType:"Colors",options:{title:r.colors_label,toggle:!0,prepend:"hover-",prefix:"static",fields:{use:"hover-use-colors"},abccolors:[{name:"hover-header-bg-color",label:r.header_bg_label},{name:"hover-triangle-icon-color",label:r.triangle_icon_label}]}},{moduleType:"Typography",options:{state:"hover",toggle:!0,prepend:"hover-",prefix:"static",title:r.typography_tab_label,fields:{use:"hover-use-typography",typeface:"hover-font-family",fontstyle:"hover-font-style",weight:"hover-weight",style:"hover-style",size:"hover-font-size",line_height:"hover-line-height",color:"hover-font-color"}}},{moduleType:"Border",options:{state:"hover",title:"",prepend:"hover-",prefix:"static",fields:{use:"hover-useborder",width:"hover-borderwidth",type:"hover-bordertype",color:"hover-bordercolor"}}},{moduleType:"HovAnimation",options:{state:"hover",title:"",toggle:!0,fields:{use:"hover-use-animation",duration:"hover-transition-duration",easing:"hover-transition-easing"}}}],Active:[{moduleType:"Colors",options:{title:r.colors_label,toggle:!0,prepend:"active-",prefix:"static",fields:{use:"active-use-color"},abccolors:[{name:"active-header-bg-color",label:r.header_bg_label},{name:"active-triangle-icon-color",label:r.triangle_icon_label}]}},{moduleType:"Typography",options:{state:"active",toggle:!0,prepend:"active-",prefix:"static",title:r.typography_tab_label,fields:{use:"active-use-typography",typeface:"active-font-family",fontstyle:"active-font-style",weight:"active-weight",style:"active-style",size:"active-font-size",line_height:"active-line-height",color:"active-font-color"}}},{moduleType:"Border",options:{state:"active",title:"",prepend:"active-",prefix:"static",fields:{use:"active-useborder",width:"active-borderwidth",type:"active-bordertype",color:"active-bordercolor"}}}]},migrateDefaultStyle:function(e){return e=e.replace(/(div)?\.upfront-accordion\s/g,""),e=e.replace(/(div)?\.upfront-object\s/g,""),e=e.replace(/(div)?\.upfront-accordion-container\s/g,""),e=e.replace(/(div)?\.accordion-panel\s/g,""),e},migrateElementStyle:function(e,t){var n=new RegExp(t.replace(".","."),"g");return e=e.replace(n,t+" .upfront-accordion-container "),e},migratePresetProperties:function(e){var t=this.property("preset")?this.clear_preset_name(this.property("preset")):"default",n=this.presets.findWhere({id:t}),r={};typeof n!="undefined"&&_.each(n.attributes,function(e,t){if(t==="id"||t==="name"||t==="preset_style"||t==="legacy")return;r[t]=e}),e.set(r)}}},title:"Accordion Settings"});return t.generatePresetsToPage("accordion",n),i}),define("text!elements/upfront-accordion/tpl/uaccordion.html",[],function(){return'<div class="upfront-accordion-container accordion-preset-<?php echo $preset ?>">\r\n	<div class="upfront-accordion-wrap">\r\n        <!-- <b class="upfront-entity_meta upfront-ui">\r\n            <a href="#" class="upfront-icon-button upfront-icon-button-accordion-add-panel accordion-add-panel"></a>\r\n        </b> -->\r\n        <?php for ($i = 0; $i < $accordion_count; $i++) { ?>\r\n        <div class="accordion-panel <?php if($i === 0) { ?>accordion-panel-active<?php } ?>">\r\n            <div class="accordion-panel-title" id="title_<?php echo $element_id ?>-<?php echo $i ?>"><?php echo $accordion[$i][\'title\'] ?></div>\r\n            <div id="<?php echo $element_id ?>-<?php echo $i ?>" class="accordion-panel-content"><?php echo $accordion[$i][\'content\'] ?></div>\r\n            <i>x</i>\r\n        </div>\r\n        <?php } ?>\r\n    </div>\r\n</div>\r\n'}),function(e){define("uaccordion",["elements/upfront-accordion/js/model","elements/upfront-accordion/js/element","elements/upfront-accordion/js/settings","scripts/upfront/preset-settings/util","text!elements/upfront-accordion/tpl/uaccordion.html","text!elements/upfront-accordion/tpl/preset-style.html"],function(t,n,r,i,s,o){var u=Upfront.Settings.l10n.accordion_element,a=Upfront.Views.ObjectView.extend({model:t,currentEditItem:"",accordionTpl:Upfront.Util.template(s),elementSize:{width:0,height:0},initialize:function(){this.model instanceof t||(this.model=new t({properties:this.model.get("properties")})),this.events=_.extend({},this.events,{"click .accordion-panel-title":"onPanelTitleClick","dblclick .accordion-panel-title":"onPanelTitleDblClick","click i":"deletePanel"}),this.delegateEvents(),this.model.get("properties").bind("change",this.render,this),this.model.get("properties").bind("change",this.handle_visual_padding_hint,this),this.model.get("properties").bind("add",this.render,this),this.model.get("properties").bind("remove",this.render,this),this.listenTo(Upfront.Events,"theme_colors:update",this.update_colors,this)},update_colors:function(){var e=this,t=this.model.get_property_value_by_name("preset"),n=i.getPresetProperties("accordion",t)||{};if(_.size(n)<=0)return!1;i.updatePresetStyle("accordion",n,o)},addPanel:function(t){t.preventDefault(),this.property("accordion").push({title:u.panel_label+" "+(1+this.property("accordion_count")),content:e.trim(u.content_label.replace("</p>"," "+(1+this.property("accordion_count")+"</p>")))}),this.property("accordion_count",this.property("accordion").length,!1)},deletePanel:function(t){var n=e(t.currentTarget),r=n.parents(".accordion-panel"),i=r.index();this.property("accordion").splice(i,1),this.property("accordion_count",this.property("accordion_count")-1,!1)},onPanelTitleClick:function(t){var n=e(t.currentTarget),r=n.closest(".accordion-panel");r.hasClass("accordion-panel-active")||(this.$el.find(".accordion-panel-content").each(function(){var t=e(this).data("ueditor");t&&t.stop()}),r.addClass("accordion-panel-active").find(".accordion-panel-content").slideDown(),r.siblings().removeClass("accordion-panel-active").find(".accordion-panel-content").slideUp())},onPanelTitleDblClick:function(e){var t=this.$el.find(".accordion-panel-active"),n=t.find(".accordion-panel-title"),r=n.data("ueditor");r&&r.start&&!r.active&&r.start()},save_panel_content:function(){var e=this.$el.find(".accordion-panel-active"),t=e.index(),n=e.find(".accordion-panel-content"),r=e.find(".accordion-panel-title"),i=n.data("ueditor"),s=r.data("ueditor"),o="",u="";try{o=i.getValue(!0)}catch(a){o=""}try{u=s.getValue(!0)}catch(a){u=""}this.property("accordion")[t].content=o||n.html(),this.property("accordion")[t].title=u||r.html()},get_content_markup:function(){var e=this.extract_properties();return e.preset=e.preset||"default",e.show_add=!0,e.show_remove=this.property("accordion_count")>1?!0:!1,this.accordionTpl(e)},extract_properties:function(){var e={};return this.model.get("properties").each(function(t){e[t.get("name")]=t.get("value")}),e},on_render:function(){var t=1,n=this;this.$el.find(".accordion-panel-title").each(function(){var r=e(this);if(r.data("ueditor"))return!0;r.ueditor({linebreaks:!1,disableLineBreak:!0,airButtons:!1,placeholder:"Panel "+t}).on("start",function(){Upfront.Events.trigger("upfront:element:edit:start","text")}).on("stop",function(){n.save_panel_content(),n.render(),Upfront.Events.trigger("upfront:element:edit:stop")}).on("syncAfter",function(){n.save_panel_content()}).on("keydown",function(e){if(13===e.which)return!1;e.which===9&&(e.preventDefault(),n.editContent())}).addClass("uf-click-to-edit-text"),r.data("ueditor").stop(),t++}),n.$el.find(".accordion-panel-content").each(function(){var t=e(this);if(t.data("ueditor"))return!0;t.ueditor({linebreaks:!1,autostart:!1,paragraphize:!1,focus:!1,placeholder:!1}).on("start",function(){Upfront.Events.trigger("upfront:element:edit:start")}).on("syncAfter",function(){n.save_panel_content()}).on("stop",function(){n.save_panel_content(),n.render(),Upfront.Events.trigger("upfront:element:edit:stop")})}),this.$el.find(".accordion-panel:not(.accordion-panel-active) .accordion-panel-content").hide()},editContent:function(){this.$el.find(".accordion-panel-active .accordion-panel-content").data("ueditor").start(),setTimeout(function(){Upfront.Events.trigger("upfront:element:edit:start")},250)},addTooltips:function(){e(".accordion-panel").each(function(){var t=e(this).find("span")[0];t.offsetWidth<t.scrollWidth&&e(this).attr("title",e(t).text().trim())})},property:function(e,t,n){return typeof t!="undefined"?(typeof n=="undefined"&&(n=!0),this.model.set_property(e,t,n)):this.model.get_property_value_by_name(e)},getControlItems:function(){return _([this.createControl("add",u.add_panel,"addPanel"),this.createPaddingControl(),this.createControl("settings",u.settings,"on_settings_click")])}});Upfront.Application.LayoutEditor.add_object("Uaccordion",{Model:t,View:a,Element:n,Settings:r,anchor:{is_target:!1},cssSelectors:{".accordion-panel":{label:u.css.containers_label,info:u.css.containers_info},".accordion-panel-title":{label:u.css.header_label,info:u.css.header_info},".accordion-panel-active .accordion-panel-title":{label:u.css.active_header_label,info:u.css.active_header_info},".accordion-panel-content":{label:u.css.body_label,info:u.css.body_info},".accordion-panel:first-of-type":{label:u.css.first_label,info:u.css.first_info},".accordion-panel:last-child":{label:u.css.last_label,info:u.css.last_info},".accordion-panel:nth-child(2n+3)":{label:u.css.odd_label,info:u.css.odd_info},".accordion-panel:nth-child(2n)":{label:u.css.even_label,info:u.css.even_info},".upfront-accordion-wrap":{label:u.css.wrap,info:u.css.wrap_info}},cssSelectorsId:Upfront.data.uaccordion.defaults.type}),Upfront.Models.UaccordionModel=t,Upfront.Views.UaccordionView=a})}(jQuery),function(e){"use strict";function i(e,t){return new i.prototype.init(e,t)}Function.prototype.bind||(Function.prototype.bind=function(e){var t=this;return function(){return t.apply(e)}});var t=0,n=/https?:\/\/(?:[0-9A-Z-]+\.)?(?:youtu\.be\/|youtube\.com\S*[^\w\-\s])([\w\-]{11})(?=[^\w\-]|$)(?![?=&+%\w.\-]*(?:['"][^<>]*>|<\/a>))[?=&+%\w.-]*/ig,r=/https?:\/\/(www\.)?vimeo.com\/(\d+)($|\/)/;e.fn.redactor=function(t){var n=[],r=Array.prototype.slice.call(arguments,1);return typeof t=="string"?this.each(function(){var i=e.data(this,"redactor"),s;t.search(/\./)!="-1"?(s=t.split("."),typeof i[s[0]]!="undefined"&&(s=i[s[0]][s[1]])):s=i[t];if(typeof i!="undefined"&&e.isFunction(s)){var o=s.apply(i,r);o!==undefined&&o!==i&&n.push(o)}else e.error('No such method "'+t+'" for Redactor')}):this.each(function(){e.data(this,"redactor",{}),e.data(this,"redactor",i(this,t))}),n.length===0?this:n.length===1?n[0]:n},e.Redactor=i,e.Redactor.VERSION="10.0.9",e.Redactor.modules=["alignment","autosave","block","buffer","build","button","caret","clean","code","core","dropdown","file","focus","image","indent","inline","insert","keydown","keyup","lang","line","link","list","modal","observe","paragraphize","paste","placeholder","progress","selection","shortcuts","tabifier","tidy","toolbar","upload","utils"],e.Redactor.opts={lang:"en",direction:"ltr",plugins:!1,focus:!1,focusEnd:!1,placeholder:!1,visual:!0,tabindex:!1,minHeight:!1,maxHeight:!1,linebreaks:!1,replaceDivs:!0,paragraphize:!0,cleanStyleOnEnter:!1,enterKey:!0,cleanOnPaste:!0,cleanSpaces:!0,pastePlainText:!1,autosave:!1,autosaveName:!1,autosaveInterval:60,autosaveOnChange:!1,autosaveFields:!1,linkTooltip:!0,linkProtocol:"http",linkNofollow:!1,linkSize:50,imageEditable:!0,imageLink:!0,imagePosition:!0,imageFloatMargin:"10px",imageResizable:!0,imageUpload:null,imageUploadParam:"file",uploadImageField:!1,dragImageUpload:!0,fileUpload:null,fileUploadParam:"file",dragFileUpload:!0,s3:!1,convertLinks:!0,convertUrlLinks:!0,convertImageLinks:!0,convertVideoLinks:!0,preSpaces:4,tabAsSpaces:!1,tabKey:!0,scrollTarget:!1,toolbar:!0,toolbarFixed:!0,toolbarFixedTarget:document,toolbarFixedTopOffset:0,toolbarExternal:!1,toolbarOverflow:!1,source:!0,buttons:["html","formatting","bold","italic","deleted","unorderedlist","orderedlist","outdent","indent","image","file","link","alignment","horizontalrule"],buttonsHide:[],buttonsHideOnMobile:[],formatting:["p","blockquote","pre","h1","h2","h3","h4","h5","h6"],formattingAdd:!1,tabifier:!0,deniedTags:["script","style"],allowedTags:!1,removeComments:!1,replaceTags:[["strike","del"]],replaceStyles:[["font-weight:\\s?bold","strong"],["font-style:\\s?italic","em"],["text-decoration:\\s?underline","u"],["text-decoration:\\s?line-through","del"]],removeDataAttr:!1,removeAttr:!1,allowedAttr:!1,removeWithoutAttr:["span"],removeEmpty:["p"],activeButtons:["deleted","italic","bold","underline","unorderedlist","orderedlist","alignleft","aligncenter","alignright","justify"],activeButtonsStates:{b:"bold",strong:"bold",i:"italic",em:"italic",del:"deleted",strike:"deleted",ul:"unorderedlist",ol:"orderedlist",u:"underline"},shortcuts:{"ctrl+shift+m, meta+shift+m":{func:"inline.removeFormat"},"ctrl+b, meta+b":{func:"inline.format",params:["bold"]},"ctrl+i, meta+i":{func:"inline.format",params:["italic"]},"ctrl+h, meta+h":{func:"inline.format",params:["superscript"]},"ctrl+l, meta+l":{func:"inline.format",params:["subscript"]},"ctrl+k, meta+k":{func:"link.show"},"ctrl+shift+7":{func:"list.toggle",params:["orderedlist"]},"ctrl+shift+8":{func:"list.toggle",params:["unorderedlist"]}},shortcutsAdd:!1,buffer:[],rebuffer:[],emptyHtml:"<p>&#x200b;</p>",invisibleSpace:"&#x200b;",imageTypes:["image/png","image/jpeg","image/gif"],indentValue:20,verifiedTags:["a","img","b","strong","sub","sup","i","em","u","small","strike","del","cite","ul","ol","li"],inlineTags:["strong","b","u","em","i","code","del","ins","samp","kbd","sup","sub","mark","var","cite","small"],alignmentTags:["P","H1","H2","H3","H4","H5","H6","DL","DT","DD","DIV","TD","BLOCKQUOTE","OUTPUT","FIGCAPTION","ADDRESS","SECTION","HEADER","FOOTER","ASIDE","ARTICLE"],blockLevelElements:["PRE","UL","OL","LI"],langs:{en:{html:"HTML",video:"Insert Video",image:"Insert Image",table:"Table",link:"Link",link_insert:"Insert link",link_edit:"Edit link",unlink:"Unlink",formatting:"Formatting",paragraph:"Normal text",quote:"Quote",code:"Code",header1:"Header 1",header2:"Header 2",header3:"Header 3",header4:"Header 4",header5:"Header 5",bold:"Bold",italic:"Italic",fontcolor:"Font Color",backcolor:"Back Color",unorderedlist:"Unordered List",orderedlist:"Ordered List",outdent:"Outdent",indent:"Indent",cancel:"Cancel",insert:"Insert",save:"Save",_delete:"Delete",insert_table:"Insert Table",insert_row_above:"Add Row Above",insert_row_below:"Add Row Below",insert_column_left:"Add Column Left",insert_column_right:"Add Column Right",delete_column:"Delete Column",delete_row:"Delete Row",delete_table:"Delete Table",rows:"Rows",columns:"Columns",add_head:"Add Head",delete_head:"Delete Head",title:"Title",image_position:"Position",none:"None",left:"Left",right:"Right",center:"Center",image_web_link:"Image Web Link",text:"Text",mailto:"Email",web:"URL",video_html_code:"Video Embed Code or Youtube/Vimeo Link",file:"Insert File",upload:"Upload",download:"Download",choose:"Choose",or_choose:"Or choose",drop_file_here:"Drop file here",align_left:"Align text to the left",align_center:"Center text",align_right:"Align text to the right",align_justify:"Justify text",horizontalrule:"Insert Horizontal Rule",deleted:"Deleted",anchor:"Anchor",link_new_tab:"Open link in new tab",underline:"Underline",alignment:"Alignment",filename:"Name (optional)",edit:"Edit",upload_label:"Drop file here or "}}},i.fn=e.Redactor.prototype={keyCode:{BACKSPACE:8,DELETE:46,DOWN:40,ENTER:13,SPACE:32,ESC:27,TAB:9,CTRL:17,META:91,SHIFT:16,ALT:18,RIGHT:39,LEFT:37,LEFT_WIN:91},init:function(n,r){this.$element=e(n),this.uuid=t++,this.rtePaste=!1,this.$pasteBox=!1,this.loadOptions(r),this.loadModules(),this.formatting={},e.merge(this.opts.blockLevelElements,this.opts.alignmentTags),this.reIsBlock=new RegExp("^("+this.opts.blockLevelElements.join("|")+")$","i"),this.tidy.setupAllowed();if(this.opts.deniedTags!==!1){var i=["html","head","link","body","meta","applet"];for(var s=0;s<i.length;s++)this.opts.deniedTags.push(i[s])}this.lang.load(),e.extend(this.opts.shortcuts,this.opts.shortcutsAdd),this.core.setCallback("start"),this.start=!0,this.build.run()},loadOptions:function(t){this.opts=e.extend({},e.extend(!0,{},e.Redactor.opts),this.$element.data(),t)},getModuleMethods:function(e){return Object.getOwnPropertyNames(e).filter(function(t){return typeof e[t]=="function"})},loadModules:function(){var t=e.Redactor.modules.length;for(var n=0;n<t;n++)this.bindModuleMethods(e.Redactor.modules[n])},bindModuleMethods:function(e){if(typeof this[e]=="undefined")return;this[e]=this[e]();var t=this.getModuleMethods(this[e]),n=t.length;for(var r=0;r<n;r++)this[e][t[r]]=this[e][t[r]].bind(this)},alignment:function(){return{left:function(){this.alignment.set("")},right:function(){this.alignment.set("right")},center:function(){this.alignment.set("center")},justify:function(){this.alignment.set("justify")},set:function(e){this.utils.browser("msie")||this.$editor.focus(),this.buffer.set(),this.selection.save(),this.alignment.blocks=this.selection.getBlocks(),this.alignment.type=e,this.alignment.isLinebreaksOrNoBlocks()?this.alignment.setText():this.alignment.setBlocks(),this.selection.restore(),this.code.sync()},setText:function(){var t=this.selection.wrap("div");e(t).attr("data-tagblock","redactor").css("text-align",this.alignment.type)},setBlocks:function(){e.each(this.alignment.blocks,e.proxy(function(e,t){var n=this.utils.getAlignmentElement(t);if(!n)return;this.alignment.isNeedReplaceElement(n)?this.alignment.replaceElement(n):this.alignment.alignElement(n)},this))},isLinebreaksOrNoBlocks:function(){return this.opts.linebreaks&&this.alignment.blocks[0]===!1},isNeedReplaceElement:function(e){return this.alignment.type===""&&typeof e.data("tagblock")!="undefined"},replaceElement:function(e){e.replaceWith(e.html())},alignElement:function(e){e.css("text-align",this.alignment.type),this.utils.removeEmptyAttr(e,"style")}}},autosave:function(){return{enable:function(){if(!this.opts.autosave)return;this.autosave.html=!1,this.autosave.name=this.opts.autosaveName?this.opts.autosaveName:this.$textarea.attr("name");if(this.opts.autosaveOnChange)return;this.autosaveInterval=setInterval(this.autosave.load,this.opts.autosaveInterval*1e3)},onChange:function(){if(!this.opts.autosaveOnChange)return;this.autosave.load()},load:function(){this.autosave.source=this.code.get();if(this.autosave.html===this.autosave.source)return;if(this.utils.isEmpty(this.autosave.source))return;var t={};t.name=this.autosave.name,t[this.autosave.name]=this.autosave.source,t=this.autosave.getHiddenFields(t);var n=e.ajax({url:this.opts.autosave,type:"post",data:t});n.done(this.autosave.success)},getHiddenFields:function(t){return this.opts.autosaveFields===!1||typeof this.opts.autosaveFields!="object"?t:(e.each(this.opts.autosaveFields,e.proxy(function(n,r){r!==null&&r.toString().indexOf("#")===0&&(r=e(r).val()),t[n]=r},this)),t)},success:function(t){var n;try{n=e.parseJSON(t)}catch(r){n=t}var i=typeof n.error=="undefined"?"autosave":"autosaveError";this.core.setCallback(i,this.autosave.name,n),this.autosave.html=this.autosave.source},disable:function(){clearInterval(this.autosaveInterval)}}},block:function(){return{formatting:function(e){this.block.clearStyle=!1;var t,n;typeof this.formatting[e].data!="undefined"?t="data":typeof this.formatting[e].attr!="undefined"?t="attr":typeof this.formatting[e]["class"]!="undefined"&&(t="class"),typeof this.formatting[e].clear!="undefined"&&(this.block.clearStyle=!0),t&&(n=this.formatting[e][t]),this.block.format(this.formatting[e].tag,t,n)},format:function(t,n,r){t=="quote"&&(t="blockquote");var i=["p","pre","blockquote","h1","h2","h3","h4","h5","h6"];if(e.inArray(t,i)==-1)return;this.block.isRemoveInline=t=="pre"||t.search(/h[1-6]/i)!=-1,this.utils.browser("msie")||this.$editor.focus(),this.block.blocks=this.selection.getBlocks(),this.block.blocksSize=this.block.blocks.length,this.block.type=n,this.block.value=r,this.buffer.set(),this.selection.save(),this.block.set(t),this.selection.restore(),this.code.sync()},set:function(e){this.selection.get(),this.block.containerTag=this.range.commonAncestorContainer.tagName,this.range.collapsed?this.block.setCollapsed(e):this.block.setMultiple(e)},setCollapsed:function(t){var n=this.block.blocks[0];if(n===!1)return;if(n.tagName=="LI"){if(t!="blockquote")return;this.block.formatListToBlockquote();return}var r=this.block.containerTag=="TD"||this.block.containerTag=="TH";if(r&&!this.opts.linebreaks)document.execCommand("formatblock",!1,"<"+t+">"),n=this.selection.getBlock(),this.block.toggle(e(n));else if(n.tagName.toLowerCase()!=t)if(this.opts.linebreaks&&t=="p")e(n).prepend("<br>").append("<br>"),this.utils.replaceWithContents(n);else{var i=this.utils.replaceToTag(n,t);this.block.toggle(i),t!="p"&&t!="blockquote"&&i.find("img").remove(),this.block.isRemoveInline&&this.utils.removeInlineTags(i),(t=="p"||this.block.headTag)&&i.find("p").contents().unwrap(),this.block.formatTableWrapping(i)}else if(t=="blockquote"&&n.tagName.toLowerCase()==t)if(this.opts.linebreaks)e(n).prepend("<br>").append("<br>"),this.utils.replaceWithContents(n);else{var s=this.utils.replaceToTag(n,"p");this.block.toggle(s)}else n.tagName.toLowerCase()==t&&this.block.toggle(e(n));typeof this.block.type=="undefined"&&typeof this.block.value=="undefined"&&e(n).removeAttr("class").removeAttr("style")},setMultiple:function(t){var n=this.block.blocks[0],r=this.block.containerTag=="TD"||this.block.containerTag=="TH";if(n!==!1&&this.block.blocksSize===1)if(n.tagName.toLowerCase()==t&&t=="blockquote")if(this.opts.linebreaks)e(n).prepend("<br>").append("<br>"),this.utils.replaceWithContents(n);else{var i=this.utils.replaceToTag(n,"p");this.block.toggle(i)}else if(n.tagName=="LI"){if(t!="blockquote")return;this.block.formatListToBlockquote()}else if(this.block.containerTag=="BLOCKQUOTE")this.block.formatBlockquote(t);else if(this.opts.linebreaks&&(r||this.range.commonAncestorContainer!=n))this.block.formatWrap(t);else if(this.opts.linebreaks&&t=="p")e(n).prepend("<br>").append("<br>"),this.utils.replaceWithContents(n);else if(n.tagName==="TD")this.block.formatWrap(t);else{var s=this.utils.replaceToTag(n,t);this.block.toggle(s),this.block.isRemoveInline&&this.utils.removeInlineTags(s),(t=="p"||this.block.headTag)&&s.find("p").contents().unwrap()}else if(this.opts.linebreaks||t!="p"){if(t=="blockquote"){var o=0;for(var u=0;u<this.block.blocksSize;u++)this.block.blocks[u].tagName=="BLOCKQUOTE"&&o++;if(o==this.block.blocksSize){e.each(this.block.blocks,e.proxy(function(t,n){var r=!1;this.opts.linebreaks?(e(n).prepend("<br>").append("<br>"),r=this.utils.replaceWithContents(n)):r=this.utils.replaceToTag(n,"p"),r&&typeof this.block.type=="undefined"&&typeof this.block.value=="undefined"&&r.removeAttr("class").removeAttr("style")},this));return}}this.block.formatWrap(t)}else{var a=0,f=!1;this.block.type=="class"&&(f="toggle",a=e(this.block.blocks).filter("."+this.block.value).length,this.block.blocksSize==a?f="toggle":this.block.blocksSize>a?f="set":a===0&&(f="set"));var l=["ul","ol","li","td","th","dl","dt","dd"];e.each(this.block.blocks,e.proxy(function(n,r){if(e.inArray(r.tagName.toLowerCase(),l)!=-1)return;var i=this.utils.replaceToTag(r,t);f?f=="toggle"?this.block.toggle(i):f=="remove"?this.block.remove(i):f=="set"&&this.block.setForce(i):this.block.toggle(i),t!="p"&&t!="blockquote"&&i.find("img").remove(),this.block.isRemoveInline&&this.utils.removeInlineTags(i),(t=="p"||this.block.headTag)&&i.find("p").contents().unwrap(),typeof this.block.type=="undefined"&&typeof this.block.value=="undefined"&&i.removeAttr("class").removeAttr("style")},this))}},setForce:function(e){this.block.clearStyle&&e.removeAttr("class").removeAttr("style");if(this.block.type=="class"){e.addClass(this.block.value);return}if(this.block.type=="attr"||this.block.type=="data"){e.attr(this.block.value.name,this.block.value.value);return}},toggle:function(e){this.block.clearStyle&&e.removeAttr("class").removeAttr("style");if(this.block.type=="class"){e.toggleClass(this.block.value);return}if(this.block.type=="attr"||this.block.type=="data"){e.attr(this.block.value.name)==this.block.value.value?e.removeAttr(this.block.value.name):e.attr(this.block.value.name,this.block.value.value);return}e.removeAttr("style class");return},remove:function(e){e.removeClass(this.block.value)},formatListToBlockquote:function(){var t=e(this.block.blocks[0]).closest("ul, ol");e(t).find("ul, ol").contents().unwrap(),e(t).find("li").append(e("<br>")).contents().unwrap();var n=this.utils.replaceToTag(t,"blockquote");this.block.toggle(n)},formatBlockquote:function(t){document.execCommand("outdent"),document.execCommand("formatblock",!1,t),this.clean.clearUnverified(),this.$editor.find("p:empty").remove();var n=this.selection.getBlock();t!="p"&&e(n).find("img").remove(),this.opts.linebreaks||this.block.toggle(e(n)),this.$editor.find("ul, ol, tr, blockquote, p").each(e.proxy(this.utils.removeEmpty,this)),this.opts.linebreaks&&t=="p"&&this.utils.replaceWithContents(n)},formatWrap:function(t){if(this.block.containerTag=="UL"||this.block.containerTag=="OL"){if(t!="blockquote")return;this.block.formatListToBlockquote()}var n=this.selection.wrap(t);if(n===!1)return;var r=e(n);this.block.formatTableWrapping(r);var i=r.find(this.opts.blockLevelElements.join(",")+", td, table, thead, tbody, tfoot, th, tr");(this.opts.linebreaks&&t=="p"||t=="pre"||t=="blockquote")&&i.append("<br />"),i.contents().unwrap(),t!="p"&&t!="blockquote"&&r.find("img").remove(),e.each(this.block.blocks,e.proxy(this.utils.removeEmpty,this)),r.append(this.selection.getMarker(2)),this.opts.linebreaks||this.block.toggle(r),this.$editor.find("ul, ol, tr, blockquote, p").each(e.proxy(this.utils.removeEmpty,this)),r.find("blockquote:empty").remove(),this.block.isRemoveInline&&this.utils.removeInlineTags(r),this.opts.linebreaks&&t=="p"&&this.utils.replaceWithContents(r)},formatTableWrapping:function(e){if(e.closest("table").length===0)return;e.closest("tr").length===0&&e.wrap("<tr>"),e.closest("td").length===0&&e.closest("th").length===0&&e.wrap("<td>")},removeData:function(t,n){var r=this.selection.getBlocks();e(r).removeAttr("data-"+t),this.code.sync()},setData:function(t,n){var r=this.selection.getBlocks();e(r).attr("data-"+t,n),this.code.sync()},toggleData:function(t,n){var r=this.selection.getBlocks();e.each(r,function(){e(this).attr("data-"+t)?e(this).removeAttr("data-"+t):e(this).attr("data-"+t,n)})},removeAttr:function(t,n){var r=this.selection.getBlocks();e(r).removeAttr(t),this.code.sync()},setAttr:function(t,n){var r=this.selection.getBlocks();e(r).attr(t,n),this.code.sync()},toggleAttr:function(t,n){var r=this.selection.getBlocks();e.each(r,function(){e(this).attr(name)?e(this).removeAttr(name):e(this).attr(name,n)})},removeClass:function(t){var n=this.selection.getBlocks();e(n).removeClass(t),this.utils.removeEmptyAttr(n,"class"),this.code.sync()},setClass:function(t){var n=this.selection.getBlocks();e(n).addClass(t),this.code.sync()},toggleClass:function(t){var n=this.selection.getBlocks();e(n).toggleClass(t),this.code.sync()}}},buffer:function(){return{set:function(e){typeof e=="undefined"||e=="undo"?this.buffer.setUndo():this.buffer.setRedo()},setUndo:function(){this.selection.save(),this.opts.buffer.push(this.$editor.html()),this.selection.restore()},setRedo:function(){this.selection.save(),this.opts.rebuffer.push(this.$editor.html()),this.selection.restore()},getUndo:function(){this.$editor.html(this.opts.buffer.pop())},getRedo:function(){this.$editor.html(this.opts.rebuffer.pop())},add:function(){this.opts.buffer.push(this.$editor.html())},undo:function(){if(this.opts.buffer.length===0)return;this.buffer.set("redo"),this.buffer.getUndo(),this.selection.restore(),setTimeout(e.proxy(this.observe.load,this),50)},redo:function(){if(this.opts.rebuffer.length===0)return;this.buffer.set("undo"),this.buffer.getRedo(),this.selection.restore(),setTimeout(e.proxy(this.observe.load,this),50)}}},build:function(){return{run:function(){this.build.createContainerBox(),this.build.loadContent(),this.build.loadEditor(),this.build.enableEditor(),this.build.setCodeAndCall()},isTextarea:function(){return this.$element[0].tagName==="TEXTAREA"},createContainerBox:function(){this.$box=e('<div class="redactor-box" />')},createTextarea:function(){this.$textarea=e("<textarea />").attr("name",this.build.getTextareaName())},getTextareaName:function(){return typeof name=="undefined"?"content-"+this.uuid:this.$element.attr("id")},loadContent:function(){var t=this.build.isTextarea()?"val":"html";this.content=e.trim(this.$element[t]())},enableEditor:function(){this.$editor.attr({contenteditable:!0,dir:this.opts.direction})},loadEditor:function(){var e=this.build.isTextarea()?"fromTextarea":"fromElement";this.build[e]()},fromTextarea:function(){this.$editor=e("<div />"),this.$textarea=this.$element,this.$box.insertAfter(this.$element).append(this.$editor).append(this.$element),this.$editor.addClass("redactor-editor"),this.$element.hide()},fromElement:function(){this.$editor=this.$element,this.build.createTextarea(),this.$box.insertAfter(this.$editor).append(this.$editor).append(this.$textarea),this.$editor.addClass("redactor-editor"),this.$textarea.hide()},setCodeAndCall:function(){this.code.set(this.content),this.build.setOptions(),this.build.callEditor();if(this.opts.visual)return;setTimeout(e.proxy(this.code.showCode,this),200)},callEditor:function(){this.build.disableMozillaEditing(),this.build.setEvents(),this.build.setHelpers(),this.opts.toolbar&&(this.opts.toolbar=this.toolbar.init(),this.toolbar.build()),this.modal.loadTemplates(),this.build.plugins(),setTimeout(e.proxy(this.observe.load,this),4),this.core.setCallback("init")},setOptions:function(){e(this.$textarea).attr("dir",this.opts.direction),this.opts.linebreaks&&this.$editor.addClass("redactor-linebreaks"),this.opts.tabindex&&this.$editor.attr("tabindex",this.opts.tabindex),this.opts.minHeight&&this.$editor.css("minHeight",this.opts.minHeight),this.opts.maxHeight&&this.$editor.css("maxHeight",this.opts.maxHeight)},setEventDropUpload:function(e){e.preventDefault();if(!this.opts.dragImageUpload||!this.opts.dragFileUpload)return;var t=e.dataTransfer.files;this.upload.directUpload(t[0],e)},setEventDrop:function(e){this.code.sync(),setTimeout(this.clean.clearUnverified,1),this.core.setCallback("drop",e)},setEvents:function(){this.$editor.on("drop.redactor",e.proxy(function(e){e=e.originalEvent||e;if(window.FormData===undefined||!e.dataTransfer)return!0;if(e.dataTransfer.files.length===0)return this.build.setEventDrop(e);this.build.setEventDropUpload(e),setTimeout(this.clean.clearUnverified,1),this.core.setCallback("drop",e)},this)),this.$editor.on("click.redactor",e.proxy(function(e){var t=this.core.getEvent(),n=t=="click"||t=="arrow"?!1:"click";this.core.addEvent(n),this.utils.disableSelectAll(),this.core.setCallback("click",e)},this)),this.$editor.on("paste.redactor",e.proxy(this.paste.init,this)),this.$editor.on("keydown.redactor",e.proxy(this.keydown.init,this)),this.$editor.on("keyup.redactor",e.proxy(this.keyup.init,this)),e.isFunction(this.opts.codeKeydownCallback)&&this.$textarea.on("keydown.redactor-textarea",e.proxy(this.opts.codeKeydownCallback,this)),e.isFunction(this.opts.codeKeyupCallback)&&this.$textarea.on("keyup.redactor-textarea",e.proxy(this.opts.codeKeyupCallback,this)),e.isFunction(this.opts.focusCallback)&&this.$editor.on("focus.redactor",e.proxy(this.opts.focusCallback,this));var t;e(document).on("mousedown",function(e){t=e.target}),this.$editor.on("blur.redactor",e.proxy(function(n){if(this.rtePaste)return;if(!this.build.isBlured(t))return;this.utils.disableSelectAll(),e.isFunction(this.opts.blurCallback)&&this.core.setCallback("blur",n)},this))},isBlured:function(t){var n=e(t);return!n.hasClass("redactor-toolbar, redactor-dropdown")&&!n.is("#redactor-modal")&&n.parents(".redactor-toolbar, .redactor-dropdown, #redactor-modal").length===0},setHelpers:function(){this.autosave.enable(),this.placeholder.enable(),this.opts.focus&&setTimeout(this.focus.setStart,100),this.opts.focusEnd&&setTimeout(this.focus.setEnd,100)},plugins:function(){if(!this.opts.plugins)return;if(!RedactorPlugins)return;e.each(this.opts.plugins,e.proxy(function(t,n){if(typeof RedactorPlugins[n]=="undefined")return;if(e.inArray(n,e.Redactor.modules)!==-1){e.error('Plugin name "'+n+"\" matches the name of the Redactor's module.");return}if(!e.isFunction(RedactorPlugins[n]))return;this[n]=RedactorPlugins[n]();var r=this.getModuleMethods(this[n]),i=r.length;for(var s=0;s<i;s++)this[n][r[s]]=this[n][r[s]].bind(this);e.isFunction(this[n].init)&&this[n].init()},this))},disableMozillaEditing:function(){if(!this.utils.browser("mozilla"))return;try{document.execCommand("enableObjectResizing",!1,!1),document.execCommand("enableInlineTableEditing",!1,!1)}catch(e){}}}},button:function(){return{build:function(t,n){var r=e('<a href="#" class="re-icon re-'+t+'" rel="'+t+'" />').attr("tabindex","-1");(n.func||n.command||n.dropdown)&&this.button.setEvent(r,t,n);if(n.dropdown){var i=e('<div class="redactor-dropdown redactor-dropdown-'+ +this.uuid+" redactor-dropdown-box-"+t+'" style="display: none;">');r.data("dropdown",i),this.dropdown.build(t,i,n.dropdown)}return this.utils.isDesktop()&&this.button.createTooltip(r,t,n.title),r},setEvent:function(t,n,r){t.on("touchstart click",e.proxy(function(e){if(t.hasClass("redactor-button-disabled"))return!1;var i="func",s=r.func;r.command?(i="command",s=r.command):r.dropdown&&(i="dropdown",s=!1),this.button.onClick(e,n,i,s)},this))},createTooltip:function(t,n,r){var i=e("<span>").addClass("redactor-toolbar-tooltip redactor-toolbar-tooltip-"+n).hide().html(r);i.appendTo("body"),t.on("mouseover",function(){if(e(this).hasClass("redactor-button-disabled"))return;var n=t.offset();i.show(),i.css({top:n.top+t.innerHeight()+"px",left:n.left+t.innerWidth()/2-i.innerWidth()/2+"px"})}),t.on("mouseout",function(){i.hide()})},onClick:function(e,t,n,r){this.button.caretOffset=this.caret.getOffset(),e.preventDefault(),this.utils.browser("msie")&&(e.returnValue=!1),n=="command"?this.inline.format(r):n=="dropdown"?this.dropdown.show(e,t):this.button.onClickCallback(e,r,t)},onClickCallback:function(t,n,r){var i;if(e.isFunction(n))n.call(this,r);else if(n.search(/\./)!="-1"){i=n.split(".");if(typeof this[i[0]]=="undefined")return;this[i[0]][i[1]](r)}else this[n](r);this.observe.buttons(t,r)},get:function(e){return this.$toolbar.find("a.re-"+e)},setActive:function(e){this.button.get(e).addClass("redactor-act")},setInactive:function(e){this.button.get(e).removeClass("redactor-act")},setInactiveAll:function(e){typeof e=="undefined"?this.$toolbar.find("a.re-icon").removeClass("redactor-act"):this.$toolbar.find("a.re-icon").not(".re-"+e).removeClass("redactor-act")},setActiveInVisual:function(){this.$toolbar.find("a.re-icon").not("a.re-html").removeClass("redactor-button-disabled")},setInactiveInCode:function(){this.$toolbar.find("a.re-icon").not("a.re-html").addClass("redactor-button-disabled")},changeIcon:function(e,t){this.button.get(e).addClass("re-"+t)},removeIcon:function(e,t){this.button.get(e).removeClass("re-"+t)},setAwesome:function(e,t){var n=this.button.get(e);n.removeClass("redactor-btn-image").addClass("fa-redactor-btn"),n.html('<i class="fa '+t+'"></i>')},addCallback:function(t,n){var r=n=="dropdown"?"dropdown":"func",i=t.attr("rel");t.on("touchstart click",e.proxy(function(e){if(t.hasClass("redactor-button-disabled"))return!1;this.button.onClick(e,i,r,n)},this))},addDropdown:function(t,n){var r=t.attr("rel");this.button.addCallback(t,"dropdown");var i=e('<div class="redactor-dropdown redactor-dropdown-'+ +this.uuid+" redactor-dropdown-box-"+r+'" style="display: none;">');return t.data("dropdown",i),n&&this.dropdown.build(r,i,n),i},add:function(t,n){if(!this.opts.toolbar)return;var r=this.button.build(t,{title:n});return r.addClass("redactor-btn-image"),this.$toolbar.append(e("<li>").append(r)),r},addFirst:function(t,n){if(!this.opts.toolbar)return;var r=this.button.build(t,{title:n});return r.addClass("redactor-btn-image"),this.$toolbar.prepend(e("<li>").append(r)),r},addAfter:function(t,n,r){if(!this.opts.toolbar)return;var i=this.button.build(n,{title:r});i.addClass("redactor-btn-image");var s=this.button.get(t);return s.length!==0?s.parent().after(e("<li>").append(i)):this.$toolbar.append(e("<li>").append(i)),i},addBefore:function(t,n,r){if(!this.opts.toolbar)return;var i=this.button.build(n,{title:r});i.addClass("redactor-btn-image");var s=this.button.get(t);return s.length!==0?s.parent().before(e("<li>").append(i)):this.$toolbar.append(e("<li>").append(i)),i},remove:function(e){this.button.get(e).remove()}}},caret:function(){return{setStart:function(t){if(!this.utils.isBlock(t)){var n=this.utils.createSpaceElement();e(t).prepend(n),this.caret.setEnd(n)}else this.caret.set(t,0,t,0)},setEnd:function(e){this.caret.set(e,1,e,1)},set:function(t,n,r,i){t=t[0]||t,r=r[0]||r,this.utils.isBlockTag(t.tagName)&&t.innerHTML===""&&(t.innerHTML=this.opts.invisibleSpace);if(t.tagName=="BR"&&this.opts.linebreaks===!1){var s=e(this.opts.emptyHtml)[0];e(t).replaceWith(s),t=s,r=t}this.selection.get();try{this.range.setStart(t,n),this.range.setEnd(r,i)}catch(o){}this.selection.addRange()},setAfter:function(t){try{var n=e(t)[0].tagName;if(n!="BR"&&!this.utils.isBlock(t)){var r=this.utils.createSpaceElement();e(t).after(r),this.caret.setEnd(r)}else n!="BR"&&this.utils.browser("msie")?this.caret.setStart(e(t).next()):this.caret.setAfterOrBefore(t,"after")}catch(i){var r=this.utils.createSpaceElement();e(t).after(r),this.caret.setEnd(r)}},setBefore:function(t){this.utils.isBlock(t)?this.caret.setEnd(e(t).prev()):this.caret.setAfterOrBefore(t,"before")},setAfterOrBefore:function(e,t){this.utils.browser("msie")||this.$editor.focus(),e=e[0]||e,this.selection.get();if(t=="after")try{this.range.setStartAfter(e),this.range.setEndAfter(e)}catch(n){}else try{this.range.setStartBefore(e),this.range.setEndBefore(e)}catch(n){}this.range.collapse(!1),this.selection.addRange()},getOffsetOfElement:function(t){t=t[0]||t,this.selection.get();var n=this.range.cloneRange();return n.selectNodeContents(t),n.setEnd(this.range.endContainer,this.range.endOffset),e.trim(n.toString()).length},getOffset:function(){var e=0,t=window.getSelection();if(t.rangeCount>0){var n=window.getSelection().getRangeAt(0),r=n.cloneRange();r.selectNodeContents(this.$editor[0]),r.setEnd(n.endContainer,n.endOffset),e=r.toString().length}return e},setOffset:function(e,t){typeof t=="undefined"&&(t=e),this.focus.isFocused()||this.focus.setStart();var n=this.selection.get(),r,i=0,s=document.createTreeWalker(this.$editor[0],NodeFilter.SHOW_TEXT,null,null);while(r=s.nextNode()){i+=r.nodeValue.length,i>e&&(this.range.setStart(r,r.nodeValue.length+e-i),e=Infinity);if(i>=t){this.range.setEnd(r,r.nodeValue.length+t-i);break}}this.range.collapse(!1),this.selection.addRange()},setToPoint:function(e,t){this.caret.setOffset(e,t)},getCoords:function(){return this.caret.getOffset()}}},clean:function(){return{onSet:function(t){t=this.clean.savePreCode(t),t=t.replace(/<script(.*?[^>]?)>([\w\W]*?)<\/script>/gi,'<pre class="redactor-script-tag" style="display: none;" $1>$2</pre>'),t=t.replace(/\$/g,"&#36;"),t=t.replace(/<a href="(.*?[^>]?)®(.*?[^>]?)">/gi,'<a href="$1&reg$2">'),this.opts.replaceDivs&&(t=this.clean.replaceDivs(t)),this.opts.linebreaks&&(t=this.clean.replaceParagraphsToBr(t)),t=this.clean.saveFormTags(t);var n=e("<div>");n.html(t);var r=n.find("font[style]");return r.length!==0&&(r.replaceWith(function(){var t=e(this),n=e("<span>").attr("style",t.attr("style"));return n.append(t.contents())}),t=n.html()),n.remove(),t=t.replace(/<font(.*?[^<])>/gi,""),t=t.replace(/<\/font>/gi,""),t=this.tidy.load(t),this.opts.paragraphize&&(t=this.paragraphize.load(t)),t=this.clean.setVerified(t),t=this.clean.convertInline(t),t},onSync:function(t){t=t.replace(/[\u200B-\u200D\uFEFF]/g,""),t=t.replace(/&#x200b;/gi,""),this.opts.cleanSpaces&&(t=t.replace(/&nbsp;/gi," "));if(t.search(/^<p>(||\s||<br\s?\/?>||&nbsp;)<\/p>$/i)!=-1)return"";t=t.replace(/<pre class="redactor-script-tag" style="display: none;"(.*?[^>]?)>([\w\W]*?)<\/pre>/gi,"<script$1>$2</script>"),t=this.clean.restoreFormTags(t);var n={"™":"&trade;","©":"&copy;","…":"&hellip;","—":"&mdash;","‐":"&dash;"};return e.each(n,function(e,n){t=t.replace(new RegExp(e,"g"),n)}),t=t.replace(new RegExp("<br\\s?/?></li>","gi"),"</li>"),t=t.replace(new RegExp("</li><br\\s?/?>","gi"),"</li>"),t=t.replace(new RegExp('<div(.*?[^>]) data-tagblock="redactor"(.*?[^>])>',"gi"),"<div$1$2>"),t=t.replace(new RegExp('<(.*?) data-verified="redactor"(.*?[^>])>',"gi"),"<$1$2>"),t=t.replace(new RegExp('<span(.*?[^>])srel="(.*?[^>])"(.*?[^>])>',"gi"),"<span$1$3>"),t=t.replace(new RegExp('<img(.*?[^>])srel="(.*?[^>])"(.*?[^>])>',"gi"),"<img$1$3>"),t=t.replace(new RegExp('<img(.*?[^>])sstyle="" (.*?[^>])>',"gi"),"<img$1 $2>"),t=t.replace(new RegExp("<img(.*?[^>])sstyle (.*?[^>])>","gi"),"<img$1 $2>"),t=t.replace(new RegExp('<span class="redactor-invisible-space">(.*?)</span>',"gi"),"$1"),t=t.replace(/ data-save-url="(.*?[^>])"/gi,""),t=t.replace(/<span(.*?)id="redactor-image-box"(.*?[^>])>([\w\W]*?)<img(.*?)><\/span>/gi,"$3<img$4>"),t=t.replace(/<span(.*?)id="redactor-image-resizer"(.*?[^>])>(.*?)<\/span>/gi,""),t=t.replace(/<span(.*?)id="redactor-image-editter"(.*?[^>])>(.*?)<\/span>/gi,""),t=t.replace(/<font(.*?[^<])>/gi,""),t=t.replace(/<\/font>/gi,""),t=this.tidy.load(t),this.opts.linkNofollow&&(t=t.replace(/<a(.*?)rel="nofollow"(.*?[^>])>/gi,"<a$1$2>"),t=t.replace(/<a(.*?[^>])>/gi,'<a$1 rel="nofollow">')),t=t.replace(/\sdata-redactor-(tag|class|style)="(.*?[^>])"/gi,""),t=t.replace(new RegExp('<(.*?) data-verified="redactor"(.*?[^>])>',"gi"),"<$1$2>"),t=t.replace(new RegExp('<(.*?) data-verified="redactor">',"gi"),"<$1>"),t},onPaste:function(t,n){t=e.trim(t),t=t.replace(/\$/g,"&#36;"),t=t.replace(/<span class="s1">/gi,"<span>"),t=t.replace(/<span class="Apple-converted-space">&nbsp;<\/span>/gi," "),t=t.replace(/<span class="Apple-tab-span"[^>]*>\t<\/span>/gi,"	"),t=t.replace(/<span[^>]*>(\s|&nbsp;)<\/span>/gi," ");if(this.opts.pastePlainText)return this.clean.getPlainText(t);if(!this.utils.isSelectAll()&&typeof n=="undefined"){if(this.utils.isCurrentOrParent(["FIGCAPTION","A"]))return this.clean.getPlainText(t,!1);if(this.utils.isCurrentOrParent("PRE"))return t=t.replace(/”/g,'"'),t=t.replace(/“/g,'"'),t=t.replace(/‘/g,"'"),t=t.replace(/’/g,"'"),this.clean.getPreCode(t);if(this.utils.isCurrentOrParent(["BLOCKQUOTE","H1","H2","H3","H4","H5","H6"])){t=this.clean.getOnlyImages(t);if(!this.utils.browser("msie")){var r=this.selection.getBlock();r&&r.tagName=="P"&&(t=t.replace(/<img(.*?)>/gi,"<p><img$1></p>"))}return t}if(this.utils.isCurrentOrParent(["TD"]))return t=this.clean.onPasteTidy(t,"td"),this.opts.linebreaks&&(t=this.clean.replaceParagraphsToBr(t)),t=this.clean.replaceDivsToBr(t),t;if(this.utils.isCurrentOrParent(["LI"]))return this.clean.onPasteTidy(t,"li")}return t=this.clean.isSingleLine(t,n),this.clean.singleLine||(this.opts.linebreaks&&(t=this.clean.replaceParagraphsToBr(t)),this.opts.replaceDivs&&(t=this.clean.replaceDivs(t)),t=this.clean.saveFormTags(t)),t=this.clean.onPasteWord(t),t=this.clean.onPasteExtra(t),t=this.clean.onPasteTidy(t,"all"),!this.clean.singleLine&&this.opts.paragraphize&&(t=this.paragraphize.load(t)),t=this.clean.removeDirtyStyles(t),t=this.clean.onPasteRemoveSpans(t),t=this.clean.onPasteRemoveEmpty(t),t=this.clean.convertInline(t),t},onPasteWord:function(e){return e=e.replace(/<!--[\s\S]*?-->/gi,""),e=e.replace(/<style[^>]*>[\s\S]*?<\/style>/gi,""),/(class=\"?Mso|style=\"[^\"]*\bmso\-|w:WordDocument)/.test(e)&&(e=this.clean.onPasteIeFixLinks(e),e=e.replace(/<img(.*?)v:shapes=(.*?)>/gi,""),e=e.replace(/src="file\:\/\/(.*?)"/,'src=""'),e=e.replace(/<p(.*?)class="MsoListParagraphCxSpFirst"([\w\W]*?)<\/p>/gi,"<ul><li$2</li>"),e=e.replace(/<p(.*?)class="MsoListParagraphCxSpMiddle"([\w\W]*?)<\/p>/gi,"<li$2</li>"),e=e.replace(/<p(.*?)class="MsoListParagraphCxSpLast"([\w\W]*?)<\/p>/gi,"<li$2</li></ul>"),e=e.replace(/<p(.*?)class="MsoListParagraph"([\w\W]*?)<\/p>/gi,"<ul><li$2</li></ul>"),e=e.replace(/·/g,""),e=e.replace(/<p class="Mso(.*?)"/gi,"<p"),e=e.replace(/ class=\"(mso[^\"]*)\"/gi,""),e=e.replace(/ class=(mso\w+)/gi,""),e=e.replace(/<o:p(.*?)>([\w\W]*?)<\/o:p>/gi,"$2"),e=e.replace(/\n/g," "),e=e.replace(/<p>\n?<li>/gi,"<li>")),this.opts.cleanSpaces&&(e=e.replace(/(\s|&nbsp;)+/g," ")),e},onPasteExtra:function(e){return e=e.replace(/<b\sid="internal-source-marker(.*?)">([\w\W]*?)<\/b>/gi,"$2"),e=e.replace(/<b(.*?)id="docs-internal-guid(.*?)">([\w\W]*?)<\/b>/gi,"$3"),e=e.replace(/<span[^>]*(font-style: italic; font-weight: bold|font-weight: bold; font-style: italic)[^>]*>/gi,'<span style="font-weight: bold;"><span style="font-style: italic;">'),e=e.replace(/<span[^>]*font-style: italic[^>]*>/gi,'<span style="font-style: italic;">'),e=e.replace(/<span[^>]*font-weight: bold[^>]*>/gi,'<span style="font-weight: bold;">'),e=e.replace(/<span[^>]*text-decoration: underline[^>]*>/gi,'<span style="text-decoration: underline;">'),e=e.replace(/<img>/gi,""),e=e.replace(/\n{3,}/gi,"\n"),e=e.replace(/<font(.*?)>([\w\W]*?)<\/font>/gi,"$2"),e=e.replace(/<p><p>/gi,"<p>"),e=e.replace(/<\/p><\/p>/gi,"</p>"),e=e.replace(/<li>(\s*|\t*|\n*)<p>/gi,"<li>"),e=e.replace(/<\/p>(\s*|\t*|\n*)<\/li>/gi,"</li>"),e=e.replace(/<\/p>\s<p/gi,"</p><p"),e=e.replace(/<img src="webkit-fake-url\:\/\/(.*?)"(.*?)>/gi,""),e=e.replace(/<p>•([\w\W]*?)<\/p>/gi,"<li>$1</li>"),this.utils.browser("mozilla")&&(e=e.replace(/<br\s?\/?>$/gi,"")),e},onPasteTidy:function(e,t){var n=["span","a","pre","blockquote","small","em","strong","code","kbd","mark","address","cite","var","samp","dfn","sup","sub","b","i","u","del","ol","ul","li","dl","dt","dd","p","br","video","audio","iframe","embed","param","object","img","table","td","th","tr","tbody","tfoot","thead","h1","h2","h3","h4","h5","h6"],r=!1,i=[["a","*"],["img",["src","alt"]],["span",["class","rel","data-verified"]],["iframe","*"],["video","*"],["audio","*"],["embed","*"],["object","*"],["param","*"],["source","*"]];t=="all"?(r=["p","span","h1","h2","h3","h4","h5","h6"],i=[["table","class"],["td",["colspan","rowspan"]],["a","*"],["img",["src","alt","data-redactor-inserted-image"]],["span",["class","rel","data-verified"]],["iframe","*"],["video","*"],["audio","*"],["embed","*"],["object","*"],["param","*"],["source","*"]]):t=="td"?n=["ul","ol","li","span","a","small","em","strong","code","kbd","mark","cite","var","samp","dfn","sup","sub","b","i","u","del","ol","ul","li","dl","dt","dd","br","iframe","video","audio","embed","param","object","img","h1","h2","h3","h4","h5","h6"]:t=="li"&&(n=["ul","ol","li","span","a","small","em","strong","code","kbd","mark","cite","var","samp","dfn","sup","sub","b","i","u","del","br","iframe","video","audio","embed","param","object","img"]);var s={deniedTags:!1,allowedTags:n,removeComments:!0,removePhp:!0,removeAttr:!1,allowedAttr:i,removeEmpty:r};return this.opts.deniedTags&&(s.deniedTags=this.opts.deniedTags),this.opts.allowedTags&&(s.allowedTags=this.opts.allowedTags),this.tidy.load(e,s)},onPasteRemoveEmpty:function(e){return e=e.replace(/<(p|h[1-6])>(|\s|\n|\t|<br\s?\/?>)<\/(p|h[1-6])>/gi,""),this.opts.linebreaks||(e=e.replace(/<br>$/i,"")),e},onPasteRemoveSpans:function(e){return e=e.replace(/<span>(.*?)<\/span>/gi,"$1"),e=e.replace(/<span[^>]*>\s|&nbsp;<\/span>/gi," "),e},onPasteIeFixLinks:function(t){if(!this.utils.browser("msie"))return t;var n=e.trim(t);return n.search(/^<a(.*?)>(.*?)<\/a>$/i)===0&&(t=t.replace(/^<a(.*?)>(.*?)<\/a>$/i,"$2")),t},isSingleLine:function(e,t){this.clean.singleLine=!1;if(!this.utils.isSelectAll()&&typeof t=="undefined"){var n=this.opts.blockLevelElements.join("|").replace("P|","").replace("DIV|",""),r=e.match(new RegExp("</("+n+")>","gi")),i=e.match(/<\/(p|div)>/gi);if(!r&&(i===null||i&&i.length<=1)){var s=e.match(/<br\s?\/?>/gi),o=e.match(/<img(.*?[^>])>/gi);!s&&!o&&(this.clean.singleLine=!0,e=e.replace(/<\/?(p|div)(.*?)>/gi,""))}}return e},stripTags:function(e,t){t=(((t||"")+"").toLowerCase().match(/<[a-z][a-z0-9]*>/g)||[]).join("");var n=/<\/?([a-z][a-z0-9]*)\b[^>]*>/gi;return e.replace(n,function(e,n){return t.indexOf("<"+n.toLowerCase()+">")>-1?e:""})},savePreCode:function(e){return e=this.clean.savePreFormatting(e),e=this.clean.saveCodeFormatting(e),e},savePreFormatting:function(t){var n=t.match(/<pre(.*?)>([\w\W]*?)<\/pre>/gi);return n!==null&&e.each(n,e.proxy(function(e,n){var r=n.match(/<pre(.*?)>([\w\W]*?)<\/pre>/i);r[2]=r[2].replace(/<br\s?\/?>/g,"\n"),r[2]=r[2].replace(/&nbsp;/g," "),this.opts.preSpaces&&(r[2]=r[2].replace(/\t/g,Array(this.opts.preSpaces+1).join(" "))),r[2]=this.clean.encodeEntities(r[2]),r[2]=r[2].replace(/\$/g,"&#36;"),t=t.replace(n,"<pre"+r[1]+">"+r[2]+"</pre>")},this)),t},saveCodeFormatting:function(t){var n=t.match(/<code(.*?[^>])>(.*?)<\/code>/gi);return n!==null&&e.each(n,e.proxy(function(e,n){var r=n.match(/<code(.*?[^>])>(.*?)<\/code>/i);r[2]=r[2].replace(/&nbsp;/g," "),r[2]=this.clean.encodeEntities(r[2]),r[2]=r[2].replace(/\$/g,"&#36;"),t=t.replace(n,"<code"+r[1]+">"+r[2]+"</code>")},this)),t},getTextFromHtml:function(t){t=t.replace(/<br\s?\/?>|<\/H[1-6]>|<\/p>|<\/div>|<\/li>|<\/td>/gi,"\n");var n=document.createElement("div");return n.innerHTML=t,t=n.textContent||n.innerText,e.trim(t)},getPlainText:function(e,t){return e=this.clean.getTextFromHtml(e),e=e.replace(/\n/g,"<br />"),this.opts.paragraphize&&typeof t=="undefined"&&!this.utils.browser("mozilla")&&(e=this.paragraphize.load(e)),e},getPreCode:function(e){return e=e.replace(/<img(.*?) style="(.*?)"(.*?[^>])>/gi,"<img$1$3>"),e=e.replace(/<img(.*?)>/gi,"&lt;img$1&gt;"),e=this.clean.getTextFromHtml(e),this.opts.preSpaces&&(e=e.replace(/\t/g,Array(this.opts.preSpaces+1).join(" "))),e=this.clean.encodeEntities(e),e},getOnlyImages:function(e){return e=e.replace(/<img(.*?)>/gi,"[img$1]"),e=e.replace(/<([Ss]*?)>/gi,""),e=e.replace(/\[img(.*?)\]/gi,"<img$1>"),e},getOnlyLinksAndImages:function(e){return e=e.replace(/<a(.*?)href="(.*?)"(.*?)>([\w\W]*?)<\/a>/gi,'[a href="$2"]$4[/a]'),e=e.replace(/<img(.*?)>/gi,"[img$1]"),e=e.replace(/<(.*?)>/gi,""),e=e.replace(/\[a href="(.*?)"\]([\w\W]*?)\[\/a\]/gi,'<a href="$1">$2</a>'),e=e.replace(/\[img(.*?)\]/gi,"<img$1>"),e},encodeEntities:function(e){return e=String(e).replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"'),e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},removeDirtyStyles:function(t){if(this.utils.browser("msie"))return t;var n=document.createElement("div");return n.innerHTML=t,this.clean.clearUnverifiedRemove(e(n)),t=n.innerHTML,e(n).remove(),t},clearUnverified:function(){if(this.utils.browser("msie"))return;this.clean.clearUnverifiedRemove(this.$editor);var e=this.$editor.find("h1, h2, h3, h4, h5, h6");e.find("span").removeAttr("style"),e.find(this.opts.verifiedTags.join(", ")).removeAttr("style"),this.code.sync()},clearUnverifiedRemove:function(t){t.find(this.opts.verifiedTags.join(", ")).removeAttr("style"),t.find("span").not('[data-verified="redactor"]').removeAttr("style"),t.find('span[data-verified="redactor"], img[data-verified="redactor"]').each(function(t,n){var r=e(n);r.attr("style",r.attr("rel"))})},setVerified:function(e){if(this.utils.browser("msie"))return e;e=e.replace(new RegExp("<img(.*?[^>])>","gi"),'<img$1 data-verified="redactor">'),e=e.replace(new RegExp("<span(.*?[^>])>","gi"),'<span$1 data-verified="redactor">');var t=e.match(new RegExp('<(span|img)(.*?)style="(.*?)"(.*?[^>])>',"gi"));if(t){var n=t.length;for(var r=0;r<n;r++)try{var i=t[r].replace(/style="(.*?)"/i,'style="$1" rel="$1"');e=e.replace(t[r],i)}catch(s){}}return e},convertInline:function(t){var n=e("<div />").html(t),r=this.opts.inlineTags;return r.push("span"),n.find(r.join(",")).each(function(){var t=e(this),n=this.tagName.toLowerCase();t.attr("data-redactor-tag",n),n=="span"&&(t.attr("style")?t.attr("data-redactor-style",t.attr("style")):t.attr("class")&&t.attr("data-redactor-class",t.attr("class")))}),t=n.html(),n.remove(),t},normalizeLists:function(){this.$editor.find("li").each(function(t,n){var r=e(n).next();r.length!==0&&(r[0].tagName=="UL"||r[0].tagName=="OL")&&e(n).append(r)})},removeSpaces:function(e){return e=e.replace(/\n/g,""),e=e.replace(/[\t]*/g,""),e=e.replace(/\n\s*\n/g,"\n"),e=e.replace(/^[\s\n]*/g," "),e=e.replace(/[\s\n]*$/g," "),e=e.replace(/>\s{2,}</g,"> <"),e=e.replace(/\n\n/g,"\n"),e=e.replace(/[\u200B-\u200D\uFEFF]/g,""),e},replaceDivs:function(e){return this.opts.linebreaks?(e=e.replace(/<div><br\s?\/?><\/div>/gi,"<br />"),e=e.replace(/<div(.*?)>([\w\W]*?)<\/div>/gi,"$2<br />")):e=e.replace(/<div(.*?)>([\w\W]*?)<\/div>/gi,"<p$1>$2</p>"),e=e.replace(/<div(.*?[^>])>/gi,""),e=e.replace(/<\/div>/gi,""),e},replaceDivsToBr:function(e){return e=e.replace(/<div\s(.*?)>/gi,"<p>"),e=e.replace(/<div><br\s?\/?><\/div>/gi,"<br /><br />"),e=e.replace(/<div>([\w\W]*?)<\/div>/gi,"$1<br /><br />"),e},replaceParagraphsToBr:function(e){return e=e.replace(/<p\s(.*?)>/gi,"<p>"),e=e.replace(/<p><br\s?\/?><\/p>/gi,"<br />"),e=e.replace(/<p>([\w\W]*?)<\/p>/gi,"$1<br /><br />"),e=e.replace(/(<br\s?\/?>){1,}\n?<\/blockquote>/gi,"</blockquote>"),e},saveFormTags:function(e){return e.replace(/<form(.*?)>([\w\W]*?)<\/form>/gi,'<section$1 rel="redactor-form-tag">$2</section>')},restoreFormTags:function(e){return e.replace(/<section(.*?) rel="redactor-form-tag"(.*?)>([\w\W]*?)<\/section>/gi,"<form$1$2>$3</form>")}}},code:function(){return{set:function(t){t=e.trim(t.toString()),t=this.clean.onSet(t),this.$editor.html(t),this.code.sync(),t!==""&&this.placeholder.remove(),setTimeout(e.proxy(this.buffer.add,this),15),this.start===!1&&this.observe.load()},get:function(){var e=this.$textarea.val();return e=this.tabifier.get(e),e},sync:function(){setTimeout(e.proxy(this.code.startSync,this),10)},startSync:function(){var e=this.$editor.html();if(this.code.syncCode&&this.code.syncCode==e)return;this.code.syncCode=e,e=this.core.setCallback("syncBefore",e),e=this.clean.onSync(e),this.$textarea.val(e),this.core.setCallback("sync",e),this.start===!1&&this.core.setCallback("change",e),this.start=!1,this.autosave.onChange()},toggle:function(){this.opts.visual?this.code.showCode():this.code.showVisual()},showCode:function(){this.code.offset=this.caret.getOffset();var t=e(window).scrollTop(),n=this.$editor.innerHeight();this.$editor.hide();var r=this.$textarea.val();this.modified=this.clean.removeSpaces(r),r=this.tabifier.get(r),this.$textarea.val(r).height(n).show().focus(),this.$textarea.on("keydown.redactor-textarea-indenting",this.code.textareaIndenting),e(window).scrollTop(t),this.$textarea[0].setSelectionRange&&this.$textarea[0].setSelectionRange(0,0),this.$textarea[0].scrollTop=0,this.opts.visual=!1,this.button.setInactiveInCode(),this.button.setActive("html"),this.core.setCallback("source",r)},showVisual:function(){if(this.opts.visual)return;var e=this.$textarea.hide().val();this.modified!==this.clean.removeSpaces(e)&&this.code.set(e),this.$editor.show(),this.utils.isEmpty(e)||this.placeholder.remove(),this.caret.setOffset(this.code.offset),this.$textarea.off("keydown.redactor-textarea-indenting"),this.button.setActiveInVisual(),this.button.setInactive("html"),this.observe.load(),this.opts.visual=!0,this.core.setCallback("visual",e)},textareaIndenting:function(e){if(e.keyCode!==9)return!0;var t=this.$textarea,n=t.get(0).selectionStart;return t.val(t.val().substring(0,n)+"	"+t.val().substring(t.get(0).selectionEnd)),t.get(0).selectionStart=t.get(0).selectionEnd=n+1,!1}}},core:function(){return{getObject:function(){return e.extend({},this)},getEditor:function(){return this.$editor},getBox:function(){return this.$box},getElement:function(){return this.$element},getTextarea:function(){return this.$textarea},getToolbar:function(){return this.$toolbar?this.$toolbar:!1},addEvent:function(e){this.core.event=e},getEvent:function(){return this.core.event},setCallback:function(t,n,r){var i=this.opts[t+"Callback"];return e.isFunction(i)?typeof r=="undefined"?i.call(this,n):i.call(this,n,r):typeof r=="undefined"?n:r},destroy:function(){this.core.setCallback("destroy"),this.$element.off(".redactor").removeData("redactor"),this.$editor.off(".redactor"),e(document).off("click.redactor-image-delete."+this.uuid),e(document).off("click.redactor-image-resize-hide."+this.uuid),e(document).off("touchstart.redactor."+this.uuid+" click.redactor."+this.uuid),e("body").off("scroll.redactor."+this.uuid),e(this.opts.toolbarFixedTarget).off("scroll.redactor."+this.uuid),this.$editor.removeClass("redactor-editor redactor-linebreaks redactor-placeholder"),this.$editor.removeAttr("contenteditable");var t=this.code.get();this.$toolbar.find("a").each(function(){var t=e(this);t.data("dropdown")&&(t.data("dropdown").remove(),t.data("dropdown",{}))}),this.build.isTextarea()?(this.$box.after(this.$element),this.$box.remove(),this.$element.val(t).show()):(this.$box.after(this.$editor),this.$box.remove(),this.$element.html(t).show()),this.$pasteBox&&this.$pasteBox.remove(),this.$modalBox&&this.$modalBox.remove(),this.$modalOverlay&&this.$modalOverlay.remove(),e(".redactor-toolbar-tooltip").remove(),clearInterval(this.autosaveInterval)}}},dropdown:function(){return{build:function(t,n,r){t=="formatting"&&this.opts.formattingAdd&&e.each(this.opts.formattingAdd,e.proxy(function(e,t){var n=t.tag;typeof t["class"]!="undefined"&&(n=n+"-"+t["class"]),t.type=this.utils.isBlockTag(t.tag)?"block":"inline";var i=t.type=="inline"?"inline.formatting":"block.formatting";if(this.opts.linebreaks&&t.type=="block"&&t.tag=="p")return;this.formatting[n]={tag:t.tag,style:t.style,"class":t["class"],attr:t.attr,data:t.data,clear:t.clear},r[n]={func:i,title:t.title}},this)),e.each(r,e.proxy(function(r,i){var s=e('<a href="#" class="redactor-dropdown-'+r+'">'+i.title+"</a>");t=="formatting"&&s.addClass("redactor-formatting-"+r),s.on("click",e.proxy(function(e){e.preventDefault();var t="func",n=i.func;i.command?(t="command",n=i.command):i.dropdown&&(t="dropdown",n=i.dropdown),this.button.onClick(e,r,t,n),this.dropdown.hideAll()},this)),n.append(s)},this))},show:function(t,n){if(!this.opts.visual)return t.preventDefault(),!1;var r=this.button.get(n),i=r.data("dropdown").appendTo(document.body);this.utils.isMobile()&&!this.utils.browser("msie")&&document.activeElement.blur();if(r.hasClass("dropact"))this.dropdown.hideAll();else{this.dropdown.hideAll(),this.core.setCallback("dropdownShow",{dropdown:i,key:n,button:r}),this.button.setActive(n),r.addClass("dropact");var s=r.offset(),o=i.width();s.left+o>e(document).width()&&(s.left=Math.max(0,s.left-o));var u=s.left+"px";if(this.$toolbar.hasClass("toolbar-fixed-box")){var a=this.$toolbar.innerHeight()+this.opts.toolbarFixedTopOffset,f="fixed";this.opts.toolbarFixedTarget!==document&&(a=this.$toolbar.innerHeight()+this.$toolbar.offset().top+this.opts.toolbarFixedTopOffset,f="absolute"),i.css({position:f,left:u,top:a+"px"}).show()}else{var a=r.innerHeight()+s.top+"px";i.css({position:"absolute",left:u,top:a}).show()}this.core.setCallback("dropdownShown",{dropdown:i,key:n,button:r})}e(document).one("click",e.proxy(this.dropdown.hide,this)),this.$editor.one("click",e.proxy(this.dropdown.hide,this));var l=e(document.body),c=l.width();i.on("mouseover",function(){l.addClass("body-redactor-hidden"),l.css("margin-right",l.width()-c+"px")}),i.on("mouseout",function(){l.removeClass("body-redactor-hidden").css("margin-right",0)}),t.stopPropagation()},hideAll:function(){this.$toolbar.find("a.dropact").removeClass("redactor-act").removeClass("dropact"),e(document.body).removeClass("body-redactor-hidden").css("margin-right",0),e(".redactor-dropdown-"+this.uuid).hide(),this.core.setCallback("dropdownHide")},hide:function(t){var n=e(t.target);n.hasClass("dropact")||(n.removeClass("dropact"),this.dropdown.hideAll())}}},file:function(){return{show:function(){this.modal.load("file",this.lang.get("file"),700),this.upload.init("#redactor-modal-file-upload",this.opts.fileUpload,this.file.insert),this.selection.save(),this.selection.get();var t=this.sel.toString();e("#redactor-filename").val(t),this.modal.show()},insert:function(t,n,r){if(typeof t.error!="undefined"){this.modal.close(),this.selection.restore(),this.core.setCallback("fileUploadError",t);return}var i;if(typeof t=="string")i=t;else{var s=e("#redactor-filename").val();if(typeof s=="undefined"||s==="")s=t.filename;i='<a href="'+t.filelink+'" id="filelink-marker">'+s+"</a>"}if(n){this.selection.removeMarkers();var o=this.selection.getMarker();this.insert.nodeToCaretPositionFromPoint(r,o)}else this.modal.close();this.selection.restore(),this.buffer.set(),this.insert.htmlWithoutClean(i);if(typeof t=="string")return;var u=e(this.$editor.find("a#filelink-marker"));u.length!==0?u.removeAttr("id").removeAttr("style"):u=!1,this.core.setCallback("fileUpload",u,t)}}},focus:function(){return{setStart:function(){this.$editor.focus();var e=this.$editor.children().first();if(e.length===0)return;if(e[0].length===0||e[0].tagName=="BR"||e[0].nodeType==3)return;if(e[0].tagName=="UL"||e[0].tagName=="OL"){var t=e.find("li").first();if(!this.utils.isBlock(t)&&t.text()===""){this.caret.setStart(t);return}}if(this.opts.linebreaks&&!this.utils.isBlockTag(e[0].tagName)){this.selection.get(),this.range.setStart(this.$editor[0],0),this.range.setEnd(this.$editor[0],0),this.selection.addRange();return}this.caret.setStart(e)},setEnd:function(){if(this.utils.browser("mozilla")||this.utils.browser("msie")){var e=this.$editor.children().last();this.$editor.focus(),this.caret.setEnd(e)}else{this.selection.get();try{this.range.selectNodeContents(this.$editor[0]),this.range.collapse(!1),this.selection.addRange()}catch(t){}}},isFocused:function(){var t=document.getSelection().focusNode;return t===null?!1:this.opts.linebreaks&&e(t.parentNode).hasClass("redactor-linebreaks")?!0:this.utils.isRedactorParent(t.parentNode)?this.$editor.is(":focus"):!1}}},image:function(){return{show:function(){this.modal.load("image",this.lang.get("image"),700),this.upload.init("#redactor-modal-image-droparea",this.opts.imageUpload,this.image.insert),this.selection.save(),this.modal.show()},showEdit:function(t){var n=t.closest("a");this.modal.load("imageEdit",this.lang.get("edit"),705),this.modal.createCancelButton(),this.image.buttonDelete=this.modal.createDeleteButton(this.lang.get("_delete")),this.image.buttonSave=this.modal.createActionButton(this.lang.get("save")),this.image.buttonDelete.on("click",e.proxy(function(){this.image.remove(t)},this)),this.image.buttonSave.on("click",e.proxy(function(){this.image.update(t)},this)),e("#redactor-image-title").val(t.attr("alt"));if(!this.opts.imageLink)e(".redactor-image-link-option").hide();else{var r=e("#redactor-image-link");r.attr("href",t.attr("src")),n.length!==0&&(r.val(n.attr("href")),n.attr("target")=="_blank"&&e("#redactor-image-link-blank").prop("checked",!0))}if(!this.opts.imagePosition)e(".redactor-image-position-option").hide();else{var i=t.css("display")=="block"&&t.css("float")=="none"?"center":t.css("float");e("#redactor-image-align").val(i)}this.modal.show()},setFloating:function(t){var n=e("#redactor-image-align").val(),r="",i="",s="";switch(n){case"left":r="left",s="0 "+this.opts.imageFloatMargin+" "+this.opts.imageFloatMargin+" 0";break;case"right":r="right",s="0 0 "+this.opts.imageFloatMargin+" "+this.opts.imageFloatMargin;break;case"center":i="block",s="auto"}t.css({"float":r,display:i,margin:s}),t.attr("rel",t.attr("style"))},update:function(t){this.image.hideResize(),this.buffer.set();var n=t.closest("a");t.attr("alt",e("#redactor-image-title").val()),this.image.setFloating(t);var r=e.trim(e("#redactor-image-link").val());if(r!==""){var i="((xn--)?[a-z0-9]+(-[a-z0-9]+)*\\.)+[a-z]{2,}",s=new RegExp("^(http|ftp|https)://"+i,"i"),o=new RegExp("^"+i,"i");r.search(s)==-1&&r.search(o)===0&&this.opts.linkProtocol&&(r=this.opts.linkProtocol+"://"+r);var u=e("#redactor-image-link-blank").prop("checked")?!0:!1;if(n.length===0){var a=e('<a href="'+r+'">'+this.utils.getOuterHtml(t)+"</a>");u&&a.attr("target","_blank"),t.replaceWith(a)}else n.attr("href",r),u?n.attr("target","_blank"):n.removeAttr("target")}else n.length!==0&&n.replaceWith(this.utils.getOuterHtml(t));this.modal.close(),this.observe.images(),this.code.sync()},setEditable:function(t){this.opts.imageEditable&&t.on("dragstart",e.proxy(this.image.onDrag,this)),t.on("mousedown",e.proxy(this.image.hideResize,this)),t.on("click.redactor touchstart",e.proxy(function(n){this.observe.image=t;if(this.$editor.find("#redactor-image-box").length!==0)return!1;this.image.resizer=this.image.loadEditableControls(t),e(document).on("click.redactor-image-resize-hide."+this.uuid,e.proxy(this.image.hideResize,this)),this.$editor.on("click.redactor-image-resize-hide."+this.uuid,e.proxy(this.image.hideResize,this));if(!this.opts.imageResizable)return;this.image.resizer.on("mousedown.redactor touchstart.redactor",e.proxy(function(e){this.image.setResizable(e,t)},this))},this))},setResizable:function(e,t){e.preventDefault(),this.image.resizeHandle={x:e.pageX,y:e.pageY,el:t,ratio:t.width()/t.height(),h:t.height()},e=e.originalEvent||e,e.targetTouches&&(this.image.resizeHandle.x=e.targetTouches[0].pageX,this.image.resizeHandle.y=e.targetTouches[0].pageY),this.image.startResize()},startResize:function(){e(document).on("mousemove.redactor-image-resize touchmove.redactor-image-resize",e.proxy(this.image.moveResize,this)),e(document).on("mouseup.redactor-image-resize touchend.redactor-image-resize",e.proxy(this.image.stopResize,this))},moveResize:function(e){e.preventDefault(),e=e.originalEvent||e;var t=this.image.resizeHandle.h;e.targetTouches?t+=e.targetTouches[0].pageY-this.image.resizeHandle.y:t+=e.pageY-this.image.resizeHandle.y;var n=Math.round(t*this.image.resizeHandle.ratio);if(t<50||n<100)return;this.image.resizeHandle.el.width(n),this.image.resizeHandle.el.height(this.image.resizeHandle.el.width()/this.image.resizeHandle.ratio),this.code.sync()},stopResize:function(){this.handle=!1,e(document).off(".redactor-image-resize"),this.image.hideResize()},onDrag:function(t){if(this.$editor.find("#redactor-image-box").length!==0)return t.preventDefault(),!1;this.$editor.on("drop.redactor-image-inside-drop",e.proxy(function(){setTimeout(e.proxy(this.image.onDrop,this),1)},this))},onDrop:function(){this.image.fixImageSourceAfterDrop(),this.observe.images(),this.$editor.off("drop.redactor-image-inside-drop"),this.clean.clearUnverified(),this.code.sync()},fixImageSourceAfterDrop:function(){this.$editor.find("img[data-save-url]").each(function(){var t=e(this);t.attr("src",t.attr("data-save-url")),t.removeAttr("data-save-url")})},hideResize:function(t){if(t&&e(t.target).closest("#redactor-image-box").length!==0)return;if(t&&t.target.tagName=="IMG"){var n=e(t.target);n.attr("data-save-url",n.attr("src"))}var r=this.$editor.find("#redactor-image-box");if(r.length===0)return;this.opts.imageEditable&&this.image.editter.remove(),e(this.image.resizer).remove(),r.find("img").css({marginTop:r[0].style.marginTop,marginBottom:r[0].style.marginBottom,marginLeft:r[0].style.marginLeft,marginRight:r[0].style.marginRight}),r.css("margin",""),r.find("img").css("opacity",""),r.replaceWith(function(){return e(this).contents()}),e(document).off("click.redactor-image-resize-hide."+this.uuid),this.$editor.off("click.redactor-image-resize-hide."+this.uuid),typeof this.image.resizeHandle!="undefined"&&this.image.resizeHandle.el.attr("rel",this.image.resizeHandle.el.attr("style")),this.code.sync()},loadResizableControls:function(t,n){if(this.opts.imageResizable&&!this.utils.isMobile()){var r=e('<span id="redactor-image-resizer" data-redactor="verified"></span>');return this.utils.isDesktop()||r.css({width:"15px",height:"15px"}),r.attr("contenteditable",!1),n.append(r),n.append(t),r}return n.append(t),!1},loadEditableControls:function(t){var n=e('<span id="redactor-image-box" data-redactor="verified">');n.css("float",t.css("float")).attr("contenteditable",!1),t[0].style.margin!="auto"?(n.css({marginTop:t[0].style.marginTop,marginBottom:t[0].style.marginBottom,marginLeft:t[0].style.marginLeft,marginRight:t[0].style.marginRight}),t.css("margin","")):n.css({display:"block",margin:"auto"}),t.css("opacity",".5").after(n);if(this.opts.imageEditable){this.image.editter=e('<span id="redactor-image-editter" data-redactor="verified">'+this.lang.get("edit")+"</span>"),this.image.editter.attr("contenteditable",!1),this.image.editter.on("click",e.proxy(function(){this.image.showEdit(t)},this)),n.append(this.image.editter);var r=this.image.editter.innerWidth();this.image.editter.css("margin-left","-"+r/2+"px")}return this.image.loadResizableControls(t,n)},remove:function(t){var n=e(t),r=n.closest("a"),i=n.closest("figure"),s=n.parent();e("#redactor-image-box").length!==0&&(s=e("#redactor-image-box").parent());var o;i.length!==0?(o=i.next(),i.remove()):r.length!==0?(s=r.parent(),r.remove()):n.remove(),e("#redactor-image-box").remove(),i.length!==0?this.caret.setStart(o):this.caret.setStart(s),this.core.setCallback("imageDelete",n[0].src,n),this.modal.close(),this.code.sync()},insert:function(t,n,r){if(typeof t.error!="undefined"){this.modal.close(),this.selection.restore(),this.core.setCallback("imageUploadError",t);return}var i;typeof t=="string"?i=e(t).attr("data-redactor-inserted-image","true"):(i=e("<img>"),i.attr("src",t.filelink).attr("data-redactor-inserted-image","true"));var s=i,o=this.utils.isCurrentOrParent("P");o&&(s=e("<blockquote />").append(i));if(n){this.selection.removeMarkers();var u=this.selection.getMarker();this.insert.nodeToCaretPositionFromPoint(r,u)}else this.modal.close();this.selection.restore(),this.buffer.set(),this.insert.html(this.utils.getOuterHtml(s),!1);var a=this.$editor.find("img[data-redactor-inserted-image=true]").removeAttr("data-redactor-inserted-image");o?a.parent().contents().unwrap().wrap("<p />"):this.opts.linebreaks&&a.before("<br>").after("<br>");if(typeof t=="string")return;this.core.setCallback("imageUpload",a,t)}}},indent:function(){return{increase:function(){this.utils.browser("msie")||this.$editor.focus(),this.buffer.set(),this.selection.save();var e=this.selection.getBlock();e&&e.tagName=="LI"?this.indent.increaseLists():e===!1&&this.opts.linebreaks?this.indent.increaseText():this.indent.increaseBlocks(),this.selection.restore(),this.code.sync()},increaseLists:function(){document.execCommand("indent"),this.indent.fixEmptyIndent(),this.clean.normalizeLists(),this.clean.clearUnverified()},increaseBlocks:function(){e.each(this.selection.getBlocks(),e.proxy(function(e,t){if(t.tagName==="TD"||t.tagName==="TH")return;var n=this.utils.getAlignmentElement(t),r=this.utils.normalize(n.css("margin-left"))+this.opts.indentValue;n.css("margin-left",r+"px")},this))},increaseText:function(){var t=this.selection.wrap("div");e(t).attr("data-tagblock","redactor"),e(t).css("margin-left",this.opts.indentValue+"px")},decrease:function(){this.buffer.set(),this.selection.save();var e=this.selection.getBlock();e&&e.tagName=="LI"?this.indent.decreaseLists():this.indent.decreaseBlocks(),this.selection.restore(),this.code.sync()},decreaseLists:function(){document.execCommand("outdent");var t=this.selection.getCurrent(),n=e(t).closest("li"),r=n.parent();n.length!==0&&r.length!==0&&r[0].tagName=="LI"&&r.after(n),this.indent.fixEmptyIndent(),!this.opts.linebreaks&&n.length===0&&(document.execCommand("formatblock",!1,"p"),this.$editor.find("ul, ol, blockquote, p").each(e.proxy(this.utils.removeEmpty,this))),this.clean.clearUnverified()},decreaseBlocks:function(){e.each(this.selection.getBlocks(),e.proxy(function(e,t){var n=this.utils.getAlignmentElement(t),r=this.utils.normalize(n.css("margin-left"))-this.opts.indentValue;r<=0?this.opts.linebreaks&&typeof n.data("tagblock")!="undefined"?n.replaceWith(n.html()+"<br />"):(n.css("margin-left",""),this.utils.removeEmptyAttr(n,"style")):n.css("margin-left",r+"px")},this))},fixEmptyIndent:function(){var t=this.selection.getBlock();if(this.range.collapsed&&t&&t.tagName=="LI"&&this.utils.isEmpty(e(t).text())){var n=e(t);n.find("span").not(".redactor-selection-marker").contents().unwrap(),n.append("<br>")}}}},inline:function(){return{formatting:function(e){var t,n;typeof this.formatting[e].style!="undefined"?t="style":typeof this.formatting[e]["class"]!="undefined"&&(t="class"),t&&(n=this.formatting[e][t]),this.inline.format(this.formatting[e].tag,t,n)},format:function(e,t,n){if(this.utils.isCurrentOrParent("PRE")||this.utils.isCurrentOrParentHeader())return;var r=["b","bold","i","italic","underline","strikethrough","deleted","superscript","subscript"],i=["strong","strong","em","em","u","del","del","sup","sub"];for(var s=0;s<r.length;s++)e==r[s]&&(e=i[s]);this.inline.type=t||!1,this.inline.value=n||!1,this.buffer.set(),this.utils.browser("msie")||this.$editor.focus(),this.selection.get(),this.range.collapsed?this.inline.formatCollapsed(e):this.inline.formatMultiple(e)},formatCollapsed:function(t){var n=this.selection.getCurrent(),r=e(n).closest(t+"[data-redactor-tag="+t+"]");if(r.length!==0&&this.inline.type!="style"&&r[0].tagName!="SPAN"){this.utils.isEmpty(r.text())?(this.caret.setAfter(r[0]),r.remove(),this.code.sync()):this.utils.isEndOfElement(r)&&this.caret.setAfter(r[0]);return}var i=e("<"+t+">").attr("data-verified","redactor").attr("data-redactor-tag",t);i.html(this.opts.invisibleSpace),i=this.inline.setFormat(i);var i=this.insert.node(i);this.caret.setEnd(i),this.code.sync()},formatMultiple:function(t){this.inline.formatConvert(t),this.selection.save(),document.execCommand("strikethrough"),this.$editor.find("strike").each(e.proxy(function(n,r){var i=e(r);this.inline.formatRemoveSameChildren(i,t);var s;this.inline.type?(s=e("<span>").attr("data-redactor-tag",t).attr("data-verified","redactor"),s=this.inline.setFormat(s)):s=e("<"+t+">").attr("data-redactor-tag",t).attr("data-verified","redactor"),i.replaceWith(s.html(i.contents()));if(t=="span"){var o=s.parent();if(o&&o[0].tagName=="SPAN"&&this.inline.type=="style"){var u=this.inline.value.split(";");for(var a=0;a<u.length;a++){if(u[a]==="")return;var f=u[a].split(":");o.css(f[0],""),this.utils.removeEmptyAttr(o,"style")&&o.replaceWith(o.contents())}}}},this)),t!="span"&&this.$editor.find(this.opts.inlineTags.join(", ")).each(e.proxy(function(t,n){var r=e(n),i=r.css("text-decoration");i=="line-through"&&(r.css("text-decoration",""),this.utils.removeEmptyAttr(r,"style"))},this));if(t!="del"){var n=this;this.$editor.find("inline").each(function(e,t){n.utils.replaceToTag(t,"del")})}this.selection.restore(),this.code.sync()},formatRemoveSameChildren:function(t,n){var r=this;t.children(n).each(function(){var t=e(this);if(!t.hasClass("redactor-selection-marker"))if(r.inline.type=="style"){var n=r.inline.value.split(";");for(var i=0;i<n.length;i++){if(n[i]==="")return;var s=n[i].split(":");t.css(s[0],""),r.utils.removeEmptyAttr(t,"style")&&t.replaceWith(t.contents())}}else t.contents().unwrap()})},formatConvert:function(t){this.selection.save();var n="";this.inline.type=="class"?n="[data-redactor-class="+this.inline.value+"]":this.inline.type=="style"&&(n='[data-redactor-style="'+this.inline.value+'"]');var r=this;t!="del"&&this.$editor.find("del").each(function(e,t){r.utils.replaceToTag(t,"inline")}),t!="span"&&this.$editor.find(t).each(function(){var t=e(this);t.replaceWith(e("<strike />").html(t.contents()))}),this.$editor.find('[data-redactor-tag="'+t+'"]'+n).each(function(){if(n===""&&t=="span"&&this.tagName.toLowerCase()==t)return;var r=e(this);r.replaceWith(e("<strike />").html(r.contents()))}),this.selection.restore()},setFormat:function(e){switch(this.inline.type){case"class":e.hasClass(this.inline.value)?(e.removeClass(this.inline.value),e.removeAttr("data-redactor-class")):(e.addClass(this.inline.value),e.attr("data-redactor-class",this.inline.value));break;case"style":e[0].style.cssText=this.inline.value,e.attr("data-redactor-style",this.inline.value)}return e},removeStyle:function(){this.buffer.set();var t=this.selection.getCurrent(),n=this.selection.getInlines();this.selection.save();if(t&&t.tagName==="SPAN"){var r=e(t);r.removeAttr("style"),r[0].attributes.length===0&&r.replaceWith(r.contents())}e.each(n,e.proxy(function(t,n){var r=e(n);e.inArray(n.tagName.toLowerCase(),this.opts.inlineTags)!=-1&&!r.hasClass("redactor-selection-marker")&&(r.removeAttr("style"),r[0].attributes.length===0&&r.replaceWith(r.contents()))},this)),this.selection.restore(),this.code.sync()},removeStyleRule:function(t){this.buffer.set();var n=this.selection.getParent(),r=this.selection.getInlines();this.selection.save();if(n&&n.tagName==="SPAN"){var i=e(n);i.css(t,""),this.utils.removeEmptyAttr(i,"style"),i[0].attributes.length===0&&i.replaceWith(i.contents())}e.each(r,e.proxy(function(n,r){var i=e(r);e.inArray(r.tagName.toLowerCase(),this.opts.inlineTags)!=-1&&!i.hasClass("redactor-selection-marker")&&(i.css(t,""),this.utils.removeEmptyAttr(i,"style"),i[0].attributes.length===0&&i.replaceWith(i.contents()))},this)),this.selection.restore(),this.code.sync()},removeFormat:function(){this.buffer.set();var t=this.selection.getCurrent();this.selection.save(),document.execCommand("removeFormat"),t&&t.tagName==="SPAN"&&e(t).replaceWith(e(t).contents()),e.each(this.selection.getNodes(),e.proxy(function(t,n){var r=e(n);e.inArray(n.tagName.toLowerCase(),this.opts.inlineTags)!=-1&&!r.hasClass("redactor-selection-marker")&&r.replaceWith(r.contents())},this)),this.selection.restore(),this.code.sync()},toggleClass:function(e){this.inline.format("span","class",e)},toggleStyle:function(e){this.inline.format("span","style",e)}}},insert:function(){return{set:function(t,n){this.placeholder.remove(),t=this.clean.setVerified(t),typeof n=="undefined"&&(t=this.clean.onPaste(t,!1)),this.$editor.html(t),this.selection.remove(),this.focus.setEnd(),this.clean.normalizeLists(),this.code.sync(),this.observe.load(),typeof n=="undefined"&&setTimeout(e.proxy(this.clean.clearUnverified,this),10)},text:function(t){this.placeholder.remove(),t=t.toString(),t=e.trim(t),t=this.clean.getPlainText(t,!1),this.$editor.focus();if(this.utils.browser("msie"))this.insert.htmlIe(t);else{this.selection.get(),this.range.deleteContents();var n=document.createElement("div");n.innerHTML=t;var r=document.createDocumentFragment(),i,s;while(i=n.firstChild)s=r.appendChild(i);this.range.insertNode(r);if(s){var o=this.range.cloneRange();o.setStartAfter(s),o.collapse(!0),this.sel.removeAllRanges(),this.sel.addRange(o)}}this.code.sync(),this.clean.clearUnverified()},htmlWithoutClean:function(e){this.insert.html(e,!1)},html:function(t,n){this.placeholder.remove(),typeof n=="undefined"&&(n=!0),this.$editor.focus(),t=this.clean.setVerified(t),n&&(t=this.clean.onPaste(t)),this.utils.browser("msie")?this.insert.htmlIe(t):(this.clean.singleLine?this.insert.execHtml(t):document.execCommand("insertHTML",!1,t),this.insert.htmlFixMozilla()),this.clean.normalizeLists(),this.opts.linebreaks||this.$editor.find("p").each(e.proxy(this.utils.removeEmpty,this)),this.code.sync(),this.observe.load(),n&&this.clean.clearUnverified()},htmlFixMozilla:function(){if(!this.utils.browser("mozilla"))return;var t=e(this.selection.getBlock()).next();t.length>0&&t[0].tagName=="P"&&t.html()===""&&t.remove()},htmlIe:function(t){if(this.utils.isIe11()){var n=this.utils.isCurrentOrParent("P"),r=e("<div>").append(t),i=r.contents().is("p, :header, dl, ul, ol, div, table, td, blockquote, pre, address, section, header, footer, aside, article");n&&i?this.insert.ie11FixInserting(n,t):this.insert.ie11PasteFrag(t);return}document.selection.createRange().pasteHTML(t)},execHtml:function(e){e=this.clean.setVerified(e),this.selection.get(),this.range.deleteContents();var t=document.createElement("div");t.innerHTML=e;var n=document.createDocumentFragment(),r,i;while(r=t.firstChild)i=n.appendChild(r);this.range.insertNode(n),this.range.collapse(!0),this.caret.setAfter(i)},node:function(t,n){t=t[0]||t;var r=this.utils.getOuterHtml(t);return r=this.clean.setVerified(r),r.match(/</g)!==null&&(t=e(r)[0]),this.selection.get(),n!==!1&&this.range.deleteContents(),this.range.insertNode(t),this.range.collapse(!1),this.selection.addRange(),t},nodeToPoint:function(e,t,n){e=e[0]||e,this.selection.get();var r;if(document.caretPositionFromPoint){var i=document.caretPositionFromPoint(t,n);this.range.setStart(i.offsetNode,i.offset),this.range.collapse(!0),this.range.insertNode(e)}else if(document.caretRangeFromPoint)r=document.caretRangeFromPoint(t,n),r.insertNode(e);else if(typeof document.body.createTextRange!="undefined"){r=document.body.createTextRange(),r.moveToPoint(t,n);var s=r.duplicate();s.moveToPoint(t,n),r.setEndPoint("EndToEnd",s),r.select()}},nodeToCaretPositionFromPoint:function(e,t){t=t[0]||t;var n,r=e.clientX,i=e.clientY;if(document.caretPositionFromPoint){var s=document.caretPositionFromPoint(r,i),o=document.getSelection();n=o.getRangeAt(0),n.setStart(s.offsetNode,s.offset),n.collapse(!0),n.insertNode(t)}else if(document.caretRangeFromPoint)n=document.caretRangeFromPoint(r,i),n.insertNode(t);else if(typeof document.body.createTextRange!="undefined"){n=document.body.createTextRange(),n.moveToPoint(r,i);var u=n.duplicate();u.moveToPoint(r,i),n.setEndPoint("EndToEnd",u),n.select()}},ie11FixInserting:function(t,n){var r=document.createElement("span");r.className="redactor-ie-paste",this.insert.node(r);var i=e(t).html();i="<p>"+i.replace(/<span class="redactor-ie-paste"><\/span>/gi,"</p>"+n+"<p>")+"</p>",e(t).replaceWith(i)},ie11PasteFrag:function(e){this.selection.get(),this.range.deleteContents();var t=document.createElement("div");t.innerHTML=e;var n=document.createDocumentFragment(),r,i;while(r=t.firstChild)i=n.appendChild(r);this.range.insertNode(n),this.range.collapse(!1),this.selection.addRange()}}},keydown:function(){return{init:function(t){if(this.rtePaste)return;var n=t.which,r=n>=37&&n<=40;this.keydown.ctrl=t.ctrlKey||t.metaKey,this.keydown.current=this.selection.getCurrent(),this.keydown.parent=this.selection.getParent(),this.keydown.block=this.selection.getBlock(),this.keydown.pre=this.utils.isTag(this.keydown.current,"pre"),this.keydown.blockquote=this.utils.isTag(this.keydown.current,"blockquote"),this.keydown.figcaption=this.utils.isTag(this.keydown.current,"figcaption"),this.shortcuts.init(t,n),this.keydown.checkEvents(r,n),this.keydown.setupBuffer(t,n),this.keydown.addArrowsEvent(r),this.keydown.setupSelectAll(t,n);var i=this.core.setCallback("keydown",t);if(i===!1)return t.preventDefault(),!1;if(this.opts.enterKey&&(this.utils.browser("msie")||this.utils.browser("mozilla"))&&(n===this.keyCode.DOWN||n===this.keyCode.RIGHT)){var s=!1,o=!1;this.keydown.block&&this.keydown.block.tagName==="TD"&&(o=e(this.keydown.block).closest("table")),o&&o.find("td").last()[0]===this.keydown.block&&(s=!0);if(this.utils.isEndOfElement()&&s){var u=e(this.opts.emptyHtml);o.after(u),this.caret.setStart(u)}}this.opts.enterKey&&n===this.keyCode.DOWN&&this.keydown.onArrowDown();if(!this.opts.enterKey&&n===this.keyCode.ENTER){t.preventDefault(),this.range.collapsed||this.range.deleteContents();return}if(n==this.keyCode.ENTER&&!t.shiftKey&&!t.ctrlKey&&!t.metaKey){var a=this.core.setCallback("enter",t);if(a===!1)return t.preventDefault(),!1;if(this.keydown.blockquote&&this.keydown.exitFromBlockquote(t)===!0)return!1;var f,l;if(this.keydown.pre)return this.keydown.insertNewLine(t);if(this.keydown.blockquote||this.keydown.figcaption)return f=this.selection.getCurrent(),l=e(f).next(),l.length!==0&&l[0].tagName=="BR"?this.keydown.insertBreakLine(t):this.utils.isEndOfElement()&&f&&f!="SPAN"?this.keydown.insertDblBreakLine(t):this.keydown.insertBreakLine(t);if(this.opts.linebreaks&&!this.keydown.block)return f=this.selection.getCurrent(),l=e(this.keydown.current).next(),l.length!==0&&l[0].tagName=="BR"?this.keydown.insertBreakLine(t):f!==!1&&e(f).hasClass("redactor-invisible-space")?(this.caret.setAfter(f),e(f).contents().unwrap(),this.keydown.insertDblBreakLine(t)):this.utils.isEndOfEditor()?this.keydown.insertDblBreakLine(t):l.length===0&&f===!1&&typeof l.context!="undefined"?this.keydown.insertBreakLine(t):this.keydown.insertBreakLine(t);if(this.opts.linebreaks&&this.keydown.block)setTimeout(e.proxy(this.keydown.replaceDivToBreakLine,this),1);else if(!this.opts.linebreaks&&this.keydown.block)if(this.keydown.block.tagName!=="LI")setTimeout(e.proxy(this.keydown.replaceDivToParagraph,this),1);else{f=this.selection.getCurrent();var c=e(f).closest("li"),h=c.closest("ul,ol");if(c.length!==0&&this.utils.isEmpty(c.html())&&h.next().length===0){var u=e(this.opts.emptyHtml);return h.after(u),this.caret.setStart(u),!1}}else if(!this.opts.linebreaks&&!this.keydown.block)return this.keydown.insertParagraph(t)}if(n===this.keyCode.ENTER&&(t.ctrlKey||t.shiftKey))return this.keydown.onShiftEnter(t);if(n===this.keyCode.TAB||t.metaKey&&n===221||t.metaKey&&n===219)return this.keydown.onTab(t,n);if(n===this.keyCode.BACKSPACE||n===this.keyCode.DELETE){if(this.utils.browser("mozilla")&&this.keydown.current&&this.keydown.current.tagName==="TD")return t.preventDefault(),!1;var p=this.selection.getNodes();if(p){var d=p.length,v;for(var m=0;m<d;m++){var g=e(p[m]).children("img");if(g.length!==0){var y=this;e.each(g,function(t,n){var r=e(n);if(r.css("float")!="none")return;y.core.setCallback("imageDelete",n.src,r),v=n})}else p[m].tagName=="IMG"&&v!=p[m]&&(this.core.setCallback("imageDelete",p[m].src,e(p[m])),v=p[m])}}}n===this.keyCode.BACKSPACE&&(this.keydown.removeInvisibleSpace(),this.keydown.removeEmptyListInTable(t)),this.code.sync()},checkEvents:function(e,t){!e&&(this.core.getEvent()=="click"||this.core.getEvent()=="arrow")&&(this.core.addEvent(!1),this.keydown.checkKeyEvents(t)&&this.buffer.set())},checkKeyEvents:function(t){var n=this.keyCode,r=[n.BACKSPACE,n.DELETE,n.ENTER,n.SPACE,n.ESC,n.TAB,n.CTRL,n.META,n.ALT,n.SHIFT];return e.inArray(t,r)==-1?!0:!1},addArrowsEvent:function(e){if(!e)return;if(this.core.getEvent()=="click"||this.core.getEvent()=="arrow"){this.core.addEvent(!1);return}this.core.addEvent("arrow")},setupBuffer:function(e,t){if(this.keydown.ctrl&&t===90&&!e.shiftKey&&!e.altKey&&this.opts.buffer.length){e.preventDefault(),this.buffer.undo();return}if(this.keydown.ctrl&&t===90&&e.shiftKey&&!e.altKey&&this.opts.rebuffer.length!==0){e.preventDefault(),this.buffer.redo();return}this.keydown.ctrl||(t==this.keyCode.BACKSPACE||t==this.keyCode.DELETE||t==this.keyCode.ENTER&&!e.ctrlKey&&!e.shiftKey||t==this.keyCode.SPACE)&&this.buffer.set()},setupSelectAll:function(e,t){this.keydown.ctrl&&t===65?this.utils.enableSelectAll():t!=this.keyCode.LEFT_WIN&&!this.keydown.ctrl&&this.utils.disableSelectAll()},onArrowDown:function(){var e=[this.keydown.blockquote,this.keydown.pre,this.keydown.figcaption];for(var t=0;t<e.length;t++)if(e[t])return this.keydown.insertAfterLastElement(e[t]),!1},onShiftEnter:function(e){return this.buffer.set(),this.utils.isEndOfElement()?this.keydown.insertDblBreakLine(e):this.keydown.insertBreakLine(e)},onTab:function(e,t){if(!this.opts.tabKey)return!0;if(this.utils.isEmpty(this.code.get())&&this.opts.tabAsSpaces===!1)return!0;e.preventDefault();var n;return this.keydown.pre&&!e.shiftKey?(n=this.opts.preSpaces?document.createTextNode(Array(this.opts.preSpaces+1).join(" ")):document.createTextNode("	"),this.insert.node(n),this.code.sync()):this.opts.tabAsSpaces!==!1?(n=document.createTextNode(Array(this.opts.tabAsSpaces+1).join(" ")),this.insert.node(n),this.code.sync()):e.metaKey&&t===219?this.indent.decrease():e.metaKey&&t===221?this.indent.increase():e.shiftKey?this.indent.decrease():this.indent.increase(),!1},replaceDivToBreakLine:function(){var t=this.selection.getBlock(),n=t.innerHTML.replace(/<br\s?\/?>/gi,"");if((t.tagName==="DIV"||t.tagName==="P")&&n===""&&!e(t).hasClass("redactor-editor")){var r=document.createElement("br");return e(t).replaceWith(r),this.caret.setBefore(r),this.code.sync(),!1}},replaceDivToParagraph:function(){var t=this.selection.getBlock(),n=t.innerHTML.replace(/<br\s?\/?>/gi,"");if(t.tagName==="DIV"&&n===""&&!e(t).hasClass("redactor-editor")){var r=document.createElement("p");return r.innerHTML=this.opts.invisibleSpace,e(t).replaceWith(r),this.caret.setStart(r),this.code.sync(),!1}this.opts.cleanStyleOnEnter&&t.tagName=="P"&&e(t).removeAttr("class").removeAttr("style")},insertParagraph:function(e){e.preventDefault(),this.selection.get();var t=document.createElement("p");return t.innerHTML=this.opts.invisibleSpace,this.range.deleteContents(),this.range.insertNode(t),this.caret.setStart(t),this.code.sync(),!1},exitFromBlockquote:function(t){if(!this.utils.isEndOfElement())return;var n=e.trim(e(this.keydown.block).html());if(n.search(/(<br\s?\/?>){2}$/i)!=-1){t.preventDefault();if(this.opts.linebreaks){var r=document.createElement("br");e(this.keydown.blockquote).after(r),this.caret.setBefore(r),e(this.keydown.block).html(n.replace(/<br\s?\/?>$/i,""))}else{var i=e(this.opts.emptyHtml);e(this.keydown.blockquote).after(i),this.caret.setStart(i)}return!0}return},insertAfterLastElement:function(t){if(!this.utils.isEndOfElement())return;this.buffer.set();if(this.opts.linebreaks){var n=e("<div>").append(e.trim(this.$editor.html())).contents(),r=n.last()[0];r.tagName=="SPAN"&&r.innerHTML===""&&(r=n.prev()[0]);if(this.utils.getOuterHtml(r)!=this.utils.getOuterHtml(t))return;var i=document.createElement("br");e(t).after(i),this.caret.setAfter(i)}else{if(this.$editor.contents().last()[0]!==t)return;var s=e(this.opts.emptyHtml);e(t).after(s),this.caret.setStart(s)}},insertNewLine:function(e){e.preventDefault();var t=document.createTextNode("\n");return this.selection.get(),this.range.deleteContents(),this.range.insertNode(t),this.caret.setAfter(t),this.code.sync(),!1},insertBreakLine:function(e){return this.keydown.insertBreakLineProcessing(e)},insertDblBreakLine:function(e){return this.keydown.insertBreakLineProcessing(e,!0)},insertBreakLineProcessing:function(t,n){t.stopPropagation(),this.selection.get();var r=document.createElement("br");this.utils.browser("msie")?(this.range.collapse(!1),this.range.setEnd(this.range.endContainer,this.range.endOffset)):this.range.deleteContents(),this.range.insertNode(r);if(n===!0){var i=e(r).next();if(i.length!==0&&i[0].tagName==="BR"&&this.utils.isEndOfEditor())return this.caret.setAfter(r),this.code.sync(),!1;var s=document.createElement("br");this.range.insertNode(s),this.caret.setAfter(s)}else this.keydown.insertBreakLineProcessingAfter(r);return this.code.sync(),!1},insertBreakLineProcessingAfter:function(t){var n=this.utils.createSpaceElement();e(t).after(n),this.selection.selectElement(n),e(n).replaceWith(function(){return e(this).contents()})},removeInvisibleSpace:function(){var t=e(this.keydown.current);t.text().search(/^\u200B$/g)===0&&t.remove()},removeEmptyListInTable:function(t){var n=e(this.keydown.current),r=e(this.keydown.parent),i=n.closest("td");if(i.length!==0&&n.closest("li")&&r.children("li").length===1){if(!this.utils.isEmpty(n.text()))return;t.preventDefault(),n.remove(),r.remove(),this.caret.setStart(i)}}}},keyup:function(){return{init:function(t){if(this.rtePaste)return;var n=t.which;this.keyup.current=this.selection.getCurrent(),this.keyup.parent=this.selection.getParent();var r=this.utils.isRedactorParent(e(this.keyup.parent).parent()),i=this.core.setCallback("keyup",t);if(i===!1)return t.preventDefault(),!1;!this.opts.linebreaks&&this.keyup.current.nodeType==3&&this.keyup.current.length<=1&&(this.keyup.parent===!1||this.keyup.parent.tagName=="BODY")&&this.keyup.replaceToParagraph(),!this.opts.linebreaks&&this.utils.isRedactorParent(this.keyup.current)&&this.keyup.current.tagName==="DIV"&&this.keyup.replaceToParagraph(!1),!this.opts.linebreaks&&e(this.keyup.parent).hasClass("redactor-invisible-space")&&(r===!1||r[0].tagName=="BODY")&&(e(this.keyup.parent).contents().unwrap(),this.keyup.replaceToParagraph()),this.keyup.isLinkify(n)&&(this.formatLinkify(this.opts.linkProtocol,this.opts.convertLinks,this.opts.convertUrlLinks,this.opts.convertImageLinks,this.opts.convertVideoLinks,this.opts.linkSize),this.observe.load(),this.code.sync());if(n===this.keyCode.DELETE||n===this.keyCode.BACKSPACE)return this.clean.clearUnverified(),this.observe.image?(t.preventDefault(),this.image.hideResize(),this.buffer.set(),this.image.remove(this.observe.image),this.observe.image=!1,!1):(this.$editor.find("p").each(e.proxy(this.utils.removeEmpty,this)),this.opts.linebreaks&&this.keyup.current&&this.keyup.current.tagName=="DIV"&&this.utils.isEmpty(this.keyup.current.innerHTML)&&(e(this.keyup.current).after(this.selection.getMarkerAsHtml()),this.selection.restore(),e(this.keyup.current).remove()),this.keyup.formatEmpty(t))},isLinkify:function(e){return this.opts.convertLinks&&(this.opts.convertUrlLinks||this.opts.convertImageLinks||this.opts.convertVideoLinks)&&e===this.keyCode.ENTER&&!this.utils.isCurrentOrParent("PRE")},replaceToParagraph:function(t){var n=e(this.keyup.current),r;t===!1?r=e("<p>").append(n.html()):r=e("<p>").append(n.clone()),n.replaceWith(r);var i=e(r).next();typeof i[0]!="undefined"&&i[0].tagName=="BR"&&i.remove(),this.caret.setEnd(r)},formatEmpty:function(t){var n=e.trim(this.$editor.html());if(!this.utils.isEmpty(n))return;return t.preventDefault(),this.opts.linebreaks?(this.$editor.html(this.selection.getMarkerAsHtml()),this.selection.restore()):(n="<p><br /></p>",this.$editor.html(n),this.focus.setStart()),this.code.sync(),!1}}},lang:function(){return{load:function(){this.opts.curLang=this.opts.langs[this.opts.lang]},get:function(e){return typeof this.opts.curLang[e]!="undefined"?this.opts.curLang[e]:""}}},line:function(){return{insert:function(){this.buffer.set();var e=this.selection.getBlocks();if(e[0]!==!1&&this.line.isExceptLastOrFirst(e)){this.utils.browser("msie")||this.$editor.focus();return}this.utils.browser("msie")?this.line.insertInIe():this.line.insertInOthersBrowsers()},isExceptLastOrFirst:function(t){var n=["li","td","th","blockquote","figcaption","pre","dl","dt","dd"],r=t[0].tagName.toLowerCase(),i=this.selection.getLastBlock();i=typeof i=="undefined"?r:i.tagName.toLowerCase();var s=e.inArray(r,n)!=-1,o=e.inArray(i,n)!=-1;if(s&&o||s)return!0},insertInIe:function(){this.utils.saveScroll(),this.buffer.set(),this.insert.node(document.createElement("hr")),this.utils.restoreScroll(),this.code.sync()},insertInOthersBrowsers:function(){this.buffer.set();var e='<p id="redactor-insert-line"><br /></p>';this.opts.linebreaks&&(e='<br id="redactor-insert-line">'),document.execCommand("insertHTML",!1,"<hr>"+e),this.line.setFocus(),this.code.sync()},setFocus:function(){var t=this.$editor.find("#redactor-insert-line"),n=e(t).next()[0];n?(this.caret.setAfter(t),t.remove()):t.removeAttr("id")}}},link:function(){return{show:function(t){typeof t!="undefined"&&t.preventDefault&&t.preventDefault(),this.modal.load("link",this.lang.get("link_insert"),600),this.modal.createCancelButton(),this.link.buttonInsert=this.modal.createActionButton(this.lang.get("insert")),this.selection.get(),this.link.getData(),this.link.cleanUrl(),this.link.target=="_blank"&&e("#redactor-link-blank").prop("checked",!0),this.link.$inputUrl=e("#redactor-link-url"),this.link.$inputText=e("#redactor-link-url-text"),this.link.$inputText.val(this.link.text),this.link.$inputUrl.val(this.link.url),this.link.buttonInsert.on("click",e.proxy(this.link.insert,this)),e(".redactor-link-tooltip").remove(),this.selection.save(),this.modal.show(),this.link.$inputUrl.focus()},cleanUrl:function(){var e=self.location.href.replace(/\/$/i,"");this.link.url=this.link.url.replace(e,""),this.link.url=this.link.url.replace(/^\/#/,"#"),this.link.url=this.link.url.replace("mailto:","");if(!this.opts.linkProtocol){var t=new RegExp("^(http|ftp|https)://"+self.location.host,"i");this.link.url=this.link.url.replace(t,"")}},getData:function(){this.link.$node=!1;var t=e(this.selection.getCurrent()).closest("a");t.length!==0&&t[0].tagName==="A"?(this.link.$node=t,this.link.url=t.attr("href"),this.link.text=t.text(),this.link.target=t.attr("target")):(this.link.text=this.sel.toString(),this.link.url="",this.link.target="")},insert:function(){var t="",n=this.link.$inputUrl.val(),r=this.link.$inputText.val();if(e.trim(n)===""){this.link.$inputUrl.addClass("redactor-input-error").on("keyup",function(){e(this).removeClass("redactor-input-error"),e(this).off("keyup")});return}if(n.search("@")!=-1&&/(http|ftp|https):\/\//i.test(n)===!1)n="mailto:"+n;else if(n.search("#")!==0){e("#redactor-link-blank").prop("checked")&&(t="_blank");var i="((xn--)?[a-z0-9]+(-[a-z0-9]+)*\\.)+[a-z]{2,}",s=new RegExp("^(http|ftp|https)://"+i,"i"),o=new RegExp("^"+i,"i"),u=new RegExp(".(html|php)$","i");n.search(s)==-1&&n.search(u)==-1&&n.search(o)===0&&this.opts.linkProtocol&&(n=this.opts.linkProtocol+"://"+n)}this.link.set(r,n,t),this.modal.close()},set:function(t,n,r){t=e.trim(t.replace(/<|>/g,"")),this.selection.restore();if(t===""&&n==="")return;t===""&&n!==""&&(t=n);if(this.link.$node)this.buffer.set(),this.link.$node.text(t).attr("href",n),r!==""?this.link.$node.attr("target",r):this.link.$node.removeAttr("target"),this.code.sync();else{if(this.utils.browser("mozilla")&&this.link.text===""){var i=e("<a />").attr("href",n).text(t);r!==""&&i.attr("target",r),this.insert.node(i),this.selection.selectElement(i)}else{var i;if(this.utils.browser("msie"))i=e('<a href="'+n+'">').text(t),r!==""&&i.attr("target",r),i=e(this.insert.node(i)),this.selection.selectElement(i);else{document.execCommand("createLink",!1,n),i=e(this.selection.getCurrent()).closest("a"),this.utils.browser("mozilla")&&(i=e('a[_moz_dirty=""]')),r!==""&&i.attr("target",r),i.removeAttr("style").removeAttr("_moz_dirty");if(this.link.text!==""||this.link.text!=t)i.text(t),this.selection.selectElement(i)}}this.code.sync(),this.core.setCallback("insertedLink",i)}setTimeout(e.proxy(function(){this.observe.links()},this),5)},unlink:function(t){typeof t!="undefined"&&t.preventDefault&&t.preventDefault();var n=this.selection.getNodes();if(!n)return;this.buffer.set();var r=n.length;for(var i=0;i<r;i++){var s=e(n[i]).closest("a");s.replaceWith(s.contents())}e(".redactor-link-tooltip").remove(),this.code.sync()},toggleClass:function(e){this.link.setClass(e,"toggleClass")},addClass:function(e){this.link.setClass(e,"addClass")},removeClass:function(e){this.link.setClass(e,"removeClass")},setClass:function(t,n){var r=this.selection.getInlinesTags(["a"]);if(r===!1)return;e.each(r,function(){e(this)[n](t)})}}},list:function(){return{toggle:function(t){this.placeholder.remove(),this.utils.browser("msie")||this.$editor.focus(),this.buffer.set(),this.selection.save();var n=this.selection.getParent(),r=e(n).closest("ol, ul");!this.utils.isRedactorParent(r)&&r.length!==0&&(r=!1);var i,s,o=!1;if(r&&r.length){o=!0;var u=r[0].tagName;i=t==="orderedlist"&&u==="UL",s=t==="unorderedlist"&&u==="OL"}i?this.utils.replaceToTag(r,"ol"):s?this.utils.replaceToTag(r,"ul"):o?this.list.remove(t):this.list.insert(t),this.selection.restore(),this.code.sync()},insert:function(t){var n=this.selection.getParent(),r=this.selection.getCurrent(),i=e(r).closest("td, th");this.utils.browser("msie")&&this.opts.linebreaks?this.list.insertInIe(t):document.execCommand("insert"+t);var s=e(this.selection.getParent()).closest("ol, ul");if(i.length!==0){var o=i.prev(),u=i.html();i.html(""),!o||o.length!==1||o[0].tagName!=="TD"&&o[0].tagName!=="TH"?e(n).prepend(i):e(o).after(i),i.html(u)}if(this.utils.isEmpty(s.find("li").text())){var a=s.children("li");a.find("br").remove(),a.append(this.selection.getMarkerAsHtml())}if(s.length){var f=s.parent();this.utils.isRedactorParent(f)&&f[0].tagName!="LI"&&this.utils.isBlock(f[0])&&f.replaceWith(f.contents())}this.utils.browser("msie")||this.$editor.focus(),this.clean.clearUnverified()},insertInIe:function(t){var n=this.selection.wrap("div"),r=e(n).html(),i=t=="orderedlist"?e("<ol>"):e("<ul>"),s=e("<li>");if(e.trim(r)==="")s.append(this.selection.getMarkerAsHtml()),i.append(s),this.$editor.find("#selection-marker-1").replaceWith(i);else{var o=r.split(/<br\s?\/?>/gi);if(o)for(var u=0;u<o.length;u++)e.trim(o[u])!==""&&i.append(e("<li>").html(o[u]));else s.append(r),i.append(s);e(n).replaceWith(i)}},remove:function(t){document.execCommand("insert"+t);var n=e(this.selection.getCurrent());this.indent.fixEmptyIndent(),!this.opts.linebreaks&&n.closest("li, th, td").length===0&&(document.execCommand("formatblock",!1,"p"),this.$editor.find("ul, ol, blockquote").each(e.proxy(this.utils.removeEmpty,this)));var r=e(this.selection.getCurrent()).closest("table"),i=r.prev();!this.opts.linebreaks&&r.length!==0&&i.length!==0&&i[0].tagName=="BR"&&i.remove(),this.clean.clearUnverified()}}},modal:function(){return{callbacks:{},loadTemplates:function(){this.opts.modal={imageEdit:String()+'<section id="redactor-modal-image-edit">'+"<label>"+this.lang.get("title")+"</label>"+'<input type="text" id="redactor-image-title" />'+'<label class="redactor-image-link-option">'+this.lang.get("link")+"</label>"+'<input type="text" id="redactor-image-link" class="redactor-image-link-option" />'+'<label class="redactor-image-link-option"><input type="checkbox" id="redactor-image-link-blank"> '+this.lang.get("link_new_tab")+"</label>"+'<label class="redactor-image-position-option">'+this.lang.get("image_position")+"</label>"+'<select class="redactor-image-position-option" id="redactor-image-align">'+'<option value="none">'+this.lang.get("none")+"</option>"+'<option value="left">'+this.lang.get("left")+"</option>"+'<option value="center">'+this.lang.get("center")+"</option>"+'<option value="right">'+this.lang.get("right")+"</option>"+"</select>"+"</section>",image:String()+'<section id="redactor-modal-image-insert">'+'<div id="redactor-modal-image-droparea"></div>'+"</section>",file:String()+'<section id="redactor-modal-file-insert">'+'<div id="redactor-modal-file-upload-box">'+"<label>"+this.lang.get("filename")+"</label>"+'<input type="text" id="redactor-filename" /><br><br>'+'<div id="redactor-modal-file-upload"></div>'+"</div>"+"</section>",link:String()+'<section id="redactor-modal-link-insert">'+"<label>URL</label>"+'<input type="url" id="redactor-link-url" />'+"<label>"+this.lang.get("text")+"</label>"+'<input type="text" id="redactor-link-url-text" />'+'<label><input type="checkbox" id="redactor-link-blank"> '+this.lang.get("link_new_tab")+"</label>"+"</section>"},e.extend(this.opts,this.opts.modal)},addCallback:function(e,t){this.modal.callbacks[e]=t},createTabber:function(t){this.modal.$tabber=e("<div>").attr("id","redactor-modal-tabber"),t.prepend(this.modal.$tabber)},addTab:function(t,n,r){var i=e('<a href="#" rel="tab'+t+'">').text(n);r&&i.addClass("active");var s=this;i.on("click",function(t){t.preventDefault(),e(".redactor-tab").hide(),e(".redactor-"+e(this).attr("rel")).show(),s.modal.$tabber.find("a").removeClass("active"),e(this).addClass("active")}),this.modal.$tabber.append(i)},addTemplate:function(e,t){this.opts.modal[e]=t},getTemplate:function(e){return this.opts.modal[e]},getModal:function(){return this.$modalBody.find("section")},load:function(e,t,n){this.modal.templateName=e,this.modal.width=n,this.modal.build(),this.modal.enableEvents(),this.modal.setTitle(t),this.modal.setDraggable(),this.modal.setContent(),typeof this.modal.callbacks[e]!="undefined"&&this.modal.callbacks[e].call(this)},show:function(){this.utils.isMobile()&&!this.utils.browser("msie")&&document.activeElement.blur(),e(document.body).removeClass("body-redactor-hidden"),this.modal.bodyOveflow=e(document.body).css("overflow"),e(document.body).css("overflow","hidden"),this.utils.isMobile()?this.modal.showOnMobile():this.modal.showOnDesktop(),this.$modalOverlay.show(),this.$modalBox.show(),this.modal.setButtonsWidth(),this.utils.saveScroll(),this.utils.isMobile()||(setTimeout(e.proxy(this.modal.showOnDesktop,this),0),e(window).on("resize.redactor-modal",e.proxy(this.modal.resize,this))),this.core.setCallback("modalOpened",this.modal.templateName,this.$modal),e(document).off("focusin.modal"),this.$modal.find("input[type=text],input[type=url],input[type=email]").on("keydown.redactor-modal",e.proxy(this.modal.setEnter,this))},showOnDesktop:function(){var t=this.$modal.outerHeight(),n=e(window).height(),r=e(window).width();if(this.modal.width>r){this.$modal.css({width:"96%",marginTop:n/2-t/2+"px"});return}t>n?this.$modal.css({width:this.modal.width+"px",marginTop:"20px"}):this.$modal.css({width:this.modal.width+"px",marginTop:n/2-t/2+"px"})},showOnMobile:function(){this.$modal.css({width:"96%",marginTop:"2%"})},resize:function(){this.utils.isMobile()?this.modal.showOnMobile():this.modal.showOnDesktop()},setTitle:function(e){this.$modalHeader.html(e)},setContent:function(){this.$modalBody.html(this.modal.getTemplate(this.modal.templateName))},setDraggable:function(){if(typeof e.fn.draggable=="undefined")return;this.$modal.draggable({handle:this.$modalHeader}),this.$modalHeader.css("cursor","move")},setEnter:function(e){if(e.which!=13)return;e.preventDefault(),this.$modal.find("button.redactor-modal-action-btn").click()},createCancelButton:function(){var t=e("<button>").addClass("redactor-modal-btn redactor-modal-close-btn").html(this.lang.get("cancel"));t.on("click",e.proxy(this.modal.close,this)),this.$modalFooter.append(t)},createDeleteButton:function(e){return this.modal.createButton(e,"delete")},createActionButton:function(e){return this.modal.createButton(e,"action")},createButton:function(t,n){var r=e("<button>").addClass("redactor-modal-btn").addClass("redactor-modal-"+n+"-btn").html(t);return this.$modalFooter.append(r),r},setButtonsWidth:function(){var e=this.$modalFooter.find("button"),t=e.length;if(t===0)return;e.css("width",100/t+"%")},build:function(){this.modal.buildOverlay(),this.$modalBox=e('<div id="redactor-modal-box" />').hide(),this.$modal=e('<div id="redactor-modal" />'),this.$modalHeader=e("<header />"),this.$modalClose=e('<span id="redactor-modal-close" />').html("&times;"),this.$modalBody=e('<div id="redactor-modal-body" />'),this.$modalFooter=e("<footer />"),this.$modal.append(this.$modalHeader),this.$modal.append(this.$modalClose),this.$modal.append(this.$modalBody),this.$modal.append(this.$modalFooter),this.$modalBox.append(this.$modal),this.$modalBox.appendTo(document.body)},buildOverlay:function(){this.$modalOverlay=e('<div id="redactor-modal-overlay">').hide(),e("body").prepend(this.$modalOverlay)},enableEvents:function(){this.$modalClose.on("click.redactor-modal",e.proxy(this.modal.close,this)),e(document).on("keyup.redactor-modal",e.proxy(this.modal.closeHandler,this)),this.$editor.on("keyup.redactor-modal",e.proxy(this.modal.closeHandler,this)),this.$modalBox.on("click.redactor-modal",e.proxy(this.modal.close,this))},disableEvents:function(){this.$modalClose.off("click.redactor-modal"),e(document).off("keyup.redactor-modal"),this.$editor.off("keyup.redactor-modal"),this.$modalBox.off("click.redactor-modal"),e(window).off("resize.redactor-modal")},closeHandler:function(e){if(e.which!=this.keyCode.ESC)return;this.modal.close(!1)},close:function(t){if(t){if(!e(t.target).hasClass("redactor-modal-close-btn")&&t.target!=this.$modalClose[0]&&t.target!=this.$modalBox[0])return;t.preventDefault()}if(!this.$modalBox)return;this.modal.disableEvents(),this.$modalOverlay.remove(),this.$modalBox.fadeOut("fast",e.proxy(function(){this.$modalBox.remove(),setTimeout(e.proxy(this.utils.restoreScroll,this),0),t!==undefined&&this.selection.restore(),e(document.body).css("overflow",this.modal.bodyOveflow),this.core.setCallback("modalClosed",this.modal.templateName)},this))}}},observe:function(){return{load:function(){this.observe.images(),this.observe.links()},buttons:function(t,n){var r=this.selection.getCurrent(),i=this.selection.getParent();t!==!1?this.button.setInactiveAll():this.button.setInactiveAll(n);if(t===!1&&n!=="html"){e.inArray(n,this.opts.activeButtons)!=-1&&this.button.toggleActive(n);return}e.each(this.opts.activeButtonsStates,e.proxy(function(t,n){var s=e(i).closest(t),o=e(r).closest(t);if(s.length!==0&&!this.utils.isRedactorParent(s))return;if(!this.utils.isRedactorParent(o))return;(s.length!==0||o.closest(t).length!==0)&&this.button.setActive(n)},this));var s=e(i).closest(this.opts.alignmentTags.toString().toLowerCase());if(this.utils.isRedactorParent(i)&&s.length){var o=s.css("text-align")===""?"left":s.css("text-align");this.button.setActive("align"+o)}},addButton:function(e,t){this.opts.activeButtons.push(t),this.opts.activeButtonsStates[e]=t},images:function(){this.$editor.find("img").each(e.proxy(function(t,n){var r=e(n);r.closest("a").on("click",function(e){e.preventDefault()}),this.utils.browser("msie")&&r.attr("unselectable","on"),this.image.setEditable(r)},this)),e(document).on("click.redactor-image-delete."+this.uuid,e.proxy(function(e){this.observe.image=!1,e.target.tagName=="IMG"&&this.utils.isRedactorParent(e.target)&&(this.observe.image=this.observe.image&&this.observe.image==e.target?!1:e.target)},this))},links:function(){if(!this.opts.linkTooltip)return;this.$editor.find("a").on("touchstart.redactor."+this.uuid+" click.redactor."+this.uuid,e.proxy(this.observe.showTooltip,this)),this.$editor.on("touchstart.redactor."+this.uuid+" click.redactor."+this.uuid,e.proxy(this.observe.closeTooltip,this)),e(document).on("touchstart.redactor."+this.uuid+" click.redactor."+this.uuid,e.proxy(this.observe.closeTooltip,this))},getTooltipPosition:function(e){return e.offset()},showTooltip:function(t){var n=e(t.target),r=n.closest("a"),i=n.length!==0?n[0].tagName:!1;if(r[0].tagName==="A"){if(i==="IMG")return;i!=="A"&&(n=r)}if(i!=="A")return;var s=this.observe.getTooltipPosition(n),o=e('<span class="redactor-link-tooltip"></span>'),u=n.attr("href");u===undefined&&(u=""),u.length>24&&(u=u.substring(0,24)+"...");var a=e('<a href="'+n.attr("href")+'" target="_blank" />').html(u).addClass("redactor-link-tooltip-action"),f=e('<a href="#" />').html(this.lang.get("edit")).on("click",e.proxy(this.link.show,this)).addClass("redactor-link-tooltip-action"),l=e('<a href="#" />').html(this.lang.get("unlink")).on("click",e.proxy(this.link.unlink,this)).addClass("redactor-link-tooltip-action");o.append(a).append(" | ").append(f).append(" | ").append(l),o.css({top:s.top+parseInt(n.css("line-height"),10)+"px",left:s.left+"px"}),e(".redactor-link-tooltip").remove(),e("body").append(o)},closeTooltip:function(t){t=t.originalEvent||t;var n=t.target,r=e(n).closest("a");if(r.length!==0&&r[0].tagName==="A"&&n.tagName!=="A")return;if(n.tagName==="A"&&this.utils.isRedactorParent(n)||e(n).hasClass("redactor-link-tooltip-action"))return;e(".redactor-link-tooltip").remove()}}},paragraphize:function(){return{load:function(t){return this.opts.linebreaks?t:t===""||t==="<p></p>"?this.opts.emptyHtml:(this.paragraphize.blocks=["table","div","pre","form","ul","ol","h1","h2","h3","h4","h5","h6","dl","blockquote","figcaption","address","section","header","footer","aside","article","object","style","script","iframe","select","input","textarea","button","option","map","area","math","hr","fieldset","legend","hgroup","nav","figure","details","menu","summary","p"],t+="\n",this.paragraphize.safes=[],this.paragraphize.z=0,t=t.replace(/(<br\s?\/?>){1,}\n?<\/blockquote>/gi,"</blockquote>"),t=this.paragraphize.getSafes(t),t=this.paragraphize.getSafesComments(t),t=this.paragraphize.replaceBreaksToNewLines(t),t=this.paragraphize.replaceBreaksToParagraphs(t),t=this.paragraphize.clear(t),t=this.paragraphize.restoreSafes(t),t=t.replace(new RegExp("<br\\s?/?>\n?<("+this.paragraphize.blocks.join("|")+")(.*?[^>])>","gi"),"<p><br /></p>\n<$1$2>"),e.trim(t))},getSafes:function(t){var n=e("<div />").append(t);return n.find("blockquote p").replaceWith(function(){return e(this).append("<br />").contents()}),t=n.html(),n.find(this.paragraphize.blocks.join(", ")).each(e.proxy(function(e,n){this.paragraphize.z++,this.paragraphize.safes[this.paragraphize.z]=n.outerHTML,t=t.replace(n.outerHTML,"\n{replace"+this.paragraphize.z+"}")},this)),t},getSafesComments:function(t){var n=t.match(/<!--([\w\W]*?)-->/gi);return n?(e.each(n,e.proxy(function(e,n){this.paragraphize.z++,this.paragraphize.safes[this.paragraphize.z]=n,t=t.replace(n,"\n{replace"+this.paragraphize.z+"}")},this)),t):t},restoreSafes:function(t){return e.each(this.paragraphize.safes,function(e,n){n=typeof n!="undefined"?n.replace(/\$/g,"&#36;"):n,t=t.replace("{replace"+e+"}",n)}),t},replaceBreaksToParagraphs:function(e){var t=e.split(new RegExp("\n","g"),-1);e="";if(t){var n=t.length;for(var r=0;r<n;r++){if(!t.hasOwnProperty(r))return;t[r].search("{replace")==-1?(t[r]=t[r].replace(/<p>\n\t?<\/p>/gi,""),t[r]=t[r].replace(/<p><\/p>/gi,""),t[r]!==""&&(e+="<p>"+t[r].replace(/^\n+|\n+$/g,"")+"</p>")):e+=t[r]}}return e},replaceBreaksToNewLines:function(e){return e=e.replace(/<br \/>\s*<br \/>/gi,"\n\n"),e=e.replace(/<br\s?\/?>\n?<br\s?\/?>/gi,"\n<br /><br />"),e=e.replace(new RegExp("\r\n","g"),"\n"),e=e.replace(new RegExp("\r","g"),"\n"),e=e.replace(new RegExp("/\n\n+/"),"g","\n\n"),e},clear:function(e){return e=e.replace(new RegExp("</blockquote></p>","gi"),"</blockquote>"),e=e.replace(new RegExp("<p></blockquote>","gi"),"</blockquote>"),e=e.replace(new RegExp("<p><blockquote>","gi"),"<blockquote>"),e=e.replace(new RegExp("<blockquote></p>","gi"),"<blockquote>"),e=e.replace(new RegExp("<p><p ","gi"),"<p "),e=e.replace(new RegExp("<p><p>","gi"),"<p>"),e=e.replace(new RegExp("</p></p>","gi"),"</p>"),e=e.replace(new RegExp("<p>\\s?</p>","gi"),""),e=e.replace(new RegExp("\n</p>","gi"),"</p>"),e=e.replace(new RegExp("<p>	?	?\n?<p>","gi"),"<p>"),e=e.replace(new RegExp("<p>	*</p>","gi"),""),e}}},paste:function(){return{init:function(t){if(!this.opts.cleanOnPaste){setTimeout(e.proxy(this.code.sync,this),1);return}this.rtePaste=!0,this.buffer.set(),this.selection.save(),this.utils.saveScroll(),this.paste.createPasteBox(),e(window).on("scroll.redactor-freeze",e.proxy(function(){e(window).scrollTop(this.saveBodyScroll)},this)),setTimeout(e.proxy(function(){var t=this.$pasteBox.html();this.$pasteBox.remove(),this.selection.restore(),this.utils.restoreScroll(),this.paste.insert(t),e(window).off("scroll.redactor-freeze")},this),1)},createPasteBox:function(){this.$pasteBox=e("<div>").html("").attr("contenteditable","true").css({position:"fixed",width:0,top:0,left:"-9999px"}),this.utils.browser("msie")?this.$box.append(this.$pasteBox):e("body").append(this.$pasteBox),this.$pasteBox.focus()},insert:function(t){t=this.core.setCallback("pasteBefore",t),t=this.utils.isSelectAll()?this.clean.onPaste(t,!1):this.clean.onPaste(t),t=this.core.setCallback("paste",t),this.utils.isSelectAll()?this.insert.set(t,!1):this.insert.html(t,!1),this.utils.disableSelectAll(),this.rtePaste=!1,setTimeout(e.proxy(this.clean.clearUnverified,this),10),setTimeout(e.proxy(function(){var t=this.$editor.find("span");e.each(t,function(t,n){var r=n.innerHTML.replace(/[\u200B-\u200D\uFEFF]/,"");r===""&&n.attributes.length===0&&e(n).remove()})},this),10)}}},placeholder:function(){return{enable:function(){if(!this.placeholder.is())return;this.$editor.attr("placeholder",this.$element.attr("placeholder")),this.placeholder.toggle(),this.$editor.on("keyup.redactor-placeholder",e.proxy(this.placeholder.toggle,this))},toggle:function(){var e="removeClass";this.utils.isEmpty(this.$editor.html(),!1)&&(e="addClass"),this.$editor[e]("redactor-placeholder")},remove:function(){this.$editor.removeClass("redactor-placeholder")},is:function(){return this.opts.placeholder?this.$element.attr("placeholder",this.opts.placeholder):typeof this.$element.attr("placeholder")!="undefined"&&this.$element.attr("placeholder")!==""}}},progress:function(){return{show:function(){e(document.body).append(e('<div id="redactor-progress"><span></span></div>')),e("#redactor-progress").fadeIn()},hide:function(){e("#redactor-progress").fadeOut(1500,function(){e(this).remove()})}}},selection:function(){return{get:function(){this.sel=document.getSelection(),document.getSelection&&this.sel.getRangeAt&&this.sel.rangeCount?this.range=this.sel.getRangeAt(0):this.range=document.createRange()},addRange:function(){try{this.sel.removeAllRanges()}catch(e){}this.sel.addRange(this.range)},getCurrent:function(){var e=!1;return this.selection.get(),this.sel&&this.sel.rangeCount>0&&(e=this.sel.getRangeAt(0).startContainer),this.utils.isRedactorParent(e)},getParent:function(t){return t=t||this.selection.getCurrent(),t?this.utils.isRedactorParent(e(t).parent()[0]):!1},getBlock:function(t){t=t||this.selection.getCurrent();while(t){if(this.utils.isBlockTag(t.tagName))return e(t).hasClass("redactor-editor")?!1:t;t=t.parentNode}return!1},getInlines:function(t,n){this.selection.get();if(this.range&&this.range.collapsed)return!1;var r=[];t=typeof t=="undefined"||t===!1?this.selection.getNodes():t;var i=this.opts.inlineTags;i.push("span");if(typeof n!="undefined")for(var s=0;s<n.length;s++)i.push(n[s]);return e.each(t,e.proxy(function(t,n){e.inArray(n.tagName.toLowerCase(),i)!=-1&&r.push(n)},this)),r.length===0?!1:r},getInlinesTags:function(t){this.selection.get();if(this.range&&this.range.collapsed)return!1;var n=[],r=this.selection.getNodes();return e.each(r,e.proxy(function(r,i){e.inArray(i.tagName.toLowerCase(),t)!=-1&&n.push(i)},this)),n.length===0?!1:n},getBlocks:function(t){this.selection.get();if(this.range&&this.range.collapsed)return[this.selection.getBlock()];var n=[];return t=typeof t=="undefined"?this.selection.getNodes():t,e.each(t,e.proxy(function(e,t){this.utils.isBlock(t)&&(this.selection.lastBlock=t,n.push(t))},this)),n.length===0?[this.selection.getBlock()]:n},getLastBlock:function(){return this.selection.lastBlock},getNodes:function(){this.selection.get();var t=this.selection.getNodesMarker(1),n=this.selection.getNodesMarker(2),r=this.range.cloneRange();if(this.range.collapsed===!1){var i=r.startContainer,s=r.startOffset;this.selection.setNodesMarker(r,n,!1),r.setStart(i,s),this.selection.setNodesMarker(r,t,!0)}else this.selection.setNodesMarker(r,t,!0),n=t;var o=[],u=0,a=this;this.$editor.find("*").each(function(){if(this==t){var r=e(this).parent();r.length!==0&&r[0].tagName!="BODY"&&a.utils.isRedactorParent(r[0])&&o.push(r[0]),o.push(this),u=1}else u>0&&(o.push(this),u+=1);if(this==n)return!1});var f=[],l=o.length;for(var c=0;c<l;c++)o[c].id!="nodes-marker-1"&&o[c].id!="nodes-marker-2"&&f.push(o[c]);return this.selection.removeNodesMarkers(),f},getNodesMarker:function(t){return e('<span id="nodes-marker-'+t+'" class="redactor-nodes-marker" data-verified="redactor">'+this.opts.invisibleSpace+"</span>")[0]},setNodesMarker:function(e,t,n){try{e.collapse(n),e.insertNode(t)}catch(r){}},removeNodesMarkers:function(){e(document).find("span.redactor-nodes-marker").remove(),this.$editor.find("span.redactor-nodes-marker").remove()},fromPoint:function(e,t){this.caret.setOffset(e,t)},wrap:function(e){this.selection.get();if(this.range.collapsed)return!1;var t=document.createElement(e);return t.appendChild(this.range.extractContents()),this.range.insertNode(t),t},selectElement:function(e){this.caret.set(e,0,e,1)},selectAll:function(){this.selection.get(),this.range.selectNodeContents(this.$editor[0]),this.selection.addRange()},remove:function(){this.selection.get(),this.sel.removeAllRanges()},save:function(){this.selection.createMarkers()},createMarkers:function(){this.selection.get();var e=this.selection.getMarker(1);this.selection.setMarker(this.range,e,!0);if(this.range.collapsed===!1){var t=this.selection.getMarker(2);this.selection.setMarker(this.range,t,!1)}this.savedSel=this.$editor.html()},getMarker:function(t){return typeof t=="undefined"&&(t=1),e('<span id="selection-marker-'+t+'" class="redactor-selection-marker"  data-verified="redactor">'+this.opts.invisibleSpace+"</span>")[0]},getMarkerAsHtml:function(e){return this.utils.getOuterHtml(this.selection.getMarker(e))},setMarker:function(e,t,n){e=e.cloneRange();try{e.collapse(n),e.insertNode(t)}catch(r){this.focus.setStart()}},restore:function(){var e=this.$editor.find("span#selection-marker-1"),t=this.$editor.find("span#selection-marker-2");e.length!==0&&t.length!==0?this.caret.set(e,0,t,0):e.length!==0?this.caret.set(e,0,e,0):this.$editor.focus(),this.selection.removeMarkers(),this.savedSel=!1},removeMarkers:function(){this.$editor.find("span.redactor-selection-marker").each(function(t,n){var r=e(n).text().replace(/[\u200B-\u200D\uFEFF]/g,"");r===""?e(n).remove():e(n).replaceWith(function(){return e(this).contents()})})},getText:function(){return this.selection.get(),this.sel.toString()},getHtml:function(){var e="";this.selection.get();if(this.sel.rangeCount){var t=document.createElement("div"),n=this.sel.rangeCount;for(var r=0;r<n;++r)t.appendChild(this.sel.getRangeAt(r).cloneContents());e=t.innerHTML}return this.clean.onSync(e)},replaceWithHtml:function(e){e=this.selection.getMarkerAsHtml(1)+e+this.selection.getMarkerAsHtml(2),this.selection.get();if(window.getSelection&&window.getSelection().getRangeAt){this.range.deleteContents();var t=document.createElement("div");t.innerHTML=e;var n=document.createDocumentFragment(),r;while(r=t.firstChild)n.appendChild(r);this.range.insertNode(n)}else document.selection&&document.selection.createRange&&this.range.pasteHTML(e);this.selection.restore(),this.code.sync()}}},shortcuts:function(){return{init:function(t,n){if(!this.opts.shortcuts)return(t.ctrlKey||t.metaKey)&&(n===66||n===73)&&t.preventDefault(),!1;e.each(this.opts.shortcuts,e.proxy(function(n,r){var i=n.split(","),s=i.length;for(var o=0;o<s;o++)typeof i[o]=="string"&&this.shortcuts.handler(t,e.trim(i[o]),e.proxy(function(){var e;r.func.search(/\./)!="-1"?(e=r.func.split("."),typeof this[e[0]]!="undefined"&&this[e[0]][e[1]].apply(this,r.params)):this[r.func].apply(this,r.params)},this))},this))},handler:function(t,n,r){var i={8:"backspace",9:"tab",10:"return",13:"return",16:"shift",17:"ctrl",18:"alt",19:"pause",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"del",59:";",61:"=",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9",106:"*",107:"+",109:"-",110:".",111:"/",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"numlock",145:"scroll",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},s={"`":"~",1:"!",2:"@",3:"#",4:"$",5:"%",6:"^",7:"&",8:"*",9:"(",0:")","-":"_","=":"+",";":": ","'":'"',",":"<",".":">","/":"?","\\":"|"};n=n.toLowerCase().split(" ");var o=i[t.keyCode],u=String.fromCharCode(t.which).toLowerCase(),a="",f={};e.each(["alt","ctrl","meta","shift"],function(e,n){t[n+"Key"]&&o!==n&&(a+=n+"+")}),o&&(f[a+o]=!0),u&&(f[a+u]=!0,f[a+s[u]]=!0,a==="shift+"&&(f[s[u]]=!0));for(var l=0,c=n.length;l<c;l++)if(f[n[l]])return t.preventDefault(),r.apply(this,arguments)}}},tabifier:function(){return{get:function(e){if(!this.opts.tabifier)return e;var t=["area","body","head","hr","i?frame","link","meta","noscript","style","script","table","tbody","thead","tfoot"],n=["li","dt","dt","h[1-6]","option","script"],r=["p","blockquote","div","dl","fieldset","form","frameset","map","ol","pre","select","td","th","tr","ul"];this.tabifier.lineBefore=new RegExp("^<(/?"+t.join("|/?")+"|"+n.join("|")+")[ >]"),this.tabifier.lineAfter=new RegExp("^<(br|/?"+t.join("|/?")+"|/"+n.join("|/")+")[ >]"),this.tabifier.newLevel=new RegExp("^</?("+r.join("|")+")[ >]");var i=0,s=e.length,o=0,u=null,a=null,f="",l="",c="";this.tabifier.cleanlevel=0;for(;i<s;i++){o=i;if(-1==e.substr(i).indexOf("<"))return l+=e.substr(i),this.tabifier.finish(l);while(o<s&&e.charAt(o)!="<")o++;i!=o&&(c=e.substr(i,o-i),c.match(/^\s{2,}$/g)||("\n"==l.charAt(l.length-1)?l+=this.tabifier.getTabs():"\n"==c.charAt(0)&&(l+="\n"+this.tabifier.getTabs(),c=c.replace(/^\s+/,"")),l+=c),c.match(/\n/)&&(l+="\n"+this.tabifier.getTabs())),u=o;while(o<s&&">"!=e.charAt(o))o++;f=e.substr(u,o-u),i=o;var h;if("!--"==f.substr(1,3)){if(!f.match(/--$/)){while("-->"!=e.substr(o,3))o++;o+=2,f=e.substr(u,o-u),i=o}"\n"!=l.charAt(l.length-1)&&(l+="\n"),l+=this.tabifier.getTabs(),l+=f+">\n"}else"!"==f[1]?l=this.tabifier.placeTag(f+">",l):"?"==f[1]?l+=f+">\n":(h=f.match(/^<(script|style|pre)/i))?(h[1]=h[1].toLowerCase(),f=this.tabifier.cleanTag(f),l=this.tabifier.placeTag(f,l),a=String(e.substr(i+1)).toLowerCase().indexOf("</"+h[1]),a&&(c=e.substr(i+1,a),i+=a,l+=c)):(f=this.tabifier.cleanTag(f),l=this.tabifier.placeTag(f,l))}return this.tabifier.finish(l)},getTabs:function(){var e="";for(var t=0;t<this.tabifier.cleanlevel;t++)e+="	";return e},finish:function(e){return e=e.replace(/\n\s*\n/g,"\n"),e=e.replace(/^[\s\n]*/,""),e=e.replace(/[\s\n]*$/,""),e=e.replace(/<script(.*?)>\n<\/script>/gi,"<script$1></script>"),this.tabifier.cleanlevel=0,e},cleanTag:function(e){var t="";e=e.replace(/\n/g," "),e=e.replace(/\s{2,}/g," "),e=e.replace(/^\s+|\s+$/g," ");var n="";e.match(/\/$/)&&(n="/",e=e.replace(/\/+$/,""));var r;while(r=/\s*([^= ]+)(?:=((['"']).*?\3|[^ ]+))?/.exec(e))r[2]?t+=r[1].toLowerCase()+"="+r[2]:r[1]&&(t+=r[1].toLowerCase()),t+=" ",e=e.substr(r[0].length);return t.replace(/\s*$/,"")+n+">"},placeTag:function(e,t){var n=e.match(this.tabifier.newLevel);if(e.match(this.tabifier.lineBefore)||n)t=t.replace(/\s*$/,""),t+="\n";n&&"/"==e.charAt(1)&&this.tabifier.cleanlevel--,"\n"==t.charAt(t.length-1)&&(t+=this.tabifier.getTabs()),n&&"/"!=e.charAt(1)&&this.tabifier.cleanlevel++,t+=e;if(e.match(this.tabifier.lineAfter)||e.match(this.tabifier.newLevel))t=t.replace(/ *$/,"");return t}}},tidy:function(){return{setupAllowed:function(){this.opts.allowedTags&&(this.opts.deniedTags=!1),this.opts.allowedAttr&&(this.opts.removeAttr=!1);if(this.opts.linebreaks)return;var e=["p","section"];this.opts.allowedTags&&this.tidy.addToAllowed(e),this.opts.deniedTags&&this.tidy.removeFromDenied(e)},addToAllowed:function(t){var n=t.length;for(var r=0;r<n;r++)e.inArray(t[r],this.opts.allowedTags)==-1&&this.opts.allowedTags.push(t[r])},removeFromDenied:function(t){var n=t.length;for(var r=0;r<n;r++){var i=e.inArray(t[r],this.opts.deniedTags);i!=-1&&this.opts.deniedTags.splice(i,1)}},load:function(t,n){return this.tidy.settings={deniedTags:this.opts.deniedTags,allowedTags:this.opts.allowedTags,removeComments:this.opts.removeComments,replaceTags:this.opts.replaceTags,replaceStyles:this.opts.replaceStyles,removeDataAttr:this.opts.removeDataAttr,removeAttr:this.opts.removeAttr,allowedAttr:this.opts.allowedAttr,removeWithoutAttr:this.opts.removeWithoutAttr,removeEmpty:this.opts.removeEmpty},e.extend(this.tidy.settings,n),t=this.tidy.removeComments(t),this.tidy.$div=e("<div />").append(t),this.tidy.replaceTags(),this.tidy.replaceStyles(),this.tidy.removeTags(),this.tidy.removeAttr(),this.tidy.removeEmpty(),this.tidy.removeParagraphsInLists(),this.tidy.removeDataAttr(),this.tidy.removeWithoutAttr(),t=this.tidy.$div.html(),this.tidy.$div.remove(),t},removeComments:function(e){return this.tidy.settings.removeComments?e.replace(/<!--[\s\S]*?-->/gi,""):e},replaceTags:function(t){if(!this.tidy.settings.replaceTags)return t;var n=this.tidy.settings.replaceTags.length,r=[],i=[];for(var s=0;s<n;s++)i.push(this.tidy.settings.replaceTags[s][1]),r.push(this.tidy.settings.replaceTags[s][0]);return this.tidy.$div.find(r.join(",")).each(e.proxy(function(t,n){var r=i[t];e(n).replaceWith(function(){var t=e("<"+r+" />").append(e(this).contents());for(var n=0;n<this.attributes.length;n++)t.attr(this.attributes[n].name,this.attributes[n].value);return t})},this)),t},replaceStyles:function(){if(!this.tidy.settings.replaceStyles)return;var t=this.tidy.settings.replaceStyles.length;this.tidy.$div.find("span").each(e.proxy(function(n,r){var i=e(r),s=i.attr("style");for(var o=0;o<t;o++)if(s&&s.match(new RegExp("^"+this.tidy.settings.replaceStyles[o][0],"i"))){var u=this.tidy.settings.replaceStyles[o][1];i.replaceWith(function(){var t=document.createElement(u);return e(t).append(e(this).contents())})}},this))},removeTags:function(){!this.tidy.settings.deniedTags&&this.tidy.settings.allowedTags&&this.tidy.$div.find("*").not(this.tidy.settings.allowedTags.join(",")).each(function(t,n){n.innerHTML===""?e(n).remove():e(n).contents().unwrap()}),this.tidy.settings.deniedTags&&this.tidy.$div.find(this.tidy.settings.deniedTags.join(",")).each(function(t,n){n.innerHTML===""?e(n).remove():e(n).contents().unwrap()})},removeAttr:function(){var t;if(!this.tidy.settings.removeAttr&&this.tidy.settings.allowedAttr){var n=[],r=[];t=this.tidy.settings.allowedAttr.length;for(var i=0;i<t;i++)n.push(this.tidy.settings.allowedAttr[i][0]),r.push(this.tidy.settings.allowedAttr[i][1]);this.tidy.$div.find("*").each(e.proxy(function(t,i){var s=e(i),o=e.inArray(s[0].tagName.toLowerCase(),n),u=this.tidy.removeAttrGetRemoves(o,r,s);u&&e.each(u,function(e,t){s.removeAttr(t)})},this))}if(this.tidy.settings.removeAttr){t=this.tidy.settings.removeAttr.length;for(var i=0;i<t;i++){var s=this.tidy.settings.removeAttr[i][1];e.isArray(s)&&(s=s.join(" ")),this.tidy.$div.find(this.tidy.settings.removeAttr[i][0]).removeAttr(s)}}},removeAttrGetRemoves:function(t,n,r){var i=[];return t==-1?e.each(r[0].attributes,function(e,t){i.push(t.name)}):n[t]=="*"?i=[]:e.each(r[0].attributes,function(r,s){e.isArray(n[t])?e.inArray(s.name,n[t])==-1&&i.push(s.name):n[t]!=s.name&&i.push(s.name)}),i},removeAttrs:function(t,n){return n=new RegExp(n,"g"),t.each(function(){var t=e(this),r=this.attributes.length-1;for(var i=r;i>=0;i--){var s=this.attributes[i];s&&s.specified&&s.name.search(n)>=0&&t.removeAttr(s.name)}})},removeEmpty:function(){if(!this.tidy.settings.removeEmpty)return;this.tidy.$div.find(this.tidy.settings.removeEmpty.join(",")).each(function(){var t=e(this),n=t.text();n=n.replace(/[\u200B-\u200D\uFEFF]/g,""),n=n.replace(/&nbsp;/gi,""),n=n.replace(/\s/g,""),n===""&&t.children().length===0&&t.remove()})},removeParagraphsInLists:function(){this.tidy.$div.find("li p").contents().unwrap()},removeDataAttr:function(){if(!this.tidy.settings.removeDataAttr)return;var t=this.tidy.settings.removeDataAttr;e.isArray(this.tidy.settings.removeDataAttr)&&(t=this.tidy.settings.removeDataAttr.join(",")),this.tidy.removeAttrs(this.tidy.$div.find(t),"^(data-)")},removeWithoutAttr:function(){if(!this.tidy.settings.removeWithoutAttr)return;this.tidy.$div.find(this.tidy.settings.removeWithoutAttr.join(",")).each(function(){this.attributes.length===0&&e(this).contents().unwrap()})}}},toolbar:function(){return{init:function(){return{html:{title:this.lang.get("html"),func:"code.toggle"},formatting:{title:this.lang.get("formatting"),dropdown:{p:{title:this.lang.get("paragraph"),func:"block.format"},blockquote:{title:this.lang.get("quote"),func:"block.format"},pre:{title:this.lang.get("code"),func:"block.format"},h1:{title:this.lang.get("header1"),func:"block.format"},h2:{title:this.lang.get("header2"),func:"block.format"},h3:{title:this.lang.get("header3"),func:"block.format"},h4:{title:this.lang.get("header4"),func:"block.format"},h5:{title:this.lang.get("header5"),func:"block.format"}}},bold:{title:this.lang.get("bold"),func:"inline.format"},italic:{title:this.lang.get("italic"),func:"inline.format"},deleted:{title:this.lang.get("deleted"),func:"inline.format"},underline:{title:this.lang.get("underline"),func:"inline.format"},unorderedlist:{title:"&bull; "+this.lang.get("unorderedlist"),func:"list.toggle"},orderedlist:{title:"1. "+this.lang.get("orderedlist"),func:"list.toggle"},outdent:{title:"< "+this.lang.get("outdent"),func:"indent.decrease"},indent:{title:"> "+this.lang.get("indent"),func:"indent.increase"},image:{title:this.lang.get("image"),func:"image.show"},file:{title:this.lang.get("file"),func:"file.show"},link:{title:this.lang.get("link"),dropdown:{link:{title:this.lang.get("link_insert"),func:"link.show"},unlink:{title:this.lang.get("unlink"),func:"link.unlink"}}},alignment:{title:this.lang.get("alignment"),dropdown:{left:{title:this.lang.get("align_left"),func:"alignment.left"},center:{title:this.lang.get("align_center"),func:"alignment.center"},right:{title:this.lang.get("align_right"),func:"alignment.right"},justify:{title:this.lang.get("align_justify"),func:"alignment.justify"}}},horizontalrule:{title:this.lang.get("horizontalrule"),func:"line.insert"}}},build:function(){this.toolbar.hideButtons(),this.toolbar.hideButtonsOnMobile(),this.toolbar.isButtonSourceNeeded();if(this.opts.buttons.length===0)return;this.$toolbar=this.toolbar.createContainer(),this.toolbar.setOverflow(),this.toolbar.append(),this.toolbar.setFormattingTags(),this.toolbar.loadButtons(),this.toolbar.setFixed(),this.opts.activeButtons&&this.$editor.on("mouseup.redactor keyup.redactor focus.redactor",e.proxy(this.observe.buttons,this))},createContainer:function(){return e("<ul>").addClass("redactor-toolbar").attr("id","redactor-toolbar-"+this.uuid)},setFormattingTags:function(){e.each(this.opts.toolbar.formatting.dropdown,e.proxy(function(t,n){e.inArray(t,this.opts.formatting)==-1&&delete this.opts.toolbar.formatting.dropdown[t]},this))},loadButtons:function(){e.each(this.opts.buttons,e.proxy(function(t,n){if(!this.opts.toolbar[n])return;if(n==="file"){if(this.opts.fileUpload===!1)return;if(!this.opts.fileUpload&&this.opts.s3===!1)return}if(n==="image"){if(this.opts.imageUpload===!1)return;if(!this.opts.imageUpload&&this.opts.s3===!1)return}var r=this.opts.toolbar[n];this.$toolbar.append(e("<li>").append(this.button.build(n,r)))},this))},append:function(){this.opts.toolbarExternal?(this.$toolbar.addClass("redactor-toolbar-external"),e(this.opts.toolbarExternal).html(this.$toolbar)):this.$box.prepend(this.$toolbar)},setFixed:function(){if(!this.utils.isDesktop())return;if(this.opts.toolbarExternal)return;if(!this.opts.toolbarFixed)return;this.toolbar.observeScroll(),e(this.opts.toolbarFixedTarget).on("scroll.redactor."+this.uuid,e.proxy(this.toolbar.observeScroll,this))},setOverflow:function(){this.utils.isMobile()&&this.opts.toolbarOverflow&&this.$toolbar.addClass("redactor-toolbar-overflow")},isButtonSourceNeeded:function(){if(this.opts.source)return;var e=this.opts.buttons.indexOf("html");e!==-1&&this.opts.buttons.splice(e,1)},hideButtons:function(){if(this.opts.buttonsHide.length===0)return;e.each(this.opts.buttonsHide,e.proxy(function(e,t){var n=this.opts.buttons.indexOf(t);this.opts.buttons.splice(n,1)},this))},hideButtonsOnMobile:function(){if(!this.utils.isMobile()||this.opts.buttonsHideOnMobile.length===0)return;e.each(this.opts.buttonsHideOnMobile,e.proxy(function(e,t){var n=this.opts.buttons.indexOf(t);this.opts.buttons.splice(n,1)},this))},observeScroll:function(){var t=e(this.opts.toolbarFixedTarget).scrollTop(),n=1;this.opts.toolbarFixedTarget===document&&(n=this.$box.offset().top),t>n?this.toolbar.observeScrollEnable(t,n):this.toolbar.observeScrollDisable()},observeScrollEnable:function(e,t){var n=this.opts.toolbarFixedTopOffset+e-t,r=0,i=t+this.$box.height()-32,s=this.$box.innerWidth();this.$toolbar.addClass("toolbar-fixed-box"),this.$toolbar.css({position:"absolute",width:s,top:n+"px",left:r}),this.toolbar.setDropdownsFixed(),this.$toolbar.css("visibility",e<i?"visible":"hidden")},observeScrollDisable:function(){this.$toolbar.css({position:"relative",width:"auto",top:0,left:0,visibility:"visible"}),this.toolbar.unsetDropdownsFixed(),this.$toolbar.removeClass("toolbar-fixed-box")},setDropdownsFixed:function(){var t=this.$toolbar.innerHeight()+this.opts.toolbarFixedTopOffset,n="fixed";this.opts.toolbarFixedTarget!==document&&(t=this.$toolbar.innerHeight()+this.$toolbar.offset().top+this.opts.toolbarFixedTopOffset,n="absolute"),e(".redactor-dropdown-"+this.uuid).each(function(){e(this).css({position:n,top:t+"px"})})},unsetDropdownsFixed:function(){var t=this.$toolbar.innerHeight()+this.$toolbar.offset().top;e(".redactor-dropdown-"+this.uuid).each(function(){e(this).css({position:"absolute",top:t+"px"})})}}},upload:function(){return{init:function(t,n,r){this.upload.direct=!1,this.upload.callback=r,this.upload.url=n,this.upload.$el=e(t),this.upload.$droparea=e('<div id="redactor-droparea" />'),this.upload.$placeholdler=e('<div id="redactor-droparea-placeholder" />').text(this.lang.get("upload_label")),this.upload.$input=e('<input type="file" name="file" />'),this.upload.$placeholdler.append(this.upload.$input),this.upload.$droparea.append(this.upload.$placeholdler),this.upload.$el.append(this.upload.$droparea),this.upload.$droparea.off("redactor.upload"),this.upload.$input.off("redactor.upload"),this.upload.$droparea.on("dragover.redactor.upload",e.proxy(this.upload.onDrag,this)),this.upload.$droparea.on("dragleave.redactor.upload",e.proxy(this.upload.onDragLeave,this)),this.upload.$input.on("change.redactor.upload",e.proxy(function(e){e=e.originalEvent||e,this.upload.traverseFile(this.upload.$input[0].files[0],e)},this)),this.upload.$droparea.on("drop.redactor.upload",e.proxy(function(e){e.preventDefault(),this.upload.$droparea.removeClass("drag-hover").addClass("drag-drop"),this.upload.onDrop(e)},this))},directUpload:function(e,t){this.upload.direct=!0,this.upload.traverseFile(e,t)},onDrop:function(e){e=e.originalEvent||e;var t=e.dataTransfer.files;this.upload.traverseFile(t[0],e)},traverseFile:function(e,t){if(this.opts.s3){this.upload.setConfig(e),this.upload.s3uploadFile(e);return}var n=window.FormData?new FormData:null;if(window.FormData){this.upload.setConfig(e);var r=this.upload.type=="image"?this.opts.imageUploadParam:this.opts.fileUploadParam;n.append(r,e)}this.progress.show(),this.core.setCallback("uploadStart",t,n),this.upload.sendData(n,t)},setConfig:function(e){this.upload.getType(e),this.upload.direct&&(this.upload.url=this.upload.type=="image"?this.opts.imageUpload:this.opts.fileUpload,this.upload.callback=this.upload.type=="image"?this.image.insert:this.file.insert)},getType:function(e){this.upload.type="image",this.opts.imageTypes.indexOf(e.type)==-1&&(this.upload.type="file")},getHiddenFields:function(t,n){return t===!1||typeof t!="object"?n:(e.each(t,e.proxy(function(t,r){r!==null&&r.toString().indexOf("#")===0&&(r=e(r).val()),n.append(t,r)},this)),n)},sendData:function(t,n){this.upload.type=="image"?(t=this.upload.getHiddenFields(this.opts.uploadImageFields,t),t=this.upload.getHiddenFields(this.upload.imageFields,t)):(t=this.upload.getHiddenFields(this.opts.uploadFileFields,t),t=this.upload.getHiddenFields(this.upload.fileFields,t));var r=new XMLHttpRequest;r.open("POST",this.upload.url),r.onreadystatechange=e.proxy(function(){if(r.readyState==4){var t=r.responseText;t=t.replace(/^\[/,""),t=t.replace(/\]$/,"");var i;try{i=typeof t=="string"?e.parseJSON(t):t}catch(s){i={error:!0}}this.progress.hide(),this.upload.direct||this.upload.$droparea.removeClass("drag-drop"),this.upload.callback(i,this.upload.direct,n)}},this),r.send(t)},onDrag:function(e){e.preventDefault(),this.upload.$droparea.addClass("drag-hover")},onDragLeave:function(e){e.preventDefault(),this.upload.$droparea.removeClass("drag-hover")},clearImageFields:function(){this.upload.imageFields={}},addImageFields:function(e,t){this.upload.imageFields[e]=t},removeImageFields:function(e){delete this.upload.imageFields[e]},clearFileFields:function(){this.upload.fileFields={}},addFileFields:function(e,t){this.upload.fileFields[e]=t},removeFileFields:function(e){delete this.upload.fileFields[e]},s3uploadFile:function(t){this.upload.s3executeOnSignedUrl(t,e.proxy(function(e){this.upload.s3uploadToS3(t,e)},this))},s3executeOnSignedUrl:function(e,t){var n=new XMLHttpRequest,r="?";this.opts.s3.search(/\?/)!="-1"&&(r="&"),n.open("GET",this.opts.s3+r+"name="+e.name+"&type="+e.type,!0),n.overrideMimeType&&n.overrideMimeType("text/plain; charset=x-user-defined");var i=this;n.onreadystatechange=function(e){this.readyState==4&&this.status==200?(i.progress.show(),t(decodeURIComponent(this.responseText))):this.readyState==4&&this.status!=200},n.send()},s3createCORSRequest:function(e,t){var n=new XMLHttpRequest;return"withCredentials"in n?n.open(e,t,!0):typeof XDomainRequest!="undefined"?(n=new XDomainRequest,n.open(e,t)):n=null,n},s3uploadToS3:function(t,n){var r=this.upload.s3createCORSRequest("PUT",n);!r||(r.onload=e.proxy(function(){if(r.status==200){this.progress.hide();var e=n.split("?");if(!e[0])return!1;this.upload.direct||this.upload.$droparea.removeClass("drag-drop");var t={filelink:e[0]};if(this.upload.type=="file"){var i=e[0].split("/");t.filename=i[i.length-1]}this.upload.callback(t,this.upload.direct,!1)}},this),r.onerror=function(){},r.upload.onprogress=function(e){},r.setRequestHeader("Content-Type",t.type),r.setRequestHeader("x-amz-acl","public-read"),r.send(t))}}},utils:function(){return{isMobile:function(){return/(iPhone|iPod|BlackBerry|Android)/.test(navigator.userAgent)},isDesktop:function(){return!/(iPhone|iPod|iPad|BlackBerry|Android)/.test(navigator.userAgent)},isString:function(e){return Object.prototype.toString.call(e)=="[object String]"},isEmpty:function(t,n){return t=t.replace(/[\u200B-\u200D\uFEFF]/g,""),t=t.replace(/&nbsp;/gi,""),t=t.replace(/<\/?br\s?\/?>/g,""),t=t.replace(/\s/g,""),t=t.replace(/^<p>[^\W\w\D\d]*?<\/p>$/i,""),t=t.replace(/<iframe(.*?[^>])>$/i,"iframe"),t=t.replace(/<source(.*?[^>])>$/i,"source"),n!==!1&&(t=t.replace(/<[^\/>][^>]*><\/[^>]+>/gi,""),t=t.replace(/<[^\/>][^>]*><\/[^>]+>/gi,"")),t=e.trim(t),t===""},normalize:function(e){return typeof e=="undefined"?0:parseInt(e.replace("px",""),10)},hexToRgb:function(e){if(typeof e=="undefined")return;if(e.search(/^#/)==-1)return e;var t=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;e=e.replace(t,function(e,t,n,r){return t+t+n+n+r+r});var n=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return"rgb("+parseInt(n[1],16)+", "+parseInt(n[2],16)+", "+parseInt(n[3],16)+")"},getOuterHtml:function(t){return e("<div>").append(e(t).eq(0).clone()).html()},getAlignmentElement:function(t){return e.inArray(t.tagName,this.opts.alignmentTags)!==-1?e(t):e(t).closest(this.opts.alignmentTags.toString().toLowerCase(),this.$editor[0])},removeEmptyAttr:function(t,n){var r=e(t);return typeof r.attr(n)=="undefined"?!0:r.attr(n)===""?(r.removeAttr(n),!0):!1},removeEmpty:function(t,n){var r=e(n);r.find(".redactor-invisible-space").removeAttr("style").removeAttr("class");if(r.find("hr, br, img, iframe, source").length!==0)return;var i=e.trim(r.text());this.utils.isEmpty(i,!1)&&r.remove()},saveScroll:function(){this.saveEditorScroll=this.$editor.scrollTop(),this.saveBodyScroll=e(window).scrollTop(),this.opts.scrollTarget&&(this.saveTargetScroll=e(this.opts.scrollTarget).scrollTop())},restoreScroll:function(){if(typeof this.saveScroll=="undefined"&&typeof this.saveBodyScroll=="undefined")return;e(window).scrollTop(this.saveBodyScroll),this.$editor.scrollTop(this.saveEditorScroll),this.opts.scrollTarget&&e(this.opts.scrollTarget).scrollTop(this.saveTargetScroll)},createSpaceElement:function(){var e=document.createElement("span");return e.className="redactor-invisible-space",e.innerHTML=this.opts.invisibleSpace,e},removeInlineTags:function(t){var n=this.opts.inlineTags;n.push("span"),t.tagName=="PRE"&&n.push("a"),e(t).find(n.join(",")).not("span.redactor-selection-marker").contents().unwrap()},replaceWithContents:function(t,n){var r=this;return e(t).replaceWith(function(){return n===!0&&r.utils.removeInlineTags(this),e(this).contents()}),e(t)},replaceToTag:function(t,n,r){var i,s=this;return e(t).replaceWith(function(){i=e("<"+n+" />").append(e(this).contents());for(var t=0;t<this.attributes.length;t++)i.attr(this.attributes[t].name,this.attributes[t].value);return r===!0&&s.utils.removeInlineTags(i),i}),i},isStartOfElement:function(){var e=this.selection.getBlock();if(!e)return!1;var t=this.caret.getOffsetOfElement(e);return t===0?!0:!1},isEndOfElement:function(t){if(typeof t=="undefined"){var t=this.selection.getBlock();if(!t)return!1}var n=this.caret.getOffsetOfElement(t),r=e.trim(e(t).text()).replace(/\n\r\n/g,"");return n==r.length?!0:!1},isEndOfEditor:function(){var t=this.$editor[0],n=this.caret.getOffsetOfElement(t),r=e.trim(e(t).html().replace(/(<([^>]+)>)/gi,""));return n==r.length?!0:!1},isBlock:function(e){return e=e[0]||e,e&&this.utils.isBlockTag(e.tagName)},isBlockTag:function(e){return typeof e=="undefined"?!1:this.reIsBlock.test(e)},isTag:function(t,n){var r=e(t).closest(n);return r.length==1?r[0]:!1},isSelectAll:function(){return this.selectAll},enableSelectAll:function(){this.selectAll=!0},disableSelectAll:function(){this.selectAll=!1},isRedactorParent:function(t){return t?e(t).parents(".redactor-editor").length===0||e(t).hasClass("redactor-editor")?!1:t:!1},isCurrentOrParentHeader:function(){return this.utils.isCurrentOrParent(["H1","H2","H3","H4","H5","H6"])},isCurrentOrParent:function(t){var n=this.selection.getParent(),r=this.selection.getCurrent();if(e.isArray(t)){var i=0;return e.each(t,e.proxy(function(e,t){this.utils.isCurrentOrParentOne(r,n,t)&&i++},this)),i===0?!1:!0}return this.utils.isCurrentOrParentOne(r,n,t)},isCurrentOrParentOne:function(e,t,n){return n=n.toUpperCase(),t&&t.tagName===n?t:e&&e.tagName===n?e:!1},isOldIe:function(){return this.utils.browser("msie")&&parseInt(this.utils.browser("version"),10)<9?!0:!1},isLessIe10:function(){return this.utils.browser("msie")&&parseInt(this.utils.browser("version"),10)<10?!0:!1},isIe11:function(){return!!navigator.userAgent.match(/Trident\/7\./)},browser:function(e){var t=navigator.userAgent.toLowerCase(),n=/(opr)[\/]([\w.]+)/.exec(t)||/(chrome)[ \/]([\w.]+)/.exec(t)||/(webkit)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(t)||/(webkit)[ \/]([\w.]+)/.exec(t)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(t)||/(msie) ([\w.]+)/.exec(t)||t.indexOf("trident")>=0&&/(rv)(?::| )([\w.]+)/.exec(t)||t.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(t)||[];return e=="safari"?typeof n[3]!="undefined"?n[3]=="safari":!1:e=="version"?n[2]:e=="webkit"?n[1]=="chrome"||n[1]=="opr"||n[1]=="webkit":n[1]=="rv"?e=="msie":n[1]=="opr"?e=="webkit":e==n[1]}}}},e(window).on("load.tools.redactor",function(){e('[data-tools="redactor"]').redactor()}),i.prototype.init.prototype=i.prototype,e.Redactor.fn.formatLinkify=function(t,i,s,o,u,a){var f="((?:http[s]?:\\/\\/(?:www\\.)?|www\\.){1}(?:[0-9A-Za-z\\-%_]+\\.)+[a-zA-Z]{2,}(?::[0-9]+)?(?:(?:/[0-9A-Za-z\\-#\\.%+_]*)+)?(?:\\?(?:[0-9A-Za-z\\-\\.%_]+(?:=[0-9A-Za-z\\-\\.%_\\+]*)?)?(?:&(?:[0-9A-Za-z\\-\\.%_]+(?:=[0-9A-Za-z\\-\\.%_\\+]*)?)?)*)?(?:#[0-9A-Za-z\\-\\.%_\\+=\\?&;]*)?)",l=new RegExp(f,"gi"),c=/(https?|ftp):\/\//i,h=new RegExp("(?:([^:/?#]+):)?(?://([^/?#]*))?([^?#]*\\.(?:jpg|gif|png))(?:\\?([^#]*))?(?:#(.*))?","gi"),p=(this.$editor?this.$editor[0]:this).childNodes,d=p.length;while(d--){var v=p[d];if(v.nodeType===3&&v.parentNode!=="PRE"){var m=v.nodeValue;if(u&&m){var g='<iframe width="500" height="281" src="',y='" frameborder="0" allowfullscreen></iframe>';m.match(n)?(m=m.replace(n,g+"//www.youtube.com/embed/$1"+y),e(v).after(m).remove()):m.match(r)&&(m=m.replace(r,g+"//player.vimeo.com/video/$2"+y),e(v).after(m).remove())}if(o&&m&&m.match(h)){var b=m.match(h);m=m.replace(h,'<img src="'+b+'" />'),e(v).after(m).remove();return}m.search(/\$/g)!=-1&&(m=m.replace(/\$/g,"&#36;"));var b=m.match(l);if(s&&m&&b){var w=b.length;for(var E=0;E<w;E++){b[E].match(/\.$/)!==null&&(b[E]=b[E].replace(/\.$/,""));var S=b[E],x=S,T="";S.match(/\s$/)!==null&&(T=" ");var N=t+"://";S.match(c)!==null&&(N=""),x.length>a&&(x=x.substring(0,a)+"..."),x=x.replace(/&#36;/g,"$").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");var C=[],k=m.match("<a(.*?)</a>");if(k!==null){var w=k.length;for(d=0;d<w;d++)C[d]=k[d],m=m.replace(k[d],"{abuffer"+d+"}")}m=m.replace(S,'<a href="'+N+e.trim(S)+'">'+e.trim(x)+"</a>"+T),e.each(C,function(e,t){m=m.replace("{abuffer"+e+"}",t)})}e(v).after(m).remove()}}else v.nodeType===1&&!/^(pre|a|button|textarea)$/i.test(v.tagName)&&e.Redactor.fn.formatLinkify.call(v,t,i,s,o,u,a)}}}(jQuery),define("redactor",function(){}),define("text!scripts/redactor/ueditor-templates.html",[],function(){return'<div>\n<!--\n	Wrap everything in a div to convert this file\'s content in a jquery element\n	so it is possible to use $.find.\n-->\n\n<script type="text/template" id="link-tpl">\n	<input type="hidden" id="ueditor-link" value="{{url}}">\n	<div class="upfront-field-wrap">\n		<input type="radio" name="ueditor-link" value="external" class="upfront-field-radio"  {{link == \'external\' ? \'checked="checked"\' : \'\'}} id="ueditor-link-external">\n		<label for="ueditor-link-external">External URL</label>\n		<input type="text" value="{{url}}" id="ueditor-link-url" placeholder="Type link URL" style="{{link != \'external\' ? \'display:none\' : \'\'}}" class="upfront-field-text ueditor-link-hidden">\n	</div>\n	<div class="upfront-field-wrap">\n		<input type="radio" name="ueditor-link" value="post" class="upfront-field-radio" {{link == \'post\' ? \'checked="checked"\' : \'\'}} id="ueditor-link-post">\n		<label for="ueditor-link-post">Post or page</label>\n		<a title="Change link" href="#" class="ueditor-change-link-post ueditor-link-hidden" style="{{link != \'post\' ? \'display:none\' : \'\'}}">{{url}}</a>\n	</div>\n\n	{[if(anchors.length > 1) { ]}\n	<div class="upfront-field-wrap">\n		<input type="radio" name="ueditor-link" value="anchor" class="upfront-field-radio" {{link == \'anchor\' ? \'checked="checked"\' : \'\'}} id="ueditor-link-anchor">\n		<label for="ueditor-link-anchor">Anchor</label>\n		<div class="ueditor-anchor ueditor-link-hidden" style="{{link != \'anchor\' ? \'display:none\' : \'\'}}">\n			<select class="ueditor-anchor-selector">\n			{[ _.each(anchors, function(anchor){ ]}\n				<option value="#{{ anchor }}" {{ url == \'#\' + anchor ? \'selected="selected"\' : \'\' }}>{{anchor}}</option>\n			{[ }); ]}\n			</select>\n		</div>\n	</div>\n	{[ } ]}\n\n	{[if(url) { ]}\n	<div class="upfront-field-wrap">\n		<a href="#" class="ueditor-unlink">Unlink</a>\n	</div>\n	{[ } ]}\n</script>\n\n<script type="text/template" id="post-image-insert-tpl">\n    <div data-variant="{{variant_id}}" class="ueditor-insert ueditor-insert-variant-group {{style.label_id}} ueditor-insert-float-{{style.group.float}} {{style.group.width_cls}}" style="min-height: {{style.group.height}}px;float:{{style.group.float}}; {[if( style.group.marginRight > 0 ){]}margin-right:{{style.group.marginRight}}px;{[ } ]} {[if( style.group.marginLeft > 0 ) {]}margin-left:{{style.group.marginLeft}}px;{[ } ]}" >\n        {[if( style.caption.order == 0 && show_caption) {]}\n            <div class="upfront-wrapper wp-caption-text {{style.caption.width_cls}}" style="min-height:{{style.caption.height}}px">{{ caption }}</div>\n        {[ } ]}\n        <div class="upfront-wrapper uinsert-image-wrapper {{style.image.width_cls}} {[ if(!isLocal){ ]}uinsert-image-external{[ } ]}" style="min-height: {{style.image.height}}px;">{[if(linkType != "do_nothing"){ ]}<a href="{{linkUrl}}">{[ } ]}<img class="" data-url="{imageFull.src}"  src="{{image.src}}" {[if(!isLocal){ ]}style="top: {{ externalImage.top }}px; left: {{ externalImage.left }}px; width: {{ externalImage.width }}px; height: {{ externalImage.height }}px"{[ } ]}/>{[if(linkType != "do_nothing"){ ]}</a>{[ } ]}</div>\n            {[if( style.caption.order == 1 && show_caption) {]}\n                <div class="upfront-wrapper wp-caption-text {{style.caption.width_cls}}" style="min-height:{{style.caption.height}}px">{{ caption }}</div>\n            {[ } ]}\n        <div style="clear:both;"></div>\n\n    </div>\n    <div class="post-images-shortcode" contenteditable="false"></div>\n</script>\n\n<script type="text/template" id="post-image-insert-shortcode-tpl">\n    [caption id="{{id}}"  uf_variant="{{variant_id}}" uf_show_caption="{{show_caption}}" ]\n        {[if(linkType != "do_nothing"){ ]}<a href="{{linkUrl}}">{[ } ]}\n        <img width="{{image.width}}"   src="{{image.src}}"/>\n        {[if(linkType != "do_nothing"){ ]}</a>{[ } ]}\n\n		{{ caption }}\n    [/caption]\n</script>\n<script type="text/template" id="post-image-insert-wp-tpl">\n    <div id="attachment_{{attachment_id}}" style="width: {{style.wrapper.width}}px" class="wp-caption {{style.wrapper.alignment}}">\n        {[ if(link_url){ ]}<a href="{{link_url}}"> {[ } ]}\n            <img src="{{image.src}}" {[ if( image.width ){  ]} width="{{image.width}}" {[ } ]}  class="{{style.image.size_class}} wp-image-{{attachment_id}}" >\n        {[ if(link_url){ ]} </a> {[ } ]}\n        {[ if(style.caption.show){ ]}\n            <p class="wp-caption-text">{{caption}}</p>\n        {[ } ]}\n    </div>\n    <div class="post-images-shortcode-wp" contenteditable="false"></div>\n</script>\n<script type="text/template" id="post-image-insert-shortcode-wp-tpl">\n   [caption id="attachment_{{attachment_id}}" align="{{style.wrapper.alignment}}" width="{{style.wrapper.width}}" show_caption="{{style.caption.show}}" ]\n        {[ if(link_url){ ]}<a href="{{link_url}}"> {[ } ]}\n            <img  src="{{image.src}}"  width="{{image.width}}" height="{{image.height}}"  class="{{style.image.size_class}}  wp-image-{{attachment_id}}">\n       {[ if(link_url){ ]} </a> {[ } ]}\n        {{caption}}\n   [/caption]\n</script>\n<script type="text/template" id="image-insert-tpl">\n    <div data-variant="{{variant_id}}" class="ueditor-insert ueditor-insert-variant-group {{style.label_id}} ueditor-insert-float-{{style.group.float}} {{style.group.width_cls}} {{style.group.left_cls}}" style="min-height: {{style.group.height}}px;float:{{style.group.float}}; {[if( style.group.marginRight > 0 ){]}margin-right:{{style.group.marginRight}}px;{[ } ]} {[if( style.group.marginLeft > 0 ) {]}margin-left:{{style.group.marginLeft}}px;{[ } ]}" >\n        {[if( style.caption.order == 0 && show_caption) {]}\n        <div class="upfront-wrapper wp-caption-text c24" style="min-height:{{style.caption.height}}px">{{ caption }}</div>\n        {[ } ]}\n        <div class="upfront-wrapper uinsert-image-wrapper {{style.image.width_cls}} {{style.image.left_cls}} {{style.image.top_cls}} {[ if(!isLocal){ ]}uinsert-image-external{[ } ]}" style="min-height: {{style.image.height}}px;">{[if(linkType != "do_nothing"){ ]}<a href="{{linkUrl}}">{[ } ]}<img class="" src="{{image.src}}" {[if(!isLocal){ ]}style="top: {{ externalImage.top }}px; left: {{ externalImage.left }}px; width: {{ externalImage.width }}px; height: {{ externalImage.height }}px"{[ } ]}/>{[if(linkType != "do_nothing"){ ]}</a>{[ } ]}</div>\n      \n        {[if( style.caption.order == 1 && show_caption) {]}\n        <div class="upfront-wrapper wp-caption-text c24" style="min-height:{{style.caption.height}}px">{{ caption }}</div>\n        {[ } ]}\n        <div style="clear:both;"></div>\n\n    </div>\n</script>\n<script type="text/template" id="image-link-tpl">\n	<div class="upfront-field-wrap">\n		<input type="radio" name="uinsert-image-link" value="do_nothing" class="upfront-field-radio" id="uinsert-image-link-1" {{linkType == \'do_nothing\' ? checked : \'\'}}>\n		<label for="uinsert-image-link-1">No link</label>\n	</div>\n	<div class="upfront-field-wrap">\n		<input type="radio" name="uinsert-image-link" value="external" class="upfront-field-radio" id="uinsert-image-link-2" {{linkType == \'external\' ? checked : \'\'}}>\n		<label for="uinsert-image-link-2">External link</label>\n		<input type="text" value="{{linkUrl}}" id="uinsert-image-link-url" placeholder="Type link URL" style="{{linkType != \'external\' ? \'display:none\' : \'\'}}" class="upfront-field-text">\n	</div>\n	<div class="upfront-field-wrap">\n		<input type="radio" name="uinsert-image-link" value="post" class="upfront-field-radio" id="uinsert-image-link-3" {{linkType == \'post\' ? checked : \'\'}}>\n		<label for="uinsert-image-link-3">Link to a post or page</label>\n		<a title="Change link" class="uinsert-change-link-post" style="{{linkType != \'post\' ? \'display:none\' : \'\'}}">{{linkUrl}}</a>\n	</div>\n	<div class="upfront-field-wrap">\n		<input type="radio" name="uinsert-image-link" value="show_larger_image" class="upfront-field-radio" id="uinsert-image-link-4" {{linkType == \'show_larger_image\' ? checked : \'\'}}>\n		<label for="uinsert-image-link-4">Show larger image</label>\n	</div>\n</script>\n<script type="text/template" id="embed-insert-tpl">\n    <div class="inserted_code_rendered">{{code}}</div>\n</script>\n<script type="text/template" id="embed-insert-form-tpl">\n    <div class="upfront-field-embed_code-wrap">\n        <h3>Type or paste the embed code</h3>\n        <textarea name="upfront-field-embed_code" class="upfront-field-embed_code" id="upfront-field-embed_code" cols="30" rows="5">{{code}}</textarea>\n    </div>\n</script>\n<script type="text/template" id="font-icons">\n    <div class="icons">\n        {[ _.each(icons, function(icon){  ]}\n        <a href="javascript:void(0);" class="redactor_btn ueditor-font-icon"><span class="uf_font_icon">{{icon}}</span></a>\n        {[ }); ]}\n    </div>\n    <ul class="upfront-font-icons-controlls">\n        <li>\n            <label>\n                Size:\n            </label>   \n            <input class="upfront-field-number font-icons-size"  type="number" value="27" step="1" min="16" max="200">\n        </li>\n        <li class="font-icons-top-li">\n            <label>\n                Top:\n            </label>  \n            <input class="upfront-field-number font-icons-top"  type="number" value="0" step="1" min="-35" max="45">\n        </li>\n    </ul>\n</script>\n\n<script type="text/template" id="insert-manager-tpl">\n    <div class="ueditor-post-insert-manager">\n        <div class="upfront-image-attachment-bits upfront-post-media-trigger"></div>\n    </div>\n</script>\n\n<script type="text/template" id="insert-manager-tooltip-tpl">\n    <div class="upfront-image-attachment-bits upfront-post-media-trigger"></div>\n    <div class="uinsert-selector upfront-ui">\n    {[ _.each(inserts, function(insert, type){  ]}\n        <a href="#" class="uinsert-selector-option uinsert-selector-{{type}}" data-insert="{{type}}"><span class="uinsert-text">{{names[type]}}</span><span  data-insert="{{type}}" class="uinsert-text-overlay"></span></a>\n    {[ }); ]}\n    </div>\n</script>\n\n<script type="text/template" id="image-style-tpl">\n    {[ _.each(data.variants, function(variant, index){  ]}\n    <div class="upfront-field-wrap">\n        <input type="radio" name="uinsert-image-style-variant" value="{{variant.vid}}" {{data.selected == variant.vid ? "checked=\'checked\'" : ""}} class="upfront-field-radio" id="uinsert-image-variant-{{variant.vid}}">\n        <label for="uinsert-image-variant-{{variant.vid}}">{{variant.label}}</label>\n    </div>\n    {[ }); ]}\n</script>\n\n<script type="text/template" id="wp-image-style-tpl">\n    {[ _.each(data.variants, function(variant, index){  ]}\n        <i class="upfront-icon upfront-icon-wp-image-style  {{variant.icon}} {[ if( data.selected == variant.id ) { ]} upfront-icon-wp-image-style-selected {[ } ]}" data-id="{{variant.id}}" title="{{variant.label}}"></i>\n    {[ }); ]}\n</script>\n<script type="text/template" id="upfront-formatting">\n    <ul class="upfront-redactor-tag-list">\n        <li class="tag-list-section-title">\n            {{standard_formatting}}\n        </li>\n        <li>\n            <p  data-tag="p" class="tag-list-tag-p tag-list-tag">{{paragraph}}</p>\n        </li>\n        <li>\n            <h1  data-tag="h1" class="tag-list-tag-h1 tag-list-tag">{{heading_01}}</h1>\n        </li>\n        <li>\n            <h2 data-tag="h2" class="tag-list-tag-h2 tag-list-tag">{{heading_02}}</h2>\n        </li>\n        <li>\n            <h3  data-tag="h3" class="tag-list-tag-h3 tag-list-tag">{{heading_03}}</h3>\n        </li>\n        <li>\n            <h4 data-tag="h4" class="tag-list-tag-h4 tag-list-tag">{{heading_04}}</h4>\n        </li>\n        <li>\n            <h5 data-tag="h5" class="tag-list-tag-h5 tag-list-tag">{{heading_05}}</h5>\n        </li>\n        <li>\n            <h6 data-tag="h6" class="tag-list-tag-h6 tag-list-tag">{{heading_06}}</h6>\n        </li>\n\n        <li>\n            <pre data-tag="pre" class="tag-list-tag-pre tag-list-tag">{{preformatted}}</pre>\n        </li>\n        <li>\n            <blockquote data-tag="blockquote" class="tag-list-tag-blockquote tag-list-tag">{{blockquote}}</blockquote>\n        </li>\n        <!--<li>-->\n            <!--<a href="#" data-tag="blockquote">"</a>-->\n        <!--</li>-->\n    </ul>\n    <!--<select name="ufront-formatting-custom-class" class="upfront-field-select ufront-formatting-custom-class">-->\n        <!--{[ _.each(custom_classes, function(custom_class, index){  ]}-->\n            <!--<option value="{{custom_class}}">{{custom_class}}</option>-->\n        <!--{[ }); ]}-->\n    <!--</select>-->\n</script>\n</div>'}),function(e){define("scripts/redactor/ueditor-insert",["text!scripts/redactor/ueditor-templates.html"],function(t){var n=Backbone.View.extend({shortcodeName:"ueditor-insert",attributes:{contenteditable:"false"},defaultData:{},resizable:!1,initialize:function(e){e=e||{};var t=e.data||{};t.id||(t.id=this.generate_new_id(),Upfront.Events.trigger("content:insertcount:updated")),this.el.id=t.id,this.data=new Backbone.Model(t),this.listenTo(this.data,"change add remove reset",this.render),this.createControls(),typeof this.init=="function"&&this.init(e)},generate_new_id:function(){return"uinsert-"+ ++Upfront.data.ueditor.insertCount},start:function(){var t=e.Deferred();return t.resolve(),t.promise()},getOutput:function(){var e=this.data.toJSON(),t='[ueditor-insert type="'+this.type+'"';return _.each(e,function(e,n){t+=" "+n+'="'+e+'"'}),t+"]"},importInserts:function(t){var n=this,r=new RegExp("(["+this.shortcodeName.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")+"[^]]*?])","ig"),i=t.html(),s=e("<div></div>");i=i.replace(r,'<p class="ueditor-insert">$1</p>');var o=s.html(i).find("p.ueditor-insert");o.each(function(){var e=n.parseShortcode(this.innerHTML);e.type&&insertObjects[e.type]})},parseShortcode:function(t){var n=/\[([^\s\]]+)([^\]]*?)\]/i,r=/(\w+)\s*=\s*"([^"]*)"(?:\s|$)|(\w+)\s*=\s*\'([^\']*)\'(?:\s|$)|(\w+)\s*=\s*([^\s\'"]+)(?:\s|$)|"([^"]*)"(?:\s|$)|(\S+)(?:\s|$)/ig,i=t.match(n),s={},o;if(!i)return!1;s.shortcodeName=i[1],o=e.trim(i[2]);if(o){var u=o.match(r);u&&_.each(u,function(t){t=e.trim(t);var n=t.split("=");if(n.length==1)s[t]=t;else{var r=e.trim(n[0]),i=e.trim(n.slice(1).join("="));if(i[0]=='"'&&i[i.length-1]=='"'||i[0]=="'"&&i[i.length-1]=="'")i=i.slice(1,-1);s[r]=i}})}return s},createControls:function(){var e=this,t=Upfront.Views.Editor.InlinePanels;this.controls&&(this.controls.remove(),this.controls=!1);if(!this.controlsData)return;this.controls=t.ControlPanel.extend({position_v:"top"}),this.controls=new this.controls;var n=[];_.each(this.controlsData,function(r){var i;if(r.type=="simple")i=e.createSimpleControl(r),e.controls.listenTo(i,"click",function(){e.controls.trigger("control:click",i),e.controls.trigger("control:click:"+i.id,i)});else if(r.type=="multi"){i=new t.TooltipControl,i.selected=r.selected;if(r.subItems){var s={};_.each(r.subItems,function(t){s[t.id]=e.createSimpleControl(t)}),i.sub_items=s}e.controls.listenTo(i,"select",function(t){e.controls.trigger("control:select:"+i.id,t)})}else r.type=="dialog"&&(i=new t.DialogControl,i.view=r.view,e.controls.listenTo(i,"panel:ok",function(t){e.controls.trigger("control:ok:"+i.id,t,i)}),e.controls.listenTo(i,"panel:open",function(){e.controls.$el.addClass("uinsert-control-visible"),e.$el.addClass("nosortable")}),e.controls.listenTo(i,"panel:close",function(){e.controls.$el.removeClass("uinsert-control-visible"),e.$el.removeClass("nosortable")}));i&&(_.extend(i,r),n.push(i))}),this.controls.items=_(n),this.controls.render(),typeof this.controlEvents=="function"&&this.controlEvents(),this.controls.delegateEvents()},createSimpleControl:function(e){var t=new Upfront.Views.Editor.InlinePanels.Control;return t.icon=e.icon,t.tooltip=e.tooltip,t.id=e.id,t.label=e.label,t},getAligmnentControlData:function(e){var t={left:{id:"left",icon:"alignleft",tooltip:"Align left"},right:{id:"right",icon:"alignright",tooltip:"Align right"},center:{id:"center",icon:"aligncenter",tooltip:"Align center"},full:{id:"full",icon:"alignfull",tooltip:"Full width"}},n={id:"alignment",type:"multi",icon:"alignment",tooltip:"Alignment",subItems:[]};return _.each(e,function(e){t[e]&&n.subItems.push(t[e])}),n},getRemoveControlData:function(){return{id:"remove",type:"simple",icon:"remove",tooltip:"Delete"}},resizableInsert:function(){if(!this.resizable)return;var e=this,t=this.data.get("align"),n=!0,r=!0,i=".upfront-icon-control-resize-se",s={},o=Upfront.Behaviors.GridEditor;this.$el.hasClass("ui-resizable")&&this.$el.resizable("destroy"),t=="left"?n=!1:t=="right"&&(r=!1,i=".upfront-icon-control-resize-sw"),this.$(i).length||(r&&(this.$el.append('<span class="upfront-icon-control upfront-icon-control-resize-se upfront-resize-handle-se ui-resizable-handle ui-resizable-se nosortable" style="display: inline;"></span>'),s.se=".upfront-icon-control-resize-se"),n&&(this.$el.append('<span class="upfront-icon-control upfront-icon-control-resize-sw upfront-resize-handle-sw ui-resizable-handle ui-resizable-sw nosortable" style="display: inline;"></span>'),s.sw=".upfront-icon-control-resize-sw"));var u=this.getResizableOptions?this.getResizableOptions():{};u.handles=s,u.grid=[o.col_size,o.baseline],this.$el.resizable(u)}});return{UeditorInsert:n}})}(jQuery),function(e){define("scripts/redactor/ueditor-insert-utils",["text!scripts/redactor/ueditor-templates.html"],function(t){var n=Upfront.mainData.l10n.global.ueditor,r=_([{vid:"center",label:"Center"},{vid:"left",label:"Left"},{vid:"right",label:"Right"}]),i=Backbone.View.extend({tpl:_.template(e(t).find("#image-style-tpl").html()),initialize:function(e){this.data=new Backbone.Model,this.listenTo(this.data,"change",this.render),this.data.set("variants",r.toArray()),this.data.set("selected",e.get("variant_id")?e.get("variant_id"):"center")},events:{"change input[type=radio]":"update_data","click input[type=radio]":"on_click"},render:function(){return this.$el.html(this.tpl({data:this.data.toJSON()})),this},on_click:function(e){e.stopPropagation()},update_data:function(t){t.stopPropagation(),this.variant_id=e(t.target).val(),this._style=r.findWhere({vid:this.variant_id})}}),s=Backbone.View.extend({tpl:_.template(e(t).find("#image-link-tpl").html()),initialize:function(e){e.data&&(this.model=new Backbone.Model(e.data),this.listenTo(this.model,"change",this.render))},events:{"change input[type=radio]":"updateData"},render:function(){this.$el.width("200px");var e=this.model.toJSON();e.checked='checked="checked"',this.$el.html(this.tpl(e))},updateData:function(e){var t=this,n=this.$("input:checked").val(),r=this.$("#uinsert-image-link-url").val();if(n=="post"){var i={postTypes:this.postTypes()};Upfront.Views.Editor.PostSelector.open(i).done(function(e){t.model.set({linkType:"post",linkUrl:e.get("permalink")})})}else this.model.set({linkType:n,linkUrl:r})},postTypes:function(){var e=[];return _.each(Upfront.data.ugallery.postTypes,function(t){t.name!="attachment"&&e.push({name:t.name,label:t.label})}),e}}),o=Backbone.View.extend({initialize:function(e){this.data=new Backbone.Model,this.data.set("variants",Upfront.Content.ImageVariants.toJSON()),this.data.set("selected",e.get("variant_id"))},events:{},prepare_values:function(){var e=this,t=[];return _.each(this.data.get("variants"),function(e,n){t.push({value:e.vid,label:e.label})}),t},get_default_value:function(){return this.data.get("selected")},render:function(){var e=this,t=new Upfront.Views.Editor.Field.Select({className:"upfront-field-wrap upfront-field-wrap-image-style-variant",label:n.choose_image_insert,name:"uf_image_style_variants",default_value:this.get_default_value(),multiple:!1,values:this.prepare_values(),change:function(t){e._style=Upfront.Content.ImageVariants.findWhere({vid:t}),e.data.set("selected",t)}});return t.render(),this.$el.html(t.$el),this},on_click:function(e){e.stopPropagation()}}),u=Backbone.View.extend({className:"upfront-wp-image-style-variants",tpl:_.template(e(t).find("#wp-image-style-tpl").html()),events:{"click .upfront-icon-wp-image-style":"update_data"},get_alignments:function(){return[{id:"alignleft",label:n.align_left,icon:"upfront-icon-wp-image-style-alignleft"},{id:"aligncenter",label:n.align_center,icon:"upfront-icon-wp-image-style-aligncenter"},{id:"alignright",label:n.align_right,icon:"upfront-icon-wp-image-style-alignright"},{id:"alignnone",label:n.align_none,icon:"upfront-icon-wp-image-style-alignnone"}]},initialize:function(e){this.data=new Backbone.Model,this.data.set("variants",this.get_alignments()),this.listenTo(this.data,"change",this.render),this.data.set("selected",this.model.get("variant_id")||this.model.get("style").wrapper.alignment)},get_default_value:function(){return this.data.get("selected")},render:function(){return this.$el.html(this.tpl({data:this.data.toJSON()})),this},on_click:function(e){e.stopPropagation()},update_data:function(t){t.preventDefault();var n=e(t.target),r=n.data("id");this.data.set("selected",r),this.model.set("variant_id",r)}});return{LinkView:s,ImageStylesView:i,PostImageStylesView:o,WP_PostImageStylesView:u,BasicImageVariants:r}})}(jQuery),function(e){define("scripts/redactor/ueditor-image-insert-base",["scripts/redactor/ueditor-insert","scripts/redactor/ueditor-inserts","text!scripts/redactor/ueditor-templates.html","scripts/redactor/ueditor-insert-utils"],function(t,n,r,i){var s=Upfront.Settings&&Upfront.Settings.l10n?Upfront.Settings.l10n.global.ueditor:Upfront.mainData.l10n.global.ueditor,o=t.UeditorInsert.extend({$editor:!1,caption_active:!1,className:"ueditor-insert upfront-inserted_image-wrapper",tpl:_.template(e(r).find("#image-insert-tpl").html()),resizable:!1,defaultData:{insert_type:"image_insert",caption:"<p>Default caption</p>",show_caption:1,imageFull:{src:"",width:100,height:100},imageThumb:{src:"",width:100,height:100},selectedImage:{src:"",width:100,height:100},linkType:"do_nothing",linkUrl:"",isLocal:1,alignment:{vid:"center",label:"Center"},externalImage:{top:0,left:0,width:0,height:0},variant_id:"",style:{label_id:"",vid:"",caption:{order:1,height:50,width_cls:"",left_cls:"ml0",top_cls:"mt0",show:1},group:{"float":"none",width_cls:"",left_cls:"ml0",height:0,marginRight:0,marginLeft:0},image:{width_cls:"",left_cls:"ml0",top_cls:"mt0",src:"",height:0}}},wp_defaults:{insert_type:"wp_default",attachment_id:"",caption:"<p>Default caption</p>",link_url:"",image:{src:"",url:"",width:0,height:0},style:{wrapper:{alignment:"alignnone",width:"310"},caption:{show:!0},image:{size_class:"size-medium"}}},events:{"click .ueditor-insert-remove":"click_remove","dragstart img":"on_image_dragstart"},is_post_image_insert:function(){return!this.is_image_insert()},is_image_insert:function(){return this.className.indexOf("basic-wrapper")!==-1},get_type:function(){return this.$editor&&this.$editor.data("ueditor")?_.contains(this.$editor.data("ueditor").options.inserts,"image")?n.NAMES.IMAGE:n.NAMES.POSTIMAGE:!1},get_caption_state:function(){return this.data.get("show_caption")?0:1},click_remove:function(e){e.preventDefault(),this.trigger("remove",this)},get_data_json:function(){return typeof this.prepare_data=="function"?this.prepare_data():this.data.toJSON()},make_caption_editable:function(){var t=this,n=this.data.get("style"),r=this.$(".wp-caption-text");if(!n)return!1;if(!n.caption||!this.data.get("show_caption")||this.$(".wp-caption-text").length===0)return;r.off("keyup").on("keyup",function(e){t.data.set("caption",this.innerHTML,{silent:!0}),t.data.trigger("update"),t.render_shortcode&&t.render_shortcode(t.get_data_json())}).ueditor({linebreaks:!1,autostart:!0,pastePlainText:!0,buttons:[],placeholder:t.defaultData.caption,inserts:[],focus:!1,paragraphize:!1}).attr("contenteditable",!1),this.caption_ueditor=r.data("ueditor"),this.caption_ueditor.redactor.events.on("ueditor:change",function(e){t.data.set("caption",t.caption_ueditor.$el.html(),{silent:!0}),t.data.trigger("update"),t.render_shortcode&&t.render_shortcode(t.get_data_json())}),this.caption_ueditor.redactor.events.on("ueditor:focus",function(e){if(e!=t.caption_ueditor.redactor)return;var n=t.$el.closest(".redactor-editor"),i=n.data("ueditor"),s=i?i.redactor:!1;if(!s)return;e.$element.is(r)?(n.attr("contenteditable",!1),r.attr("contenteditable",!0),t.caption_active=!0):(n.attr("contenteditable",!0),r.attr("contenteditable",!1),t.caption_active=!1),s.$editor.off("drop.redactor paste.redactor keydown.redactor keyup.redactor focus.redactor blur.redactor"),s.$textarea.on("keydown.redactor-textarea")}),this.caption_ueditor.redactor.events.on("ueditor:blur",function(e){if(e!=t.caption_ueditor.redactor)return;var n=t.$el.closest(".redactor-editor"),i=n.data("ueditor"),s=i?i.redactor:!1;if(!s)return;e.$element.is(r)?(n.attr("contenteditable",!0),r.attr("contenteditable",!1),t.caption_active=!1):(n.attr("contenteditable",!1),r.attr("contenteditable",!0),t.caption_active=!0),s.build.setEvents()}),t.$el.on("hover, click",function(e){e.stopPropagation();var n=t.$editor.is(".redactor-editor")?t.$editor:t.$editor.find(".upfront-object-content");r.attr("contenteditable",!0),n.attr("contenteditable",!1),t.caption_active=!0}),this.$editor.on("mouseenter, click",function(n){var i=e(this).is(".redactor-editor")?e(this):e(this).find(".upfront-object-content");r.attr("contenteditable",!1),i.attr("contenteditable",!0),t.caption_active=!1})},controlEvents:function(){var e=this;this.stopListening(this.controls),this.listenTo(this.controls,"control:ok:link",function(e,t){var n=e.$("input[type=text]").val(),r=e.$("input[type=radio]:checked").val()||"do_nothing",i={};"external"===r&&!n.match(/https?:\/\//)&&!n.match(/\/\/:/)&&(n=n.match(/^www\./)||n.match(/\./)?"http://"+n:n),i={linkType:r,linkUrl:n},this.data.set(i),e.model.set(i),t.close()}),this.listenTo(this.controls,"control:click:toggle_caption",function(e){var t=1;this.data.get("show_caption")&&(t=0),this.data.set("show_caption",t)}),this.listenTo(this.controls,"control:click:change_image",this.change_image),typeof this.control_events=="function"&&this.control_events()},updateControlsPosition:function(){this.controls.$el.css({left:15,top:15})},getSimpleOutput:function(){var t=this.el.cloneNode(!0),n=this.data.toJSON();return n.image=this.get_proper_image(),this.data.set("width",this.$el.width(),{silent:!0}),this.data.trigger("update"),n.isLocal=parseInt(n.isLocal,10),t.innerHTML=this.tpl(n),e(t).width(this.data.get("width")),e("<div>").html(t).html()},get_proper_image:function(){var e=this.data.toJSON(),t=e.imageFull,n=Upfront.Settings.LayoutEditor.Grid;return e.style=e.style||{image_col:0,group:"",image:"",caption:""},e.imageThumb&&e.style&&e.style.image&&e.style.image.col&&e.style.image.col*n.column_width<=e.imageThumb.width&&(t=e.imageThumb),t},getOutput:function(){var t=this.el.cloneNode(),n=this.data.toJSON();return n.image=this.get_proper_image(),n.image?(this.data.set("width",this.$el.width(),{silent:!0}),this.data.trigger("update"),n.isLocal=parseInt(n.isLocal,10),t.innerHTML=this.tpl(n),e("<div>").html(t).html()):!1},getImageData:function(e){if(!e)return!1;var t=e.at(0).toJSON(),n=this.getSelectedImage(t),r=this.is_wp?_.extend({},this.wp_defaults,{attachment_id:t.ID,caption:t.post_excerpt?t.post_excerpt:"",link_url:"",image:n,style:{caption:{show:!0},wrapper:{alignment:"alignnone",width:n.width},image:{size_class:"size-"+n.selected_size}}}):_.extend({},this.defaultData,{attachmentId:t.ID,title:t.post_tite,imageFull:t.image,imageThumb:this.getThumb(t.additional_sizes),selectedImage:_.isUndefined(t.selected_size)?t.image:_.filter(t.additional_sizes,function(e){var n=t.selected_size.toLowerCase().split("x"),r=n[0],i=n[1];return e.width==r&&e.height==i})[0],linkType:"do_nothing",linkUrl:"",align:"center"});return r},getThumb:function(e){var t={width:0};return _.each(e,function(e){e.width<=500&&e.width>t.width&&(t=e)}),t},getSelectedImage:function(e){e.image.selected_size="full";if(e.selected_size=="full")return e.image;var t=e.selected_size?e.selected_size.split("x"):[],n=["thumbnail","medium","large"];if(t.length!=2)return e.image;for(var r=0;r<e.additional_sizes.length;r++){var i=e.additional_sizes[r];i.selected_size=n[r];if(i.width==t[0]&&i.height==t[1])return i}return e.image},importInserts:function(t,n,r){var i=this,s={},o={};return remaining_images=t.find("img"),t.is(".wp-caption-text")||(this.$editor=t),i.importFromShortcode&&this.is_post_image_insert()&&(o=i.importFromShortcode(t,n,r)),this.is_post_image_insert()&&(remaining_images=t.find("img").filter(function(){return!e(this).closest(".ueditor-insert").length})),_.each(remaining_images,function(e){var t=!1;t=i.importFromImage(e),t&&(s[t.data.id]=t)}),_.extend(s,o)},importFromWrapper:function(e,t,n){var r=e.attr("id"),i=!1,s=!1,o=!1,u=ImageInsert;return _.contains(n,"postImage")&&(u=PostImageInsert),t[r]?i=new u({data:t[r]}):i=this.importFromImage(e.find("img")),i.render(),e.replaceWith(i.$el),i},getLinkView:function(){if(this.linkView)return this.linkView;var e=new i.LinkView({data:{linkType:this.data.get("linkType"),linkUrl:this.data.get("linkUrl")}});return this.linkView=e,e},getStyleView:function(){if(this.styleView)return this.styleView;var e=new i.PostImageStylesView(this.data);return this.styleView=e,e},calculateRealSize:function(e){var t=new Image;return t.src=e,{width:t.width,height:t.height}},generateThumbSrc:function(e,t){var n=this.data.get("imageFull").src,r=n.split("."),i=r.pop();return n=r.join(".")+"-"+e+"x"+t+"."+i,n},calculateImageResize:function(e,t){var n=t.width/t.height>e.width/e.height?"height":"width",r=t[n]/e[n],i={width:Math.round(t.width/r),height:Math.round(t.height/r)},s=n=="width";return i.top=s?-Math.round((i.height-e.height)/2):0,i.left=s?0:-Math.round((i.width-e.width)/2),i},render_shortcode:function(e){if(this.is_image_insert())return;e=e instanceof Backbone.Model?e.toJSON():e;var t=this.shortcode_tpl(e);t=t.replace(/\[caption[\s\S]+?\[\/caption\]/g,function(e){return e.replace(/<br([^>]*)>/g,"<wp-temp-br$1>").replace(/[\r\n\t]+/,"")}),t=t.replace(/\s*<div/g,"\n<div"),t=t.replace(/<\/div>\s*/g,"</div>\n"),t=t.replace(/\s*\[caption([^\[]+)\[\/caption\]\s*/gi,"\n\n[caption$1[/caption]\n\n"),t=t.replace(/caption\]\n\n+\[caption/g,"caption]\n\n[caption"),t=t.replace(/\s+/g," "),this.$shortcode_el.html(t)},on_image_dragstart:function(e){e.preventDefault()},change_image:function(){var e=this;return Upfront.Media.Manager.open({multiple_selection:!1,insert_options:!1,button_text:s.change_image,hide_sizes:this.data.get("insert_type")==="image_insert"}).done(function(t,n){var r;if(_.isEmpty(n))return;e.start(n),e.$editor&&e.$editor.data("ueditor")&&(r=e.$editor.data("ueditor"),r.redactor.code.sync())}),!1}});return{ImageInsertBase:o}})}(jQuery),function(e){define("scripts/redactor/ueditor-image-insert",["scripts/redactor/ueditor-insert","scripts/redactor/ueditor-insert-utils","scripts/redactor/ueditor-image-insert-base","text!scripts/redactor/ueditor-templates.html"],function(t,n,r,i){var s=r.ImageInsertBase.extend({className:"ueditor-insert upfront-inserted_image-wrapper upfront-inserted_image-basic-wrapper",create_controlls:function(e){this.controlsData=[{id:"link",type:"dialog",icon:"link",tooltip:"Link image",view:this.getLinkView()},{id:"toggle_caption",type:"simple",icon:"caption",tooltip:"Toggle Caption",active:_.bind(this.get_caption_state,this)}],this.allow_alignment(e)&&this.controlsData.unshift({id:"style",type:"dialog",icon:"style",tooltip:"Alignment",view:this.getStyleView()}),this.createControls()},start:function(e){var t=this,n=Upfront.Media.Manager.open({multiple_selection:!1});return n.done(function(n,r){var i=t.getImageData(r);i.id=t.data.id,t.data.clear({silent:!0}),i.style=t.defaultData.style,i.variant_id="basic-image",t.$editor=e.closest(".redactor-box"),t.data.set(i)}),n},render:function(){var t=_.extend({},this.defaultData,this.data.toJSON()),n=t.style,r=this.data.get("alignment");if(!n)return;t.style.label_id="ueditor-image-style-center",r&&(t.style.label_id="ueditor-image-style-"+r.vid,t.style.group.float=r.vid),t.image=this.get_proper_image(),t.style.group.width_cls=this.get_group_width_cls(t.image),t.show_caption==0&&(t.style.image.width_cls=Upfront.Settings.LayoutEditor.Grid.class+24);var i=this.$el.find(".ueditor-insert-variant-group"),s=Upfront.Behaviors.GridEditor,o=e(".upfront-content-marker-contents"),u=parseFloat(e(".upfront-content-marker-contents>*").css("padding-left"))/s.col_size,a=parseFloat(e(".upfront-content-marker-contents>*").css("padding-right"))/s.col_size,f=Upfront.Util.grid.width_to_col(o.width(),!0),l=f-u-a,c=e(".upfront-content-marker-contents>*").width()/l;u=u?parseInt(u):0,a=a?parseInt(a):0,n&&n.group&&n.group.float&&(n.group.float=="left"&&u>0?(t.style.group.marginLeft=(u-Math.abs(n.group.margin_left))*c,t.style.group.marginRight=0):n.group.float=="right"&&a>0?(t.style.group.marginRight=(a-Math.abs(n.group.margin_right))*c,t.style.group.marginLeft=0):n.group.float=="none"&&u>0&&(t.style.group.marginLeft=(u-Math.abs(n.group.margin_left)+Math.abs(n.group.left))*c,t.style.group.marginRight=0)),this.$el.html(this.tpl(t)),this.create_controlls(t.style.group.width_cls),this.controls.render(),this.$(".ueditor-insert-variant-group").append(this.controls.$el),this.make_caption_editable(),this.updateControlsPosition(),this.$(".ueditor-insert-variant-group").append('<a href="#" contenteditable="false" class="upfront-icon-button upfront-icon-button-delete ueditor-insert-remove"></a>')},allow_alignment:function(e){if(typeof e=="undefined")return!1;var t=parseInt(e.replace("c",""),10),n=Upfront.Util.grid.width_to_col(this.$editor.width());return t+2<=n},control_events:function(){var e=this;this.listenTo(this.controls,"control:ok:style",function(e,t){e._style&&(this.data.set("variant_id",e.variant_id),this.data.set("alignment",e._style),e.data.set("selected",e.variant_id)),t.close()})},get_group_width_cls:function(e){var t=Upfront.Util.grid.width_to_col(e.width),n=Upfront.Util.grid.width_to_col(this.$editor.width());return t+1<=n?Upfront.Settings.LayoutEditor.Grid.class+t:Upfront.Settings.LayoutEditor.Grid.class+n},get_proper_image:function(){var e=this.data.toJSON(),t=e.imageFull,n=Upfront.Settings.LayoutEditor.Grid,r=Upfront.Util.grid.width_to_col(this.$editor.width());return _.isEmpty(e.selectedImage.src)?t:e.selectedImage},importFromImage:function(t){t=t instanceof jQuery?t:e(t);var r=_.extend({},this.defaultData),i={src:t.attr("src"),width:t.width(),height:t.height()},o=e("<a>").attr("href",i.src)[0],u=this.calculateRealSize(i.src),a=t.closest(".ueditor-insert-variant-group"),f=a.attr("class"),l=a.find(".wp-caption-text"),c=l.attr("class"),h=a.find(".uinsert-image-wrapper"),p=h.attr("class"),d=1;o.origin!=window.location.origin&&(r.isLocal=0),r.imageThumb=i,r.imageFull={width:u.width,height:u.height,src:i.src};var v=t.parent();v.is("a")&&(r.linkUrl=v.attr("href"),r.linkType="external");var m=t.attr("class");m?(m=m.match(/wp-image-(\d+)/),m?r.attachmentId=m[1]:r.attachmentId=!1):r.attachmentId=!1,r.title=t.attr("title"),_.isEmpty(l.text())||(r.caption=l.html()),d=l.prev(h).length?1:0,r.show_caption=l.length,a.length?(r.style={caption:{order:1,height:l.css("minHeight")?l.css("minHeight").replace("px",""):l.height(),width_cls:Upfront.Util.grid.derive_column_class(c),left_cls:Upfront.Util.grid.derive_marginleft_class(c),top_cls:Upfront.Util.grid.derive_margintop_class(c),show:l.length},group:{"float":a.css("float"),width_cls:Upfront.Util.grid.derive_column_class(f),left_cls:Upfront.Util.grid.derive_marginleft_class(f),height:a&&a.css("minHeight")?a.css("minHeight").replace("px",""):i.height+l.height(),marginRight:0,marginLeft:0},image:{width_cls:Upfront.Util.grid.derive_column_class(p),left_cls:Upfront.Util.grid.derive_marginleft_class(p),top_cls:Upfront.Util.grid.derive_margintop_class(p),src:"",height:0}},r.variant_id=a.data("variant"),r.variant_id&&(r.alignment=n.BasicImageVariants.findWhere({vid:a.data("variant")}))):(r.alignment=n.BasicImageVariants.first(),r.variant_id=r.alignment.vid);var g=new s({data:r});g.render();var y=t.hasClass(".upfront-inserted_image-basic-wrapper")?t:t.closest(".upfront-inserted_image-basic-wrapper");return y.replaceWith(g.$el),g},getStyleView:function(){if(this.styleView)return this.styleView;var e=new n.ImageStylesView(this.data);return this.styleView=e,e}});return{ImageInsert:s}})}(jQuery),function(e){define("scripts/redactor/ueditor-image-insert-post",["scripts/redactor/ueditor-insert","scripts/redactor/ueditor-image-insert-base","text!scripts/redactor/ueditor-templates.html","scripts/redactor/ueditor-insert-utils"],function(t,n,r,i){var s=Upfront.Settings&&Upfront.Settings.l10n?Upfront.Settings.l10n.global.ueditor:Upfront.mainData.l10n.global.ueditor,o=n.ImageInsertBase.extend({className:"ueditor-insert upfront-inserted_image-wrapper ueditor-insert-variant ueditor-post-image-insert",tpl:_.template(e(r).find("#post-image-insert-tpl").html()),shortcode_tpl:_.template(e(r).find("#post-image-insert-shortcode-tpl").html().replace(/\s+/g," ")),init:function(e){this.$editor=e.$editor,this.controlsData=[{id:"style",type:"dialog",icon:"style",tooltip:s.style,view:this.getStyleView()},{id:"change_image",type:"simple",icon:"change_image",tooltip:s.change_image},{id:"link",type:"dialog",icon:"link",tooltip:s.link_image,view:this.getLinkView()},{id:"toggle_caption",type:"simple",icon:"caption",tooltip:s.toggle_caption,active:_.bind(this.get_caption_state,this)}],this.createControls();if(e.start)return this.start(e.start)},start:function(e){var t=this.getImageData(e);return t.id=this.data.id,t.style=this.data.get("style")||Upfront.Content.ImageVariants.first().toJSON(),t.variant_id=t.style.vid,this.data.clear({silent:!0}),this.data.set(t,{silent:!0}),this.set_selected_style(),this.render(),this},set_selected_style:function(){_.findWhere(this.controlsData,{id:"style"}).view.data.set("selected",this.data.get("variant_id"))},render:function(){var e=this.prepare_data();this.$el.html(this.tpl(e)),this.$shortcode_el=this.$(".post-images-shortcode"),this.render_shortcode(e),this.createControls(),this.controls.render();var t=this.$(".ueditor-insert-variant-group");t.append(this.controls.$el),this.make_caption_editable(),this.updateControlsPosition(),t.append('<a href="#" contenteditable="false" class="upfront-icon-button upfront-icon-button-delete ueditor-insert-remove"></a>')},prepare_data:function(){var t=_.extend({},this.defaultData,this.data.toJSON()),n=t.style;if(!n)return;t.style.label_id=t.style.label&&t.style.label.trim()!==""?"ueditor-image-style-"+t.style.label.toLowerCase().trim().replace(" ","-"):t.style.vid,t.image=this.get_proper_image(),t.linkType=="show_larger_image"&&(t.linkUrl=t.image.src),t.show_caption==0&&(t.style.image.width_cls=Upfront.Settings.LayoutEditor.Grid.class+24);var r=this.$el.find(".ueditor-insert-variant-group"),i=Upfront.Behaviors.GridEditor,s=e(".upfront-content-marker-contents"),o=parseFloat(e(".upfront-content-marker-contents>*").css("padding-left"))/i.col_size,u=parseFloat(e(".upfront-content-marker-contents>*").css("padding-right"))/i.col_size,a=Upfront.Util.grid.width_to_col(s.width(),!0),f=a-o-u,l=e(".upfront-content-marker-contents>*").width()/f,c=this.$editor.closest(".upfront-object"),h=parseInt(c.css("padding-left"),10),p=parseInt(c.css("padding-right"),10);return this.$editor.hasClass("upfront-indented_content")&&(s=this.$editor,o=parseFloat(s.css("padding-left"))/i.col_size,u=parseFloat(s.css("padding-right"))/i.col_size,a=Upfront.Util.grid.width_to_col(s.width(),!0),f=a-o-u,l=i.col_size,this.$el.attr("style","margin-left: "+(o*l*-1-h)+"px; margin-right: "+(u*l*-1-p)+"px;")),o=o?parseInt(o,10):0,u=u?parseInt(u,10):0,n&&n.group&&n.group.float&&(n.group.float=="left"&&o>0?(t.style.group.marginLeft=(o-Math.abs(n.group.margin_left))*l,t.style.group.marginRight=0):n.group.float=="right"&&u>0?(t.style.group.marginRight=(u-Math.abs(n.group.margin_right))*l,t.style.group.marginLeft=0):n.group.float=="none"&&o>0&&(t.style.group.marginLeft=(o-Math.abs(n.group.margin_left)+Math.abs(n.group.left))*l,t.style.group.marginRight=0)),t},control_events:function(){this.listenTo(this.controls,"control:ok:style",function(e,t){if(e._style){var n=e._style.toJSON();this.data.set("variant_id",n.vid),this.data.set("style",n),e.data.set("selected",n.vid)}t.close()})}}),u=n.ImageInsertBase.extend({className:"ueditor-insert upfront-inserted_image-wrapper upfront-wp-inserted_image-wrapper",tpl:_.template(e(r).find("#post-image-insert-wp-tpl").html()),shortcode_tpl:_.template(e(r).find("#post-image-insert-shortcode-wp-tpl").html()),generate_new_id:function(){return"wpinsert-"+ ++Upfront.data.ueditor.insertCount},init:function(e){this.$editor=e.$editor;if(e.start)return this.start(e.start)},prepare_controls:function(){this.controlsData=[{id:"wp_style",type:"dialog",icon:_.bind(this.get_style_icon,this),tooltip:"Style",view:this.getStyleView(),hideOkButton:!0},{id:"change_image",type:"simple",icon:"change_image",tooltip:s.change_image},{id:"link",type:"dialog",icon:"link",tooltip:"Link image",view:this.getLinkView()},{id:"toggle_caption",type:"simple",icon:"caption",tooltip:"Toggle Caption",active:_.bind(this.get_caption_state,this)}]},start:function(e){var t=this,n=t.getImageData(e);return n.id=t.data.id,n.variant_id=t.data.get("variant_id")||"alignnone",t.data.clear({silent:!0}),t.data.set(n,{silent:!0}),this.prepare_controls(),this.createControls(),this.render(),this},getImageData:function(e){if(!e)return!1;var t=e.at(0).toJSON(),n=this.getSelectedImage(t),r=_.extend({},this.wp_defaults,{attachment_id:t.ID,caption:t.post_excerpt?t.post_excerpt:"",link_url:"",image:n,style:{caption:{show:!0},wrapper:{alignment:"alignnone",width:n.width},image:{size_class:"size-"+n.selected_size}}});return r},render:function(){var e=this.data.toJSON();e.variant_id&&(e.style.wrapper.alignment=e.variant_id),this.$el.html(this.tpl(e)),this.$shortcode_el=this.$(".post-images-shortcode-wp"),this.render_shortcode(e),this.prepare_controls(),this.createControls(),this.controls.render();var t=this.$(".wp-caption");t.append(this.controls.$el),this.make_caption_editable(),this.updateControlsPosition(),t.append('<a href="#" contenteditable="false" class="upfront-icon-button upfront-icon-button-delete ueditor-insert-remove"></a>')},getStyleView:function(){if(this.styleView)return this.styleView;var e=new i.WP_PostImageStylesView({model:this.data});return this.styleView=e,e},get_caption_state:function(){return this.data.get("style").caption.show?0:1},get_style_icon:function(){var e="wp-style";return this.data&&this.data.get("style")&&(e+=" "+this.data.get("style").wrapper.alignment),e},controlEvents:function(){this.listenTo(this.controls,"control:click:toggle_caption",function(e){var t=1,n=Upfront.Util.clone(this.data.toJSON().style);this.get_caption_state()||(t=0),n.caption.show=t,this.data.set("style",n)}),this.listenTo(this.controls,"control:ok:link",function(e,t){var n=e.$("input[type=radio]:checked").val()||"do_nothing",r=n==="do_nothing"?"":e.$("input[type=text]").val(),i="";n=="show_larger_image"&&(r=this.data.get("image").src),this.data.set("link_url",r),t.close()}),this.listenTo(this.controls,"control:click:change_image",this.change_image)},get_url_type:function(e,t){var n="",r=document.createElement("a");return r.href=e,r.origin!=window.location.origin&&(n="external"),r.origin==window.location.origin&&t!=e&&(n="post"),r.origin==window.location.origin&&t==e&&(n="show_larger_image"),n}});return{PostImageInsert:o,WP_PostImageInsert:u}})}(jQuery),function(e){define("scripts/redactor/ueditor-embed-insert",["scripts/redactor/ueditor-insert","text!scripts/redactor/ueditor-templates.html"],function(t,n){var r=t.UeditorInsert.extend({type:"embed",className:"ueditor-insert upfront-inserted_embed-wrapper uinsert-drag-handle",defaultData:{code:""},start:function(){var t=this,n=new i({code:this.data.get("code")}),r=new e.Deferred;return n.on("done",function(e){t.data.set({code:e}),n.remove(),r.resolve(this,e)}),n.on("render",function(e,r,i){t.trigger("manager:rendered",n,e,r,i)}),Upfront.Events.on("upfront:element:edit:stop",function(){n.remove(),r.resolve()}),this.get_manager=function(){return n},r},get_manager:function(){return{}},render:function(){var t=this,n=this.data.get("code"),r=e("<div />").append(n);this.$el.empty();if(!n)return;r.append('<div class="upfront-edit_insert">edit</div>'),this.$el.append(e("<div />").append(r).html()),this.$el.off("click",".upfront-edit_insert").on("click",".upfront-edit_insert",function(e){e.preventDefault(),e.stopPropagation(),t.start()})},getOutput:function(){return this._get_output()},getSimpleOutput:function(){return this._get_output()},_get_output:function(){var t=this.data.get("code"),n=e("<div />").append('<div class="upfront-inserted_embed">'+t+"</div>");return t?n.html():""},importInserts:function(t,n){var i={};return t.find(".upfront-inserted_embed").each(function(){var t=e(this),n=new r({data:{code:t.html()}});i[n.data.id]=n,n.render(),t.replaceWith(n.$el)}),i}}),i=Backbone.View.extend({className:"upfront-inserts-markup-editor",initialize:function(e){var t=this,n=e&&e.code?e.code:"";require([Upfront.Settings.ace_url],function(){t.render(n)})},render:function(t){var n=this,r=new s.Main({code:t}),i=new s.Bar,o=new s.OK;r.render(),i.render(),o.render(),this.$el.empty().append(i.$el).append(o.$el).append(r.$el),e("body").append(this.$el),r.boot_editor(),this.$el.width(e(window).width()-e("#sidebar-ui").width()-1),i.on("insert",function(e){r.insert(e)}),this._main=r,o.on("done",this.done,this),this.trigger("render",r,i,o)},done:function(){if(!this._main||!this._main.get_value)return!1;var e=this._main.get_value();this.trigger("done",e)}}),s={l10n:Upfront.Settings.l10n.markup_embeds,OK:Backbone.View.extend({className:"upfront-inserts-markup-apply",events:{click:"propagate_apply"},propagate_apply:function(e){e.stopPropagation(),e.preventDefault(),this.trigger("done")},render:function(){this.$el.empty().append('<a href="#">'+s.l10n.done+"</a>")}}),Bar:Backbone.View.extend({className:"upfront-inserts-markup-bar",events:{click:"stop_prop","click .inserts-shortcode":"request_shortcode","click .inserts-image":"request_image"},stop_prop:function(e){e.stopPropagation()},render:function(){this.$el.empty().append('<ul><li><a href="#" class="inserts-shortcode">'+s.l10n.insert_shortcode+"</a></li>"+'<li><a href="#" class="inserts-image">'+s.l10n.insert_image+"</a></li>"+"</ul>")},request_shortcode:function(t){t.stopPropagation(),t.preventDefault();var n=this;Upfront.Popup.open(function(){var t=this,n=new s.ShortcodesList;n.render(),n.on("done",function(e){Upfront.Popup.close(e)}),e(this).empty().append(n.$el)},{},"embed-shortcode").done(function(e,t){n.trigger("insert",t)})},request_image:function(e){e.stopPropagation(),e.preventDefault();var t=this;Upfront.Media.Manager.open({multiple_selection:!1,media_type:["images"],hold_editor:!0}).done(function(e,n){if(!n)return;var r=n.models[0],i=r.get("image").src;i=i.replace(document.location.origin,""),t.trigger("insert",i)})}}),Main:Backbone.View.extend({className:"upfront-embed_editor",events:{click:"stop_prop"},code:"",initialize:function(e){e&&e.code&&(this.code=e.code)},stop_prop:function(e){e.stopPropagation()},render:function(){this.$el.empty().append('<div class="upfront-inserts-markup active"><div class="upfront-inserts-ace"></div></div>').show()},boot_editor:function(){var e=this.$el,t=e.find(".upfront-inserts-ace"),n=t.html(),r=ace.edit(t.get(0)),i=t.data("type");r.getSession().setUseWorker(!1),r.setTheme("ace/theme/monokai"),r.getSession().setMode("ace/mode/html"),r.setShowPrintMargin(!1),r.getSession().setValue(this.code),r.renderer.scrollBar.width=5,r.renderer.scroller.style.right="5px",t.height(e.height()),r.resize(),r.focus(),this.editor=r},insert:function(e){this.editor.insert(e)},get_value:function(){return this.editor.getValue()}}),ShortcodesList:Backbone.View.extend({events:{click:"stop_prop"},stop_prop:function(e){e.stopPropagation()},render:function(){var e=this;this.$el.empty().append(s.l10n.waiting),Upfront.Util.post({action:"upfront_list_shortcodes"}).done(function(t){e.$el.empty().append('<div class="shortcode-types" />').append('<div class="shortcode-list" />'),e.render_types(t.data),e.render_list()})},render_types:function(e){var t=this,n=[{label:s.l10n.select_area,value:0}],r=this.$el.find(".shortcode-types");_.each(_.keys(e),function(e){n.push({label:e,value:e})});var i=new Upfront.Views.Editor.Field.Select({label:"",name:"shortcode-selection",width:"100%",values:n,multiple:!1,change:function(){var n=this.get_value();if(!(n in e))return!1;t.render_list(e[n])}});i.render(),r.empty().append(i.$el)},render_list:function(e){var t=this,n=this.$el.find(".shortcode-list");n.empty();if(empty(e))return!1;_.each(e,function(e){var e=new s.Shortcode({code:e});e.render(),e.on("done",function(e){t.trigger("done",e)}),n.append(e.$el)})}}),Shortcode:Backbone.View.extend({tagName:"pre",events:{click:"send_shortcode"},initialize:function(e){this.code=e.code},send_shortcode:function(e){e.stopPropagation(),e.preventDefault();if(!this.code)return!1;this.trigger("done","["+this.code+"]")},render:function(){this.$el.empty().append("<code>["+this.code+"]</code>")}})};return{EmbedInsert:r}})}(jQuery),function(e){define("scripts/redactor/ueditor-post-image-insert-manager",["scripts/redactor/ueditor-insert","scripts/redactor/ueditor-image-insert-base","text!scripts/redactor/ueditor-templates.html","scripts/redactor/ueditor-image-insert-post"],function(t,n,r,i){var s=i.PostImageInsert,o=i.WP_PostImageInsert,u=n.ImageInsertBase.extend({start:function(t,n){var r=this,i=Upfront.Media.Manager.open({multiple_selection:!1,insert_options:!0}),u=e.Deferred();return i.done(function(e,t){if(_.isEmpty(t))return;var r=t.at(0).get("insert_option")==="wp_default";if(r){var i=new o({start:t,$editor:n});u.resolve(i)}else{var i=new s({start:t,$editor:n});u.resolve(i)}}),e.when(i,u.promise())},importFromShortcode:function(t,n,r){var i=this,s,r={};this.$editor=t;var o=wp.shortcode.replace("caption",t.html(),function(t){return t.parse_content=e.parseHTML(t.content),t.get("id").indexOf("uinsert-")!==-1?s=i.importFromShortcode_UF(t):s=i.importFromShortcode_WP(t),r[s.data.id]=s,s.el.outerHTML});return t.html(o),r},importFromShortcode_UF:function(e){var t=_.extend({},this.defaultData),n=this.calculateRealSize(t.imageThumb.src);t.imageThumb.src=this.get_shortcode_image_src(e.content),t.caption=this.get_shortcode_caption_text(e.parse_content),t=this.populate_link(e.content,t),t.imageFull={width:n.width,height:n.height,src:t.imageThumb.src},t.style=this._findVariant(e.get("uf_variant")).toJSON(),t.style.caption.show=e.get("uf_show_caption"),t.variant_id=t.style.vid;var r=new s({data:t,$editor:this.$editor});return r.render(),r},_findVariant:function(e){var t=Upfront.Content.ImageVariants.findWhere({vid:e}),n,r;if(t)return t;n=Upfront.Content.PrevImageVariants.findWhere({vid:e});if(n){n=n.toJSON(),t=Upfront.Content.ImageVariants.findWhere({label:n.label});if(t)return t;t=Upfront.Content.ImageVariants.find(function(e){return e.get("group").float==n.group.float});if(t)return t}r=Upfront.Content.OtherImageVariants.findWhere({vid:e});if(r){r=r.toJSON(),t=Upfront.Content.ImageVariants.findWhere({label:r.label});if(t)return t;t=Upfront.Content.ImageVariants.find(function(e){return e.get("group").float==r.group.float});if(t)return t}if(n){t=Upfront.Content.ImageVariants.find(function(e){return e.get("image").order==n.image.order});if(t)return t}if(r){t=Upfront.Content.ImageVariants.find(function(e){return e.get("image").order==r.image.order});if(t)return t}return t=Upfront.Content.ImageVariants.first(),t},importFromShortcode_WP:function(t){var n=_.extend({},this.wp_defaults,{attachment_id:t.get("id").replace("attachment_",""),caption:this.get_shortcode_caption_text(e.parseHTML(t.content)),link_url:this.get_shortcode_url(t.content),image:{height:this.get_shortcode_content_image_height(t.content),width:t.get("width"),src:this.get_shortcode_image_src(t.content)},style:{caption:{show:parseInt(t.get("show_caption"),10)},wrapper:{alignment:t.get("align"),width:parseInt(t.get("width"),10)},image:{size_class:this.get_shortcode_content_image_size_class(t.content)}}}),r=new o({data:n,$editor:this.$editor});return r.render(),r},get_shortcode_image_src:function(t){return e("<div>").html(t).find("img").attr("src")},get_shortcode_caption_text:function(t){var n="";return _.each(t,function(t,r){e(t).is("img")||(n+=e("<div>").html(t).html())}),n},get_shortcode_content_image_size_class:function(t){var n=/(?:^|\W)size-(\w+)(?!\w)/g,r=e("<div>").html(t).find("img"),i=r.length?r.attr("class").match(n):!1;return i?i[0]:""},get_shortcode_content_image_height:function(t){var n=e("<div>").html(t).find("img");return(n.length?n.attr("height"):"")||"auto"},populate_link:function(e,t){t.linkUrl=this.get_shortcode_url(e);if(!t.linkUrl)return t;var n=document.createElement("a");return n.href=t.linkUrl,n.origin!=window.location.origin&&(t.linkType="external"),n.origin==window.location.origin&&t.imageThumb.src!=t.linkUrl&&(t.linkType="post"),n.origin==window.location.origin&&t.imageThumb.src==t.linkUrl&&(t.linkType="show_larger_image"),t},get_shortcode_url:function(t){return e("<div>").html(t).find("a").attr("href")},get_image_size_class:function(e){var t=/(?:^|\W)size-(\w+)(?!\w)/g,n=e.className?e.className.match(t):!1;return n?n[0]:""},get_image_attachment_id:function(e){var t=/(?:^|\W)wp-image-(\w+)(?!\w)/g,n=e.className?e.className.match(t):!1;return n?n[0]:""},importFromImage:function(t){var n=e(t),r=_.extend({},this.wp_defaults,{attachment_id:this.get_image_attachment_id(t),caption:e.trim(n.attr("alt")),link_url:t.src,image:{height:parseInt(n.height(),10),width:parseInt(n.width(),10),src:t.src},style:{caption:{show:!1},wrapper:{alignment:"alignnone",width:parseInt(n.width(),10)},image:{size_class:this.get_image_size_class(t)}}}),i=new o({data:r,$editor:this.$editor});return i.render(),n.replaceWith(i.$el),i},importFromImage_prev:function(t){var n=_.extend({},this.defaultData),r={src:t.attr("src"),width:t.width(),height:t.height()},i=e("<a>").attr("href",r.src)[0],o=this.calculateRealSize(r.src),u=t.closest(".ueditor-insert-variant-group"),a=u.attr("class"),f=u.find(".wp-caption-text"),l=f.attr("class"),c=u.find(".uinsert-image-wrapper"),h=c.attr("class"),p=1;i.origin!=window.location.origin&&(n.isLocal=0),this.calculateRealSize(r.src),n.imageThumb=r,n.imageFull={width:o.width,height:o.height,src:r.src};var d=t.parent();d.is("a")&&(n.linkUrl=d.attr("href"),n.linkType="external");var v=t.attr("class");v?(v=v.match(/wp-image-(\d+)/),v?n.attachmentId=v[1]:n.attachmentId=!1):n.attachmentId=!1,n.title=t.attr("title"),_.isEmpty(f.text())||(n.caption=f.html()),p=f.prev(c).length?1:0,f.length===0&&(p=1),u.length?(n.style={caption:{order:p,height:f.css("minHeight")?f.css("minHeight").replace("px",""):f.height(),width_cls:Upfront.Util.grid.derive_column_class(l),left_cls:Upfront.Util.grid.derive_marginleft_class(l),top_cls:Upfront.Util.grid.derive_margintop_class(l),show:f.length},group:{"float":u.css("float"),width_cls:Upfront.Util.grid.derive_column_class(a),left_cls:Upfront.Util.grid.derive_marginleft_class(a),height:u&&u.css("minHeight")?u.css("minHeight").replace("px",""):r.height+f.height(),marginRight:0,marginLeft:0},image:{width_cls:Upfront.Util.grid.derive_column_class(h),left_cls:Upfront.Util.grid.derive_marginleft_class(h),top_cls:Upfront.Util.grid.derive_margintop_class(h),src:"",height:0}},n.variant_id=u.data("variant")):(n.style=Upfront.Content.ImageVariants.first().toJSON(),n.variant_id=n.style.vid);var m=new s({data:n});return m.render(),t.replaceWith(m.$el),m}});return{PostImageInsert_Manager:u}})}(jQuery),function(e){define("scripts/redactor/ueditor-inserts",["scripts/redactor/ueditor-insert","scripts/redactor/ueditor-image-insert","scripts/redactor/ueditor-image-insert-post","scripts/redactor/ueditor-embed-insert","scripts/redactor/ueditor-post-image-insert-manager"],function(e,t,n,r,i){var s={IMAGE:"image",POSTIMAGE:"postImage",EMBED:"embed"},o={},u={};return o[s.POSTIMAGE]=i.PostImageInsert_Manager,o[s.IMAGE]=t.ImageInsert,o[s.EMBED]=r.EmbedInsert,u[s.POSTIMAGE]="Image",u[s.IMAGE]="Image",u[s.EMBED]="Embed",{UeditorInsert:e.UeditorInsert,inserts:o,TYPES:s,NAMES:u}})}(jQuery),function(e){var t=Upfront.Settings&&Upfront.Settings.l10n?Upfront.Settings.l10n.global.ueditor:Upfront.mainData.l10n.global.ueditor;define("redactor_plugins",["text!scripts/redactor/ueditor-templates.html","scripts/upfront/link-model"],function(n,r){var i=_.extend({},Backbone.Events),s=Backbone.View.extend({initialize:function(e){var t=this;t.redactor=e.redactor,t.button=e.button,t.panel=e.panel,this.on("open",function(e){t.$el.trigger("open",e)}),this.on("closed",function(e){t.$el.trigger("closed",e)}),typeof this.init=="function"&&this.init(),this.render()},openToolbar:function(e){var t=this},closeToolbar:function(){this.redactor.$air.fadeOut(100),this.redactor.dropdown.hideAll(),this.$el.trigger("toolbarClosed",this.redactor)},closePanel:function(){this.panel.is(":visible")&&this.button.click()},disableEditorStop:function(){this.redactor.ueditor.disableStop=!0},enableEditorStop:function(){var e=this;setTimeout(function(){e.redactor.ueditor.disableStop=!1},300)},appendOkButton:function(t){var n=this;if(!n.$el.siblings(".ueditor-ok").length){t=t||Upfront.Settings.l10n.global.content.ok;var r=e('<a class="ueditor-ok">'+t+"</a>").on("click",function(e){n.$el.trigger("ok")});r.insertAfter(n.$el)}}});if(!o)var o={};return o.stateButtons=function(){return{init:function(){if(!this.$toolbar)return;this.$air=this.$toolbar.closest(".redactor_air"),this.stateButtons.addStateButtons(),this.stateButtons.startStateObserver()},addStateButtons:function(){var t=this;e.each(this.opts.stateButtons,function(n,r){if(e.inArray(n,t.opts.airButtons)!==-1){var i=new t.stateButtons.StateButton(n,r),s=t.button.add(n,r.title);t.button.addCallback(s,function(){t.stateButtons.stateCallback(n,i)}),t.$air.on("show",function(){i.guessState(t)})}})},stateCallback:function(e,t){t.guessState(this),t.callback(e,this.button.get(e),t)},startStateObserver:function(){var t=e.proxy(this.stateObserver,this);this.$element.on("mouseup.redactor keyup.redactor",t)},stateObserver:function(){var t=this;e.each(this.stateButtons.stateButtons,function(e,n){n.guessState(t)}),t.waitForMouseUp=!1},StateButton:function(t,n){var r=this,i={},s=!1;return firstState=!1,r.id=t,r.currentState=n.defaultState,r.states=n.states,r.iconClasses="",r.defaultState=n.defaultState,e.each(r.states,function(e,t){s?i[s]=e:firstState=e,r.iconClasses+=" "+t.iconClass,s=e}),i[s]=firstState,r.nextStates=i,r.nextState=function(e){this.setState(r.nextStates[this.currentState],e)},r.setState=function(e,t){this.currentState=e,t.removeClass(this.iconClasses).addClass(this.states[this.currentState].iconClass)},r.triggerState=function(t,n,r,i){var s=e.proxy(this.states[this.currentState].callback,t);s(n,r,i)},r.guessState=function(t){var n=!1;e.each(this.states,function(e,r){n=r.isActive(t)?e:n}),n||(n=this.defaultState),this.setState(n,t.button.get(this.id))},r.getElement=function(e){return e.button.get(this.id)},{id:t,title:n.title,callback:function(e,t,n){n.nextState(t),n.triggerState(this,e,t,n)},nextState:e.proxy(r.nextState,r),setState:e.proxy(r.setState,r),triggerState:e.proxy(r.triggerState,r),guessState:e.proxy(r.guessState,r)}}}},o.stateAlignment=function(){return{align:function(t){e(this.selection.getBlock()).css("text-align",t),e(this.selection.getBlocks()).css("text-align",t),this.selection.restore(),this.code.sync()},init:function(){if(!this.$toolbar)return;var n=this;this.opts.stateButtons.stateAlign={title:t.text_align,defaultState:"left",states:{left:{iconClass:"ueditor-left",isActive:function(t){var n=e(t.selection.getBlock());return n.length&&n[0].nodeType==3&&(n=n.parent()),n.length&&n.css("text-align")=="left"},callback:function(e,t,r){n.stateAlignment.align("left")}},center:{iconClass:"ueditor-center",isActive:function(t){var n=e(t.selection.getBlock());return n.length&&n[0].nodeType==3&&(n=n.parent()),n.length&&n.css("text-align")=="center"},callback:function(e,t,r){n.stateAlignment.align("center")}},right:{iconClass:"ueditor-right",isActive:function(t){var n=e(t.selection.getBlock());return n.length&&n[0].nodeType==3&&(n=n.parent()),n.length&&n.css("text-align")=="right"},callback:function(e,t,r){n.stateAlignment.align("right")}},justify:{iconClass:"ueditor-justify",isActive:function(t){var n=e(t.selection.getBlock());return n.length&&n[0].nodeType==3&&(n=n.parent()),n.length&&n.css("text-align")=="justify"},callback:function(e,t,r){n.stateAlignment.align("justify")}}}}}}},o.stateAlignmentCTA={beforeInit:function(){if(!this.$toolbar)return;var e=this;this.opts.stateButtons.stateAlignCTA={title:t.text_align,defaultState:"left",states:{left:{iconClass:"ueditor-left",isActive:function(t){return e.$element.length&&e.$element.css("text-align")=="left"},callback:function(t,n,r){e.$element.css("text-align","left")}},center:{iconClass:"ueditor-center",isActive:function(t){return e.$element.length&&e.$element.css("text-align")=="center"},callback:function(t,n,r){e.$element.css("text-align","center")}},right:{iconClass:"ueditor-right",isActive:function(t){return e.$element.length&&e.$element.css("text-align")=="right"},callback:function(t,n,r){e.$element.css("text-align","right")}},justify:{iconClass:"ueditor-justify",isActive:function(t){return e.$element.length&&e.$element.css("text-align")=="justify"},callback:function(t,n,r){e.$element.css("text-align","justify")}}}}}},o.stateLists=function(){return{init:function(){var n=this;this.opts.stateButtons.stateLists={title:t.list_style,defaultState:"none",states:{none:{iconClass:"ueditor-nolist",isActive:function(t){var n=e(t.selection.getParent());return n.length&&n.css("text-align")=="left"},callback:function(e,t,r){n.list.toggle("orderedlist")}},unordered:{iconClass:"ueditor-unorderedlist",isActive:function(t){var n=e(t.selection.getParent());if(n.length){var r=n.closest("ul");if(r.length)return r.closest(".ueditable").length}return!1},callback:function(e,t,r){n.list.toggle("unorderedlist")}},ordered:{iconClass:"ueditor-orderedlist",isActive:function(t){var n=e(t.selection.getParent());if(n.length){var r=n.closest("ol");if(r.length)return r.closest(".ueditable").length}return!1},callback:function(e,t,r){n.list.toggle("orderedlist")}}}}}}},o.upfrontImages={beforeInit:function(){if(!this.$toolbar)return;var t=this;t.events.on("ueditor:stop",function(){ImagesHelper.Image.unbind_events()}),t.events.on("ueditor:insert:media",function(){ImagesHelper.Gallery.to_html(t),ImagesHelper.Slider.to_html(t)}),ImagesHelper.Image.redactor=t,ImagesHelper.Image.create_dialog(),ImagesHelper.Image.bind_events(),Upfront.Media.Transformations.add(ImagesHelper.Image.cleanup),Upfront.Media.Transformations.add(ImagesHelper.Gallery.from_html),Upfront.Media.Transformations.add(ImagesHelper.Slider.from_html),Upfront.Events.on("upfront:editor:image_align",function(t,n){var r=!1;"left"===n?r="margin-right":"right"===n&&(r="margin-left");if(!r)return!1;e(t).css(r,"15px")})}},o.upfrontSink={beforeInit:function(){var e=this;Upfront.data.ueditor||(Upfront.data.ueditor={sink:!1}),this.opts.buttonsCustom.upfrontSink={title:t.more_tools}},init:function(){if(!this.$toolbar)return;var t=this,n=this.$toolbar.find(".redactor_btn_upfrontSink").parent().addClass("upfront-sink-button"),r=this.$toolbar.find(".upfront-sink-button ~ li"),i=e('<div class="ueditor-sink"></div>');n.on("click",function(){Upfront.data.ueditor.sink?t.closeSink():t.openSink()}),r.detach().appendTo(i),this.$toolbar.append(i),Upfront.data.ueditor.sink&&this.$toolbar.addClass("ueditor-sink-open"),r.each(function(){var n=e(this).find("a").attr("class").match(/redactor_btn_[^\s]*/g),r=!1,i=!1;n.length&&(r=n[0].replace("redactor_btn_","")),i=t.$toolbar.find(".redactor-dropdown-box-"+r),i.length&&i.css({"margin-top":"40px"})}),this.$air.on("show",function(){Upfront.data.ueditor.sink&&t.$air.css({top:t.$air.offset().top-40})})},openSink:function(){Upfront.data.ueditor.sink=!0,this.$toolbar.addClass("ueditor-sink-open"),this.$air.css({top:this.$air.offset().top-40})},closeSink:function(){Upfront.data.ueditor.sink=!1,this.$toolbar.removeClass("ueditor-sink-open"),this.$air.css({top:this.$air.offset().top+40})}},o.upfrontPlaceholder=function(){return{init:function(){var t=this,n=this.placeholderText;this.$element.attr("placeholder")&&(n=this.$element.attr("placeholder")),n===""&&(n=!1);if(n!==!1){this.$editor.find("span.redactor_placeholder").remove(),this.$editor.off("focus.redactor_placeholder"),this.$placeholder=this.$editor.clone(!1),this.$placeholder.attr("contenteditable",!1).removeClass("ueditable redactor_editor").addClass("ueditor-placeholder").html(n),this.$editor.after(this.$placeholder),this.$editor.css("position")=="static"&&this.$editor.css("position","relative"),this.$editor.css("z-index",1);var r=this.$editor.position();this.$placeholder.css({position:"absolute","z-index":"0",top:r.top,left:r.left,right:this.$box.outerWidth()-(r.left+this.$editor.outerWidth())}),this.opts.placeholder=n;function i(){t.code.sync();var e=t.$editor.text().trim();e==""||e=="&nbsp;"?t.$placeholder.show():t.$placeholder.hide()}}var s=e.proxy(i,this);this.$editor.on("keyup",s),this.events.on("cleanUpListeners",function(){t.$editor.off("keyup",s),t.events.off("cleanUpListeners")}),i()}}},o.panelButtons=function(){return{init:function(){if(!this.$toolbar)return;var t=this;e.each(this.opts.buttonsCustom,function(n,r){if(r.panel){var i=e('<div class="redactor-dropdown ueditor_panel redactor-dropdown-box-'+n+" redactor-dropdown-"+t.uuid+' " style="display: none;">'),s=t.button.get(n),o=_.isUndefined(r.first)?"add":"addFirst";r.panel=new r.panel({redactor:t,button:s,panel:i}),i.html(r.panel.$el),i.appendTo(t.$toolbar),r.dropdown=!0,s.on("click",function(){s.hasClass("dropact")?(t.selection.removeMarkers(),r.panel.trigger("open",t)):r.panel.trigger("closed",t)}),t.$editor.on("mouseup.redactor keyup.redactor",function(){s.hasClass("dropact")&&(t.dropdownHideAll(),r.panel.trigger("closed",t))}),i.on("click keydown keyup",function(e){e.stopPropagation()});if(e.inArray(n,t.opts.airButtons)===-1)return;var u=t.button[o](n,r.title);t.button.addCallback(u,function(){var s=t.button.get(n),o=s.position().left;e(".re-icon").removeClass("redactor_act dropact"),s.addClass("redactor_act dropact"),e(".redactor-dropdown").not(i).hide(),i.css("left",o+"px").toggle(),i.is(":visible")&&typeof r.panel.open=="function"?r.panel.open.apply(r.panel,[jQuery.Event("open"),t]):typeof r.panel.close=="function"&&r.panel.close.apply(jQuery.Event("close"),[e.Event,t]);var u=e(".redactor-dropdown.ueditor_panel").last(),a=o-u.innerWidth()+s.width();u.css("left",a+"px")})}})}}},o.upfrontIcons=function(){return{$sel:!1,init:function(){this.opts.buttonsCustom.upfrontIcons={title:t.icons,panel:this.upfrontIcons.panel},i.on("ueditor:key:down",function(t,n){if(e(t.selection.getParent()).hasClass("uf_font_icon")||e(t.selection.getCurrent()).hasClass("uf_font_icon"))n.keyCode<48||n.keyCode>90||n.preventDefault()})},panel:s.extend(_.extend({},Upfront.Views.Mixins.Upfront_Scroll_Mixin,{$sel:!1,tpl:_.template(e(n).find("#font-icons").html()),events:{"click .ueditor-font-icon":"insert_icon",open:"open",toolbarClosed:"close","change .upfront-font-icons-controlls input":"input_change"},render:function(e){this.$el.html(this.tpl({icons:Upfront.mainData.font_icons})),this.stop_scroll_propagation(this.$el)},open:function(e,t){this.redactor=t,this.redactor.selection.restore(),this.redactor.buffer.set(),this.redactor.selection.save(),this.set_current_icon(),this.$el.parent().css({left:193})},close:function(){this.redactor&&(this.$sel=!1)},insert_icon:function(t){var n=e(e(t.target).hasClass("ueditor-font-icon")?e(t.target).html():e(t.target).closest(".ueditor-font-icon").html()),r=this.$(".font-icons-size").val(),i=this.$(".font-icons-top").val();n.css({"font-size":r+"px",top:i+"px"});var s=n[0].outerHTML;this.redactor.insert.execHtml(s),this.redactor.code.sync(),this.redactor.selection.restore(),this.closeToolbar()},input_change:function(t){var n=this.$sel;t.stopPropagation(),t.preventDefault();var r=e(t.target),i=r.val()+"px";r.hasClass("font-icons-size")&&n.css("font-size",i),r.hasClass("font-icons-top")&&n.css("top",i),this.redactor.code.sync()},set_current_icon:function(){var t=e(this.redactor.selection.getCurrent()).last(),n=this;t.hasClass("uf_font_icon")||(t=e(this.redactor.selection.getInlines()).filter(".uf_font_icon").last()),t.hasClass("uf_font_icon")&&(this.$sel=t,this.$(".font-icons-size").val(parseFloat(t.css("font-size"))),this.$(".font-icons-top").val(parseFloat(t.css("top"))))}}))}},o.upfrontLink=function(){return{init:function(){this.opts.buttonsCustom.upfrontLink={title:t.link,panel:this.upfrontLink.panel}},openPanel:function(){var t=this.button.get("link").position().left;e(".redactor-dropdown-box-upfrontLink").css("left",t+"px").toggle()},panel:s.extend({tpl:_.template(e(n).find("#link-tpl").html()),events:{open:"open"},initialize:function(){s.prototype.initialize.apply(this,arguments)},open:function(t,n){this.redactor=n,n.selection.save();var i=this,s="",o="external",u="_self";this.selectedLink=n.utils.isCurrentOrParent("A"),this.selectedLink&&(s=e(this.selectedLink).attr("href"),u=e(this.selectedLink).attr("target"),_.isUndefined(e(this.selectedLink).attr("data-upfront-link-type"))?o=this.guessLinkType(s):o=e(this.selectedLink).attr("data-upfront-link-type")),this.linkModel=new r({type:o,url:s,target:u}),this.listenTo(this.linkModel,"change",function(e){i.redactor.buffer.set(),i.redactor.selection.save(),i.linkModel.get("type")==="unlink"?i.unlink():i.link(e)}),this.render()},render:function(){if(typeof this.linkModel=="undefined")return;var t={},n=this;this.redactor.$element.hasClass("mfp-title")&&(t={anchor:!1,lightbox:!1},e(document).off("focusin")),this.linkPanel=new Upfront.Views.Editor.LinkPanel({model:this.linkModel,linkTypes:t,button:!0}),this.listenTo(this.linkPanel,"linkpanel:close",function(){e("a.re-upfrontLink").click().removeClass("dropact redactor_act")}),this.linkPanel.render(),this.$el.html(this.linkPanel.el),this.linkPanel.delegateEvents()},close:function(e,t){t.selection.restore()},unlink:function(t){t&&t.preventDefault();var n=this.redactor.selection.getHtml();this.redactor.selection.restore(),n!==""&&e.parseHTML(n).length>1?this.redactor.insert.html(n,!0):this.redactor.link.unlink(),this.redactor.$element.focus(),this.updateMissingLightboxFlag()},link:function(t){var n;if(typeof this.linkModel.get("url")=="undefined")return;if(this.selectedLink)e(this.selectedLink).attr("href",this.linkModel.get("url")).attr("target",this.linkModel.get("target"));else{var r=/[-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,i="\\$&",s=((Upfront.Settings||{}).Editor||{}).OPEN_TAG_RPL_MARK||"{{UPFRONT_OPEN_TAG_MARK}}",o=((Upfront.Settings||{}).Editor||{}).CLOSE_TAG_RPL_MARK||"{{UPFRONT_CLOSE_TAG_MARK}}",u=new RegExp(s.replace(r,i),"g"),a=new RegExp(o.replace(r,i),"g");n=this.redactor.selection.getHtml(),n=n.replace(/</g,s).replace(/>/g,o),this.redactor.selection.replaceWithHtml(n),this.redactor.link.set(n,this.linkModel.get("url"),this.linkModel.get("target")),this.selectedLink=this.redactor.utils.isCurrentOrParent("A"),n=this.redactor.selection.getHtml(),n=n.replace(u,"<").replace(a,">"),this.redactor.selection.replaceWithHtml(n),this.redactor.selection.save()}e(this.selectedLink).attr("data-upfront-link-type",this.linkModel.get("type")),this.redactor.$element.focus(),typeof t=="undefined"&&this.updateMissingLightboxFlag(),this.redactor.code.sync()},bindEvents:function(){},guessLinkType:function(t){return!e.trim(t)||e.trim(t)=="#"?"unlink":t.length&&t[0]=="#"?t.indexOf("#ltb-")>-1?"lightbox":"anchor":t.substring(0,location.origin.length)==location.origin?"entry":t.match(/^mailto/)?"email":"external"},updateMissingLightboxFlag:function(){var t=this.redactor.utils.isCurrentOrParent("A");t&&e(t).attr("href").indexOf("#ltb-")>-1&&(Upfront.Util.checkLightbox(e(t).attr("href"))?e(t).removeClass("missing-lightbox-warning"):e(t).addClass("missing-lightbox-warning"))}})}},o.upfrontColor=function(){return{init:function(){this.opts.buttonsCustom.upfrontColor={title:t.color,panel:this.upfrontColor.panel}},panel:s.extend({current_color:!1,current_bg:!1,events:{open:"open"},init:function(){this.listenTo(i,"ueditor:air:show",this.on_air_show);var e=this;this.listenTo(i,"cleanUpListeners",function(){e.stopListening()})},on_air_show:function(e){this.redactor.selection.save(),this.updateIcon()},close:function(e,t){t.selection.restore()},setCurrentColors:function(){var t=this.redactor.selection.getCurrent();t=e(t).prop("tagName")?t:e(t).parent();if(t&&(["SPAN","DIV","INLINE"].indexOf(e(t).prop("tagName"))!==-1||e(t).hasClass(".upfront_theme_colors"))){var n=tinycolor(e(t).css("background-color"));this.current_color=e(t).css("color"),n.getAlpha()>0&&(this.current_bg=e(t).css("background-color"))}else this.current_color=this.current_bg=!1},open:function(t,n){this.updateIcon(),this.redactor.selection.save();var r=this,i=Upfront.Views.Theme_Colors.colors.pluck("color").length?Upfront.Views.Theme_Colors.colors.pluck("color"):[],s=new Upfront.Views.Editor.Field.Color({spectrum:{flat:!0,showAlpha:!0,appendTo:"parent",showPalette:!0,localStorageKey:"spectrum.recent_colors",palette:i,maxSelectionSize:10,preferredFormat:"hex",chooseText:Upfront.Settings.l10n.global.content.ok,showInput:!0,allowEmpty:!0,change:function(e){r.current_color=e},move:function(e){r.current_color=e}}}),o=new Upfront.Views.Editor.Field.Color({blank_alpha:0,spectrum:{flat:!0,showAlpha:!0,appendTo:"parent",showPalette:!0,palette:i,localStorageKey:"spectrum.recent_bgs",maxSelectionSize:10,preferredFormat:"hex",chooseText:Upfront.Settings.l10n.global.content.ok,showInput:!0,allowEmpty:!0,change:function(e){r.current_bg=e},move:function(e){r.current_bg=e}}});s.render(),this.$("#tabforeground-content").html(s.el),o.render(),this.$("#tabbackground-content").html(o.el);var u=this.$el.closest(".redactor-dropdown");u.removeClass("on-right-border"),e(window).width()<=this.$("#tabforeground-content").offset().left+this.$("#tabforeground-content").width()&&u.addClass("on-right-border");if(this.current_color){var a=tinycolor(r.current_color);s.$(".upfront-field-color").spectrum("option","color",r.current_color),s.$(".upfront-field-color").spectrum("set",a),s.$(".sp-input").css({"border-left-color":r.current_color}),s.render_sidebar_rgba(a.toRgb()),s.update_input_val(a.toHexString())}else{var a=tinycolor("#000000");s.$(".upfront-field-color").spectrum("option","color","#000000"),s.$(".upfront-field-color").spectrum("set",a),o.$(".sp-input").css({"border-left-color":"#000000"}),s.render_sidebar_rgba(a.toRgb()),s.update_input_val(a.toHexString())}if(this.current_bg){var a=tinycolor(r.current_bg);o.$(".upfront-field-color").spectrum("option","color",r.current_bg),o.$(".upfront-field-color").spectrum("set",a),o.$(".sp-input").css({"border-left-color":r.current_bg}),o.render_sidebar_rgba(a.toRgb()),o.update_input_val(a.toHexString())}else{var a=tinycolor("rgba(0, 0, 0, 0)");o.$(".upfront-field-color").spectrum("option","color","rgba(0, 0, 0, 0)"),o.$(".upfront-field-color").spectrum("set",a),o.$(".sp-input").css({"border-left-color":"rgba(0, 0, 0, 0)"}),o.render_sidebar_rgba(a.toRgb()),o.update_input_val(a.toHexString())}this.$(".sp-choose").on("click",function(e){e.preventDefault(),r.updateColors(),r.closePanel(),r.closeToolbar(),r.redactor.dropdown.hideAll()})},render:function(){var n=e('<li id="tabforeground" class="active">').html(t.text_color),r=e('<li id="tabbackground">').html(t.text_background),i=e('<ul class="tablist">').append(n).append(r),s=e('<ul class="tabs">').append(e('<li id="tabforeground-content" class="active">').html('<input class="foreground" type="text">')).append(e('<li id="tabbackground-content">').html('<input class="background" type="text">')),o=this.redactor,u=this;i.children("li").on("click",function(t){t.preventDefault(),t.stopPropagation(),i.children("li").removeClass("active"),e(this).addClass("active"),s.children("li").removeClass("active"),s.children("li#"+e(this).attr("id")+"-content").addClass("active"),u.$("input.foreground").spectrum("option","color",typeof u.current_color=="object"?u.current_color.toRgbString():u.current_color),u.$("input.background").spectrum("option","color",typeof u.current_bg=="object"?u.current_bg.toRgbString():u.current_bg)}),this.$el.html(i).append(s)},updateIcon:function(){var e=this;e.setCurrentColors();if(e.current_bg){var t=tinycolor(e.current_bg);t.getAlpha()===0?this.redactor.$toolbar.find(".re-icon.re-upfrontColor").addClass("transparent").css("border-color",""):this.redactor.$toolbar.find(".re-icon.re-upfrontColor").removeClass("transparent").css("border-color",t.toRgbString())}else this.redactor.$toolbar.find(".re-icon.re-upfrontColor").addClass("transparent").css("border-color","");e.current_color?this.redactor.$toolbar.find(".re-icon.re-upfrontColor").css("color",e.current_color):this.redactor.$toolbar.find(".re-icon.re-upfrontColor").css("color","")},updateColors:function(){this.redactor.buffer.set(),this.redactor.selection.save();var t=Upfront.Views.Theme_Colors.colors.is_theme_color(this.current_color);t!==!1?(this.current_color.is_theme_color=!0,this.current_color.theme_color="#ufc"+t,this.current_color.theme_color_code=Upfront.Util.colors.convert_string_ufc_to_color(this.current_color.theme_color)):this.current_color.is_theme_color=!1,t=Upfront.Views.Theme_Colors.colors.is_theme_color(this.current_bg),t!==!1?(this.current_bg.is_theme_color=!0,this.current_bg.theme_color="#ufc"+t,this.current_bg.theme_color_code=Upfront.Util.colors.convert_string_ufc_to_color(this.current_bg.theme_color)):this.current_bg.is_theme_color=!1;var n=this,r=n.redactor.selection.getText(),i="color",s="color",o=!1,u=!1,a=function(e){n.redactor.inline.format("div","class",e)},f=function(t,r){var i=!1,s=!1,o=!!t.match(/background/);r.is_theme_color?(s=Upfront.Views.Theme_Colors.colors.get_css_class(r,o),s||(i=r.theme_color)):i=r.toRgbString();var u=document.createElement("span"),a=n.redactor.range.extractContents(),f=n.redactor.range,l=f.commonAncestorContainer?e(f.commonAncestorContainer):!1,c=function(e){s?e.addClass(s):!i||e.attr("style",t+":"+i)};if(a.childNodes[0]&&n.redactor.utils.isBlock(a.childNodes[0])){while(n.redactor.selection.getParent())e(n.redactor.selection.getBlocks()).remove();var h=[];_.each(a.childNodes,function(e,t){var n=document.createElement("span"),r=e.childNodes[0];if(_.isUndefined(e))return;r&&r.tagName&&r.tagName.toLowerCase()==="span"&&(r.className.match(/upfront_theme_/)||r.style.cssText.match(/color/))?n.innerHTML=r.innerHTML:n.innerHTML=e.innerHTML,e.innerHTML="",e.appendChild(n),h.push({node:e,wrapper:n})}),_.each(h.reverse(),function(t,r){var i=t.node,s=t.wrapper;n.redactor.range.insertNode(i);var o=e(s);c(o)})}else u.appendChild(a),n.redactor.range.insertNode(u),c(e(u));n.redactor.selection.restore(),n.redactor.code.sync()},l=function(e){};if(n.current_bg&&typeof n.current_bg=="object"){u=!0;var c=Upfront.Views.Theme_Colors.colors.get_css_class(n.current_bg.toHexString(),!0);n.current_bg.reset===!0?n.reset_bg_color():f("background-color",n.current_bg)}if(n.current_color&&typeof n.current_color=="object"){o=!0;var h=Upfront.Views.Theme_Colors.colors.get_css_class(n.current_color.toHexString());l("color"),n.current_color.reset===!0?this.reset_color():f("color",n.current_color)}if(o&&!u){var p=[];e(this.redactor.selection.getCurrent()).parents("[data-redactor-style^='color']").each(function(){var t=e(this);t.text()===n.redactor.selection.getText()&&p.push(this)});var r=this.redactor.selection.getCurrent(),d=e(_.last(p)),v=d.children("[data-redactor-style^='background-color'], [ style^='background-color']");v=v.length===0&&d.is("[data-redactor-style^='background-color'], [ style^='background-color']")?d:v;if(v.length>0){var m=e(_.first(v)).css("background-color");r=e(r).css({backgroundColor:m})}e(d).replaceWith(r)}if(u&&!o){var p=[];e(this.redactor.selection.getCurrent()).parents("[data-redactor-style^='background-color']").each(function(){var t=e(this);t.text()===n.redactor.selection.getText()&&p.push(this)});var r=this.redactor.selection.getCurrent(),d=e(_.last(p)),g=d.children("[data-redactor-style^='color'], [ style^='color']");g=g.length===0&&d.is("[data-redactor-style^='color'], [ style^='color']")?d:g;if(g.length>0){var y=e(_.first(v)).css("color");r=e(r).css({color:y})}e(d).replaceWith(r)}if(u&&o){var p=[];e(this.redactor.selection.getCurrent()).parents("[data-redactor-style^='color'], [data-redactor-style^='background-color']").each(function(){var t=e(this);t.text()===n.redactor.selection.getText()&&p.push(this)}),e(_.last(p)).replaceWith(e(this.redactor.selection.getCurrent()).css({backgroundColor:n.current_bg.is_theme_color?n.current_bg.theme_color_code:n.current_bg.toHexString()}))}n.updateIcon()},reset_bg_color:function(){this.redactor.inline.removeFormat("backgroundColor");return},reset_color:function(){this.redactor.selection.removeMarkers();var t=this.redactor.selection.getCurrent(),n=e(t).html(),r=this.redactor.selection.getHtml();this.redactor.inline.removeFormat("color"),e(this.redactor.selection.getCurrent()).find("font").each(function(){var t=e(this),n=t.attr("color"),r=t.html(),i=document.createElement("span");i.style.color=n,i.innerHTML=r,t.replaceWith(i)});return}})}},o.upfrontFormatting=function(){return{init:function(){this.opts.buttonsCustom.upfrontFormatting={title:t.formatting.title,panel:this.upfrontFormatting.panel,first:!0}},panel:s.extend(_.extend({},Upfront.Views.Mixins.Upfront_Scroll_Mixin,{selected_class:"",tpl:_.template(e(n).find("#upfront-formatting").html()),className:"ufront-air-formatting",init:function(){this.custom_classes=["first-class","second-class","third-class"]},events:{"click li *":"select_tag","change .ufront-formatting-custom-class":"change_custom_class"},render:function(e){return this.$el.html(this.tpl(_.extend({},{custom_classes:this.custom_classes,selected_class:this.selected_class},t.formatting))),this},open:function(e,t){this.redactor=t,this.set_previously_selected_tag(),this.set_previously_selected_class()},close:function(){this.redactor&&(this.redactor.selection.restore(),this.$sel=!1)},set_previously_selected_tag:function(){var t=e(this.redactor.selection.getBlock()).length?e(this.redactor.selection.getBlock())[0].tagName:!1;t&&(t=t.toLowerCase(),this.$("[data-tag]").removeClass("dropact"),this.$("[data-tag='"+t+"']").addClass("dropact")),this.redactor.selection.save()},set_previously_selected_class:function(){var t=this,n=e(this.redactor.selection.getBlock()).length?e(this.redactor.selection.getBlock())[0].className:!1;n&&(this.selected_class=n.split(" ").filter(function(e){return t.custom_classes.indexOf(e)!==-1}),this.selected_class.length===1&&this.$("option").map(function(){var n=e(this);n.val()===t.selected_class[0]?n.attr("selected",!0):n.attr("selected",!1)}))},select_tag:function(t){t.preventDefault(),this.redactor.buffer.set(),this.redactor.$editor.focus();var n=e(t.target).data("tag");this.redactor.utils.browser("msie")||this.redactor.$editor.focus(),this.redactor.block.blocks=this.redactor.selection.getBlocks(),this.redactor.block.blocksSize=this.redactor.block.blocks.length,this.redactor.block.type="",this.redactor.block.value="",this.redactor.buffer.set(),this.redactor.selection.save();var r=this.redactor.block.blocks[0],i=this.redactor.utils.replaceToTag(r,n);(n=="p"||this.redactor.block.headTag)&&i.find("p").contents().unwrap(),this.redactor.code.sync(),this.close(),this.redactor.dropdown.hideAll()},change_custom_class:function(t){var n=this,r=e(t.target).val();this.redactor.buffer.set(),this.redactor.$editor.focus(),_(this.custom_classes).each(function(e){n.redactor.block.removeClass(e)}),this.redactor.block.setClass(r),this.redactor.dropdown.hideAll()}}))}},o.blockquote=function(){return{init:function(){var n=this;this.opts.stateButtons.blockquote={title:t.blockquote,defaultState:"noquote",states:{noquote:{iconClass:"ueditor-noquote",isActive:function(e){var t=e.blockquote.getQuote();return!t},callback:function(e,t,r){n.utils.isCurrentOrParent(["BLOCKQUOTE"])&&n.utils.replaceToTag(n.selection.getBlock(),"p")}},quote:{iconClass:"ueditor-quote",isActive:function(t){var n=t.blockquote.getQuote();return n&&!e(n).hasClass("upfront-quote-alternative")},callback:function(e,t,r){n.block.formatBlockquote("blockquote")}},alternative:{iconClass:"ueditor-quote-alternative",isActive:function(t){var n=t.blockquote.getQuote();return n&&e(n).hasClass("upfront-quote-alternative")},callback:function(e,t,r){n.blockquote.getQuote().addClass("upfront-quote-alternative")}}}}},getQuote:function(){var t=e(this.selection.getParent());return t.prop("tagName")=="BLOCKQUOTE"?t:(t=t.closest("blockquote"),t.closest(".redactor-box").length?t:!1)}}},window.RedactorPlugins=o,{UeditorEvents:i}})}(jQuery),function(e){define("ueditor",["text!scripts/redactor/ueditor-templates.html","scripts/redactor/ueditor-inserts","redactor_plugins"],function(t,n,r){var i=!1,s=r.UeditorEvents;e.fn.ueditor=function(t){var n=!1,r=this,s;return i||o(),typeof t=="string"&&(n=!0),this.each(function(){var r=e(this),i=r.data("ueditor");i?n?s=i.callMethod(t):e.error("Ueditor is already instantiated"):n?e.error("Can't call the ueditor method "+t+". Ueditor not initialized"):(r.data("ueditor",new u(r,t)),t.autostart&&r.data("ueditor").start(),u.prototype.redactorInitialized=!0)}),this.length==1&&typeof s!="undefined"?s:this};var o=function(){e.Redactor.prototype.airBindHide=function(){if(!this.opts.air||!this.$toolbar)return;var t=this,n=e.proxy(function(n){e(n).on("mouseup.redactor",e.proxy(function(r){if(e(r.target).closest(this.$toolbar).length===0&&e(r.target).parents("#upfront-popup.upfront-postselector-popup").length===0&&!t.selection.getText()){if(t.$element.closest("li").hasClass("menu-item")){var i=t.$element.closest("li.menu-item").data("backboneview");i.model["being-edited"]=!1}t.$air.fadeOut(100),e(".redactor-dropdown").hide(),t.$toolbar.find(".dropact").removeClass("dropact"),e(n).off(r)}},this)).on("keydown.redactor",e.proxy(function(r){if(r.keyCode===91&&r.metaKey)return;r.which===this.keyCode.ESC,t.$air.fadeOut(100),e(n).off(r)},this))},this);n(document),this.opts.iframe&&n(this.document)},e.Redactor.prototype.airShow=function(t,n){if(typeof t!="undefined"&&(e(t.target).parents().is(".uimage-control-panel")||e(t.target).is(".upfront-icon")||e(t.target).is(".upfront-icon-button")||!_.isUndefined(t.target.contentEditable)&&t.target.contentEditable==="false"||e(t.target).closest(".redactor-editor").attr("contentEditable")==="false"))return;if(!this.opts.air||!this.opts.buttons.length&&!this.opts.airButtons.length||!this.$toolbar)return;if(this.$element.closest("li").hasClass("menu-item")){var r=this.$element.closest("li.menu-item").data("backboneview");r.model["being-edited"]=!0}e(".redactor_air").hide(),this.selection.createMarkers();var i=this.$air.width(),o=this.$editor.find("span#selection-marker-1"),u=this.$editor.find("span#selection-marker-2"),a=o.offset(),f=u.offset();this.utils.browser("safari")&&(o.length!==0&&u.length!==0?this.caret.set(o,0,u,0):o.length!==0?this.caret.set(o,0,o,0):this.$editor.focus());if(!a||!f)return!1;var l=f.top<a.top?{top:f.top-55,left:f.left,right:a.left,i:2}:{top:a.top-55,left:a.left,right:f.left,i:1},c=!1,h=e(window),p=h.width()+h.scrollLeft(),d,v;a.top!=f.top&&l.left>l.right&&(l.right=l.left+50),this.airWidth||(this.airWidth=i,this.$air.width(i));if(l.right<l.left||l.right>p){var v=this.$editor.find("#selection-marker-"+l.i).parent();l.right=Math.min(p,v.offset().left+v.width())}d=Math.floor((l.right+l.left+1)/2),d+i/2>p?(this.$air.addClass("at-right"),d>p&&(d=p-5),l.left=d-i):(this.$air.removeClass("at-right"),l.left=d-Math.floor((i+1)/2)),this.$air.css({left:l.left+"px",top:l.top+"px"}).show();if(this.$air.offset().top<0){var m=t&&t.clientY?t.clientY:this.$box.height();this.$air.css({top:m+14+this.$box.position().top+"px"}),this.$air.addClass("under")}else this.$air.removeClass("under");this.airBindHide(),this.$air.trigger("show"),this.dropdown.hideAll(),s.trigger("ueditor:air:show",this),this.selection.removeMarkers()},i=!0;var t={selection:function(){return{getPrev:function(){return window.getSelection().anchorNode.previousSibling},getNext:function(){return window.getSelection().anchorNode.nextSibling},getBlocks:function(t){this.selection.get();if(this.range&&this.range.collapsed)return[this.selection.getBlock()];var n=[];return t=typeof t=="undefined"?this.selection.getNodes():t,e.each(t,e.proxy(function(e,t){this.utils.isBlock(t)&&n.push(t)},this)),n.length===0?[this.selection.getBlock()]:n},getNodes:function(){this.selection.get();var t=this.selection.getNodesMarker(1),n=this.selection.getNodesMarker(2);if(this.range.collapsed===!1){if(window.getSelection){var r=window.getSelection();if(r.rangeCount>0){var i=r.getRangeAt(0),s=i.startContainer,o=i.startOffset,u=i.cloneRange();u.collapse(!1),u.insertNode(n),u.setStart(s,o),u.collapse(!0),u.insertNode(t),i.setStartAfter(t),i.setEndBefore(n),r.removeAllRanges(),r.addRange(i)}}}else this.selection.setNodesMarker(this.range,t,!0),n=t;var a=[],f=0,l=this;this.$editor.find("*").each(function(){if(this==t){var r=e(this).parent();r.length!==0&&r[0].tagName!="BODY"&&l.utils.isRedactorParent(r[0])&&a.push(r[0]),a.push(this),f=1}else f>0&&(a.push(this),f+=1);if(this==n)return!1});var c=[],h=a.length;for(var p=0;p<h;p++)a[p].id!="nodes-marker-1"&&a[p].id!="nodes-marker-2"&&c.push(a[p]);return this.selection.removeNodesMarkers(),c},setNodesMarker:function(e,t,n){var e=e.cloneRange();try{e.collapse(n),e.insertNode(t)}catch(r){}},fromPoint:function(e,t){this.caret.setOffset(e,t)},selectElement:function(e){if(this.utils.browser("mozilla")){e=e[0]||e;var t=document.createRange();t.selectNodeContents(e)}else this.caret.set(e,0,e,1)},restore:function(){var e=this.$editor.find("span#selection-marker-1"),t=this.$editor.find("span#selection-marker-2");this.utils.browser("mozilla")&&this.$editor.focus(),e.length!==0&&t.length!==0?this.caret.set(e,0,t,0):e.length!==0?this.caret.set(e,0,e,0):this.$editor.focus(),this.selection.removeMarkers(),this.savedSel=!1},removeMarkers:function(){this.$editor.find("span.redactor-selection-marker").each(function(t,n){var r=e(n).text().replace(/\u200B/g,"");r===""?e(n).remove():e(n).replaceWith(function(){return e(this).contents()})})},replaceSelection:function(e){this.selection.get(),this.range.deleteContents();var t=document.createElement("div");t.innerHTML=e;var n=document.createDocumentFragment(),r;while(r=t.firstChild)n.appendChild(r);this.range.insertNode(n)},replaceWithHtml:function(e){e=this.selection.getMarkerAsHtml(1)+e+this.selection.getMarkerAsHtml(2),this.selection.get(),window.getSelection&&window.getSelection().getRangeAt?this.selection.replaceSelection(e):document.selection&&document.selection.createRange&&this.range.pasteHTML(e),this.selection.restore(),this.code.sync()}}},utils:{isEndOfElement:function(t){if(typeof t=="undefined"){var t=this.$element;if(!t)return!1}var n=this.caret.getOffsetOfElement(t),r=e.trim(e(t).text()).replace(/\n\r\n/g,"");return n==r.length?!0:!1}},inline:{format:function(t,n,r){var i=["b","bold","i","italic","underline","strikethrough","deleted","superscript","subscript"],s=["strong","strong","em","em","u","del","del","sup","sub"];for(var o=0;o<i.length;o++)t==i[o]&&(t=s[o]);this.inline.type=n||!1,this.inline.value=r||!1,this.buffer.set(),this.utils.browser("msie")||this.$editor.focus(),this.selection.get(),this.range.collapsed?this.inline.formatCollapsed(t):this.inline.formatMultiple(t),t&&-1!==_.indexOf(["em","italic"],t.toLowerCase())&&this.selection.selectElement(e(this.selection.getInlines()).find("em")),t&&-1!==_.indexOf(["strong","bold"],t.toLowerCase())&&this.selection.selectElement(e(this.selection.getInlines()).find("strong"))}},keydown:{replaceDivToBreakLine:function(){var t=this.selection.getBlock();if(!(t||{}).innerHTML)return!1;var n=t.innerHTML.replace(/<br\s?\/?>/gi,"");if((t.tagName==="DIV"||t.tagName==="P")&&n===""&&!e(t).hasClass("redactor-editor")){var r=document.createElement("br");return e(t).replaceWith(r),this.caret.setBefore(r),this.code.sync(),!1}}},clean:{savePreFormatting:function(e){return e}}};e.Redactor.prototype.events=s,e.Redactor.prototype.shortcutsLoadFormat=function(e,t){Upfront.Util.log("Block styles keyboard shortcuts have been disabled")},e.Redactor.prototype.placeholderStart=function(e){console.log("do nothing")},e.Redactor.prototype.button=function(){return{build:function(t,n){var r=e('<a href="#" class="re-icon re-'+t+'" rel="'+t+'" title="'+n.title+'" />').attr("tabindex","-1");(n.func||n.command||n.dropdown)&&r.on("touchstart click",e.proxy(function(e){if(r.hasClass("redactor-button-disabled"))return!1;var i="func",s=n.func;n.command?(i="command",s=n.command):n.dropdown&&(i="dropdown",s=!1),this.button.onClick(e,t,i,s)},this));if(n.dropdown){var i=e('<div class="redactor-dropdown redactor-dropdown-box-'+t+'" style="display: none;">');r.data("dropdown",i),this.dropdown.build(t,i,n.dropdown)}return r},onClick:function(t,n,r,i){this.button.caretOffset=this.caret.getOffset(),t.preventDefault(),this.utils.browser("msie")&&(t.returnValue=!1);if(r=="command")this.inline.format(i);else if(r=="dropdown")this.dropdown.show(t,n);else{var s;e.isFunction(i)?(i.call(this,n),this.observe.buttons(t,n)):i.search(/\./)!="-1"?(s=i.split("."),typeof this[s[0]]!="undefined"&&(this[s[0]][s[1]](n),this.observe.buttons(t,n))):(this[i](n),this.observe.buttons(t,n))}},get:function(e){return this.$toolbar.find("a.re-"+e)},setActive:function(e){this.button.get(e).addClass("redactor-act")},setInactive:function(e){this.button.get(e).removeClass("redactor-act")},setInactiveAll:function(e){typeof e=="undefined"?this.$toolbar.find("a.re-icon").removeClass("redactor-act"):this.$toolbar.find("a.re-icon").not(".re-"+e).removeClass("redactor-act")},setActiveInVisual:function(){this.$toolbar.find("a.re-icon").not("a.re-html").removeClass("redactor-button-disabled")},setInactiveInCode:function(){this.$toolbar.find("a.re-icon").not("a.re-html").addClass("redactor-button-disabled")},changeIcon:function(e,t){this.button.get(e).addClass("re-"+t)},removeIcon:function(e,t){this.button.get(e).removeClass("re-"+t)},setAwesome:function(e,t){var n=this.button.get(e);n.removeClass("redactor-btn-image").addClass("fa-redactor-btn"),n.html('<i class="fa '+t+'"></i>')},addCallback:function(t,n){var r=n=="dropdown"?"dropdown":"func",i=t.attr("rel");t.on("touchstart click",e.proxy(function(e){if(t.hasClass("redactor-button-disabled"))return!1;this.button.onClick(e,i,r,n)},this))},addDropdown:function(t,n){var r=t.attr("rel");this.button.addCallback(t,"dropdown");var i=e('<div class="redactor-dropdown redactor-dropdown-box-'+r+'" style="display: none;">');return t.data("dropdown",i),n&&this.dropdown.build(r,i,n),i},add:function(t,n){if(!this.opts.toolbar)return;var r=this.button.build(t,{title:n});return r.addClass("redactor-btn-image"),this.$toolbar.append(e("<li>").append(r)),r},addFirst:function(t,n){if(!this.opts.toolbar)return;var r=this.button.build(t,{title:n});return this.$toolbar.prepend(e("<li>").append(r)),r},addAfter:function(t,n,r){if(!this.opts.toolbar)return;var i=this.button.build(n,{title:r}),s=this.button.get(t);return s.size()!==0?s.parent().after(e("<li>").append(i)):this.$toolbar.append(e("<li>").append(i)),i},addBefore:function(t,n,r){if(!this.opts.toolbar)return;var i=this.button.build(n,{title:r}),s=this.button.get(t);return s.size()!==0?s.parent().before(e("<li>").append(i)):this.$toolbar.append(e("<li>").append(i)),i},remove:function(e){this.button.get(e).remove()}}},e.Redactor.prototype.bindModuleMethods=function(e){if(typeof this[e]=="undefined")return;this[e]=this[e]();var n=this.getModuleMethods(this[e]),r=n.length;for(var i=0;i<r;i++){var s=this[e][n[i]];t[e]&&t[e][n[i]]&&(s=t[e][n[i]]),this[e][n[i]]=s.bind(this)}};var n=Upfront.Settings&&Upfront.Settings.l10n?Upfront.Settings.l10n.global.ueditor:Upfront.mainData.l10n.global.ueditor;e.Redactor.opts.langs.upfront=e.extend({},e.Redactor.opts.langs.en,{bold:n.bold,italic:n.italic})},u=function(t,n){this.active=!1;var r=this.pluginList(n),i=this,o=Upfront.Util.get_unique_id("redactor");this.$el=t,this.$air=e("<div class='redactor_air upfront-ui'></div>").attr("id",o).hide(),e("body").append(this.$air),_.isEmpty(n.airButtons)||(n.buttons=n.airButtons),this.options=e.extend({autostart:!0,autoexit:!1,stateButtons:{},toolbarExternal:"#"+o,air:!0,linebreaks:!0,disableLineBreak:!1,focus:!0,cleanup:!1,plugins:r,airButtons:["upfrontFormatting","bold","italic","blockquote","upfrontLink","stateLists","stateAlign","upfrontColor","upfrontIcons"],buttons:["upfrontFormatting","bold","italic","blockquote","upfrontLink","stateLists","stateAlign","upfrontColor","upfrontIcons"],buttonsCustom:{},activeButtonsAdd:{},observeLinks:!1,observeImages:!1,formattingTags:["h1","h2","h3","h4","p","pre"],inserts:["image","embed"],linkTooltip:!1,cleanOnPaste:!0,replaceDivs:!1,pastePlainText:!1,imageEditable:!1,replaceDivs:!1,removeEmpty:!1,imageResizable:!1,lang:"upfront",direction:Upfront.Util.isRTL()?"rtl":"ltr"},n),this.options.dropdownShowCallback=function(){s.trigger("ueditor:dropdownShow",this)},this.options.dropdownHideCallback=function(){s.trigger("ueditor:dropdownHide",this)},this.options.initCallback=function(){s.trigger("ueditor:init",this)},this.options.changeCallback=function(e){s.trigger("ueditor:change",this,e)},this.options.focusCallback=function(){s.trigger("ueditor:focus",this)},this.options.blurCallback=function(){s.trigger("ueditor:blur",this)},this.options.keyupCallback=function(e){s.trigger("ueditor:key:up",this)},this.options.keydownCallback=function(e){s.trigger("ueditor:key:down",this,e)},this.options.textareaKeydownCallback=function(){s.trigger("ueditor:key:down:textarea",this)},this.options.syncBeforeCallback=function(e){return s.trigger("ueditor:sync:before",this,e),e},this.options.syncCallback=function(e){s.trigger("ueditor:sync:after",this,e),t.trigger("syncAfter",e)},this.options.autosaveCallback=function(){s.trigger("ueditor:autosave",this)},this.options.execCommandCallback=function(e,t){s.trigger("ueditor:exec:"+e,this,t)},this.options.destroyCallback=function(){s.trigger("ueditor:destroy",this)},this.options.clickCallback=function(e){s.trigger("ueditor:click",this,e)},this.id="ueditor"+Math.random()*1e4,this.options.autostart?this.options.startoninit&&this.start():(this.bindStartEvents(),this.startPlaceholder()),this.options.pasteCallback=function(e){return e=e.replace(/<div>/g,"<p>").replace(/<\/div>/g,"</p>"),e=e.replace(/<p><br><\/p>/g,"<br>"),e=e.replace(/<p ([^>]*)><br><\/p>/g,"<br>"),e=e.replace(/<\/p><p>/g,"<br>"),e=e.replace(/<\/p><p ([^>]*)>/g,"<br>"),e=e.replace(/<\/p><br><p>/g,"</p><p>"),e=e.replace(/<\/p><br><p ([^>]*)>/g,"</p><p $1>"),e=e.replace(/<\/p>([<br>])*<p>/g,"</p><p></p><p>"),e=e.replace(/<\/p>([<br>])*<p ([^>]*)>/g,"</p><p></p><p $1>"),typeof i.font_icon!="undefined"&&i.font_icon!==!1?i.font_icon:e},this.options.enterCallback=function(t){if(this.keydown.block.tagName==="LI"){var n=this.selection.getCurrent(),r=e(n).closest("li"),i=r.parent("ul,ol"),o=i.parent("li").parent("ul,ol"),u="<li>&#x200b;</li>";if(r.length!==0&&o.length!==0&&this.utils.isEmpty(r.html())&&i.next().length===0){var a=e(u);return o.append(a),this.caret.setStart(a),r.remove(),!1}if(r.length!==0&&this.utils.isEmpty(r.html())&&i.next().length===0){var a=e(this.opts.emptyHtml);return i.after(a),this.caret.setStart(a),r.remove(),!1}s.trigger("ueditor:enter",this,t)}else s.trigger("ueditor:enter",this,t)}};s.on("ueditor:key:up",function(e){_.isEmpty(e.selection.getText())||e.airShow()}),u.prototype={disableStop:!1,mouseupListener:!1,start:function(){var t=this;this.stopPlaceholder(),this.hideLinkFlags(),this.$el.addClass("ueditable").removeClass("ueditable-inactive").attr("title","").redactor(this.options),this.$el.trigger("start",this),this.redactor=this.$el.data("redactor"),this.redactor.$air=this.$air,this.redactor.ueditor=this,this.preventDraggable(),s.trigger("ueditor:start",this.redactor),Upfront.data.Ueditor||(Upfront.data.Ueditor={instances:{}}),Upfront.data.Ueditor.instances[this.id]=this,this.mouseupListener=e.proxy(this.listenForMouseUp,this),this.$el.on("mousedown",this.mouseupListener),this.$el.on("keydown",function(n){t.cmdKeyA=!1,t.cmdKey=!1,_.delay(function(){n.keyCode===8&&(t.redactor.clean.clearUnverified(),t.redactor.$editor.find("span").not('[data-verified="redactor"]').removeAttr("style"))},2),setTimeout(function(){n.keyCode===65&&n.metaKey&&(t.cmdKeyA=!0),n.keyCode===91&&n.metaKey&&(t.cmdKey=!0),n.keyCode===67&&n.metaKey&&t.onCopy(n)}),32===n.keyCode&&t.expand_known_text_patterns();if(n.keyCode!=37&&n.keyCode!=39&&t.redactor){var r=e(t.redactor.selection.getCurrent());r.hasClass("uf_font_icon")?t.redactor.caret.setAfter(r):r.parent().hasClass("uf_font_icon")&&t.redactor.caret.setAfter(r.parent())}}),this.$el.on("keyup",function(e){(t.redactor&&t.redactor.selection.getText()&&[37,38,39,40].indexOf(e.keyCode)!==-1||e.keyCode===65&&e.ctrlKey||t.cmdKeyA)&&t.redactor.airShow(e)}),this.options.inserts&&this.insertsSetUp(),(!this.options.autostart||this.options.autoexit)&&this.listenToOuterClick(),e(document).on("keyup",e.proxy(this.stopOnEscape,this)),this.active=!0,this.$el.on("keyup",function(n){13===n.keyCode&&!n.shiftKey&&(t||{}).redactor&&!t.redactor.keydown.pre&&!t.redactor.$air.is(":visible")&&(t.redactor.utils.removeEmpty(),e(t.redactor.selection.getCurrent()).append("&#x200b;"))})},stopOnEscape:function(t){t.keyCode===27&&(!e(".upfront-content-marker-contents").length||!e(".upfront-content-marker-contents").data("ueditor"))&&this.stop()},expand_known_text_patterns:function(t){var n=this.redactor,r={"##":{tag:"h2"},"###":{tag:"h3"},"####":{tag:"h4"},"#####":{tag:"h5"},"######":{tag:"h6"},">":{tag:"blockquote"},"-":{tag:"ul",nest:"li"},"*":{tag:"ul",nest:"li"},"1.":{tag:"ol",nest:"li"},"1)":{tag:"ol",nest:"li"}};if(!n)return;n.selection.get();var i=n.selection.getBlock(),s,o,u;if(!i)return;s=n.caret.getOffsetOfElement(i);if(!s)return;o=e(i).clone(),u=o.text().substr(0,s);if(!u)return;e.each(r,function(t,r){if(t!==u)return!0;var s=e(i),o=new RegExp("^"+t.replace(/([.*+?^=!:${}()|\[\]\/\\])/g,"\\$1")+" ?"),a=s.html().replace(o,"");if(s.is("li,ul,ol,pre"))return!1;if("nest"in r&&r.nest)s.html("<"+r.tag+"><"+r.nest+">"+a+"</"+r.nest+"></"+r.tag+">");else{var f=document.createElement(r.tag);f.innerHTML=a,s.replaceWith(f)}return n.caret.setEnd("nest"in r&&r.nest?s.find(r.nest).last().get():f),n.code.sync(),_.delay(function(){e(n.selection.getBlock()).html(a)},3),!1})},stop:function(){this.redactor&&(s.trigger("ueditor:stop",this.redactor),this.$el.trigger("stop"),this.restoreDraggable(),this.redactor.$toolbar&&this.redactor.core.destroy(),this.$air.remove(),this.$el.removeClass("ueditable"),this.redactor=!1),"undefined"!=typeof Upfront.data.Ueditor&&delete Upfront.data.Ueditor.instances[this.id],this.startPlaceholder(),e("html").off("mousedown",this.stopOnOutsideClick),e(document).off("keyup",this.stopOnEscape),this.active=!1},bindStartEvents:function(){var t=this;t.$el.addClass("ueditable-inactive").attr("title","Double click to edit the text").addClass("uf-click-to-edit-text").one("dblclick",function(e){e.preventDefault(),e.stopPropagation(),t.redactor||t.start(e)}),t.$el.prop("tagName")=="DIV"&&(t.$el.on("click","i.visit_link",function(){t.visitLink(e(this).attr("data-href"))}),t.$el.on("mouseover",function(){t.$el.hasClass("ueditable-inactive")&&t.displayLinkFlags()}),t.$el.on("mouseout",function(n){if(e(n.relatedTarget).hasClass("visit_link"))return;t.hideLinkFlags()})),this.$el.find("a").each(function(){var t=e(this).attr("href");t&&t.indexOf("#ltb-")>-1&&!Upfront.Util.checkLightbox(t)&&e(this).addClass("missing-lightbox-warning")})},displayLinkFlags:function(){var t=this;this.$el.find("a").each(function(){if(e(this).find("i.visit_link").length>0||!e(this).attr("href")||e(this).text().trim()=="")return;e(this).css("position","relative"),e(this).append('<i class="visit_link visit_link_'+t.guessLinkTypeTag(e(this))+'" data-href="'+e(this).attr("href")+'"></i>'),e(this).removeAttr("href")})},hideLinkFlags:function(t){this.$el.find("a").each(function(){e(this).css("position",""),e(this).attr("href",e(this).children("i.visit_link").attr("data-href")),e(this).children("i.visit_link").remove()})},visitLink:function(t){var n=this,r=n.guessLinkType(t);if(r=="lightbox"){var i=Upfront.Application.layout.get("regions");region=i?i.get_by_name(n.getUrlanchor(t)):!1;if(region){_.each(i.models,function(e){e.attributes.sub=="lightbox"&&Upfront.data.region_views[e.cid].hide()});var s=Upfront.data.region_views[region.cid];s.show()}}else if(r=="anchor"){var o=n.get_anchors();e("html,body").animate({scrollTop:e("#"+n.getUrlanchor(t)).offset().top},"slow")}else r=="entry"?window.location.href=t.replace("&editmode=true","").replace("editmode=true","")+(t.indexOf("?")>0?"&editmode=true":"?editmode=true"):window.open(t)},guessLinkTypeTag:function(e){return e.data("upfront-link-type")},guessLinkType:function(t){var n=!1;return!e.trim(t)||e.trim(t)=="#"?"unlink":(t.indexOf("#")>-1&&(n=this.getUrlanchor(t)),n?t.indexOf("ltb-")>-1?"lightbox":"anchor":t.indexOf("mailto:")===0?"email":t.substring(0,location.origin.length)==location.origin?"entry":"external")},get_anchors:function(){var e=Upfront.Application.layout.get("regions"),t=[];return e.each(function(e){e.get("modules").each(function(e){e.get("objects")&&e.get("objects").each(function(e){var n=e.get_property_value_by_name("anchor");n&&n.length&&(t[n]=e)})})}),t},getUrlanchor:function(t){if(typeof t=="undefined")var t=e(location).attr("href");if(t.indexOf("#")>=0){var n=t.split("#");return n[1]}return!1},insertsSetUp:function(){var t=this,n=new f({el:this.$el,insertsData:this.options.insertsData,inserts:this.options.inserts,ueditor:this}),r=this.redactor.events;this.insertManager=n;var i=e.proxy(n.bindTriggerEvents,n);r.on("ueditor:init",i),r.on("ueditor:enter",i),r.on("ueditor:insert:media",i),r.on("ueditor:sync:after",function(){t.insertManager.parseMarkup()}),n.on("insert:prechange",function(){var e=t.redactor.selection.get();t.redactor.buffer.set()}),this.manager=n,this.redactorEvents=r,n.on("insert:added insert:removed",function(){t.redactor.events.trigger("ueditor:insert:media"),t.redactor.code&&t.redactor.code.sync&&t.redactor.code.sync()}),s.on("cleanUpListeners",e.proxy(this.cleanUpListeners,this))},cleanUpListeners:function(){this.redactorEvents.off("ueditor:init"),this.redactorEvents.off("ueditor:enter"),this.redactorEvents.off("ueditor:insert:media"),this.redactorEvents.off("ueditor:sync:after"),this.manager.off("insert:prechange"),this.manager.off("insert:added insert:removed"),e("html").off("mousedown",this.stopOnOutsideClick),this.redactorEvents.off("cleanUpListeners"),e(document).off("click.redactor-image-delete")},listenToOuterClick:function(){var t=this;this.checkInnerClick||(this.checkInnerClick=function(e){!t.options.autostart&&t.redactor&&t.stop()}),e("html").on("mousedown",{ueditor:t},this.stopOnOutsideClick)},stopOnOutsideClick:function(t){!(e(t.target).hasClass("redactor_box")||e(t.target).parents().hasClass("redactor-box")||e(t.target).parents().hasClass("redactor_air")||e(t.target).parents().hasClass("redactor-toolbar")||e(t.target).parents().hasClass("use_selection_container")||e(t.target).parents().is("#upfront-popup")||e(t.target).parents().hasClass("upfront-inserts-markup-editor")||e(t.target).parents().hasClass("redactor-dropdown"))&&e(t.target).parents("#upfront-popup.upfront-postselector-popup").length===0&&(t.data.ueditor.$el.closest("a.menu_item").length>0?t.data.ueditor.$el.trigger("blur"):t.data.ueditor.stop())},callMethod:function(e){var t=this.$el.redactor(e);return s.trigger("ueditor:method:"+e,this.$el.redactor),t},startPlaceholder:function(){var t=this.options.placeholder;this.$el.attr("placeholder")&&(t=this.$el.attr("placeholder")),t===""&&(t=!1);if(t!==!1&&e.trim(this.$el.text()).length===0){this.$el.parent().children(".ueditor-placeholder").remove(),this.$placeholder=this.$el.clone(!1),this.$placeholder.attr("contenteditable",!1).removeClass("ueditable redactor_editor").addClass("ueditor-placeholder").html(t),this.$el.after(this.$placeholder);var n=this.$el.parent();n.css("position")=="static"&&n.css("position","relative"),this.$el.css("position")=="static"&&this.$el.css("position","relative"),this.$el.css("z-index",1);var r=this.$el.position();this.$placeholder.css({position:"absolute","z-index":"0",top:r.top,left:r.left,right:n.outerWidth()-(r.left+this.$el.outerWidth())}),this.$el.html("&nbsp;"),this.options.placeholder=t;var i=this}},stopPlaceholder:function(){this.$placeholder&&this.$placeholder.remove(),this.$el.html()=="&nbsp;"&&this.$el.html("")},preventDraggable:function(){var e=this.$el.closest(".ui-draggable"),t=e.draggable("option","cancel");_.isString(t)&&t.indexOf(".ueditable")==-1&&e.draggable("option","cancel",t+",.ueditable")},restoreDraggable:function(){var e=this.$el.closest(".ui-draggable"),t=e.draggable("option","cancel");_.isString(t)&&t.indexOf(".ueditable")!=-1&&e.draggable("option","cancel",t.replace(/,\.ueditable/g,""))},pluginList:function(t){var n=["stateAlignmentCTA","stateAlignment","stateLists","blockquote","stateButtons","upfrontLink","upfrontColor","upfrontFormatting","upfrontIcons","upfrontSink","upfrontPlaceholder","panelButtons"],r=[];return e.each(n,function(e,n){(typeof t[n]=="undefined"||t[n])&&r.push(n)}),r},listenForMouseUp:function(){var t=this;t.redactor||(t.redactor=t.$el.data("redactor")),t.redactor&&(t.redactor.waitForMouseUp=!0),e(document).one("mousedown",function(e){t.clickcount||(t.clickcount=0),t.clickcount=t.clickcount+1,t.lastmousedown={x:e.pageX,y:e.pageY},t.clickcount>0&&setTimeout(function(){t.clickcount=0},400)}),e(document).one("mouseup",function(n){if(!t.redactor)return;var r=!!t.redactor.selection.getText();(r||t.clickcount>1)&&t.redactor&&t.redactor.waitForMouseUp&&t.redactor.selection.getText()?(t.redactor.airShow(n),t.redactor.$element.trigger("mouseup.redactor")):e(".redactor_air").hide(),e(n.target).hasClass("uf_font_icon")})},getValue:function(t){var n=this.redactor.$element.html();return this.insertManager&&(n=this.insertManager.insertExport(n,t),$html=e("<div>").html(n)),$html.find(".redactor-selection-marker").remove(),e.trim($html.find(".plain-text-container").length?$html.find(".plain-text-container").last().html():$html.html())},getInsertsData:function(){var e={};return this.insertManager?(_.each(this.insertManager._inserts,function(t){e[t.data.id]=t.data.toJSON()}),e):{}},onCopy:function(t){var n=window.getSelection(),r=this;r.font_icon=!1;if(!_.isUndefined(n.anchorNode)&&n.anchorNode.className==="uf_font_icon"){var i=document.createElement("span");i.className="uf_font_icon",i.style.cssText=n.anchorNode.style.cssText;var s=e.trim(n.toString());s=s.replace(/\$/g,"&#36;"),s=s.replace(/”/g,'"'),s=s.replace(/“/g,'"'),s=s.replace(/‘/g,"'"),s=s.replace(/’/g,"'"),i.innerHTML=s,setTimeout(function(){r.redactor.$pasteBox===!1&&r.redactor.paste.createPasteBox(),r.redactor.$pasteBox.html(i),r.font_icon=i.outerHTML},1)}}};var a=Backbone.View.extend({tpl:_.template(e(t).find("#insert-manager-tooltip-tpl").html()),className:"ueditor-post-insert-manager",$block:!1,initialize:function(e){this.insertsData=e.insertsData||{},this.inserts=e.inserts||{},this.redactor=e.redactor,this.onRemoveInsert=e.onRemoveInsert,this.listenTo(s,"ueditor:insert:relocate",this.insert_relocate);var t=this;this.listenTo(s,"cleanUpListeners",function(){t.stopListening()})},events:{"click .uinsert-selector-option":"on_insert_click","click .upfront-post-media-trigger":"toggle_inserts"},render:function(){this.$el.html(this.tpl({inserts:_.pick(n.inserts,this.inserts),names:n.NAMES}))},insert_relocate:function(e){this.$block=e},toggle_inserts:function(e){e.preventDefault(),e.stopPropagation(),this.$el.find(".uinsert-selector").toggle()},on_insert_click:function(t){t.preventDefault(),t.stopPropagation();var r=e(t.target).data("insert"),i=new n.inserts[r],s=this;this.__insert=i,i.start(this.$el,this.redactor.$editor).done(function(t,n){if(_.isArray(t))var r=t[0],i=t[0],o=n;else var r=t,i=n,o=o||s.__insert;s.inserts[o.cid]=o,s.is_last_p()?s.$block.before(o.$el):(s.redactor.$element.find(s.$block).length<1&&s.redactor.$element.append(s.$block),s.$block.replaceWith(o.$el)),s.$block.prev("br").remove(),s.insertsData[o.data.id]=o.data.toJSON(),s.listenTo(o.data,"change add remove update",function(){s.insertsData[o.data.id]=o.data.toJSON()}),setTimeout(function(){e(".uinsert-selector").hide(),e(".ueditor-post-insert-manager").hide()},100),s.redactor.code.sync(),s.listenTo(o,"remove",s.onRemoveInsert)})},is_last_p:function(){var e=this.redactor.$element.find("p");return _.indexOf(e,this.$block[0])===e.length-1}}),f=Backbone.View.extend({tpl:_.template(e(t).find("#insert-manager-tpl").html()),initialize:function(e){this.inserts=e.inserts||{},this._inserts={},this.ueditor=e.ueditor,this.onRemoveInsert=_.bind(this.removeInsert,this),this.insertsData=e.insertsData||{},this.deletedInserts={},this.$el.children().addClass("nosortable"),this.insertLookUp(),this.bindTriggerEvents(),this.refreshTimeout=!1,this.sortableInserts(),this.render_tooltips(),e.ueditor.options.inserts&&(this.listenTo(s,"ueditor:click",this.position_tooltips),this.listenTo(s,"ueditor:key:up",this.position_tooltips));var t=this;this.listenTo(s,"cleanUpListeners",function(){t.stopListening()})},render_tooltips:function(){if(!this.ueditor.options.inserts||this.ueditor.options.inserts.length===0)return;var e=this,t=new a({insertsData:this.insertsData,inserts:this.inserts,redactor:this.ueditor.redactor,onRemoveInsert:this.onRemoveInsert});t.render(),this.ueditor.$el.after(t.$el),this.$tooltips=t.$el},position_tooltips:function(t){if(!this.$tooltips)return;var n=e(t.selection.getCurrent());if(this.show_tooltip_in_this_location(t)){if(typeof n[0]=="undefined"||!_.isElement(n[0]))return;var r=_.extend(n.position(),{marginLeft:_.isArray(n)&&_.isElement(n[0])?n.css("padding-left"):0});this.$tooltips.css(r),this.$tooltips.show(),s.trigger("ueditor:insert:relocate",n)}else this.$tooltips.hide()},bindTriggerEvents:function(t){var n=this,r=this.$el.parent(),i=this.$el.offset(),s=e.proxy(this.updateMediaTriggerPosition,this),o=function(t){if(e(t.target).parent()[0]!=n.$el[0]||!n.currentBlock)return;this.ticking||(Upfront.Util.requestAnimationFrame(s),ticking=!0);var r=n.currentBlock.height(),i=t.offsetY/r;n.triggerPosition=r>60?i:Math.round(i)},u=function(t){if(e(t.target).parent()[0]!=n.$el[0])return;n.currentBlock=e(t.currentTarget)},a=function(t){if(e(t.target).parent()[0]!=n.$el[0]||!n.currentBlock)return;n.lastBlock=n.currentBlock,n.currentBlock[0]==t.currentTarget&&(n.currentBlock=!1,n.mediaTrigger.removeClass("upfront-post-media-trigger-visible"))},f=function(){n.$el.on("mousemove","p,div:not(.ueditor-insert),ul,ol",o).on("mouseenter","p,div:not(.ueditor-insert),ul,ol",u).on("mouseleave","p,div:not(.ueditor-insert),ul,ol",a)},l=this.$el.data("ueditor");this.ticking=!1,this.leftMarker=e('<span style="float:left">')},updateMediaTriggerPosition:function(){var e,t=this.leftMarker;this.currentBlock&&(this.triggerPosition>.7?(this.currentBlock.append(t),e=t.offset().left-this.currentBlock.offset().left,t.detach(),this.mediaTrigger.addClass("upfront-post-media-trigger-visible upfront-post-media-trigger").data("insert","after").css({top:this.currentBlock.position().top+this.currentBlock.height(),"margin-left":e+"px"})):this.triggerPosition<.3?(this.currentBlock.prepend(t),e=t.offset().left-this.currentBlock.offset().left,t.detach(),this.mediaTrigger.addClass("upfront-post-media-trigger-visible upfront-post-media-trigger").data("insert","before").css({top:this.currentBlock.position().top,display:"block","margin-left":e+"px"})):this.mediaTrigger.removeClass("upfront-post-media-trigger-visible"))},insertLookUp:function(){var e=this,t=_.extend({},e.insertsData,e.deletedInserts);_.each(_.pick(n.inserts,this.inserts),function(n){_.extend(e._inserts,n.prototype.importInserts(e.$el,t,e.inserts))}),_.each(e._inserts,function(t){e.insertsData[t.data.id]=t.data.toJSON(),e.stopListening(t.data),e.listenTo(t.data,"change add remove update",function(){e.insertsData[t.data.id]&&(e.insertsData[t.data.id]=t.data.toJSON())}),e.listenTo(t,"remove",e.onRemoveInsert)}),this.trigger("insert:added")},removeInsert:function(e){this.trigger("insert:prechange"),e.$el.detach(),this.trigger("insert:removed")},insertExport:function(t,n){var r=e("<div>").html(t);return r.find(".nosortable").removeClass("nosortable"),_.each(this._inserts,function(e){var t="#"+e.data.id,i=n?e.getSimpleOutput():e.getOutput();r.find(t).replaceWith(i)}),r.html()},parseMarkup:function(){var e=this;this.refreshTimeout&&clearTimeout(this.refreshTimeout),this.refreshTimeout=setTimeout(function(){_.each(e.deletedInserts,function(t,n){var r=e.$el.find("#"+n);r.length&&(e._inserts[n]=t,delete e.deletedInserts[n])}),_.each(e._inserts,function(t,n){if(!t.$el.parent().length){var r=e.$el.find("#"+n);r.length?(r.replaceWith(t.el),t.delegateEvents(),t.controls.delegateEvents(),t.controlEvents&&t.controlEvents()):(e.deletedInserts[n]=t,delete e._inserts[n])}}),e.$el.children(":not(.ueditor-insert), :not(.ueditor-post-insert-manager)").addClass("nosortable")},600)},sortableInserts:function(){var e=this;e.$el.sortable({cancel:".nosortable",helper:"clone",handle:".uinsert-drag-handle"}).on("sortstart",function(e,t){console.log("Sort start"),t.placeholder.width(t.helper.width()),t.item.css("float")!="none"&&t.helper.css({marginTop:e.offsetY})})},show_tooltip_in_this_location:function(t){var n=e(t.selection.getCurrent());if(_.isEmpty(n))return!1;var r=e(".upfront-inserted_image-wrapper, .upfront-inserted_embed-wrapper"),i=n.offset().top,s=!0;return r.each(function(){var t=e(this),n=t.find(".ueditor-insert-variant-group").height(),r=t.offset().top;i<=n+r+20&&i>=r-5&&(s=!1)}),s&&n.closest(".ueditor-insert").length===0&&(e.trim(n.html())==="<br>"||typeof n.closest("p.nosortable").html()!="undefined"&&e.trim(n.closest("p.nosortable").html())==="")}}),l={Image:{redactor:!1,selector:".upfront-inserted_image-wrapper",bind_events:function(){this.unbind_events(),this.redactor.$editor.on("mouseover",this.selector,this,this.hover_on).on("mouseout",this.selector,this,this.hover_off).on("mouseenter",":not("+this.selector+")",this,this.hover_off)},unbind_events:function(){this.redactor.$editor.off("mouseover",this.selector,this.hover_on).off("mouseout",this.selector,this.hover_off).off("mouseenter",":not("+this.selector+")",this,this.hover_off),this.remove_dialog()},hover_on:function(t){var n=e(t.target),r=e("#upfront-image-details");n.is(t.data.selector)||(n=n.closest(t.data.selector));if(!n.find("img").length)return;t.data.show_dialog(n),Upfront.Events.trigger("upfront:editor:image_on",n.get())},hover_off:function(t){var n=e(t.target);$isParent=e(t.toElement).closest("#upfront-image-details"),$isParent.length||t.data.remove_dialog()},create_dialog:function(){if(e("#upfront-image-details").length)return;var t=e("<div id='upfront-image-details' class='upfront-ui' />");t.append('<div class="upfront-image-orientation"><div class="upfront-image-align-left upfront-icon upfront-icon-image-left">left</div><div class="upfront-image-align-center upfront-icon upfront-icon-image-center">center</div><div class="upfront-image-align-right upfront-icon upfront-icon-image-right">right</div><div class="upfront-image-align-full upfront-icon upfront-icon-image-full">full width</div></div><div class="upfront-image-actions"><div class="upfront-image-action-change upfront-icon upfront-icon-image-select">Change Image</div><div class="upfront-image-action-details upfront-icon upfront-icon-image-detail">Image Details</div></div><div class="upfront-image-delete upfront-icon-button upfront-icon-button-delete"></div>'),e("body").append(t),t.find(".upfront-image-align-left").on("click",this,this.Align.left).end().find(".upfront-image-align-center").on("click",this,this.Align.center).end().find(".upfront-image-align-right").on("click",this,this.Align.right).end().find(".upfront-image-align-full").on("click",this,this.Align.full).end().find(".upfront-image-action-change").on("click",this,this.change_image).end().find(".upfront-image-action-details").on("click",this,this.Details.toggle).end().find(".upfront-image-delete").on("click",this,this.delete_image).end(),t.hide()},remove_dialog:function(t,n){var r=e("#upfront-image-details"),i=e("#upfront-image-details-image_details");i.length?t&&(i.remove(),r.hide()):(r.hide(),e("#upfront-inline-slider-nav").hide()),t&&n&&r.remove()},show_dialog:function(t){var n=e("#upfront-image-details");n.data("ref",t.get(0)),t.hasClass("upfront-inserted_image-slider")||t.hasClass("upfront-inserted_image-gallery")?n.addClass("no-orientation"):n.removeClass("no-orientation");var r=t.offset(),i=t.outerHeight(),s=t.outerWidth(),o=n.outerHeight();n.css({top:r.top+(o>i?0:i-o),left:r.left,width:s}),n.show()},get_target:function(t){return e(e(t).closest("#upfront-image-details").data("ref"))},change_image:function(e){var t=e.data.get_target(e.target);return Upfront.Media.Manager.open({multiple_selection:!1,button_text:"Change image"}).done(function(n,r){if(!r)return!1;if(!r.length)return!1;var i=Upfront.Media.Manager.results_html(r);t.replaceWith(i),e.data.redactor.code.sync(),e.data.bind_events()}),!1},delete_image:function(e){var t=e.data.get_target(e.target),n=t.parent(),r=n.hasClass("upfront-inline_post-slider"),i=n.hasClass("upfront-inline_post-gallery");return(r||i)&&n.find("img")==1?n.remove():t.remove(),r&&Slider.reset_nav(n),e.data.redactor.code.sync(),e.data.redactor.focus(),!1},Align:{_apply:function(t,n){n=e.extend({"float":"","text-align":"",width:""},n),t.css(n)},left:function(e){var t=e.data.get_target(e.target),n=t.find("img");return e.data.Align._apply(t,{"float":"left"}),e.data.Align._apply(n,{}),e.data.show_dialog(t),Upfront.Events.trigger("upfront:editor:image_align",t.get(),"left"),e.data.redactor.code.sync(),!1},center:function(e){var t=e.data.get_target(e.target),n=t.find("img");return e.data.Align._apply(t,{"text-align":"center"}),e.data.Align._apply(n,{}),e.data.show_dialog(t),Upfront.Events.trigger("upfront:editor:image_align",t.get(),"center"),e.data.redactor.code.sync(),!1},right:function(e){var t=e.data.get_target(e.target),n=t.find("img");return e.data.Align._apply(t,{"float":"right"}),e.data.Align._apply(n,{}),e.data.show_dialog(t),Upfront.Events.trigger("upfront:editor:image_align",t.get(),"right"),e.data.redactor.code.sync(),!1},full:function(e){var t=e.data.get_target(e.target),n=t.find("img");return e.data.Align._apply(t,{}),e.data.show_dialog(t),Upfront.Events.trigger("upfront:editor:image_align",t.get(),"full"),e.data.redactor.code.sync(),!1}},Details:{toggle:function(t){var n=e("#upfront-image-details"),r=e("#upfront-image-details-image_details");return r.length?t.data.Details.close(t):t.data.Details.open(t),!1},open:function(t){var n=t.data.get_target(t.target),r=n.find("img"),i=e("#upfront-image-details"),s=i.find(".upfront-image-action-details"),o=e('<div id="upfront-image-details-image_details" />'),u=n.find("a"),a=u.length?"":'checked="checked"',f=u.length&&u.is(".popup")?'checked="checked"':"",l=u.length&&u.attr("href").match(/^[^#]+/)?'checked="checked"':"",c=u.length&&!!l?u.attr("href"):"";o.append('<div class="upfront-image-detail-alt"><label class="upfront-field-label">Image Details:</label><input class="upfront-field upfront-field-text" type="text" placeholder="Alt" value="'+r.attr("alt")+'" />'+"</div>"+'<div class="upfront-image-detail-link">'+'<label class="upfront-field-label">Image links to:</label>'+"<ul>"+'<li><label><input class="upfront-field-radio" type="radio" '+a+' name="link_to" value="" /> No link</label></li>'+'<li><label><input class="upfront-field-radio" type="radio" '+f+' name="link_to" value="popup" /> Larger version (opens in lightbox)</label></li>'+'<li><label><input class="upfront-field-radio" type="radio" '+l+' name="link_to" value="link" /> Link <input class="upfront-field upfront-field-text" type="text" placeholder="http://www.google.com" value="'+c+'" /></label></li>'+'<li><label><input class="upfront-field-radio" type="radio" name="link_to" value="post" /> Post or page <em>/your-cool-post/</em></label></li>'+"</ul>"+"</div>"+'<button class="upfront-image-detail-button" type="button">OK</button>'),o.css({position:"absolute",top:s.offset().top+s.height(),"z-index":99}),e("body").append(o),o.css({left:s.offset().left+46-o.width()/2}),s.addClass("upfront-image-action-details-active"),o.on("click","button",t.data,t.data.Details.apply_details)},close:function(t){var n=e("#upfront-image-details"),r=n.find(".upfront-image-action-details"),i=e("#upfront-image-details-image_details");r.removeClass("upfront-image-action-details-active"),i.remove()},apply_details:function(t){var n=e("#upfront-image-details"),r=e("#upfront-image-details-image_details"),i=e(n.data("ref")),s=i.find("img"),o=i.find("a"),u=r.find(".upfront-image-detail-alt :text").val(),a=r.find(".upfront-image-detail-link :radio:checked").val(),f=r.find(".upfront-image-detail-link :text").val();s.attr("alt",u);if(a){var l=o.length?o:e('<a href="#" />');switch(a){case"popup":l.addClass("popup");break;case"link":l.attr("href",f);break;case"post":l.attr("href","http://localhost/upfront/edit/post/8")}o.length||s.wrapAll(l)}else o.length&&o.replaceWith(s);return t.data.redactor.code.sync(),t.data.Details.close(t)}},cleanup:function(t){var n=e("<div />").append(t);return n.find("#upfront-image-details").remove(),n.html()}},Gallery:{to_html:function(e){var t=e.$editor.html(),n=t.replace(/\[upfront-gallery\](.*?)\[\/upfront-gallery\]/,'<div class="upfront-inline_post-gallery clearfix">$1</div>');e.$editor.html(n),e.code.sync()},from_html:function(t){var n=e("<div />").append(t),r=n.find(".upfront-inline_post-gallery");return r.length?(r.each(function(){var t=e(this),n="";n=t.html(),t.replaceWith("[upfront-gallery]"+n+"[/upfront-gallery]")}),n.html()):t}},Slider:{to_html:function(e){var t=e.$editor.html(),n=t.replace(/\[upfront-slider\](.*?)\[\/upfront-slider\]/,'<div class="upfront-inline_post-slider clearfix">$1</div>');e.$editor.html(n),e.code.sync(),this.init_sliders_edit(e)},init_sliders_edit:function(t){var n=t.$editor.find(".upfront-inline_post-slider"),r=e('<div id="upfront-inline-slider-nav" class="upfront-default-slider-nav upfront-ui" />');e("body").append(r),n.each(function(){function s(){n.css("height",9999),r.each(function(t){var n=e(this).find("img"),r=n.height();i=i>r?i:r}),n.css("height",Math.ceil(i/15)*15),t.code.sync()}var n=e(this),r=n.find(".upfront-inserted_image-wrapper"),i=0;s(),n.find("img").on("load",s)}),e(document).on("mouseenter",".upfront-inline_post-slider",this,this.hover_on).on("mouseleave",".upfront-inline_post-slider",this,this.hover_off),r.on("click",".upfront-default-slider-nav-item",this,this.slide_switch)},hover_on:function(t){var n=e(this),r=e("#upfront-inline-slider-nav"),i=n.offset(),s=n.outerHeight(),o=n.outerWidth(),u=t.data;r.css({top:i.top+s,left:i.left,width:o}),r.show();if(u.$current_slider&&u.$current_slider.get(0)==n.get(0))return;u.$current_slider=n,u.reset_nav(n)},hover_off:function(e){},slide_switch:function(t){var n=e(this),r=n.attr("data-slider-index"),i=e("#upfront-inline-slider-nav"),s=t.data;s.$current_slider.find(".slide-edit-active").removeClass("slide-edit-active"),s.$current_slider.find(".upfront-inserted_image-wrapper").eq(r).addClass("slide-edit-active"),i.find(".upfront-default-slider-nav-item-selected").removeClass("upfront-default-slider-nav-item-selected"),n.addClass("upfront-default-slider-nav-item-selected"),l.Image.remove_dialog(),i.show()},reset_nav:function(t){var n=e("#upfront-inline-slider-nav");n.html(""),t.find(".upfront-inserted_image-wrapper").each(function(e){n.append('<i class="upfront-default-slider-nav-item" data-slider-index="'+e+'">'+e+"</i>")}),n.find(".upfront-default-slider-nav-item:first").trigger("click")},from_html:function(t){var n=e("<div />").append(t),r=n.find(".upfront-inline_post-slider");return r.length?(r.each(function(){var t=e(this),n="";n=t.html(),t.replaceWith("[upfront-slider]"+n+"[/upfront-slider]")}),n.html()):t}}}})}(jQuery),define("elements/upfront-text/js/model",[],function(){var e=Upfront.Models.ObjectModel.extend({init:function(){this.init_property("type","PlainTxtModel"),this.init_property("view_class","PlainTxtView"),this.init_property("element_id",Upfront.Util.get_unique_id("text-object")),this.init_property("class","c24 upfront-plain_txt"),this.init_property("has_settings",1),this.init_property("id_slug","plain_text"),this.init_property("preset","default")}});return e}),define("elements/upfront-text/js/element",["elements/upfront-text/js/model"],function(e){var t=Upfront.Settings.l10n.text_element,n=Upfront.Views.Editor.Sidebar.Element.extend({priority:10,render:function(){this.$el.addClass("upfront-icon-element upfront-icon-element-text"),this.$el.html(t.element_name)},add_element:function(){var n=new e({name:"",properties:[{name:"content",value:t.default_content}]}),r=new Upfront.Models.Module({name:"",properties:[{name:"element_id",value:Upfront.Util.get_unique_id("module")},{name:"class",value:"c11"},{name:"row",value:Upfront.Util.height_to_row(75)},{name:"has_settings",value:0}],objects:[n]});this.add_module(r)}});return n}),define("text!elements/upfront-text/tpl/preset-style.html",[],function(){return"#page .upfront-output-plaintxt.<?php echo $properties['id'] ?> .plain-text-container, #page .upfront-output-object.upfront-output-plaintxt.<?php echo $properties['id'] ?> .plain-text-container,\n#page .upfront-plain_txt.<?php echo $properties['id'] ?> .plain-text-container, #page .upfront-output-object.upfront-output-plain_text.<?php echo $properties['id'] ?> .plain-text-container {\n	<?php if(!empty($properties['bg_color'])) { ?>\n	background: <?php echo $properties['bg_color']  ?>;\n	<?php } ?>\n\n	<?php if(!empty($properties['useborder'])) { ?>\n        <?php if(!empty($properties['border_width']) && !empty($properties['border_style']) && !empty($properties['border_color'])) { ?>border: <?php echo $properties['border_width'] ?>px <?php echo $properties['border_style'] ?> <?php echo $properties['border_color'] ?>;<?php } ?>\n    <?php } else { ?>\n        border: none;\n    <?php } ?>\n}\n\n<?php if(!empty($properties['usetypography'])) { ?>\n\n#page .upfront-object.<?php echo $properties['id'] ?> h1, #page .upfront-output-object.<?php echo $properties['id'] ?> h1,\n#page .upfront-object.<?php echo $properties['id'] ?> h1 a, #page .upfront-output-object.<?php echo $properties['id'] ?> h1 a {\n	<?php if(!empty($properties['h1-color'])) { ?>color: <?php echo $properties['h1-color']  ?>; <?php } ?>\n	<?php if(!empty($properties['h1-fontface'])) { ?>font-family: <?php echo $properties['h1-fontface']  ?>; <?php } ?>\n	<?php if(!empty($properties['h1-fontsize'])) { ?>font-size: <?php echo $properties['h1-fontsize']  ?>px; <?php } ?>\n	<?php if(!empty($properties['h1-weight'])) { ?>font-weight: <?php echo $properties['h1-weight']  ?>;<?php } ?>\n	<?php if(!empty($properties['h1-style'])) { ?>font-style: <?php echo $properties['h1-style']  ?>;<?php } ?>\n	<?php if(!empty($properties['h1-lineheight'])) { ?>line-height: <?php echo $properties['h1-lineheight']  ?>;<?php } ?>\n}\n\n#page .upfront-object.<?php echo $properties['id'] ?> h2, #page .upfront-output-object.<?php echo $properties['id'] ?> h2,\n#page .upfront-object.<?php echo $properties['id'] ?> h2 a, #page .upfront-output-object.<?php echo $properties['id'] ?> h2 a {\n	<?php if(!empty($properties['h2-color'])) { ?>color: <?php echo $properties['h2-color']  ?>; <?php } ?>\n	<?php if(!empty($properties['h2-fontface'])) { ?>font-family: <?php echo $properties['h2-fontface']  ?>; <?php } ?>\n	<?php if(!empty($properties['h2-fontsize'])) { ?>font-size: <?php echo $properties['h2-fontsize']  ?>px; <?php } ?>\n	<?php if(!empty($properties['h2-weight'])) { ?>font-weight: <?php echo $properties['h2-weight']  ?>;<?php } ?>\n	<?php if(!empty($properties['h2-style'])) { ?>font-style: <?php echo $properties['h2-style']  ?>;<?php } ?>\n	<?php if(!empty($properties['h2-lineheight'])) { ?>line-height: <?php echo $properties['h2-lineheight']  ?>;<?php } ?>\n}\n\n#page .upfront-object.<?php echo $properties['id'] ?> h3, #page .upfront-output-object.<?php echo $properties['id'] ?> h3,\n#page .upfront-object.<?php echo $properties['id'] ?> h3 a, #page .upfront-output-object.<?php echo $properties['id'] ?> h3 a {\n	<?php if(!empty($properties['h3-color'])) { ?>color: <?php echo $properties['h3-color']  ?>; <?php } ?>\n	<?php if(!empty($properties['h3-fontface'])) { ?>font-family: <?php echo $properties['h3-fontface']  ?>; <?php } ?>\n	<?php if(!empty($properties['h3-fontsize'])) { ?>font-size: <?php echo $properties['h3-fontsize']  ?>px; <?php } ?>\n	<?php if(!empty($properties['h3-weight'])) { ?>font-weight: <?php echo $properties['h3-weight']  ?>;<?php } ?>\n	<?php if(!empty($properties['h3-style'])) { ?>font-style: <?php echo $properties['h3-style']  ?>;<?php } ?>\n	<?php if(!empty($properties['h3-lineheight'])) { ?>line-height: <?php echo $properties['h3-lineheight']  ?>;<?php } ?>\n}\n\n#page .upfront-object.<?php echo $properties['id'] ?> h4, #page .upfront-output-object.<?php echo $properties['id'] ?> h4,\n#page .upfront-object.<?php echo $properties['id'] ?> h4 a, #page .upfront-output-object.<?php echo $properties['id'] ?> h4 a {\n	<?php if(!empty($properties['h4-color'])) { ?>color: <?php echo $properties['h4-color']  ?>; <?php } ?>\n	<?php if(!empty($properties['h4-fontface'])) { ?>font-family: <?php echo $properties['h4-fontface']  ?>; <?php } ?>\n	<?php if(!empty($properties['h4-fontsize'])) { ?>font-size: <?php echo $properties['h4-fontsize']  ?>px; <?php } ?>\n	<?php if(!empty($properties['h4-weight'])) { ?>font-weight: <?php echo $properties['h4-weight']  ?>;<?php } ?>\n	<?php if(!empty($properties['h4-style'])) { ?>font-style: <?php echo $properties['h4-style']  ?>;<?php } ?>\n	<?php if(!empty($properties['h4-lineheight'])) { ?>line-height: <?php echo $properties['h4-lineheight']  ?>;<?php } ?>\n}\n\n#page .upfront-object.<?php echo $properties['id'] ?> h5, #page .upfront-output-object.<?php echo $properties['id'] ?> h5,\n#page .upfront-object.<?php echo $properties['id'] ?> h5 a, #page .upfront-output-object.<?php echo $properties['id'] ?> h5 a {\n	<?php if(!empty($properties['h5-color'])) { ?>color: <?php echo $properties['h5-color']  ?>; <?php } ?>\n	<?php if(!empty($properties['h5-fontface'])) { ?>font-family: <?php echo $properties['h5-fontface']  ?>; <?php } ?>\n	<?php if(!empty($properties['h5-fontsize'])) { ?>font-size: <?php echo $properties['h5-fontsize']  ?>px; <?php } ?>\n	<?php if(!empty($properties['h5-weight'])) { ?>font-weight: <?php echo $properties['h5-weight']  ?>;<?php } ?>\n	<?php if(!empty($properties['h5-style'])) { ?>font-style: <?php echo $properties['h5-style']  ?>;<?php } ?>\n	<?php if(!empty($properties['h5-lineheight'])) { ?>line-height: <?php echo $properties['h5-lineheight']  ?>;<?php } ?>\n}\n\n#page .upfront-object.<?php echo $properties['id'] ?> h6, #page .upfront-output-object.<?php echo $properties['id'] ?> h6,\n#page .upfront-object.<?php echo $properties['id'] ?> h6 a, #page .upfront-output-object.<?php echo $properties['id'] ?> h6 a {\n	<?php if(!empty($properties['h6-color'])) { ?>color: <?php echo $properties['h6-color']  ?>; <?php } ?>\n	<?php if(!empty($properties['h6-fontface'])) { ?>font-family: <?php echo $properties['h6-fontface']  ?>; <?php } ?>\n	<?php if(!empty($properties['h6-fontsize'])) { ?>font-size: <?php echo $properties['h6-fontsize']  ?>px; <?php } ?>\n	<?php if(!empty($properties['h6-weight'])) { ?>font-weight: <?php echo $properties['h6-weight']  ?>;<?php } ?>\n	<?php if(!empty($properties['h6-style'])) { ?>font-style: <?php echo $properties['h6-style']  ?>;<?php } ?>\n	<?php if(!empty($properties['h6-lineheight'])) { ?>line-height: <?php echo $properties['h6-lineheight']  ?>;<?php } ?>\n}\n\n#page .upfront-object.<?php echo $properties['id'] ?> p, #page .upfront-output-object.<?php echo $properties['id'] ?> p,\n#page .upfront-object.<?php echo $properties['id'] ?> p a, #page .upfront-output-object.<?php echo $properties['id'] ?> p a {\n	<?php if(!empty($properties['p-color'])) { ?>color: <?php echo $properties['p-color']  ?>; <?php } ?>\n	<?php if(!empty($properties['p-fontface'])) { ?>font-family: <?php echo $properties['p-fontface']  ?>; <?php } ?>\n	<?php if(!empty($properties['p-fontsize'])) { ?>font-size: <?php echo $properties['p-fontsize']  ?>px; <?php } ?>\n	<?php if(!empty($properties['p-weight'])) { ?>font-weight: <?php echo $properties['p-weight']  ?>;<?php } ?>\n	<?php if(!empty($properties['p-style'])) { ?>font-style: <?php echo $properties['p-style']  ?>;<?php } ?>\n	<?php if(!empty($properties['p-lineheight'])) { ?>line-height: <?php echo $properties['p-lineheight']  ?>;<?php } ?>\n}\n\n#page .upfront-object.<?php echo $properties['id'] ?> a, #page .upfront-output-object.<?php echo $properties['id'] ?> a {\n	<?php if(!empty($properties['a-color'])) { ?>color: <?php echo $properties['a-color']  ?>; <?php } ?>\n	<?php if(!empty($properties['a-fontface'])) { ?>font-family: <?php echo $properties['a-fontface']  ?>; <?php } ?>\n	<?php if(!empty($properties['a-fontsize'])) { ?>font-size: <?php echo $properties['a-fontsize']  ?>px; <?php } ?>\n	<?php if(!empty($properties['a-weight'])) { ?>font-weight: <?php echo $properties['a-weight']  ?>;<?php } ?>\n	<?php if(!empty($properties['a-style'])) { ?>font-style: <?php echo $properties['a-style']  ?>;<?php } ?>\n	<?php if(!empty($properties['a-lineheight'])) { ?>line-height: <?php echo $properties['a-lineheight']  ?>;<?php } ?>\n}\n\n#page .upfront-object.<?php echo $properties['id'] ?> a:hover, #page .upfront-output-object.<?php echo $properties['id'] ?> a:hover {\n	<?php if(!empty($properties['a-hover-color'])) { ?>color: <?php echo $properties['a-hover-color']  ?>; <?php } ?>\n	<?php if(!empty($properties['a-hover-fontface'])) { ?>font-family: <?php echo $properties['a-hover-fontface']  ?>; <?php } ?>\n	<?php if(!empty($properties['a-hover-fontsize'])) { ?>font-size: <?php echo $properties['a-hover-fontsize']  ?>px; <?php } ?>\n	<?php if(!empty($properties['a-hover-weight'])) { ?>font-weight: <?php echo $properties['a-hover-weight']  ?>;<?php } ?>\n	<?php if(!empty($properties['a-hover-style'])) { ?>font-style: <?php echo $properties['a-hover-style']  ?>;<?php } ?>\n	<?php if(!empty($properties['a-hover-lineheight'])) { ?>line-height: <?php echo $properties['a-hover-lineheight']  ?>;<?php } ?>\n}\n\n#page .upfront-object.<?php echo $properties['id'] ?> ul, #page .upfront-output-object.<?php echo $properties['id'] ?> ul {\n	<?php if(!empty($properties['ul-color'])) { ?>color: <?php echo $properties['ul-color']  ?>; <?php } ?>\n	<?php if(!empty($properties['ul-fontface'])) { ?>font-family: <?php echo $properties['ul-fontface']  ?>; <?php } ?>\n	<?php if(!empty($properties['ul-fontsize'])) { ?>font-size: <?php echo $properties['ul-fontsize']  ?>px; <?php } ?>\n	<?php if(!empty($properties['ul-weight'])) { ?>font-weight: <?php echo $properties['ul-weight']  ?>;<?php } ?>\n	<?php if(!empty($properties['ul-style'])) { ?>font-style: <?php echo $properties['ul-style']  ?>;<?php } ?>\n	<?php if(!empty($properties['ul-lineheight'])) { ?>line-height: <?php echo $properties['ul-lineheight']  ?>;<?php } ?>\n}\n\n#page .upfront-object.<?php echo $properties['id'] ?> ol, #page .upfront-output-object.<?php echo $properties['id'] ?> ol {\n	<?php if(!empty($properties['ol-color'])) { ?>color: <?php echo $properties['ol-color']  ?>; <?php } ?>\n	<?php if(!empty($properties['ol-fontface'])) { ?>font-family: <?php echo $properties['ol-fontface']  ?>; <?php } ?>\n	<?php if(!empty($properties['ol-fontsize'])) { ?>font-size: <?php echo $properties['ol-fontsize']  ?>px; <?php } ?>\n	<?php if(!empty($properties['ol-weight'])) { ?>font-weight: <?php echo $properties['ol-weight']  ?>;<?php } ?>\n	<?php if(!empty($properties['ol-style'])) { ?>font-style: <?php echo $properties['ol-style']  ?>;<?php } ?>\n	<?php if(!empty($properties['ol-lineheight'])) { ?>line-height: <?php echo $properties['ol-lineheight']  ?>;<?php } ?>\n}\n\n#page .upfront-object.<?php echo $properties['id'] ?> blockquote, #page .upfront-output-object.<?php echo $properties['id'] ?> blockquote,\n#page .upfront-object.<?php echo $properties['id'] ?> blockquote a, #page .upfront-output-object.<?php echo $properties['id'] ?> blockquote a {\n	<?php if(!empty($properties['blockquote-color'])) { ?>color: <?php echo $properties['blockquote-color']  ?>; <?php } ?>\n	<?php if(!empty($properties['blockquote-fontface'])) { ?>font-family: <?php echo $properties['blockquote-fontface']  ?>; <?php } ?>\n	<?php if(!empty($properties['blockquote-fontsize'])) { ?>font-size: <?php echo $properties['blockquote-fontsize']  ?>px; <?php } ?>\n	<?php if(!empty($properties['blockquote-weight'])) { ?>font-weight: <?php echo $properties['blockquote-weight']  ?>;<?php } ?>\n	<?php if(!empty($properties['blockquote-style'])) { ?>font-style: <?php echo $properties['blockquote-style']  ?>;<?php } ?>\n	<?php if(!empty($properties['blockquote-lineheight'])) { ?>line-height: <?php echo $properties['blockquote-lineheight']  ?>;<?php } ?>\n}\n\n#page .upfront-object.<?php echo $properties['id'] ?> blockquote.upfront-quote-alternative, #page.upfront-output-object .<?php echo $properties['id'] ?> blockquote.upfront-quote-alternative,\n#page .upfront-object.<?php echo $properties['id'] ?> blockquote.upfront-quote-alternative a, #page.upfront-output-object .<?php echo $properties['id'] ?> blockquote.upfront-quote-alternative a {\n	<?php if(!empty($properties['blockquote-alternative-color'])) { ?>color: <?php echo $properties['blockquote-alternative-color']  ?>; <?php } ?>\n	<?php if(!empty($properties['blockquote-alternative-fontface'])) { ?>font-family: <?php echo $properties['blockquote-alternative-fontface']  ?>; <?php } ?>\n	<?php if(!empty($properties['blockquote-alternative-fontsize'])) { ?>font-size: <?php echo $properties['blockquote-alternative-fontsize']  ?>px; <?php } ?>\n	<?php if(!empty($properties['blockquote-alternative-weight'])) { ?>font-weight: <?php echo $properties['blockquote-alternative-weight']  ?>;<?php } ?>\n	<?php if(!empty($properties['blockquote-alternative-style'])) { ?>font-style: <?php echo $properties['blockquote-alternative-style']  ?>;<?php } ?>\n	<?php if(!empty($properties['blockquote-alternative-lineheight'])) { ?>line-height: <?php echo $properties['blockquote-alternative-lineheight']  ?>;<?php } ?>\n}\n\n<?php } ?>\n\n<?php if(!empty($properties['preset_style'])) { ?><?php echo $properties['preset_style'] ?><?php } ?>\n"}),define("elements/upfront-text/js/settings",["scripts/upfront/element-settings/settings","scripts/upfront/preset-settings/util","text!elements/upfront-text/tpl/preset-style.html"],function(e,t,n){var r=Upfront.Settings.l10n.text_element,i=e.extend({panels:{Appearance:{mainDataCollection:"textPresets",styleElementPrefix:"text-preset",ajaxActionSlug:"text",panelTitle:r.settings,presetDefaults:Upfront.mainData.presetDefaults.text,styleTpl:n,stateModules:{Global:[{moduleType:"Colors",options:{title:r.settings.colors_label,multiple:!1,single:!0,abccolors:[{name:"bg_color",label:r.settings.content_area_bg}]}},{moduleType:"Border",options:{state:"static",title:"",fields:{use:"useborder",width:"border_width",type:"border_style",color:"border_color"}}},{moduleType:"Typography",options:{state:"static",title:r.settings.typography_label,toggle:!0,global_typography:!0,fields:{typeface:"fontface",fontstyle:"fontstyle",weight:"weight",style:"style",size:"fontsize",line_height:"lineheight",color:"color",use:"usetypography"},default_element:"h1",elements:[{label:r.h1,value:"h1"},{label:r.h2,value:"h2"},{label:r.h3,value:"h3"},{label:r.h4,value:"h4"},{label:r.h5,value:"h5"},{label:r.h6,value:"h6"},{label:r.p,value:"p"},{label:r.a,value:"a"},{label:r.ahover,value:"a-hover"},{label:r.ul,value:"ul"},{label:r.ol,value:"ol"},{label:r.bq,value:"blockquote"},{label:r.bqalt,value:"blockquote-alternative"}]}},{moduleType:"Checkbox",options:{state:"static",label:r.settings.padding_label,tooltip:!0,tooltip_label:r.settings.tooltip_label,fields:{checkbox:"additional_padding"}}}]},migrateElementStyle:function(e,t){return e=e.replace(/\.upfront-plain_txt/g," .plain-text-container"),e},migratePresetProperties:function(e){var t={},n="",r="";this.model.get("properties").each(function(e){t[e.get("name")]=e.get("value")}),n=typeof t.border_style!=typeof undefined&&"none"!==t.border_style?"yes":"";if(typeof t.background_color!="undefined"&&t.background_color||n==="yes")r="yes";e.set({useborder:n,bg_color:t.background_color,border_width:t.border_width,border_style:t.border_style,border_color:t.border_color,additional_padding:r})},getModifiedProperties:function(){var e={};return this.model.get("properties").each(function(t){e[t.get("name")]=t.get("value")}),typeof e.theme_style!="undefined"&&e.theme_style!=="_default"&&e.theme_style!==""&&e.theme_style!==" "?!0:typeof e.border_color!="undefined"&&e.border_color!=="rgba(0, 0, 0, 0)"||typeof e.border_style!="undefined"&&e.border_style!=="none"||typeof e.border_width!="undefined"&&e.border_width!==1?!0:typeof e.bg_color!="undefined"&&e.bg_color!=="rgba(0, 0, 0, 0)"?!0:!1}}},title:r.appearance});return t.generatePresetsToPage("text",n),i}),function(e,t){define("elements/upfront-text/js/menulist",[],function(){var t=Upfront.Settings.l10n.text_element,n=Upfront.Views.ContextMenuList.extend({initialize:function(){var n=this;this.menuitems=_([new Upfront.Views.ContextMenuItem({get_label:function(){return t.edit_text},action:function(){var t=n.for_view.$el.find("div.upfront-object-content").data("ueditor");n.for_view.$el.find("div.upfront-object-content").data("redactor")||(t.start(),e(document).on("click",function(n){if(!t.options.autostart&&t.redactor){var r=e(n.target);!t.disableStop&&!r.closest("li").length&&!r.closest(".redactor_air").length&&!r.closest(".ueditable").length&&t.stop()}}))}})])}});return n})}(jQuery),define("elements/upfront-text/js/menu",["elements/upfront-text/js/menulist"],function(e){var t=Upfront.Settings.l10n.text_element,n=Upfront.Views.ContextMenu.extend({initialize:function(){this.menulists=_([new e])}});return n}),define("text!elements/upfront-text/tpl/utext.html",[],function(){return"{[ if (usingNewAppearance == false) { ]}\n{[ if(background_color || border) { ]}<div class='plaintxt_padding' style='background-color: {{background_color}}; border: {{border}};'> {[ } ]}\n{[ } else { ]}\n<div class='plain-text-container'>\n{[ if(additional_padding) { ]}<div class='plaintxt_padding'>{[ } ]}\n{[ } ]}\n{{content}}\n{[ if (usingNewAppearance == false) { ]}\n{[ if(background_color || border) { ]}</div>{[ } ]}\n{[ } else { ]}\n{[ if(additional_padding) { ]}</div>{[ } ]}\n</div>\n{[ } ]}\n"}),function(e){define("utext",["elements/upfront-text/js/model","elements/upfront-text/js/element","elements/upfront-text/js/settings","elements/upfront-text/js/menu","text!elements/upfront-text/tpl/utext.html","scripts/upfront/preset-settings/util"],function(t,n,r,i,s,o){var u=Upfront.Settings.l10n.text_element,a=Upfront.Views.ObjectView.extend({initialize:function(){this.constructor.__super__.initialize.apply(this,arguments),this.model instanceof t||(this.model=new t({properties:this.model.get("properties")})),this.listenTo(Upfront.Events,"theme_colors:update",this.update_colors,this),this.listenTo(Upfront.Events,"upfront:lightbox:show",this.on_lightbox_show),this.listenTo(this.model,"preset:updated",this.preset_updated),this.listenTo(this.model,"change",this.render)},preset_updated:function(){this.render()},on_lightbox_show:function(){ed=this.$el.find(".upfront-object-content").data("ueditor"),!ed.options.autostart&&ed.redactor&&ed.stop()},get_preset_properties:function(){var e=this.model.get_property_value_by_name("preset"),t=o.getPresetProperties("text",e)||{};return t},get_content_markup:function(){var t=this.model.get_content(),n,r;try{n=e(t)}catch(i){n=e("<p>"+t+"</p>")}n.hasClass("plaintxt_padding")&&(t=n.html()),this.model.get_property_value_by_name("usingNewAppearance")!==!0&&this.model.get_property_value_by_name("usingNewAppearance")!=="true"?r={content:t,background_color:Upfront.Util.colors.convert_string_ufc_to_color(this.model.get_property_value_by_name("background_color")),border:Upfront.Util.colors.convert_string_ufc_to_color(this.model.get_property_value_by_name("border")),usingNewAppearance:!1}:r={content:t,usingNewAppearance:!0,additional_padding:this.get_preset_property("additional_padding")};var o="";return o=_.template(s,r),o},is_edited:function(){var e=this.model.get_property_value_by_name("is_edited");return e?!0:!1},on_render:function(){var t=this,n=!1;this.$el.find(".upfront-object-content").ueditor({linebreaks:!1,autostart:!1,paragraphize:!1,focus:!1,placeholder:u.default_content}).on("start",function(){var n=e(this).find(".upfront-quick-swap");n.length&&n.remove(),t.model.set_property("is_edited",!0,!0),Upfront.Events.trigger("upfront:element:edit:start","text")}).on("stop",function(){var e=t.$el.find(".upfront-object-content").data("ueditor"),n=e.redactor.$element[0].firstChild.tagName,r="";n==="PRE"&&e.redactor.selection.removeMarkers(),r=e.getValue(!0),r===""&&arguments[0]&&arguments[0].currentTarget&&(r=arguments[0].currentTarget.innerHTML),t.model.set_content(r),Upfront.Events.trigger("upfront:element:edit:stop"),e.redactor.events.trigger("cleanUpListeners"),t.render()}).on("syncAfter",function(){var e=t.$el.find(".upfront-object-content").data("ueditor"),n=e.getValue(!0);n===""&&typeof arguments[1]=="string"&&arguments[1]!==""&&(n=arguments[1]);if(!n.match(/[<>]/)){n=e.redactor.paragraphize.load(n),e.redactor.code.set(n),e.redactor.selection.selectAll();var r=e.redactor.selection.getBlocks(),i=r.pop();e.redactor.selection.remove(),i&&e.redactor.caret.setAfter(i)}t.model.set_content(e.getValue(!0)||n,{silent:!0})}),t.update_colors(),this.model.get_property_value_by_name("preset")&&(this.$el.find(".upfront-output-plaintxt").addClass(this.model.get_property_value_by_name("preset")),this.$el.find(".upfront-output-plain_text").addClass(this.model.get_property_value_by_name("preset")))},get_preset_property:function(e){var t=this.model.get_property_value_by_name("preset"),n=o.getPresetProperties("text",t)||{};return n[e]},update_colors:function(){var e=this,t=e.model.get_property_value_by_name("background_color");t&&Upfront.Util.colors.is_theme_color(t)&&(t=Upfront.Util.colors.get_color(t),e.model.set_property("bg_color",t));var n=e.model.get_property_value_by_name("border"),r=n?n.match(/#ufc\d+/):!1;if(n&&r&&r.length){var i=Upfront.Util.colors.get_color(r[0]);n=n.replace(new RegExp(r[0]),i),e.model.set_property("border_color",i)}}});Upfront.Application.LayoutEditor.add_object("PlainTxt",{Model:t,View:a,Element:n,Settings:r,ContextMenu:i,cssSelectors:{".plain-text-container":{label:u.css.container_label,info:u.css.container_info},".plain-text-container p":{label:u.css.p_label,info:u.css.p_info}},cssSelectorsId:"PlainTxtModel"}),Upfront.Models.UtextModel=t,Upfront.Views.PlainTxtView=a})}(jQuery),define("text!elements/upfront-comment/templates/preset-style.html",[],function(){return"<?php if(!empty($properties['preset_style'])) { ?><?php echo $properties['preset_style'] ?><?php } ?>\r\n"}),function(e){define("ucomment",["scripts/upfront/element-settings/settings","scripts/upfront/preset-settings/util","text!elements/upfront-comment/templates/preset-style.html"],function(t,n,r){function x(){(_upfront_post_data.post_id||Upfront.Application.get_current()===Upfront.Application.MODE.THEME&&"type"in _upfront_post_data.layout&&"single"===_upfront_post_data.layout.type)&&Upfront.Application.LayoutEditor.add_object("Ucomment",{Model:s,View:o,Element:S,Settings:E}),n.generatePresetsToPage("ucomment",r)}var i=Upfront.Settings.l10n.comments_element,s=Upfront.Models.ObjectModel.extend({init:function(){var e=_.clone(Upfront.data.ucomments.defaults);e.element_id=Upfront.Util.get_unique_id(e.id_slug+"-object"),this.init_properties(e)}}),o=Upfront.Views.ObjectView.extend({initialize:function(e){this.model instanceof s||(this.model=new s({properties:this.model.get("properties")})),this.constructor.__super__.initialize.call(this,[e])},get_content_markup:function(){var t=e(document).data("upfront-comment-"+_upfront_post_data.post_id);return t?t:i.loading},on_render:function(){e(document).data("upfront-comment-"+_upfront_post_data.post_id)||this._get_comment_markup();var t=Upfront.Settings.Application.PERMS.OPTIONS?new l({model:this.model}):new f({model:this.model});t.render(),this.$el.append(t.$el)},_get_comment_markup:function(){var t=this,n=_upfront_post_data.post_id;!n&&"themeExporter"in Upfront&&Upfront.Application.mode.current===Upfront.Application.MODE.THEME&&(n="fake_post"),Upfront.Util.post({action:"ucomment_get_comment_markup",data:JSON.stringify({post_id:n})}).success(function(n){var r=n.data.replace(/<script.*?>.*?<\/script>/gim,"");e(document).data("upfront-comment-"+_upfront_post_data.post_id,r||"&nbsp;"),t.render()}).error(function(e){Upfront.Util.log(i.loading_error)})}}),u=Upfront.Models.ObjectModel.extend({cache:!1,load:function(){this.loading=e.Deferred();if(this.cache)this._populate();else{var t=this;Upfront.Util.post({action:"upfront-discussion_settings-get"}).done(function(e){t.cache=e.data,t._populate()})}return this.loading},_populate:function(){if(!(_.isObject(this.cache)&&"avatar_defaults"in this.cache))return this.loading.reject(),!1;var t=_(this.cache.avatar_defaults).map(function(t){return t.icon&&(t.icon=t.icon.match(/^https?:\/\//)?t.icon:e(t.icon).attr("src")),t});this.set({properties:new Upfront.Collections.Properties(_(this.cache.properties).values()),avatars:_(t).values()}),this.loading.resolve()}}),a=Backbone.View.extend({className:"upfront-global_settings",events:{"click a.settings":"popup_open"},initialize:function(){Upfront.Events.on("popup:closed",this.onPopupClosed,this)},onPopupClosed:function(){e("#upfront-popup-content").removeClass("discussion-settings-wrapper")},render:function(){this.$el.empty().append('<a href="#" class="settings">'+this.label+"</a>")},popup_open:function(e){e.preventDefault(),e.stopPropagation();var t=this,n=Upfront.Popup.open(function(e,n,r){t.out=this,t.popup_data=e,t.setup_tabs(n),t.setup_actions(r),t.setup_content()},{},"discussion-popup");this.popup=this},setup_tabs:function(e){},setup_actions:function(e){},setup_content:function(){},save_settings:function(){}}),f=a.extend({label:i.discussion_settings,setup_content:function(){e(this.out).empty().append('<p class="settings-disabled">'+i.settings_disabled+"</p>")}}),l=a.extend({label:i.discussion_settings,initialize:function(){a.prototype.initialize.call(this),this.on("settings:tabs:switch_to:settings",this.render_settings_content,this),this.on("settings:tabs:switch_to:avatars",this.render_avatars_content,this),this.on("settings:save",this.save_settings,this)},setup_tabs:function(e){this.tabs=new c,this.tabs.parent_view=this,this.tabs.render(),e.append(this.tabs.$el)},setup_actions:function(e){var t=new h;t.parent_view=this,t.render(),e.empty().append(t.$el)},setup_content:function(){this.render_settings_content(),this.tabs.activate_tab("settings")},render_settings_content:function(){var e=new v({el:this.out,model:new u});e.render(),this.active_view=e},render_avatars_content:function(){var e=new d({el:this.out,model:new u});e.render(),this.active_view=e},save_settings:function(){var e={action:"upfront-discussion_settings-"+this.active_view.type+"-save",data:this.active_view.get_data()};Upfront.Util.post(e).done(function(){Upfront.Popup.close()})}}),c=Backbone.View.extend({tagName:"ul",className:"upfront-tabs upfront-ucomment-tabs",events:{"click li":"switch_to"},render:function(){this.$el.empty().append('<li class="settings">'+i.discussion_settings+"</li>").append('<li class="avatars">'+i.avatars+"</li>")},switch_to:function(t){t.preventDefault(),t.stopPropagation();var n=e(t.target),r=n.is(".settings")?"settings":"avatars";this.activate_tab(r),this.parent_view.trigger("settings:tabs:switch_to:"+r)},activate_tab:function(e){var t=this.$el.find("li."+e);this.$el.find("li").removeClass("active"),t.addClass("active")}}),h=Backbone.View.extend({className:"use_selection_container",events:{"click a":"trigger_settings_save"},render:function(){this.$el.empty().append('<a href="#">'+i.ok+"</a>")},trigger_settings_save:function(e){e.preventDefault(),e.stopPropagation(),this.parent_view.trigger("settings:save")}}),p=Backbone.View.extend({templates:{section_label:"<h3>{{label}}</h3>"},initialize:function(){var e=this;this.model.load().done(function(){e.render_final()})},render_final:function(){var e=this;this.populate_sections(),this.$el.empty(),this.$el.addClass("discussion-settings-wrapper"),this.sections.each(function(t){t.label&&e.$el.append(_.template(e.templates.section_label,{label:t.label})),t.fields.each(function(t){t.render(),e.$el.append(t.$el)})})},get_data:function(){var e={};return this.sections.each(function(t){t.fields.each(function(t){t.get_name?e[t.get_name()]=t.get_value():e=_.extend(e,t.get_value())})}),e},render:function(){this.$el.empty().append(i.please_wait)}}),d=p.extend({type:"avatars",populate_sections:function(){this.sections=_([{label:i.avatar_settings,fields:_([new g({model:this.model,property:"show_avatars",values:[{label:i.show_avatars,value:"1"}]})])},{label:i.max_rating,fields:_([new Upfront.Views.Editor.Field.Radios({model:this.model,property:"avatar_rating",layout:"vertical",values:[{label:i.rating.g,value:"G",icon:"http://1.gravatar.com/avatar/31cb559695bfc798dbf0981a52c7a748?s=32&d=&r=G&forcedefault=1"},{label:i.rating.pg,value:"PG",icon:"http://1.gravatar.com/avatar/31cb559695bfc798dbf0981a52c7a748?s=32&d=&r=G&forcedefault=1"},{label:i.rating.r,value:"R",icon:"http://1.gravatar.com/avatar/31cb559695bfc798dbf0981a52c7a748?s=32&d=&r=G&forcedefault=1"},{label:i.rating.x,value:"X",icon:"http://1.gravatar.com/avatar/31cb559695bfc798dbf0981a52c7a748?s=32&d=&r=G&forcedefault=1"}]})])},{label:i.default_avatar,fields:_([new Upfront.Views.Editor.Field.Radios({model:this.model,property:"avatar_default",layout:"vertical",values:this.model.get("avatars")})])}])}}),v=p.extend({type:"settings",spawn_checkbox:function(e,t,n){return n=n||"1",new Upfront.Views.Editor.Field.Checkboxes({multiple:!1,model:this.model,property:t,values:[{label:e,value:n}]})},populate_sections:function(){this.sections=_([{label:i.article.label,fields:_([this.spawn_checkbox(i.article.pingback,"default_pingback_flag"),this.spawn_checkbox(i.article.ping_status,"default_ping_status","open"),this.spawn_checkbox(i.article.comment_status,"default_comment_status","open"),this.spawn_checkbox(i.article.attachments,"allow_attachments"),this.spawn_checkbox(i.article.email,"show_email_subscription_field")])},{label:i.other.label,fields:_([this.spawn_checkbox(i.other.require_name_email,"require_name_email"),this.spawn_checkbox(i.other.comment_registration,"comment_registration"),new m({model:this.model,property:"",field:new Upfront.Views.Editor.Field.Checkboxes({model:this.model,property:"close_comments_for_old_posts",values:[{label:i.other.autoclose,value:"1"}]}),subfield:new y({model:this.model,property:"close_comments_days_old"})}),new m({model:this.model,property:"",field:new Upfront.Views.Editor.Field.Checkboxes({model:this.model,property:"thread_comments",values:[{label:i.other.thread_comments,value:"1"}]}),subfield:new y({model:this.model,property:"thread_comments_depth"})}),new w({model:this.model,field:new Upfront.Views.Editor.Field.Checkboxes({model:this.model,property:"page_comments",values:[{label:i.other.page_comments,value:"1"}]}),depth:new y({model:this.model,property:"default_comments_page"}),page:new Upfront.Views.Editor.Field.Select({model:this.model,property:"default_comments_page",values:[{label:i.other.last,value:"newest"},{label:i.other.first,value:"oldest"}]})}),new Upfront.Views.Editor.Field.Select({model:this.model,property:"comment_order",label:i.other.order,values:[{label:i.other.older,value:"asc"},{label:i.other.newer,value:"desc"}]})])},{label:i.other.email_me,fields:_([this.spawn_checkbox(i.other.comments_notify,"comments_notify"),this.spawn_checkbox(i.other.moderation_notify,"moderation_notify")])},{label:i.other.before_comment_appears,fields:_([this.spawn_checkbox(i.other.comment_moderation,"comment_moderation"),this.spawn_checkbox(i.other.comment_whitelist,"comment_whitelist")])},{label:i.other.moderation_label,fields:_([new b({model:this.model,property:"comment_max_links",label:i.other.max_links}),new Upfront.Views.Editor.Field.Textarea({model:this.model,property:"moderation_keys",label:i.other.moderation_keys}),new Upfront.Views.Editor.Field.Textarea({model:this.model,property:"blacklist_keys",label:i.other.blacklist_keys})])}])}}),m=Backbone.View.extend({className:"upfront-field-complex_field",initialize:function(e){this.options=e},render:function(){this.$el.empty(),this.$el.append(this.get_field_html()),this.$el.on("click",'[name="'+this.options.subfield.get_name()+'"]',this.stop_prop)},stop_prop:function(e){e.stopPropagation(),e.preventDefault()},get_field_html:function(){return this.options.subfield.render(),this.options.field.render(),_.template(this.options.field.$el.html(),{subfield:this.options.subfield.$el.html()})},get_value:function(){var e={};return $field=this.$el.find('[name="'+this.options.field.get_name()+'"]'),$subfield=this.$el.find('[name="'+this.options.subfield.get_name()+'"]'),e[this.options.field.get_name()]=$field.is(":checkbox")?$field.is(":checked")?1:0:$field.val(),e[this.options.subfield.get_name()]=$subfield.val(),e}}),g=Upfront.Views.Editor.Field.Checkboxes.extend({multiple:!1}),y=Upfront.Views.Editor.Field.Text.extend({get_label_html:function(){},get_field_html:function(){var e={type:"number","class":"upfront-field upfront-field-counter",min:0,step:1,id:this.get_field_id(),name:this.get_field_name(),value:this.get_saved_value()};return"<input "+this.get_field_attr_html(e)+" />"}}),b=y.extend({className:"upfront-field-labeled_counter_field",get_field_html:function(){},get_label_html:function(){var e=y.prototype.get_field_html.call(this);return _.template(Upfront.Views.Editor.Field.Text.prototype.get_label_html.call(this),{field:e})}}),w=m.extend({render:function(){this.$el.empty(),this.$el.append(this.get_field_html()),this.$el.on("click",'[name="'+this.options.depth.get_name()+'"]',this.stop_prop),this.$el.on("click",'[name="'+this.options.page.get_name()+'"]',this.stop_prop)},stop_prop:function(e){e.stopPropagation(),e.preventDefault()},get_field_html:function(){return this.options.depth.render(),this.options.page.render(),this.options.field.render(),_.template(this.options.field.$el.html(),{depth:this.options.depth.$el.html(),page:this.options.page.$el.html()})},get_value:function(){var e={},t=this.$el.find('[name="'+this.options.field.get_name()+'"]'),n=this.$el.find('[name="'+this.options.depth.get_name()+'"]'),r=this.$el.find('[name="'+this.options.page.get_name()+'"]');return e[this.options.field.get_name()]=t.is(":checkbox")?t.is(":checked")?1:0:t.val(),e[this.options.depth.get_name()]=n.val(),e[this.options.page.get_name()]=r.val(),e}}),E=t.extend({panels:{Appearance:{mainDataCollection:"ucommentPresets",styleElementPrefix:"ucomment-preset",ajaxActionSlug:"ucomment",panelTitle:i.settings,presetDefaults:Upfront.mainData.presetDefaults.ucomment,styleTpl:r}},title:i.settings}),S=Upfront.Views.Editor.Sidebar.Element.extend({draggable:!1,render:function(){this.$el.addClass("upfront-icon-element upfront-icon-element-comment"),this.$el.html(i.element_name)},add_element:function(){var e=new s,t=new Upfront.Models.Module({name:"",properties:[{name:"element_id",value:Upfront.Util.get_unique_id("module")},{name:"class",value:"c11 upfront-comment_module"},{name:"has_settings",value:0},{name:"row",value:Upfront.Util.height_to_row(375)}],objects:[e]});this.add_module(t)}});Upfront.Events.on("application:mode:after_switch",function(){if(Upfront.Application.get_current()!==Upfront.Application.MODE.THEME)return!1;x()}),x(),Upfront.Models.UcommentModel=s,Upfront.Views.UcommentView=o})}(jQuery),define("text!elements/upfront-contact-form/templates/preset-style.html",[],function(){return"/* Contact presets Typography Normal state */\n#page .<?php echo $properties['id'] ?> .upfront-field-container label {\n	<?php if(!empty($properties['field-labels-static-font-family'])) { ?>font-family: <?php echo $properties['field-labels-static-font-family']  ?>; <?php } ?>\n    <?php if(!empty($properties['field-labels-static-font-size'])) { ?>font-size: <?php echo $properties['field-labels-static-font-size']  ?>px; <?php } ?>\n    <?php if(!empty($properties['field-labels-static-weight'])) { ?>font-weight: <?php echo $properties['field-labels-static-weight']  ?>;<?php } ?>\n    <?php if(!empty($properties['field-labels-static-style'])) { ?>font-style: <?php echo $properties['field-labels-static-style']  ?>;<?php } ?>\n    <?php if(!empty($properties['field-labels-static-line-height'])) { ?>line-height: <?php echo $properties['field-labels-static-line-height']  ?>;<?php } ?>\n	<?php if(!empty($properties['field-labels-static-font-color'])) { ?>color: <?php echo $properties['field-labels-static-font-color']  ?>; <?php } ?>\n	<?php if(!empty($properties['hover-use-transition']) && !empty($properties['hover-transition-duration']) && !empty($properties['hover-transition-easing'] )) { ?>\n		transition: all <?php echo $properties['hover-transition-duration'] ?>s <?php echo $properties['hover-transition-easing']  ?>;\n	<?php } ?>\n}\n\n#page .<?php echo $properties['id'] ?> .upfront-field-container input,\n#page .<?php echo $properties['id'] ?> .upfront-field-container textarea {\n	<?php if(!empty($properties['field-values-static-font-family'])) { ?>font-family: <?php echo $properties['field-values-static-font-family']  ?>; <?php } ?>\n    <?php if(!empty($properties['field-values-static-font-size'])) { ?>font-size: <?php echo $properties['field-values-static-font-size']  ?>px; <?php } ?>\n    <?php if(!empty($properties['field-values-static-weight'])) { ?>font-weight: <?php echo $properties['field-values-static-weight']  ?>;<?php } ?>\n    <?php if(!empty($properties['field-values-static-style'])) { ?>font-style: <?php echo $properties['field-values-static-style']  ?>;<?php } ?>\n    <?php if(!empty($properties['field-values-static-line-height'])) { ?>line-height: <?php echo $properties['field-values-static-line-height']  ?>;<?php } ?>\n	<?php if(!empty($properties['field-values-static-font-color'])) { ?>color: <?php echo $properties['field-values-static-font-color']  ?>; <?php } ?>\n	<?php if(!empty($properties['hover-use-transition']) && !empty($properties['hover-transition-duration']) && !empty($properties['hover-transition-easing'] )) { ?>\n		transition: all <?php echo $properties['hover-transition-duration'] ?>s <?php echo $properties['hover-transition-easing']  ?>;\n	<?php } ?>\n}\n\n#page .<?php echo $properties['id'] ?> .upfront-field-container.upfront-submit-container .button{\n	<?php if(!empty($properties['button-static-font-family'])) { ?>font-family: <?php echo $properties['button-static-font-family']  ?>; <?php } ?>\n    <?php if(!empty($properties['button-static-font-size'])) { ?>font-size: <?php echo $properties['button-static-font-size']  ?>px; <?php } ?>\n    <?php if(!empty($properties['button-static-weight'])) { ?>font-weight: <?php echo $properties['button-static-weight']  ?>;<?php } ?>\n    <?php if(!empty($properties['button-static-style'])) { ?>font-style: <?php echo $properties['button-static-style']  ?>;<?php } ?>\n    <?php if(!empty($properties['button-static-line-height'])) { ?>line-height: <?php echo $properties['button-static-line-height']  ?>;<?php } ?>\n	<?php if(!empty($properties['button-static-font-color'])) { ?>color: <?php echo $properties['button-static-font-color']  ?>; <?php } ?>\n	<?php if(!empty($properties['hover-use-transition']) && !empty($properties['hover-transition-duration']) && !empty($properties['hover-transition-easing'] )) { ?>\n		transition: all <?php echo $properties['hover-transition-duration'] ?>s <?php echo $properties['hover-transition-easing']  ?>;\n	<?php } ?>\n}\n\n/* Contact presets Typography Hover state */\n\n<?php if(!empty($properties['hover-use-typography']) && $properties['hover-use-typography'] == 'yes') { ?>\n\n#page .<?php echo $properties['id'] ?> .upfront-field-container label:hover {\n	<?php if(!empty($properties['field-labels-hover-font-family'])) { ?>font-family: <?php echo $properties['field-labels-hover-font-family']  ?>; <?php } ?>\n    <?php if(!empty($properties['field-labels-hover-font-size'])) { ?>font-size: <?php echo $properties['field-labels-hover-font-size']  ?>px; <?php } ?>\n    <?php if(!empty($properties['field-labels-hover-weight'])) { ?>font-weight: <?php echo $properties['field-labels-hover-weight']  ?>;<?php } ?>\n    <?php if(!empty($properties['field-labels-hover-style'])) { ?>font-style: <?php echo $properties['field-labels-hover-style']  ?>;<?php } ?>\n    <?php if(!empty($properties['field-labels-hover-line-height'])) { ?>line-height: <?php echo $properties['field-labels-hover-line-height']  ?>;<?php } ?>\n	<?php if(!empty($properties['field-labels-hover-font-color'])) { ?>color: <?php echo $properties['field-labels-hover-font-color']  ?>; <?php } ?>\n}\n\n#page .<?php echo $properties['id'] ?> .upfront-field-container input:hover,\n#page .<?php echo $properties['id'] ?> .upfront-field-container textarea:hover {\n	<?php if(!empty($properties['field-values-hover-font-family'])) { ?>font-family: <?php echo $properties['field-values-hover-font-family']  ?>; <?php } ?>\n    <?php if(!empty($properties['field-values-hover-font-size'])) { ?>font-size: <?php echo $properties['field-values-hover-font-size']  ?>px; <?php } ?>\n    <?php if(!empty($properties['field-values-hover-weight'])) { ?>font-weight: <?php echo $properties['field-values-hover-weight']  ?>;<?php } ?>\n    <?php if(!empty($properties['field-values-hover-style'])) { ?>font-style: <?php echo $properties['field-values-hover-style']  ?>;<?php } ?>\n    <?php if(!empty($properties['field-values-hover-line-height'])) { ?>line-height: <?php echo $properties['field-values-hover-line-height']  ?>;<?php } ?>\n	<?php if(!empty($properties['field-values-hover-font-color'])) { ?>color: <?php echo $properties['field-values-hover-font-color']  ?>; <?php } ?>\n}\n\n#page .<?php echo $properties['id'] ?> .upfront-field-container.upfront-submit-container .button:hover {\n	<?php if(!empty($properties['button-hover-font-family'])) { ?>font-family: <?php echo $properties['button-hover-font-family']  ?>; <?php } ?>\n    <?php if(!empty($properties['button-hover-font-size'])) { ?>font-size: <?php echo $properties['button-hover-font-size']  ?>px; <?php } ?>\n    <?php if(!empty($properties['button-hover-weight'])) { ?>font-weight: <?php echo $properties['button-hover-weight']  ?>;<?php } ?>\n    <?php if(!empty($properties['button-hover-style'])) { ?>font-style: <?php echo $properties['button-hover-style']  ?>;<?php } ?>\n    <?php if(!empty($properties['button-hover-line-height'])) { ?>line-height: <?php echo $properties['button-hover-line-height']  ?>;<?php } ?>\n	<?php if(!empty($properties['button-hover-font-color'])) { ?>color: <?php echo $properties['button-hover-font-color']  ?>; <?php } ?>\n}\n\n<?php } else { ?>\n\n/* If typography checkbox is unchecked use normal state settings on hover */\n#page .<?php echo $properties['id'] ?> .upfront-field-container label:hover {\n	<?php if(!empty($properties['field-labels-static-font-family'])) { ?>font-family: <?php echo $properties['field-labels-static-font-family']  ?>; <?php } ?>\n    <?php if(!empty($properties['field-labels-static-font-size'])) { ?>font-size: <?php echo $properties['field-labels-static-font-size']  ?>px; <?php } ?>\n    <?php if(!empty($properties['field-labels-static-weight'])) { ?>font-weight: <?php echo $properties['field-labels-static-weight']  ?>;<?php } ?>\n    <?php if(!empty($properties['field-labels-static-style'])) { ?>font-style: <?php echo $properties['field-labels-static-style']  ?>;<?php } ?>\n    <?php if(!empty($properties['field-labels-static-line-height'])) { ?>line-height: <?php echo $properties['field-labels-static-line-height']  ?>;<?php } ?>\n	<?php if(!empty($properties['field-labels-static-font-color'])) { ?>color: <?php echo $properties['field-labels-static-font-color']  ?>; <?php } ?>\n}\n#page .<?php echo $properties['id'] ?> .upfront-field-container input:hover,\n#page .<?php echo $properties['id'] ?> .upfront-field-container textarea:hover {\n	<?php if(!empty($properties['field-values-static-font-family'])) { ?>font-family: <?php echo $properties['field-values-static-font-family']  ?>; <?php } ?>\n    <?php if(!empty($properties['field-values-static-font-size'])) { ?>font-size: <?php echo $properties['field-values-static-font-size']  ?>px; <?php } ?>\n    <?php if(!empty($properties['field-values-static-weight'])) { ?>font-weight: <?php echo $properties['field-values-static-weight']  ?>;<?php } ?>\n    <?php if(!empty($properties['field-values-static-style'])) { ?>font-style: <?php echo $properties['field-values-static-style']  ?>;<?php } ?>\n    <?php if(!empty($properties['field-values-static-line-height'])) { ?>line-height: <?php echo $properties['field-values-static-line-height']  ?>;<?php } ?>\n	<?php if(!empty($properties['field-values-static-font-color'])) { ?>color: <?php echo $properties['field-values-static-font-color']  ?>; <?php } ?>\n}\n#page .<?php echo $properties['id'] ?> .upfront-field-container.upfront-submit-container .button:hover {\n	<?php if(!empty($properties['button-static-font-family'])) { ?>font-family: <?php echo $properties['button-static-font-family']  ?>; <?php } ?>\n    <?php if(!empty($properties['button-static-font-size'])) { ?>font-size: <?php echo $properties['button-static-font-size']  ?>px; <?php } ?>\n    <?php if(!empty($properties['button-static-weight'])) { ?>font-weight: <?php echo $properties['button-static-weight']  ?>;<?php } ?>\n    <?php if(!empty($properties['button-static-style'])) { ?>font-style: <?php echo $properties['button-static-style']  ?>;<?php } ?>\n    <?php if(!empty($properties['button-static-line-height'])) { ?>line-height: <?php echo $properties['button-static-line-height']  ?>;<?php } ?>\n	<?php if(!empty($properties['button-static-font-color'])) { ?>color: <?php echo $properties['button-static-font-color']  ?>; <?php } ?>\n}\n\n<?php } ?>\n\n/* Contact presets Typography Focus state */\n\n<?php if(!empty($properties['focus-use-typography']) && $properties['focus-use-typography'] == 'yes') { ?>\n\n#page .<?php echo $properties['id'] ?> .upfront-field-container input:focus,\n#page .<?php echo $properties['id'] ?> .upfront-field-container textarea:focus {\n	<?php if(!empty($properties['field-values-focus-font-family'])) { ?>font-family: <?php echo $properties['field-values-focus-font-family']  ?>; <?php } ?>\n    <?php if(!empty($properties['field-values-focus-font-size'])) { ?>font-size: <?php echo $properties['field-values-focus-font-size']  ?>px; <?php } ?>\n    <?php if(!empty($properties['field-values-focus-weight'])) { ?>font-weight: <?php echo $properties['field-values-focus-weight']  ?>;<?php } ?>\n    <?php if(!empty($properties['field-values-focus-style'])) { ?>font-style: <?php echo $properties['field-values-focus-style']  ?>;<?php } ?>\n    <?php if(!empty($properties['field-values-focus-line-height'])) { ?>line-height: <?php echo $properties['field-values-focus-line-height']  ?>;<?php } ?>\n	<?php if(!empty($properties['field-values-focus-font-color'])) { ?>color: <?php echo $properties['field-values-focus-font-color']  ?>; <?php } ?>\n}\n\n#page .<?php echo $properties['id'] ?> .upfront-field-container.upfront-submit-container .button:focus {\n	<?php if(!empty($properties['button-focus-font-family'])) { ?>font-family: <?php echo $properties['button-focus-font-family']  ?>; <?php } ?>\n    <?php if(!empty($properties['button-focus-font-size'])) { ?>font-size: <?php echo $properties['button-focus-font-size']  ?>px; <?php } ?>\n    <?php if(!empty($properties['button-focus-weight'])) { ?>font-weight: <?php echo $properties['button-focus-weight']  ?>;<?php } ?>\n    <?php if(!empty($properties['button-focus-style'])) { ?>font-style: <?php echo $properties['button-focus-style']  ?>;<?php } ?>\n    <?php if(!empty($properties['button-focus-line-height'])) { ?>line-height: <?php echo $properties['button-focus-line-height']  ?>;<?php } ?>\n	<?php if(!empty($properties['button-focus-font-color'])) { ?>color: <?php echo $properties['button-focus-font-color']  ?>; <?php } ?>\n}\n\n<?php } else { ?>\n\n/* If typography checkbox is unchecked use normal state settings on focus */\n#page .<?php echo $properties['id'] ?> .upfront-field-container input:focus,\n#page .<?php echo $properties['id'] ?> .upfront-field-container textarea:focus {\n	<?php if(!empty($properties['field-values-static-font-family'])) { ?>font-family: <?php echo $properties['field-values-static-font-family']  ?>; <?php } ?>\n    <?php if(!empty($properties['field-values-static-font-size'])) { ?>font-size: <?php echo $properties['field-values-static-font-size']  ?>px; <?php } ?>\n    <?php if(!empty($properties['field-values-static-weight'])) { ?>font-weight: <?php echo $properties['field-values-static-weight']  ?>;<?php } ?>\n    <?php if(!empty($properties['field-values-static-style'])) { ?>font-style: <?php echo $properties['field-values-static-style']  ?>;<?php } ?>\n    <?php if(!empty($properties['field-values-static-line-height'])) { ?>line-height: <?php echo $properties['field-values-static-line-height']  ?>;<?php } ?>\n	<?php if(!empty($properties['field-values-static-font-color'])) { ?>color: <?php echo $properties['field-values-static-font-color']  ?>; <?php } ?>\n}\n#page .<?php echo $properties['id'] ?> .upfront-field-container.upfront-submit-container .button:focus {\n	<?php if(!empty($properties['button-static-font-family'])) { ?>font-family: <?php echo $properties['button-static-font-family']  ?>; <?php } ?>\n    <?php if(!empty($properties['button-static-font-size'])) { ?>font-size: <?php echo $properties['button-static-font-size']  ?>px; <?php } ?>\n    <?php if(!empty($properties['button-static-weight'])) { ?>font-weight: <?php echo $properties['button-static-weight']  ?>;<?php } ?>\n    <?php if(!empty($properties['button-static-style'])) { ?>font-style: <?php echo $properties['button-static-style']  ?>;<?php } ?>\n    <?php if(!empty($properties['button-static-line-height'])) { ?>line-height: <?php echo $properties['button-static-line-height']  ?>;<?php } ?>\n	<?php if(!empty($properties['button-static-font-color'])) { ?>color: <?php echo $properties['button-static-font-color']  ?>; <?php } ?>\n}\n\n<?php } ?>\n\n/* Colors module */\n#page .<?php echo $properties['id'] ?> .upfront-field-container input,\n#page .<?php echo $properties['id'] ?> .upfront-field-container textarea {\n	<?php if(!empty($properties['static-field-bg'])) { ?>background: <?php echo $properties['static-field-bg']  ?>;<?php } ?>\n	<?php if(!empty($properties['hover-use-transition']) && !empty($properties['hover-transition-duration']) && !empty($properties['hover-transition-easing'] )) { ?>\n		transition: all <?php echo $properties['hover-transition-duration'] ?>s <?php echo $properties['hover-transition-easing']  ?>;\n	<?php } ?>\n}\n\n#page .<?php echo $properties['id'] ?> .upfront-field-container input:hover,\n#page .<?php echo $properties['id'] ?> .upfront-field-container textarea:hover {\n	<?php if(!empty($properties['hover-use-color']) && $properties['hover-use-color'] == 'yes') { ?>\n		<?php if(!empty($properties['hover-field-bg'])) { ?>background: <?php echo $properties['hover-field-bg']  ?>;<?php } ?>\n	<?php } else { ?>\n	background: <?php echo $properties['static-field-bg']  ?>;\n	<?php } ?>\n}\n\n#page .<?php echo $properties['id'] ?> .upfront-field-container input:focus,\n#page .<?php echo $properties['id'] ?> .upfront-field-container textarea:focus {\n	<?php if(!empty($properties['focus-use-color']) && $properties['focus-use-color'] == 'yes') { ?>\n		<?php if(!empty($properties['focus-field-bg'])) { ?>background: <?php echo $properties['focus-field-bg']  ?>;<?php } ?>\n	<?php } else { ?>\n	background: <?php echo $properties['static-field-bg']  ?>;\n	<?php } ?>\n}\n\n#page .upfront-contact-form.<?php echo $properties['id'] ?> .upfront-field-container.upfront-submit-container .button {\n	<?php if(!empty($properties['static-button-bg'])) { ?> background: <?php echo $properties['static-button-bg']  ?>;<?php } ?>\n	<?php if(!empty($properties['hover-use-transition']) && !empty($properties['hover-transition-duration']) && !empty($properties['hover-transition-easing'] )) { ?>\n		transition: all <?php echo $properties['hover-transition-duration'] ?>s <?php echo $properties['hover-transition-easing']  ?>;\n	<?php } ?>\n}\n\n#page .upfront-contact-form.<?php echo $properties['id'] ?> .upfront-field-container.upfront-submit-container .button:hover {\n	<?php if(!empty($properties['hover-use-color']) && $properties['hover-use-color'] == 'yes') { ?>\n		<?php if(!empty($properties['hover-button-bg'])) { ?>background: <?php echo $properties['hover-button-bg']  ?>;<?php } ?>\n	<?php } else { ?>\n	background: <?php echo $properties['static-button-bg']  ?>;\n	<?php } ?>\n}\n\n#page .upfront-contact-form.<?php echo $properties['id'] ?> .upfront-field-container.upfront-submit-container .button:focus {\n	<?php if(!empty($properties['focus-use-color']) && $properties['focus-use-color'] == 'yes') { ?>\n		<?php if(!empty($properties['focus-button-bg'])) { ?>background: <?php echo $properties['focus-button-bg']  ?>;<?php } ?>\n	<?php } else { ?>\n	background: <?php echo $properties['static-button-bg']  ?>;\n	<?php } ?>\n}\n\n/* Borders Module */\n\n/* Fields */\n#page .<?php echo $properties['id'] ?> .upfront-field-container input,\n#page .<?php echo $properties['id'] ?> .upfront-field-container textarea {\n<?php if(!empty($properties['static-fields-useborder']) && $properties['static-fields-useborder'] == 'yes') { ?>\n	<?php if(!empty($properties['static-fields-borderwidth']) && !empty($properties['static-fields-bordertype']) && !empty($properties['static-fields-bordercolor'])) { ?>\n		border: <?php echo $properties['static-fields-borderwidth'] ?>px <?php echo $properties['static-fields-bordertype'] ?> <?php echo $properties['static-fields-bordercolor'] ?>;\n	<?php } ?>\n<?php } else { ?>\n		border: none;\n<?php } ?>\n}\n\n#page .<?php echo $properties['id'] ?> .upfront-field-container input:hover,\n#page .<?php echo $properties['id'] ?> .upfront-field-container textarea:hover {\n<?php if(!empty($properties['hover-fields-useborder']) && $properties['hover-fields-useborder'] == 'yes') { ?>\n	<?php if(!empty($properties['hover-fields-borderwidth']) && !empty($properties['hover-fields-bordertype']) && !empty($properties['hover-fields-bordercolor'])) { ?>\n		border: <?php echo $properties['hover-fields-borderwidth'] ?>px <?php echo $properties['hover-fields-bordertype'] ?> <?php echo $properties['hover-fields-bordercolor'] ?>;\n	<?php } ?>\n<?php } else { ?>\n	<?php if(!empty($properties['static-fields-useborder'])) { ?>\n		<?php if(!empty($properties['static-fields-borderwidth']) && !empty($properties['static-fields-bordertype']) && !empty($properties['static-fields-bordercolor'])) { ?>\n			border: <?php echo $properties['static-fields-borderwidth'] ?>px <?php echo $properties['static-fields-bordertype'] ?> <?php echo $properties['static-fields-bordercolor'] ?>;\n		<?php } ?>\n	<?php } else { ?>\n		border: none;\n	<?php } ?>\n<?php } ?>\n}\n\n#page .<?php echo $properties['id'] ?> .upfront-field-container input:focus,\n#page .<?php echo $properties['id'] ?> .upfront-field-container textarea:focus {\n<?php if(!empty($properties['focus-fields-useborder']) && $properties['focus-fields-useborder'] == 'yes') { ?>\n	<?php if(!empty($properties['focus-fields-borderwidth']) && !empty($properties['focus-fields-bordertype']) && !empty($properties['focus-fields-bordercolor'])) { ?>\n		border: <?php echo $properties['focus-fields-borderwidth'] ?>px <?php echo $properties['focus-fields-bordertype'] ?> <?php echo $properties['focus-fields-bordercolor'] ?>;\n	<?php } ?>\n<?php } else { ?>\n	<?php if(!empty($properties['static-fields-useborder'])) { ?>\n		<?php if(!empty($properties['static-fields-borderwidth']) && !empty($properties['static-fields-bordertype']) && !empty($properties['static-fields-bordercolor'])) { ?>\n			border: <?php echo $properties['static-fields-borderwidth'] ?>px <?php echo $properties['static-fields-bordertype'] ?> <?php echo $properties['static-fields-bordercolor'] ?>;\n		<?php } ?>\n	<?php } else { ?>\n		border: none;\n	<?php } ?>\n<?php } ?>\n}\n\n/* Button */\n\n#page .<?php echo $properties['id'] ?> .upfront-field-container.upfront-submit-container .button {\n<?php if(!empty($properties['static-button-useborder']) && $properties['static-button-useborder'] == 'yes') { ?>\n	<?php if(!empty($properties['static-button-borderwidth']) && !empty($properties['static-button-bordertype']) && !empty($properties['static-button-bordercolor'])) { ?>\n		border: <?php echo $properties['static-button-borderwidth'] ?>px <?php echo $properties['static-button-bordertype'] ?> <?php echo $properties['static-button-bordercolor'] ?>;\n	<?php } ?>\n<?php } else { ?>\n		border: none;\n<?php } ?>\n}\n\n#page .<?php echo $properties['id'] ?> .upfront-field-container.upfront-submit-container .button:hover {\n<?php if(!empty($properties['hover-button-useborder']) && $properties['hover-button-useborder'] == 'yes') { ?>\n	<?php if(!empty($properties['hover-button-borderwidth']) && !empty($properties['hover-button-bordertype']) && !empty($properties['hover-button-bordercolor'])) { ?>\n		border: <?php echo $properties['hover-button-borderwidth'] ?>px <?php echo $properties['hover-button-bordertype'] ?> <?php echo $properties['hover-button-bordercolor'] ?>;\n	<?php } ?>\n<?php } else { ?>\n	<?php if(!empty($properties['static-button-useborder'])) { ?>\n		<?php if(!empty($properties['static-button-borderwidth']) && !empty($properties['static-button-bordertype']) && !empty($properties['static-button-bordercolor'])) { ?>\n			border: <?php echo $properties['static-button-borderwidth'] ?>px <?php echo $properties['static-button-bordertype'] ?> <?php echo $properties['static-button-bordercolor'] ?>;\n		<?php } ?>\n	<?php } else { ?>\n		border: none;\n	<?php } ?>\n<?php } ?>\n}\n\n#page .<?php echo $properties['id'] ?> .upfront-field-container.upfront-submit-container .button:focus {\n<?php if(!empty($properties['focus-button-useborder']) && $properties['focus-button-useborder'] == 'yes') { ?>\n	<?php if(!empty($properties['focus-button-borderwidth']) && !empty($properties['focus-button-bordertype']) && !empty($properties['focus-button-bordercolor'])) { ?>\n		border: <?php echo $properties['focus-button-borderwidth'] ?>px <?php echo $properties['focus-button-bordertype'] ?> <?php echo $properties['focus-button-bordercolor'] ?>;\n	<?php } ?>\n<?php } else { ?>\n	<?php if(!empty($properties['static-button-useborder'])) { ?>\n		<?php if(!empty($properties['static-button-borderwidth']) && !empty($properties['static-button-bordertype']) && !empty($properties['static-button-bordercolor'])) { ?>\n			border: <?php echo $properties['static-button-borderwidth'] ?>px <?php echo $properties['static-button-bordertype'] ?> <?php echo $properties['static-button-bordercolor'] ?>;\n		<?php } ?>\n	<?php } else { ?>\n		border: none;\n	<?php } ?>\n<?php } ?>\n}\n\n/* Custom CSS */\n<?php if(!empty($properties['preset_style'])) { ?><?php echo $properties['preset_style'] ?><?php } ?>\n"}),define("elements/upfront-contact-form/js/settings",["scripts/upfront/element-settings/settings","scripts/upfront/element-settings/root-settings-panel","scripts/upfront/preset-settings/util","text!elements/upfront-contact-form/templates/preset-style.html"],function(e,t,n,r){var i=Upfront.Settings.l10n.contact_element,s=t.extend({label:"Empty label",title:i.general.label,settings:[{type:"SettingsItem",title:i.contact_details,className:"general_settings_item",fields:[{type:"Email",property:"form_email_to",label:i.general.send_to}]},{type:"SettingsItem",title:i.fields.label,className:"general_settings_item multiple_radio_no_padding",fields:[{type:"Optional",property:"show_subject",relatedField:"form_subject_label",values:[{label:i.fields.show_subject,value:"true"}]},{type:"Optional",property:"show_captcha",relatedField:"form_captcha_label",values:[{label:i.fields.show_captcha,value:"true"}]},{type:"Select",className:"contact_label_position",layout:"vertical",label:i.fields.label_localtion,change:function(e,t){t.model.set_property("form_label_position",e)},property:"form_label_position",values:[{label:i.apr.above,value:"above",icon:"contact-above-field"},{label:i.apr.over,value:"over",icon:"contact-over-field"},{label:i.apr.inline,value:"inline",icon:"contact-inline-field"}]}]},{type:"SettingsItem",title:i.validation.label,className:"general_settings_item",fields:[{type:"Radios",className:"inline-radios plaintext-settings",property:"form_validate_when",values:[{label:i.validation.on_field,value:"field"},{label:i.validation.on_submit,value:"submit"}]}]}]}),o=e.extend({panels:{General:s,Appearance:{mainDataCollection:"contactPresets",styleElementPrefix:"contact-preset",ajaxActionSlug:"contact",panelTitle:i.settings,presetDefaults:Upfront.mainData.presetDefaults.contact,styleTpl:r,stateModules:{Static:[{moduleType:"Colors",options:{title:i.colors_label,multiple:!1,single:!1,abccolors:[{name:"static-field-bg",label:i.field_bg_label},{name:"static-button-bg",label:i.button_bg_label}]}},{moduleType:"Typography",options:{title:i.typography_label,state:"static",toggle:!1,fields:{typeface:"static-font-family",fontstyle:"static-font-style",weight:"static-weight",style:"static-style",size:"static-font-size",line_height:"static-line-height",color:"static-font-color"},default_element:"field-labels",elements:[{label:i.field_labels_label,value:"field-labels"},{label:i.field_values_label,value:"field-values"},{label:i.button_label,value:"button"}]}},{moduleType:"Border",options:{state:"static-fields",title:"",label:"Fields Border",fields:{use:"static-fields-useborder",width:"static-fields-borderwidth",type:"static-fields-bordertype",color:"static-fields-bordercolor"}}},{moduleType:"Border",options:{state:"static-button",title:"",label:"Button Border",fields:{use:"static-button-useborder",width:"static-button-borderwidth",type:"static-button-bordertype",color:"static-button-bordercolor"}}}],Hover:[{moduleType:"Colors",options:{title:i.colors_label,multiple:!1,single:!1,toggle:!0,prepend:"hover-",prefix:"static",fields:{use:"hover-use-color"},abccolors:[{name:"hover-field-bg",label:i.field_bg_label},{name:"hover-button-bg",label:i.button_bg_label}]}},{moduleType:"Typography",options:{title:i.typography_label,state:"hover",toggle:!0,prepend:"hover-",prefix:"static",fields:{use:"hover-use-typography",typeface:"hover-font-family",fontstyle:"hover-font-style",weight:"hover-weight",style:"hover-style",size:"hover-font-size",line_height:"hover-line-height",color:"hover-font-color"},default_element:"field-labels",elements:[{label:i.field_labels_label,value:"field-labels"},{label:i.field_values_label,value:"field-values"},{label:i.button_label,value:"button"}]}},{moduleType:"Border",options:{state:"hover-fields",title:"",label:"Fields Border",prepend:"hover-",prefix:"static",fields:{use:"hover-fields-useborder",width:"hover-fields-borderwidth",type:"hover-fields-bordertype",color:"hover-fields-bordercolor"}}},{moduleType:"Border",options:{state:"hover-button",title:"",label:"Button Border",prepend:"hover-",prefix:"static",fields:{use:"hover-button-useborder",width:"hover-button-borderwidth",type:"hover-button-bordertype",color:"hover-button-bordercolor"}}},{moduleType:"HovAnimation",options:{state:"hover",title:"",toggle:!0,fields:{use:"hover-use-transition",duration:"hover-transition-duration",easing:"hover-transition-easing"}}}],Focus:[{moduleType:"Colors",options:{title:i.colors_label,multiple:!1,single:!1,toggle:!0,prepend:"focus-",prefix:"static",fields:{use:"focus-use-color"},abccolors:[{name:"focus-field-bg",label:i.field_bg_label},{name:"focus-button-bg",label:i.button_bg_label}]}},{moduleType:"Typography",options:{title:i.typography_label,state:"focus",prepend:"focus-",prefix:"static",toggle:!0,fields:{use:"focus-use-typography",typeface:"focus-font-family",fontstyle:"focus-font-style",weight:"focus-weight",style:"focus-style",size:"focus-font-size",line_height:"focus-line-height",color:"focus-font-color"},default_element:"field-labels",elements:[{label:i.field_values_label,value:"field-values"},{label:i.button_label,value:"button"}]}},{moduleType:"Border",options:{state:"focus-fields",title:"",label:"Fields Border",prepend:"focus-",prefix:"static",fields:{use:"focus-fields-useborder",width:"focus-fields-borderwidth",type:"focus-fields-bordertype",color:"focus-fields-bordercolor"}}},{moduleType:"Border",options:{state:"focus-button",title:"",label:"Button Border",prepend:"focus-",prefix:"static",fields:{use:"focus-button-useborder",width:"focus-button-borderwidth",type:"focus-button-bordertype",color:"focus-button-bordercolor"}}}]},migrateDefaultStyle:function(e){return e=e.replace(/(div)?\.upfront-contact-form\s/g,""),e=e.replace(/(div)?\.upfront-object\s/g,""),e}}},title:"Contact Element"});return n.generatePresetsToPage("contact",r),o}),function(e){define("ucontact",["upfront-data","elements/upfront-contact-form/js/settings","text!elements/upfront-contact-form/templates/preset-style.html","scripts/upfront/preset-settings/util"],function(t,n,r,i){var s=t.data&&t.data.ucontact&&t.data.ucontact.template?t.data.ucontact.template:"elements/upfront-contact-form/templates/ucontact.html";require(["text!"+s],function(t){var s=Upfront.Settings.l10n.contact_element,o=Upfront.Models.ObjectModel.extend({init:function(){var e=_.clone(Upfront.data.ucontact.defaults);e.element_id=Upfront.Util.get_unique_id(e.id_slug+"-object"),this.init_properties(e)}}),u=Upfront.Views.ObjectView.extend({tpl:Upfront.Util.template(t),initialize:function(e){this.model instanceof o||(this.model=new o({properties:this.model.get("properties")})),this.constructor.__super__.initialize.call(this,[e]),Upfront.Events.on("command:layout:save_success",this.checkDeleteElement,this),this.events=_.extend({},this.events,{"click button.submit-field":"handleButtonclick","click .upfront-field-container label":"handleButtonclick","dblclick button.submit-field":"editButtontext","dblclick .upfront-field-container > label":"editLabeltext"}),this.delegateEvents(),this.listenTo(Upfront.Events,"theme_colors:update",this.update_colors,this)},update_colors:function(){var e=this,t=this.model.get_property_value_by_name("preset"),n=i.getPresetProperties("contact",t)||{};if(_.size(n)<=0)return!1;i.updatePresetStyle("contact",n,r)},on_render:function(){var t=this;$button=this.$el.find("button.submit-field > span"),$button.ueditor({linebreaks:!0,disableLineBreak:!0,airButtons:["upfrontLink","stateAlignCTA","upfrontIcons"],autostart:!1}).on("stop",function(){var e=$button.data("ueditor"),n="";try{n=$button.text()}catch(r){n=""}n&&t.model.set_property("form_button_text",n,!0)}),$labels=this.$el.find(".upfront-field-container > label"),$labels.each(function(){$label=e(this),$label.ueditor({linebreaks:!0,disableLineBreak:!0,airButtons:["upfrontIcons"],autostart:!1}).on("start",function(t){e(t.target).closest(".upfront-field-container").children("input, textarea").attr("placeholder",""),e(t.target).css("opacity",1)}).on("stop",function(n){$label=e(this);var r=$label.data("ueditor"),i="";if(t.model.get_property_value_by_name("form_label_position")=="over")$label.find("span").remove(),i=$label.text(),e(n.target).closest(".upfront-field-container").children("input, textarea").attr("placeholder",i),e(n.target).css("opacity",0);else try{i=$label.text()}catch(n){i=""}var s=!1;$label.attr("for")=="sendername"?s="form_name_label":$label.attr("for")=="senderemail"?s="form_email_label":$label.attr("for")=="sendermessage"?s="form_message_label":$label.attr("for")=="subject"?s="form_subject_label":$label.attr("for")=="realPerson"&&(s="form_captcha_label"),i&&s&&t.model.set_property(s,i,!0)}),t.model.get_property_value_by_name("form_label_position")=="over"&&($label.css("opacity",0),$label.siblings("input, textarea").attr("placeholder",$label.text()))})},handleButtonclick:function(e){e.preventDefault()},editButtontext:function(e){e.preventDefault(),e.stopPropagation(),$button=this.$el.find("button.submit-field > span");var t=$button.data("ueditor");typeof t!="undefined"&&t.start()},editLabeltext:function(t){t.preventDefault(),t.stopPropagation(),$label=e(t.target),$label.css("opacity",1);var n=$label.data("ueditor");n.start()},checkDeleteElement:function(){},get_content_markup:function(){var e=_.extend({},this.extract_properties(),{message:!1,field_classes:this.getFieldStyleClass(),validate:"",entity_id:"",placeholders:{},ids:{name:"sendername",email:"senderemail",message:"sendermessage",subject:"subject",captcha:"realPerson"},values:{}});return e.preset=e.preset||"default",e.show_subject=e.show_subject&&e.show_subject.length,e.show_captcha=e.show_captcha&&e.show_captcha.length,e.form_add_title=e.form_add_title&&e.form_add_title.length,e.l10n=s.template,this.tpl(e)},property_value:function(e){return this.model.get_property_value_by_name(e)},extract_properties:function(){var e={};return this.model.get("properties").each(function(t){e[t.get("name")]=t.get("value")}),e},getFieldStyleClass:function(){return" ucontact-label-"+this.property_value("form_label_position")},getPlaceholder:function(e){return this.property_value("form_label_position")=="over"?'placeholder="'+this.property_value(e)+'"':""}}),a=Upfront.Views.Editor.Sidebar.Element.extend({priority:110,render:function(){this.$el.addClass("upfront-icon-element upfront-icon-element-contact"),this.$el.html(s.element_name)},add_element:function(){var e=new o,t=new Upfront.Models.Module({name:"",properties:[{name:"element_id",value:Upfront.Util.get_unique_id("module")},{name:"class",value:"c12 upfront-contact_form_module"},{name:"has_settings",value:0},{name:"row",value:Upfront.Util.height_to_row(435)}],objects:[e]});this.add_module(t)}});Upfront.Application.LayoutEditor.add_object("Ucontact",{Model:o,View:u,Element:a,Settings:n,cssSelectors:{label:{label:s.css.labels_label,info:s.css.labels_info},".ucontact-input":{label:s.css.fields_label,info:s.css.fields_info},".textarea-field":{label:s.css.msg_label,info:s.css.msg_info},".ucontact-field-error":{label:s.css.err_label,info:s.css.err_info},".submit-field":{label:s.css.send_label,info:s.css.send_info}},cssSelectorsId:Upfront.data.ucontact.defaults.type}),Upfront.Models.UcontactModel=o,Upfront.Views.UcontactView=u})})}(jQuery),define("text!elements/upfront-gallery/tpl/ugallery.html",[],function(){return"<div\n	class=\"ugallery ugallery_publish <?php if(!empty($in_editor)) { ?>ugallery-in-editor<?php } ?>\"\n	data-thumb-padding=\"<?php echo $thumbPadding ?>\"\n	data-thumb-side-padding=\"<?php echo $sidePadding ?>\"\n	data-thumb-bottom-padding=\"<?php echo $bottomPadding ?>\"\n	data-thumb-proportions=\"<?php echo $thumbProportions ?>\"\n	data-thumb-lock-padding=\"<?php echo $lockPadding ?>\"\n	data-lightbox-show-close=\"<?php echo $lightbox_show_close ? 'true' : 'false' ?>\"\n	data-lightbox-click-out-close=\"<?php echo $lightbox_click_out_close ? 'true' : 'false' ?>\"\n	data-lightbox-show-image-count=\"<?php echo $lightbox_show_image_count ? 'true' : 'false' ?>\"\n	data-lightbox-active-area-bg=\"<?php echo $lightbox_active_area_bg ?>\"\n	data-lightbox-overlay-bg=\"<?php echo $lightbox_overlay_bg ?>\"\n	data-styles=\"<?php echo $styles ?>\"\n>\n<?php if ($labelFilters === 'true' || !empty($in_editor)){ ?>\n<div class=\"ugallery_labels <?php if($in_editor) { ?>ugallery_labels-enabled-<?php echo $labelFilters === 'true' ? '1' : '0' ?><?php } ?>\">\n	<?php for($i=0; $i<$labels_length; $i++) { ?>\n		<a href=\"#\" class=\"ugallery_label_filter <?php echo $i == 0 ? 'filter_selected' : '' ?>\" rel=\"label_<?php echo $labels[$i]['id'] ?>\"><?php echo $labels[$i]['text'] ?></a>\n	<?php } ?>\n	</div>\n<?php } ?>\n<?php if($imagesLength){ ?>\n	<div class=\"ugallery_items ugallery_grid\" rel=\"<?php echo $element_id ?>\">\n	<?php for($i=0; $i<$imagesLength; $i++) { ?>\n	<div class=\"ugallery_item <?php if($in_editor) { ?>upfront-editing<?php } ?> ugallery_item_<?php echo !empty($images[$i]['imageLinkType']) && $images[$i]['imageLinkType'] == 'image' ? 'image' : $images[$i]['imageLinkType'] ?> <?php if($captionType === 'over') { ?>ugallery_caption_on_hover_<?php echo $showCaptionOnHover['length'] ?><?php } ?>\" style=\"position:relative; width:<?php echo $thumbWidth ?>px;\" rel=\"<?php echo $images[$i]['id'] ?>\" data-groups='[<?php echo $image_labels[$images[$i]['id']] ?>]'>\n		<?php $images[$i]['imageLinkType'] = !empty($images[$i]['imageLinkType']) ? $images[$i]['imageLinkType'] : false; ?>\n		  <?php if ($images[$i]['imageLinkType'] !== 'unlink') { ?>\n			<a class=\"ugallery_link ugallery_link<?php echo !empty($images[$i]['imageLinkType']) && $images[$i]['imageLinkType'] == 'image' ? ' ugallery_lightbox_link' : $images[$i]['imageLinkType'] ?>\" href=\"<?php echo $images[$i]['imageLinkUrl'] ?>\" target=\"<?php echo $images[$i]['imageLinkTarget'] ?>\" title=\"\">\n			<?php } ?>\n				<img src=\"<?php echo $images[$i]['src'] ?>\" alt=\"\" class=\"ugallery-image\" style=\"<?php echo !empty($images[$i]['loading']) && $images[$i]['loading'] ? 'display:none;' : '' ?> margin-left:<?php echo $images[$i]['margin']['left'] ?>px;  margin-top:<?php echo $images[$i]['margin']['top'] ?>px;width:<?php echo $thumbWidth ?>px; height:<?php echo $thumbHeight ?>px\">\n				<?php if(!empty($in_editor)) { ?>\n				<i class=\"remove-image\"></i>\n				<?php } ?>\n\n				<?php if ($usingNewAppearance === false) { ?>\n					<?php if($captionType != 'none' || !empty($in_editor)) { ?>\n					<div class=\"ugallery-thumb-title <?php if($captionType === 'over') { ?>ugallery-caption-on-hover-<?php echo $showCaptionOnHover['length'] ?><?php } ?> ugallery-caption-<?php echo $captionType ?><?php echo $captionUseBackground ? ' ugallery-padded-caption' : '' ?>\"><?php echo $images[$i]['title'] ?></div>\n					<?php } ?>\n				<?php } else { ?>\n					<?php if(($properties['captionType'] != 'none' || !empty($in_editor)) && !empty($properties['use_captions'])) { ?>\n					<div class=\"ugallery-thumb-title <?php if($properties['captionType'] === 'over') { ?>ugallery-caption-on-hover-<?php echo $properties['showCaptionOnHover'] ?><?php } ?> ugallery-caption-<?php echo $properties['captionType'] ?>\"><?php echo $images[$i]['title'] ?></div>\n					<?php } ?>\n				<?php } ?>\n			<?php if($linkTo == 'image'){ ?>\n			<div class=\"ugallery_lb_text\" rel=\"<?php echo $images[$i]['id'] ?>\"><?php if (!$editing && $images[$i]['caption'] != 'Image description') { ?><?php echo $images[$i]['caption'] ?><?php } ?></div>\n			<?php } ?>\n\n			<?php if ($images[$i]['imageLinkType'] !== 'unlink') { ?>\n			</a>\n			<?php } ?>\n		</div><?php } ?>\n	</div>\n<?php } else { ?>\n	<?php if(! $editing) { ?>\n		<?php echo $l10n['no_images'] ?>\n	<?php } else { ?>\n		<div class=\"ugallery-starting-wrapper upfront-ui upfront-initial-overlay-wrapper\">\n				<div class=\"ugallery-starting-container upfront-initial-overlay-wrapper\">\n					<span class=\"upfront-image-resizethiselement\"><?php echo $l10n['add_img'] ?></span>\n					<div class=\"\"><a class=\"upfront-image-select button\" href=\"#\" title=\"<?php echo $l10n['add_images'] ?>\">+</a></div>\n				</div>\n		</div>\n	<?php } ?>\n<?php } ?>\n</div>\n<?php if ($usingNewAppearance === false) { ?>\n<style>\n#<?php echo $element_id ?> .ugallery-thumb-title {\n	background: <?php echo  $captionBackground ?>;\n	<?php if($fitThumbCaptions[0] === 'true') { ?>\n	overflow: hidden;\n	height: <?php echo $thumbCaptionsHeight ?>px;\n	<?php } ?>\n}\n</style>\n<?php } ?>\n"}),define("text!elements/upfront-gallery/tpl/sorting-style.html",[],function(){return'<style id="sorting-style">\n	#{{ element_id }} .ugallery_item {\n		margin-right: {{ thumbPadding }}px;\n		{[ if (even_padding.length) { ]}\n		margin-bottom: {{ thumbPadding }}px;\n		{[ } ]}\n	}\n	#{{ element_id }} .ugallery_item:nth-child({{ itemsInRow }}n) {\n		margin-right: 0;\n	}\n</style>\n'}),define("text!elements/upfront-gallery/tpl/ugallery_editor.html",[],function(){return'<div>\r\n<!--\r\n	Wrap everything in a div to convert this file\'s content in a jquery element\r\n	so it is possible to use $.find.\r\n-->\r\n\r\n<script type="text/template" id="selector-tpl">\r\n	<div id="upront-image-placeholder" class="upfront-image-section">\r\n		<div class="upfront-image-selector-container">\r\n			<h2>{{ l10n.drop_images }}</h2>\r\n			or<br>\r\n			<a class="button select-files" href="#">{{ l10n.select_images }}</a>\r\n			<div id="upfront-image-maxsize">{{ l10n.max_upload_size }}</div>\r\n			{{ l10n.or_browse }}\r\n			<div class="upfront-image-media-container">\r\n			<i class="icon-picture"></i> <a class="open-media-gallery" href="#">{{ l10n.media_gallery }}</a>\r\n			</div>\r\n			<span class="dragimagehand"></span>\r\n		</div>\r\n	</div>\r\n</div>\r\n</script>\r\n\r\n<script type="text/template" id="progress-tpl">\r\n	<div id="upfront-image-uploading" class="upfront-image-section">\r\n		<h2>{{ l10n.uploading }}</h2>\r\n		<div class="upfront-progress-container">\r\n			<div id="upfront-progress"></div>\r\n		</div>\r\n	</div>\r\n</script>\r\n\r\n<script type="text/template" id="editor-tpl">\r\n	<div id="upfront-image-edit" class="upfront-image-section">\r\n		<div id="uimage-canvas-container" style="position:absolute">\r\n			<div id="uimage-canvas" style="position:relative; overflow:hidden;">\r\n				<img class="uimage-img {{ rotation }}" src="{{src}}" style="width:{{size.width}}px; height:{{size.height}}px;position:absolute">\r\n				<div id="uimage-mask" class="image-edit-mask" style="position:absolute; top:{{offset.top}}px; left:{{offset.left}}px"></div>\r\n			</div>\r\n			<div class="image-edit-resize image-edit-control"><i class="icon-resize-full ui-resizable-handle ui-resizable-handle-se"></i></div>\r\n			<div class="image-edit-rotate image-edit-control"><i class="icon-repeat"></i></div>\r\n		</div>\r\n		<div class="image-edit-save-container">\r\n			<div class="no-shadow">\r\n				<a class="image-edit-save" href="#"><i class="icon-ok"></i> {{ l10n.like }}</a>\r\n				<a class="image-edit-change" href="#"><i class="icon-upload-alt "></i> {{ l10n.upload_different }}</a>\r\n			</div>\r\n		</div>\r\n	</div>\r\n</script>\r\n\r\n\r\n<script type="text/template" id="upload-form-tpl">\r\n<form id="upfront-upload-image" name="upfront-upload-image" enctype="multipart/form-data" method="post" action="{{url}}">\r\n	<input type="file" name="media[]" id="upfront-image-file-input" multiple="multiple">\r\n	<input type="hidden" name="action" value="upfront-media-upload">\r\n	<input type="submit" value="{{ l10n.upload }}">\r\n</form>\r\n</script>\r\n\r\n<script type="text/template" id="details-tpl">\r\n<div class="upfront-settings-panel">\r\n	<input type="hidden" id="ugallery-image-id" value="{{id}}">\r\n	<h3>{{ l10n.edit_details }}</h3>\r\n	<div class="upfront-field-wrap">\r\n		<label for="ugallery-image-title">{{ l10n.title }}</label>\r\n		<input type="text" name="ugallery-image-title" value="{{title}}" class="upfront-field-text">\r\n	</div>\r\n	<div class="upfront-field-wrap">\r\n		<label for="ugallery-image-title">{{ l10n.caption }}</label>\r\n		<input type="text" name="ugallery-image-caption" value="{{caption}}" class="upfront-field-text">\r\n	</div>\r\n	<div class="upfront-field-wrap">\r\n		<label for="ugallery-image-title">{{ l10n.alt }}</label>\r\n		<input type="text" name="ugallery-image-alt" value="{{alt}}" class="upfront-field-text">\r\n	</div>\r\n	<div class="upfront-settings-button_panel">\r\n		<button type="button" class="upfront-save_settings"><i class="icon-ok"></i> {{ l10n.ok }}</button>\r\n	</div>\r\n\r\n	<div class="upfront-field-wrap upfront-additive_multiselection upfront-media-controls ">\r\n		<label for="ugallery-image-labels">{{ l10n.labels }}</label>\r\n		<div class="existing_labels">\r\n		<a href="#remove" class="upfront-icon upfront-icon-media-label-delete" data-idx="2">{{ l10n.wtf }}</a>\r\n		</div>\r\n		<div class="label_selector">\r\n			<input type="text" name="ugallery-image-labels" placeholder="{{ l10n.add_new_label }}" class="upfront-field-text">\r\n			<div class="labels_list">\r\n			</div>\r\n		</div>\r\n	</div>\r\n\r\n</div>\r\n</script>\r\n\r\n</div>\r\n'}),define("text!elements/upfront-gallery/tpl/lightbox_settings.html",[],function(){return'<div id="gallery-lb-settings-button" class="upfront-icon-button upfront-icon-button-setting"></div>\n<div class="upfront-inline-modal-wrap" id="gallery-lb-settings">\n	<div class="upfront-inline-modal-content">\n		<div class="upfront-region-bg-setting-name">\n			<div class="upfront-region-bg-setting-name-edit">\n				<span class="upfront-region-name-edit-value">{{Upfront.Settings.l10n.global.content.gallery_lightbox}}</span>\n			</div>\n		</div>\n\n		<div class="upfront-region-bg-setting-lightbox-region clearfix"></div>\n\n		<div class="upfront-region-bg-setting-footer clearfix">\n			<div class="upfront-region-bg-setting-edit-css upfront-icon upfront-icon-edit-css edit-lightbox-css">\n				<span>{{edit_lightbox_css}}</span>\n			</div>\n		</div>\n		<button type="button" class="upfront-inline-modal-save">{{Upfront.Settings.l10n.global.content.ok}}</button>\n	</div>\n</div>\n'}),define("elements/upfront-gallery/js/settings/thumbnail-fields",["scripts/upfront/element-settings/root-settings-panel"],function(e){var t=Upfront.Settings.l10n.gallery_element,n=function(e,t,n,r){e.set_property(t,n),e.trigger(r)},r=_.debounce(n,1e3),i=e.extend({className:"ugallery-thumbnail-fields upfront-settings_panel",settings:[{type:"SettingsItem",className:"general_settings_item",title:t.thumb.thumb_settings,fields:[{type:"Select",className:"thumb-propostions",property:"thumbProportions",label:t.thumb.ratio,layout:"vertical",default_value:"1",values:[{label:t.thumb.theme,value:"theme",icon:"gallery-crop-theme"},{label:"1:1",value:"1",icon:"gallery-crop-1_1"},{label:"2:3",value:"0.66",icon:"gallery-crop-2_3"},{label:"4:3",value:"1.33",icon:"gallery-crop-4_3"}],change:function(e,t){t.model.set_property("thumbProportions",e),t.model.trigger("change:thumbProportions")}}]},{type:"SettingsItem",className:"general_settings_item",title:t.thumb.size,fields:[{type:"Slider",property:"thumbWidth",className:"thumb-size-slider",min:100,max:250,step:5,label:t.thumb.size,default_value:150,change:function(e,t){var n=t.settings._wrapped[1].fields._wrapped[1];n.get_field().val(e),r(t.model,"thumbWidth",e,"change:thumbWidth")}},{type:"Number",className:"thumb-size-number",property:"thumbWidthNumber",default_value:0,min:100,max:250,change:function(e,t){var n=t.settings._wrapped[1].fields._wrapped[0];n.$el.find("#"+n.get_field_id()).slider("value",e),n.get_field().val(e),n.trigger("changed");var i=t.settings._wrapped[1].fields._wrapped[1];i.get_field().val(e),e>250?t.$el.find(".thumb-size-slider").css("opacity",.6):t.$el.find(".thumb-size-slider").css("opacity",1),r(t.model,"thumbWidth",e,"change:thumbWidth")}}]},{type:"SettingsItem",className:"general_settings_item",title:t.thumb.spacing,fields:[{type:"Checkboxes",className:"gallery-padding-lock",property:"lockPadding",label:"",default_value:"yes",multiple:!1,values:[{label:"",value:"yes"}],change:function(e,t){t.model.set_property("lockPadding",e)},show:function(e,t){e=="yes"?(t.$el.find(".thumb-padding-slider").show(),t.$el.find(".thumb-padding-number").show(),t.$el.find(".thumb-side-padding-slider").hide(),t.$el.find(".thumb-side-padding-number").hide(),t.$el.find(".thumb-bottom-padding-slider").hide(),t.$el.find(".thumb-bottom-padding-number").hide()):(t.$el.find(".thumb-padding-slider").hide(),t.$el.find(".thumb-padding-number").hide(),t.$el.find(".thumb-side-padding-slider").show(),t.$el.find(".thumb-side-padding-number").show(),t.$el.find(".thumb-bottom-padding-slider").show(),t.$el.find(".thumb-bottom-padding-number").show())}},{type:"Slider",property:"thumbPadding",className:"thumb-padding-slider",min:0,max:50,step:1,label:t.thumb.spacing,default_value:15,valueTextFilter:function(e){return e+"px"},change:function(e,t){var n=t.settings._wrapped[2].fields._wrapped[2];n.get_field().val(e),r(t.model,"thumbPadding",e,"change:thumbPadding")}},{type:"Number",className:"thumb-padding-number",property:"thumbPaddingNumber",default_value:15,change:function(e,t){var n=t.settings._wrapped[2].fields._wrapped[1];n.$el.find("#"+n.get_field_id()).slider("value",e),n.get_field().val(e),n.trigger("changed",e);var i=t.settings._wrapped[2].fields._wrapped[2];i.get_field().val(e),e>50?t.$el.find(".thumb-padding-slider").css("opacity",.6):t.$el.find(".thumb-padding-slider").css("opacity",1),r(t.model,"thumbPadding",e,"change:thumbPadding")}},{type:"Slider",property:"sidePadding",className:"thumb-side-padding-slider",min:0,max:50,step:1,label:t.thumb.side_spacing,change:function(e,t){var n=t.settings._wrapped[2].fields._wrapped[4];n.get_field().val(e),r(t.model,"sidePadding",e,"change:thumbPadding")}},{type:"Number",className:"thumb-side-padding-number",property:"thumbSidePaddingNumber",default_value:0,change:function(e,t){var n=t.settings._wrapped[2].fields._wrapped[4];n.get_field().val(e);var i=t.settings._wrapped[2].fields._wrapped[3];i.$el.find("#"+i.get_field_id()).slider("value",e),i.get_field().val(e),i.trigger("changed",e),e>50?t.$el.find(".thumb-side-padding-slider").css("opacity",.6):t.$el.find(".thumb-side-padding-slider").css("opacity",1),r(t.model,"sidePadding",e,"change:thumbPadding")}},{type:"Slider",property:"bottomPadding",className:"thumb-bottom-padding-slider",min:0,max:50,step:1,label:t.thumb.bottom_spacing,change:function(e,t){var n=t.settings._wrapped[2].fields._wrapped[6];n.get_field().val(e),r(t.model,"bottomPadding",e,"change:thumbPadding")}},{type:"Number",className:"thumb-bottom-padding-number",property:"thumbBottomPaddingNumber",default_value:0,change:function(e,t){var n=t.settings._wrapped[2].fields._wrapped[6];n.get_field().val(e);var i=t.settings._wrapped[2].fields._wrapped[5];i.$el.find("#"+i.get_field_id()).slider("value",e),i.get_field().val(e),i.trigger("changed",e),e>50?t.$el.find(".thumb-bottom-padding-slider").css("opacity",.6):t.$el.find(".thumb-bottom-padding-slider").css("opacity",1),r(t.model,"bottomPadding",e,"change:thumbPadding")}}]},{type:"SettingsItem",className:"general_settings_item",title:"Label filters",fields:[{type:"Checkboxes",property:"labelFilters",default_value:0,multiple:!1,values:[{label:"Enable image filtering",value:["true"]}],change:function(e,t){t.model.set_property("labelFilters",e)}}]}],title:"General Settings"});return i}),define("text!elements/upfront-gallery/tpl/preset-style.html",[],function(){return"#page .<?php echo $properties['id'] ?> .ugallery_item {\n	 <?php if(!empty($properties['useborder'])) { ?>\n        <?php if(!empty($properties['borderwidth']) && !empty($properties['bordertype']) && !empty($properties['bordercolor'])) { ?>border: <?php echo $properties['borderwidth'] ?>px <?php echo $properties['bordertype'] ?> <?php echo $properties['bordercolor'] ?>;<?php } ?>\n    <?php } else { ?>\n        border: none;\n    <?php } ?>\n}\n\n#page .<?php echo $properties['id'] ?> .ugallery_item {\n	<?php if(!empty($properties['useradius'])) { ?>\n        border-radius: <?php echo $properties['borderradius1'] ? $properties['borderradius1'] : 0 ?>px <?php echo $properties['borderradius2'] ? $properties['borderradius2'] : 0 ?>px <?php echo $properties['borderradius4'] ? $properties['borderradius4'] : 0 ?>px <?php echo $properties['borderradius3'] ? $properties['borderradius3'] : 0 ?>px;\n    <?php } else { ?>\n        border-radius: 0px;\n    <?php } ?>\n	overflow: visible;\n}\n\n#page .upfront-output-ugallery.<?php echo $properties['id'] ?> .ugallery-thumb-title p,\n#page .upfront-output-ugallery.<?php echo $properties['id'] ?> .ugallery-thumb-title,\n#page .upfront-object.upfront-gallery.<?php echo $properties['id'] ?> .ugallery-thumb-title p,\n#page .upfront-object.upfront-gallery.<?php echo $properties['id'] ?> .ugallery-thumb-title\n{\n	<?php if(!empty($properties['caption-text'])) { ?>\n	color: <?php echo $properties['caption-text']  ?>;\n	<?php } ?>\n}\n\n#page .upfront-output-ugallery.<?php echo $properties['id'] ?> .ugallery-thumb-title,\n#page .upfront-object.upfront-gallery.<?php echo $properties['id'] ?> .ugallery-thumb-title \n{\n	<?php if(!empty($properties['caption-bg'])) { ?>\n	background: <?php echo $properties['caption-bg'] ?>;\n	<?php } ?>\n}\n\n#page .upfront-output-ugallery.<?php echo $properties['id'] ?> .ugallery-thumb-title, \n#page .upfront-object.upfront-gallery.<?php echo $properties['id'] ?> .ugallery-thumb-title\n{\n	<?php if($properties['caption-height'] == 'fixed' && !empty($properties['thumbCaptionsHeight'])) { ?>\n		overflow: hidden;\n		height: <?php echo $properties['thumbCaptionsHeight'] ?>px;\n	<?php } ?>\n}\n\n/* Custom CSS */\n<?php if(!empty($properties['preset_style'])) { ?><?php echo $properties['preset_style'] ?><?php } ?>\n"}),define("elements/upfront-gallery/js/settings",["scripts/upfront/preset-settings/util","elements/upfront-gallery/js/settings/thumbnail-fields","scripts/upfront/element-settings/settings","text!elements/upfront-gallery/tpl/preset-style.html"],function(e,t,n,r){var i=Upfront.Settings.l10n.gallery_element,s=n.extend({panels:{Thumbnail:t,Appearance:{mainDataCollection:"galleryPresets",styleElementPrefix:"gallery-preset",ajaxActionSlug:"gallery",panelTitle:i.settings,presetDefaults:Upfront.mainData.presetDefaults.gallery,styleTpl:r,stateModules:{Global:[{moduleType:"Radius",options:{state:"global",max_value:100,fields:{use:"useradius",lock:"borderradiuslock",radius:"radius",radius_number:"radius_number",radius1:"borderradius1",radius2:"borderradius2",radius3:"borderradius3",radius4:"borderradius4"}}},{moduleType:"Colors",options:{title:i.panel.content_area_label,multiple:!1,single:!1,abccolors:[{name:"caption-text",label:i.panel.caption_text_label},{name:"caption-bg",label:i.panel.caption_bg_label}]}},{moduleType:"GalleryCaptionLocation",options:{state:"global",fields:{caption:"image-caption"}}},{moduleType:"Border",options:{state:"global",title:"",fields:{use:"useborder",width:"borderwidth",type:"bordertype",color:"bordercolor"}}}]},migrateDefaultStyle:function(e){return e=e.replace(/(div)?\.upfront-gallery\s/g,""),e=e.replace(/(div)?\.upfront-object\s/g,""),e},migratePresetProperties:function(e){var t={},n="",r="auto";this.model.get("properties").each(function(e){t[e.get("name")]=e.get("value")}),typeof t.fitThumbCaptions[0]!="undefined"&&t.fitThumbCaptions[0]&&(r="fixed"),typeof t.captionType!="undefined"&&t.captionType!=="none"&&(n="yes"),e.set({use_captions:n,captionType:t.captionType,showCaptionOnHover:t.showCaptionOnHover&&t.showCaptionOnHover[0]&&t.showCaptionOnHover[0]==="true"?"1":"0","caption-height":r,thumbCaptionsHeight:t.thumbCaptionsHeight,"caption-bg":t.captionBackground,"caption-text":t.captionColor})}}},title:i.settings});return e.generatePresetsToPage("gallery",r),s}),define("elements/upfront-gallery/js/model",[],function(){var e=Upfront.Models.ObjectModel.extend({init:function(){var e=_.clone(Upfront.data.ugallery.defaults);e.element_id=Upfront.Util.get_unique_id(e.id_slug+"-object"),this.init_properties(e)}});return e}),define("text!elements/upfront-gallery/js/templates/label-editor-template.html",[],function(){return'<div class="ugallery-magnific-labels upfront-ui">\n	<div class="ugallery-magnific-panel upfront-media-controls">\n		<div class="ugallery-magnific-wrapper existing_labels">\n			{{labels}}\n		</div>\n		<div class="ugallery-magnific-add">\n			<span class="ugallery-magnific-addform label_selector">\n				<input type="text" class="ugallery-addlabels" class="upfront-field-text" name="ugallery-image-labels" placeholder="{{ l10n.add_label }}"><div class="ugallery-magnific-addbutton">{{ l10n.add_label }}</div>\n				<span class="labels_list"></span>\n			</span>\n		</div>\n	</div>\n</div>\n'}),define("text!elements/upfront-gallery/js/templates/label-selector-template.html",[],function(){return"<ul {{labels.length ? '' : 'class=\"empty\"'}}>\n{[ _.each(labels, function(label){ ]}\n	<li><label rel=\"{{label.id}}\">{{label.text}}</label></li>\n{[ }) ]}\n</ul>\n"}),define("text!elements/upfront-gallery/js/templates/labels-template.html",[],function(){return'<span class="existing-labels-title">Image Labels</span>\n{[ if (labels.length) { ]}\n	{[ _.each(labels, function(label){ ]}\n		<a href="#remove" title="Remove" class="upfront-icon upfront-icon-media-label-delete" data-idx="{{label.id}}">{{label.text}}</a>\n	{[ }) ]}\n{[ } else { ]}\n	<span class=\'no-labels-notice\'>There are currently no labels added to this image...</span>\n{[ } ]}\n'}),function(e){define("elements/upfront-gallery/js/label-editor",["text!elements/upfront-gallery/js/templates/label-editor-template.html","text!elements/upfront-gallery/js/templates/label-selector-template.html","text!elements/upfront-gallery/js/templates/labels-template.html"],function(t,n,r){var i=Upfront.Settings.l10n.gallery_element,s=Backbone.View.extend({template:_.template(t),labelSelectorTpl:_.template(n),events:{'keyup input[name="ugallery-image-labels"]':"fillLabelSuggestionList",'keydown input[name="ugallery-image-labels"]':"onNameFieldKeydown",'click input[name="ugallery-image-labels"]':"onNameFieldClick","click label":"onLabelClick","click .existing_labels a":"removeLabel","click .ugallery-magnific-addbutton":"focusNameField"},initialize:function(e){this.options=e||{},this.gallery=e.gallery,this.labels=e.labels,this.imageId=e.imageId},onNameFieldClick:function(t){return e(t.target).focus(),t.preventDefault(),t.stopPropagation(),!1},updateLabels:function(){this.$el.find(".ugallery-magnific-wrapper").html(_.template(r,{labels:this.labels,l10n:i.template})),this.labels.length?this.$el.parents(".inline-panel-control-dialog").siblings(".upfront-icon-region-edit-labels-no-labels").removeClass("upfront-icon-region-edit-labels-no-labels").addClass("upfront-icon-region-edit-labels"):this.$el.parents(".inline-panel-control-dialog").siblings(".upfront-icon-region-edit-labels").removeClass(".upfront-icon-region-edit-labels").addClass("upfront-icon-region-edit-labels-no-labels")},render:function(){return this.$el.html(this.template({labels:_.template(r,{labels:this.labels,l10n:i.template}),imageId:this.imageId,l10n:i.template})),this},focusNameField:function(){var e=this.$el.find(".ugallery-addlabels");e.val()==""?e.focus():this.addLabel(e)},fillLabelSuggestionList:function(t){var n=this;if([9,13,38,40,27].indexOf(t.which)!==-1)return;var r=e(t.target).val(),s=_.keys(Upfront.data.ugallery.label_names),o=[];if(r.length<2)return e(".labels_list").html("");_.each(s,function(e){if(e.indexOf(r)!==-1){var t=Upfront.data.ugallery.label_names[e];!_.findWhere(n.labels,{id:t.id+""})&&!_.findWhere(n.labels,{id:parseInt(t.id,10)})&&o.push({id:t.id,text:t.text.replace(r,'<span class="selection">'+r+"</span>")})}}),this.$el.find(".labels_list").html(n.labelSelectorTpl({labels:o,l10n:i.template}))},selectNextSuggestion:function(){var t,n,r=-1,i=0;n=this.$el.find(".labels_list li");if(!n.length)return;t=n.find("label.selected"),t.length&&t.removeClass("selected");while(i<n.length&&r===-1)r=n[i]===t.parent()[0]?i:-1,i++;r===-1?e(n[0]).find("label").addClass("selected"):r<n.length-1&&e(n[r+1]).find("label").addClass("selected")},selectPreviousSuggestion:function(){var t,n,r=-1,i=0;n=this.$el.find(".labels_list li"),t=n.find("label.selected"),t.length&&t.removeClass("selected");while(i<n.length&&r===-1)r=n[i]===t.parent()[0]?i:-1,i++;r===-1?e(n[n.length-1]).find("label").addClass("selected"):r>0&&e(n[r-1]).find("label").addClass("selected")},onNameFieldKeydown:function(t){_.indexOf([13,9,40,38,27],t.which)!==-1&&t.preventDefault();switch(t.which){case 13:this.addLabel(e(t.target));break;case 9:case 40:this.selectNextSuggestion();break;case 38:this.selectPreviousSuggestion();break;case 27:this.clearSuggestions()}},clearSuggestions:function(){this.$el.find(".labels_list").html("")},addLabel:function(t){var n=this.$el.find(".labels_list label.selected"),r=this,i,s;if(!n.length){i=e.trim(t.val()),i.length&&(t.val("").siblings(".labels_list").html(""),e.when(this.gallery.addLabel(i,this.imageId)).done(function(e){r.labels.push(e),r.updateLabels(),t.val("").siblings(".labels_list").html("")}));return}s=n.attr("rel"),i=Upfront.data.ugallery.label_ids[s],this.labels.push(i),this.updateLabels(),t.val("").siblings(".labels_list").html(""),this.gallery.addLabel(i.text,this.imageId)},onLabelClick:function(t){var n=this,r=e(t.target).hasClass("selection")?e(t.target).parent():e(t.target);t.preventDefault(),t.stopPropagation();var i=r.attr("rel");if(i){var s=Upfront.data.ugallery.label_ids[i];this.gallery.addLabel(s.text,this.imageId),e.when(this.gallery.addLabel(s.text,this.imageId)).done(function(e){n.labels.push(e),n.updateLabels(),n.$el.find(".labels_list").html(""),n.$el.find(".ugallery-addlabels").val("")})}},removeLabel:function(t){t.preventDefault();var n=e(t.target),r=this,i=n.data("idx"),s,o;s={action:"upfront-media-disassociate_label",term:i,post_id:this.imageId},Upfront.Util.post(s),o=_.findWhere(this.labels,{id:i+""})||_.findWhere(this.labels,{id:parseInt(i,10)}),this.labels=_.without(this.labels,o),this.gallery.deleteLabel(i,this.imageId),n.fadeOut("fast",function(){e(this).remove(),r.labels.length===0&&r.updateLabels()})}});return s})}(jQuery),define("elements/upfront-gallery/js/element",["elements/upfront-gallery/js/model"],function(e){var t=Upfront.Settings.l10n.gallery_element,n=Upfront.Views.Editor.Sidebar.Element.extend({priority:30,render:function(){this.$el.addClass("upfront-icon-element upfront-icon-element-gallery"),this.$el.html(t.element_name)},add_element:function(){var t=new e,n=new Upfront.Models.Module({name:"",properties:[{name:"element_id",value:Upfront.Util.get_unique_id("module")},{name:"class",value:"c24 upfront-ugallery_module"},{name:"has_settings",value:0},{name:"row",value:Upfront.Util.height_to_row(240)}],objects:[t]});this.add_module(n)}});return n}),function(e){define("ugallery",["text!elements/upfront-gallery/tpl/ugallery.html","text!elements/upfront-gallery/tpl/sorting-style.html","text!elements/upfront-gallery/tpl/ugallery_editor.html","text!elements/upfront-gallery/tpl/lightbox_settings.html","elements/upfront-gallery/js/settings","elements/upfront-gallery/js/model","elements/upfront-gallery/js/label-editor","elements/upfront-gallery/js/element","text!elements/upfront-gallery/tpl/preset-style.html","scripts/upfront/preset-settings/util","scripts/upfront/link-model"],function(t,n,r,i,s,o,u,a,f,l,c){var h=Upfront.Settings.l10n.gallery_element,p=Upfront.Settings&&Upfront.Settings.l10n?Upfront.Settings.l10n.global.views:Upfront.mainData.l10n.global.views,d=Backbone.Model.extend({defaults:Upfront.data.ugallery.imageDefaults}),v=Backbone.Collection.extend({model:d}),m=Upfront.Views.ObjectView.extend({model:o,tpl:Upfront.Util.template(t),selectorTpl:_.template(e(r).find("#selector-tpl").html()),progressTpl:_.template(e(r).find("#progress-tpl").html()),editorTpl:_.template(e(r).find("#editor-tpl").html()),formTpl:_.template(e(r).find("#upload-form-tpl").html()),detailsTpl:_.template(e(r).find("#details-tpl").html()),sortMode:!1,lastThumbnailSize:!1,imageLabels:{},reopenSettings:!1,initialize:function(t){var n=this,r=this.property("element_id"),i,s;this.property("thumbPadding")!==this.property("thumbPaddingNumber")&&(this.property("thumbPaddingNumber",this.property("thumbPadding"),!0),this.property("thumbSidePaddingNumber",this.property("thumbPadding"),!0),this.property("sidePadding",this.property("thumbPadding"),!0),this.property("bottomPadding",this.property("thumbPadding"),!0),this.property("thumbSidePadding",this.property("thumbPadding"),!0),this.property("thumbBottomPaddingNumber",this.property("thumbPadding"),!0)),_.isArray(this.property("labelFilters"))&&this.property("labelFilters")[0]==="true"&&this.property("labelFilters","true",!0),this.model instanceof o||(this.model=new o({properties:this.model.get("properties")})),this.constructor.__super__.initialize.call(this,[t]),this.events=_.extend({},this.events,{"click a.upfront-image-select":"openImageSelector","click .add-item":"openImageSelector","click .toggle-sorting":"toggleSorting","click .ugallery_op_link":"imageEditLink","click .ugallery_op_mask":"imageEditMask","click .remove-image":"removeImage","click .ugallery_item":"selectItem","click .upfront-quick-swap":"openImageSelector",click:"preventNavigation","dblclick .ugallery-thumb-title":"startCaptionEditor","click .ugallery_item_lightbox":"openLightbox"}),s=this.property("images"),_.each(s,function(e,t){if(e.imageLink===!1||typeof e.imageLink=="undefined")s[t].imageLink={type:e.urlType,url:e.url,target:e.linkTarget}}),this.images=new v(s),this.listenTo(this.images,"add remove reset change",this.imagesChanged),this.property("images",this.images.toJSON()),typeof this.property("thumbPadding")=="undefined"&&this.property("thumbPadding",15),e("body").on("click",this.closeTooltip),this.listenTo(Upfront.Events,"entity:settings:activate",this.closeTooltip),this.listenTo(Upfront.Events,"entity:activated",this.closeTooltip),this.listenTo(Upfront.Events,"entity:deactivated",this.closeTooltip),this.listenTo(Upfront.Events,"entity:region:activated",this.closeTooltip),this.listenTo(Upfront.Events,"upfront:layout_size:change_breakpoint",this.rebindShuffle),this.listenTo(Upfront.Events,"theme_colors:update",this.update_colors,this),this.listenTo(this.model,"preset:updated",this.preset_updated),this.listenTo(Upfront.Events,"preset:gallery:updated",this.caption_updated,this),this.lastThumbnailSize={width:this.property("thumbWidth"),height:this.property("thumbHeight")};if(typeof ugalleries!="undefined"&&ugalleries[r])ugalleries[r].labels&&(this.labels=ugalleries[r].labels),ugalleries[r].image_labels&&(this.imageLabels=ugalleries[r].image_labels);else{if("undefined"==typeof ugalleries||!ugalleries)ugalleries={};ugalleries[r]={},i=["All"],_.each(this.images.models,function(e){i=_.union(i,e.get("tags"))}),this.labels=[],_.each(i,function(e,t){this.labels[t]={id:t,text:e}},this),this.imageLabels={},_.each(this.images.models,function(e){var t=[];_.each(this.labels,function(n){_.indexOf(e.get("tags"),n.text)>-1&&t.push("label_"+n.id)}),this.imageLabels[e.get("id")]="label_0,"+t.join(",")},this),ugalleries[r].labels=this.labels,ugalleries[r].imageLabels=this.imageLabels}this.on("deactivated",this.sortCancel,this),this.listenTo(this.model,"settings:closed",function(e){n.checkRegenerateThumbs(e),this.property("labelFilters")==="true"&&Upfront.frontFunctions.galleryBindShuffle()}),this.listenTo(this.model,"change:thumbProportions",function(){n.onThumbChangeProportions()}),this.listenTo(this.model,"change:thumbWidth",function(){n.onThumbChangeSize(),n.render()}),this.listenTo(this.model,"change:thumbPadding",function(){n.updateThumbPadding()}),this.listenTo(this.model,"change:even_padding",function(){n.updateEvenPadding()}),this.listenTo(this.model,"change:labelFilters",function(){n.updateShowFilters()}),this.listenTo(this.model,"change:showCaptionOnHover",function(){n.updateShowCaptionOnHover()}),this.listenTo(this.model,"change:captionType",function(){n.updateCaptionType()}),this.listenTo(this.model,"change:fitThumbCaptions",function(){n.updateFitThumbCaptions()}),this.listenTo(this.model,"change:thumbCaptionsHeight",function(){n.updateThumbCaptionsHeight()}),(this.property("status")!=="ok"||!this.images.length)&&this.property("has_settings",0),Upfront.Events.on("upfront:layout_size:change_breakpoint",function(){setTimeout(function(){n.render()},100)}),this.debouncedRender=_.debounce(this.render,300),this.debouncedRebindShuffle=_.debounce(this.rebindShuffleForDebouncing,500)},onThumbChangeProportions:function(e){var t=this.property("thumbProportions"),n=this.property("thumbWidth");t==="theme"&&(t=1),this.property("thumbProportions",t),this.onThumbChangeSize(),this.render()},onThumbChangeSize:function(){var e=this.property("thumbProportions"),t=this.property("thumbWidth"),n=Math.round(t/e);e==="theme"&&(e=1),this.property("thumbWidth",t,!1),this.property("thumbHeight",n),this.checkRegenerateThumbs()},get_preset_properties:function(){var e=this.model.get_property_value_by_name("preset")||"default",t=l.getPresetProperties("gallery",e)||{};return t},preset_updated:function(e){this.debouncedRender(),Upfront.Events.trigger("preset:gallery:updated",e)},caption_updated:function(e){var t=this.model.get_property_value_by_name("preset");t===e&&this.debouncedRender()},update_colors:function(){var e=this.get_preset_properties();if(_.size(e)<=0)return!1;l.updatePresetStyle("gallery",e,f)},preventClose:function(e){e.stopPropagation()},on_edit:function(){},updateThumbPadding:function(){this.$el.find(".ugallery").data("thumb-padding",this.property("thumbPadding")),this.$el.find(".ugallery").data("thumb-bottom-padding",this.property("bottomPadding")),this.$el.find(".ugallery").data("thumb-side-padding",this.property("sidePadding")),this.debouncedRender()},updateCaptionType:function(){var e,t;this.$el.find(".ugallery-thumb-title").removeClass("ugallery-caption-over ugallery-caption-below ugallery-caption-none").addClass("ugallery-caption-"+this.property("captionType")),this.property("captionType")!=="over"?(e="ugallery_caption_on_hover_1 ugallery_caption_on_hover_0 ugallery-caption-on-hover-1 ugallery-caption-on-hover-0",this.$el.find(".ugallery_item, .ugallery-thumb-title").removeClass(e)):(t=this.property("showCaptionOnHover").length,this.$el.find(".ugallery_item").addClass("ugallery_caption_on_hover_"+t),this.$el.find(".ugallery-thumb-title").addClass("ugallery-caption-on-hover-"+t))},updateFitThumbCaptions:function(){this.debouncedRender()},updateThumbCaptionsHeight:function(){this.debouncedRender()},updateShowCaptionOnHover:function(){var e="ugallery_caption_on_hover_1 ugallery_caption_on_hover_0 ugallery-caption-on-hover-1 ugallery-caption-on-hover-0",t=this.property("showCaptionOnHover").length;this.$el.find(".ugallery_item, .ugallery-thumb-title").removeClass(e),this.$el.find(".ugallery_item").addClass("ugallery_caption_on_hover_"+t),this.$el.find(".ugallery-thumb-title").addClass("ugallery-caption-on-hover-"+t)},updateEvenPadding:function(){this.render()},updateShowFilters:function(){this.property("labelFilters")==="true"?(this.$el.find(".ugallery_labels").show(),this.$el.find(".ugallery-magnific-labels").parents(".upfront-inline-panel-item").show(),Upfront.frontFunctions.galleryBindShuffle()):(this.$el.find(".ugallery_labels").hide(),this.$el.find(".ugallery-magnific-labels").parents(".upfront-inline-panel-item").hide())},selectItem:function(t){var n=e(t.target).hasClass("gallery_item")?e(t.target):e(t.target).closest(".ugallery_item");if(!n.length)return;n.siblings().removeClass("ugallery_selected"),(e(t.target).closest(".ugallery-controls")||{}).length||n.toggleClass("ugallery_selected"),t.gallerySelected=!0},createControlsEach:function(e){var t=new Upfront.Views.Editor.InlinePanels.ControlPanel;return t.items=_([this.createControl("crop",h.ctrl.edit_image,"imageEditMask"),this.createLinkControl(e)]),this.property("labelFilters")==="true"&&t.items.push(this.createLabelControl(e)),(e.get("imageLink").type==="image"||e.get("imageLink").type==="lightbox"||-1!==["image","lightbox"].indexOf(this.property("linkTo")))&&t.items.push(this.createControl("fullscreen",h.ctrl.show_image,"openImageLightbox")),t},createControl:function(e,t,n){var r=this,i=new Upfront.Views.Editor.InlinePanels.Control;return i.icon=e,i.tooltip=t,i.width=30,i.height=30,n&&this.listenTo(i,"click",function(e){r[n](e)}),i},createLabelControl:function(e){var t=new Upfront.Views.Editor.InlinePanels.DialogControl,n=this;return t.hideOkButton=!0,t.hideOnClick=!1,t.view=this.createLabelEditor(e),t.image=e,t.view.options.labels.length?t.icon="edit-labels":t.icon="edit-labels-no-labels",t.tooltip=h.ctrl.edit_labels,t.id="edit_labels",n.listenTo(t,"panel:open",function(){n.lastOpenedControl=t,setTimeout(function(){n.$el.find(".ugallery_item").css("overflow","visible")},10),t.$el.closest(".ugallery-controls").addClass("upfront-control-visible")}),n.listenTo(t,"panel:close",function(){t.$el.closest(".ugallery-controls").removeClass("upfront-control-visible"),t===n.lastOpenedControl&&n.render()}),t},createLinkControl:function(e){var t=this,n=new Upfront.Views.Editor.InlinePanels.DialogControl,r=new c(e.get("imageLink"));return n.view=linkPanel=new Upfront.Views.Editor.LinkPanel({model:r,linkTypes:{image:!0},imageUrl:e.get("srcFull")}),this.listenTo(linkPanel.model,"change",function(r){"entry"===r.get("type")&&setTimeout(function(){var r=n.$el.closest(".ugallery_item");t.add_controls_to_item(e,r)},50)}),this.listenTo(r,"change",function(){e.set({imageLink:r.toJSON()})}),this.listenTo(n,"panel:ok",function(){n.close()}),t.listenTo(n,"panel:open",function(){n.$el.parents(".ugallery_item").addClass("upfront-control-visible").end().closest(".ugallery_link").removeAttr("href"),t.$el.closest(".ui-draggable").draggable("disable")}),t.listenTo(n,"panel:ok",function(){n.$el.parents(".ugallery_item").removeClass("upfront-control-visible"),setTimeout(function(){n.$el.closest(".ugallery-controls").siblings(".ugallery_link").attr("href",r.get("url")).attr("target",r.get("target")).attr("class","ugallery_link ugallery_link"+r.get("type"));var i=n.$el.closest(".ugallery_item");t.add_controls_to_item(e,i)},50),t.$el.closest(".ui-draggable").draggable("enable")}),n.icon="link",n.tooltip=h.ctrl.image_link,n.id="link",n.width=30,n.height=30,n},openLightbox:function(e){var t,n;t=!1,n=ugalleries[galleryId].magnific},openImageLightbox:function(t){var n=this,r,i=e(t.target).closest(".ugallery_item"),s=n.images.get(i.attr("rel")),o=!1,u=function(){var t=this.content.find("figcaption"),n=this.wH-120-t.outerHeight(),r=e(window).width()-200;this.content.find("img").css({"max-width":r,"max-height":n})};if(s.get("imageLink").type==="lightbox"){r=s.get("imageLink").url.substring(1),Upfront.Application.LayoutEditor.openLightboxRegion(r);return}e.magnificPopup.open({closeOnBgClick:_.isTrue(this.model.get_property_value_by_name("lightbox_click_out_close")[0]),items:{src:s.get("srcFull")},type:"image",image:{titleSrc:function(){return s.get("caption")},markup:Upfront.data.ugallery.lightboxTpl},callbacks:{open:function(){n.setupLightbox(),n.createLightboxSettings(),e(".glb-content-container").click(n.preventClose),e(".glb-image-container").click(n.preventClose),e(".glb-caption-container").click(n.preventClose),setTimeout(function(){e(document).off("focusin")},500)},imageLoadComplete:function(){var t=e(this.container).find(".mfp-title");t.length&&t.ueditor({linebreaks:!1,autostart:!1,upfrontMedia:!1,upfrontImages:!1}).on("start",function(){o=!0}).on("syncAfter",function(){s.set("caption",t.html())})},beforeClose:function(){o&&Upfront.Views.Editor.notify(h.desc_update_success)},resize:u,afterChange:u}})},setupLightbox:function(){var t="gallery-"+this.property("element_id")+"-lightbox",n;e(".mfp-bg, .mfp-wrap").addClass(t),n=e("."+t),n.find(".mfp-counter").html("1 of 2"),this.property("lightbox_show_close")[0]==="true"?n.find(".mfp-close").show():n.find(".mfp-close").hide(),this.property("lightbox_show_image_count")[0]==="true"?n.find(".mfp-counter").show():n.find(".mfp-counter").hide(),e(".glb-content-container").css({background:this.property("lightbox_active_area_bg")}),e(".mfp-bg").css("background",this.property("lightbox_overlay_bg")),e(".mfp-container").find(".mfp-arrow.mfp-arrow-left.mfp-prevent-close").length===0&&e(".mfp-container").append('<button title="Previous (Left arrow key)" type="button" class="mfp-arrow mfp-arrow-left mfp-prevent-close"></button>'),e(".mfp-container").find(".mfp-arrow.mfp-arrow-right.mfp-prevent-close").length===0&&e(".mfp-container").append('<button title="Next (Right arrow key)" type="button" class="mfp-arrow mfp-arrow-right mfp-prevent-close"></button>'),e("style#"+t).length===0&&e("body").append('<style id="'+t+'"></style>'),e("style#"+t).html(this.property("styles"))},createLightboxSettings:function(){e(".mfp-container").append(_.template(i,{edit_lightbox_css:h.lightbox.edit_css,lightbox_title:h.lightbox.title}));var t=e(".mfp-container").find(".upfront-region-bg-setting-lightbox-region"),n=this,r;r={lightbox_click_out_close:new Upfront.Views.Editor.Field.Checkboxes({model:this.model,property:"lightbox_click_out_close",label:"",values:[{label:p.click_close_ltbox,value:"true",checked:this.model.get_property_value_by_name("lightbox_click_out_close")[0]==="true"?"checked":!1}],change:function(e){n.property("lightbox_click_out_close",e),this.model.set("lightbox_click_out_close",e,!0),n.setupLightbox()}}),lightbox_show_close:new Upfront.Views.Editor.Field.Checkboxes({model:this.model,className:"gallery-lb-show_close upfront-field-wrap upfront-field-wrap-multiple upfront-field-wrap-checkboxes",property:"lightbox_show_close",label:"",values:[{label:p.show_close_icon,value:"true",checked:this.model.get_property_value_by_name("lightbox_show_close")[0]==="true"?"checked":!1}],change:function(e){n.property("lightbox_show_close",e),n.setupLightbox()}}),lightbox_show_image_count:new Upfront.Views.Editor.Field.Checkboxes({model:this.model,className:"gallery-lb-show_image_count upfront-field-wrap upfront-field-wrap-multiple upfront-field-wrap-checkboxes",property:"lightbox_show_image_count",label:"",values:[{label:h.lightbox.show_image_count,value:"true",checked:this.model.get_property_value_by_name("lightbox_show_image_count")[0]==="true"?"checked":!1}],change:function(e){n.property("lightbox_show_image_count",e),n.setupLightbox()}})},r.lightbox_active_area_bg=new Upfront.Views.Editor.Field.Color({model:this.model,property:"lightbox_active_area_bg",className:"upfront-field-wrap upfront-field-wrap-color sp-cf overlay_color",label:h.lightbox.active_area_bg+":",spectrum:{move:function(e){n.property("lightbox_active_area_bg",e.toRgbString()),n.setupLightbox()},change:function(e){n.property("lightbox_active_area_bg",e.toRgbString()),n.setupLightbox()}}}),r.lightbox_overlay_bg=new Upfront.Views.Editor.Field.Color({model:this.model,property:"lightbox_overlay_bg",label:h.lightbox.overlay_bg+":",change:n.updateProperty,spectrum:{move:function(e){n.property("lightbox_overlay_bg",e.toRgbString()),n.setupLightbox()},change:function(e){n.property("lightbox_overlay_bg",e.toRgbString()),n.setupLightbox()}}}),_.each(r,function(e){e.render(),e.delegateEvents(),t.find(e.$el).length===0&&t.append(e.$el)}),e("#gallery-lb-settings-button").toggle(function(){e("#gallery-lb-settings").show()},function(){e("#gallery-lb-settings").hide()}),e("#gallery-lb-settings .upfront-inline-modal-save").click(function(){e("#gallery-lb-settings-button").click(),n.galleryLightboxCssEditor&&n.galleryLightboxCssEditor.close()}),e("#gallery-lb-settings").click(function(e){e.stopPropagation()}),e("#gallery-lb-settings").find(".edit-lightbox-css").click(function(t){n.galleryLightboxCssEditor=new Upfront.Views.Editor.GeneralCSSEditor({model:n.model,page_class:"gallery-"+n.property("element_id")+"-lightbox",type:"GalleryLightbox",sidebar:!0,global:!1,toolbar:!0,cssSelectors:{".mfp-close":{label:h.css.lightbox_close,info:h.css.lightbox_close},".glb-content-container":{label:h.css.lightbox_content_wrapper,info:h.css.lightbox_content_wrapper_info},".glb-image-container":{label:h.css.lightbox_image_wrapper,info:h.css.lightbox_image_wrapper},".glb-caption-container":{label:h.css.lightbox_caption_wrapper,info:h.css.lightbox_caption_wrapper},".mfp-title":{label:h.css.lightbox_caption,info:h.css.lightbox_caption},".mfp-arrow-left:before":{label:h.css.lightbox_arrow_left,info:h.css.lightbox_arrow_left},".mfp-arrow-right:before":{label:h.css.lightbox_arrow_right,info:h.css.lightbox_arrow_right},".mfp-counter":{label:h.css.lightbox_image_count,info:h.css.lightbox_image_count}},change:function(e){n.property("styles",e),n.setupLightbox()},onClose:function(){e(".mfp-content").css({"margin-bottom":0,"margin-top":0})}}),e(".mfp-content").css({"margin-bottom":250,"margin-top":50})})},createLabelEditor:function(e){var t=new u({gallery:this,labels:this.extractImageLabels(e.id),imageId:e.id});return t},openLightboxLabels:function(e){this.openImageLightbox(e,!0)},getPropertiesForTemplate:function(){var e=this.extract_properties();e.properties=this.get_preset_properties(),e.imagesLength=e.images.length,e.editing=!0,e.labels=this.labels,e.labels_length=this.labels.length,e.image_labels=this.imageLabels;var t=this.property("linkTo");return _.each(e.images,function(n,r){e.images[r].imageLinkType=n.imageLink.type||t,e.images[r].imageLinkUrl=n.imageLink.url,e.images[r].imageLinkTarget=n.imageLink.target}),e.usingNewAppearance=e.usingNewAppearance||!1,e.l10n=h.template,e.in_editor=!0,e.even_padding||(e.even_padding=["false"]),_.isArray(e.labelFilters)&&e.labelFilters[0]==="true"&&(e.labelFilters="true"),e},get_content_markup:function(){return this.tpl(this.getPropertiesForTemplate())},on_render:function(){var t=this,n;t.parent_module_view&&!t.parent_module_view.$el.data("resizeHandling")&&(n=e.proxy(t.onElementResizing,t),t.parent_module_view.$el.on("resize",n).on("resizestop",e.proxy(t.onElementResizeStop,t)).data("resizeHandling",!0)),Upfront.Events.on("upfront:lightbox:show",function(t){setTimeout(function(){e(window).trigger("resize")},300)}),this.images.each(function(e){e.get("loading")&&0===t.$('.ugallery_item[rel="'+e.id+'"]').find(".ugallery-image-loading").length&&t.$('.ugallery_item[rel="'+e.id+'"]').append('<p class="ugallery-image-loading">'+h.loading+"</p>")}),_.indexOf(["ok","starting"],t.property("status"))===-1&&0===t.$(".upfront-gallery").find(".upfront-quick-swap").length&&t.$(".upfront-gallery").append('<div class="upfront-quick-swap"><p>'+h.personalize+"</p></div>"),setTimeout(function(){t.rebindShuffle();var n=t.$(".ugallery_item");_.each(n,function(n){var r=e(n),i=t.images.get(r.attr("rel")),s=r.find(".ugallery-thumb-title"),o=t.add_controls_to_item(i,r).setWidth(r.width());t.ensureCaptionEditorExists(s,i),i.controls&&i.controls.remove(),i.controls=o})},300),this.isSortingActive===!0?this.activateSortable():this.cleanupSortable(),this.property("linkTo")===!1&&this.showSelectType()},ensureCaptionEditorExists:function(e,t){var n=this;e.data("ueditor")||e.ueditor({linebreaks:!1,autostart:!1,upfrontMedia:!1,upfrontImages:!1}).on("start",function(){n.$el.addClass("upfront-editing")}).on("stop",function(){setTimeout(function(){e.removeAttr("style")},10),n.$el.removeClass("upfront-editing")}).on("syncAfter",function(){t.set("title",e.html()),t.set("caption",e.html())})},onElementResizing:function(){this.$(".ugallery_items").width(e("html").find(".upfront-resize").width()-30)},onElementResizeStop:function(){},on_module_update:function(e){this.render()},toggleSorting:function(t){t&&t.preventDefault(),this.isSortingActive=!this.isSortingActive,this.itemsInRow=this.$el.find(".ugallery_item").filter(function(){return e(this).css("top")==="0px"}).length,this.render(),this.isSortingActive?this.controls.$el.find(".upfront-icon-region-toggle-sorting").addClass("upfront-icon-region-sorting-active"):this.controls.$el.find(".upfront-icon-region-toggle-sorting").removeClass("upfront-icon-region-sorting-active")},rebindShuffleForDebouncing:function(){this.isSortingActive||Upfront.frontFunctions.galleryBindShuffle(this.$el.find(".ugallery_grid"),!0)},rebindShuffle:function(){this.debouncedRebindShuffle()},preventNavigation:function(t){this.constructor.__super__.constructor.__super__.on_click.call(this,t);if(t.target.tagName.toUpperCase()==="INPUT")return;(t.target.tagName.toUpperCase()==="A"||e(t.target).closest("a").length)&&t.preventDefault()},getLabelSelector:function(t){var n=e(e.trim(this.labelsTpl({labels:this.extractImageLabels(t),l10n:h.template})));return n},extractImageLabels:function(e){var t=_.isUndefined(this.imageLabels[e])?!1:this.imageLabels[e].match(/-?\d+/g),n=[];return t&&_.each(this.labels,function(e){t.indexOf(e.id.toString())!==-1&&e.id!=="0"&&n.push(e)}),n},openImageSelector:function(e,t){var n=this,r={multiple:!0,preparingText:h.preparing,customImageSize:{width:this.property("thumbWidth"),height:this.property("thumbHeight")},element_id:this.model.get_property_value_by_name("element_id")};e&&e.preventDefault(),Upfront.Views.Editor.ImageSelector.open(r).done(function(e,r){n.addImages(e,t),r.given!==r.returned&&Upfront.Views.Editor.notify(h.not_all_added,"warning"),Upfront.Views.Editor.ImageSelector.close()})},addImages:function(e,t){var n=this,r=[],i=this.model.get_property_value_by_name("element_id");this.getNewLabels(_.keys(e)),_.each(e,function(e,t){var s=new d({id:t,srcFull:e.full[0],sizes:e,size:e.custom.editdata.resize,cropSize:e.custom.crop,cropOffset:e.custom.editdata.crop,src:e.custom.url,loading:!1,status:"ok",element_id:i,urlType:n.property("linkTo"),url:e.full[0]});s.set("imageLink",{type:n.property("linkTo"),url:s.get("url"),target:s.get("linkTarget")}),r.push(s)});if(n.property("status")!=="ok")n.property("status","ok"),n.property("has_settings",1),n.images.reset(r);else if(t){var s=n.images.get(t),o=n.images.indexOf(s);n.images.remove(t),n.images.add(r,{at:o})}else n.images.add(r);n.render()},showSelectType:function(){var t=this,n=e('<div class="upfront-ui ugallery-onclick"><div class="ugallery-onclick-dialog"><span>'+h.thumbnail_clicked+'</span><div class="ugallery-onclick-options"><a href="#" class="ugallery-lager_image" rel="image">'+h.show_larger+'</a><a href="#" class="ugallery-linked_page" rel="external">'+h.go_to_linked+"</a></div></div></div>");n.on("click","a",function(r){r.preventDefault();var i=e(r.target).attr("rel");t.property("linkTo",i,!1),_.each(t.images.models,function(e){e.set({urlType:i},{silent:!0})}),t.property("images",t.images.toJSON()),setTimeout(function(){n.fadeOut("fast",function(){n.remove(),t.render()})},100)}),0===this.$(".ugallery").find(".upfront-ui.ugallery-onclick").length&&this.$(".ugallery").append(n.hide()),n.fadeIn()},getNewLabels:function(e){var t={action:"upfront-media_get_image_labels",post_ids:e},n=this;Upfront.Util.post(t).done(function(e){var t=e.data;_.each(t,function(e,t){var r=[];r.push('"label_0"'),_.each(e,function(e){var t=Upfront.data.ugallery,i={id:e.term_id,text:e.name};t.label_names[e.name]||(t.label_names[e.name]=i),t.label_ids[e.term_id]||(t.label_ids[e.term_id]=i),n.isLabelInGallery(i)||n.labels.push(i),r.push('"label_'+e.term_id+'"')}),n.imageLabels[t]=r.join(", ")})})},isLabelInGallery:function(e){var t=this,n=!1,r=0;while(r<t.labels.length&&!n)n=t.labels[r].id===e.id,r++;return n},getCropOffset:function(e,t){var n=t.width/e.width>t.height/e.height?"height":"width",r=t[n]/e[n],i,s;return r>0?(i={width:Math.floor(t.width/r),height:Math.floor(t.height/r)},s={left:(i.width-e.width)/2,top:(i.height-e.height)/2}):(i=e,s={left:0,top:0}),{size:i,offset:s}},centeredPosition:function(e){var t={width:this.property("thumbWidth"),height:this.property("thumbHeight")};return{top:(t.height-e.height)/2/t.height*100,left:(t.width-e.width)/2/t.width*100}},checkRegenerateThumbs:function(e,t){var n=this;if(!t&&this.lastThumbnailSize.width===this.property("thumbWidth")&&this.lastThumbnailSize.height===this.property("thumbHeight"))return!1;var r={images:this.getRegenerateData(t),action:"upfront-media-image-create-size"},i=new Upfront.Views.Editor.Loading({loading:h.regenerating,done:h.regenerating_done,fixed:!1});i.render(),this.parent_module_view.$el.find(i.$el).length||this.parent_module_view.$el.append(i.$el),Upfront.Util.post(r).done(function(e){i.done();var t=e.data.images,s=[];_.each(r.images,function(e){var r=n.images.get(e.id),i=t[e.id];i.error||r.set({src:i.url,srcFull:i.urlOriginal,size:e.resize,cropPosition:{top:e.crop.top,left:e.crop.left}},{silent:!0}),s.push(r)}),n.images.set(s,{remove:!1}),n.imagesChanged(),n.render(),n.lastThumbnailSize={width:n.property("thumbWidth"),height:n.property("thumbHeight")}})},getRegenerateData:function(e){var t=this,n=this.property("thumbWidth")/this.lastThumbnailSize.width,r=this.property("thumbHeight")/this.lastThumbnailSize.height,i=n>r?n:r,s=[],o=this.images,u=this.model.get_property_value_by_name("element_id");return e&&(o=[],_.each(e,function(e){o.push(t.images.get(e))}),o=new v(o)),o.each(function(e){var n=e.get("size"),r=e.get("cropOffset"),o=Math.round(t.property("thumbHeight")/t.lastThumbnailSize.height*r.top),a=Math.round(t.property("thumbWidth")/t.lastThumbnailSize.width*r.left),f={id:e.id,rotate:e.get("rotation"),resize:{width:n.width*i,height:n.height*i},crop:{top:Math.round(r.top*i),left:Math.round(r.left*i),width:t.property("thumbWidth"),height:t.property("thumbHeight")},element_id:u};e.set("cropOffset",{left:a,top:o}),s.push(f)}),s},imageEditMask:function(t){var n=this,r=e(t.target).closest(".ugallery_item"),i=this.images.get(r.attr("rel")),s;if(i.get("status")!=="ok"){var o={multiple:!1,preparingText:h.preparing,element_id:this.model.get_property_value_by_name("element_id")};return Upfront.Views.Editor.ImageSelector.open(o).done(function(e){n.addImages(e);var t=n.images.indexOf(i);n.images.remove(i,{silent:!0});var r=n.images.at(n.images.length-1);n.images.remove(r,{silent:!0}),n.images.add(r,{at:t}),Upfront.Views.Editor.ImageSelector.close()})}s=this.getEditorOptions(i),t.preventDefault(),Upfront.Views.Editor.ImageEditor.open(s).done(function(e){i.set({src:e.src,srcFull:e.src,cropSize:e.cropSize,size:e.imageSize,cropOffset:e.imageOffset,margin:{left:Math.max(0-e.imageOffset.left,0),top:Math.max(0-e.imageOffset.top,0)},rotation:e.rotation}),n.render()}).fail(function(e){e&&e.reason==="changeImage"?n.openImageSelector(!1,e.id):n.render()})},getEditorOptions:function(e){var t=this.$(".ugallery_item[rel="+e.id+"] img"),n=e.get("sizes").full;return{id:e.id,maskSize:{width:t.width(),height:t.height()},maskOffset:t.offset(),position:e.get("cropOffset"),size:e.get("size"),fullSize:{width:n[1],height:n[2]},src:e.get("src"),srcOriginal:n[0],rotation:e.get("rotation"),element_id:this.model.get_property_value_by_name("element_id")}},imagesChanged:function(){this.property("images",this.images.toJSON()),this.rebindShuffle()},deleteLabel:function(e,t){var n=this,r=!0,i='"label_'+e+'"';this.imageLabels[t]=this.imageLabels[t].replace(new RegExp(i+",*","g"),""),this.images.each(function(i){i.id!==t&&n.imageLabels[i.id].indexOf('"label_'+e+'"')!==-1&&(r=!1)});if(r)for(var s in this.labels)this.labels[s]&&this.labels[s].id===e&&this.labels.splice(s,1)},addLabel:function(e,t){var n=Upfront.data.ugallery.label_names[e],r;return n?(r='"label_'+n.id+'"',this.addToGalleryLabels(n),this.associateLabelWithImage(t,r,n),n):this.createLabel(e,t)},associateLabelWithImage:function(e,t,n){var r,i=!1;this.imageLabels[e]?this.imageLabels[e].indexOf(t)===-1&&(this.imageLabels[e]+=", "+t,i=!0):(this.imageLabels[e]=t,i=!0);if(!i)return;r={action:"upfront-media-associate_label",term:n.id,post_id:e},Upfront.Util.post(r)},addToGalleryLabels:function(e){var t=!1,n=0,r=parseInt(e.id,10);while(n<this.labels.length&&!t)t=this.labels[n].id===r,n++;t||this.labels.push({id:r,text:e.text})},createLabel:function(t,n){var r=this,i=-parseInt(Math.random()*100,10),s,o;s={id:i,term_id:i,text:t},o={action:"upfront-media-add_label",term:t,post_id:n},Upfront.data.ugallery.label_names[t]=s,Upfront.data.ugallery.label_ids[i]=s,this.labels.push(s),this.imageLabels[n]=this.imageLabels[n]?this.imageLabels[n]+', "label_'+i+'"':'"label_'+i+'"';var u=e.Deferred();return Upfront.Util.post(o).success(function(e){var s=e.data[n],o=[],a=0,f={};_.each(s,function(e){o.push('"label_'+e+'"'),Upfront.data.ugallery.label_ids[e]||(a=e)}),o=o.join(", "),f={id:a,text:t},u.resolve(f),Upfront.data.ugallery.label_names[t]=f,Upfront.data.ugallery.label_ids[f.id]=f,delete Upfront.data.ugallery.label_ids[i],r.imageLabels[n]=o,_.each(r.labels,function(e){e.text===t&&(e.id=f.id)}),r.render()}),u.promise()},postTypes:function(){var e=[];return _.each(Upfront.data.ugallery.postTypes,function(t){t.name!=="attachment"&&e.push({name:t.name,label:t.label})}),e},getItemElement:function(t){return e(t.target).closest(".ugallery_item")},removeImage:function(t){var n=this,r=this.getItemElement(t);t.preventDefault(),r.fadeOut("fast",function(){var t=r.attr("rel");n.images.remove(t),n.imagesChanged(),n.images.length||(n.property("has_settings",0),n.property("status","starting"));var i=n.imageLabels[t].split(",");_.each(i,function(r){var i=e.trim(r.replace('"label_',"").replace('"',""));n.deleteLabel(i,t)}),n.imageLabels[t]="",n.render()})},activateSortable:function(){var t=this;this.$(".ugallery").sortable({items:"div.ugallery_item:not(.ugallery_addmore)",start:function(){t.$el.addClass("ugallery_sorting")},stop:function(){t.$el.removeClass("ugallery_sorting")},update:function(){t.sortOk()},change:function(){},delay:500,cancel:".ugallery-thumb-title"}),this.$(".ugallery_item_removing").removeClass("ugallery_item_removing"),this.$el.addClass("image-sorting-active"),this.$el.find(".toggle_sorting").addClass("sorting-active"),e("body").append(_.template(n,{element_id:this.model.get_property_value_by_name("element_id"),thumbPadding:this.model.get_property_value_by_name("thumbPadding"),even_padding:this.model.get_property_value_by_name("even_padding"),itemsInRow:this.itemsInRow}))},cleanupSortable:function(){this.$el.removeClass("image-sorting-active"),this.$el.find(".toggle_sorting").removeClass("sorting-active"),e("#sorting-style").length>0&&e("#sorting-style").remove()},sortOk:function(){var t=this.$(".ugallery_item"),n=[],r=this;_.each(t,function(t){var i=e(t).attr("rel");i&&n.push(r.images.get(i))}),this.images.reset(n)},activateLightbox:function(){var t=[];this.$(".ugallery_item").each(function(n,r){t.push({el:e(r),src:e(r).find("a.ugallery_link").attr("href")}),e(r).find(".upfront-icon-region-fullscreen").attr("href",e(r).find("a.ugallery_link").attr("href"))}),this.$(".ugallery").magnificPopup({gallery:{enabled:!0},type:"image",delegate:".upfront-icon-region-fullscreen",items:t})},startCaptionEditor:function(t){var n=e(t.target),r=n.hasClass("ugallery-thumb-title")?n:n.closest(".ugallery-thumb-title"),i;if(!r.length)return;r.data("ueditor")&&!r.data("ueditor").active?r.data("ueditor").start():(i=this.images.get(r.closest(".ugallery_item").attr("rel")),this.ensureCaptionEditorExists(r,i),r.data("ueditor").active||r.data("ueditor").start())},cleanup:function(){this.images.each(function(e){e.controls&&e.controls.remove()}),e("body").off("click",this.closeTooltip)},extract_properties:function(){var e={};return this.model.get("properties").each(function(t){e[t.get("name")]=t.get("value")}),e.preset=e.preset||"default",e},property:function(e,t,n){if(typeof t!="undefined"){typeof n=="undefined"&&(n=!0),this.model.set_property(e,t,n);return}return this.model.get_property_value_by_name(e)},getControlItems:function(){return _([this.createControl("add",h.template.add_img,"openImageSelector"),this.createControl("toggle-sorting",h.toggle_dnd,"toggleSorting"),this.createPaddingControl(),this.createControl("settings",h.settings,"on_settings_click")])},add_controls_to_item:function(t,n){var r=this.createControlsEach(t);return r.render(),n.find(".ugallery-controls").remove(),n.append(e('<div class="ugallery-controls upfront-ui"></div>').append(r.$el)),r}});Upfront.Application.LayoutEditor.add_object("Ugallery",{Model:o,View:m,Element:a,Settings:s,cssSelectors:{".ugallery":{label:h.css.container_label,info:h.css.container_info},".ugallery .ugallery_item":{label:h.css.elements_label,info:h.css.elements_info},".ugallery img.ugallery-image":{label:h.css.images_label,info:h.css.images_info},".ugallery .ugallery-thumb-title":{label:h.css.captions_label,info:h.css.captions_info},".ugallery .ugallery_labels":{label:h.css.lblcnt_label,info:h.css.lblcnt_info},".ugallery .ugallery_label_filter":{label:h.css.labels_label,info:h.css.labels_info}},cssSelectorsId:Upfront.data.ugallery.defaults.type}),Upfront.Models.UgalleryModel=o,Upfront.Views.UgalleryView=m})}(jQuery),define("text!elements/upfront-image/tpl/image.html",[],function(){return'<div <?php if($usingNewAppearance === true) { ?>class="<?php echo $preset ?>"<?php } ?>>\r\n	<?php if($usingNewAppearance === false) { ?>\r\n	<div class="uimage uimage-<?php echo $caption_position ?> uimage-status-<?php echo $image_status ?> uimage-caption-<?php echo $caption_position ?>-<?php echo $caption_alignment ?><?php echo $gifImage ?><?php echo $stretchClass ?> <?php echo $placeholder_class ?>" style="text-align: <?php echo $align ?>;">\r\n	<?php } else { ?>\r\n	<div class="upfront-image-wrapper uimage uimage-<?php echo $properties[\'caption-position\'] ?> uimage-status-<?php echo $image_status ?> uimage-caption-<?php echo $properties[\'caption-position\'] ?>-<?php echo $properties[\'caption-alignment\'] ?><?php echo $gifImage ?><?php echo $stretchClass ?> <?php echo $placeholder_class ?>" style="text-align: <?php echo $align ?>;">\r\n	<?php } ?>\r\n		<div class="upfront-image-caption-container" style="margin-top:<?php echo $marginTop ?>px">\r\n			<?php if($url && !$in_editor) { ?>\r\n			<a href="<?php echo $url ?>" target="<?php echo $link_target ?>">\r\n				<?php } ?>\r\n				<?php if($src){ ?>\r\n				<div class="upfront-image-container" <?php if ($containerWidth) { ?>style="width:<?php echo $containerWidth ?>px;"<?php } ?>>\r\n				<img src="<?php echo $src ?>" alt="<?php echo $alternative_text ?>" title="<?php echo $image_title ?>" <?php if($imgWidth) { ?>style="width:<?php echo $imgWidth ?>;"<?php } ?>/>\r\n		</div>\r\n		<?php } else { ?>\r\n		<div class="upfront-image-starting_placeholder"><p>Image placeholder</p></div>\r\n		<?php } ?>\r\n\r\n		<?php if($usingNewAppearance !== true) { ?>\r\n			<?php if($include_image_caption) { ?>\r\n				<div class="wp-caption uimage-<?php echo $caption_alignment ?> uimage-<?php echo $caption_trigger ?> uimage-padded-caption" style="background:<?php echo $captionBackground == \'1\' ? $background : \'rgba(255, 255, 255, 0)\' ?>; ">\r\n					<?php if($cover_caption) { ?>\r\n					<div class="uimage-caption-cover">\r\n						<?php } ?>\r\n						<?php echo $image_caption ?>\r\n						<?php if($cover_caption) { ?>\r\n					</div>\r\n					<?php } ?>\r\n				</div>\r\n			<?php } ?>\r\n		<?php } else { ?>\r\n		<?php if( !empty($properties[\'use_captions\']) && $display_caption === \'showCaption\' )  { ?>\r\n		<div class="wp-caption uimage-<?php echo $properties[\'caption-alignment\'] ?> uimage-<?php echo $properties[\'caption-trigger\'] ?> uimage-padded-caption">\r\n			<?php if($cover_caption) { ?>\r\n			<div class="uimage-caption-cover">\r\n				<?php } ?>\r\n				<?php echo $image_caption ?>\r\n				<?php if($cover_caption) { ?>\r\n			</div>\r\n			<?php } ?>\r\n		</div>\r\n		<?php } ?>\r\n		<?php } ?>\r\n\r\n		<?php if($url && !$in_editor) { ?>\r\n		</a>\r\n		<?php } ?>\r\n	</div>\r\n</div>\r\n</div>\r\n\r\n<?php if($gifImage){ ?>\r\n<style>\r\n	#<?php echo $element_id ?> .uimage-gif .upfront-image-container {\r\n		height: <?php echo $element_size[\'height\'] ?>px;\r\n		width: <?php echo $element_size[\'width\'] ?>px;\r\n	}\r\n\r\n	#<?php echo $element_id ?> .uimage-gif img {\r\n		   height: <?php echo $size[\'height\'] ?>px;\r\n		   width: <?php echo $size[\'width\'] ?>px !important;\r\n		   margin-top: <?php echo $gifTop ?>;\r\n		   margin-left: <?php echo $gifLeft ?>;\r\n	   }\r\n</style>\r\n<?php } ?>\r\n'}),define("text!elements/upfront-image/tpl/image_editor.html",[],function(){return'<div>\r\n<!--\r\n	Wrap everything in a div to convert this file\'s content in a jquery element\r\n	so it is possible to use $.find.\r\n-->\r\n\r\n<script type="text/template" id="selector-tpl">\r\n	<div id="upront-image-placeholder" class="upfront-image-section">\r\n		<div class="upfront-image-selector-container">\r\n\r\n			<h2>{{ l10n.drop_files }}</h2>\r\n			<p>{{ l10n.max_file_size }}</p>\r\n			<ul>\r\n				<li>\r\n					<a class="select-files" href="#">{{ l10n.select_files }}</a>\r\n				</li>\r\n				<!-- {{ l10n.or_browse }} -->\r\n				<li>\r\n					<a class="open-media-gallery" href="#">{{ l10n.media_gallery }}</a>\r\n				</li>\r\n			</ul>\r\n			<!-- <span class="dragimagehand"></span> -->\r\n\r\n		</div>\r\n	</div>\r\n</div>\r\n</script>\r\n\r\n<script type="text/template" id="progress-tpl">\r\n	<div id="upfront-image-uploading" class="upfront-image-section">\r\n		<h2>{{ l10n.uploading }}</h2>\r\n		<div class="upfront-progress-container">\r\n			<div id="upfront-progress"></div>\r\n		</div>\r\n	</div>\r\n</script>\r\n\r\n<script type="text/template" id="editor-tpl">\r\n	<div id="uimage-cover" style="position:absolute; top:{{maskOffset.top}}px; left:{{maskOffset.left}}px; height: {{maskSize.height}}px; width: {{maskSize.width}}px"></div>\r\n	<div id="uimage-canvas" style="position:absolute; overflow:hidden; top:{{offset.top}}px; left:{{offset.left}}px; height: {{size.height}}px; width: {{size.width}}px">\r\n		<img class="uimage-img {{ rotation }}" src="{{src}}" style="width:100%; height:100%; position:absolute">\r\n	</div>\r\n\r\n	<div id="uimage-mask" class="image-edit-mask" style="position:absolute; top:{{maskOffset.top}}px; left:{{maskOffset.left}}px; height: {{maskSize.height}}px; width: {{maskSize.width}}px"></div>\r\n\r\n	<div id="uimage-drag-handle" style="width:{{size.width}}px; height:{{size.height}}px;position:absolute; top:{{offset.top}}px; left:{{offset.left}}px">\r\n		<div class="image-edit-resize image-edit-control"><i class="ui-resizable-handle ui-resizable-handle-se"></i></div>\r\n		<!-- <div class="image-edit-rotate image-edit-control"><i class=""></i></div> -->\r\n	</div>\r\n\r\n	<div id="image-edit-buttons" style="position: absolute; top:{{maskOffset.top}}px; left: {{maskOffset.left + maskSize.width + 5}}px;">\r\n		{[ for (var i = 0; i < buttons.length; i++) { ]}\r\n		<a class="image-edit-button" id="{{buttons[i].id}}" title="{{buttons[i].tooltip}}">{{buttons[i].text}}</a>\r\n		{[ } ]}\r\n	</div>\r\n	<div id="image-edit-buttons-bottom" style="z-index: 11; position: absolute; top:{{maskSize.width < 200 ? maskOffset.top : maskOffset.top + maskSize.height + 5}}px; left:{{maskSize.width < 200 ? maskOffset.left - 205 : maskOffset.left}}px; width: 200px" class="{{maskSize.width < 200 ? \'image-edit-buttons-toleft\' : \'\' }}">\r\n		<a class="image-edit-button" id="image-edit-button-swap" title="Use a different image">Change IMG</a>\r\n		<a class="image-edit-button" id="image-edit-button-align" title="Align image" ></a>\r\n	</div>\r\n</script>\r\n\r\n<script type="text/template" id="upload-form-tpl">\r\n<form id="upfront-upload-image" name="upfront-upload-image" enctype="multipart/form-data" method="post" action="{{url}}" data-url="{{url}}?action=upfront-media-upload">\r\n	<input type="file" name="media" id="upfront-image-file-input" multiple >\r\n	<input type="hidden" name="action" value="upfront-media-upload">\r\n	<input type="submit" value="Upload">\r\n</form>\r\n</script>\r\n\r\n<script type="text/template" id="sizehint-tpl">\r\n	<b>w:</b>{{width}}{[ if(width.toString().indexOf("%") === -1){ ]}px{[ } ]}\r\n	<b>h:</b>{{height}}{[ if(height.toString().indexOf("%") === -1){ ]}px{[ } ]}\r\n</div>\r\n</script>\r\n\r\n<script type="text/template" id="fullwidth-alert-tpl">\r\n	<div class="uimage-fullwidth-alert">\r\n		<p>{{ l10n.move_image_nag }}</p>\r\n		<div class="clearfix">\r\n			<div class="uimage-fullwidth-info uimage-fullwidth-info-1"></div>\r\n			<div class="uimage-fullwidth-info uimage-fullwidth-info-2"></div>\r\n			<div class="uimage-fullwidth-info uimage-fullwidth-info-3"></div>\r\n		</div>\r\n		<div style="margin-top:10px">\r\n			<input class="upfront-field-checkbox" type="checkbox" id="uimage-fullwidth-noalert" value="1">\r\n			<label for="uimage-fullwidth-noalert">{{ l10n.dont_show_again }}</label>\r\n		</div>\r\n	</div>\r\n</div>\r\n</script>\r\n\r\n</div>\r\n'}),define("elements/upfront-image/js/context-menu/list",[],function(){var e=Upfront.Settings.l10n.image_element,t=Upfront.Views.ContextMenuList.extend({initialize:function(t){this.options=t,this.for_view=this.options.for_view;var n=this,r=[new Upfront.Views.ContextMenuItem({get_label:function(){return n.for_view.isThemeImage()?e.ctrl.edit_image:n.for_view.$el.find("div.upfront-image-container > img").length>0?e.ctrl.edit_image:e.ctrl.add_image},action:function(){if(n.for_view.isThemeImage()){n.for_view.replaceImage();return}n.for_view.$el.find("div.upfront-image-container > img").length>0?n.for_view.editRequest():n.for_view.openImageSelector()}})];this.for_view.$el.find("div.upfront-image-container > img").length>0&&r.push(new Upfront.Views.ContextMenuItem({get_label:function(){return n.for_view.$el.find("div.upfront-image-container div.wp-caption").length>0?e.ctrl.edit_caption:e.ctrl.add_caption},action:function(){n.for_view.$el.find("div.upfront-image-container > div.wp-caption").length>0?n.for_view.$el.find("div.upfront-image-container > div.wp-caption").data("ueditor").start():(n.for_view.controls.items.value()[2].selected="topOver",n.for_view.controls.items.value()[2].trigger("select"),n.for_view.property("include_image_caption",[1]),n.for_view.property("caption_position","over_image"),n.for_view.property("caption_alignment","top"),n.for_view.render())}})),this.menuitems=_(r)}});return t}),define("elements/upfront-image/js/image-context-menu",["elements/upfront-image/js/context-menu/list"],function(e){var t=Upfront.Views.ContextMenu.extend({initialize:function(t){this.options=t,this.for_view=this.options.for_view,this.menulists=_([new e({for_view:this.for_view})])}});return t}),define("text!elements/upfront-image/tpl/preset-style.html",[],function(){return"#page .<?php echo $properties['id'] ?> .upfront-image-caption-container .wp-caption p,\n#page .<?php echo $properties['id'] ?> .upfront-image-caption-container .wp-caption {\n	<?php if(!empty($properties['caption-text'])) { ?>\n	color: <?php echo $properties['caption-text']  ?>;\n	<?php } ?>\n}\n\n#page .<?php echo $properties['id'] ?> .upfront-image-caption-container .wp-caption {\n	<?php if(!empty($properties['caption-bg'])) { ?>\n	background: <?php echo $properties['caption-bg'] ?>;\n	<?php } ?>\n}\n\n#page .<?php echo $properties['id'] ?> .upfront-image-caption-container {\n	 <?php if(!empty($properties['useborder'])) { ?>\n        <?php if(!empty($properties['borderwidth']) && !empty($properties['bordertype']) && !empty($properties['bordercolor'])) { ?>border: <?php echo $properties['borderwidth'] ?>px <?php echo $properties['bordertype'] ?> <?php echo $properties['bordercolor'] ?>;<?php } ?>\n    <?php } else { ?>\n        border: none;\n    <?php } ?>\n}\n\n#page .<?php echo $properties['id'] ?> .upfront-image-caption-container {\n	<?php if(!empty($properties['useradius'])) { ?>\n        border-radius: <?php echo $properties['borderradius1'] ? $properties['borderradius1'] : 0 ?>px <?php echo $properties['borderradius2'] ? $properties['borderradius2'] : 0 ?>px <?php echo $properties['borderradius4'] ? $properties['borderradius4'] : 0 ?>px <?php echo $properties['borderradius3'] ? $properties['borderradius3'] : 0 ?>px;\n    <?php } else { ?>\n        border-radius: 0px;\n    <?php } ?>\n	overflow: hidden;\n}\n\n/* Custom CSS */\n<?php if(!empty($properties['preset_style'])) { ?><?php echo $properties['preset_style'] ?><?php } ?>\n"}),define("elements/upfront-image/js/image-settings",["scripts/upfront/preset-settings/util","scripts/upfront/element-settings/settings","text!elements/upfront-image/tpl/preset-style.html"],function(e,t,n){var r=Upfront.Settings.l10n.image_element,i=t.extend({panels:{Appearance:{mainDataCollection:"imagePresets",styleElementPrefix:"image-preset",ajaxActionSlug:"image",panelTitle:r.settings,presetDefaults:Upfront.mainData.presetDefaults.image,styleTpl:n,stateModules:{Global:[{moduleType:"Selectbox",options:{state:"global",default_value:"default",title:r.settings.image_style_label,custom_class:"image_style",label:r.settings.image_style_info,fields:{name:"imagestyle"},values:[{label:"Default",value:"default"},{label:"Square",value:"square"}]}},{moduleType:"Radius",options:{state:"global",max_value:100,fields:{use:"useradius",lock:"borderradiuslock",radius:"radius",radius_number:"radius_number",radius1:"borderradius1",radius2:"borderradius2",radius3:"borderradius3",radius4:"borderradius4"}}},{moduleType:"CaptionLocation",options:{state:"global",fields:{caption:"image-caption"}}},{moduleType:"Colors",options:{title:r.settings.content_area_colors_label,multiple:!1,single:!1,abccolors:[{name:"caption-text",label:r.settings.caption_text_label},{name:"caption-bg",label:r.settings.caption_bg_label}]}},{moduleType:"Border",options:{state:"global",title:"",fields:{use:"useborder",width:"borderwidth",type:"bordertype",color:"bordercolor"}}}]},migrateElementStyle:function(e,t){return e=e.replace(/\.upfront-image/g,".upfront-image-wrapper"),e=e.replace(/\.upfront-image-wrapper-container/g,".upfront-image-container"),e},migrateDefaultStyle:function(e){return e=e.replace(/(div)?\.upfront-image\s/g,""),e=e.replace(/(div)?\.upfront-object\s/g,""),e},migratePresetProperties:function(e){var t={},n=captionValue="";this.model.get("properties").each(function(e){t[e.get("name")]=e.get("value")}),t.caption_position&&t.caption_trigger&&(n="yes"),t.caption_position==="over_image"&&t.caption_alignment==="top"?captionValue="topOver":t.caption_position==="over_image"&&t.caption_alignment==="bottom"?captionValue="bottomOver":t.caption_position==="over_image"&&t.caption_alignment==="fill"?captionValue="topCover":t.caption_position==="over_image"&&t.caption_alignment==="fill_middle"?captionValue="middleCover":t.caption_position==="below_image"&&t.caption_alignment==="fill_bottom"?captionValue="bottomCover":captionValue="below",e.set({use_captions:n,"caption-position-value":captionValue,"caption-position":t.caption_position,"caption-alignment":t.caption_alignment,"caption-trigger":t.caption_trigger,"caption-bg":t.background})},getModifiedProperties:function(){var e={};return this.model.get("properties").each(function(t){e[t.get("name")]=t.get("value")}),typeof e.theme_style!="undefined"&&e.theme_style!=="_default"&&e.theme_style!==""&&e.theme_style!==" "?!0:typeof e.caption_position!="undefined"&&e.caption_position!==!1||typeof e.caption_alignment!="undefined"&&e.caption_alignment!==!1||typeof e.caption_trigger!="undefined"&&e.caption_trigger!=="always_show"?!0:typeof e.background!="undefined"&&e.background!=="#000000"?!0:!1}}},title:r.settings.label});return e.generatePresetsToPage("image",n),i}),function(e){define("elements/upfront-image/js/image-selector",["text!elements/upfront-image/tpl/image_editor.html"],function(t){var n=Upfront.Settings.l10n.image_element,r=Backbone.View.extend({selectorTpl:_.template(e(t).find("#selector-tpl").html()),progressTpl:_.template(e(t).find("#progress-tpl").html()),formTpl:_.template(e(t).find("#upload-form-tpl").html()),deferred:e.Deferred(),defaultOptions:{multiple:!1,multiple_sizes:!0,preparingText:n.sel.preparing},options:{},initialize:function(){this.setup_upload_form()},setup_upload_form:function(){var t=this;if(e("#upfront-upload-image").length===0){e("body").append(t.formTpl({url:Upfront.Settings.ajax_url,l10n:n.template})),e("body").bind("keyup",function(e){e.keyCode===27&&t.closeOverlay()});var r=e("#upfront-progress"),i=e("#upfront-image-file-input"),s=e("#upfront-upload-image");!s.fileupload||s.fileupload({sequentialUploads:!0,formData:_.extend({action:"upfront-media-upload"},Upfront.Media.Ref),fileInput:null,paramName:"media[]"}).bind("fileuploadstart",function(){r.css("width","0")}).bind("fileuploadprogressall",function(e,t){var n=parseInt(t.loaded/t.total*100,10);r.css("width",n+"%")}).bind("fileuploaddone",function(i,o){var u=o.result;r.css("width","100%"),e("#upfront-image-uploading h2").html(n.sel.preparing),Upfront.Views.Editor.ImageEditor.getImageData(u.data,t.options.customImageSize).done(function(e){t.deferred.resolve(e.data.images,e)}).error(function(){Upfront.Views.Editor.notify(n.sel.upload_error,"error"),t.openSelector()}),s[0].reset()}).bind("fileuploadfail",function(e,n){var r=n.jqXHR.responseJSON.error;Upfront.Views.Editor.notify(r,"error"),t.openSelector(),s[0].reset()}),i.on("change",function(){this.files.length&&(XMLHttpRequest&&(new XMLHttpRequest).upload?t.uploadImage(this.files):t.openProgress(function(){s.fileupload("add",{fileInput:i})}))})}},open:function(t){return this.deferred=e.Deferred(),_.isObject(t)||(t={}),this.options=_.extend({},this.defaultOptions,t),this.openSelector(),Upfront.Events.trigger("upfront:element:edit:start","media-upload"),this.deferred.promise()},openSelector:function(){var t=this;this.openOverlaySection(this.selectorTpl,{},function(){var n=e("#upfront-image-file-input");t.options.multiple===!0?(n.attr("multiple","multiple"),n.attr("name","media[]")):(n.attr("multiple",!1),n.removeAttr("multiple"),n.attr("name","media")),e("#upront-image-placeholder").on("dragenter",function(e){e.preventDefault(),e.stopPropagation()}).on("dragleave",function(t){t.preventDefault(),t.stopPropagation(),e(this).css("border-color","#C3DCF1"),e(this).css("background","none")}).on("dragover",function(t){t.preventDefault(),t.stopPropagation(),e(this).css("border-color","#1fcd8f"),e(this).css("background","rgba(255,255,255,.1)"),e(this).find()}).on("drop",function(e){var n;e.preventDefault(),e.stopPropagation(),e.originalEvent.dataTransfer&&(n=e.originalEvent.dataTransfer.files,n.length&&t.uploadImage(n))}),t.resizeOverlay()})},openProgress:function(e){var t=this;this.openOverlaySection(this.progressTpl,{},function(){t.resizeOverlay(),e()})},resizeOverlay:function(){var t=e("#upfront-image-overlay");if(!t.length)return;var n=e("#upront-image-placeholder"),r=e("#upfront-image-uploading"),i={},s=e("#sidebar-ui").width(),o={left:s,width:e(window).width()-s,height:e(window).height()},u=o.height/2-220;Upfront.Util.isRTL()&&(delete o.left,o.right=s),u>0?(t.removeClass("small_placeholder"),u+="px"):(t.addClass("small_placeholder"),u=o.height/2-140+"px"),t.css(o),i={height:o.height-100,"padding-top":u},n.css(i),r.css(i)},close:function(){this.closeOverlay()},cancelOverlay:function(e){e.target===e.currentTarget&&this.closeOverlay(e)},closeOverlay:function(){e("#upfront-image-overlay").off("click").fadeOut("fast",function(){e(this).remove(),e("#upfront-image-overlay").remove()}),e("html").css({overflow:this.bodyOverflow?this.bodyOverflow:"auto",height:"auto",width:"auto"}),e("body").removeClass("upfront-image-upload-open"),this.reopenSettings&&(e("#settings").fadeIn(),this.reopenSettings=!1),e(window).off("resize",this.resizeOverlay),Upfront.Events.trigger("upfront:element:edit:stop")},openOverlaySection:function(t,r,i){var s=this,o=e("#settings"),u=e("#upfront-image-overlay");r.l10n=n.template;if(u.length){e(".upfront-image-section").fadeOut("fast",function(){var n=e(t(r)).hide();u.append(n),n.fadeIn("fast"),e(this).remove(),i&&i(u)});return}this.bodyOverflow=e("html").css("overflow"),e("html").css({overflow:"hidden",width:e(window).width()+"px",height:e(window).height()+"px"}),u=e('<div id="upfront-image-overlay" class="upfront-ui"></div>').append(t(r)).hide(),e("body").append(u).addClass("upfront-image-upload-open"),this.setOverlayEvents(),u.fadeIn("fast"),this.resizeOverlay(),e(window).on("resize",function(e){e.target===window&&s.resizeOverlay()}),o.is(":visible")&&(o.fadeOut(),this.reopenSettings=!0),i&&i(u)},setOverlayEvents:function(){var t=this;e("#upfront-image-overlay").on("click",function(e){t.cancelOverlay(e)}).on("click","a.select-files",function(e){t.openFileBrowser(e)}).on("click","a.image-edit-change",function(e){t.openImageSelector(e)}).on("click","a.open-media-gallery",function(e){t.openMediaGallery(e)})},openMediaGallery:function(t){var n=this,r={multiple_selection:this.options.multiple,multiple_sizes:this.options.multiple_sizes,media_type:["images"]};t.preventDefault(),Upfront.Media.Manager.open(r).done(function(t,r){if(r&&r.length>0){var i=[];r.each(function(e){i.push(e.get("ID"))}),Upfront.Views.Editor.ImageEditor.getImageData(i,n.options.customImageSize,n.options.element_id).done(function(e){n.deferred.resolve(e.data.images,e)}),n.openProgress(function(){e("#upfront-image-uploading h2").html(n.options.preparingText)})}})},openFileBrowser:function(t){t.preventDefault(),e("#upfront-image-file-input").click()},checkFileUpdate:function(){return!0},uploadImage:function(t){var n=this;n.setup_upload_form(),this.openProgress(function(){e("#upfront-upload-image").fileupload("send",{files:t})})}});return r})}(jQuery),function(e){define("elements/upfront-image/js/image-editor",["text!elements/upfront-image/tpl/image_editor.html"],function(t){var n=Upfront.Settings.l10n.image_element,r=Upfront.Views.breakpoints_storage.get_breakpoints().get_active().get("column_padding");r=parseInt(r,10),r=_.isNaN(r)?15:r;var i=Backbone.View.extend({id:"upfront-image-edit",rotation:0,mode:"big",invert:!1,tpl:_.template(e(t).find("#editor-tpl").html()),src:"#",bordersWidth:0,response:!1,fullSize:{width:0,height:0},buttons:[],sizes:!1,events:{"click #image-edit-button-ok":"imageOk","click #image-edit-button-reset":"image100","click #image-edit-button-fit":"fitImage","click #image-edit-button-align":"selectAlign","click .image-fit-element-button":"fitMask","click #image-edit-button-swap":"changeImage"},initialize:function(){var t=this;this.$el.on("click",function(e){e.target===e.currentTarget&&(t.saveOnClose?t.imageOk():!t.isResizing&&!t.isDragged&&t.cancel()),t.isResizing=!1,t.isDragged=!1}),e("body").bind("keyup",function(e){e.keyCode===27&&"undefined"!=typeof t.element_id&&t.close()})},resetDefaults:function(){this.rotation=0,this.mode="big",this.invert=!1,this.src="#",this.fullSize={width:0,height:0},this.setImageInitialSize=!1,this.buttons=[{id:"image-edit-button-fit",text:n.btn.fit_label,tooltip:n.btn.fit_info},{id:"image-edit-button-reset",text:n.btn.exp_label,tooltip:n.btn.exp_info},{id:"image-edit-button-ok",text:n.btn.save_label,tooltip:n.btn.save_info}],this.sizes=!1,this.align="left",this.saveOnClose=!1,this.elementSize=!1,this.fitImageButton=!0},centerImageOffset:function(e,t){return{top:-(e.height-t.height)/2,left:-(e.width-t.width)/2}},open:function(t){t.maskSize&&t.editElement&&t.editElement.elementSize&&t.maskSize.height<t.editElement.elementSize.height&&t.editElement.elementSize.height<t.fullSize.height&&(t.maskSize.width=t.editElement.elementSize.width+2,t.maskSize.height=t.editElement.elementSize.height),this.resetDefaults(),this.options=t,this.src=t.src,this.saveOnClose=t.saveOnClose,t.maskOffset.top+=this.fixImageTop(t.maskOffset),this.setOptions(t);var r=this.maybeResizeElement(t);if(r)return t.position={top:0,left:0},t.maskSize=r.maskSize,t.size=r.imageSize,t.setImageSize=!1,t.align="left",t.resizedElement=!0,this.open(t);this.options.editElement||(this.buttons=[{id:"image-edit-button-ok",text:n.btn.save_label,tooltip:n.btn.save_info}]);var i=this.bordersWidth/2,s={top:parseInt(t.maskOffset.top,10)-i,left:parseInt(t.maskOffset.left,10)-i},o={width:parseInt(t.maskSize.width,10)+this.bordersWidth,height:parseInt(t.maskSize.height,10)+this.bordersWidth};t.position||(t.position=this.centerImageOffset(t.size,o));var u={top:parseInt(s.top,10)-t.position.top+i,left:parseInt(s.left,10)-t.position.left+i},a={width:parseInt(t.size.width,10),height:parseInt(t.size.height,10)};this.imageId=t.id,this.src=t.srcOriginal,this.fullSize=t.fullSize,t.align&&(this.align=t.align);if(this.setImageInitialSize){var f=this.getFullWidthImage();a=f.size,u.left=f.left}else t.imageFit&&(a=this.initialImageSize(0,!1,o));var l={size:a,offset:u,maskOffset:s,rotation:"rotate_"+this.rotation,src:this.src,maskSize:o,buttons:this.buttons,fitMask:t.fitMaskColumns};return this.$el.html(this.tpl(l)).find("div").hide(),this.$el.closest("body").length||(this.response=e.Deferred(),e("body").append(this.$el)),this.addGridLines(s.top,o.height),this.$el.css({height:e(document).height(),width:e(document).width()}).find("div").fadeIn(200),this.selectMode(a),this.startEditorUI(),this.selectMode(a,!0),this.setImageSize(a),this.$("#image-edit-button-align").addClass("align-"+this.align),this.setImageInitialSize&&this.resetImage(!1,!1),t.editElement&&this.check100ButtonActivation(),this.response.promise()},setOptions:function(e){var t=this;typeof e.rotation!="undefined"?this.setRotation(e.rotation):this.setRotation(0),e.setImageSize&&(this.setImageInitialSize=!0),e.extraButtons&&e.extraButtons.length&&_.each(e.extraButtons,function(e){t.buttons.push({id:e.id,text:e.text}),t.$el.off("click","#"+e.id).on("click","#"+e.id,function(n){e.callback(n,t)})}),this.element_id=e.element_id||!1},check100ButtonActivation:function(){var e=this.getFullWidthImage(this.options.fullSize).size,t=this.getCurrentImageRowsCols(e.width,e.height),r=this.$("#image-edit-button-reset");this.elementSize.columns===t.columns&&this.elementSize.rows===t.rows?r.addClass("deactivated expanded").attr("title",n.image_expanded):this.elementSize.columns===this.elementSize.maxColumns&&this.elementSize.columns<t.columns&&this.elementSize.rows===t.rows&&r.addClass("deactivated").attr("title",n.cant_expand)},maybeResizeElement:function(e,t){if(!e.editElement)return!1;var n=e.editElement,i={maxColumns:n.get_element_max_columns(),maxRows:n.get_element_max_rows(),rowHeight:r};i.maxRows||(i.maxRows=n.get_element_rows()),i.columnWidth=n.get_element_max_columns_px()/i.maxColumns,i.rows=Math.round(e.maskSize.height/r)+2,i.columns=Math.ceil(e.maskSize.width/i.columnWidth),this.elementSize=i;if(!e.setImageSize)return!1;var s=this.getFullWidthImage(e.fullSize).size,o=this.getCurrentImageRowsCols(s.width,s.height),u={width:o.columns*this.elementSize.columnWidth-2*r,height:(o.rows-2)*this.elementSize.rowHeight};if(o.columns>i.columns||o.rows>i.rows)return!1;if(!t)u={width:Math.max(o.columns,i.columns)*i.columnWidth-2*r,height:(Math.min(o.rows,i.rows)-2)*r};else if(this.elementSize.maxColumns<o.columns){var a=this.elementSize.maxColumns*this.elementSize.columnWidth-2*r;u={width:a,height:s.height}}return{maskSize:u,imageSize:s}},imageOk:function(){var e=this.getEditorResults(),t=this,r=new Upfront.Views.Editor.Loading({loading:n.saving,done:n.saving_done,fixed:!1}),i=this.$("#uimage-mask");e.imageId&&(r.render(),i.append(r.$el),this.saveImageEdition(e.imageId,e.rotation,e.imageSize,{top:e.imageOffset.top,left:e.imageOffset.left,width:e.maskSize.width,height:e.maskSize.height}).done(function(n){var i=n.data.images[e.imageId];r.done();if(i.error){Upfront.Views.Editor.notify("Image failed to process. "+i.msg,"error",15e3),t.close();return}e.src=i.url,e.srcFull=i.urlOriginal,e.cropSize=i.crop,e.gif=i.gif||0,t.options.resizedElement&&(e.elementSize=t.getCurrentMaskRowsCols()),t.response.resolve(e),t.close()}))},close:function(e){var t=this;this.unfixImageTop(),this.$("div").fadeOut(200,function(){t.$el.detach()}),this.options=!1,t.response.reject({reason:e,id:this.imageId})},cancel:function(e){this.close(e)},changeImage:function(e){e.preventDefault(),this.close("changeImage")},getEditorResults:function(){var e=this.$("#uimage-canvas"),t=e.find("img"),n=this.$("#uimage-mask"),r=t.attr("src"),i=this.bordersWidth/2;return{imageSize:{width:Math.round(this.invert?t.height():t.width()),height:Math.round(this.invert?t.width():t.height())},imageOffset:{top:n.offset().top-e.offset().top+i,left:n.offset().left-e.offset().left+i},maskSize:{width:n.width(),height:n.height()},rotation:this.rotation,imageId:this.imageId,fullSize:this.fullSize,srcOriginal:r,align:this.align,stretch:this.mode==="big"||this.mode==="horizontal",vstretch:this.mode==="big"||this.mode==="vertical",mode:this.mode}},rotate:function(t){var n=this.rotation,r=this.$(".uimage-img"),i="",s={width:r.width(),height:r.height()},o=this.$("#uimage-canvas"),u=this.$("#uimage-drag-handle");t&&(t.preventDefault(),t.stopPropagation()),n=n===270?0:n+90,n&&(i="rotate_"+n),r.removeClass().addClass("uimage-img "+i),this.setRotation(n),this.invert?(o.css({height:s.width,width:s.height}),u.css({height:s.width,width:s.height}),r.css({height:s.height,width:s.width})):(o.css(s),u.css(s),r.css({height:"100%",width:"100%"})),r.css(this.imgOffset({width:r.width(),height:r.height()})),this.selectMode({width:o.width(),height:o.height()}),e("#uimage-drag-handle").draggable("option","containment",this.getContainment()),this.setResizingLimits()},setRotation:function(e){this.rotation=e,this.invert=[90,270].indexOf(e)!==-1},imgOffset:function(e){return this.invert?{top:Math.floor((e.width-e.height)/2),left:Math.floor((e.height-e.width)/2)}:{top:0,left:0}},startEditorUI:function(){var t=this,r=this.$("#uimage-canvas");e("#uimage-drag-handle").resizable({handles:{se:e(".image-edit-resize i")},autoHide:0,aspectRatio:!0,start:function(){t.$("#image-edit-button-reset").attr("class","image-edit-button").attr("title",n.btn.exp_info),t.isResizing=!0},resize:function(e,n){r.css(n.size),t.setImageSize(n.size)},stop:function(n,i){var s=t.$("#uimage-drag-handle");n.preventDefault();var o={width:t.invert?i.size.height:i.size.width,height:t.invert?i.size.width:i.size.height},u=t.fullSize.width/Math.floor(o.width),a;o={width:Math.floor(o.width),height:Math.round(t.fullSize.height/u)},a={width:t.invert?o.height:o.width,height:t.invert?o.width:o.height},r.css(a),s.css(a),t.selectMode(a,!0),t.setImageSize(a),(t.mode==="small"||t.mode==="vertical")&&t.centerImage(!1),e("#uimage-drag-handle").draggable("option","containment",t.getContainment())}}).draggable({opacity:1,start:function(){t.isDragged=!0},drag:function(e,t){r.css({top:t.position.top,left:t.position.left})},stop:function(e,n){r.css({top:n.position.top,left:n.position.left}),t.setResizingLimits()},containment:t.getContainment()}),t.setResizingLimits()},addGridLines:function(e,t){var n=r,i=t-this.bordersWidth,s=this.bordersWidth/2;while(s<=i+n)this.$el.append('<div class="gridline" style="position: absolute;width: 100%; height: 0; top:'+(e+s)+'px"></div>'),s+=n},selectMode:function(e,t){var n="small",r=this.$("#uimage-mask"),i={width:r.width(),height:r.height()};e.width>=i.width?e.height>=i.height?n="big":n="horizontal":e.height>=i.height&&(n="vertical"),this.setMode(n,t)},setMode:function(t,n){var r=e("#uimage-drag-handle"),i=(t==="small"||t==="vertical")&&t!==this.mode;this.$el.removeClass("uimage-mode-big uimage-mode-small uimage-mode-vertical uimage-mode-horizontal uimage-mode-tiny").addClass("uimage-mode-"+t),(r.width()<40||r.height()<40)&&this.$el.addClass("uimage-mode-tiny"),this.mode=t,n&&(this.mode==="horizontal"||this.mode==="small"?r.draggable("option",{snap:".gridline",snapMode:"outer",snapTolerance:6}):r.draggable("option",{snap:!1})),i&&this.centerImage(!1)},setImageSize:function(e){if(this.invert){var t={width:e.height,height:e.width};this.$(".uimage-img").css(t).css(this.imgOffset(t))}},getContainment:function(){var e=this.$("#uimage-canvas"),t=this.$("#uimage-mask"),n=t.offset(),r=this.bordersWidth/2;if(this.mode==="big")return[n.left-e.width()+t.width()+r,n.top-e.height()+t.height()+r,n.left+r,n.top+r];if(this.mode==="horizontal")return[n.left-e.width()+t.width()+r,n.top,n.left+r,n.top-e.height()+t.height()];var i=this.align==="left"?n.left:this.align==="right"?n.left+t.width()-e.width():n.left+(t.width()-e.width())/2;return i+=r,this.mode==="vertical"?[i,n.top-e.height()+t.height()+r,i,n.top+r]:[i,n.top,i,n.top-e.height()+t.height()]},setResizingLimits:function(){var t=this.$("#uimage-canvas"),n=this.$("#uimage-mask"),i=n.offset(),s={minWidth:r,minHeight:r};this.mode==="big"&&(s={minWidth:n.width()+i.left-t.offset().left+this.bordersWidth,minHeight:n.height()+i.top-t.offset().top+this.bordersWidth}),e("#uimage-drag-handle").resizable("option",s)},resetImage:function(e,t){e&&(e.preventDefault(),e.stopPropagation()),this.setRotation(270),this.rotate(),this.setImageFullSize(e,t),this.centerImage(!0)},image100:function(t){if(e(t.target).hasClass("deactivated")){if(e(t.target).hasClass("expanded"))return;return this.showExpandAlert()}var n=this.getFullWidthImage().size,r=this.getCurrentImageRowsCols(n.width,n.height),i=r;if(this.elementSize.maxColumns<r.columns){var s=n.height;i={columns:this.elementSize.maxColumns,rows:Math.ceil(s/this.elementSize.rowHeight)+2}}i.columns=this.elementSize.maxColumns;if(i.columns!==this.elementSize.columns||i.rows!==this.elementSize.rows)this.resizeMask(i.columns,i.rows);else{var o=this.$("#uimage-mask").offset();n.top=o.top,n.left=o.left,this.$("#uimage-canvas").css(n),this.$("#uimage-drag-handle").css(n)}i.columns!==22&&r.columns>i.columns&&this.showExpandAlert()},getCurrentImageRowsCols:function(e,t){var n=this.$("#uimage-canvas"),i=e?e:n.width(),s=t?t:n.height();return{rows:Math.ceil(s/this.elementSize.rowHeight)+2,columns:Math.ceil((i+2*r)/this.elementSize.columnWidth)}},getCurrentMaskRowsCols:function(){var e=this.$("#uimage-mask");return this.getCurrentImageRowsCols(e.width(),e.height())},showExpandAlert:function(){if(this.ignoreFullwidthAlert)return;var r=this;Upfront.Popup.open(function(){},{width:320},"warning_img").progress(function(t){t==="before_close"&&(r.ignoreFullwidthAlert=e("#upfront-popup-content").find("input:checked").length)}),e("#upfront-popup-content").append(_.template(e(t).find("#fullwidth-alert-tpl").html(),{l10n:n.template}))},resizeMask:function(e,t){var n=this.options;n.maskSize={width:this.elementSize.columnWidth*e-2*r,height:this.elementSize.rowHeight*(t-2)},n.size=this.getFullWidthImage().size,n.position={left:0,top:0},n.setImageSize=!1,n.resizedElement=!0,this.open(n)},fitImage:function(t){t.preventDefault(),t.stopPropagation();if(!this.fitImageButton){var r=e("#image-edit-button-fit");return r.text(n.btn.fit_element),this.fitImageButton=!0,this.resetImage()}var i=this.$("#uimage-canvas"),s=this.$("#uimage-mask"),o=this.$("#uimage-drag-handle"),u=this.getResizeImageDimensions(this.fullSize,{width:s.width(),height:s.height()},"inner",0);this.invert&&(u={width:u.height,height:u.width}),i.css(u),o.css(u),this.setImageSize(u),this.centerImage(!0),this.selectMode(u,!0),this.centerImage(!0),this.setResizingLimits(),e("#uimage-drag-handle").draggable("option","containment",this.getContainment()),e("#image-edit-button-fit").attr("title",n.btn.restore_label).text(n.btn.restore_info),e("#image-edit-button-reset").attr("class","image-edit-button").attr("title",n.btn.exp_info),this.fitImageButton=!1},fitMask:function(){var t=e("#uimage-canvas"),n=e("#uimage-mask"),i=Math.round((n.width()+2*r)/this.options.fitMaskColumns),s={width:t.width(),height:t.height()},o=r,u=Math.ceil((s.width+2*r)/i),a={height:Math.ceil(s.height/o)*o,width:u*i-2*r},f=this.options;f.position={top:0,left:0},f.size=s,f.maskSize=a,f.align="left",f.setImageSize=!1,f.rotation=this.rotation,f.elementColumns=u,this.open(f)},setImageFullSize:function(t){t&&t.preventDefault();var n=this.$(".uimage-img"),r=this.$("#uimage-mask"),i=this.$("#uimage-canvas"),s=this.$("#uimage-drag-handle"),o=this.initialImageSize(100,!1,{width:r.width(),height:r.height()});i.css(o),s.css(o),n.css({height:"100%",width:"100%"}),this.selectMode(o,!0),this.setResizingLimits(),e("#uimage-drag-handle").draggable("option","containment",this.getContainment())},centerImage:function(e){var t=this.$("#uimage-canvas"),n=this.$("#uimage-mask"),r=this.$("#uimage-drag-handle"),i=this.bordersWidth/2,s={top:t.offset().top};e&&(s.top=n.offset().top-(t.height()-n.height())/2+i),this.mode!=="vertical"&&this.mode!=="small"||this.align==="center"?s.left=n.offset().left-(t.width()-n.width())/2:this.align==="left"?s.left=n.offset().left:s.left=n.offset().left+n.width()-t.width(),s.left+=i,t.css(s),r.css(s)},getFullWidthImage:function(t){var n=e(document.querySelector(".upfront-grid-layout")),i=n.width()-2*r,s=t||this.fullSize;if(this.options&&this.options.editElement){var o=this.options.editElement.$el;n=o.parents(".upfront-grid-layout"),i=n.width()-2*r}return s.width>i&&(s={width:i,height:Math.round(s.height/(s.width/i))}),{size:s,left:n.offset().left+r}},initialImageSize:function(e,t,n){var r=this.$("#uimage-mask"),i={width:0,height:0},s=n?n:{width:r.width(),height:r.height()},o,u,a,f=!!t;return e=e?e:0,o=s.width/s.height<this.fullSize.width/this.fullSize.height?"height":"width",a=this.invert?o==="width"?"height":"width":o,u=this.fullSize[o]/(s[a]+e),!f&&u<1?i=this.fullSize:i={width:Math.ceil(this.fullSize.width/u),height:Math.ceil(this.fullSize.height/u)},i},getResizeImageDimensions:function(e,t,n,r){var i=e.width/e.height,s=t.width/t.height,o=n&&n==="outer"?"outer":"inner",u=o==="inner"?i>s?"width":"height":i>s?"height":"width",a=r||0,f=t[u]+a,l=f/e[u];return{width:Math.round(e.width*l),height:Math.round(e.height*l)}},getImageData:function(e,t,n){var r={action:"upfront-media-image_sizes",item_id:JSON.stringify(e),element_id:n};return t&&(r.customSize=t),Upfront.Util.post(r)},saveImageEdition:function(e,t,n,r){var i={action:"upfront-media-image-create-size",images:[{element_id:this.element_id,id:e,rotate:t,resize:n,crop:r}]};return Upfront.Util.post(i)},selectAlign:function(){this.align==="left"?this.setAlign("center"):this.align==="center"?this.setAlign("right"):this.align==="right"&&this.setAlign("left")},setAlign:function(e){var t=this.$("#uimage-mask"),n=this.$("#uimage-canvas"),r=this.$("#uimage-drag-handle"),i=n.position();this.$("#image-edit-button-align").removeClass("align-left align-right align-center").addClass("align-"+e);if(e!=="left"&&e!=="center"&&e!=="right")return!1;this.align=e,this.align==="center"?i.left=t.offset().left-(n.width()-t.width())/2:this.align==="left"?i.left=t.offset().left:i.left=t.offset().left+t.width()-n.width(),i.left+=this.bordersWidth/2,n.css(i),r.css(i),this.$("#uimage-drag-handle").draggable("option","containment",this.getContainment())},keyMove:function(e){switch(e.which){case 40:this.maskOffset.top--,this.positionEditorElements();break;case 39:this.maskOffset.left--,this.positionEditorElements();break;case 37:this.maskOffset.left++,this.positionEditorElements();break;case 38:this.maskOffset.top++,this.positionEditorElements()}},fixImageTop:function(t){if(t&&typeof t.top!="undefined"&&t.top<120){var n=e("body").css("marginTop");n=parseInt(n.replace("px",""),10);if(!isNaN(n))return this.fixTop=120-t.top,e("body").css("marginTop",n+this.fixTop),this.fixTop}return 0},unfixImageTop:function(){if(this.fixTop){var t=e("body").css("marginTop");t=parseInt(t.replace("px",""),10),isNaN(t)||e("body").css("marginTop",t-this.fixTop),this.fixTop=0}}});return i})}(jQuery),define("elements/upfront-image/js/model",[],function(){var e=Upfront.Models.ObjectModel.extend({init:function(){var e=_.clone(Upfront.data.uimage.defaults);e.element_id=Upfront.Util.get_unique_id(e.id_slug),e.image_caption="<p>$s</p>".replace("$s",e.image_caption),this.init_properties(e)}});return e}),define("elements/upfront-image/js/image-element",["elements/upfront-image/js/model"],function(e){var t=Upfront.Settings.l10n.image_element,n=Upfront.Views.Editor.Sidebar.Element.extend({priority:20,render:function(){this.$el.addClass("upfront-icon-element upfront-icon-element-image"),this.$el.html(t.element_name)},add_element:function(){var t=new e,n=new Upfront.Models.Module({name:"",properties:[{name:"element_id",value:Upfront.Util.get_unique_id("module")},{name:"class",value:"c24 upfront-image_module"},{name:"has_settings",value:0},{name:"row",value:Upfront.Util.height_to_row(255)}],objects:[t]});this.add_module(n)}});return n}),function(e){define("uimage",["text!elements/upfront-image/tpl/image.html","text!elements/upfront-image/tpl/image_editor.html","elements/upfront-image/js/image-context-menu","elements/upfront-image/js/image-settings","elements/upfront-image/js/image-selector","elements/upfront-image/js/image-editor","elements/upfront-image/js/image-element","scripts/upfront/link-model","elements/upfront-image/js/model","text!elements/upfront-image/tpl/preset-style.html","scripts/upfront/preset-settings/util"],function(t,n,r,i,s,o,u,a,f,l,c){var h=Upfront.Settings.l10n.image_element,p=Upfront.Views.breakpoints_storage.get_breakpoints().get_active().get("column_padding");p=parseInt(p,10),p=_.isNaN(p)?15:p;var d=Upfront.Views.ObjectView.extend({model:f,imageTpl:Upfront.Util.template(t),sizehintTpl:_.template(e(n).find("#sizehint-tpl").html()),cropTimeAfterResize:1,display_size_hint:!1,resizingData:{},initialize:function(){var t=this;this.setDefaults(),this.model instanceof f||(this.model=new f({properties:this.model.get("properties")})),this.events=_.extend({},this.events,{"click a.upfront-image-select":"openImageSelector","click div.upfront-quick-swap":"openImageSelector","dblclick .wp-caption":"editCaption","click a":"handleLinkClick","click .swap-image-overlay":"openImageSelector"}),this.delegateEvents(),this.bodyEventHandlers={dragover:function(e){e.preventDefault(),t.handleDragEnter(e)},dragenter:function(e){t.handleDragEnter(e)},dragleave:function(e){t.handleDragLeave(e)}},e("body").on("dragover",this.bodyEventHandlers.dragover).on("dragenter",this.bodyEventHandlers.dragenter).on("dragleave",this.bodyEventHandlers.dragleave).on("drop",this.bodyEventHandlers.drop),this.property("image_id")||this.property("srcFull",this.property("src")),this.listenTo(this.model.get("properties"),"change",this.update),this.listenTo(this.model.get("properties"),"add",this.update),this.listenTo(this.model.get("properties"),"remove",this.update),this.listenTo(this.model,"uimage:edit",this.editRequest),this.property("image_status")!=="ok"||this.property("quick_swap")||this.isThemeImage()&&!Upfront.themeExporter?this.property("has_settings",0):this.property("has_settings",1),this.listenTo(Upfront.Events,"upfront:element:edit:start",this.on_element_edit_start),this.listenTo(Upfront.Events,"upfront:element:edit:stop",this.on_element_edit_stop),this.listenTo(Upfront.Events,"command:layout:save",this.saveResizing),this.listenTo(Upfront.Events,"command:layout:save_as",this.saveResizing),this.listenTo(Upfront.Events,"preset:image:updated",this.caption_updated,this),this.listenTo(Upfront.Events,"upfront:layout_size:change_breakpoint",function(e){e.id!=="desktop"?this.setMobileMode():this.unsetMobileMode()}),this.property("link")===!1?(this.link=new a({type:this.property("when_clicked"),url:this.property("image_link"),target:this.property("link_target")}),this.property("link",this.link.toJSON())):this.link=new a(this.property("link")),t.listenTo(this.link,"change",function(){t.property("link",t.link.toJSON())}),this.listenTo(Upfront.Events,"entity:module:update",this.on_uimage_update),this.listenTo(this.model,"preset:updated",this.preset_updated)},get_preset_properties:function(){var e=this.model.get_property_value_by_name("preset"),t=c.getPresetProperties("image",e)||{};return t},get_preset_property:function(e){var t=this.model.get_property_value_by_name("preset"),n=c.getPresetProperties("image",t)||{};return n[e]},preset_updated:function(e){this.render(),Upfront.Events.trigger("preset:image:updated",e)},caption_updated:function(e){var t=this.model.get_property_value_by_name("preset");t===e&&this.render()},update_colors:function(){var e=this.get_preset_properties();if(_.size(e)<=0)return!1;c.updatePresetStyle("gallery",e,l)},setDefaults:function(){this.sizes=!1,this.elementSize={width:0,height:0},this.imageId=0,this.imageSize={width:0,height:0},this.imageOffset={top:0,left:0},this.maskOffset={top:0,left:0},this.imageInfo=!1,this.controls=!1,this.editor=!1,this.temporaryProps={size:!1,position:!1},this.cropTimer=!1,this.stoppedTimer=!1},getSelectedAlignment:function(){if(!this.property("include_image_caption")&&this.get_preset_property("caption-position")===!1&&this.property("caption_alignment")===!1)return"nocaption";if(this.get_preset_property("caption-position")==="below_image")return"below";var e=this.property("caption_alignment");switch(e){case"top":return"topOver";case"bottom":return"bottomOver";case"fill":return"topCover";case"fill_middle":return"middleCover";case"fill_bottom":return"bottomCover"}return"nocaption"},isThemeImage:function(){return this.property("srcFull")&&this.property("srcFull").match("wp-content/themes/")},replaceImage:function(){this.openImageSelector()},createLinkControl:function(){var e=this,t=new Upfront.Views.Editor.InlinePanels.DialogControl,n;return t.view=n=new Upfront.Views.Editor.LinkPanel({model:this.link,linkTypes:{image:!0},imageUrl:this.property("srcFull")}),this.listenTo(t,"panel:ok",function(){n.model.get("type")=="lightbox"&&n.$el.find(".js-ulinkpanel-lightbox-input").val()!=""&&n.createLightBox(),t.close(),this.render()}),this.listenTo(t,"panel:open",function(){e.$el.closest(".ui-draggable").draggable("disable"),_.delay(function(){e.controls.$el.parent().parent().addClass("upfront-control-visible")},1e3)}),e.listenTo(t,"panel:close",function(){e.controls.$el.parent().parent().removeClass("upfront-control-visible"),e.$el.closest(".ui-draggable").draggable("enable")}),t.icon="link",t.tooltip=h.ctrl.image_link,t.id="link",t},postTypes:function(){var e=[];return _.each(Upfront.data.ugallery.postTypes,function(t){t.name!=="attachment"&&e.push({name:t.name,label:t.label})}),e},editCaption:function(){var t=this,n=e("#"+this.property("element_id")).find(".wp-caption");n.find(".uimage-caption-cover").length&&(n=n.find(".uimage-caption-cover"));if(n.data("ueditor")||!n.length)return;n.ueditor({autostart:!1,focus:!1,upfrontMedia:!1,upfrontImages:!1,linebreaks:!1,airButtons:["upfrontFormatting","bold","italic","stateAlign","upfrontLink","upfrontColor","upfrontIcons"]}).on("start",function(){t.$el.addClass("upfront-editing")}).on("stop",function(){t.$el.removeClass("upfront-editing"),t.render()}).on("syncAfter",function(){t.property("image_caption",n.html())})},createControl:function(e,t,n){var r=this,i=new Upfront.Views.Editor.InlinePanels.Control;return i.icon=e,i.tooltip=t,n&&this.listenTo(i,"click",function(e){r[n](e)}),i},setImageInfo:function(){var e,t,n=this.$(".upfront-image-starting-select"),r=this.temporaryProps.size,i=this.temporaryProps.position,s=this.get_preset_property("caption-position")==="below_image"?this.$(".wp-caption").outerHeight():0;n.length?(e={width:n.outerWidth(),height:n.outerHeight()},t=n.offset(),i=!1):(n=this.$(".uimage"),e={width:n.width(),height:n.height()-s},t={top:n.offset().top,left:n.offset().left}),this.imageInfo={id:this.property("image_id"),src:this.property("src"),srcFull:this.property("srcFull"),srcOriginal:this.property("srcOriginal"),size:r,position:i,rotation:this.property("rotation"),fullSize:this.property("fullSize"),align:this.property("align"),maskSize:e,maskOffset:t}},isSmallImage:function(){var e=this.property("element_size");return this.resizingData.data&&this.resizingData.data.elementSize&&(e=this.resizingData.data.elementSize),e.width<100||e.height<50},disableCaption:function(){this.property("include_image_caption",!1)},enableCaption:function(){this.property("include_image_caption",!0)},hasCaptionPosition:function(){return this.property("usingNewAppearance")===!0?this.get_preset_property("caption-position")!==!1||this.property("caption_alignment")!==!1:this.property("include_image_caption")},setupBySize:function(){this.isSmallImage()?(this.disableCaption(),this.parent_module_view.$el.addClass("uimage-small")):this.hasCaptionPosition()&&this.enableCaption(),this.isSmallImage()||this.parent_module_view.$el.removeClass("uimage-small")},get_content_markup:function(){var t=this.property("element_size"),n=this,r=this.extract_properties(),i,s,o,u,a;this.setupBySize();if(!this.temporaryProps||!this.temporaryProps.size)this.temporaryProps={size:r.size,position:r.position};r=this.extract_properties(),r.properties=this.get_preset_properties(),r.url=this.property("when_clicked")?this.property("image_link"):!1,r.url=this.link.get("type")!=="unlink"?this.link.get("url"):!1,r.link_target=this.link.get("target"),r.size=this.temporaryProps.size,r.position=this.temporaryProps.position,r.marginTop=Math.max(0,-r.position.top),r.in_editor=!0,r.cover_caption=this.get_preset_property("caption-position")!=="below_image",r.stretch?(r.imgWidth="100%",r.stretchClass=" uimage-stretch"):(r.imgWidth=r.size.width+"px",r.stretchClass=""),r.containerWidth=Math.min(r.size.width,t.width),r.display_caption=this.property("display_caption")?this.property("display_caption"):"showCaption",r.gifImage="",r.gifLeft=0,r.gifTop=0,r.l10n=h.template,r.usingNewAppearance=r.usingNewAppearance||!1,r.usingNewAppearance&&(r.image_caption=r.image_caption.replace(/^<span style=".+?"/,"<span ")),i=this.imageTpl(r);if(this.property("quick_swap"))s=r.element_size.width<150||r.element_size.height<90?"uimage-quick-swap-small":"",i+='<div class="upfront-quick-swap '+s+'"><p>Change this image</p></div>';else if(this.property("image_status")==="starting")i='<div class="upfront-image-starting-select upfront-ui" style="height:'+r.element_size.height+'px"><div class="uimage-centered">'+'<span class="upfront-image-resizethiselement">'+h.ctrl.add_image+'</span><div class=""><a class="upfront-image-select" href="#" title="'+h.ctrl.add_image+'">+</a></div>'+"</div></div>";else{o=e("<div></div>").append(i),u=r.size,a=o.find("img"),r=this.temporaryProps;var f=this.update_style();f&&(t=f,u=this.temporaryProps.size),o.find(".upfront-image-container").css({overflow:"hidden",position:"relative",width:Math.min(t.width,u.width),height:Math.min(t.height,u.height)}),a.attr("src",n.property("srcFull")).css({width:u.width,height:u.height,position:"absolute",top:Math.min(0,-r.position.top),left:Math.min(0,-r.position.left),"margin-top":0,"max-height":"none","max-width":"none"}),i=o.html()}return i},toggle_caption_controls:function(){var e=this,t=new Upfront.Views.Editor.InlinePanels.Panel;t.items=this.getControlItems(),t.render(),_.delay(function(){e.controls.$el.html(t.$el),e.updateControls()},400)},getElementShapeSize:function(e){var t=this.$el.find(".upfront-image-container"),n=this.get_preset_properties(),r={};return n.imagestyle==="square"?(r.height=e.width,r.width=e.width,e.width!==e.height?r.defaultHeight=e.height:e.defaultHeight&&(r.defaultHeight=e.defaultHeight),r):e.defaultHeight?(r={width:e.width,height:e.defaultHeight},r):!1},update_style:function(){var e=this.property("element_size"),t=this.getElementShapeSize(e);if(!1!==t){if(e.width!=t.width||e.height!=t.height)this.resizeImage(t)||this.property("element_size",t);return t}return!1},on_render:function(){var t=this,n=["bottom","fill_bottom"].indexOf(this.property("caption_alignment"))!==-1||this.get_preset_property("caption-position")==="below_image"?" sizehint-top":"",r=this.property("element_size");this.parent_module_view.$el.data("resizeHandling")||this.parent_module_view.$el.data("resizeHandling",!0),this.property("when_clicked")==="lightbox"&&this.$("a").addClass("js-uimage-open-lightbox");var i=this.update_style();i&&(r=i);if(this.isThemeImage()&&!Upfront.themeExporter)this.$el.addClass("image-from-theme"),this.$el.find("b.upfront-entity_meta").after('<div class="swap-image-overlay"><p class="upfront-icon upfront-icon-swap-image"><span>Click to </span>Swap Image</p></div>');else{var s=e("<div>").addClass("upfront-ui uimage-resize-hint"+n);this.$el.append(s),setTimeout(function(){t.applyElementSize()},300)}if(this.property("image_status")!=="ok"){var o=this.$(".upfront-image-starting-select");this.elementSize.height||(this.setElementSize(),o.height(this.elementSize.height));return}if(this.property("quick_swap"))return!1;setTimeout(function(){t.updateControls(),t.$el.removeClass("upfront-editing"),t.editCaption()},300),this.mobileMode&&(this.$(".uimage").addClass("uimage-mobile-mode"),this.setMobileMode()),this.setStuckToTop(),setTimeout(function(){t.$el.closest(".ui-draggable").on("dragstop",function(){setTimeout(function(){t.setStuckToTop()},10)}),t.$el.closest(".upfront-module-view").addClass("uimage-upfront-module-view")},100),setTimeout(function(){t.toggleResizableHandles()},100),this.toggle_caption_controls()},toggleResizableHandles:function(){var e=this.$el.parents(".upfront-objects_container");this.isThemeImage()&&!Upfront.themeExporter?e.siblings(".ui-resizable-handle").addClass("ui-resizable-handle-hidden"):e.siblings(".ui-resizable-handle").removeClass("ui-resizable-handle-hidden")},setStuckToTop:function(){this.$el.offset().top+this.parent_module_view.$el.offset().top<25?this.$el.addClass("stuck-to-top"):this.$el.removeClass("stuck-to-top")},updateControls:function(){var e='<div class="upfront-element-controls upfront-ui"></div>';if(this.paddingControl&&typeof this.paddingControl.isOpen!="undefined"&&this.paddingControl.isOpen)return;this.controls=this.createControls();if(this.controls===!1)return;this.controls.render();if(!this.$control_el||this.$control_el.length===0)this.$control_el=this.$el;this.$control_el.find(">.upfront-element-controls").length===0&&this.$control_el.append(e),this.$control_el.find(">.upfront-element-controls").html("").append(this.controls.$el),this.updateAdvancedPadding(),this.controls.delegateEvents()},on_edit:function(){return!1},extract_properties:function(){var e={};return this.model.get("properties").each(function(t){e[t.get("name")]=t.get("value")}),e.preset=e.preset||"default",e},handleDragEnter:function(){var t=this;return},handleDragLeave:function(){var e=this;this.dragTimer=setTimeout(function(){e.$(".uimage-drop-hint").remove(),this.dragTimer=!1},200)},setMobileMode:function(){var e=this.extract_properties();this.mobileMode=!0,this.$el.find(".uimage-resize-hint").hide().end().find(".uimage").css("min-height","none").find(".upfront-image-caption-container").css("width","100%").end().find(".upfront-image-container").css("width","100%").css("height","auto").end().find("img").css({position:"static",maxWidth:"100%",width:e.stretch?"100%":e.size.width,height:"auto"}).attr("src",this.property("src"))},unsetMobileMode:function(){this.mobileMode=!1,this.parent_module_view&&this.render()},updateBreakpointPadding:function(e){var t=this.$el.find(".upfront-image");return t.css("padding")!==""?parseInt(t.css("padding"),10):e},on_element_resize_start:function(e){if(this.mobileMode)return;var t=this.$(".upfront-image-starting-select");this.get_preset_property("caption-position")!=="below_image"&&this.$(".wp-caption").fadeOut("fast"),this.resizingData={starting:t,data:{position:this.property("position"),size:this.property("size"),stretch:this.property("stretch"),vstretch:this.property("vstretch")},img:this.$("img"),setTextHeight:this.get_preset_property("caption-position")==="below_image"},this.cropTimer&&(clearTimeout(this.cropTimer),this.cropTimer=!1);if(t.length)return;this.$(".upfront-image-caption-container, .upfront-image-container").css({width:"100%",height:"100%",marginTop:0}),this.$(".uimage").css("min-height","auto")},on_element_resizing:function(e){if(this.mobileMode)return;var t=this.resizingData.starting,n=this.resizingData.data,r=this.resizingData.img,i=this.get_preset_property("caption-position")==="below_image"?this.$(".wp-caption").outerHeight():0,s=Upfront.Settings.LayoutEditor.Grid.column_padding,o=parseInt(this.model.get_breakpoint_property_value("left_padding_num")||s)+parseInt(this.model.get_breakpoint_property_value("right_padding_num")||s),u=parseInt(this.model.get_breakpoint_property_value("top_padding_num")||s)+parseInt(this.model.get_breakpoint_property_value("bottom_padding_num")||s),a,f;n.elementSize={width:parseInt(e.width)-o,height:parseInt(e.height)-u-i},f=this.getElementShapeSize(n.elementSize),!1!==f&&(n.elementSize=f),this.applyElementSize();if(t.length)return t.outerHeight(n.elementSize.height);this.$(".uimage").css("height",n.elementSize.height),this.updateControls(),this.setupBySize()},on_element_resize:function(e){if(this.mobileMode)return;if(!this.resizingData||!this.resizingData.img||!this.resizingData.img.length)return;var t=this.resizingData.starting,n=this,r=this.resizingData.img,i={width:r.width(),height:r.height()},s=r.position(),o=this.property("no_padding")==1?0:this.updateBreakpointPadding(p);if(t.length){this.elementSize={height:e.height-2*o,width:e.width-2*o},this.property("element_size",this.elementSize);return}if(this.isThemeImage())return;this.on_element_resizing(e),s.top=-s.top,s.left=-s.left,this.temporaryProps={size:i,position:s},this.property("element_size",this.resizingData.data.elementSize),this.cropTimer=setTimeout(function(){n.saveTemporaryResizing()},this.cropTimeAfterResize),this.resizingData={},this.showCaption()},on_uimage_update:function(e){if(!this.parent_module_view||this.parent_module_view!=e)return;this.applyElementSize()},showCaption:function(){this.$(".wp-caption").fadeIn("fast")},resizingH:function(e,t,n){var r=t.elementSize.width,i=n?t.size.width:e.width(),s=t.position.left,o={},u;if(t.stretch){r<i-s?(o.left=-s,n&&(o.width=i)):i>r&&r>=i-s?(o.left=r-i,n&&(o.width=i)):(o.left=0,n&&(o.width=r)),n&&(o.height="auto"),e.css(o);return}if(r>i){u=this.property("align"),u==="left"?o.left=0:u==="center"?o.left=(r-i)/2:(o.left="auto",o.right=0),n&&(o.width=i,o.height="auto"),e.css(o);return}o.left=0,n&&(o.width=r,o.height="auto"),e.css(o)},resizingV:function(e,t,n){var r=t.elementSize.height,i=n?t.size.height:e.height(),s=t.position.top,o={};if(t.vstretch){r<i-s?(o.top=-s,n&&(o.height=i)):i>r&&r>=i-s?(o.top=r-i,n&&(o.height=i)):(o.top=0,n&&(o.height=r)),n&&(o.width="auto"),e.css(o);return}r>i-s?(o.top=-s,n&&(o.height=i)):i-s>=r&&r>i?(o.top=r-i,n&&(o.height=i)):(o.top=0,n&&(o.height=r)),n&&(o.width="auto"),e.css(o)},saveTemporaryResizing:function(){var t=this,n=t.property("element_size"),r={},i=t.property("image_id"),s=t.temporaryProps.size,o=t.temporaryProps.position,u=e.Deferred(),a=e.Deferred(),f=a.promise();return r.top=o.top,r.left=o.left,r.width=Math.min(n.width,s.width),r.height=Math.min(n.height,s.height),f.done(function(){i=t.property("image_id"),Upfront.Views.Editor.ImageEditor.saveImageEdition(i,t.property("rotation"),s,r).done(function(e){var r=e.data.images[i];if(r.error){Upfront.Views.Editor.notify(h.process_error,"error");return}t.property("size",s),t.property("position",o),t.property("src",r.url),t.property("srcFull",r.urlOriginal,!1),t.property("stretch",s.width>=n.width),t.property("vstretch",s.height>=n.height),t.property("gifImage",r.gif),clearTimeout(t.cropTimer),t.cropTimer=!1,u.resolve()})}),this.isThemeImage&&"themeExporter"in Upfront?this.importImage().always(function(){a.resolve()}):a.resolve(),u.promise()},saveResizing:function(){var e=this;this.cropTimer&&(clearTimeout(this.cropTimer),this.cropTimer=!1,this.saveTemporaryResizing().done(function(){var t={element:JSON.stringify(Upfront.Util.model_to_json(e.model)),action:"upfront_update_layout_element"};Upfront.Util.post(t)}))},resizeImage:function(e){var t=this.$("img"),n,r,i;return t.length>0?(n={position:this.property("position"),size:this.property("size"),stretch:this.property("stretch"),vstretch:this.property("vstretch"),elementSize:e},n.stretch&&!n.vstretch?(this.resizingH(t,n,!0),this.resizingV(t,n)):!n.stretch&&n.vstretch?(this.resizingV(t,n,!0),this.resizingH(t,n)):(ratio=n.size.width/n.size.height-n.elementSize.width/n.elementSize.height,ratio>0&&n.stretch||ratio<0&&!n.stretch?(this.resizingV(t,n,!0),this.resizingH(t,n)):(this.resizingH(t,n,!0),this.resizingV(t,n))),r={width:t.width(),height:t.height()},i=t.position(),i.top=-i.top,i.left=-i.left,this.temporaryProps={size:r,position:i},this.property("element_size",e),this.saveTemporaryResizing(),!0):!1},setElementSize:function(t){var n=this,r=this.parent_module_view.$(".upfront-editable_entity:first"),i=t?e(".upfront-resize"):r,s=this.property("no_padding")==1?0:this.updateBreakpointPadding(p);n.elementSize={width:i.width()-2*s+2,height:i.height()-2*s},this.get_preset_property("caption-position")==="below_image"&&(this.elementSize.height-=r.find(".wp-caption").outerHeight()),this.property("image_status")==="starting"&&this.$(".upfront-object-content").height(n.elementSize.height)},applyElementSize:function(e,t){var n=this,r=this.parent_module_view.$(".upfront-editable_entity:first"),i=r,s=this.get_preset_property("caption-position")==="below_image"?this.$(".wp-caption").outerHeight():0,o=parseInt(this.$el.find(".upfront-image-caption-container").css("borderWidth")||0,10),u=Upfront.Settings.LayoutEditor.Grid.column_padding,a=parseInt(this.model.get_breakpoint_property_value("left_padding_num")||u)+parseInt(this.model.get_breakpoint_property_value("right_padding_num")||u),f=parseInt(this.model.get_breakpoint_property_value("top_padding_num")||u)+parseInt(this.model.get_breakpoint_property_value("bottom_padding_num")||u),l={width:(e&&!isNaN(e)?e:i.width())-a,height:(t&&!isNaN(t)?t:i.height())-f-s-2*o};this.property("element_size",l),this.$el.find(".uimage-resize-hint").html(this.sizehintTpl({width:l.width,height:l.height,l10n:h.template}))},openImageSelector:function(t){var n=this;t&&t.preventDefault&&t.preventDefault(),Upfront.Views.Editor.ImageSelector.open({multiple_sizes:!1}).done(function(t){var r={};_.each(t,function(e,t){r=e,n.imageId=t});var i={src:r.medium?r.medium[0]:r.full[0],srcFull:r.full[0],srcOriginal:r.full[0],fullSize:{width:r.full[1],height:r.full[2]},size:r.medium?{width:r.medium[1],height:r.medium[2]}:{width:r.full[1],height:r.full[2]},position:!1,rotation:0,id:n.imageId};e("<img>").load(function(){Upfront.Views.Editor.ImageSelector.close(),n.openEditor(!0,i)}).on("error",function(){Upfront.Views.Editor.ImageSelector.close(),Upfront.Views.Editor.notify(h.process_error,"error")}).attr("src",i.srcFull)})},handleEditorResult:function(e){this.property("image_status","ok",!0),this.property("has_settings",1),this.property("src",e.src,!0),this.property("srcFull",e.srcFull,!0),this.property("srcOriginal",e.srcOriginal,!0),this.property("size",e.imageSize,!0),this.property("position",e.imageOffset,!0);var t=e.mode==="horizontal"||e.mode==="small"?e.imageOffset.top*-1:0;this.property("marginTop",t,!0),this.property("rotation",e.rotation,!0),this.property("fullSize",e.fullSize,!0),this.property("element_size",e.maskSize,!0),this.property("align",e.align,!0),this.property("stretch",e.stretch,!0),this.property("vstretch",e.vstretch,!0),this.property("quick_swap",!1,!0),e.imageId&&this.property("image_id",e.imageId,!0),this.property("gifImage",e.gif),this.temporaryProps=!1,this.render(),e.elementSize&&this.set_element_size(e.elementSize.columns,e.elementSize.rows,"all",!0)},editRequest:function(){var e=this;if(this.property("image_status")==="ok"&&this.property("image_id")){this.isThemeImage()&&"themeExporter"in Upfront?this.importImage().always(function(){e.openEditor()}):this.openEditor();return}Upfront.Views.Editor.notify(h.external_nag,"error")},getElementColumns:function(){var e=this.$el.closest(".upfront-module"),t,n=!1;return e.length?(t=e.attr("class").split(" "),_.each(t,function(e){e.match(/^c\d+$/)&&(n=e.replace("c",""))}),n||-1):-1},openEditor:function(e,t){if(Upfront.Application.responsiveMode!=="desktop")return Upfront.Views.Editor.notify(h.desktop_nag,"error");var n=this,r={setImageSize:e,saveOnClose:e,editElement:this};this.setElementSize(),this.setImageInfo(),t?_.extend(r,this.imageInfo,t):_.extend(r,this.imageInfo),this.cropTimer&&(this.stoppedTimer=!0,clearTimeout(this.cropTimer),this.cropTimer=!1),r.element_id=n.model.get_property_value_by_name("element_id"),Upfront.Views.Editor.ImageEditor.open(r).done(function(e){n.handleEditorResult(e),this.stoppedTimer=!1}).fail(function(e){e&&e.reason==="changeImage"?n.openImageSelector():n.stoppedTimer&&(n.saveTemporaryResizing(),n.stoppedTimer=!1)})},handleLinkClick:function(e){var t;if(this.link.get("type")!=="lightbox")return;e.preventDefault(),t=this.link.get("url").substring(1),Upfront.Application.LayoutEditor.openLightboxRegion(t)},importImage:function(){var t=this,n=this.property("image_id"),r={action:"upfront-media-image-import",images:[{element_id:this.property("element_id"),id:n,src:this.property("srcFull")}]},i=e.Deferred();return Upfront.Util.post(r).done(function(e){var r=e.data.images;if(n in r){var s=r[n].status;if(s=="imported")t.property("image_id",r[n].id),t.property("srcFull",r[n].src),t.property("srcOriginal",r[n].src);else if(s=="exists")t.property("image_id",r[n].id);else if(s=="fail"){i.reject();return}i.resolve(t.property("image_id"));return}i.reject()}),i.promise()},cleanup:function(){this.controls&&this.controls.remove()},property:function(e,t,n){return typeof t!="undefined"?(typeof n=="undefined"&&(n=!0),this.model.set_property(e,t,n)):this.model.get_property_value_by_name(e)},getControlItems:function(){var e=this,t=new Upfront.Views.Editor.InlinePanels.ControlPanel,n=new Upfront.Views.Editor.InlinePanels.TooltipControl;n.sub_items={nocaption:this.createControl("nocaption",h.ctrl.no_caption),showCaption:this.createControl("showCaption",h.ctrl.show_caption)},n.icon="caption",n.tooltip=h.ctrl.caption_position,n.selected=this.property("display_caption"),this.listenTo(n,"select",function(t){switch(t){case"showCaption":e.property("display_caption","showCaption");break;default:e.property("display_caption","nocaption")}e.render()});var r=_([this.createControl("crop",h.ctrl.edit_image,"editRequest"),this.createLinkControl(),n,this.createPaddingControl(),this.createControl("settings",Upfront.Settings.l10n.global.views.settings,"on_settings_click")]);return"yes"!==this.get_preset_property("use_captions")&&(r=_(r.without(n))),r}});Upfront.Application.LayoutEditor.add_object("Uimage",{Model:f,View:d,Element:u,Settings:i,ContextMenu:r,cssSelectors:{".upfront-image-wrapper":{label:h.css.image_label,info:h.css.image_info},".wp-caption":{label:h.css.caption_label,info:h.css.caption_info},".upfront-image-container":{label:h.css.wrapper_label,info:h.css.wrapper_info}},cssSelectorsId:Upfront.data.uimage.defaults.type}),Upfront.Views.Editor.ImageEditor=new o,Upfront.Views.Editor.ImageSelector=new s,Upfront.Models.UimageModel=f,Upfront.Views.UimageView=d})}(jQuery),function(e){define("upfront-like-box",["scripts/upfront/element-settings/settings","scripts/upfront/element-settings/root-settings-panel"],function(t,n){var r=Upfront.Settings.l10n.like_box_element,i=Upfront.Models.ObjectModel.extend({init:function(){var e=_.clone(Upfront.data.ulikebox.defaults);e.element_id=Upfront.Util.get_unique_id(e.id_slug+"-object"),this.init_properties(e)}}),s=Upfront.Views.ObjectView.extend({model:i,elementSize:{width:0,height:0},initialize:function(e){this.model instanceof i||(this.model=new i({properties:this.model.get("properties")})),this.constructor.__super__.initialize.call(this,[e]),this.listenTo(Upfront.Events,"entity:resize_start",this.hideFrame),this.listenTo(Upfront.Events,"entity:resize_stop",this.onElementResize)},on_element_resize_start:function(e){this.hideFrame(this,this.model)},on_element_resize:function(e){this.onElementResize(this,this.model)},setUrl:function(){this.property("facebook_url",Upfront.data.social.panel.model.get_property_value_by_name("global_social_media_services-facebook-url"))},hideFrame:function(e,t){this.parent_module_view==e&&this.$el.find("iframe").css("display","none")},showFrame:function(){var e=this.$el.find("iframe");e.is(":visible")||e.show()},onElementResize:function(e,t){this.setElementSize(),this.showFrame()},setElementSize:function(){var e=this,t=this.parent_module_view.$(".upfront-editable_entity:first");if(t.length&&t.height()){this.elementSize.height=t.height();var n=e.get_element_size_px(!1);n.row===0&&(n.row=t.height()),n.col!=0&&e.property("element_size",{width:n.col,height:n.row})}},property:function(e,t){return typeof t!="undefined"?this.model.set_property(e,t):this.model.get_property_value_by_name(e)},events:function(){return _.extend({},Upfront.Views.ObjectView.prototype.events,{"click a.back_global_settings":"backToGlobalSettings"})},backToGlobalSettings:function(e){e.preventDefault(),Upfront.data.social.panel.popupFunc()},getGlobalFBUrl:function(){if(!Upfront.data.usocial.globals)return!1;var e=Upfront.data.usocial.globals.services,t=!1;return _(e).each(function(e){e.id=="facebook"&&(t=e.url)}),t},get_content_markup:function(){var e=this,t=this.model.get_property_value_by_name("facebook_url");if(t){var n=t.split("/"),i=_.last(n);_.isEmpty(i)&&(n.splice(n.length-1,1),i=_.last(n));var s=this.model.get_property_value_by_name("element_size").width-30;s>500&&(s=500);var o=this.model.get_property_value_by_name("hide_cover")=="yes"?"true":"false",u=this.model.get_property_value_by_name("show_friends")=="yes"?"true":"false",a=this.model.get_property_value_by_name("small_header")=="yes"?"true":"false",f=this.model.get_property_value_by_name("show_posts")=="yes"?"true":"false";return'<iframe src="//www.facebook.com/v2.5/plugins/page.php?adapt_container_width=true&amp;container_width='+s+"&amp;width="+s+"&amp;height="+(this.model.get_property_value_by_name("element_size").height-30)+"&amp;hide_cover="+o+"&amp;href=https%3A%2F%2Fwww.facebook.com%2F"+(i?i:"wpmudev")+"&amp;show_facepile="+u+"&amp;show_posts="+f+"&amp;small_header="+a+'" scrolling="no" frameborder="0" style="border:none; display:block; overflow:hidden; margin:auto; width:'+s+"px; height:"+(this.model.get_property_value_by_name("element_size").height-30)+'px;"" allowTransparency="true"></iframe><div class="upfront-like-box_overlay"></div>'+(i?"":'<span class="alert-url">!</span>')}return this.model.set_property("facebook_url","",!0),'<div class="upfront-likebox-overlay upfront-initial-overlay-wrapper" style="min-height: 200px;"><div class="upfront-like-box_placeholder upfront-initial-overlay-wrapper" style="height: 150px;"><div class="upfront-like-box_placeholder_guide">'+r.placeholder_guide+"</div>"+'<div class="upfront-like-box_url_wrapper"><input type="text" class="upfront-like-box_url" placeholder="'+r.placeholder+'" /></div>'+'<button type="button" class="upfront-like-box_button">'+r.ok+"</button></div></div>"},on_render:function(){var t=this.parent_module_view,n=this;this.setElementSize(),t.$el.data("dragHandler")||(t.$el.on("dragstart",this.coverIframe),t.$el.data("dragHandler",!0)),this.$el.find(".upfront-like-box_button").on("click",function(t){n.property("facebook_url",e(this).parent().find("input.upfront-like-box_url").val())}),this.$el.find(".upfront-like-box_url").on("keydown",function(e){e.which==13&&(n.$el.find(".upfront-like-box_button").click(),Upfront.Events.trigger("upfront:element:edit:stop"))})},on_after_layout_render:function(){this.setElementSize()},coverIframe:function(e,t){t.helper.append('<div class="upfront-iframe-draggable" style="width:100%;height:100%;position:absolute;top:0;left:0:z-index:1"></div>')}}),o=Upfront.Views.Editor.Sidebar.Element.extend({priority:100,render:function(){this.$el.addClass("upfront-icon-element upfront-icon-element-likebox"),this.$el.html(r.element_name)},add_element:function(){var e=new i,t=new Upfront.Models.Module({name:"",properties:[{name:"element_id",value:Upfront.Util.get_unique_id("module")},{name:"class",value:"c7 upfront-like-box_module"},{name:"has_settings",value:0},{name:"row",value:Upfront.Util.height_to_row(200)}],objects:[e]});this.add_module(t)}}),u=n.extend({className:"uyoutube-settings",tabbed:!1,title:r.general_settings,initialize:function(e){this.options=e,me=this,SettingsItem=Upfront.Views.Editor.Settings.Item,Fields=Upfront.Views.Editor.Field,this.settings=_([new SettingsItem({className:"upfront-social-services-item general_settings_item",title:r.facebook_account,label:r.opts.page_url,fields:[new Fields.Text({model:this.model,className:"facebook-url",property:"facebook_url",label:r.opts.url_sample,compact:!0,change:function(e){this.model.set_property("facebook_url",e)}}),new Fields.Checkboxes({model:this.model,className:"show-friends",property:"show_friends",label:"",values:[{label:r.opts.show_friends,value:"yes"}],change:function(e){this.model.set_property("show_friends",e)}}),new Fields.Checkboxes({model:this.model,className:"small-header",property:"small_header",label:"",values:[{label:r.opts.small_header,value:"yes"}],change:function(e){this.model.set_property("small_header",e)}}),new Fields.Checkboxes({model:this.model,className:"hide-cover",property:"hide_cover",label:"",values:[{label:r.opts.hide_cover,value:"yes"}],change:function(e){this.model.set_property("hide_cover",e)}}),new Fields.Checkboxes({model:this.model,className:"show-posts",property:"show_posts",label:"",values:[{label:r.opts.show_posts,value:"yes"}],change:function(e){this.model.set_property("show_posts",e)}}),new Upfront.Views.Editor.Settings.Settings_CSS({model:this.model})]})])},get_title:function(){return r.general_settings}}),a=t.extend({panels:{General:u},title:r.settings});Upfront.Application.LayoutEditor.add_object("LikeBox",{Model:i,View:s,Element:o,Settings:a,cssSelectors:{iframe:{label:r.container_label,info:r.container_info}},cssSelectorsId:Upfront.data.ulikebox.defaults.type}),Upfront.Models.LikeBoxModel=i,Upfront.Views.LikeBoxView=s})}(jQuery),define("text!elements/upfront-login/css/edit.css",[],function(){return".upfront_login-settings-panel .upfront-settings_panel {\n	width: 290px;\n}\n\n.upfront_login-fields-complex_boolean {\n	width: 48%;\n	float: left;\n}\n.upfront_login-fields-complex_boolean .upfront-field-wrap-radios {\n	float: left;\n}\n.upfront_login-fields-complex_boolean .upfront-field-wrap-text {\n	width: 80%;\n	float: left;\n}\n.upfront_login-fields-complex_boolean.upfront_login-appearance-icon {\n	width: 60%;\n}\n.upfront_login-fields-complex_boolean.upfront_login-appearance-icon .upfront-field-text {\n	width: 80%;\n}\n.upfront_login-fields-complex_boolean.upfront_login-appearance-label {\n	width: 40%;\n}\n.upfront_login-fields-complex_boolean.upfront_login-appearance-icon .upfront_login-icon {\n	float: left;\n	width: 85%;\n}\n.upfront_login-fields-complex_boolean.upfront_login-appearance-icon .upfront_login-icon input {\n	width: 80%;\n}\n\n.upfront_login-item-display_behavior .upfront-field-multiple,\n.upfront_login-logout_style .upfront-field-multiple {\n	max-width: 48%;\n	margin-right: 1%;\n	float: left;\n}\n\n.upfront_login-logout_text {\n	clear:both;\n} \n\ndiv.upfront_login-item-display_behavior div.upfront-settings-item-title > span {\n  display: block;\n  color: #7d99b3;\n  font-size: 11px;\n  font-weight: bold;\n  font-family: verdana, sans-serif;\n  line-height: 1;\n  margin-bottom: 0 !important;\n  text-transform: none;\n}\n\n\ndiv.upfront_login-item-display_behavior div.upfront-settings-item-title:after {\n  display:none;\n}\n\ndiv.upfront_login-item-display_trigger div.upfront-field-wrap-text {\n  margin-top:0 !important;\n}\n\ndiv.upfront_login-item-display_trigger div.upfront-settings-item {\n  padding-top: 0;\n}\n\ndiv.upfront-login_element-module,\ndiv.upfront-login_element-module.upfront-module-active {\n  z-index: 80;\n}\n\ndiv.upfront-login_element-module .upfront_login.upfront_login-hover,\ndiv.upfront-login_element-module.upfront-module-active .upfront_login.upfront_login-hover,\ndiv.upfront-login_element-module .upfront_login.upfront_login-click,\ndiv.upfront-login_element-module.upfront-module-active .upfront_login.upfront_login-click {\n  z-index: 15;\n}"}),define("text!elements/upfront-login/css/public.css",[],function(){return'/* GENERAL FORM STYLE \n	 ================== */\n.upfront_login-form form input {\n	height:40px;\n	border:3px solid #ceddea;\n	background-color: #fff;\n	padding:0 10px;\n}\n.upfront_login-form form input:hover, .upfront_login-form form input:focus { \n	border-color: #aec4d8;\n	outline:none;\n}\n.upfront_login-form form input[type="submit"]{\n	border: 2px solid #269a47;\n	background-color: #2cad4a;\n	color: #fff;\n	width: 100%;\n	text-align: center;\n}\n.upfront_login-form form input[type="submit"]:hover {\n	background-color: #269a47;\n}\n.upfront_login-form form input[type="checkbox"]{\n	height:20px;\n	margin-bottom:15px;\n	position: relative;\n	top: 3px;\n}\n/*.upfront_login-form form label, .upfront_login-form p { color:#6486a6; }*/\n.upfront_login-form p { margin-bottom: 0; text-align: center; }\n.upfront_login-form p a { color:#39a678; }\n\n\n/* HOVER FORM \n	 ========== */\n\n.upfront_login.upfront_login-hover,\n.upfront_login.upfront_login-click { position: relative; }\n.upfront_login.upfront_login-hover .upfront_login-form-wrapper,\n.upfront_login.upfront_login-click .upfront_login-form-wrapper\n {\n	 display: none; \n}\n.upfront_login.upfront_login-hover .upfront_login-form-wrapper,\n.upfront_login.upfront_login-click .upfront_login-form-wrapper { \n	position: absolute;\n	z-index: 1;\n	top:15px;\n	width:210px;\n	left:-50px;\n}\n\n.upfront_login.upfront_login-hover:hover .upfront_login-form-wrapper,\n.upfront_login.upfront_login-click.active .upfront_login-form-wrapper {\n	display: block;\n}\n\n/* login panel styling */\n.upfront_login.upfront_login-hover .upfront_login-form,\n.upfront_login.upfront_login-click .upfront_login-form {\n	position: relative;\n	display: block;\n	background-color: #fff;\n	border-radius: 3px;\n	cursor: default;\n	border:2px solid #527caa;\n	top:20px;\n	left:0;\n	padding:15px;\n	padding-bottom: 5px;\n}\n\n/* triangular tooltip */\n.upfront_login.upfront_login-hover:hover .upfront_login-form:before,\n.upfront_login.upfront_login-click.active .upfront_login-form:before {\n	content:\'\';\n	display:inline-block;\n	width:10px;\n	height:10px;\n	background-color:#fff;\n	transform:rotate(45deg);\n	-webkit-transform:rotate(45deg);\n	border-top:2px solid #527caa;\n	border-left:2px solid #527caa;\n	position:absolute;\n	top:-7px;\n	left:25%;\n}\n.upfront_login.upfront_login-hover .upfront_login-form label,\n.upfront_login.upfront_login-click .upfront_login-form label\n { text-align: left; display: block;}\n\n.upfront_login.upfront_login-hover:hover .upfront_login-trigger,\n.upfront_login.upfront_login-click.active .upfront_login-trigger {\n	display: inline-block;\n}\n\n/* Click */\n/*\n.upfront_login.upfront_login-click .upfront_login-form form input[type="submit"]{\n	width: 70%;\n}\n.upfront_login.upfront_login-click .login-username, \n.upfront_login.upfront_login-click .login-password { margin-bottom: 15px; }\n.upfront_login.upfront_login-click .upfront_login-form {\n	display: none;\n}\n.upfront_login.upfront_login-click {\n	z-index: 0;\n}\n.upfront_login.upfront_login-click.active {\n	background: rgba(38,58,77,.8);\n	position: fixed;\n	top: 0; left: 0;\n	bottom: 0; right: 0;\n	z-index: 9;\n	padding-top: 5em;\n}*/\n/*.upfront_login.upfront_login-click.active .upfront_login-form {\n	display: block;\n	background: #fff;\n	z-index: 10;\n	width: 80%;\n	max-width: 350px;\n	margin: 0 auto;\n	padding: 2em;\n}*/\n/*.upfront_login.upfront_login-click.active .upfront_login-trigger {\n	display: none;\n}*/\n\n/* css animation */\n.upfront_login.upfront_login-hover .upfront_login-form,\n.upfront_login.upfront_login-click .upfront_login-form {-webkit-animation-fill-mode:both;-moz-animation-fill-mode:both;-ms-animation-fill-mode:both;-o-animation-fill-mode:both;animation-fill-mode:both;-webkit-animation-duration:0.5s;-moz-animation-duration:0.5s;-ms-animation-duration:0.5s;-o-animation-duration:0.5s;animation-duration:0.5s;}\n@-webkit-keyframes fadeInDown {\n	0% {\n		opacity: 0;\n		-webkit-transform: translateY(-10px);\n	}	100% {\n		opacity: 1;\n		-webkit-transform: translateY(0);\n	}\n}\n\n@-moz-keyframes fadeInDown {\n	0% {\n		opacity: 0;\n		-moz-transform: translateY(-10px);\n	}\n	\n	100% {\n		opacity: 1;\n		-moz-transform: translateY(0);\n	}\n}\n\n@-o-keyframes fadeInDown {\n	0% {\n		opacity: 0;\n		-o-transform: translateY(-10px);\n	}\n	\n	100% {\n		opacity: 1;\n		-o-transform: translateY(0);\n	}\n}\n\n@keyframes fadeInDown {\n	0% {\n		opacity: 0;\n		transform: translateY(-10px);\n	}\n	\n	100% {\n		opacity: 1;\n		transform: translateY(0);\n	}\n}\n\n.fadeInDown, .upfront_login.upfront_login-hover:hover .upfront_login-form {\n	-webkit-animation-name: fadeInDown;\n	-moz-animation-name: fadeInDown;\n	-o-animation-name: fadeInDown;\n	animation-name: fadeInDown;\n}\n\n\n\n\n\n\n\n\ndiv.upfront-output-upfront-login_element form#loginform input:not([type=checkbox]) {\n  width: 100%;\n  padding:0 10px;\n  box-sizing: border-box;\n}\n\n\ndiv.upfront-output-upfront-login_element form#loginform p {\n  text-align:left;\n  line-height: 1.2;\n  margin-top:1em\n}\n\ndiv.upfront-output-upfront-login_element form#loginform label {\n	margin-bottom:0.3em;\n	display: inline-block;\n	font-weight: 100;\n}\ninput#rememberme {\n  width:18px;\n  height:18px;  \n  vertical-align:middle;\n  margin-right:10px\n}\ninput#rememberme:before {\n  content:\'\';\n  display: block;\n  width:100%;\n  height:100%;\n  border:3px solid #CEDDEA;\n  background-color:#fff;\n}\ninput#rememberme:checked:before {\n	background-position: -733px -138px;\n	background-image: url(\'../../../img/uf-ui-sprite.svg\');\n	background-repeat: no-repeat;\n}'}),function(e){define("upfront_login",["text!elements/upfront-login/css/edit.css","text!elements/upfront-login/css/public.css","scripts/upfront/element-settings/settings","scripts/upfront/element-settings/root-settings-panel","scripts/upfront/element-settings/advanced-settings"],function(t,n,r,i,s){e("head").append("<style>"+t+"</style>"),e("head").append("<style>"+n+"</style>");var o=Upfront.Settings.l10n.login_element,u=Upfront.Models.ObjectModel.extend({init:function(){var e=_.clone(Upfront.data.upfront_login.defaults);e.element_id=Upfront.Util.get_unique_id(e.id_slug+"-object"),this.init_properties(e)}}),a=Upfront.Views.ObjectView.extend({markup:!1,initialize:function(){this.model instanceof u||(this.model=new u({properties:this.model.get("properties")})),Upfront.Views.ObjectView.prototype.initialize.call(this);var e=this;this.model.get("properties").on("change",function(t){if(!t||!t.get)return!0;"row"!=t.get("name")&&(e.markup=!1,e.render())}),this.model.get("properties").bind("change",this.handle_visual_padding_hint,this)},render:function(){if(!this.markup){var e=this,t=Upfront.Util.model_to_json(this.model);Upfront.Util.post({action:"upfront-login_element-get_markup",properties:t.properties}).done(function(t){e.markup=t.data,Upfront.Views.ObjectView.prototype.render.call(e)})}Upfront.Views.ObjectView.prototype.render.call(this)},get_content_markup:function(){return this.markup?this.markup:o.hold_on}}),f=Upfront.Views.Editor.Field.Text.extend({className:"upfront-field-wrap upfront-field-wrap-appearance-icon-image",get_field_html:function(){return'<div class="upfront_login-icon"><img src="'+Upfront.data.upfront_login.root_url+'img/icon.png" />'+Upfront.Views.Editor.Field.Text.prototype.get_field_html.call(this)+"</div>"},get_saved_value:function(){var e=this.property?this.property.get("value"):this.model?this.model.get(this.name):"";return"icon"===e?"":e},get_value:function(){return this.$el.find("input").val()||"icon"}}),l=Upfront.Views.Editor.Settings.Item.extend({save_fields:function(){var e=this.model;this.fields.each(function(t){var n=t.get_value();if(!_.isObject(n))return;_(n).each(function(t,n){if("appearance"==n&&!t)return!0;e.set_property(n,t)})})}}),c=Backbone.View.extend({className:"upfront_login-fields-complex_boolean clearfix",initialize:function(e){this.options=e;var t=e.model,n=e.boolean_field.values||[];n.length||n.push({label:"",value:"1"}),this.options.field=new Upfront.Views.Editor.Field.Radios(_.extend(e.boolean_field,{model:t,mutiple:!1,values:n}))},render:function(){this.$el.empty(),this.options.subfield.render(),this.options.field.render(),this.$el.append(this.options.field.$el),this.$el.append(this.options.subfield.$el),this.options.additional_class&&this.$el.addClass(this.options.additional_class)},get_value:function(){var e={};return e[this.options.field.get_name()]=this.options.field.get_value(),e[this.options.subfield.get_name()]=this.options.subfield.get_value(),e}}),h=r.extend({title:o.settings,initialize:function(e){this.has_tabs=!1,this.options=e;var t=new p({model:this.model});this.panels=[t,new s({model:this.model})]},get_title:function(){return o.settings}}),p=i.extend({title:o.general_settings,initialize:function(e){this.options=e;var t=new v({model:this.model}),n=new d({model:this.model}),r=new m({model:this.model}),i=this;this.settings=_([t,n,r,new Upfront.Views.Editor.Settings.Item({model:this.model,title:o.logged_in_preview,fields:[new Upfront.Views.Editor.Field.Checkboxes({model:this.model,property:"logged_in_preview",label:"",values:[{label:o.preview,value:"yes"}],change:function(){this.property.set({value:this.get_value()},{silent:!1})}}),new Upfront.Views.Editor.Field.Radios({className:"upfront_login-logout_style upfront-field-wrap upfront-field-wrap-multiple upfront-field-wrap-radios",model:this.model,property:"logout_style",values:[{label:o.nothing,value:"nothing"},{label:o.log_out_link,value:"link"}],change:function(){this.property.set({value:this.get_value()},{silent:!1})}}),new Upfront.Views.Editor.Field.Text({className:"upfront_login-logout_text upfront-field-wrap upfront-field-wrap-text",model:this.model,property:"logout_link",label:o.log_out_label,change:function(){this.property.set({value:this.get_value()},{silent:!1})}})]}),new Upfront.Views.Editor.Settings.Settings_CSS({model:this.model})]),t.on("login:appearance:changed",n.update,n),t.on("login:appearance:changed",r.update,r),t.on("login:appearance:changed",function(){i.trigger("upfront:settings:panel:refresh",i)})},render:function(){i.prototype.render.call(this),this.$el.addClass("upfront_login-settings-panel"),this.settings.each(function(e){e.update&&e.update()})},get_label:function(){return o.display},get_title:function(){return o.display}}),d=Upfront.Views.Editor.Settings.Item.extend({className:"display_behavior",events:function(){return _.extend({},Upfront.Views.Editor.Settings.Item.prototype.events,{click:"register_change"})},initialize:function(){var e=this.model.get_property_value_by_name("style"),t=!e||"popup"==e,n=[{label:o.show_on_hover,value:"hover",disabled:t},{label:o.show_on_click,value:"click"}];this.fields=_([new Upfront.Views.Editor.Field.Radios({model:this.model,property:"behavior",values:n})])},render:function(){Upfront.Views.Editor.Settings.Item.prototype.render.call(this),this.$el.addClass("upfront_login-item-display_behavior").find(".upfront-settings-item-content").addClass("clearfix").end().hide()},get_title:function(){return"Show Drop-Down Form on:"},register_change:function(){this.fields.each(function(e){e.property.set({value:e.get_value()},{silent:!1})}),this.trigger("login:behavior:changed")},update:function(){var e=this.model.get_property_value_by_name("style");this.initialize(),this.$el.empty(),this.render(),"form"!=e&&this.$el.show()}}),v=l.extend({initialize:function(){var e=this,t=[{label:o.on_page,value:"form"},{label:o.dropdown,value:"dropdown"}];this.fields=_([new Upfront.Views.Editor.Field.Radios({model:this.model,property:"style",values:t,change:function(){e.register_change(e)}}),new Upfront.Views.Editor.Field.Text({model:this.model,property:"label_text",label:o.log_in_button,change:function(){e.register_change(e)}})])},render:function(){Upfront.Views.Editor.Settings.Item.prototype.render.call(this),this.$el.find(".upfront-settings-item-content").addClass("clearfix")},get_title:function(){return o.appearance},register_change:function(){this.fields.each(function(e){e.property.set({value:e.get_value()},{silent:!1})}),this.trigger("login:appearance:changed")}}),m=l.extend({className:"upfront_login-item-display_trigger",initialize:function(){var e=this;this.fields=_([new Upfront.Views.Editor.Field.Text({model:this.model,property:"trigger_text",label:o.log_in_trigger,change:function(){e.register_change(e)}})])},register_change:function(){this.fields.each(function(e){e.property.set({value:e.get_value()},{silent:!1})})},update:function(){var e=this.model.get_property_value_by_name("style");this.initialize(),this.$el.empty(),this.render(),"form"!=e&&this.$el.show()},render:function(){Upfront.Views.Editor.Settings.Item.prototype.render.call(this),this.$el.find(".upfront-settings-item-content").addClass("clearfix").end().hide(),this.$el.find(".upfront-settings-item-title").remove()},get_title:function(){return""}}),g=Upfront.Views.Editor.Sidebar.Element.extend({priority:160,render:function(){this.$el.addClass("upfront-icon-element upfront-icon-element-login"),this.$el.html(o.element_name)},add_element:function(){var e=new u,t=new Upfront.Models.Module({name:"",properties:[{name:"element_id",value:Upfront.Util.get_unique_id("module")},{name:"class",value:"c24 upfront-login_element-module"},{name:"has_settings",value:0},{name:"row",value:Upfront.Util.height_to_row(210)}],objects:[e]});this.add_module(t)}});Upfront.Application.LayoutEditor.add_object("Login",{Model:u,View:a,Element:g,Settings:h,cssSelectors:{".upfront_login-form p":{label:o.css.containers,info:o.css.containers_info},".upfront_login-form form label":{label:o.css.labels,info:o.css.labels_info},".upfront_login-form form input:not([type=submit]):not([type=checkbox])":{label:o.css.inputs,info:o.css.inputs_info},".upfront_login-form form  input[type=submit]":{label:o.css.button,info:o.css.button_info},".upfront_login-form form  input[type=checkbox]":{label:o.css.remember,info:o.css.remember_info},".login-lostpassword":{label:o.css.pwd_wrap,info:o.css.pwd_wrap_info},".upfront_login-form p .login-lostpassword-link":{label:o.css.pwd_link,info:o.css.pwd_link_info},".upfront_login-trigger":{label:o.css.close,info:o.css.close_info}},cssSelectorsId:Upfront.data.upfront_login.defaults.type}),Upfront.Models.LoginModel=u,Upfront.Views.LoginView=a})}(jQuery),define("text!elements/upfront-maps/css/edit.css",[],function(){return'.upfront-editable_entity .ufm-gmap-container img {\r\n  max-width: none !important;\r\n  max-height: none !important;\r\n}\r\n.upfront_map-fields-simple_location .upfront-field-wrap-text {\r\n	float: left;\r\n	width: 80%;\r\n}\r\n.upfront_map-fields-simple_location .upfront-field-wrap-refresh button {\r\n	width: 24px;\r\n	height: 30px;\r\n	border: none;\r\n	background: none;\r\n	padding: 0;\r\n}\r\n#settings .upfront-settings-item-maps_element-location .upfront-settings-item {\r\n	border: none;\r\n	padding-right: 0;\r\n}\r\n#settings .ufpront-maps_element-settings_panel .upfront-settings_panel {\r\n	width: 240px;\r\n}\r\n#settings .ufpront-maps_element-settings_panel .upfront-settings_panel .upfront-settings_panel_scroll {\r\n	min-width: 240px;\r\n}\r\n.ufpront-maps_element-settings_panel .upfront-settings-css .upfront-field-select-single {\r\n  width: 180px;\r\n}\r\n\r\n.ufpront-maps_element-settings_panel .upfront-field-select {\r\n	width: 100%;\r\n}\r\n\r\n.ufm-context-menu{\r\nbackground:white;\r\n-webkit-border-radius: 3px;\r\n-moz-border-radius: 3px;\r\nborder-radius: 3px;\r\n}\r\n.ufm-context-menu-item{\r\npadding:0px 10px;\r\n}\r\n\r\n.ufm-context-menu-item:hover{\r\nbackground:#f0f0f0;\r\n}\r\n\r\n.ufm-context-menu .ufm-context-menu-item:first-child{\r\n-webkit-border-top-left-radius: 3px;\r\n-webkit-border-top-right-radius: 3px;\r\n-moz-border-radius-topleft: 3px;\r\n-moz-border-radius-topright: 3px;\r\nborder-top-left-radius: 3px;\r\nborder-top-right-radius: 3px;\r\n}\r\n.ufm-context-menu .ufm-context-menu-item:last-child{\r\n-webkit-border-bottom-right-radius: 3px;\r\n-webkit-border-bottom-left-radius: 3px;\r\n-moz-border-radius-bottomright: 3px;\r\n-moz-border-radius-bottomleft: 3px;\r\nborder-bottom-right-radius: 3px;\r\nborder-bottom-left-radius: 3px;\r\n}\r\n\r\n.ufm-map-marker-select{\r\nposition:absolute;\r\nbackground:white;\r\nborder:1px solid #cccccc;\r\npadding:10px;\r\n}\r\n\r\n.ufm-map-marker-select .marker-url label{\r\ndisplay: block;\r\nline-height: 20px;\r\n}\r\n\r\n.ufm-map-marker-select .marker-url [name="marker-url"]{\r\nwidth:100%;\r\nheight:44px;\r\n}\r\n\r\n.ufm-map-marker-select .marker-url{\r\nmargin-top: 10px;\r\n}\r\n\r\n.ufm-marker-demo{\r\nwidth:38px;\r\nheight:38px;\r\nline-height: 35px;\r\nborder:1px solid transparent;\r\n\r\ntext-align:center;\r\ndisplay:inline-block;\r\n}\r\n.ufm-marker-demo img{\r\ndisplay:inline-block;\r\nvertical-align: middle;\r\n}\r\n.ufm-marker-demo:hover{\r\nborder: 1px solid #cccccc;\r\ncursor: pointer;\r\n}\r\n.ufm-marker-demo.ufm-current{\r\nborder: 1px dashed #cccccc;\r\n}\r\n.ufm-marker-demo.ufm-current:hover{\r\nborder: 1px solid red;\r\n}\r\n\r\n\r\n\r\n.ufm-rounded{\r\n-webkit-border-radius: 3px;\r\n-moz-border-radius: 3px;\r\nborder-radius: 3px;\r\n}\r\n\r\n\r\n/* override upfront styles that cause visual google maps bugs */\r\n.upfront-map_module .upfront-editable_entity img {\r\nmax-width: none;\r\n}\r\n\r\n.marker-imgs{\r\nmax-height:120px;\r\noverflow-x: auto;\r\n}\r\n\r\n/* triagnle pointer */\r\n.ufm-map-marker-select{\r\nposition: relative;\r\n}\r\n.ufm-map-marker-select:after{\r\ncontent: \'\';\r\ndisplay: block;\r\nposition: absolute;\r\ntop: -20px;\r\nleft: 159px;\r\nwidth: 0;\r\nheight: 0;\r\nborder-color: transparent transparent #ffffff transparent;\r\nborder-style: solid;\r\nborder-width: 10px;\r\n}\r\n\r\n.ufm-map-marker-select:before{\r\ncontent: \'\';\r\ndisplay: block;\r\nposition: absolute;\r\ntop: -23px;\r\nleft: 158px;\r\nwidth: 0;\r\nheight: 0;\r\nborder-color: transparent transparent #cccccc transparent;\r\nborder-style: solid;\r\nborder-width: 11px;\r\n}\r\n\r\n.ufm-map-main img {\r\n	height: auto;\r\n	width: auto;\r\n}\r\n\r\n/* initial experience layout */\r\n\r\n#upfront_map-location_overlay-wrapper,\r\n.uf_el_map_initial-overlay {\r\n	font-weight: 300;\r\n	font-size:20px;\r\n}\r\n\r\n.uf_el_map_initial-overlay {\r\n	height: 150px;\r\n	padding:15px;\r\n}\r\n\r\n/* address input */\r\n.uf_el_map_initial-overlay input[type="text"] {\r\n	background:rgb(201,201,195);\r\n	font-size: 1em;\r\n	width:100%;\r\n}\r\n.uf_el_map_initial-overlay input[type="text"]:focus {\r\n	background:rgb(255,255,255);\r\n	color:rgb(100,100,100);\r\n}\r\n\r\n/* refresh button */\r\n.uf_el_map_initial-overlay button {\r\n	position: absolute;\r\n	top: 0;\r\n	right: 0;\r\n	background-color: transparent;\r\n	padding: 10px;\r\n}\r\n\r\n.uf_el_map_initial-overlay button ,\r\n.uf_el_map_initial-overlay .uf-current-location {\r\n	margin:0;\r\n}\r\n\r\n.uf_el_map_initial-overlay .uf-address  {\r\n	margin:0 auto;\r\n	max-width:500px;\r\n	position: relative;\r\n	margin-bottom: 10px;\r\n}\r\n\r\n.uf-current-location {\r\n	font-size: 0.8em;\r\n	margin-top:10px;\r\n}\r\n/* Use My Location */\r\n.uf-current-location a {\r\n	background:transparent;\r\n	color:#395269;\r\n	text-decoration: underline;\r\n	padding:0;\r\n	margin:0;\r\n}\r\n.uf-current-location a:hover { cursor: pointer; }\r\n\r\n.uf_el_map_initial-overlay button,\r\n.uf_el_map_initial-overlay input { outline:none; }\r\n\r\n/* Missing default styles */\r\n.uf_el_map_initial-overlay input {\r\n	padding: 10px;\r\n	border: 1px solid #d0d0d0;\r\n}\r\n.uf_el_map_initial-overlay button {\r\n	border: 0;\r\n	border-radius: 2px;\r\n	cursor: pointer;\r\n}\r\n\r\n/* Check your internet connection message */\r\n\r\n.ufm-gmap-container {\r\n	background-color: rgb(227, 227, 220);\r\n	display:table;\r\n}\r\n\r\n.ufm-gmap-container p {\r\n	display: table-cell;\r\n	vertical-align: middle;\r\n	text-align: center;\r\n}\r\n\r\n.ufm-gmap-container .upfront-util-icon:before {\r\n	content: " ";\r\n	width:40px;\r\n	height:40px;\r\n	background-position: -472px -193px;\r\n	background-color: rgb(255, 255, 255);\r\n	position: absolute;\r\n	top:15px;\r\n	left:15px;\r\n}\r\n\r\n.map_location {\r\n	margin-top: 10px;\r\n}\r\n\r\n.map-style, .map-zoom-level {\r\n	width: 225px;\r\n}\r\n\r\n.open-map-code-panel-button {\r\n	margin-top: -5px;\r\n	padding: 5px 0px 5px 10px;\r\n	position: relative;\r\n	top: 0px;\r\n	border-left: 2px solid #dae6f2;\r\n}\r\n\r\n/* this is required for the code panel button when map is used for a region\'s background */\r\n.uf-bgsettings-mapitem .open-map-code-panel-button {\r\n	float:left;\r\n}\r\n\r\n.upfront_map-fields-simple_location .upfront-field-wrap-refresh button {\r\n	background-image: linear-gradient(-179deg, #fafdff 0%, #f3faff 100%) !important;\r\n    border: 1px solid #a2bfda;\r\n	border-left: none;\r\n	height: 26px;\r\n	width: 30px;\r\n}\r\n\r\n.draggable-checkbox {\r\n	margin-top: 15px;\r\n}\r\n\r\n.upfront_map-fields-simple_location .upfront-field-wrap-refresh button img {\r\n	opacity: 0.7;\r\n	width: 15px;\r\n	margin-top: 3px;\r\n}\r\n\r\n.upfront_map-fields-simple_location .upfront-field-wrap-text {\r\n	width: 84% !important;\r\n}\r\n\r\n.open-map-code-panel-button {\r\n	margin-top: -5px;\r\n	padding: 5px 0px 5px 10px;\r\n	position: relative;\r\n	top: 0px;\r\n	border-left: 2px solid #dae6f2;\r\n}\r\n\r\n.open-map-code-panel-button input {\r\n	display: inline-block;\r\n	height: 26px;\r\n	max-height: 26px;\r\n	border-radius: 3px;\r\n	font-size: 11px;\r\n	font-weight: normal;\r\n	font-family: verdana, sans-serif;\r\n	background-image: linear-gradient(-179deg, #fafdff 0%, #f3faff 100%);\r\n    border: 1px solid #a2bfda;\r\n    border-radius: 5px;\r\n    color: #6486a6;\r\n    padding: 4px 8px;\r\n    position: relative;\r\n}\r\n\r\n.open-map-code-panel-button input:hover {\r\n	border: 1px solid #a2bfda;\r\n}'}),function(e){define("upfront_maps",["maps_context_menu","text!elements/upfront-maps/css/edit.css","scripts/upfront/element-settings/settings","scripts/upfront/element-settings/root-settings-panel","scripts/upfront/inline-panels/map-editor"],function(t,n,r,i,s){var o={OPTIMUM_MAP_HEIGHT:300,center:[-37.818,144.976],zoom:10,style:"ROADMAP",use_custom_map_code:!1,controls:{pan:!1,zoom:!1,map_type:!1,scale:!1,street_view:!1,overview_map:!1}},u=Upfront.Settings.l10n.maps_element;e("head").append("<style>"+n+"</style>");var a=Upfront.Models.ObjectModel.extend({init:function(){var e=_.clone(Upfront.data.umaps.defaults);o.center=e.map_center,navigator&&navigator.geolocation&&delete e.map_center,e.element_id=Upfront.Util.get_unique_id(e.id_slug+"-object"),this.init_properties(e)}}),f=Upfront.Views.Editor.Field.Checkboxes.extend({multiple:!1}),l=Upfront.Views.Editor.Field.Text.extend({className:"upfront-field-wrap upfront-field-wrap-refresh",events:function(){return _.extend({},Upfront.Views.Editor.Field.Text.prototype.events,{click:"propagate_activation_request"})},get_field_html:function(){return'<button type="button"><img src="'+Upfront.data.upfront_maps.root_url+'img/refresh.png" /></button>'},propagate_activation_request:function(e){e.preventDefault(),e.stopPropagation(),this.trigger("refresh")}}),c=Backbone.View.extend({className:"upfront_map-fields-simple_location map_location clearfix",events:{keypress:"wait_for_enter"},initialize:function(e){this.options=e,this.model instanceof a||(this.model=new a({properties:this.model.get("properties")}));var t=_.extend({},e);this.options.field=new Upfront.Views.Editor.Field.Text(t),this.options.locate=new l(t),this.property=this.options.field.property,this.options.locate.on("refresh",this.geocode,this),this.model.on("options:location:geocode",this.geocode,this)},wait_for_enter:function(e){13==e.which&&(e.stopPropagation(),e.preventDefault(),this.geocode())},render:function(){this.$el.empty(),this.options.locate.render(),this.options.field.render();var e=this.model.get_property_value_by_name("address")||"";this.options.field.set_value(e),this.$el.append(this.options.field.$el),this.$el.append(this.options.locate.$el)},get_value:function(){return this.options.field.get_value()},get_saved_value:function(){return this.options.field.get_saved_value()},geocode:function(){if("undefined"==typeof window.google)return!1;var t=this.options.field.get_value(),n=this.model.get_property_value_by_name("element_id"),r=e(document).data(n+"-location"),i=this.model.get_property_value_by_name("address"),s=new google.maps.Geocoder,o=this;if(!t||t===r)return!1;if(t===i)return!1;if(this._geocoding_in_progress)return!1;this._geocoding_in_progress=!0,s.geocode({address:t},function(r,i){if(i!=google.maps.GeocoderStatus.OK)return o._geocoding_in_progress=!1,!1;var s=r[0].geometry.location,u=o.model.get_property_value_by_name("markers")||[];u.push({lat:s.lat(),lng:s.lng()}),o.model.set_property("markers",u,!0),o.model.set_property("address",t,!0),o.model.set_property("map_center",[s.lat(),s.lng()],!1),e(document).data(n+"-location",t),o._geocoding_in_progress=!1})}}),h=Upfront.Views.ObjectView.extend({map:!1,init:function(){this.listenTo(Upfront.Events,"upfront:layout_size:change_breakpoint",this.refresh_map)},on_element_resize:function(e){this.refresh_map()},on_render:function(){this.update_properties();var e=this,t=this.$el.find(".ufm-gmap-container:first"),n=this.model.get_breakpoint_property_value("row",!0)?this.model.get_breakpoint_property_value("row",!0):this.parent_module_view.model.get_breakpoint_property_value("row",!0),r=this.model.get_property_value_by_name("controls")||[],i={center:this.model.get_property_value_by_name("map_center")||o.center,zoom:parseInt(this.model.get_property_value_by_name("zoom"),10)||o.zoom,type:this.model.get_property_value_by_name("style")||o.style,panControl:r.indexOf("pan")>=0||o.controls.pan,zoomControl:r.indexOf("zoom")>=0||o.controls.zoom,mapTypeControl:r.indexOf("map_type")>=0||o.controls.map_type,scaleControl:r.indexOf("scale")>=0||o.controls.scale,streetViewControl:r.indexOf("street_view")>=0||o.controls.street_view,overviewMapControl:r.indexOf("overview_map")>=0||o.controls.overview_map,style_overlay:this.model.get_property_value_by_name("use_custom_map_code")?JSON.parse(this.model.get_property_value_by_name("map_styles"))||!1:!1,draggable:!!this.model.get_property_value_by_name("draggable"),scrollwheel:!!this.model.get_property_value_by_name("scrollwheel")};n=n?parseInt(n,10)*Upfront.Settings.LayoutEditor.Grid.baseline:o.OPTIMUM_MAP_HEIGHT,t.css({width:"100%",height:n+"px"}),t.on("click mousedown mouseup",function(e){e.cancelBubble=!0,e.stopPropagation&&e.stopPropagation()}),"undefined"!=typeof window.google?(this.map=new google.maps.Map(t.get(0),{center:new google.maps.LatLng(i.center[0],i.center[1]),zoom:i.zoom,mapTypeId:google.maps.MapTypeId[i.type],panControl:i.panControl,zoomControl:i.zoomControl,mapTypeControl:i.mapTypeControl,scaleControl:i.scaleControl,streetViewControl:i.streetViewControl,overviewMapControl:i.overviewMapControl,draggable:i.draggable,scrollwheel:i.scrollwheel}),i.style_overlay&&this.map.setOptions({styles:i.style_overlay}),this.model.get_property_value_by_name("map_center")||this.add_location_overlay(),setTimeout(function(){var t=e.map.getCenter();google.maps.event.trigger(e.map,"resize"),e.map.setCenter(t)},300),this.add_stored_markers(),this.init_rightclick_context_menu()):t.html("<p class='upfront-util-icon'>"+u.connectivity_warning+"</p>")},refresh_map:function(){var e=this.$el.find(".ufm-gmap-container:first"),t=this.model.get_breakpoint_property_value("row",!0)?this.model.get_breakpoint_property_value("row",!0):this.parent_module_view.model.get_breakpoint_property_value("row",!0);t=t?parseInt(t,10)*Upfront.Settings.LayoutEditor.Grid.baseline:o.OPTIMUM_MAP_HEIGHT,e.css({height:t+"px"}),google.maps.event.trigger(this.map,"resize")},add_location_overlay:function(){var t=this,n=this.$el.find("#upfront_map-location_overlay-wrapper");n.length||(this.$el.append('<div id="upfront_map-location_overlay-wrapper" class="upfront-initial-overlay-wrapper"><div id="upfront_map-location_overlay" class="uf_el_map_initial-overlay upfront-initial-overlay-wrapper"><p id="upfront_map-location_overlay-instruction">'+u.instructions+"</p>"+'<div id="upfront_map-location_overlay-address" class="upfront-ui uf-address">'+'<input type="text" id="upfront_map-location_overlay-location" placeholder="'+u.placeholder+'" />'+'<button type="button" id="upfront_map-location_overlay-use_location" class="upfront-field-icon upfront-icon-map-refresh"></button></div>'+'<span class="uf-current-location">'+u.or+' <a id="upfront_map-location_overlay-use_current">'+u.use_current_location+"</a></span>"+"</div>"+"</div>"),n=this.$el.find("#upfront_map-location_overlay-wrapper")),n.find("#upfront_map-location_overlay-use_location").off("click").on("click",function(){var n=t.$el.find("#upfront_map-location_overlay-wrapper #upfront_map-location_overlay-location"),r=new google.maps.Geocoder,i=t.model.get_property_value_by_name("element_id"),s=n.length?n.val():"";if(!s)return!1;r.geocode({address:s},function(n,r){if(r!=google.maps.GeocoderStatus.OK)return!1;var o=n[0].geometry.location,u=t.model.get_property_value_by_name("markers")||[];u.push({lat:o.lat(),lng:o.lng()}),t.model.set_property("markers",u,!0),t.model.set_property("address",s,!0),t.model.set_property("map_center",[o.lat(),o.lng()],!1),e(document).data(i+"-location",location)})}).end().find("#upfront_map-location_overlay-location").off("keydown").on("keydown",function(e){13===e.which&&(n.find("#upfront_map-location_overlay-use_location").click(),Upfront.Events.trigger("upfront:element:edit:stop"))}).off("click").on("click",function(t){e(this).focus()}).end().off("dblclick").on("dblclick",function(e){e.preventDefault(),e.stopPropagation()});var r=n.find("#upfront_map-location_overlay-use_current");navigator&&navigator.geolocation?r.off("click").on("click",function(){if(!navigator||!navigator.geolocation)return!1;var e=t.model.get_property_value_by_name("markers")||[];navigator.geolocation.getCurrentPosition(function(n){e.push({lat:n.coords.latitude,lng:n.coords.longitude}),t.model.set_property("markers",e,!0),t.model.set_property("map_center",[n.coords.latitude,n.coords.longitude],!1)},function(){r.closest(".uf-current-location").text(u.unable_to_geolocate)})}):r.remove(),this.$el.find(".upfront-entity_meta").hide()},get_content_markup:function(){return'<div class="ufm-gmap-container"><p>'+u.hold_on+"</p></div>"},update_properties:function(){this.model.trigger("options:location:geocode")},center_map:function(e,t){var n=new google.maps.LatLng(e,t);this.map.setCenter(n),this.model.set_property("map_center",[e,t])},init_rightclick_context_menu:function(){var e={};e.classNames={menu:"ufm-context-menu",menuSeparator:"context_menu_separator"};var t=[];t.push({className:"ufm-context-menu-item",eventName:"center_map",label:u.menu.center_map}),t.push({className:"ufm-context-menu-item",eventName:"add_marker",label:u.menu.add_marker}),e.menuItems=t;var n=new ContextMenu(this.map,e);google.maps.event.addListener(this.map,"rightclick",function(e){n.show(e.latLng)});var r=this;google.maps.event.addListener(n,"menu_item_selected",function(e,t){switch(t){case"add_marker":r.add_marker(e.lat(),e.lng());break;case"center_map":r.center_map(e.lat(),e.lng())}})},init_marker_context_menu:function(e){var t={};t.classNames={menu:"ufm-context-menu",menuSeparator:"context_menu_separator"};var n=[];n.push({className:"ufm-context-menu-item",eventName:"remove_marker",label:u.menu.remove_marker}),n.push({className:"ufm-context-menu-item",eventName:"change_icon",label:u.menu.change_icon}),t.menuItems=n;var r=new ContextMenu(this.map,t);google.maps.event.addListener(e,"rightclick",function(e){r.show(e.latLng)});var i=this;google.maps.event.addListener(r,"menu_item_selected",function(t,n){switch(n){case"remove_marker":i.remove_map_marker(e);break;case"change_icon":i.show_icon_select(e)}})},add_marker:function(e,t){var n=this.model.get_property_value_by_name("markers")||[];n.push({lat:e,lng:t}),this.model.set_property("markers",n),this.add_map_marker({lat:e,lng:t})},update_marker:function(e){var t=this.model.get_property_value_by_name("markers")||[];_(t).each(function(n,r){n.lat===e.lat&&n.lng===e.lng&&(t[r]=e)}),this.model.set_property("markers",t)},add_map_marker:function(t){if(!!this.model.get_property_value_by_name("hide_markers"))return!1;var n=this,r=new google.maps.Marker({position:new google.maps.LatLng(t.lat,t.lng),draggable:!1,icon:t.icon?t.icon:"",map:this.map}),i=e('<div contenteditable="true">'+(t.content?t.content:u.edit_this)+"</div>"),s=new google.maps.InfoWindow({content:i.get(0)});r._raw=t,i.on("input",function(){t.content=i.text(),n.update_marker(t)}),t.is_open&&s.open(n.map,r),google.maps.event.addListener(r,"click",function(){t.is_open?(t.is_open=!1,s.close()):(s.open(n.map,r),t.is_open=!0),n.update_marker(t)}),this.init_marker_context_menu(r)},remove_map_marker:function(e){var t=e._raw,n=this.model.get_property_value_by_name("markers")||[],r=[];_(n).each(function(e,n){(e.lat!==t.lat||e.lng!==t.lng)&&r.push(e)}),this.model.set_property("markers",r),e.setMap(null)},add_stored_markers:function(){var e=this,t=this.model.get_property_value_by_name("markers")||[];_(t).each(function(t){e.add_map_marker(t)})},show_icon_select:function(e){var t=this.get_icon_select_overlay();this.icon_select_overlay=new t(this.map,e)},get_icon_select_overlay:function(t){function i(e,t){this.map=e,this.marker=t,this.div=null,this.setMap(e)}var n=this.map,r=this;return i.prototype=new google.maps.OverlayView,i.prototype.onAdd=function(){var t=this,n=e('<div class="ufm-map-marker-select ufm-rounded"><div class="marker-imgs"></div><div class="marker-url"><label for="marker-url">'+u.image_url+"</label>"+'<textarea id="marker-url" name="marker-url" value="" rows="4"/></textarea>'+"</div>"+"</div>");this.div=n.get(0);var i=["POI.png","arts.png","bar.png","blue-dot.png","blue-pushpin.png","blue.png","bus.png","cabs.png","camera.png","campfire.png","campground.png","casetta_base.png","casetta_brown.png","casetta_green.png","casetta_red.png","casetta_yellow.png","caution.png","coffeehouse.png","convienancestore.png","cycling.png","dollar.png","drinking_water.png","earthquake.png","electronics.png","euro.png","fallingrocks.png","ferry.png","firedept.png","fishing.png","flag.png","gas.png","golfer.png","grocerystore.png","hiker.png","homegardenbusiness.png","hospitals.png","info_circle.png","man.png","marina.png","marker.png","plane.png","snack_bar.png","sportvenue.png","toilets.png","trail.png","tree.png","wheel_chair_accessible.png","woman.png"],s=Upfront.data.upfront_maps.markers,o="";_.each(i,function(e){o=o+'<div class="ufm-marker-demo ufm-rounded"> <img src="'+s+e+'" /> </div>'}),e(".marker-imgs",n).html(o),e(".marker-imgs img",n).on("click dblclick",function(){var t=e(this).parent(),n=t.hasClass("ufm-current")?"":e(this).attr("src");e("div",t.parent()).removeClass("ufm-current"),n!==""&&t.addClass("ufm-current"),a.val(n).trigger("change")}),e(".marker-imgs img",n).on("dblclick",function(){t.setMap(null)}),e(".marker-url button",n).click(function(){t.setMap(null)});var a=e('.marker-url [name="marker-url"]',n),f=this.marker.getIcon(),l=typeof f=="string"?f:"";e('img[src="'+l+'"]',n).parent().addClass("ufm-current"),a.val(l),a.click(function(){this.focus()}),a.on("input propertychange change",function(){var n=e(this).val();n=n===""?null:n;if(/png$/.test(n)||n===null)t.marker._raw.icon=n,r.update_marker(t.marker._raw),t.marker.setIcon(n)});var c=function(e){e.cancelBubble=!0,e.stopPropagation&&e.stopPropagation()};google.maps.event.addDomListener(this.div,"click",c),google.maps.event.addDomListener(this.div,"dblclick",c),e(this.div).on("click mousedown mouseup",c);var h=function(e){t.setMap(null)};google.maps.event.addListener(this.map,"click",h),google.maps.event.addListener(this.map,"rightclick",h);var p=this.getPanes();p.floatPane.appendChild(this.div)},i.prototype.draw=function(){var e=this.getProjection(),t=this.marker.getPosition(),n=e.fromLatLngToDivPixel(t),r=this.div;r.style.left=n.x-170+"px",r.style.top=n.y+15+"px",r.style.width="320px"},i.prototype.onRemove=function(){this.div.parentNode.removeChild(this.div),this.div=null},i}}),p=Upfront.Views.Editor.Sidebar.Element.extend({priority:50,render:function(){this.$el.addClass("upfront-icon-element upfront-icon-element-maps"),this.$el.html(u.element_name)},add_element:function(){var e=new a,t=new Upfront.Models.Module({name:"",properties:[{name:"element_id",value:Upfront.Util.get_unique_id("module")},{name:"class",value:"c12 upfront-map_element-module"},{name:"has_settings",value:0},{name:"row",value:Upfront.Util.height_to_row(330)}],objects:[e]});this.add_module(t)}}),d=i.extend({title:u.general_settings,initialize:function(e){this.options=e,this.settings=_([new m({model:this.model}),new g({model:this.model}),new Upfront.Views.Editor.Settings.Settings_CSS({model:this.model})])},get_label:function(){return u.label},get_title:function(){return u.label}}),v=r.extend({panels:{Settings:d},title:u.settings}),m=Upfront.Views.Editor.Settings.Item.extend({className:"upfront-settings-item-maps_element-location general_settings_item",initialize:function(){this.fields=_([new c({model:this.model,hide_label:!0,property:"location"})])},get_title:function(){return u.location_label}}),g=Upfront.Views.Editor.Settings.Item.extend({events:{"click .open-map-code-panel-button":"init_code_panel"},className:"general_settings_item",initialize:function(){var t=[],n=this.model.get_property_value_by_name("zoom");n||this.model.set_property("zoom",o.zoom,!0),_(_.range(1,19)).each(function(e){t.push({label:e,value:e})});var r=this.model.get_property_value_by_name("style"),i=[{label:u.style.roadmap,value:"ROADMAP"},{label:u.style.satellite,value:"SATELLITE"},{label:u.style.hybrid,value:"HYBRID"},{label:u.style.terrain,value:"TERRAIN"}];r||this.model.set_property("style",o.style,!0);var s=[{label:u.ctrl.pan,value:"pan"},{label:u.ctrl.zoom,value:"zoom"},{label:u.ctrl.type,value:"map_type"},{label:u.ctrl.scale,value:"scale"},{label:u.ctrl.street_view,value:"street_view"},{label:u.ctrl.overview,value:"overview_map"}];this.fields=_([new Upfront.Views.Editor.Field.Slider({className:"upfront-field-wrap upfront-field-wrap-slider map-zoom-level",model:this.model,label:u.zoom_level,property:"zoom",min:1,max:19,change:function(){this.property.set({value:this.get_value()})}}),new Upfront.Views.Editor.Field.Select({model:this.model,label:u.map_style,className:"map-style",property:"style",values:i,change:function(){this.property.set({value:this.get_value()})}}),new Upfront.Views.Editor.Field.Multiple_Chosen_Select({model:this.model,label:u.map_controls,placeholder:"Choose map controls",property:"controls",select_width:"225px",multiple:!0,values:s,change:function(){this.property.set({value:this.get_value()})}}),new Upfront.Views.Editor.Field.Checkboxes({model:this.model,label:u.draggable_map,property:"draggable",className:"draggable-checkbox",hide_label:!0,values:[{label:u.draggable_map,value:1}],multiple:!1,change:function(){this.property.set({value:this.get_value()})}}),new Upfront.Views.Editor.Field.Checkboxes({model:this.model,label:u.hide_markers,className:"markers-checkbox",property:"hide_markers",hide_label:!0,values:[{label:u.hide_markers,value:1}],multiple:!1,change:function(){this.property.set({value:this.get_value()})}}),new Upfront.Views.Editor.Field.Checkboxes({model:this.model,label:u.use_custom_map_code,property:"use_custom_map_code",className:"upfront-field-wrap upfront-field-wrap-multiple upfront-field-wrap-checkboxes custom-map-code",hide_label:!0,values:[{label:u.use_custom_map_code+'<span class="checkbox-info" title="'+u.use_custom_map_code_info+'"></span>',value:1}],multiple:!1,change:function(){var e=this.get_value();this.property.set({value:e})},show:function(t,n){t==1?e(".open-map-code-panel-button",n.parent()).show():e(".open-map-code-panel-button",n.parent()).hide()}}),new Upfront.Views.Editor.Field.Button({model:this.model,label:u.open_map_code_panel,className:"open-map-code-panel-button",compact:!0})])},get_title:function(){return u.settings},init_code_panel:function(){var e=new s({model:this.model});e.render()}});Upfront.Application.LayoutEditor.add_object("Map",{Model:a,View:h,Element:p,Settings:v,cssSelectors:{".ufm-gmap-container":{label:u.css.label,info:u.css.info}},cssSelectorsId:Upfront.data.umaps.defaults.type}),Upfront.Models.MapModel=a,Upfront.Views.UmapView=h})}(jQuery),define("elements/upfront-newnavigation/js/menuitem",["scripts/upfront/link-model"],function(e){return function(t){var n=Upfront.Settings.l10n.newnavigation_element,r=Backbone.View.extend({tagName:"li",contextmenuContext:[],removeContexts:!0,events:{"click i.delete_menu_item":"deleteMenuItem","click i.navigation-add-item":"addMenuItem","contextmenu a.menu_item":"on_context_menu","click a.menu_item":"on_click","touchstart a.menu_item":"on_click","click a.redactor_act":"onOpenPanelClick","click .sub-menu":"onOpenPanelSubMenu","click .upfront-save_settings":"onOpenPanelSubMenu","click .upfront-save_settings":"processPanelsOnSave","click > .open-item-controls":"onOpenItemControlsClick",mouseover:"onItemOver",mouseout:"onItemOut"},initialize:function(t){var r=this;typeof t.model.link=="undefined"&&(t.model.link={type:Upfront.Util.guessLinkType(this.model["menu-item-url"]),url:this.model["menu-item-url"],target:this.model["menu-item-target"]}),this.link=new e(this.model.link),this.parent_view=t.parent_view,this.newitem=t.newitem,this.level=t.level,_.bindAll(this,"render");var i=Upfront.Views.ContextMenuList.extend({initialize:function(e){this.options=e,this.for_view=this.options.for_view,this.menuitems=_([new Upfront.Views.ContextMenuItem({get_label:function(){var e=r.model.link.type;return e=="lightbox"?"Open Lightbox":e=="anchor"?"Scroll to Anchor":e=="entry"?"Visit Post/Page":"Visit Link"},action:function(){Upfront.Util.visitLink(r.model.link.url)}}),new Upfront.Views.ContextMenuItem({get_label:function(){return n.edit_url},action:function(){r.removeContexts=!1,r.editMenuItem()}}),new Upfront.Views.ContextMenuItem({get_label:function(){return n.create_dropdown},action:function(){r.removeContexts=!1,r.createDropDown(r.event)}})])}});this.ContextMenu=Upfront.Views.ContextMenu.extend({initialize:function(e){this.options=e,this.for_view=this.options.for_view,this.menulists=_([new i({for_view:this.for_view})])}}),Upfront.Events.on("entity:contextmenu:deactivate",this.remove_context_menu,this)},loadContexts:function(e){if(this.contextmenuContext.length>10)return;var t=e.parent().parent("ul");t.length>0&&t.hasClass("sub-menu")&&(t.addClass("time_being_display"),this.contextmenuContext.push(t),this.loadContexts(t))},on_click:function(e){var n=t(e.target).parent("li.menu-item");if(n.hasClass("parent")&&n.closest(".upfront-output-unewnavigation").data("style")=="burger"){e.stopPropagation(),n.hasClass("burger_sub_display")?n.removeClass("burger_sub_display"):n.addClass("burger_sub_display");var r=n.closest("ul.menu"),i=n.closest("div.upfront-output-unewnavigation");if(i.data("burger_over")=="pushes"&&(i.data("burger_alignment")=="top"||i.data("burger_alignment")=="whole")){t("section.upfront-layout").css("margin-top",r.height());var s=t("div#upfront-ui-topbar").outerHeight(),o=t(".upfront-ruler-container").outerHeight();r.offset({top:s+o,left:t("section.upfront-layout").offset().left})}}},on_context_menu:function(e){if(Upfront.Settings.Application.no_context_menu)return;e.stopPropagation();if(this.parent_view.$el.find("ul.menu").hasClass("edit_mode"))return;this.closeTooltip(),e.preventDefault(),t(e.target).closest("ul").hasClass("sub-menu")&&(this.contextmenuContext.push(t(e.target).closest("ul").addClass("time_being_display")),this.loadContexts(t(e.target).closest("ul"))),this.event=e,context_menu_view=new this.ContextMenu({model:this.model,for_view:this,el:t(Upfront.Settings.LayoutEditor.Selectors.contextmenu)}),this.context_menu_view=context_menu_view,context_menu_view.render()},remove_context_menu:function(e){if(!this.context_menu_view)return!1;if(this.contextmenuContext.length>0){if(this.removeContexts)for(var n=0;n<this.contextmenuContext.length;n++)this.contextmenuContext[n].removeClass("time_being_display");this.contextmenuContext=[],this.removeContexts=!0}t(Upfront.Settings.LayoutEditor.Selectors.contextmenu).html("").hide(),this.context_menu_view=!1},onOpenPanelClick:function(e){e.preventDefault(),this.toggleLinkPanel()},onOpenPanelSubMenuClick:function(e){this.onOpenPanelSubMenu()},onOpenPanelSubMenu:function(){var e=this;this.$el.hasClass("ui-sortable-handle")&&this.$el.children("ul").children("li").hasClass("controls-visible")?this.$el.children("ul").sortable("disable"):this.$el.addClass("ui-sortable-handle")},processPanelsOnSave:function(){this.parent_view.$el.find("ul.time_being_display").removeClass("time_being_display"),this.toggleLinkPanel(),this.$el.removeClass("controls-visible"),this.setItemControlsState()},toggleLinkPanel:function(){var e=this;this.$el.hasClass("ui-sortable-handle")?(this.$el.removeClass("ui-sortable-handle"),this.$el.addClass("stayOpen controls-visible"),this.$el.parents(".menu").sortable("disable"),this.$el.find(".linkingPanelGoesHere").show()):(this.$el.addClass("ui-sortable-handle"),this.$el.removeClass("stayOpen"),this.$el.parents(".menu").sortable("enable"),this.$el.find(".linkingPanelGoesHere").hide())},render:function(e){var n=this,r='<a class="menu_item uf-click-to-edit-text';return n.newitem&&(r+=" new_menu_item menu_item_placeholder"),r=r+'" ><span class="menu_item-ueditor">'+this.model["menu-item-title"]+'</span></a><i class="delete_menu_item">x</i><span class="open-item-controls"></span>',this.model.link.url.indexOf("#ltb-")>-1&&!Upfront.Util.checkLightbox(this.model.link.url)&&(r+='<span class="missing-lightbox-warning"></span>'),t(this.el).html(r).addClass("menu-item-depth-"+n.level),t(this.el).data("depth",n.level),this.createInlineControlPanel(),t(this.el).data("backboneview",n).addClass("menu-item"),n.newitem&&t(this.el).addClass("new_menu_item"),this},onOpenItemControlsClick:function(){var e=this.$el.parent("ul");typeof e!="undefined"&&e.hasClass("time_being_display")&&e.removeClass("time_being_display"),this.$el.toggleClass("controls-visible"),this.setItemControlsState()},setItemControlsState:function(){if(this.$el.hasClass("controls-visible")){this.controlsVisible=!0,this.$el.siblings().removeClass("controls-visible"),this.$el.data("linkpanel").render(),this.$el.parents(".menu").sortable("disable");var e=this.$el.closest("ul");while(e.length>0&&e.hasClass("sub-menu"))e.addClass("time_being_display"),e=e.parent().parent("ul")}else this.controlsVisible=!1,this.$el.parents(".menu").find(".controls-visible").length===0&&this.$el.parents(".menu").sortable("enable")},createInlineControlPanel:function(){var e=new Upfront.Views.Editor.InlinePanels.ControlPanel,t=new Upfront.Views.Editor.InlinePanels.Controls.VisitLink({url:this.model.link.url}),n=new Upfront.Views.Editor.InlinePanels.Controls.LinkPanel({model:this.link,button:!1,icon:"link",tooltip:"link",id:"link"}),r=this;e.items=_([n,t]),this.listenTo(this.link,"change",function(){r.model.link=r.link.toJSON(),r.model["menu-item-url"]=r.model.link.url,r.model["menu-item-target"]=r.model.link.target,t.setLink(r.model.link.url,r.model.link.type),r.saveLink()}),this.$el.data("linkpanel",n);var i='<div class="uimage-controls image-element-controls upfront-ui"></div>';this.$el.append(i),e.render(),this.$el.find(".uimage-controls").append(e.el),e.delegateEvents()},createDropDown:function(e){var n=t("<ul>").addClass("sub-menu").addClass("time_being_display");t(e.target).closest("li").append(n),this.parent_view.addMenuItem(n),this.parent_view.makeSortable()},addMenuItem:function(e){e.preventDefault(),e.stopPropagation(),this.parent_view.addMenuItem(e)},deleteMenuItem:function(e){var t=this,n=t.$el.parent("ul"),r=t.$el.parent("ul").find("i.navigation-add-item"),i=!1,s=this.parent_view;t.$el.siblings().length<1&&(i=!0);var o=s.new_menu_order(t.model["menu-item-db-id"]);this.closeTooltip(),t.$el.remove(),i&&n.remove(),n.children("li:last").append(r),typeof t.model["menu-item-db-id"]!="undefined"&&Upfront.Util.post({action:"upfront_new_delete_menu_item",menu_item_id:t.model["menu-item-db-id"],new_menu_order:o}).success(function(e){t.$el.find("ul.sub-menu").length>0&&s.render()}).error(function(e){Upfront.Util.log("Error Deleting Menu Item")}),setTimeout(function(){Upfront.Events.trigger("menu_element:edit")},100)},editMenuItem:function(){console.log("toggleLinkPanel"),this.toggleLinkPanel()},getCleanurl:function(e){var t;return e||(e=location.href),e.indexOf("?dev=true")!=-1&&(e=e.replace("?dev=true","")),e.indexOf("#")==-1?e:(t=e.split("#"),t[0].trim()!=""?t[0]:location.href.replace("?dev=true",""))},saveLink:function(e,n){var r=this;if(typeof e!="undefined"&&e){r.deleteMenuItem();return}r.$el.find("a.new_menu_item").removeClass("new_menu_item"),r.$el.removeClass("new_menu_item");var i=t(this.el).children("a.menu_item").length>0?t(this.el).children("a.menu_item"):t(this.el).children("div").children("a.menu_item");!i.hasClass("menu_item_placeholder")&&i.next("a.ueditor-placeholder").length<1?this.model["menu-item-title"]=i.text():this.model["menu-item-title"]="",t(this.el).children("div.redactor_box").length>0&&i.blur();if(r.model["menu-item-title"].trim()==""){if(typeof n=="undefined"||!n){r.deleteMenuItem();return}var s=i.next("a.ueditor-placeholder").text()||(i.is("a.menu_item_placeholder")?i.text():"");r.model["menu-item-title"]=s}var o={action:"upfront_new_update_menu_item",menu:r.parent_view.model.get_property_value_by_name("menu_id"),"menu-item":this.model};typeof this.model["menu-item-db-id"]!="undefined"&&(o["menu-item-id"]=r.model["menu-item-db-id"]),Upfront.Util.post(o).success(function(e){r.model["menu-item-db-id"]=e.data}).error(function(e){Upfront.Util.log("Error updating menu item")})},openTooltip:function(e,n){var r=t("#unewnavigation-tooltip"),i=n.offset(),s={top:i.top+n.outerHeight()+11,left:i.left-98+Math.floor(n.outerWidth()/2)},o="unewnavigation-tooltip-bottom",u=this;r.length||(r=t('<div id="unewnavigation-tooltip" class="upfront-ui"></div>'),t("body").append(r)),r.hide().html(e),i.right=i.left+n.width(),i.left-280<0&&(s.left=i.left+n.width()+20,o="unewnavigation-tooltip-bottom"),r.css(s).addClass(o).show().on("click",function(e){e.stopPropagation()}).on("closed",function(e){u.$el.removeClass("tooltip-open")}),this.$el.addClass("tooltip-open"),val=t("#unewnavigation-tooltip").find("input[name=unavigation-link-type]:checked").val(),val=="anchor"&&this.addAnchorsselect(),val=="lightbox"&&this.addLightboxselect(),Upfront.Events.trigger("entity:settings:deactivate")},closeTooltip:function(){var e=t("#unewnavigation-tooltip");e.hide().trigger("closed"),setTimeout(function(){e.remove()},100)},onItemOver:function(){this.$el.parents(".upfront-module").find(".upfront-resize-handle-s").addClass("active-menu-item")},onItemOut:function(){this.$el.parents(".upfront-module").find(".upfront-resize-handle-s").removeClass("active-menu-item")}});return r}(jQuery)}),define("elements/upfront-newnavigation/js/model",[],function(){var e=Upfront.Models.ObjectModel.extend({init:function(){var e=_.clone(Upfront.data.unewnavigation.defaults);e.element_id=Upfront.Util.get_unique_id(e.id_slug+"-object"),this.init_properties(e)}});return e}),define("elements/upfront-newnavigation/js/element",["elements/upfront-newnavigation/js/model"],function(e){var t=Upfront.Settings.l10n.newnavigation_element,n=Upfront.Views.Editor.Sidebar.Element.extend({priority:60,render:function(){this.$el.addClass("upfront-icon-element upfront-icon-element-nav"),this.$el.html(t.element_name)},add_element:function(){var t=new e,n=new Upfront.Models.Module({name:"",properties:[{name:"element_id",value:Upfront.Util.get_unique_id("module")},{name:"class",value:"c24 upfront-newnavigation_module"},{name:"has_settings",value:0},{name:"row",value:Upfront.Util.height_to_row(75)}],objects:[t]});this.add_module(n)}});return n}),define("text!elements/upfront-newnavigation/tpl/preset-style.html",[],function(){return"#page div.<?php echo $properties['id'] ?> ul.menu {\n	<?php if(!empty($properties['breakpoint']) && !empty($properties['breakpoint']['desktop']) && !empty($properties['breakpoint']['desktop']['menu_alignment'])) { ?>\n		text-align: <?php echo $properties['breakpoint']['desktop']['menu_alignment'] ?>;\n	<?php } else if(!empty($properties['breakpoint']) && !empty($properties['breakpoint']['tablet']) && !empty($properties['breakpoint']['tablet']['menu_alignment'])) { ?>\n		text-align: <?php echo $properties['breakpoint']['tablet']['menu_alignment'] ?>;\n	<?php } else if(!empty($properties['breakpoint']) && !empty($properties['breakpoint']['mobile']) && !empty($properties['breakpoint']['mobile']['menu_alignment'])) { ?>\n		text-align: <?php echo $properties['breakpoint']['mobile']['menu_alignment'] ?>;\n	<?php } else { ?>\n		text-align: <?php echo $properties['menu_alignment'] ?>;\n	<?php } ?>\n}\n\n#page .<?php echo $properties['id'] ?> ul.menu > li.menu-item > a {\n	<?php if(!empty($properties['static-nav-bg'])) { ?>\n	background: <?php echo $properties['static-nav-bg'] ?>;\n	<?php } ?>\n}\n\n#page .<?php echo $properties['id'] ?> ul.menu > li.menu-item > a:hover,\n#page .<?php echo $properties['id'] ?>.live-preview-hover ul.menu > li.menu-item > a {\n	<?php if(!empty($properties['hover-use-color']) && $properties['hover-use-color'] == 'yes' && !empty($properties['hover-nav-bg'])) { ?>\n	background: <?php echo $properties['hover-nav-bg'] ?>;\n	<?php } ?>\n}\n\n#page .<?php echo $properties['id'] ?> ul.menu > li.menu-item > a:focus,\n#page .<?php echo $properties['id'] ?>.live-preview-focus ul.menu > li.menu-item > a {\n	<?php if(!empty($properties['focus-use-color']) && $properties['focus-use-color'] == 'yes' && !empty($properties['focus-nav-bg'])) { ?>\n	background: <?php echo $properties['focus-nav-bg'] ?>;\n	<?php } ?>\n}\n\n\n#page .<?php echo $properties['id'] ?> ul.menu > li.menu-item > a,\n#page .<?php echo $properties['id'] ?> ul.menu > li.menu-item > .redactor-box > a {\n	<?php if(!empty($properties['static-font-color'])) { ?>color: <?php echo $properties['static-font-color']  ?>; <?php } ?>\n	<?php if(!empty($properties['static-font-family'])) { ?>font-family: <?php echo $properties['static-font-family']  ?>; <?php } ?>\n	<?php if(!empty($properties['static-font-size'])) { ?>font-size: <?php echo $properties['static-font-size']  ?>px; <?php } ?>\n	<?php if(!empty($properties['static-weight'])) { ?>font-weight: <?php echo $properties['static-weight']  ?>;<?php } ?>\n	<?php if(!empty($properties['static-style'])) { ?>font-style: <?php echo $properties['static-style']  ?>;<?php } ?>\n	<?php if(!empty($properties['static-line-height'])) { ?>line-height: <?php echo $properties['static-line-height']  ?>;<?php } ?>\n}\n\n#page .<?php echo $properties['id'] ?> ul.menu > li.menu-item > a:hover,\n#page .<?php echo $properties['id']  ?>.upfront-navigation.live-preview-hover ul.menu > li.menu-item > a {\n	<?php if(!empty($properties['hover-use-typography'])) { ?>\n		<?php if(!empty($properties['hover-font-color'])) { ?>color: <?php echo $properties['hover-font-color']  ?>; <?php } ?>\n		<?php if(!empty($properties['hover-font-family'])) { ?>font-family: <?php echo $properties['hover-font-family']  ?>; <?php } ?>\n		<?php if(!empty($properties['hover-font-size'])) { ?>font-size: <?php echo $properties['hover-font-size']  ?>px; <?php } ?>\n		<?php if(!empty($properties['hover-weight'])) { ?>font-weight: <?php echo $properties['hover-weight']  ?>;<?php } ?>\n		<?php if(!empty($properties['hover-style'])) { ?>font-style: <?php echo $properties['hover-style']  ?>;<?php } ?>\n		<?php if(!empty($properties['hover-line-height'])) { ?>line-height: <?php echo $properties['hover-line-height']  ?>;<?php } ?>\n	<?php } else { ?>\n		<?php if(!empty($properties['static-font-color'])) { ?>color: <?php echo $properties['static-font-color']  ?>; <?php } ?>\n		<?php if(!empty($properties['static-font-family'])) { ?>font-family: <?php echo $properties['static-font-family']  ?>; <?php } ?>\n		<?php if(!empty($properties['static-font-size'])) { ?>font-size: <?php echo $properties['static-font-size']  ?>px; <?php } ?>\n		<?php if(!empty($properties['static-weight'])) { ?>font-weight: <?php echo $properties['static-weight']  ?>;<?php } ?>\n		<?php if(!empty($properties['static-style'])) { ?>font-style: <?php echo $properties['static-style']  ?>;<?php } ?>\n		<?php if(!empty($properties['static-line-height'])) { ?>line-height: <?php echo $properties['static-line-height']  ?>;<?php } ?>\n	<?php } ?>\n}\n\n#page .<?php echo $properties['id'] ?> ul.menu > li.menu-item > a:focus,\n#page .<?php echo $properties['id']  ?>.upfront-navigation.live-preview-focus ul.menu > li.menu-item > a {\n	<?php if(!empty($properties['focus-use-typography'])) { ?>\n		<?php if(!empty($properties['focus-font-color'])) { ?>color: <?php echo $properties['focus-font-color']  ?>; <?php } ?>\n		<?php if(!empty($properties['focus-font-family'])) { ?>font-family: <?php echo $properties['focus-font-family']  ?>; <?php } ?>\n		<?php if(!empty($properties['focus-font-size'])) { ?>font-size: <?php echo $properties['focus-font-size']  ?>px; <?php } ?>\n		<?php if(!empty($properties['focus-weight'])) { ?>font-weight: <?php echo $properties['focus-weight']  ?>;<?php } ?>\n		<?php if(!empty($properties['focus-style'])) { ?>font-style: <?php echo $properties['focus-style']  ?>;<?php } ?>\n		<?php if(!empty($properties['focus-line-height'])) { ?>line-height: <?php echo $properties['focus-line-height']  ?>;<?php } ?>\n	<?php } else { ?>\n		<?php if(!empty($properties['static-font-color'])) { ?>color: <?php echo $properties['static-font-color']  ?>; <?php } ?>\n		<?php if(!empty($properties['static-font-family'])) { ?>font-family: <?php echo $properties['static-font-family']  ?>; <?php } ?>\n		<?php if(!empty($properties['static-font-size'])) { ?>font-size: <?php echo $properties['static-font-size']  ?>px; <?php } ?>\n		<?php if(!empty($properties['static-weight'])) { ?>font-weight: <?php echo $properties['static-weight']  ?>;<?php } ?>\n		<?php if(!empty($properties['static-style'])) { ?>font-style: <?php echo $properties['static-style']  ?>;<?php } ?>\n		<?php if(!empty($properties['static-line-height'])) { ?>line-height: <?php echo $properties['static-line-height']  ?>;<?php } ?>\n	<?php } ?>\n}\n\n<?php if(!empty($properties['tablet'])) { ?>\n#page.tablet-breakpoint div.<?php echo $properties['id'] ?> ul.menu {\n	<?php if(!empty($properties['tablet']['menu_alignment'])) { ?>text-align: <?php echo $properties['tablet']['menu_alignment'] ?>;<?php } ?>\n}\n<?php if(!empty($properties['tablet']['preset_style'])) { ?><?php echo $properties['tablet']['preset_style'] ?><?php } ?>\n<?php } ?>\n\n<?php if(!empty($properties['mobile'])) { ?>\n#page.mobile-breakpoint div.<?php echo $properties['id'] ?> ul.menu {\n	<?php if(!empty($properties['mobile']['menu_alignment'])) { ?>text-align: <?php echo $properties['mobile']['menu_alignment'] ?>;<?php } ?>\n}\n<?php if(!empty($properties['mobile']['preset_style'])) { ?><?php echo $properties['mobile']['preset_style'] ?><?php } ?>\n<?php } ?>\n\n<?php if(!empty($properties['breakpoint']) && !empty($properties['breakpoint']['desktop']) && !empty($properties['breakpoint']['desktop']['preset_style'])) { ?>\n	<?php if(!empty($properties['breakpoint']['desktop']['preset_style'])) { ?><?php echo $properties['breakpoint']['desktop']['preset_style'] ?><?php } ?>\n<?php } else { ?>\n	<?php if(!empty($properties['preset_style'])) { ?><?php echo $properties['preset_style'] ?><?php } ?>\n<?php } ?>"}),define("elements/upfront-newnavigation/js/settings/appearance-panel",["scripts/upfront/preset-settings/util","text!elements/upfront-newnavigation/tpl/preset-style.html"],function(e,t){var n=Upfront.Settings.l10n.newnavigation_element,r={mainDataCollection:"navPresets",styleElementPrefix:"nav-preset",ajaxActionSlug:"nav",panelTitle:n.settings,presetDefaults:Upfront.mainData.presetDefaults.nav,styleTpl:t,stateModules:{Global:[{moduleType:"MenuStyle",options:{title:n.panel.menu_kind_label,state:"global"}}],Static:[{moduleType:"Typography",options:{title:n.panel.typography_label,state:"static",toggle:!1,fields:{typeface:"static-font-family",fontstyle:"static-font-style",weight:"static-weight",style:"static-style",size:"static-font-size",line_height:"static-line-height",color:"static-font-color"}}},{moduleType:"Colors",options:{title:n.panel.colors_label,multiple:!1,single:!0,abccolors:[{name:"static-nav-bg",label:n.panel.item_background_label}]}}],Hover:[{moduleType:"Typography",options:{title:n.panel.typography_label,state:"hover",toggle:!0,prepend:"hover-",prefix:"static",fields:{use:"hover-use-typography",typeface:"hover-font-family",fontstyle:"hover-font-style",weight:"hover-weight",style:"hover-style",size:"hover-font-size",line_height:"hover-line-height",color:"hover-font-color"}}},{moduleType:"Colors",options:{title:n.panel.colors_label,multiple:!1,single:!0,toggle:!0,prepend:"hover-",prefix:"static",fields:{use:"hover-use-color"},abccolors:[{name:"hover-nav-bg",label:n.panel.item_background_label}]}}],Focus:[{moduleType:"Typography",options:{title:n.panel.typography_label,state:"focus",toggle:!0,prepend:"focus-",prefix:"static",fields:{use:"focus-use-typography",typeface:"focus-font-family",fontstyle:"focus-font-style",weight:"focus-weight",style:"focus-style",size:"focus-font-size",line_height:"focus-line-height",color:"focus-font-color"}}},{moduleType:"Colors",options:{title:n.panel.colors_label,multiple:!1,single:!0,toggle:!0,prepend:"focus-",prefix:"static",fields:{use:"focus-use-color"},abccolors:[{name:"focus-nav-bg",label:n.panel.item_background_label}]}}]},migrateDefaultStyle:function(e){return e=e.replace(/(div)?\.upfront-navigation\s/g,""),e=e.replace(/(div)?\.upfront-object\s/g,""),e},migratePresetProperties:function(e){var t={};this.model.get("properties").each(function(e){t[e.get("name")]=e.get("value")}),t.breakpoint?(t.breakpoint.desktop&&(t.breakpoint.desktop.burger_menu==="yes"&&(t.breakpoint.desktop.menu_style="burger"),delete t.breakpoint.desktop.burger_menu),t.breakpoint.tablet&&(t.breakpoint.tablet.burger_menu==="yes"&&(t.breakpoint.tablet.menu_style="burger"),delete t.breakpoint.tablet.burger_menu),t.breakpoint.mobile&&(t.breakpoint.mobile.burger_menu==="yes"&&(t.breakpoint.mobile.menu_style="burger"),delete t.breakpoint.mobile.burger_menu)):t.breakpoint={desktop:{},tablet:{},mobile:{}},e.set({breakpoint:t.breakpoint})}};return e.generatePresetsToPage("nav",t),r}),define("elements/upfront-newnavigation/js/settings",["scripts/upfront/element-settings/settings","scripts/upfront/element-settings/root-settings-panel","elements/upfront-newnavigation/js/settings/appearance-panel","elements/upfront-newnavigation/js/menu-util"],function(e,t,n,r){var i=Upfront.Settings.l10n.newnavigation_element,s=function(){return _.union([{label:i.create_new,value:-1}],r.getSelectMenuOptions())},o=t.extend({className:"upfront-settings_panel_wrap menu-settings",title:i.mnu.title,initialize:function(e){var t=this;this.constructor.__super__.initialize.call(this,e),Upfront.Events.on("menu_element:menu_created",function(e){var n=t.getSelectMenuField();n.options.values=s(),n.render(),n.set_value(e.term_id)}),this.listenTo(this.model.get("properties"),"change",function(e){if(!e)return;if(e.get("name")!=="menu_slug"&&e.get("name")!=="menu_id")return;var n=t.getSelectMenuField();n.set_value(t.model.get("properties").findWhere({name:"menu_id"}).get("value"))})},getSelectMenuField:function(){var e=this.settings.findWhere({identifier:"selectMenuModule"});return e.fields.findWhere({identifier:"selectMenuField"})},settings:[{type:"SettingsItem",identifier:"selectMenuModule",className:"select-menu-box select-presets",fields:[{type:"Select",property:"menu_id",label:i.mnu.load,className:"select-menu-field",identifier:"selectMenuField",values:s,change:function(e,t){if(e==-1){t.model.set_property("menu_slug",!1,!0),t.model.set_property("menu_id",!1),t.$el.find(".select-menu-box").addClass("create-new");return}t.$el.find(".select-menu-box").removeClass("create-new");var n=r.getMenuSlugById(e);t.model.set_property("menu_id",e,!0),t.model.set_property("menu_slug",n)}},{type:"Button",label:i.mnu.delete_menu,className:"delete-menu-button delete_preset",on_click:function(){if(confirm(i.are_you_sure_nag)){var e=this.model.get_property_value_by_name("menu_id");Upfront.Events.trigger("menu_element:delete",e);var t=this.panel.getSelectMenuField();t.options.values=s(),t.render(),t.set_value("-1")}}}]},{type:"MenuStructure",identifier:"menuStructureModule"}],save_settings:function(){Upfront.Events.trigger("menu_element:settings:saving"),o.__super__.save_settings.apply(this,arguments),this.model.set_property("menu_items",!1,!0)}}),u=e.extend({initialize:function(e){this.constructor.__super__.initialize.call(this,e);var t=this;this.listenTo(this.appearancePanel,"upfront:presets:setup-items",function(){var e=t.appearancePanel,n=e.property("preset")?e.clear_preset_name(e.property("preset")):"default",r=e.presets.findWhere({id:n}),i=Upfront.Views.breakpoints_storage.get_breakpoints(),s=i.get_active(),o=r.get("breakpoint")||{},u=!1;if(!o[s.id]||!o[s.id].menu_style){var a=_.filter(i.models,function(e){return e.get("width")>s.get("width")});a=_.sortBy(a,function(e){return e.get("width")});for(var f=0;f<a.length;f++){o[s.id]=_.clone(o[a[f].id]);if(o[s.id]){console.log("from "+a[f].id+" to "+s.id);break}}o[s.id]&&(u=!0)}o[s.id]&&o[s.id].menu_style==="burger"&&!o[s.id].burger_alignment&&(o[s.id].burger_alignment="left",u=!0),u&&r.set("breakpoint",o)})},hasBreakpointSettings:!0,breakpointSpecificPresetSettings:[{name:"menu_alignment"},{name:"burger_alignment"},{name:"is_floating"},{name:"burger_over"},{name:"menu_style"},{name:"width"}],panels:{General:o,Appearance:n},onSaveSettings:function(){var e=_.findWhere(this.for_view.existingMenus,{term_id:this.model.get_property_value_by_name("menu_id")});e&&this.model.set_property("menu_slug",e.slug,!0)},render:function(){this.constructor.__super__.render.call(this);var e=this;this.currentState="",this.listenTo(this.appearancePanel,"upfront:presets:state_show",function(t){e.currentState=t}),this.listenTo(this.for_view,"rendered",function(){e.currentState&&e.stateShow(e.currentState)})},title:i.settings});return u}),function(e){define("elements/upfront-newnavigation/js/floating",[],function(){var t=e(window),n={},r=function(n){var r=0,i={top:0,left:0},s={width:0,height:0},o=n,u=function(){$current_offset=o.offset(),o.attr("data-already_floating","yes"),o.closest(".upfront-wrapper").css("z-index",999),o.hasClass("responsive_nav_toggler")?o.offset($current_offset):o.css(s),r>0&&o.css("margin-top",r)},a=function(){o.attr("style","").attr("data-already_floating","no"),o.closest(".upfront-wrapper").css("z-index",""),r>0&&o.css("margin-top","")},f=function(){var n=t.scrollTop(),s=e("section.upfront-layout").css("margin-top")?parseInt(e("section.upfront-layout").css("margin-top")):0;n>i.top+s-r&&!o.is('[data-already_floating="yes"]')?u():n<=i.top+s-r&&o.is('[data-already_floating="yes"]')&&a()},l=function(){i={top:0,left:0},s={width:0,height:0},o=!1,t.off("scroll",f)},c=function(){i=o.offset(),s={width:o.width(),height:o.height()},t.off("scroll",f).on("scroll",f);var n=e("#upfront-ui-topbar").length>0?e("#upfront-ui-topbar").outerHeight():0,u=e(".upfront-ruler-container").length>0?e(".upfront-ruler-container").outerHeight():0;r=n+u};return c(),{destroy:l}};return r})}(jQuery),function(e){define("unewnavigation",["elements/upfront-newnavigation/js/menuitem","elements/upfront-newnavigation/js/model","elements/upfront-newnavigation/js/element","elements/upfront-newnavigation/js/settings","text!elements/upfront-newnavigation/tpl/preset-style.html","scripts/upfront/preset-settings/util","elements/upfront-newnavigation/js/floating","elements/upfront-newnavigation/js/menu-util"],function(t,n,r,i,s,o,u,a){var f=Upfront.Settings.l10n.newnavigation_element,l=0,c="",h=Upfront.Views.ObjectView.extend({elementSize:{width:0,height:0},initialize:function(e){var t=this;this.elementClasses=this.$el.attr("class"),this.model instanceof n||(this.model=new n({properties:this.model.get("properties")})),Upfront.Views.ObjectView.prototype.initialize.call(this),this.events=_.extend({},this.events,{"click a.menu_item":"exitEditMode","dblclick a.menu_item":"editMenuItem"}),this.listenTo(Upfront.Events,"theme_colors:update",this.update_colors,this),this.listenTo(Upfront.Events,"menu_element:delete",this.delete_menu,this),this.listenTo(this.model,"preset:updated",this.preset_updated);var r=this.model.get_property_value_by_name("menu_id");!this.model.get_property_by_name("allow_new_pages")||this.model.get_property_by_name("allow_new_pages").on("change",this.update_auto_add_pages,this),this.property("menu_items",!1,!0),this.on("deactivated",this.onDeactivate,this),this.listenTo(Upfront.Events,"upfront:layout_size:change_breakpoint",function(e,n){t.render(),setTimeout(function(){t.activate_responsive_nav(t.$el.find(".upfront-output-unewnavigation"),e.width)},100)}),this.listenTo(Upfront.Events,"application:mode:before_switch",function(){if(!Upfront.Application.layout_ready)return;var e=Upfront.Views.breakpoints_storage.get_breakpoints().get_active();t.render(),setTimeout(function(){t.activate_responsive_nav(t.$el.find(".upfront-output-unewnavigation"),e.get("width"))},100)}),this.listenTo(Upfront.Events,"entity:drag_stop",this.onElementReposition)},on_element_resize:function(e){this.processFloatStatus()},on_after_layout_render:function(){var e=this;setTimeout(function(){e.processFloatStatus()},2e3)},get_preset_properties:function(){var e=this.model.get_property_value_by_name("preset"),t=o.getPresetProperties("nav",e)||{};return t},preset_updated:function(){this.render()},update_colors:function(){var e=this.get_preset_properties();if(_.size(e)<=0)return!1;o.updatePresetStyle("nav",e,s)},onElementReposition:function(){this.processFloatStatus()},processFloatStatus:function(){this.floating_cache&&this.floating_cache.destroy(),$upfrontObjectContent=this.$el.find(".upfront-object-content");var e=$upfrontObjectContent.attr("data-isfloating"),t=this.property("usingNewAppearance");e&&e=="yes"&&(t?this.get_preset_properties().breakpoint[Upfront.Views.breakpoints_storage.get_breakpoints().get_active().id].menu_style==="burger"?this.floating_cache=new u($upfrontObjectContent.children(".responsive_nav_toggler")):this.floating_cache=new u($upfrontObjectContent):this.property("burger_menu")=="yes"?this.floating_cache=new u($upfrontObjectContent.children(".responsive_nav_toggler")):this.floating_cache=new u($upfrontObjectContent))},exitEditMode:function(t){var n=this,r=e(t.target).closest("li").data("backboneview");if(!e(t.target).hasClass("ueditable")){var i=!1;this.$el.find("li.edit_mode").each(function(){try{e(this).children("a.menu_item").find(".menu_item-ueditor").data("ueditor").stop(),e(this).removeClass("edit_mode"),e(this).data("backboneview").model["being-edited"]=!1}catch(t){}i=!0});if(i)return}if(e(t.target).closest(".redactor_box").length>0)return},editMenuItem:function(t){this.editModeOn(t);var n=this,r,i;typeof t.target=="undefined"||t.target.trim==""?r=e(t):r=e(t.target),r.hasClass("menu_item")||(r=r.closest("a.menu_item"));if(r.length<1)return;if(r.closest("li").hasClass("edit_mode"))return;typeof t.target!="undefined"&&(t.preventDefault(),t.stopPropagation()),r.hasClass("ueditor-placeholder")&&(r=r.siblings("a.menu_item")),r.closest("li").addClass("edit_mode"),i=r.children(".menu_item-ueditor");var s=i.data("ueditor");s=null,i.data("ueditor",""),i.data("ueditor")?(i.data("ueditor").start(),i.focus()):(i.ueditor({linebreaks:!0,disableLineBreak:!0,focus:!0,tabFocus:!1,air:!1,allowedTags:["h5"],placeholder:"Link Name",autoexit:!0}).on("start",function(e){i.attr("tabIndex",1),i.focus()}).on("keydown",function(e){e.which==8?setTimeout(function(){if(i.text()==""&&!r.hasClass("menu_item_placeholder")){var e=jQuery.Event("keydown");e.which=8,i.trigger(e)}},100):e.which==27?r.hasClass("new_menu_item")&&r.closest("li").data("backboneview").saveLink(!0):e.which==9?(e.preventDefault(),r.hasClass("new_menu_item")||(i.blur(),r.closest("ul").children("li:last").children("i.navigation-add-item").trigger("click"))):e.which==13&&(r.closest("li").data("backboneview").model["being-edited"]=!1,setTimeout(function(){i.blur()},100)),i.text().trim()!=""?r.removeClass("menu_item_placeholder"):r.addClass("menu_item_placeholder")}).on("blur",function(t){var n=!1;r.closest("li").data("backboneview").model["being-edited"]&&(n=r.closest("li").data("backboneview").model["being-edited"]);if(e(t.relatedTarget).closest(".redactor_toolbar").length>0||n||e("#upfront-popup").hasClass("upfront-postselector-popup")&&e("#upfront-popup").css("display")=="block")return;i.data("ueditor").stop(),r.closest("li").removeClass("edit_mode"),r.hasClass("new_menu_item")||r.closest("li").data("backboneview").saveLink()}).on("stop",function(){n.editModeOff()}),i.data("ueditor").start(),i.focus());var o=r.closest("ul");while(o.length>0&&o.hasClass("sub-menu"))o.addClass("time_being_display"),o=o.parent().parent("ul")},editModeOn:function(t){this.$el.find(".upfront-object-content ul").each(function(){e(this).hasClass("ui-sortable")&&e(this).sortable("disable")})},editModeOff:function(){var t=this;this.$el.find(".upfront-object-content ul").each(function(){if(e(this).hasClass("redactor-toolbar")||e(this).hasClass("upfront-field-select-options"))return;t.$el.find("li.menu-item.controls-visible").length<1&&e(this).hasClass("ui-sortable")&&e(this).sortable("enable")})},onDeactivate:function(t){this.$el.find("li.edit_mode").data("backboneview")&&(this.$el.find("li.edit_mode").data("backboneview").model["being-edited"]=!1),this.$el.find("li.edit_mode a.menu_item .menu_item-ueditor").blur(),this.editModeOff(),(!e("#upfront-popup").hasClass("upfront-postselector-popup")||!e("#upfront-popup").css("display")=="block")&&this.$el.find(".time_being_display").removeClass("time_being_display");var n=this.$el.find("li.controls-visible");n.length>0&&(n.removeClass("controls-visible"),n.data("backboneview").setItemControlsState())},property:function(e,t,n){return typeof t!="undefined"?this.model.set_property(e,t,n):this.model.get_property_value_by_name(e)},update_auto_add_pages:function(){var e=this.model.get_property_value_by_name("menu_id"),t=this.property("allow_new_pages"),n=Upfront.data.navigation.auto_add.auto_add,r;if(!e)return!1;e=parseInt(this.model.get_property_value_by_name("menu_id"),10),n||(n=[]),t[0]==["yes"]?n.indexOf(e)==-1&&n.push(e):-1!==(r=n.indexOf(e))&&n.splice(r,1),Upfront.data.navigation.auto_add?Upfront.data.navigation.auto_add.auto_add=n:Upfront.data.navigation.auto_add={0:!1,auto_add:[]},Upfront.Util.post({action:"upfront_new_update_auto_add_pages",nav_menu_option:JSON.stringify(Upfront.data.navigation.auto_add)}).error(function(e){Upfront.Util.log("Cannot update auto add pages!")})},auto_add_pages:function(){var e=parseInt(this.model.get_property_value_by_name("menu_id"),10);Upfront.data.navigation.auto_add.auto_add?-1!==Upfront.data.navigation.auto_add.auto_add.indexOf(e)?this.model.set_property("allow_new_pages",["yes"],!0):this.model.set_property("allow_new_pages",["no"],!0):this.model.set_property("allow_new_pages",["no"],!0)},display_menu_list:function(){var e=this,t=[{label:f.choose_existing_menu,value:0}],n=a.getSelectMenuOptions(),r=[];typeof n!="undefined"&&(r=t.concat(n)),e.$el.find("div.upfront-object-content").html("");var i=new Upfront.Views.Editor.Field.Select({model:e.model,label:"",className:"existing_menu_list",values:r});i.render(),e.$el.find("div.upfront-object-content").append(i.el).append("<span> or </span>");var s=new Upfront.Views.Editor.Field.Text({model:e.model,label:f.new_menu_name,className:"new_menu_name",compact:!0});s.render(),e.$el.find("div.upfront-object-content").append(s.el);var o=new Upfront.Views.Editor.Field.Button({model:e.model,label:f.create_new,className:"new_menu_button",compact:!0});o.render(),e.$el.find("div.upfront-object-content").append(o.el),e.$el.find("div.upfront-object-content > div.new_menu_name").on("mouseover",function(){e.$el.parent().parent().parent().draggable("disable")}).on("keydown",function(t){t.which==13&&e.$el.find("div.upfront-object-content > div.new_menu_button > input").trigger("click")}),e.$el.find("div.upfront-object-content > div.new_menu_name").on("mouseout",function(){e.$el.parent().parent().parent().draggable("enable")}),e.$el.find("div.upfront-object-content > div.existing_menu_list").on("mouseover",function(){e.$el.parent().parent().parent().draggable("disable")}),e.$el.find("div.upfront-object-content > div.existing_menu_list").on("mouseout",function(){e.$el.parent().parent().parent().draggable("enable")}),e.$el.find("div.upfront-object-content > div.existing_menu_list > div").on("click",function(){e.parent_module_view.$el.parent().trigger("mouseup")}),e.$el.find("div.upfront-object-content > div.new_menu_button > input").on("click",function(){e.$el.find("div.upfront-object-content > div.new_menu_name input").val()!=""&&e.create_new_menu(e.$el.find("div.upfront-object-content > div.new_menu_name input").val())}),e.$el.find("div.upfront-object-content > div.existing_menu_list input").on("change",function(){e.$el.parent().parent().parent().draggable("enable");if(e.$el.find("div.upfront-object-content > div.existing_menu_list input:checked").val()!=0){var t=e.$el.find("div.upfront-object-content > div.existing_menu_list input:checked").val();e.property("menu_id",t,!0),e.property("menu_slug",a.getMenuSlugById(t))}})},create_new_menu:function(e){var t=this,n=Upfront.Util.post({action:"upfront_new_create_menu",menu_name:e}).success(function(e){t.property("menu_slug",e.data.slug,!0),t.property("menu_id",e.data.term_id),Upfront.Events.trigger("menu_element:menu_created",e.data)}).error(function(e){Upfront.Util.log("Error creating menu")})},delete_menu:function(e){var t=this,n=Upfront.Util.post({action:"upfront_new_delete_menu",menu_id:e}).success(function(e){Upfront.Events.trigger("menu_element:menu_deleted",e.data)}).error(function(e){Upfront.Util.log("Error deleting menu")})},get_content_markup:function(){var e=this.model.get_property_value_by_name("menu_id"),t=this,n=this.model.get_property_value_by_name("menu_slug");return properties=this.get_preset_properties(),e?(Upfront.Util.post({action:"upfront_new_load_menu_array",data:e}).success(function(e){if(!e.data){t.$el.find(".upfront-object-content").html("Please add menu items");return}t.property("menu_items",e.data,!0),t.generate_menu()}).error(function(e){Upfront.Util.log("Error loading menu")}),"Loading"):(typeof (n!="undefined")&&n!=""&&this.set_menu_id_from_slug(n),"")},set_menu_id_from_slug:function(e){var t=this;Upfront.Util.post({action:"upfront_new_menu_from_slug",data:e}).success(function(e){t.property("menu_id",e.data)}).error(function(e){Upfront.Util.log("Error loading menu from slug")})},on_render:function(){var e=this,t=this.get_preset_properties();this.property("menu_id")||this.display_menu_list();var n,r=this.property("allow_sub_nav"),i=this.property("is_floating"),s;_.isUndefined(t.breakpoint)&&(t.breakpoint={desktop:{},tablet:{},mobile:{}}),_.isUndefined(t.breakpoint.desktop)&&(t.breakpoint.desktop={}),n=t.breakpoint.desktop.menu_style,n=n?n:this.property("menu_style"),t.breakpoint.desktop.menu_alignment||(t.breakpoint.desktop.menu_alignment=this.property("menu_alignment")),s=this.$el.find(".upfront-object-content"),setTimeout(function(){var n=e.model.get_property_value_by_name("breakpoint"),r=Upfront.Views.breakpoints_storage.get_breakpoints().get_active();n?(s.attr("data-breakpoints",JSON.stringify(n)),e.property("preset")&&e.property("preset")!=="default"&&s.attr("data-breakpoints",JSON.stringify(t.breakpoint)),setTimeout(function(){e.activate_responsive_nav(s,r.get("width"))},100)):e.property("preset")&&(s.attr("data-breakpoints",JSON.stringify(t.breakpoint)),setTimeout(function(){e.activate_responsive_nav(s,r.get("width"))},100)),e.$el.closest(".upfront-module").addClass("upfront-module-has-nav")},300),s.attr("data-stylebk",n?n:"horizontal"),s.attr("data-style",n?n:"horizontal"),s.attr("data-alignment",t.breakpoint.desktop.menu_alignment),s.attr("data-isfloating",i?i:"no"),s.attr("data-allow-sub-nav",r.length!==0&&r[0]=="yes"?r[0]:"no"),setTimeout(function(){e.$el.height()<80?e.$el.closest("div.upfront-module").addClass("newnavigation_squished"):e.$el.closest("div.upfront-module").removeClass("newnavigation_squished")},200),this.$el.off("click",".responsive_nav_toggler, .burger_overlay"),this.$el.on("click",".responsive_nav_toggler, .burger_overlay",function(t){e.toggle_responsive_nav(t),t.stopPropagation()}),this.$el.find(".upfront-output-unewnavigation").addClass("upfront-navigation"),this.trigger("rendered")},renderResponsiveNavigation:function(t){var n=this,r=e("div.upfront-regions").offset(),i=e("div.upfront-regions").outerWidth(),s=e(window).width(),o=e("div#sidebar-ui").outerWidth(),u=e("div#upfront-ui-topbar").length>0?e("div#upfront-ui-topbar").outerHeight():0,a=e(".upfront-ruler-container").length>0?e(".upfront-ruler-container").outerHeight():0,f=this.property("usingNewAppearance"),l=Upfront.Views.breakpoints_storage.get_breakpoints(),c=l.get_active(),h=f?this.get_preset_properties().breakpoint:this.fallbackBreakpointData(),p=(h||{})[c.id]||{},d=c.get_property_value_by_name("width"),v=typeof d!="undefined"&&!c.get("default")?parseInt(d,10):e(window).width();if(!p||!p.menu_style){var m=_.filter(l.models,function(e){return e.get("width")>c.get("width")});m=_.sortBy(m,function(e){return e.get("width")});for(var g=0;g<m.length;g++){typeof h!="undefined"&&(p=h[m[g].id]);if(p)break}}p&&p.menu_style==="burger"&&!p.burger_alignment&&(p.burger_alignment="left");if(p.menu_style==="burger"){t.addClass("triggered-menu"),t.attr("data-style","burger"),t.attr("data-burger_alignment",p.burger_alignment),t.attr("data-burger_over",p.burger_over),t.attr("data-alignment",p.menu_alignment),t.find("div.responsive_nav_toggler").length||t.prepend(e('<div class="responsive_nav_toggler"><div></div><div></div><div></div></div>').data("view",n)),t.find("li.menu-item-has-children").each(function(){if(t.children("a").length&&t.children("a").attr("href")){var e=t.clone().removeClass("menu-item-has-children").addClass("active-clone").removeAttr("id");e.children("ul").remove(),t.children("ul").prepend(e),t.children("a").removeAttr("href")}});if(t.hasClass("upfront-output-unewnavigation")){e("head").find("style#responsive_nav_sidebar_offset").remove();var y='div.upfront-navigation div[data-style="burger"][ data-burger_alignment="top"] ul.menu, div.upfront-navigation div[data-style="burger"][data-burger_alignment="whole"] ul.menu {left:'+parseInt(r.left,10)+"px;} ";y=y+'div.upfront-navigation div[data-style="burger"][ data-burger_alignment="top"] ul.menu, div.upfront-navigation div[data-style="burger"][ data-burger_alignment="whole"] ul.menu {right: inherit; width:'+(parseInt(v)<parseInt(s-o)?parseInt(v):parseInt(s-o))+"px !important; } ",y=y+'div.upfront-navigation div[data-style="burger"][ data-burger_alignment="left"] ul.menu {left:'+parseInt(r.left)+"px !important; right:inherit !important; width:"+(parseInt(.3*i)+40)+"px !important;} ",y=y+'div.upfront-navigation div[data-style="burger"][ data-burger_alignment="right"] ul.menu {left:inherit !important; right:'+(parseInt((s-v-o)/2)>0?parseInt((s-v-o)/2-(e(document).width()>s+6?30:0)):0)+"px !important; width:"+(parseInt(.3*i)+40)+"px !important; } ",y=y+'div.upfront-navigation div[data-style="burger"]:not([data-burger_over="pushes"]) ul.menu {top:'+(parseInt(u)+parseInt(a))+"px !important; } ",e("head").append(e('<style id="responsive_nav_sidebar_offset">'+y+"</style>"))}n.hideMenu(t.find("ul.menu"))}else t.removeClass("triggered-menu"),t.attr("data-style",p.menu_style),t.attr("data-alignment",p.menu_alignment),t.removeAttr("data-burger_alignment"),t.removeAttr("data-burger_over"),t.find("div.responsive_nav_toggler").remove(),n.showMenu(t.find("ul.menu")),t.find("li.active-clone").each(function(){t.parent().parent().children("a").attr("href",t.children("a").attr("href")),t.remove()}),t.find("ul.menu, ul.sub-menu").each(function(){t.css("display","")}),e("div#wpadminbar").length&&t.find("ul.menu").css("margin-top","");t.attr("data-isfloating",p.is_floating),Upfront.Events.trigger("entity:object:refresh",this)},fallbackBreakpointData:function(){var e=this.property("breakpoint");if(e!==!1&&_.isObject(e)&&"desktop"in e){for(key in e){if(!_.isObject(e[key]))continue;"burger_menu"in e[key]&&e[key].burger_menu==="yes"&&(e[key].menu_style="burger",delete e[key].burger_menu)}return e}return{desktop:{},tablet:{},mobile:{}}},activate_responsive_nav:function(e,t){if(this.property("preset")){this.renderResponsiveNavigation(e);return}this.fallbackToOldResponsiveNav(e,t)},fallbackToOldResponsiveNav:function(t,n){var r=this,i=t.data("breakpoints"),s=new Array,o=typeof n!="undefined"?parseInt(n):e(window).width();for(var u in i)s.push(i[u]);s.sort(function(e,t){return e.width-t.width});var a=e("div.upfront-regions").offset(),f=e("div.upfront-regions").outerWidth(),l=e(window).width(),c=e("div#sidebar-ui").outerWidth(),h=e("div#upfront-ui-topbar").outerHeight();ruler_height=e(".upfront-ruler-container").outerHeight();for(var u in s)if(parseInt(o)>=parseInt(s[u].width)){if(s[u]["burger_menu"]=="yes"){t.addClass("triggered-menu"),t.attr("data-style","burger"),t.attr("data-burger_alignment",s[u].burger_alignment),t.attr("data-burger_over",s[u].burger_over),t.attr("data-alignment",s[u].menu_alignment?s[u].menu_alignment:t.data("alignmentbk")),t.find("div.responsive_nav_toggler").length||t.prepend(e('<div class="responsive_nav_toggler"><div></div><div></div><div></div></div>').data("view",r)),t.find("li.menu-item-has-children").each(function(){if(t.children("a").length&&t.children("a").attr("href")){var e=t.clone().removeClass("menu-item-has-children").addClass("active-clone").removeAttr("id");e.children("ul").remove(),t.children("ul").prepend(e),t.children("a").removeAttr("href")}});if(t.hasClass("upfront-output-unewnavigation")){e("head").find("style#responsive_nav_sidebar_offset").remove();var p='div.upfront-navigation div[data-style="burger"][ data-burger_alignment="top"][data-burger_over="over"] ul.menu, div.upfront-navigation div[data-style="burger"][data-burger_over="over"][data-burger_alignment="whole"] ul.menu {left:'+parseInt(a.left)+"px !important;} ";p=p+'div.upfront-navigation div[data-style="burger"][ data-burger_alignment="top"] ul.menu, div.upfront-navigation div[data-style="burger"][ data-burger_alignment="whole"] ul.menu {right: inherit; width:'+(parseInt(o)<parseInt(l-c)?parseInt(o):parseInt(l-c))+"px !important; } ",p=p+'div.upfront-navigation div[data-style="burger"][ data-burger_alignment="left"] ul.menu {left:'+parseInt(a.left)+"px !important; right:inherit !important; width:"+(parseInt(.3*f)+40)+"px !important;} ",p=p+'div.upfront-navigation div[data-style="burger"][ data-burger_alignment="right"] ul.menu {left:inherit !important; right:'+(parseInt((l-o-c)/2-30)>0?parseInt((l-o-c)/2-30):0)+"px !important; width:"+(parseInt(.3*f)+40)+"px !important; } ",p=p+'div.upfront-navigation div[data-style="burger"][data-burger_over="over"] ul.menu {top:'+(parseInt(h)+parseInt(ruler_height))+"px !important; } ",e("head").append(e('<style id="responsive_nav_sidebar_offset">'+p+"</style>"))}t.closest("div.upfront-newnavigation_module").css("z-index",3),r.hideMenu(t.find("ul.menu"))}else t.removeClass("triggered-menu"),t.attr("data-style",s[u].menu_style),t.attr("data-alignment",s[u].menu_alignment),t.removeAttr("data-burger_alignment",""),t.removeAttr("data-burger_over",""),t.find("div.responsive_nav_toggler").remove(),r.showMenu(t.find("ul.menu")),t.find("li.active-clone").each(function(){t.parent().parent().children("a").attr("href",t.children("a").attr("href")),t.remove()}),t.find("ul.menu, ul.sub-menu").each(function(){t.css("display","")}),e("div#wpadminbar").length&&t.find("ul.menu").css("margin-top",""),t.closest("div.upfront-newnavigation_module").css("z-index","");t.attr("data-isfloating",s[u].is_floating)}Upfront.Events.trigger("entity:object:refresh",this)},hideMenu:function(t){var n=this.$el.find(".upfront-output-unewnavigation");t.hide();if(t.siblings(".burger_overlay").length>0){var r=t.siblings(".burger_overlay");r.hide()}(n.attr("data-burger_alignment")==="top"||n.attr("data-burger_alignment")==="whole")&&e("section.upfront-layout").css("margin-top",0)},showMenu:function(e){if(e.siblings(".burger_overlay").length>0){var t=e.siblings(".burger_overlay");t.show()}e.show()},toggle_responsive_nav:function(t){var n=this,r=this.$el.closest(".upfront-region-container"),i=this.$el.closest(".upfront-module-group"),s=this.$el.closest(".upfront-module"),o=this.$el.find("ul.menu"),u=this.$el.find(".upfront-output-unewnavigation");if(o.css("display")=="none"&&typeof t!="undefined"){this.showMenu(o);var a=o.position(),f=e('<i class="burger_nav_close"></i>');o.prepend(e("<li>").addClass("wrap_burger_nav_close").append(f)),f.bind("touchstart click",function(){e(t.target).closest(".responsive_nav_toggler").trigger("click"),(u.attr("data-burger_alignment")==="top"||u.attr("data-burger_alignment")==="whole")&&e("section.upfront-layout").css("margin-top",0)}),u.attr("data-burger_open","1"),r.addClass("upfront-region-container-has-nav"),r.addClass("upfront-region-container-nav-open"),i.length>0&&i.addClass("upfront-module-group-nav-open"),s.addClass("upfront-module-nav-open");if(u.attr("data-burger_over")==="pushes"&&u.attr("data-burger_alignment")==="top"||u.attr("data-burger_alignment")==="whole"){u.attr("data-burger_alignment")==="top"&&e("section.upfront-layout").css("margin-top",o.outerHeight());var l=e("div#upfront-ui-topbar").outerHeight(),c=e(".upfront-ruler-container").outerHeight();o.offset({top:l+c,left:e("section.upfront-layout").offset().left})}Upfront.Events.trigger("entity:navigation:responsive_open",u)}else this.hideMenu(o),this.$el.find("i.burger_nav_close").parent("li.wrap_burger_nav_close").remove(),u.removeAttr("data-burger_open"),this.$el.find("ul.sub-menu").css("display",""),this.$el.find("ul.sub-menu").length<1&&r.removeClass("upfront-region-container-has-nav"),r.removeClass("upfront-region-container-nav-open"),i.length>0&&i.removeClass("upfront-module-group-nav-open"),s.removeClass("upfront-module-nav-open"),u.attr("data-burger_over")==="pushes"&&e("section.upfront-layout").css("margin-top",""),Upfront.Events.trigger("entity:navigation:responsive_close",u)},generate_menu:function(){var t=this,n=this.model.get_property_value_by_name("menu_id");if(!n)return;var r=this.$el.find(".upfront-object-content");this.$el.find(".upfront-object-content").html("");if(this.property("menu_items").length>0){var i=this.renderMenu(this.property("menu_items"),"menu");r.append(i)}else r.append(this.renderMenu(this.property("menu_items"),"menu")),setTimeout(function(){t.$el.closest(".upfront-module").find("i.upfront-icon-region-add").trigger("click")},200);var s=this.model.get_property_value_by_name("preset"),o=this.get_preset_properties();setTimeout(function(){t.clearPresetClass(t.$el),t.$el.addClass(t.property("theme_style")),t.property("usingNewAppearance")&&t.$el.addClass(s)},50);var u=this.$el.closest(".upfront-region-container, .upfront-region-sub-container");this.$el.find("ul.sub-menu").length>0?u.addClass("upfront-region-container-has-nav"):u.removeClass("upfront-region-container-has-nav");var a=Upfront.Settings.LayoutEditor.CurrentBreakpoint,f=this.property("usingNewAppearance");o.breakpoint=f?this.get_preset_properties().breakpoint:this.fallbackBreakpointData();if(!a||a.default)((o.breakpoint||{}).desktop||{}).menu_style==="burger"&&((o.breakpoint||{}).desktop||{}).burger_over!=="pushes"&&((o.breakpoint||{}).desktop||{}).burger_alignment!=="whole"&&this.$el.find(".upfront-object-content").append(e('<div class="burger_overlay"></div>')),((o.breakpoint||{}).desktop||{}).menu_style==="burger"&&(r.prepend(e("<div>").addClass("responsive_nav_toggler").data("view",t).append("<div></div><div></div><div></div>")),t.hideMenu(this.$el.find("ul.menu")));else{breakpoint_data=(o.breakpoint||{})[a.id]||{};var l=typeof breakpoint_data.menu_style=="undefined"?this.model.get_breakpoint_property_value("burger_menu")==="yes"?"burger":"":breakpoint_data.menu_style,c=typeof breakpoint_data.burger_over=="undefined"?this.model.get_breakpoint_property_value("burger_over"):breakpoint_data.burger_over,h=typeof breakpoint_data.burger_alignment=="undefined"?this.model.get_breakpoint_property_value("burger_alignment"):breakpoint_data.burger_alignment;l==="burger"&&c!=="pushes"&&h!=="whole"&&this.$el.find(".upfront-object-content").append(e('<div class="burger_overlay"></div>')),l==="burger"&&(r.prepend(e("<div>").addClass("responsive_nav_toggler").data("view",t).append("<div></div><div></div><div></div>")),t.hideMenu(this.$el.find("ul.menu")))}e("section.upfront-layout").css("margin-top",""),this.makeSortable(),this.processFloatStatus()},clearPresetClass:function(e){e.removeClass(),e.addClass(this.elementClasses)},makeSortable:function(){var t=this;this.$el.find(".upfront-object-content ul").each(function(){if(e(this).hasClass("redactor-toolbar")||e(this).hasClass("upfront-field-select-options"))return;e(this).hasClass("ui-sortable")||e(this).sortable({start:function(e,t){t.item.find("i.navigation-add-item").css("display","none")},stop:function(e,n){n.item.find("i.navigation-add-item").css("display","block"),n.item.parent("ul").children("li:last").append(n.item.parent("ul").children("li").children("i.navigation-add-item")),t.saveMenuOrder()}})})},saveMenuOrder:function(){var e=this;Upfront.Util.post({action:"upfront_new_update_menu_order",menu_items:e.new_menu_order()}).success(function(e){Upfront.Events.trigger("menu_element:edit")}).error(function(e){Upfront.Util.log("Error updating menu")})},new_menu_order:function(t){var n=0,r=new Array;return this.$el.find(".upfront-object-content ul li").each(function(){var i=e(this).data("backboneview");if(!i||!i.model)return!0;e(this).parent().parent("li").length>0?e(this).data("backboneview").model["menu-item-parent-id"]=e(this).parent().parent("li").data("backboneview").model["menu-item-db-id"]:e(this).data("backboneview").model["menu-item-parent-id"]=0,r[n]={},typeof t!="undefined"&&e(this).data("backboneview").model["menu-item-parent-id"]==parseInt(t)&&(e(this).data("backboneview").model["menu-item-parent-id"]=0);if(typeof t=="undefined"||e(this).data("backboneview").model["menu-item-db-id"]!=t)r[n]["menu-item-db-id"]=e(this).data("backboneview").model["menu-item-db-id"],r[n]["menu-item-parent-id"]=e(this).data("backboneview").model["menu-item-parent-id"],e(this).data("backboneview").model["menu-item-position"]=n,n++}),r},renderMenu:function(t,n,r){typeof r=="undefined"&&(r=0);var i=this,s=e("<ul>").addClass(n);return n=="menu"&&s.addClass("drag_mode"),_(t).each(function(e){var t=i.renderMenuItem(e,!1,r);t&&t.length&&typeof e.sub!="undefined"&&e.sub&&e.sub.length&&t.addClass("parent").append(i.renderMenu(e.sub,"sub-menu",r+1)),s.append(t)}),s.children("li:last").append('<i class="navigation-add-item"></i>'),s},renderMenuItem:function(e,n,r){typeof r=="undefined"&&(r=0);var i=this;typeof n=="undefined"&&(n=!1);var s=new t({model:e,parent_view:i,newitem:n,level:r});return s.render().$el},menuItemTemplate:function(){return{"menu-item-parent-id":"0","menu-item-target":"","menu-item-title":"","menu-item-type":"custom","menu-item-url":"#"}},addPrimaryMenuItem:function(e){e.preventDefault(),this.$el.find("ul.menu > li > i.navigation-add-item").length>0?this.$el.find("ul.menu > li > i.navigation-add-item").trigger("click"):this.addMenuItem(e)},addMenuItem:function(t){var n=this,r=!1,i=this.model.get_property_value_by_name("menu_id");n.$el.find("a.new_menu_item").removeClass("new_menu_item");var s=0,s=0,o=this.menuItemTemplate(),u;typeof t.target=="undefined"&&t.parent("li").length>0?(s=t.parent("li").data("depth"),o["menu-item-parent-id"]=t.parent("li").data("backboneview").model["menu-item-db-id"],t.append(this.renderMenuItem(o,!0,s+1)),t.children("li:last").append('<i class="navigation-add-item"></i>')):(e(t.target).parent("li").parent("ul").parent("li").length>0&&(o["menu-item-parent-id"]=e(t.target).parent("li").parent("ul").parent("li").data("backboneview").model["menu-item-db-id"],e(t.target).parent("li").parent("ul").addClass("time_being_display")),e(t.target).parent("li").length==0?e(t.target).closest("div.upfront-module").find("ul.menu").append(this.renderMenuItem(o,!0)):(e(t.target).parent("li").parent("ul").append(this.renderMenuItem(o,!0,0)),e(t.target).parent("li").next("li").append(t.target))),n.editMenuItem(n.$el.find("a.new_menu_item").removeClass("new_menu_item"))},getControlItems:function(){return _([this.createControl("add",f.add_item,"addPrimaryMenuItem"),this.createPaddingControl(),this.createControl("settings",f.settings,"on_settings_click")])}});Upfront.Application.LayoutEditor.add_object("Unewnavigation",{Model:n,View:h,Element:r,Settings:i,cssSelectors:{"[data-style='horizontal'] ul.menu, div[data-style='vertical'] ul.menu":{label:f.css.bar_label,info:f.css.bar_info},"[data-style='horizontal'] ul.menu > li.menu-item > a, div[data-style='vertical'] ul.menu > li.menu-item > a":{label:f.css.item_label,info:f.css.item_info},"[data-style='horizontal'] ul.menu > li.menu-item:hover > a, div[data-style='vertical'] ul.menu > li.menu-item:hover > a":{label:f.css.hover_label,info:f.css.hover_info},"[data-style='horizontal'] ul.sub-menu > li.menu-item > a, div[data-style='vertical'] ul.sub-menu > li.menu-item > a":{label:f.css.subitem_label,info:f.css.subitem_info},"[data-style='horizontal'] ul.sub-menu > li.menu-item:hover > a, div[data-style='vertical'] ul.sub-menu > li.menu-item:hover > a":{label:f.css.subitem_hover_label,info:f.css.subitem_hover_info},"[data-style='burger'] ul.menu":{label:f.css.responsive_bar_label,info:f.css.bar_info},"[data-style='burger'] .responsive_nav_toggler":{label:f.css.responsive_trigger,info:f.css.hover_info},"[data-style='burger'] div.responsive_nav_toggler > div":{label:f.css.responsive_trigger_bars,info:f.css.hover_info},"[data-style='burger'] i.burger_nav_close":{label:f.css.responsive_nav_close,info:f.css.close_info},"[data-style='burger'] ul.menu > li.menu-item > a":{label:f.css.responsive_item_label,info:f.css.item_info},"[data-style='burger'] ul.menu > li.menu-item:hover > a":{label:f.css.responsive_hover_label,info:f.css.hover_info},"[data-style='burger'] ul.sub-menu > li.menu-item > a":{label:f.css.responsive_subitem_label,info:f.css.subitem_info},"[data-style='burger'] ul.sub-menu > li.menu-item:hover > a":{label:f.css.responsive_subitem_hover_label,info:f.css.subitem_hover_info}},cssSelectorsId:Upfront.data.unewnavigation.defaults.type}),Upfront.Models.UnewnavigationModel=n,Upfront.Views.UnewnavigationView=h})}(jQuery),define("elements/upfront-button/js/model",[],function(){var e=Upfront.Models.ObjectModel.extend({init:function(){var e=_.clone(Upfront.data.ubutton.defaults),t=Upfront.data.ubutton.defaults;e.content=_.clone(t.content),e.element_id=Upfront.Util.get_unique_id("button-object"),this.init_properties(e)}});return e}),define("elements/upfront-button/js/element",["elements/upfront-button/js/model"],function(e){var t=Upfront.Settings.l10n.button_element,n=Upfront.Views.Editor.Sidebar.Element.extend({priority:150,render:function(){this.$el.addClass("upfront-icon-element upfront-icon-element-button"),this.$el.html(t.element_name)},add_element:function(){var n=new e,r=new Upfront.Models.Module({name:"",properties:[{name:"content",value:t.dbl_click},{name:"href",value:""},{name:"align",value:"center"},{name:"element_id",value:Upfront.Util.get_unique_id("module")},{name:"class",value:"c4 button-style"},{name:"row",value:Upfront.Util.height_to_row(55)},{name:"has_settings",value:0}],objects:[n]});this.add_module(r)}});return n}),define("text!elements/upfront-button/tpl/preset-style.html",[],function(){return"#page .upfront-button .button-preset-<?php echo $properties['id'] ?>.upfront_cta {\n    <?php if(!empty($properties['color'])) { ?>color: <?php echo $properties['color']  ?>; <?php } ?>\n    <?php if(!empty($properties['fontface'])) { ?>font-family: <?php echo $properties['fontface']  ?>; <?php } ?>\n    <?php if(!empty($properties['fontsize'])) { ?>font-size: <?php echo $properties['fontsize']  ?>px; <?php } ?>\n    <?php if(!empty($properties['fontstyle_weight'])) { ?>font-weight: <?php echo $properties['fontstyle_weight']  ?>;<?php } ?>\n    <?php if(!empty($properties['fontstyle_style'])) { ?>font-style: <?php echo $properties['fontstyle_style']  ?>;<?php } ?>\n    <?php if(!empty($properties['lineheight'])) { ?>line-height: <?php echo $properties['lineheight']  ?>;<?php } ?>\n\n    <?php if(!empty($properties['useborder'])) { ?>\n        <?php if(!empty($properties['borderwidth']) && !empty($properties['bordertype']) && !empty($properties['bordercolor'])) { ?>border: <?php echo $properties['borderwidth'] ?>px <?php echo $properties['bordertype'] ?> <?php echo $properties['bordercolor'] ?>;<?php } ?>\n    <?php } else { ?>\n        border: none;\n    <?php } ?>\n\n    <?php if(!empty($properties['useradius'])) { ?>\n        border-radius: <?php echo $properties['borderradius1'] ? $properties['borderradius1'] : 0 ?>px <?php echo $properties['borderradius2'] ? $properties['borderradius2'] : 0 ?>px <?php echo $properties['borderradius4'] ? $properties['borderradius4'] : 0 ?>px <?php echo $properties['borderradius3'] ? $properties['borderradius3'] : 0 ?>px;\n    <?php } else { ?>\n        border-radius: 0px;\n    <?php } ?>\n\n    <?php if(!empty($properties['bgcolor'])) { ?>background-color: <?php echo $properties['bgcolor'] ?>; <?php } ?>\n\n	<?php if(!empty($properties['hov_use_animation'])) { ?>\n		transition: all <?php echo $properties['hov_duration']  ?>s <?php echo $properties['hov_transition']  ?>;\n	<?php } else { ?>\n		transition: none;\n	<?php } ?>\n}\n\n#page .upfront-button .button-preset-<?php echo $properties['id']  ?>.upfront_cta:hover, #page .upfront-button.<?php echo $properties['id']  ?>.live-preview-hover .upfront_cta {\n    <?php if(!empty($properties['hov_usetypography']) && $properties['hov_usetypography'] == 'yes') { ?>\n        <?php if(!empty($properties['hov_color'])) { ?>color: <?php echo $properties['hov_color']  ?>; <?php } ?>\n        <?php if(!empty($properties['hov_fontface'])) { ?>font-family: <?php echo $properties['hov_fontface']  ?>; <?php } ?>\n        <?php if(!empty($properties['hov_fontsize'])) { ?>font-size: <?php echo $properties['hov_fontsize']  ?>px; <?php } ?>\n        <?php if(!empty($properties['hov_lineheight'])) { ?>line-height: <?php echo $properties['hov_lineheight']  ?>;<?php } ?>\n        <?php if(!empty($properties['hov_fontstyle_weight'])) { ?>font-weight: <?php echo $properties['hov_fontstyle_weight']  ?>;<?php } ?>\n        <?php if(!empty($properties['hov_fontstyle_style'])) { ?>font-style: <?php echo $properties['hov_fontstyle_style']  ?>;<?php } ?>\n    <?php } else { ?>\n        <?php if(!empty($properties['color'])) { ?>color: <?php echo $properties['color']  ?>; <?php } ?>\n        <?php if(!empty($properties['fontface'])) { ?>font-family: <?php echo $properties['fontface']  ?>; <?php } ?>\n        <?php if(!empty($properties['fontsize'])) { ?>font-size: <?php echo $properties['fontsize']  ?>px; <?php } ?>\n        <?php if(!empty($properties['fontstyle_weight'])) { ?>font-weight: <?php echo $properties['fontstyle_weight']  ?>;<?php } ?>\n        <?php if(!empty($properties['fontstyle_style'])) { ?>font-style: <?php echo $properties['fontstyle_style']  ?>;<?php } ?>\n        <?php if(!empty($properties['lineheight'])) { ?>line-height: <?php echo $properties['lineheight']  ?>;<?php } ?>\n    <?php } ?>\n\n    <?php if(!empty($properties['hov_useborder']) && $properties['hov_useborder'] == 'yes') { ?>\n        <?php if(!empty($properties['hov_borderwidth']) && !empty($properties['hov_bordertype']) && !empty($properties['hov_bordercolor'])) { ?>border: <?php echo $properties['hov_borderwidth'] ?>px <?php echo $properties['hov_bordertype'] ?> <?php echo $properties['hov_bordercolor'] ?>;<?php } ?>\n    <?php } else { ?>\n        <?php if(!empty($properties['useborder'])) { ?>\n            <?php if(!empty($properties['borderwidth']) && !empty($properties['bordertype']) && !empty($properties['bordercolor'])) { ?>border: <?php echo $properties['borderwidth'] ?>px <?php echo $properties['bordertype'] ?> <?php echo $properties['bordercolor'] ?>;<?php } ?>\n        <?php } else { ?>\n            border: none;\n        <?php } ?>\n    <?php } ?>\n\n    <?php if(!empty($properties['hov_useradius']) && $properties['hov_useradius'] == 'yes') { ?>\n        border-radius: <?php echo !empty($properties['hov_borderradius1']) ? $properties['hov_borderradius1'] : 0 ?>px <?php echo !empty($properties['hov_borderradius2']) ? $properties['hov_borderradius2'] : 0 ?>px <?php echo !empty($properties['hov_borderradius4']) ? $properties['hov_borderradius4'] : 0 ?>px <?php echo !empty($properties['hov_borderradius3']) ? $properties['hov_borderradius3'] : 0 ?>px;\n    <?php } else { ?>\n        <?php if(!empty($properties['useradius'])) { ?>\n            border-radius: <?php echo $properties['borderradius1'] ? $properties['borderradius1'] : 0 ?>px <?php echo $properties['borderradius2'] ? $properties['borderradius2'] : 0 ?>px <?php echo $properties['borderradius4'] ? $properties['borderradius4'] : 0 ?>px <?php echo $properties['borderradius3'] ? $properties['borderradius3'] : 0 ?>px;\n        <?php } else { ?>\n            border-radius: 0px;\n        <?php } ?>\n    <?php } ?>\n\n    <?php if(!empty($properties['hov_usebgcolor']) && $properties['hov_usebgcolor'] == 'yes') { ?>\n        <?php if(!empty($properties['hov_bgcolor'])) { ?>background-color: <?php echo $properties['hov_bgcolor'] ?>; <?php } ?>\n    <?php } else { ?>\n        <?php if(!empty($properties['bgcolor'])) { ?>background-color: <?php echo $properties['bgcolor'] ?>; <?php } ?>\n    <?php } ?>\n}\n\n#page .upfront-button .button-preset-<?php echo $properties['id']  ?>.upfront_cta:focus, #page .upfront-button.<?php echo $properties['id']  ?>.live-preview-focus .upfront_cta {\n    <?php if(!empty($properties['focus_usetypography']) && $properties['focus_usetypography'] == 'yes') { ?>\n        <?php if(!empty($properties['focus_color'])) { ?>color: <?php echo $properties['focus_color']  ?>; <?php } ?>\n        <?php if(!empty($properties['focus_fontface'])) { ?>font-family: <?php echo $properties['focus_fontface']  ?>; <?php } ?>\n        <?php if(!empty($properties['focus_fontsize'])) { ?>font-size: <?php echo $properties['focus_fontsize']  ?>px; <?php } ?>\n        <?php if(!empty($properties['focus_lineheight'])) { ?>line-height: <?php echo $properties['focus_lineheight']  ?>;<?php } ?>\n        <?php if(!empty($properties['focus_fontstyle_weight'])) { ?>font-weight: <?php echo $properties['focus_fontstyle_weight']  ?>;<?php } ?>\n        <?php if(!empty($properties['focus_fontstyle_style'])) { ?>font-style: <?php echo $properties['focus_fontstyle_style']  ?>;<?php } ?>\n    <?php } else { ?>\n        <?php if(!empty($properties['color'])) { ?>color: <?php echo $properties['color']  ?>; <?php } ?>\n        <?php if(!empty($properties['fontface'])) { ?>font-family: <?php echo $properties['fontface']  ?>; <?php } ?>\n        <?php if(!empty($properties['fontsize'])) { ?>font-size: <?php echo $properties['fontsize']  ?>px; <?php } ?>\n        <?php if(!empty($properties['fontstyle_weight'])) { ?>font-weight: <?php echo $properties['fontstyle_weight']  ?>;<?php } ?>\n        <?php if(!empty($properties['fontstyle_style'])) { ?>font-style: <?php echo $properties['fontstyle_style']  ?>;<?php } ?>\n        <?php if(!empty($properties['lineheight'])) { ?>line-height: <?php echo $properties['lineheight']  ?>;<?php } ?>\n    <?php } ?>\n\n    <?php if(!empty($properties['focus_useborder']) && $properties['focus_useborder'] == 'yes') { ?>\n        <?php if(!empty($properties['focus_borderwidth']) && !empty($properties['focus_bordertype']) && !empty($properties['focus_bordercolor'])) { ?>border: <?php echo $properties['focus_borderwidth'] ?>px <?php echo $properties['focus_bordertype'] ?> <?php echo $properties['focus_bordercolor'] ?>;<?php } ?>\n    <?php } else { ?>\n        <?php if(!empty($properties['useborder'])) { ?>\n            <?php if(!empty($properties['borderwidth']) && !empty($properties['bordertype']) && !empty($properties['bordercolor'])) { ?>border: <?php echo $properties['borderwidth'] ?>px <?php echo $properties['bordertype'] ?> <?php echo $properties['bordercolor'] ?>;<?php } ?>\n        <?php } else { ?>\n            border: none;\n        <?php } ?>\n    <?php } ?>\n\n    <?php if(!empty($properties['focus_useradius']) && $properties['focus_useradius'] == 'yes') { ?>\n        border-radius: <?php echo !empty($properties['focus_borderradius1']) ? $properties['focus_borderradius1'] : 0 ?>px <?php echo !empty($properties['focus_borderradius2']) ? $properties['focus_borderradius2'] : 0 ?>px <?php echo !empty($properties['focus_borderradius4']) ? $properties['focus_borderradius4'] : 0 ?>px <?php echo !empty($properties['focus_borderradius3']) ? $properties['focus_borderradius3'] : 0 ?>px;\n    <?php } else { ?>\n        <?php if(!empty($properties['useradius'])) { ?>\n            border-radius: <?php echo $properties['borderradius1'] ? $properties['borderradius1'] : 0 ?>px <?php echo $properties['borderradius2'] ? $properties['borderradius2'] : 0 ?>px <?php echo $properties['borderradius4'] ? $properties['borderradius4'] : 0 ?>px <?php echo $properties['borderradius3'] ? $properties['borderradius3'] : 0 ?>px;\n        <?php } else { ?>\n            border-radius: 0px;\n        <?php } ?>\n    <?php } ?>\n\n    <?php if(!empty($properties['focus_usebgcolor']) && $properties['focus_usebgcolor'] == 'yes') { ?>\n        <?php if(!empty($properties['focus_bgcolor'])) { ?>background-color: <?php echo $properties['focus_bgcolor'] ?>; <?php } ?>\n    <?php } else { ?>\n        <?php if(!empty($properties['bgcolor'])) { ?>background-color: <?php echo $properties['bgcolor'] ?>; <?php } ?>\n    <?php } ?>\n}\n\n<?php if(!empty($properties['preset_style'])) { ?><?php echo $properties['preset_style'] ?><?php } ?>\n"}),define("elements/upfront-button/js/settings",["scripts/upfront/element-settings/settings","scripts/upfront/preset-settings/util","text!elements/upfront-button/tpl/preset-style.html"],function(e,t,n){var r=Upfront.Settings.l10n.button_element,i=e.extend({panels:{Appearance:{mainDataCollection:"buttonPresets",styleElementPrefix:"button-preset",ajaxActionSlug:"button",panelTitle:r.settings,styleTpl:n,presetDefaults:Upfront.mainData.presetDefaults.button,stateModules:{Static:[{moduleType:"Colors",options:{title:r.settings.colors_label,multiple:!1,single:!0,abccolors:[{name:"bgcolor",label:r.settings.button_bg_label}],fields:{use:"usebgcolor"}}},{moduleType:"Typography",options:{state:"static",title:r.settings.typography_label,fields:{typeface:"fontface",fontstyle:"fontstyle",weight:"fontstyle_weight",style:"fontstyle_style",size:"fontsize",line_height:"lineheight",color:"color"}}},{moduleType:"Radius",options:{state:"static",max_value:100,fields:{use:"useradius",lock:"borderradiuslock",radius:"radius",radius_number:"radius_number",radius1:"borderradius1",radius2:"borderradius2",radius3:"borderradius3",radius4:"borderradius4"}}},{moduleType:"Border",options:{state:"static",fields:{use:"useborder",width:"borderwidth",type:"bordertype",color:"bordercolor"}}}],Hover:[{moduleType:"Colors",options:{state:"hover",title:r.settings.colors_label,multiple:!1,toggle:!0,single:!0,prepend:"hov_",abccolors:[{name:"hov_bgcolor",label:r.settings.button_bg_label}],fields:{use:"hov_usebgcolor"}}},{moduleType:"Typography",options:{state:"hover",title:r.settings.typography_label,toggle:!0,prepend:"hov_",fields:{typeface:"hov_fontface",fontstyle:"hov_fontstyle",weight:"hov_fontstyle_weight",style:"hov_fontstyle_style",size:"hov_fontsize",line_height:"hov_lineheight",color:"hov_color",use:"hov_usetypography"}}},{moduleType:"Radius",options:{state:"hover",max_value:100,prepend:"hov_",fields:{use:"hov_useradius",lock:"hov_borderradiuslock",radius:"hov_radius",radius_number:"hov_radius_number",radius1:"hov_borderradius1",radius2:"hov_borderradius2",radius3:"hov_borderradius3",radius4:"hov_borderradius4"}}},{moduleType:"Border",options:{state:"hover",prepend:"hov_",fields:{use:"hov_useborder",width:"hov_borderwidth",type:"hov_bordertype",color:"hov_bordercolor"}}},{moduleType:"HovAnimation",options:{state:"hover",title:"",toggle:!0,fields:{use:"hov_use_animation",duration:"hov_duration",easing:"hov_transition"}}}],Focus:[{moduleType:"Colors",options:{state:"focus",title:r.settings.colors_label,multiple:!1,toggle:!0,single:!0,prepend:"focus_",abccolors:[{name:"focus_bgcolor",label:r.settings.button_bg_label}],fields:{use:"focus_usebgcolor"}}},{moduleType:"Typography",options:{state:"focus",title:r.settings.typography_label,toggle:!0,prepend:"focus_",fields:{typeface:"focus_fontface",fontstyle:"focus_fontstyle",weight:"focus_fontstyle_weight",style:"focus_fontstyle_style",size:"focus_fontsize",line_height:"focus_lineheight",color:"focus_color",use:"focus_usetypography"}}},{moduleType:"Radius",options:{state:"focus",max_value:100,prepend:"focus_",fields:{use:"focus_useradius",lock:"focus_borderradiuslock",radius:"focus_radius",radius_number:"focus_radius_number",radius1:"focus_borderradius1",radius2:"focus_borderradius2",radius3:"focus_borderradius3",radius4:"focus_borderradius4"}}},{moduleType:"Border",options:{state:"focus",prepend:"focus_",fields:{use:"focus_useborder",width:"focus_borderwidth",type:"focus_bordertype",color:"focus_bordercolor"}}}]},migrateDefaultStyle:function(e){return e=e.replace(/(div)?\.upfront-button\s/g,""),e=e.replace(/(div)?\.upfront-object\s/g,""),e=e.replace(/\a.upfront_cta/,".upfront_cta"),e},migratePresetProperties:function(e){var t=this.property("preset")?this.clear_preset_name(this.property("preset")):"default",n=this.presets.findWhere({id:t}),r={};typeof n!="undefined"&&_.each(n.attributes,function(e,t){if(t==="id"||t==="name"||t==="preset_style"||t==="legacy")return;r[t]=e}),e.set(r)}}},title:r.settings.label});return t.generatePresetsToPage("button",n),i}),define("text!elements/upfront-button/tpl/ubutton.html",[],function(){return'<a href="<?php echo $href ?>" target="<?php echo $linkTarget ?>" style="text-align: <?php echo $align ?>;" class="button-style upfront_cta button-preset-<?php echo $preset ?>"><?php echo $content ?></a>'}),function(e){define("ubutton",["elements/upfront-button/js/model","elements/upfront-button/js/element","elements/upfront-button/js/settings","scripts/upfront/link-model","scripts/upfront/preset-settings/util","text!elements/upfront-button/tpl/ubutton.html","text!elements/upfront-button/tpl/preset-style.html"],function(t,n,r,i,s,o,u){var a=Upfront.Settings.l10n.button_element,f=0,l="",c=Upfront.Views.ObjectView.extend({model:t,className:"upfront-object-view upfront-button",buttonTpl:Upfront.Util.template(o),initialize:function(){var e=this;this.elementClasses=this.$el.attr("class"),this.model.set_property("id_slug","ubutton"),this.model instanceof t||(this.model=new t({properties:this.model.get("properties")})),this.events=_.extend({},this.events,{"click a.uf-click-to-edit-text":"placeholderClick","click a.redactor_act":"onOpenPanelClick","click .upfront-save_settings":"onOpenPanelClick","click .open-item-controls":"onOpenItemControlsClick"}),this.delegateEvents(),this.model.get("properties").bind("change",this.render,this),this.model.get("properties").bind("change",this.handle_visual_padding_hint,this),this.model.get("properties").bind("add",this.render,this),this.model.get("properties").bind("remove",this.render,this),this.listenTo(this.model,"change:preset",this.updatePresetClass),Upfront.Events.on("entity:deactivated",this.stopEdit,this),this.listenTo(Upfront.Events,"theme_colors:update",this.update_colors,this),this.listenTo(Upfront.Events,"theme_colors:update",this.render,this),this.property("link")===!1?(this.link=new i({type:Upfront.Util.guessLinkType(this.property("href")),url:this.property("href"),target:this.property("linkTarget")}),this.property("link",this.link.toJSON())):this.link=new i(this.property("link")),e.listenTo(this.link,"change",function(){e.property("link",e.link.toJSON())})},placeholderClick:function(e){e.preventDefault()},updatePresetClass:function(){this.clearPresetClass(this.$el),this.$el.addClass(this.property("preset"))},clearPresetClass:function(e){e.removeClass(),e.addClass(this.elementClasses)},getCleanurl:function(e){var t;return e||(e=location.href),e.indexOf("?dev=true")!=-1&&(e=e.replace("?dev=true","")),e.indexOf("#")==-1?e:(t=e.split("#"),t[0].trim()!=""?t[0]:location.href.replace("?dev=true",""))},getUrlanchor:function(t){if(typeof t=="undefined")var t=e(location).attr("href");if(t.indexOf("#")>=0){var n=t.split("#");return n[1]}return!1},get_anchors:function(){var e=Upfront.Application.layout.get("regions"),t=[];return e.each(function(e){e.get("modules").each(function(e){e.get("objects").each(function(e){var n=e.get_property_value_by_name("anchor");n&&n.length&&(t[n]=e)})})}),t},update_colors:function(){var e=this,t=this.model.get_property_value_by_name("preset"),n=s.getPresetProperties("button",t)||{};if(_.size(n)<=0)return!1;s.updatePresetStyle("button",n,u)},clear_preset_name:function(e){return e=e.replace(" ","-"),e=e.replace(/[^-a-zA-Z0-9]/,""),e},get_content_markup:function(){var e=this.extract_properties();e.preset===""&&e.currentpreset!=""&&(e.preset=e.currentpreset,this.model.set_property("preset",e.currentpreset)),e.href=this.link.get("url"),e.linkTarget=this.link.get("target"),e.preset=e.preset||"default",e.preset=this.clear_preset_name(e.preset);var t=Upfront.Views.Editor.Button.Presets.get(e.preset);return this.buttonTpl(e)},extract_properties:function(){var e={};return this.model.get("properties").each(function(t){e[t.get("name")]=t.get("value")}),e},saveTitle:function(e){this.property("content",e.html())},is_edited:function(){var e=this.model.get_property_value_by_name("is_edited");return e?!0:!1},onOpenPanelClick:function(e){e.preventDefault(),this.toggleLinkPanel()},onOpenItemControlsClick:function(){this.$el.toggleClass("controls-visible"),this.$el.hasClass("controls-visible")?(this.$el.addClass("controls-visible"),this.controlsVisible=!0):this.controlsVisible=!1},toggleLinkPanel:function(){var e=this;this.$el.hasClass("stayOpen")?(this.$el.removeClass("stayOpen"),e.render()):this.$el.addClass("stayOpen")},on_render:function(){var t=this,n=!1;this.delegateEvents();var r=this.$el.find(".upfront-object-content a.upfront_cta");r.ueditor({linebreaks:!0,disableLineBreak:!0,airButtons:["stateAlignCTA","upfrontIcons"],placeholder:"Click here",autostart:!1}).on("start",function(){var e=r.closest(".upfront-object-content");e.addClass("editing").css("minHeight",e.parent().height()),Upfront.Events.trigger("upfront:element:edit:start","text")}).on("stop",function(){r.closest(".upfront-object-content").removeClass("editing").css("minHeight",""),t.property("align",r.css("text-align"),!0),Upfront.Events.trigger("upfront:element:edit:stop"),t.render()}).on("syncAfter",function(){t.saveTitle(e(this))}),this.clearPresetClass(this.$el),this.$el.find(".upfront-button").addClass(this.property("preset"))},stopEdit:function(){var e=this.$el.find(".upfront-object-content a.upfront_cta");e.trigger("blur"),Upfront.Events.trigger("upfront:element:edit:stop")},property:function(e,t,n){return typeof t!="undefined"?(typeof n=="undefined"&&(n=!0),this.model.set_property(e,t,n)):this.model.get_property_value_by_name(e)},createLinkControl:function(){var e=this,t=new Upfront.Views.Editor.InlinePanels.Controls.LinkPanel({model:this.link,button:!1,icon:"link",tooltip:a.edit_link,id:"link"});return this.listenTo(this.link,"change",function(){this.$el.find("a").attr("href",e.link.get("url"))}),t},getControlItems:function(){return _([this.createLinkControl(),this.createPaddingControl(),this.createControl("settings",a.settings.label,"on_settings_click")])}}),h=Upfront.Views.ContextMenuList.extend({initialize:function(){var e=this;this.menuitems=_([new Upfront.Views.ContextMenuItem({get_label:function(){var t=Upfront.Util.guessLinkType(e.for_view.property("href"));return t=="lightbox"?"Open Lightbox":t=="anchor"?"Scroll to Anchor":t=="entry"?"Visit Post/Page":"Visit Link"},action:function(){Upfront.Util.visitLink(e.for_view.property("href"))}})])}});Upfront.Application.LayoutEditor.add_object("Button",{Model:t,View:c,Element:n,Settings:r,cssSelectors:{".upfront_cta":{label:a.css.container_label,info:a.css.container_info}},cssSelectorsId:Upfront.data.ubutton.defaults.type}),Upfront.Models.ButtonModel=t,Upfront.Views.ButtonView=c})}(jQuery),define("text!elements/upfront-posts/tpl/views.html",[],function(){return'<div id="initial">\r\n	<div class="upfront_posts-initial-wrapper upfront-initial-overlay-wrapper">\r\n		<div class="upfront_posts-initial-content">\r\n			<div class="options"></div>\r\n			<a class="continue" href="#continue">{{l10n.continue}}&nbsp;&raquo;</a>\r\n		</div>\r\n	</div>\r\n</div>\r\n\r\n\r\n<div id="loading">\r\n	<p class="loading">{{l10n.loading}}</p>\r\n</div>\r\n\r\n\r\n<div id="error">\r\n	<p class="error">{{l10n.error}}</p>\r\n</div>\r\n\r\n\r\n<div id="list">\r\n	<ul>\r\n		{{posts}}\r\n	</ul>\r\n	{{pagination}}\r\n</div>\r\n\r\n\r\n<div id="single">\r\n	<ul>\r\n		{{posts}}\r\n	</ul>\r\n</div>\r\n\r\n\r\n<div id="part-options-part_visible">\r\n	<div class="name_action_wrapper"></div>\r\n</div>\r\n<div id="part-options-part_name">\r\n	<span class="part_name">{{part.name}}</span>\r\n</div>\r\n<div id="part-options-part_action">\r\n	<span class="part_action"><a href="#edit-options">{{l10n.edit}}</a></span>\r\n</div>\r\n<div id="part-options-part_wrapper">\r\n	<div class="options {{part.part}}-options">\r\n		<div class="option"></div>\r\n		<span class="edit_part"><a href="#edit-html">{{l10n.edit_html}}</a></span>\r\n	</div>\r\n</div>'}),function(e){define("elements/upfront-posts/js/post-list-views",["text!elements/upfront-posts/tpl/views.html"],function(t){var n=Upfront.Settings.l10n.posts_element,r=e(t),i={DEFAULT:"initial",initial:Backbone.View.extend({className:"upfront_posts-initial upfront-initial-overlay-wrapper",tpl:_.template(r.filter("#initial").html()),events:{'click [href="#continue"]':"dispatch"},render:function(){var e=new Upfront.Views.Editor.Field.Radios({model:this.model,property:"display_type",label:n.display_type_label_initial,layout:"horizontal-inline",icon_class:"upfront-posts-display_type",values:[{label:n.single_post,value:"single",icon:"upfront-posts-single"},{label:n.post_list,value:"list",icon:"upfront-posts-list"}]}),t=this.element.parent_module_view.model.get_property_value_by_name("row"),r=t?t*Upfront.Settings.LayoutEditor.Grid.baseline:0;e.on("changed",function(e){this.model.set_property(this.options.property,e,!0)},e),e.render(),this.$el.empty().append(this.tpl({l10n:n})),this.$el.css("min-height",r>150?r:150),this.$el.find(".options").empty().append(e.$el)},dispatch:function(e){e.preventDefault(),e.stopPropagation();var t=!!this.model.get_property_value_by_name("display_type");if(!t)return!1;this.model.trigger("change")}}),_view:Backbone.View.extend({render:function(){var e=this,t=Upfront.Util.model_to_json(this.model),r=t.properties||{},i={};window._upfront_get_current_query&&(i=window._upfront_get_current_query()),this._posts_load=Upfront.Util.post({action:"upfront_posts-load",data:{props:r,query:i}}).success(function(t){if(t.data&&t.data.posts){var r="";_.each(t.data.posts,function(e){r+=e}),e.$el.empty().append(e.tpl.main({posts:r,pagination:t.data.pagination,l10n:n})),e.$el.find(".uf-pagination a").off("click").on("click",function(e){return e.preventDefault(),e.stopPropagation(),!1})}else e.$el.empty().append(e.tpl.error({l10n:n}))}).error(function(){e.$el.empty().append(e.tpl.error({l10n:n}))}),this.$el.empty().append(this.tpl.load({l10n:n}))}})};return i.list=i._view.extend({className:"upfront_posts-list",tpl:{main:_.template(r.filter("#list").html()),error:_.template(r.filter("#error").html()),load:_.template(r.filter("#loading").html())}}),i.single=i._view.extend({className:"upfront_posts-single",tpl:{main:_.template(r.filter("#single").html()),error:_.template(r.filter("#error").html()),load:_.template(r.filter("#loading").html())}}),i})}(jQuery),function(e){define("elements/upfront-posts/js/post-list-meta-views",["text!elements/upfront-posts/tpl/views.html","scripts/redactor/ueditor-inserts"],function(t,n){var r=Upfront.Settings.l10n.posts_element,i=e(t),s={Embed:n.inserts.embed.extend({meta_fields:[],start:function(){var e=n.inserts.embed.prototype.start.apply(this),t=this;return this.on("manager:rendered",function(e,n,i){if(!i)return!1;i.$el.find("ul").append('<li><a href="#" class="insert_field">'+r.meta_insert+"</a></li>").find(".insert_field").on("click",function(e){return e.preventDefault(),e.stopPropagation(),t.prepare_fields_box(i),!1})}),e},prepare_fields_box:function(e){var t=this,n=Upfront.Util.model_to_json(this.model),r=n.properties||{},i={};window._upfront_get_current_query&&(i=window._upfront_get_current_query()),!this.meta_fields||!this.meta_fields.length?Upfront.Util.post({action:"upfront_posts-list_meta",data:{props:r,query:i}}).success(function(n){n&&n.data&&n.data.fields&&(t.meta_fields=n.data.fields),t.pop_fields_box(e)}):this.pop_fields_box(e)},pop_fields_box:function(t){var n=this.meta_fields;Upfront.Popup.open(function(){var t=this,r=new s.List({fields:n});r.render(),r.on("done",function(e){Upfront.Popup.close(e)}),e(this).empty().append(r.$el)},{},"embed-shortcode").done(function(e,n){t.trigger("insert",n)})}}),List:Backbone.View.extend({initialize:function(e){this.options=e},render:function(){var e=this,t=this.options.fields,n=new Upfront.Views.Editor.Field.Checkboxes({default_value:0,values:[{label:r.meta_toggle,value:1}],change:function(t){t=!!parseInt(t,10),e.toggle_hidden(t)}});n.render(),this.$el.empty().append("<h1>"+r.meta_fields+"</h1>").append(n.$el),_(t).each(function(t){var n=new s.List_Field({code:t});n.render(),e.$el.append(n.$el),n.on("done",function(t){e.trigger("done",t)})})},toggle_hidden:function(e){var t=this.$el.find(".wp_internal");e?t.hide():t.show()}}),List_Field:Backbone.View.extend({tagName:"pre",events:{click:"send_code"},initialize:function(e){this.code=e.code},send_code:function(e){e.stopPropagation(),e.preventDefault();if(!this.code)return!1;this.trigger("done","{{"+this.code+"}}")},render:function(){this.$el.empty().append("<code>"+this.code+"</code>"),"_"===this.code.substr(0,1)&&this.$el.addClass("wp_internal")}})};return s})}(jQuery),function(e){define("elements/upfront-posts/js/post-list-settings-parts",["text!elements/upfront-posts/tpl/views.html","scripts/redactor/ueditor-inserts","elements/upfront-posts/js/post-list-meta-views"],function(t,n,r){var i=Upfront.Settings.l10n.posts_element,s=e(t),o={Part:Backbone.View.extend({tagName:"li",tpl:{top:_.template(s.filter("#part-options-part_visible").html()),name:_.template(s.filter("#part-options-part_name").html()),action:_.template(s.filter("#part-options-part_action").html()),wrapper:_.template(s.filter("#part-options-part_wrapper").html())},initialize:function(e){this.options=e,this.set_options()},set_options:function(){},render:function(){this.$el.empty().attr("data-part",this.options.part).append(this.tpl.top({l10n:i}));var e=this.$el.find(".name_action_wrapper");e.append(this.tpl.name({part:{name:i["part_"+this.options.part]},l10n:i})).append(this.tpl.action({l10n:i})),this.get_options()},get_options:function(){this.$el.append(this.tpl.wrapper({part:{part:this.options.part},l10n:i}));var e=this.$el.find("div."+this.options.part+"-options"),t=e.find(".option"),n=this.$el.find(".part_action a"),r=this;this.field&&(this.field.render(),this.field.on("changed",function(e){r.model.set_property(r.field.options.property,e)},this),t.append(this.field.$el)),n.off("click").on("click",function(t){return t.preventDefault(),t.stopPropagation(),e.is(":visible")?(e.hide(),r.$el.removeClass("active")):(e.show(),r.$el.addClass("active")),!1}),e.find(".edit_part a").on("click",function(e){return e.preventDefault(),e.stopPropagation(),r.spawn_editor(),!1}),e.hide()},spawn_editor:function(){var e=this,t="post-part-"+this.options.part,i=this.model.get_property_value_by_name(t),s="meta"===this.options.part?r.Embed:n.inserts.embed,o=new s({data:{code:i},model:this.model});o.start().done(function(n,r){e.model.set_property(t,r)}),setTimeout(function(){var t=o.get_manager?o.get_manager():{};return t.done?e.listenTo(Upfront.Events,"element:settings:saved",function(){return t.done()}):!1})}})};return o.Part_Author=o.Part.extend({}),o.Part_Title=o.Part.extend({}),o.Part_Read_more=o.Part.extend({}),o.Part_Meta=o.Part.extend({}),o.Part_Date_posted=o.Part.extend({set_options:function(){this.field=new Upfront.Views.Editor.Field.Text({model:this.model,label:i.format,label_style:"inline",property:"date_posted_format"})}}),o.Part_Categories=o.Part.extend({set_options:function(){this.field=new Upfront.Views.Editor.Field.Number({model:this.model,label:i.max_categories,label_style:"inline",property:"categories_limit"})}}),o.Part_Tags=o.Part.extend({set_options:function(){this.field=new Upfront.Views.Editor.Field.Number({model:this.model,label:i.max_tags,label_style:"inline",property:"tags_limit"})}}),o.Part_Comment_count=o.Part.extend({set_options:function(){this.field=new Upfront.Views.Editor.Field.Checkboxes({model:this.model,property:"comment_count_hide",values:[{label:i.hide_comments,value:"1"}]})}}),o.Part_Content=o.Part.extend({set_options:function(){this.field=new Upfront.Views.Editor.Field.Number({model:this.model,label:i.limit_words,label_style:"inline",property:"content_length"})}}),o.Part_Featured_image=o.Part.extend({set_options:function(){this.field=new Upfront.Views.Editor.Field.Checkboxes({model:this.model,property:"resize_featured",values:[{label:i.resize_to_fit,value:"1"}]})}}),o.Part_Gravatar=o.Part.extend({set_options:function(){this.field=new Upfront.Views.Editor.Field.Number({model:this.model,label:i.size_px,label_style:"inline",property:"gravatar_size"})}}),{get_part:function(e,t){e=e||"Part";var n=!1,r="Part_"+e.substr(0,1).toUpperCase()+e.substr(1),i=o[r]?o[r]:o.Part;return n=new i({model:t,part:e}),n}}})}(jQuery),function(e){define("elements/upfront-posts/js/post-list-settings-panels",["text!elements/upfront-posts/tpl/views.html","elements/upfront-posts/js/post-list-settings-parts","scripts/upfront/element-settings/root-settings-panel"],function(t,n,r){var i=Upfront.Settings.l10n.posts_element,s=e(t);Upfront.Util.post({action:"upfront_posts-data"}).success(function(e){o._initial=e.data});var o={_initial:{}};r=r.extend({is_active:function(){return this.$el.find(".uf-settings-panel__body").is(":visible")}}),o.General=r.extend({initialize:function(e){this.options=e;var t=this,n=new a({model:this.model}),r=function(e){this.model.set_property(this.options.property,e),"list_type"===this.options.property&&n.dispatch_settings(),t.trigger("settings:dispatched")},s=new Upfront.Views.Editor.Field.Radios({model:this.model,property:"display_type",label:i.display_type_label,layout:"horizontal-inline",icon_class:"upfront-posts-display_type",values:[{label:i.single_post,value:"single",icon:"upfront-posts-single"},{label:i.post_list,value:"list",icon:"upfront-posts-list"}]}),o=new Upfront.Views.Editor.Field.Radios({model:this.model,property:"list_type",label:i.list_type_label,layout:"horizontal",values:[{label:i.post_list_custom,value:"custom"},{label:i.post_list_tax,value:"taxonomy"},{label:i.post_list_generic,value:"generic"}]});s.on("changed",r),o.on("changed",r),n.on("post:added",function(){this.trigger("post:added")},this),n.on("post:removed",function(){this.trigger("post:removed")},this),this.settings=_([new Upfront.Views.Editor.Settings.Item({model:this.model,title:i.query_settings,fields:[s,o]}),n])},title:i.general_settings});var u=Upfront.Views.Editor.Field.Hidden.extend({events:function(){return _.extend({},Upfront.Views.Editor.Field.Hidden.prototype.events,{"click a[href=#add]":"select_posts"},{"click ol li a[href=#rmv]":"remove_post"})},get_field_html:function(){var e=Upfront.Views.Editor.Field.Hidden.prototype.get_field_html.apply(this),t=this.get_decoded_values(this.options.property),n="single"===this.model.get_property_value_by_name("display_type"),r=t.length?i.add_custom_post:i.select_custom_post;return n&&(r=i.select_custom_post,t&&(t=[_(t).first()])),e+='<i class="upfront-posts-custom-add_post"></i> <a href="#add">'+r+"</a>",_.isArray(t)&&t.length>0&&(e+="<ol>",_.each(t,function(t){if(!t)return!1;e+='<li><span class="permalink">'+t.permalink+'</span><a href="#rmv" data-id="'+t.id+'"><i>&times;</i></a></li>'}),e+="</ol>"),'<div class="custom_posts">'+e+"</div>"},select_posts:function(e){e.preventDefault(),e.stopPropagation();var t=this;Upfront.Views.Editor.PostSelector.open().done(function(n){if(!n)return!1;var r=n.get("ID"),i=n.get("permalink"),s="single"===t.model.get_property_value_by_name("display_type"),o=t.get_decoded_values(t.options.property);s?o=[{id:r,permalink:i}]:(o.push({id:r,permalink:i}),t.select_posts(e)),t.model.set_property(t.options.property,t.encode_values(o)),t.trigger("post:added")})},remove_post:function(t){t.preventDefault(),t.stopPropagation();var n=e(t.target).closest("a").attr("data-id"),r=this.get_decoded_values(this.options.property);r=_(r).reject(function(e){return e.id==n}),this.model.set_property(this.options.property,this.encode_values(r)),this.trigger("post:removed")},get_decoded_values:function(e){if(!e)return[];var t=this.model.get_property_value_by_name(e);return this.decode_values(t)},decode_values:function(e){if(!e)return[];var t=e&&e.length?JSON.parse(decodeURIComponent(e)):[];return t},encode_values:function(e){return encodeURIComponent(JSON.stringify(e))}}),a=Upfront.Views.Editor.Settings.Item.extend({group:!1,_terms_cache:{},events:function(){return _.extend({},Upfront.Views.Editor.Settings.Item.prototype.events,{"click [id*=taxonomy] .upfront-field-select-option":"update_terms"})},initialize:function(e){this.options=e,this.dispatch_settings()},render:function(){Upfront.Views.Editor.Settings.Item.prototype.render.call(this),e(".upfront-chosen-select",this.$el).chosen({width:"230px"})},dispatch_settings:function(){var e=this.model.get_property_value_by_name("list_type");this.fields=_([]),"custom"===e?this.populate_custom_items():"taxonomy"===e?this.populate_tax_items():this.populate_generic_items()},populate_custom_items:function(){var e=new u({model:this.model,property:"posts_list"});e.on("post:added",function(){this.trigger("post:added")},this),e.on("post:removed",function(){this.trigger("post:removed")},this),this.fields=_([e])},populate_generic_items:function(){this.populate_shared_tax_generic_items(),this.populate_pagination_items()},populate_tax_items:function(){var e=[],t=[],n=this.model.get_property_value_by_name("display_type");_(o._initial.taxonomies).each(function(t,n){e.push({label:t,value:n})}),_(o._initial.post_types).each(function(e,n){t.push({label:e,value:n})}),this.fields=_([]),"list"===n&&(this.populate_pagination_items(),this.fields.push(new Upfront.Views.Editor.Field.Number({model:this.model,label:i.offset,property:"offset",min:1,max:20}))),this.fields.push(new Upfront.Views.Editor.Field.Select({model:this.model,label:i.post_type,property:"post_type",values:t})),this.fields.push(new Upfront.Views.Editor.Field.Select({model:this.model,label:i.taxonomy,property:"taxonomy",values:e})),this.fields.push(new Upfront.Views.Editor.Field.Chosen_Select({model:this.model,label:i.term,compact:!0,property:"term",values:[{label:i.select_tax,value:"",disabled:!0}]})),this.populate_shared_tax_generic_items(),this.once("rendered",this.update_terms,this),this.once("rendered",function(){this.toggle_offset_based_on_pagination_value(this.model.get_property_value_by_name("pagination"))},this)},populate_pagination_items:function(){var e=this.model.get_property_value_by_name("display_type"),t=this;"list"===e&&this.fields.push(new Upfront.Views.Editor.Field.Radios({model:this.model,label:i.pagination,property:"pagination",layout:"horizontal-inline",values:[{label:i.none,value:""},{label:i.numeric,value:"numeric"},{label:i.prev_next,value:"arrows"}],change:function(e){t.toggle_offset_based_on_pagination_value(e)}}))},toggle_offset_based_on_pagination_value:function(e){if("taxonomy"!==this.model.get_property_value_by_name("list_type"))return!1;"numeric"===e||"arrows"===e?(this.model.set_property("offset",1,!0),this.hide_offset_field()):this.show_offset_field()},show_offset_field:function(){var e=this.$el.find('input[name="offset"]').closest(".upfront-field-wrap-number");e.show()},hide_offset_field:function(){var e=this.$el.find('input[name="offset"]').closest(".upfront-field-wrap-number");e.hide()},populate_shared_tax_generic_items:function(){var e=this.model.get_property_value_by_name("display_type");"list"===e&&(this.fields.push(new Upfront.Views.Editor.Field.Number({model:this.model,label:i.limit,property:"limit",min:1,max:20})),this.fields.push(new Upfront.Views.Editor.Field.Radios({model:this.model,property:"sticky",label:i.sticky_posts,values:[{label:i.sticky_ignore,value:""},{label:i.sticky_prepend,value:"prepend"},{label:i.sticky_exclude,value:"exclude"}]}))),this.fields.push(new Upfront.Views.Editor.Field.Radios({model:this.model,label:i.result_length,property:"content",layout:"horizontal-inline",values:[{label:i.excerpt,value:"excerpt"},{label:i.full_post,value:"content"}]}))},update_terms:function(){var e=this,t;this.fields.each(function(e){if("term"===e.property_name)return!0;e.property.set({value:e.get_value()},{silent:!1})}),t=this.model.get_property_value_by_name("taxonomy");if(!t)return!1;if(this._terms_cache[t]){var n=this._terms_cache[t];return this._spawn_terms_element(n)}Upfront.Util.post({action:"upfront_posts-terms",taxonomy:t}).success(function(n){var r=[];_(n.data).each(function(e,t){r.push({label:e,value:t})}),e._terms_cache[t]=r,e._spawn_terms_element(r)})},_spawn_terms_element:function(e){var t=new Upfront.Views.Editor.Field.Chosen_Select({model:this.model,label:i.term,compact:!0,property:"term",values:e,default_value:this.model.get_property_value_by_name("term")});this.fields._wrapped[4]=t,this.$el.empty(),this.render()}});o.PostParts=r.extend({title:i.post_part_settings,initialize:function(e){this.options=e;var t=this,n=_.map(Upfront.data.upfront_posts.default_parts,function(e){return{label:i["part_"+e],value:e}}),r=new l({model:this.model}),s=function(e){this.model.set_property(this.options.property,this.get_value()),this.model.set_property("post_parts",this.get_value(),!1),t.trigger("settings:dispatched")},o=new Upfront.Views.Editor.Field.Checkboxes({model:this.model,property:"enabled_post_parts",layout:"horizontal-inline",values:n});o.on("changed",s,o),this.settings=_([new f({model:this.model,title:i.post_parts_picker,fields:[o]}),r])}});var f=Upfront.Views.Editor.Settings.Item.extend({className:"uposts-parts-picker-setting"}),l=Upfront.Views.Editor.Settings.Item.extend({group:!1,initialize:function(e){this.options=e,this.fields=_([new c({model:this.model,property:"post_parts",label:i.post_parts_sorter})])}}),c=Upfront.Views.Editor.Field.Hidden.extend({render:function(){Upfront.Views.Editor.Field.Hidden.prototype.render.apply(this),this.$el.append('<ul class="post_parts"></ul>');var e=this,t=this.model.get_property_value_by_name("enabled_post_parts"),r=this.model.get_property_value_by_name(this.options.property),i=[],s=this.$el.find("ul");i=r&&r.length?r:t,_.each(i,function(r,i){if(t.indexOf(r)<0)return!0;var o=n.get_part(r,e.model);o.render(),s.append(o.$el)}),s.sortable({stop:function(t,n){var r=s.sortable("toArray",{attribute:"data-part"});e.model.set_property(e.options.property,r,!1)}}),s.disableSelection()},get_value:function(){return this.model.get_property_value_by_name(this.options.property)}});return o})}(jQuery),define("text!elements/upfront-widget/tpl/preset-style.html",[],function(){return"<?php if(!empty($properties['preset_style'])) { ?><?php echo $properties['preset_style'] ?><?php } ?>\n"}),function(e){define("elements/upfront-posts/js/post-list-settings",["elements/upfront-posts/js/post-list-settings-panels","scripts/upfront/element-settings/settings","scripts/upfront/element-settings/advanced-settings","scripts/upfront/preset-settings/util","text!elements/upfront-widget/tpl/preset-style.html"],function(e,t,n,r,i){var s=Upfront.Settings.l10n.posts_element,o=t.extend({panels:{Appearance:{mainDataCollection:"postsPresets",styleElementPrefix:"posts-preset",ajaxActionSlug:"posts",panelTitle:s.settings,presetDefaults:Upfront.mainData.presetDefaults.posts,styleTpl:i,migrateDefaultStyle:function(e){return e=e.replace(/(div)?\.uposts-object\s/g,""),e=e.replace(/(div)?\.upfront-object\s/g,""),e},migrateElementStyle:function(e,t){return e=e.replace(/\.uposts-object/g,""),e}}},initialize:function(t){this.constructor.__super__.initialize.call(this,t),this.options=t;var n=this,r=new e.General({model:this.model}),i=new e.PostParts({model:this.model});r.on("settings:dispatched",this.rerender,this),r.on("post:removed",this.rerender,this),r.on("post:added",this.rerender,this),i.on("settings:dispatched",this.rerender,this),this.panels=_.extend({General:r,PostParts:i},this.panels)},rerender:function(){var t=-1,n=_(this.panels);me=this,general=new e.General({model:this.model}),post_parts=new e.PostParts({model:this.model}),n.each(function(e,n){e&&e.is_active&&e.is_active()&&(t=n)}),this.$el.empty(),this.initialize(this.options),this.render(),t.length>=0&&this.toggle_panel&&this.toggle_panel(t)},toggle_panel:function(e){if(e<0)return!1;_.each(this.panels,function(t,n){e===n&&(t||{}).showBody?t.showBody():(t||{}).hideBody&&t.hideBody()})},title:s.posts_settings,get_title:function(){return s.settings}});return r.generatePresetsToPage("posts",i),o})}(jQuery),function(e){define("uposts",["text!elements/upfront-posts/tpl/views.html","elements/upfront-posts/js/post-list-views","elements/upfront-posts/js/post-list-settings"],function(t,n,r){var i=Upfront.Settings.l10n.posts_element,s=e(t),o=Upfront.Models.ObjectModel.extend({init:function(){var e=Upfront.data.upfront_posts?_.clone(Upfront.data.upfront_posts):{};e.element_id=Upfront.Util.get_unique_id(e.id_slug+"-object"),this.init_properties(e)}}),u=Upfront.Views.ObjectView.extend({init:function(){this.listenTo(Upfront.Events,"csseditor:open",this.on_csseditor_open),this.listenTo(Upfront.Events,"csseditor:closed",this.on_csseditor_closed)},on_render:function(){var e=this.model.get_property_value_by_name("display_type");this.render_type_view(e),this.$el.find("> .upfront-object").css("min-height",""),this.parent_module_view.$el.find("> .upfront-module").css("min-height",""),this.add_region_class("upfront-region-container-has-posts",!0)},render_type_view:function(e){e=e||n.DEFAULT;var t=this,r=n[e]?new n[e]({model:this.model}):new n[n.DEFAULT]({model:this.model});r.element=this,r.render(),this.$el.find(".upfront-object-content").empty().append(r.$el),r._posts_load&&r._posts_load.success(function(){t.adjust_featured_images()})},on_csseditor_open:function(e){if(e!=this.model.get_element_id())return;this.listenTo(Upfront.Application.cssEditor,"updateStyles",this.adjust_featured_images)},on_csseditor_closed:function(e){if(e!=this.model.get_element_id())return;this.stopListening(Upfront.Application.cssEditor,"updateStyles")},adjust_featured_images:function(){this.$el.find(".thumbnail").each(function(){var t=e(this).height(),n=e(this).width(),r=e(this).find("img"),i,s;e(this).attr("data-resize")=="1"?(r.css({height:"",width:""}),i=r.height(),s=r.width(),t/n>i/s?r.css({height:"100%",width:"auto",marginLeft:(n-Math.round(t/i*s))/2,marginTop:""}):r.css({height:"auto",width:"100%",marginLeft:"",marginTop:(t-Math.round(n/s*i))/2})):(i=r.height(),t!=i&&r.css("margin-top",(t-i)/2))})},cleanup:function(){this.remove_region_class("upfront-region-container-has-posts",!0)}}),a=Upfront.Views.Editor.Sidebar.Element.extend({render:function(){this.$el.addClass("upfront-icon-element upfront-icon-element-posts"),this.$el.html(i.element_name)},add_element:function(){var e=new o,t=new Upfront.Models.Module({name:"",properties:[{name:"element_id",value:Upfront.Util.get_unique_id("module")},{name:"class",value:"c24 upfront-posts_module"},{name:"has_settings",value:0},{name:"row",value:Upfront.Util.height_to_row(210)}],objects:[e]});this.add_module(t)}});Upfront.Application.LayoutEditor.add_object("Uposts",{Model:o,View:u,Element:a,Settings:r,cssSelectors:{".uposts-object ul":{label:i.css.container_label,info:i.css.container_info},".uposts-object li":{label:i.css.post_label,info:i.css.post_info},".uposts-object li .date_posted":{label:i.css.date_label,info:i.css.date_info},".uposts-object li .author":{label:i.css.author_label,info:i.css.author_info},".uposts-object li .post_categories":{label:i.css.categories_label,info:i.css.categories_info},".uposts-object li .comment_count":{label:i.css.comment_count_label,info:i.css.comment_count_info},".uposts-object li .content":{label:i.css.content_label,info:i.css.content_info},".uposts-object li .gravatar":{label:i.css.gravatar_label,info:i.css.gravatar_info},".uposts-object li .read_more":{label:i.css.read_more_label,info:i.css.read_more_info},".uposts-object li .post_tags":{label:i.css.post_tags_label,info:i.css.post_tags_info},".uposts-object li .thumbnail":{label:i.css.thumbnail_label,info:i.css.thumbnail_info},".uposts-object li .title":{label:i.css.title_label,info:i.css.title_info}},cssSelectorsId:Upfront.data.upfront_posts.type}),Upfront.Models.PostsModel=o,Upfront.Views.PostsView=u})}(jQuery),define("text!elements/upfront-search/tpl/usearch.html",[],function(){return'<div class="upfront-search">\n	<form action="<?php echo $action ?>" method="GET">\n		<input type="search" class="search-field search-<?php echo $iconClass ?>" name="s" value="" placeholder="<?php echo $placeholder ?>"/>\n		<?php if($label == \'__image__\') { ?>\n			<i class="icon-search"></i>\n		<?php } ?>\n		<?php if($label && $label != \'__image__\') { ?>\n			<button class="search-button search-<?php echo $iconClass ?>"><?php echo $label ?></button>\n		<?php } ?>\n    </form>\n\n</div>'}),function(e){define("usearch",["text!elements/upfront-search/tpl/usearch.html"],function(t){var n=Upfront.Settings.l10n.search_element,r=Upfront.Models.ObjectModel.extend({init:function(){var e=_.clone(Upfront.data.usearch.defaults);e.element_id=Upfront.Util.get_unique_id(e.id_slug+"-object"),this.init_properties(e)}}),i=Upfront.Views.ObjectView.extend({tpl:Upfront.Util.template(t),initialize:function(e){this.model instanceof r||(this.model=new r({properties:this.model.get("properties")})),this.constructor.__super__.initialize.call(this,[e])},get_content_markup:function(){var e=this.model.get_property_value_by_name("label"),t={placeholder:this.model.get_property_value_by_name("placeholder"),label:e,action:"/",iconClass:e=="__image__"?"icon":"text",element_id:this.model.get_property_value_by_name("element_id")};return this.tpl(t)},on_render:function(){var e=this.model.get_property_value_by_name("is_rounded"),t=this.model.get_property_value_by_name("color"),n=this.$el.find(".upfront-editable_entity:first");e==1?n.addClass("rounded"):n.removeClass("rounded"),t?n.css("background-color",t):n.css("background-color","")}}),s=Upfront.Views.Editor.Sidebar.Element.extend({priority:200,draggable:!1,render:function(){this.$el.addClass("upfront-icon-element upfront-icon-element-search"),this.$el.html(n.element_name)},add_element:function(){var e=new r,t=new Upfront.Models.Module({name:"",properties:[{name:"element_id",value:Upfront.Util.get_unique_id("module")},{name:"class",value:"c6 upfront-search_module"},{name:"has_settings",value:0},{name:"row",value:Upfront.Util.height_to_row(75)}],objects:[e]});this.add_module(t)}}),o=Upfront.Views.Editor.Settings.Panel.extend({initialize:function(e){this.options=e,this.settings=_([new Upfront.Views.Editor.Settings.Item({model:this.model,title:n.settings,fields:[new Upfront.Views.Editor.Field.Text({model:this.model,property:"placeholder",label:n.placeholder_label})]}),new u({model:this.model})])},get_label:function(){return n.field},get_title:function(){return n.field_settings}}),u=Upfront.Views.Editor.Settings.Item.extend({render:function(){var t=this,r=this.model.get_property_value_by_name("label"),i="__image__"==r||""==r||!r?"Custom text":r,s='<label for="search_type-image"><i class="icon-search"></i></label>',o='<span class="search-search_text'+(r!=""&&r!="__image__"?" active":"")+'" contenteditable="true">'+i+"</span>";this.wrap({title:n.btn_content,markup:'<input type="radio" id="search_type-image" name="search_type" value="__image__" '+(r=="__image__"?'checked="checked"':"")+" /> "+s+'<input type="radio" id="search_type-text" name="search_type" value="'+i+'" '+(r!=""&&r!="__image__"?'checked="checked"':"")+" /> "+o}),this.$el.find(".search-search_placeholder").on("click",function(){e(this).trigger("input")}),this.$el.find(".search-search_text").on("input",function(){e("#search_type-text").val(e(this).text()).attr("checked",!0),e(this).addClass("active")}),this.$el.on("change","#search_type-image, #search_type-text, #search_type-none",function(){e(this).attr("id")=="search_type-text"&&e(this).prop("checked")?t.$el.find(".search-search_text").addClass("active"):t.$el.find(".search-search_text").removeClass("active")})},get_name:function(){return"label"},get_value:function(){var e=this.$el.find(':radio[name="search_type"]:checked');return e.length?e.val():"__image__"}}),a=Upfront.Views.Editor.Settings.Settings.extend({initialize:function(e){this.has_tabs=!1,this.options=e,this.panels=_([new o({model:this.model})])},get_title:function(){return n.settings}});Upfront.Application.LayoutEditor.add_object("Usearch",{Model:r,View:i,Element:s,Settings:a,cssSelectors:{".upfront-search":{label:n.css.container_label,info:n.css.container_info},"input.search-field":{label:n.css.field_label,info:n.css.field_info},"button.search-button":{label:n.css.button_label,info:n.css.button_info}},cssSelectorsId:Upfront.data.usearch.defaults.type}),Upfront.Models.UsearchModel=r,Upfront.Views.UsearchView=i})}(jQuery),define("text!elements/upfront-slider/tpl/uslider.html",[],function(){return'<div class="uslider slider-preset-<?php echo $preset ?> uslider-<?php echo $controlsWhen ?> uslider-<?php echo $style ?> uslider-<?php echo $transition ?> <?php echo !empty($captionBackground) ? \'uslider-caption-background\' : \'\' ?>"\n  id="uslider-<?php echo $element_id ?>"\n  data-item=".uslide"\n  data-auto="<?php echo $rotate ?>"\n  data-auto_height="<?php echo $production ?>"\n  data-adjust_slide_size="<?php echo $production ?>"\n  data-effect="<?php echo $transition ?>"\n  data-interval="<?php echo $rotateTime * 1000 ?>"\n  data-show_control="<?php echo $controlsWhen ?>"\n  data-control_num="<?php echo $dots /* && $production */ ? 1 : 0 ?>"\n  data-control_next_prev="<?php echo $arrows /* && $production */ ? 1 : 0 ?>"\n  data-starting_slide="<?php echo $startingSlide ?>"\n  data-caption_height="<?php echo $primaryStyle == \'below\' ? 1 : 0 ?>"\n>\n	<?php if($slidesLength){ ?>\n	<div class="uslides">\n		<?php for($i=0; $i<$slidesLength; $i++) { ?>\n		<div class="uslide uslide-<?php echo $slides[$i][\'style\'] ?>"\n			<?php if($primaryStyle != \'notext\'){ ?>\n				data-caption-selector="#uslider-<?php echo $element_id ?> .caption-<?php echo $slides[$i][\'id\'] ?>"\n			<?php } ?>\n			rel="<?php echo $slides[$i][\'id\'] ?>">\n\n			<?php if($slides[$i][\'url\']){ ?>\n			<a href="<?php echo $slides[$i][\'url\'] ?>" target="<?php echo $slides[$i][\'linkTarget\'] ?>" class="uslider-link uslide-image <?php echo $slides[$i][\'urlType\'] == \'image\' ? \' uslider_lightbox_link\' : \'\' ?>">\n			<?php } else { ?>\n			<div class="uslide-image">\n			<?php } ?>\n				<img src="<?php echo $slides[$i][\'src\'] ?>" style="min-width:100%, min-height:100%">\n			<?php if($slides[$i][\'url\']){ ?>\n			</a>\n			<?php } else { ?>\n			</div>\n			<?php } ?>\n\n		</div>\n		<?php } ?>\n	</div>\n	<?php if($primaryStyle != \'notext\'){ ?>\n	<div class="uslider-texts">\n		<?php for($i=0; $i<$slidesLength; $i++) { ?>\n		<div class="uslide-text caption-<?php echo $slides[$i][\'id\'] ?>" rel="<?php echo $slides[$i][\'id\'] ?>" style="background-color:<?php echo !empty($slides[$i][\'captionBackground\']) ? $slides[$i][\'captionBackground\'] : \'transparent\' ?>;color:<?php echo $slides[$i][\'captionColor\'] ?>">\n			<div class="uslide-editable-text" placeholder="Slider description">\n				<?php echo $slides[$i][\'text\'] ?>\n			</div>\n		</div>\n		<?php } ?>\n	</div>\n	<?php } ?>\n	<?php } else { ?>\n	<!-- No images in this slider -->\n	<?php } ?>\n</div>\n\n<style type="text/css">\n	/*<?php if($captionUseBackground) { ?>\n	.uslide .uslide-caption {\n		padding: 5px 15px;\n	}\n	<?php } ?>*/\n	#uslider-<?php echo $element_id ?> {\n		width: 100%;\n	}\n	#uslider-<?php echo $element_id ?> .uslide-caption {\n		width: <?php echo $textWidth ?>;\n	}\n	#uslider-<?php echo $element_id ?> .uslide-right .uslide-caption {\n		margin-left: <?php echo $imageWidth ?>;\n	}\n\n	#uslider-<?php echo $element_id ?> .uslide-right .uslide-image {\n		float: left;\n	}\n\n	#uslider-<?php echo $element_id ?> .uslide-left .uslide-caption {\n		float: left;\n	}\n\n	#uslider-<?php echo $element_id ?> .uslide-left .uslide-image {\n		margin-left: <?php echo $textWidth ?>\n	}\n	#uslider-<?php echo $element_id ?> .uslide-left .uslide-caption,\n	#uslider-<?php echo $element_id ?> .uslide-right .uslide-caption {\n		height: <?php echo $imageHeight ?>px;\n	}\n\n	#uslider-<?php echo $element_id ?> .uslide-left .uslide-image,\n	#uslider-<?php echo $element_id ?> .uslide-right .uslide-image {\n		width: <?php echo $imageWidth ?>;\n	}\n\n	#uslider-<?php echo $element_id ?> .uslide-image {\n		height: <?php echo $imageHeight ?>px;\n		position: relative;\n		overflow: hidden;\n	}\n\n	<?php if ($usingNewAppearance === false) { ?>\n	#uslider-<?php echo $element_id ?> .uslide-caption {\n		background-color:<?php echo !empty($captionBackground) ? $captionBackground : \'transparent\' ?>;\n	}\n	<?php } ?>\n</style>\n'}),define("text!elements/upfront-slider/tpl/preset-style.html",[],function(){return"#page .slider-preset-<?php echo $properties['id'] ?> .uslide-caption {\n	<?php if(!empty($properties['captionBackground'])) { ?>\n	background: <?php echo $properties['captionBackground'] ?>;\n	<?php } ?>\n}\n\n/* Custom CSS */\n<?php if(!empty($properties['preset_style'])) { ?><?php echo $properties['preset_style'] ?><?php } ?>\n"}),define("elements/upfront-slider/js/settings",["scripts/upfront/element-settings/settings","scripts/upfront/element-settings/root-settings-panel","scripts/upfront/preset-settings/util","text!elements/upfront-slider/tpl/preset-style.html"],function(e,t,n,r){var i=Upfront.Settings.l10n.slider_element,s={mainDataCollection:"sliderPresets",styleElementPrefix:"slider-preset",ajaxActionSlug:"slider",panelTitle:i.settings,presetDefaults:Upfront.mainData.presetDefaults.slider,styleTpl:r,stateModules:{Global:[{moduleType:"Selectbox",options:{state:"global",default_value:"notext",title:i.slider_styles,custom_class:"slide_style",label:i.image_caption_position,fields:{name:"primaryStyle"},values:[{label:i.notxt,value:"notext",icon:"nocaption"},{label:i.txtb,value:"below",icon:"below"},{label:i.txto,value:"over",icon:"bottomOver"},{label:i.txts,value:"side",icon:"right"}]}},{moduleType:"Colors",options:{title:"Colors",multiple:!1,single:!0,abccolors:[{name:"captionBackground",label:i.caption_bg}]}}]},migrateDefaultStyle:function(e){return e=e.replace(/(div)?\.upfront-uslider\s/g,""),e=e.replace(/(div)?\.upfront-object\s/g,""),e=e.replace(/\.uslides\s\./g,""),e},migratePresetProperties:function(e){var t={};this.model.get("properties").each(function(e){t[e.get("name")]=e.get("value")}),e.set({captionBackground:t.captionBackground,primaryStyle:t.primaryStyle})}},o=t.extend({className:"uf-settings-panel upfront-settings_panel upfront-settings_panel_wrap uslider-settings",settings:[{type:"SettingsItem",triggerChange:!0,title:i.slider_behaviour,group:!0,className:"general_settings_item uslider-rotate-settings",fields:[{type:"Checkboxes",property:"rotate",layout:"horizontal-inline",className:"rotate",multiple:!0,default_value:0,values:[{label:i.rotate_every,value:"true"}],change:function(e,t){e[0]==="true"?t.$el.find(".rotate-time").css("opacity","1"):t.$el.find(".rotate-time").css("opacity","0.5")}},{type:"Number",className:"rotate-time",property:"rotateTime",min:1,max:60,step:1,suffix:"sec."},{type:"Select",property:"transition",label:i.slider_transition,layout:"horizontal-inline",icon_class:"upfront-region-field-icon",className:"uslider-transition-setting rotate-effect",default_value:"crossfade",values:[{label:i.slide_down,value:"slide-down",icon:"bg-slider-slide-down"},{label:i.slide_up,value:"slide-up",icon:"bg-slider-slide-up"},{label:i.slide_right,value:"slide-right",icon:"bg-slider-slide-right"},{label:i.slide_left,value:"slide-left",icon:"bg-slider-slide-left"},{label:i.crossfade,value:"crossfade",icon:"bg-slider-crossfade"}]}]},{type:"SettingsItem",triggerChange:!0,title:i.slider_controls,className:"general_settings_item",fields:[{type:"Select",label:i.slider_controls_style,className:"slider-contrls-style",property:"controls",default_value:"arrows",values:[{label:i.dots,value:"dots"},{label:i.arrows,value:"arrows"},{label:i.both,value:"both"}]},{type:"Radios",property:"controlsWhen",layout:"horizontal-inline",default_value:"hover",className:"uslider-controlswhen-setting upfront-field-wrap upfront-field-wrap-multiple upfront-field-wrap-radios",values:[{label:i.on_hover,value:"hover"},{label:i.always,value:"always"}]}]}],initialize:function(e){this.constructor.__super__.initialize.call(this,e),this.on("rendered",function(){me.toggleColorSetting();var e=!1,t=me.model.get_property_value_by_name("captionBackground"),n=$("<span></span>");setting=me.$(".ugallery-colorpicker-setting"),setting.find(".upfront-field-wrap").append(n),setting.find('input[name="captionUseBackground"]').on("change",function(){me.toggleColorPicker()});var r=new Upfront.Views.Editor.Field.Color({blank_alpha:0,model:me.model,property:"captionBackground",default_value:"#ffffff",spectrum:{maxSelectionSize:9,localStorageKey:"spectrum.recent_bgs",preferredFormat:"hex",chooseText:i.ok,showInput:!0,allowEmpty:!0,show:function(){e=$(".sp-container:visible")},change:function(e){var n=e.toRgbString();me.model.set_property("captionBackground",n,!0),t=n,me.model.trigger("background",n)},move:function(t){var n=t.toRgbString();e.find(".sp-dragger").css("border-top-color",n),e.parent().find(".sp-dragger").css("border-right-color",n),me.parent_view.for_view.$el.find(".uslide-caption").css("background-color",n)},hide:function(){me.parent_view.for_view.$el.find(".uslide-caption").css("background-color",t)}}});r.render(),n.html(r.el),setting.find(".sp-replacer").css("display","inline-block"),me.toggleColorPicker()}),this.$el.on("change",'input[name="primaryStyle"]',function(e){me.toggleColorSetting()})},toggleColorSetting:function(){var e=this.$(".uslider-style-setting").find("input:checked").val();e=="notext"?this.$(".ugallery-colorpicker-setting").hide():this.$(".ugallery-colorpicker-setting").show()},toggleColorPicker:function(){var e=this.$(".ugallery-colorpicker-setting"),t=e.find("input:checked").val(),n=e.find(".sp-replacer");t=="1"?n.show():n.hide()},title:i.general}),u=t.extend({className:"uf-settings-panel upfront-settings_panel upfront-settings_panel_wrap uslider-slides",settings:[{type:"SettingsItem",group:!1,fields:[{type:"SlidesField"}]}],title:i.slides_order}),a=e.extend({panels:{Layout:o,Slides:u,Appearance:s},title:i.settings});return n.generatePresetsToPage("slider",r),a}),function(e){define("upfront_slider",["text!elements/upfront-slider/tpl/uslider.html","text!elements/upfront-slider/tpl/backend.html","elements/upfront-slider/js/settings","scripts/upfront/preset-settings/util","scripts/upfront/link-model","text!elements/upfront-slider/tpl/preset-style.html"],function(t,n,r,i,s,o){var u=Upfront.Settings.l10n.slider_element,a=Backbone.Model.extend({defaults:Upfront.data.uslider.slideDefaults}),f=Backbone.Collection.extend({model:a}),l=Upfront.Models.ObjectModel.extend({init:function(){var e=_.clone(Upfront.data.uslider.defaults);e.element_id=Upfront.Util.get_unique_id(e.id_slug+"-object"),this.init_properties(e)}}),c=Upfront.Views.ObjectView.extend({self:{},module_settings:{},tpl:Upfront.Util.template(t),startingTpl:_.template(e(n).find("#startingTpl").html()),initialize:function(e){var t=this;this.model instanceof l||(this.model=new l({properties:this.model.get("properties")})),this.model.view=this,this.constructor.__super__.initialize.call(this,[e]),this.events=_.extend({},this.events,{"click .upfront-image-select":"firstImageSelection","click .upfront-icon-next":"nextSlide","click .upfront-icon-prev":"prevSlide","click .uslider-starting-options":"checkStartingInputClick"}),this.updateSlideDefaults(),this.model.slideCollection=new f(this.property("slides")),this.listenTo(this.model.slideCollection,"add remove reset change",this.onSlidesCollectionChange),this.listenTo(this.model,"change",this.onModelChange),this.listenTo(this.model,"addRequest",this.openImageSelector),this.lastStyle=this.get_preset_properties().primaryStyle,this.listenTo(this.model,"background",function(e){t.model.slideCollection.each(function(t){t.set("captionBackground",e)})}),this.listenTo(Upfront.Events,"theme_colors:update",this.update_colors,this),this.listenTo(Upfront.Events,"preset:slider:updated",this.caption_updated,this),this.listenTo(this.model,"preset:updated",this.preset_updated),this.listenTo(Upfront.Events,"command:layout:save",this.saveResizing),this.listenTo(Upfront.Events,"command:layout:save_as",this.saveResizing),this.imageProps={},this.cropHeight=!1,this.cropTimer=!1,this.cropTimeAfterResize=500,this.setCurrentSlide(0)},updateSlideDefaults:function(){primary=this.get_preset_properties().primaryStyle,defaults={below:"below",over:"bottomOver",side:"right"},Upfront.data.uslider.slideDefaults.style=defaults[primary]},get_preset_properties:function(){var e=this.model.get_property_value_by_name("preset"),t=i.getPresetProperties("slider",e)||{};return t},get_preset_property:function(e){var t=this.get_preset_properties();return t[e]?t[e]:!1},preset_updated:function(e){this.render(),Upfront.Events.trigger("preset:slider:updated",e)},caption_updated:function(e){var t=this.model.get_property_value_by_name("preset");t===e&&this.render()},update_colors:function(){var e=this.get_preset_properties();if(_.size(e)<=0)return!1;i.updatePresetStyle("slider",e,o)},on_edit:function(){return!1},get_content_markup:function(){var t=this,n,r={};this.checkStyles(),n=this.extract_properties();if(!this.model.slideCollection.length)return this.startingHeight=this.startingHeight||225,this.startingTpl({startingHeight:this.startingHeight,l10n:u});n.properties=this.get_preset_properties(),this.property("usingNewAppearance")&&(n.properties.primaryStyle&&(n.primaryStyle=n.properties.primaryStyle),n.properties.captionBackground&&(n.captionBackground=n.properties.captionBackground)),n.rotate=!1,n.dots=_.indexOf(["dots","both"],n.controls)!=-1,n.arrows=_.indexOf(["arrows","both"],n.controls)!=-1,n.slides=this.model.slideCollection.toJSON(),n.slidesLength=n.slides.length,n.imageWidth=n.primaryStyle=="side"?Math.round(n.rightImageWidth/n.rightWidth*100)+"%":"100%",n.textWidth=n.primaryStyle=="side"?Math.round((n.rightWidth-n.rightImageWidth)/n.rightWidth*100)+"%":"100%",n.imageHeight="100%";if(n.slides.length){var i=t.imageProps[n.slides[0].id];i?n.imageHeight=i.cropSize.height:n.imageHeight=n.slides[0].cropSize.height}n.production=!1,n.startingSlide=this.getCurrentSlide(),n.l10=u,n.usingNewAppearance=n.usingNewAppearance||!1,r=this.tpl(n);var s=e("<div></div>").append(r);return this.model.slideCollection.each(function(e){t.imageProps[e.id]||(t.imageProps[e.id]={size:e.get("size"),cropOffset:e.get("cropOffset"),cropSize:e.get("cropSize")});var n=t.imageProps[e.id],r=s.find(".uslide[rel="+e.id+"]").height(n.size.height).find("img");r.attr("src",e.get("srcFull")).css({position:"absolute",width:n.size.width,height:n.size.height,top:0-n.cropOffset.top,left:0-n.cropOffset.left,"max-width":"none","max-height":"none"}).parent().css({position:"relative",height:t.cropHeight||e.get("cropSize").height,overflow:"hidden"})}),s.html()},on_render:function(){var t=this;setTimeout(function(){var n=t.$el.find(".upfront-output-uslider"),r=n.find(".uslider").data();n.find(".uslides").on("rendered",function(){Upfront.Events.trigger("entity:object:refresh",t)}),n.find(".uslides").upfront_default_slider(r),n.find(".uslide-above").each(function(){var t=e(this);t.find(".uslide-caption").remove().prependTo(t)}),n.find(".uslide-left").each(function(){var t=e(this);t.find(".uslide-caption").remove().prependTo(t)}),n.find(".uslide-bottomOver, .uslide-middleCover, .uslide-bottomCover, .uslide-topCover").each(function(){var t=e(this);t.find(".uslide-caption").remove().prependTo(t.find(".uslide-image"))}),t.prepareSlider()},100);if(!t.parent_module_view)return;t.parent_module_view.$el.data("resizeHandling")||t.parent_module_view.$el.on("resizestart",e.proxy(t.onElementResizeStart,t)).on("resize",e.proxy(t.onElementResizing,t)).on("resizestop",e.proxy(t.onElementResize,t)).data("resizeHandling",!0);if(!this.model.slideCollection.length)return;this.$el.parent().length||setTimeout(function(){t.on_render()},100),this.update_caption_controls()},update_caption_controls:function(){var e=this,t=new Upfront.Views.Editor.InlinePanels.Panel;t.items=this.getControlItems(),t.render(),_.delay(function(){e.controls.$el.html(t.$el),e.controls.$el.css("width","auto"),e.updateSlideControls()},400)},hideSliderNavigation:function(){this.$(".upfront-default-slider-nav").hide(),this.$(".upfront-default-slider-nav-prev").hide(),this.$(".upfront-default-slider-nav-next").hide(),this.listenTo(Upfront.Events,"csseditor:open",function(e){e==this.property("element_id")&&(this.$(".upfront-default-slider-nav").show(),this.$(".upfront-default-slider-nav-prev").show(),this.$(".upfront-default-slider-nav-next").show())}).listenTo(Upfront.Events,"csseditor:closed",function(e){e==this.property("element_id")&&(this.$(".upfront-default-slider-nav").hide(),this.$(".upfront-default-slider-nav-prev").hide(),this.$(".upfront-default-slider-nav-next").hide())})},prepareSlider:function(){var t=this,n=t.$(".uslide-image"),r=t.$(".uslide-editable-text"),i=this.model.slideCollection.at(this.getCurrentSlide());t.onSlideShow(),t.$(".uslide").css({height:"auto"}),r.each(function(){var n=e(this);if(n.data("ueditor"))return!0;n.ueditor({autostart:!1,upfrontMedia:!1,upfrontImages:!1,placeholder:u.slide_desc,linebreaks:!1,inserts:[]}).on("start",function(){var n=e(this).closest(".uslide").attr("rel"),r=t.model.slideCollection.get(n);t.$el.addClass("upfront-editing"),Upfront.Events.trigger("upfront:element:edit:start","text"),e(this).on("syncAfter",function(){r.set("text",e(this).html(),{silent:!0})}).on("stop",function(){r.set("text",e(this).html()),t.property("slides",t.model.slideCollection.toJSON()),t.$el.removeClass("upfront-editing"),Upfront.Events.trigger("upfront:element:edit:stop");var n=e(this).data("ueditor");n.redactor&&n.redactor.events.trigger("cleanUpListeners"),t.render()})})}),t.get_preset_properties().primaryStyle=="side"&&t.setImageResizable();if(typeof i!="undefined"){var s=this.get_preset_properties().primaryStyle=="below"?this.$(".uslide[rel="+i.id+"]").find(".uslide-caption").outerHeight():0;t.$(".uslides").css({"padding-top":n.height()+s})}},updateSlideControls:function(){typeof this.$control_el!="undefined"&&this.$control_el.find(".upfront-element-controls").remove(),typeof this.controls!="undefined"&&(this.controls=undefined),this.updateControls()},nextSlide:function(e){e.preventDefault(),this.$(".uslides").upfront_default_slider("next")},prevSlide:function(e){e.preventDefault(),this.$(".uslides").upfront_default_slider("prev")},checkStyles:function(){var e=this,t=this.get_preset_properties().primaryStyle,n={below:"below",over:"bottomOver",side:"right"};t!=this.lastStyle&&(this.model.slideCollection.each(function(r){var i=r.get("style");(t=="below"&&_.indexOf(["below","above"],i)==-1||t=="over"&&_.indexOf(["topOver","bottomOver","topCover","middleCover","bottomCover"],i)==-1||t=="side"&&_.indexOf(["right","left"],i)==-1)&&r.set("style",n[t]);var s=e.$(".uslide[rel="+r.id+"]").find(".uslide-image");e.imageProps[r.id]=e.calculateImageResize({width:s.width(),height:s.height()},r)}),this.setTimer(),this.lastStyle=t,this.onSlidesCollectionChange())},checkStartingInputClick:function(e){e.stopPropagation()},firstImageSelection:function(e){e.preventDefault();var t=this.get_preset_properties().primaryStyle,n="nocaption";return t=="over"?n="bottomOver":t=="below"?n="below":t=="side"&&(n="right"),this.property("style",n),this.openImageSelector()},setImageResizable:function(){if(!this.model.slideCollection.length)return;var e=this,t=this.$(".upfront-default-slider-item-current"),n=t.find(".uslide-image"),r=e.$(".upfront-object").outerWidth(),i,s,o=t.find(".uslide-caption"),u=t.attr("rel"),a=this.model.slideCollection.get(u)||this.model.slideCollection.at(this.getCurrentSlide()),f=!1,l=a.get("style");this.$(".ui-resizable").resizable("destroy");if(l=="nocaption")return;n.resizable({handles:l=="right"?"e":"w",helper:"uslider-resize-handler",start:function(t,o){if(!o.element.hasClass("uslide-image"))return;r=e.$(".upfront-object").outerWidth(),i=e.get_element_columns(),s=e.get_element_max_columns_px()/e.get_element_max_columns(),f=n.height(),o.element.parent().closest(".ui-resizable").resizable("disable"),n.resizable("option",{minWidth:s*3,maxWidth:(i-3)*s,grid:[s,100],handles:l=="right"?"e":"w",helper:"uslider-resize-handler",minHeigth:f,maxHeight:f})},resize:function(t,i){if(!i.element.hasClass("uslide-image"))return;var s=i.helper.width(),u=r-s-30,f={width:u},c={width:s};e.calculateImageResize({width:s,height:i.element.height()},a),l=="right"?f["margin-left"]=s:c["margin-left"]=u,o.css(f),n.css(c)},stop:function(t,r){if(!r.element.hasClass("uslide-image"))return;var o=r.helper.width(),u=o>(i-3)*s?(i-3)*s:o<3*s?3*s:o,a=Math.round((u-(s-15))/s)+1,f=Math.floor(a/i*100);n.css({width:f+"%"}),e.model.slideCollection.each(function(t){t.get("style")!="nocaption"&&(e.imageProps[t.id]=e.calculateImageResize({width:n.width(),height:r.element.height()},t))}),e.cropHeight=r.element.height(),e.property("rightWidth",i,!0),e.property("rightImageWidth",a,!1),e.setTimer(),e.parent_module_view.$el.children(".upfront-module").resizable("enable")}})},setTimer:function(){var e=this;e.cropTimer&&(clearTimeout(e.cropTimer),e.cropTimer=!1),e.cropTimer=setTimeout(function(){var t=e.model.slideCollection.at(e.getCurrentSlide()),n=e.$(".uslide[rel="+t.id+"]").find(".uslide-editable-text");n.length&&n.data("redactor")?n.on("stop",function(){e.saveTemporaryResizing()}):e.saveTemporaryResizing()},e.cropTimeAfterResize)},onSlideShow:function(){var e=this;this.$(".uslides").on("slidein",function(t,n,r){n&&(e.setCurrentSlide(r),e.updateSlideControls(),e.$(".uimage-controls").attr("rel",n.attr("rel")),e.get_preset_properties().primaryStyle=="side"&&e.setImageResizable(),e.get_preset_properties().primaryStyle=="below"&&e.$(".uslides").css({"padding-top":n.find(".uslide-image").outerHeight()+n.find(".uslide-caption").outerHeight()}))})},createControl:function(e,t,n){var r=this,i=new Upfront.Views.Editor.InlinePanels.Control;return i.icon=e,i.tooltip=t,n&&i.on("click",function(e){r[n](e)}),i},createLinkControl:function(){var e=this,t=this.model.slideCollection.at(this.getCurrentSlide()),n=new Upfront.Views.Editor.InlinePanels.DialogControl,r;return this.currentSlideLink&&this.stopListening(this.currentSlideLink),typeof t!="undefined"&&typeof t.get("link")!="undefined"?r=new s(t.get("link")):r=new s({type:t?t.get("urlType"):"",url:t?t.get("url"):"",target:t?t.get("linkTarget"):""}),n.view=linkPanel=new Upfront.Views.Editor.LinkPanel({model:r,linkTypes:{image:!0},imageUrl:t?t.get("srcFull"):""}),this.listenTo(n,"panel:ok",function(){n.close()}),e.listenTo(n,"panel:open",function(){n.$el.closest(".uimage-controls").addClass("upfront-control-visible").end().closest(".uslider-link").removeAttr("href"),e.$el.closest(".ui-draggable").draggable("disable"),e.$(".uimage").sortable("disable")}),e.listenTo(n,"panel:close",function(){n.$el.closest(".uimage-controls").removeClass("upfront-control-visible").end().closest(".uslider-link").attr("href",typeof t!="undefined"?t.get("url"):""),e.$el.closest(".ui-draggable").draggable("enable")}),e.listenTo(r,"change",function(n){t.set({link:n.toJSON()},{silent:!0}),t.set({urlType:n.get("type"),url:n.get("url"),linkTarget:n.get("target")},{silent:!0}),e.property("slides",e.model.slideCollection.toJSON(),!0)}),e.listenTo(r,"change:target",function(n){t.set({link:n.toJSON()},{silent:!0}),t.set({urlType:n.get("type"),url:n.get("url"),linkTarget:n.get("target")},{silent:!0}),e.property("slides",e.model.slideCollection.toJSON(),!0),e.$el.find(".upfront-default-slider-item-current a").attr("target",n.get("target"))}),this.currentSlideLink=r,n.icon="link",n.tooltip=u.img_link,n.id="link",n},getElementColumns:function(){var e=this.$el.closest(".upfront-module"),t,n=!1;return e.length?(t=e.attr("class").split(" "),_.each(t,function(e){e.match(/^c\d+$/)&&(n=e.replace("c",""))}),n||-1):-1},onSlidesCollectionChange:function(){this.property("slides",this.model.slideCollection.toJSON(),!1)},onModelChange:function(){this.stopListeningTo&&(this.stopListeningTo(this.model.slideCollection),this.model.slideCollection=new f(this.property("slides")),this.listenTo(this.model.slideCollection,"add remove reset change",this.onSlidesCollectionChange)),this.render()},openImageSelector:function(e,t){var n=this,r=this.model.slideCollection.length?this.$(".upfront-default-slider-item-current").find(".uslide-image"):this.$(".upfront-object-content"),i={multiple:!0,preparingText:u.preparing_img,element_id:this.model.get_property_value_by_name("element_id"),customImageSize:{width:r.width(),height:r.height()}};e&&e.preventDefault(),Upfront.Views.Editor.ImageSelector.open(i).done(function(e,r){n.addSlides(e,t),Upfront.Views.Editor.ImageSelector.close()})},addSlides:function(e,t){var n=[];_.each(e,function(e,t){var r={sizes:e,id:t,srcFull:e.full[0],status:"ok"};e.custom&&!e.custom.error?(r.src=e.custom.url,r.size=e.custom.editdata.resize,r.cropSize=e.custom.crop,r.cropOffset=e.custom.editdata.crop):(r.src=e.full[0],r.size={width:e.full[1],height:e.full[2]}),n.push(r)}),t?(this.model.slideCollection.get(t).set(n[0]),this.onSlidesCollectionChange()):this.model.slideCollection.add(n)},onElementResizeStart:function(e,t){if(t.element.hasClass("uslide-image")||this.$(".upfront-image-starting-select").length)return;var n=this.property("style"),r=this;this.calculateColumnWidth();if(_.indexOf(["nocaption","below","above","right","left"],n)==-1)this.$(".uslider-caption").fadeOut("fast");else if(n=="right"||n=="left")t.element.resizable("option",{minWidth:r.colWidth*6}),this.$(".uslide").css({height:"100%"})},calculateColumnWidth:function(){return this.colWidth=Upfront.Behaviors.GridEditor.col_size},onElementResize:function(t,n){if(n.element.hasClass("uslide-image"))return;var r=this.$(".upfront-image-starting-select");if(r.length){this.startingHeight=e(".upfront-resize").height()-30;return}var i=this,s=this.$(".upfront-default-slider-item-current").find(".uslide-image"),o=this.model.slideCollection.at(this.getCurrentSlide()),u=this.get_preset_properties().primaryStyle,a=e(".upfront-resize"),f=u=="below"?this.$(".uslide-caption"):[],l=f.length?f.outerHeight():0,c={width:a.outerWidth()-30,height:a.outerHeight()-30-l},h=Upfront.Util.width_to_col(a.outerWidth()),p=Math.max(3,Math.round(this.property("rightImageWidth")*h/this.property("rightWidth"))),d=p*this.calculateColumnWidth();this.model.slideCollection.each(function(e){var t={height:c.height};t.width=u=="side"&&e.get("style")!="nocaption"?d:c.width,i.imageProps[e.id]=i.calculateImageResize(t,e)}),i.cropHeight=c.height,u=="side"&&this.property("rightImageWidth",p),this.property("rightWidth",h),i.setTimer()},onElementResizing:function(t,n){if(n.element.hasClass("uslide-image"))return;var r=this.$(".upfront-image-starting-select");if(r.length)return r.outerHeight(e(".upfront-resize").height()-30);var i=e(".upfront-resize"),s=this.$(".upfront-default-slider-item-current"),o=this.get_preset_properties().primaryStyle=="below"?s.find(".uslide-caption"):[],u=o.length?o.outerHeight():0,a={width:i.outerWidth()-30,height:i.outerHeight()-30-u},f=s.attr("rel"),l=this.model.slideCollection.get(f),c=s.find(".uslide-image"),h=this.get_preset_properties().primaryStyle,p={width:h=="side"?c.width():a.width,height:a.height},d={height:p.height};h=="side"?s.find(".uslide-caption").height(a.height):d.width=p.width,c.css(d).closest(".uslide").height(a.height).closest(".uslides").css({"padding-top":a.height}),this.calculateImageResize(p,l)},calculateImageResize:function(e,t){var n=this.$(".uslide[rel="+t.id+"]").find("img"),r=n.position(),i=t.get("size"),s=t.get("cropOffset"),o={top:-s.top,left:-s.left},u=i.width/i.height,a=e.width/e.height,f=i.width/i.height>e.width/e.height?"height":"width",l=f=="height"?"width":"height";if(f=="height"&&e.height>i.height){var c=e.height/i.height*i.width;n.css({width:c,height:e.height,top:0,left:Math.min(0,Math.max(o.left,e.width-i.width))})}else if(f=="width"&&e.width>i.width){var h=e.width/i.width*i.height;n.css({width:e.width,height:h,left:0,top:Math.min(0,Math.max(o.top,e.height-i.height))})}else n.css({height:i.height,width:i.width,top:Math.max(o.top,e.height-i.height),left:Math.max(o.left,e.width-i.width)});return n.closest(".uslide-image").width(Math.min(n.width(),e.width)).height(Math.min(n.height(),e.height)),{size:{width:n.width(),height:n.height()},cropOffset:{left:0-n.position().left,top:0-n.position().top},cropSize:e}},saveTemporaryResizing:function(){var e=this,t=[],n={action:"upfront-media-image-create-size"},r={},i=this.model.get_property_value_by_name("element_id");return this.model.slideCollection.each(function(n){var s=e.imageProps[n.id],o=s.cropOffset,u;o.width=s.cropSize.width,o.height=s.cropSize.height,u={id:n.id,element_id:i,rotate:n.get("rotation"),resize:s.size,crop:o},t.push(u),r[n.id]=u}),n.images=t,Upfront.Util.post(n).done(function(t){var n=t.data.images;_.each(n,function(t,n){var i=e.model.slideCollection.get(n),s=r[n];i.set({src:t.url,srcFull:t.urlOriginal,size:s.resize,cropSize:{width:s.crop.width,height:s.crop.height},cropOffset:{left:s.crop.left,top:s.crop.top}},{silent:!0})}),clearTimeout(e.cropTimer),e.cropTimer=!1,e.imageProps={},e.onSlidesCollectionChange()})},saveResizing:function(){var e=this;this.cropTimer&&this.saveTemporaryResizing().done(function(){var t={element:JSON.stringify(Upfront.Util.model_to_json(e.model)),action:"upfront_update_layout_element"};Upfront.Util.post(t).done()})},onRemoveSlide:function(e){this.removeSlide()},removeSlide:function(){this.startingHeight=this.$(".upfront-slider").height();if(confirm(u.delete_slide_confirm)){var e=this.getCurrentSlide();this.setCurrentSlide(e>0?e-1:0),this.model.slideCollection.remove(this.model.slideCollection.at(e).id)}},getCurrentSlide:function(){return this.currentSlide},setCurrentSlide:function(e){this.currentSlide=e},imageEditMask:function(t){var n=this,r=e(t.target).closest(".uimage-controls"),i=this.model.slideCollection.at(this.getCurrentSlide()),s=this.model.slideCollection.get(i.id),o=this.getEditorOptions(s);if(s.get("status")!="ok"){var a={multiple:!1,preparingText:u.preparing_slides,element_id:n.model.get_property_value_by_name("element_id")};return Upfront.Views.Editor.ImageSelector.open(a).done(function(e,t){n.addSlides(e);var r=n.model.slideCollection.indexOf(s);n.model.slideCollection.remove(s,{silent:!0});var i=n.model.slideCollection.at(n.model.slideCollection.length-1);n.model.slideCollection.remove(i,{silent:!0}),n.model.slideCollection.add(i,{at:r}),Upfront.Views.Editor.ImageSelector.close()})}t.preventDefault(),Upfront.Views.Editor.ImageEditor.open(o).done(function(e){s.set({src:e.src,srcFull:e.srcFull,cropSize:e.cropSize,size:e.imageSize,cropOffset:e.imageOffset,margin:{left:Math.max(0-e.imageOffset.left,0),top:Math.max(0-e.imageOffset.top,0)},rotation:e.rotation,id:e.imageId}),n.imageProps[s.id]={cropOffset:e.imageOffset,size:e.imageSize,cropSize:e.cropSize},n.render()}).fail(function(e){e&&e.reason=="changeImage"&&n.openImageSelector(null,e.id)})},getEditorOptions:function(e){var t=this,n=this.$(".uslide[rel="+e.id+"]").find(".uslide-image"),r=n.find("img"),i=e.get("sizes").full,s={width:r.width(),height:r.height()},o={left:0-r.position().left,top:0-r.position().top},u=this.model.get_property_value_by_name("element_id");return{id:e.id,element_id:u,maskSize:{width:n.width(),height:n.height()},maskOffset:n.offset(),position:o,size:s,fullSize:{width:i[1],height:i[2]},src:e.get("src"),srcOriginal:i[0],rotation:e.get("rotation")}},postTypes:function(){var e=[];return _.each(Upfront.data.ugallery.postTypes,function(t){t.name!="attachment"&&e.push({name:t.name,label:t.label})}),e},cleanup:function(){this.controls&&(this.controls.remove(),this.controls=!1)},extract_properties:function(){var e=this.model.get("properties").toJSON(),t={};return _.each(e,function(e){t[e.name]=e.value}),t.preset=t.preset||"default",t},property:function(e,t,n){return typeof t!="undefined"?(typeof n=="undefined"&&(n=!0),this.model.set_property(e,t,n)):this.model.get_property_value_by_name(e)},getControlItems:function(){if(!this.model.slideCollection.length)return _([]);var e=this,t=new Upfront.Views.Editor.InlinePanels.TooltipControl,n=this.model.slideCollection;multiBelow={above:["above",u.above_img],below:["below",u.below_img],nocaption:["nocaption",u.no_text]},multiOver={topOver:["topOver",u.over_top],bottomOver:["bottomOver",u.over_bottom],topCover:["topCover",u.cover_top],middleCover:["middleCover",u.cover_mid],bottomCover:["bottomCover",u.cover_bottom],nocaption:["nocaption",u.no_text]},multiSide={right:["right",u.at_right],left:["left",u.at_left],nocaption:["nocaption",u.no_text]},primaryStyle=this.get_preset_property("primaryStyle"),multiControls={},t=new Upfront.Views.Editor.InlinePanels.TooltipControl,slide=n.at(this.getCurrentSlide()),t.sub_items={},primaryStyle=="below"?multiControls=multiBelow:primaryStyle=="over"?multiControls=multiOver:primaryStyle=="side"?multiControls=multiSide:multiControls=!1,multiControls&&(_.each(multiControls,function(n,r){t.sub_items[r]=e.createControl(n[0],n[1])}),t.icon="caption",t.tooltip=u.cap_position,t.selected=multiControls[slide.get("style")]?slide.get("style"):"nocaption",this.listenTo(t,"select",function(t){var n=slide.get("style");slide.set("style",t),e.onSlidesCollectionChange(),(primaryStyle=="side"&&n=="nocaption"||t=="nocaption")&&setTimeout(function(){var t=e.$(".upfront-default-slider-item-current").find(".uslide-image");e.imageProps[slide.id]=e.calculateImageResize({width:t.width(),height:t.height()},slide),e.setTimer()},100)}));var r=_([this.createControl("add",u.add_slide,"openImageSelector"),this.createControl("crop",u.edit_img,"imageEditMask"),this.createLinkControl(),this.createControl("remove",u.remove_slide,"onRemoveSlide"),t,this.createPaddingControl(),this.createControl("settings",u.settings,"on_settings_click")]);return multiControls||(r=_(r.without(t))),r}}),h=Upfront.Views.Editor.Sidebar.Element.extend({priority:40,draggable:!0,render:function(){this.$el.addClass("upfront-icon-element upfront-icon-element-slider"),this.$el.html(u.element_name)},add_element:function(){var e=new l,t=new Upfront.Models.Module({name:"",properties:[{name:"element_id",value:Upfront.Util.get_unique_id("module")},{name:"class",value:"c10 upfront-slider_module"},{name:"has_settings",value:0},{name:"row",value:Upfront.Util.height_to_row(255)}],objects:[e]});this.add_module(t)}});Upfront.Application.LayoutEditor.add_object("USlider",{Model:l,View:c,Element:h,Settings:r,cssSelectors:{".uslide-image img":{label:u.css.images_label,info:u.css.images_info},".uslide-image":{label:u.css.img_containers_label,info:u.css.img_containers_info},".uslide-caption":{label:u.css.captions_label,info:u.css.captions_info},".wp-caption":{label:u.css.caption_label,info:u.css.caption_info},".upfront-default-slider-nav":{label:u.css.dots_wrapper_label,info:u.css.dots_wrapper_info},".upfront-default-slider-nav-item":{label:u.css.dots_label,info:u.css.dots_info},".uslider-dotnav-current":{label:u.css.dot_current_label,info:u.css.dot_current_info},".upfront-default-slider-nav-prev":{label:u.css.prev_label,info:u.css.prev_info},".upfront-default-slider-nav-next":{label:u.css.next_label,info:u.css.next_info}},cssSelectorsId:Upfront.data.uslider.defaults.type}),Upfront.Models.USliderModel=l,Upfront.Views.USliderView=c})}(jQuery),define("text!elements/upfront-social-media/tpl/social-back.html",[],function(){return'<div>\n\n<script type="text/template" id="service-tpl">\n	<li class="upfront-field-multiple">\n		{[ if(expandable){ ]}\n			<i class="usocial-global-triangle"></i>\n		{[ } ]}\n		<i class="upfront-field-icon upfront-field-icon-social-sort"></i>\n		<input type="checkbox" id="service-{{service.id}}" name="" value="{{service.id}}" class="upfront-field-checkbox"{{service.active ? \' checked="checked"\' : \'\' }}>\n		<label for="service-{{service.id}}">\n			<span class="upfront-field-label-text">{{service.name}}</span>\n		</label>\n		{[ if(expandable){ ]}\n		<div class="upfront-field-wrap upfront-field-wrap-text" title="link address" style="display:none">\n			<input type="text" class="upfront-field upfront-field-text usocial_text usocial_url" id="service-url-{{service.id}}" name="{{service.id}}_url" value="{{service.url}}" placeholder="{{service.name}} url" data-field="url" data-service="{{service.id}}">\n			{[if(service.meta){_.each(service.meta, function(meta){ ]}\n			<input type="text" class="upfront-field upfront-field-text usocial_text usocial_{{meta.id}} usocial_service_meta" id="service-{{meta.id}}-{{service.id}}" name="{{meta.id}}" value="{{meta.value}}" placeholder="{{service.name}} {{meta.name}}" data-field="{{meta.id}}" data-service="{{service.id}}">\n			{[ });} ]}\n		</div>\n		{[ } ]}\n	</li>\n</script>\n\n<script type="text/template" id="add-service-tpl">\n	{[ if(services.length){ ]}\n	<div class="upfront-field-wrap upfront-field-wrap-select">\n		<label class="usocial-select-label">{{ l10n.add_new }}</label>\n		<div class="usocial-select upfront-field-select upfront-field-select-single usocial-select-closed" id="">\n			<ul class="usocial-select-list">\n				{[ _.each(services, function(service){  ]}\n				<li class="upfront-field-select-option">\n					<label for="service-{{service.id}}">\n						<span class="upfront-field-label-text">{{service.name}}</span>\n					</label>\n					<input type="radio" id="service-{{service.id}}" name="select" class="upfront-field-radio" value="{{service.id}}"{{services[0].name == service.name ? \' checked="checked"\' : \'\'}} >\n				</li>\n				{[ }) ]}\n			</ul>\n		</div>\n		<i class="upfront-field-icon upfront-field-icon-social-add usocial-add"></i>\n	</div>\n	{[ } ]}\n</script>\n\n<script type="text/template" id="global-tpl">\n	<div class="upfront-global-social-settings">\n		<div class="upfront-settings-item">\n      <div class="upfront-settings-item-title"><span>{{ l10n.set_accounts }}</span></div>\n			<div class="upfront-settings-item-content">\n				<ul class="upfront-field-wrap upfront-field-wrap-multiple upfront-field-wrap-checkboxes social_media_services_list ui-sortable">\n					{[ _.each(services, function(service){ ]}\n					<li class="upfront-field-multiple upfront-field-multiple-selected">\n						<i class="usocial-global-triangle"></i>\n						<i class="upfront-field-icon upfront-field-icon-social-sort"></i>\n						<input type="checkbox" id="social_global_{{service.id}}" name="services" value="{{service.id}}" class="upfront-field-checkbox" {{service.active ? \'checked="checked"\' : \'\'}}>\n						<label for="social_global_{{service.id}}">\n							<span class="upfront-field-label-text">{{service.name}}</span>\n						</label>\n						<div class="upfront-field-wrap upfront-field-wrap-text" title="link address" style="display:none">\n							<input type="text" class="upfront-field upfront-field-text" id="{{service.id}}-url" name="{{service.id}}-url" value="{{service.url}}" placeholder="{{service.name}} url">\n						</div>\n					</li>\n					{[ }) ]}\n				</ul>\n			</div>\n		</div>\n		<div class="upfront-settings-item">\n      <div class="upfront-settings-item-title"><span>{{ l10n.in_post }}</span></div>\n			<div class="upfront-settings-item-content">\n				<div class="upfront-field-wrap upfront-field-wrap-multiple upfront-field-wrap-checkboxes">\n					<span class="upfront-field-multiple upfront-field-multiple-selected">\n						<input type="checkbox" id="usocial-global-add_to_post" name="inpost" value="yes" class="upfront-field-checkbox" {{inpost.length ? \'checked="checked"\' : \'\'}}>\n						<label for="usocial-global-add_to_post">\n							<span class="upfront-field-label-text">{{ l10n.counter_to_all }}</span>\n						</label>\n					</span>\n				</div>\n			</div>\n			<div class="">\n				<label for="usocial-global_after_title" class="upfront-field-label upfront-field-label-block">{{ l10n.location }}</label>\n				<div class="usocial-global-add-post">\n					<div class="upfront-field-wrap upfront-field-wrap-multiple upfront-field-wrap-checkboxes">\n\n						<span class="upfront-field-multiple {{after_title.length ? \'upfront-field-multiple-selected\' : \'\' }}">\n							<input type="checkbox" id="usocial-global-after_title" name="after_title" value="yes" class="upfront-field-checkbox usocial_post_location" {{after_title.length ? \'checked="checked"\' : \'\'}}>\n							<label for="usocial-global-after_title">\n								<span class="upfront-field-label-text">{{ l10n.after_title }}</span>\n							</label>\n						</span>\n					</div>\n\n					<div class="upfront-field-wrap upfront-field-wrap-multiple upfront-field-wrap-radios">\n						<i class="usocial-align-icon upfront-field-icon upfront-field-icon-social-title-align"></i>\n						<div class="usocial-global-align {{after_title.length ? \'align-active\' : \'\'}}">\n							<span class="upfront-field-multiple upfront-field-multiple-horizontal-inline">\n								<input type="radio" id="usocial-global-align-0" name="after_title_align" value="left" class="upfront-field-radio" {{after_title_align == \'left\' ? \'checked="checked"\' : \'\'}} {{after_title.length ? \'\' : \'disabled="disabled"\'}}>\n							</span>\n							<span class="upfront-field-multiple upfront-field-multiple-horizontal-inline">\n								<input type="radio" id="usocial-global-align-1" name="after_title_align" value="center" class="upfront-field-radio" {{after_title_align == \'center\' ? \'checked="checked"\' : \'\'}} {{after_title.length ? \'\' : \'disabled="disabled"\'}}>\n							</span>\n							<span class="upfront-field-multiple upfront-field-multiple-horizontal-inline">\n								<input type="radio" id="usocial-global-align-2" name="after_title_align" value="right" class="upfront-field-radio" {{after_title_align == \'right\' ? \'checked="checked"\' : \'\'}} {{after_title.length ? \'\' : \'disabled="disabled"\'}}>\n							</span>\n						</div>\n						<label class="usocial-global-align-label" for="after_content_align">{{ l10n.aligned }} {{after_title_align}}</label>\n					</div>\n				</div>\n				<div class="usocial-global-add-post">\n					<div class="upfront-field-wrap upfront-field-wrap-multiple upfront-field-wrap-checkboxes">\n						<span class="upfront-field-multiple {{after_content.length ? \'upfront-field-multiple-selected\' : \'\' }}">\n							<input type="checkbox" id="usocial-global-after_content" name="after_content" value="yes" class="upfront-field-checkbox usocial_post_location" {{after_content.length ? \'checked="checked"\' : \'\'}}>\n							<label for="usocial-global-after_content">\n								<span class="upfront-field-label-text">{{ l10n.after_content }}</span>\n							</label>\n						</span>\n					</div>\n					<div class="upfront-field-wrap upfront-field-wrap-multiple upfront-field-wrap-radios">\n						<i class="usocial-align-icon upfront-field-icon upfront-field-icon-social-content-align"></i>\n						<div class="usocial-global-align {{after_content.length ? \'align-active\' : \'\'}}">\n							<span class="upfront-field-multiple upfront-field-multiple-horizontal-inline">\n								<input type="radio" id="usocial-global-align-0" name="after_content_align" value="left" class="upfront-field-radio" {{after_content_align == \'left\' ? \'checked="checked"\' : \'\'}} {{after_content.length ? \'\' : \'disabled="disabled"\'}}>\n							</span>\n							<span class="upfront-field-multiple upfront-field-multiple-horizontal-inline">\n								<input type="radio" id="usocial-global-align-1" name="after_content_align" value="center" class="upfront-field-radio" {{after_content_align == \'center\' ? \'checked="checked"\' : \'\'}} {{after_content.length ? \'\' : \'disabled="disabled"\'}}>\n							</span>\n							<span class="upfront-field-multiple upfront-field-multiple-horizontal-inline">\n								<input type="radio" id="usocial-global-align-2" name="after_content_align" value="right" class="upfront-field-radio" {{after_content_align == \'right\' ? \'checked="checked"\' : \'\'}} {{after_content.length ? \'\' : \'disabled="disabled"\'}}>\n							</span>\n						</div>\n						<label class="usocial-global-align-label" for="after_content_align">{{ l10n.aligned }} {{after_content_align}}</label>\n					</div>\n				</div>\n			</div>\n			<div class="upfront-field-wrap upfront-field-wrap-multiple upfront-field-wrap-radios">\n				<label for="usocial-global-counter_style" class="upfront-field-label upfront-field-label-block">{{ l10n.counter_style }}</label>\n				<span class="upfront-field-multiple upfront-field-multiple-horizontal-inline">\n					<input type="radio" id="usocial-global-counter_style-0" name="counter_style" value="horizontal" class="upfront-field-radio" {{counter_style == \'horizontal\' ? \'checked="checked"\' : \'\'}}>\n					<label for="usocial-global-counter_style-0">\n						<i class="upfront-field-icon upfront-field-icon-social-count-horizontal"></i>\n						<span class="upfront-field-label-text"></span>\n					</label>\n				</span>\n				<span class="upfront-field-multiple upfront-field-multiple-horizontal-inline upfront-field-multiple-selected">\n					<input type="radio" id="usocial-global-counter_style-1" name="counter_style" value="vertical" class="upfront-field-radio" {{counter_style == \'vertical\' ? \'checked="checked"\' : \'\'}}>\n					<label for="usocial-global-counter_style-1">\n						<i class="upfront-field-icon upfront-field-icon-social-count-vertical"></i>\n						<span class="upfront-field-label-text"></span>\n					</label>\n				</span>\n			</div>\n		</div>\n	</div>\n</script>\n\n<script type="text/template" id="fb_like-tpl">\n<div data-id="upfront-icon-facebook" class="upfront-social-icon upfront-social-icon-facebook">\n	<iframe class="social-frame usocial-fb {{style}} like" src="//www.facebook.com/plugins/like.php?href={{url}}&amp;send=false&amp;layout={{layout}}&amp;width={{width}}px&amp;show_faces=true&amp;font&amp;colorscheme=light&amp;action=like&amp;height={{height}}px" scrolling="no" frameborder="0" style="border:none; overflow:hidden;" allowTransparency="true"></iframe>\n</div>\n</script>\n<script type="text/template" id="tweet-tpl">\n<div data-id="upfront-icon-twitter" class="upfront-social-icon upfront-social-icon-twitter">\n	<iframe class="social-frame usocial-twitter {{style}} like" allowtransparency="true" frameborder="0" scrolling="no" src="//platform.twitter.com/widgets/tweet_button.html?text={{text}}&amp;url={{url}}&amp;original_referer={{url}}&amp;count={{style}}&amp;size=medium" style=""></iframe>\n</div>\n</script>\n<script type="text/template" id="plusone-tpl">\n<div data-id="upfront-icon-google" class="upfront-social-icon social-frame usocial-google {{style}} like upfront-social-icon-google">\n	<script type="text/javascript" src="//apis.google.com/js/plusone.js"></{{\'s\'}}cript>\n	<div class="g-plusone" data-size="{{size}}"></div>\n</div>\n</script>\n\n\n</div>\n'}),function(e){define("upfront-social_media",["text!elements/upfront-social-media/tpl/social-back.html"],function(t){var n=Upfront.Settings.l10n.social_element,r=Backbone.View.extend({popup:!1,deferred:!1,model:!1,tpl:_.template(e(t).find("#global-tpl").html()),events:{"click .use":"store","click li":"revealUrl","change input[name=services]":"toggleService","change .usocial_post_location":"changePostLocation","change input[name=after_title_align]":"changeAlign","change input[name=after_content_align]":"changeAlign"},popupFunc:function(){return this.open()},isOpen:function(){return e(".upfront-global-social-settings").length},open:function(){var t=this,r=!1;return console.log("Global social settings"),this.popup=Upfront.Popup.open(function(){}),this.deferred=e.Deferred(),this.setElement(e("#upfront-popup")),settings=_.clone(Upfront.data.usocial.globals?Upfront.data.usocial.globals:Upfront.data.usocial.global_defaults),settings.l10n=n.template,this.$("#upfront-popup-top").html('<ul class="upfront-tabs"><li class="active upfront-social-popup-hd">'+n.global_settings+"</li>"+"</ul>"),this.$("#upfront-popup-bottom").html('<div class="use_selection_container"><a href="#use" class="use">'+n.ok+"</a></div>"),this.$("#upfront-popup-content").html(this.tpl(settings)),this.setDraggableUp(),this.deferred.promise()},setDraggableUp:function(){this.$("ul").sortable({handle:".upfront-field-icon-social-sort"})},store:function(t){t.preventDefault();var r=this,i={inpost:this.$('input[name="inpost"]:checked').length?["yes"]:[],after_title:this.$('input[name="after_title"]:checked').length?["yes"]:[],after_title_align:this.$('input[name="after_title_align"]:checked').val(),after_content:this.$('input[name="after_content"]:checked').length?["yes"]:[],after_content_align:this.$('input[name="after_content_align"]:checked').val(),counter_style:this.$('input[name="counter_style"]:checked').val()},s=[],o=!1;this.$(".social_media_services_list").find("input[type=checkbox]").each(function(t,n){var i=e(n),o={id:i.val(),active:i.is(":checked"),meta:Upfront.data.usocial.global_defaults.services[i.val()].meta};o.name=Upfront.data.usocial.global_defaults.services[o.id].name,o.url=r.$('input[name="'+o.id+'-url"]').val(),s.push(o)}),i.services=s,o=this.arrayToProperties(i);var u=new Upfront.Views.Editor.Loading({loading:n.saving,fixed:!1});u.render(),this.$("#upfront-popup-content").css("position","relative").append(u.$el),Upfront.Util.post({action:"usocial_save_globals",data:JSON.stringify(o)}).success(function(e){u.cancel(),Upfront.Popup.close(),Upfront.Views.Editor.notify(n.updated),Upfront.data.usocial.globals=i,r.deferred.resolve(i)}).error(function(e){Upfront.Util.log("Error Saving settings")})},revealUrl:function(t){var n=e(t.target).hasClass("usocial-global-triangle")?e(t.target).closest("li"):e(t.target),r=n.parent().find(".open");r.removeClass("open").find(".upfront-field-wrap-text").slideUp("fast"),r[0]!=n[0]&&n.addClass("open").find(".upfront-field-wrap-text").slideDown("fast")},toggleService:function(t){t.preventDefault();var n=e(t.target),r=e(t.target).closest("li");input=r.find("input[type=text]"),n.is(":checked")&&!input.val()&&!input.is(":visible")&&(t.target=r[0],this.revealUrl(t),input.focus())},changePostLocation:function(t){var n=e(t.target),r=n.is(":checked"),i=n.closest(".usocial-global-add-post");r?(n.parent().addClass("upfront-field-multiple-selected"),i.find(".usocial-global-align").addClass("align-active").find("input[type=radio]").attr("disabled",!1)):(n.parent().removeClass("upfront-field-multiple-selected"),i.find(".usocial-global-align").removeClass("align-active").find("input[type=radio]").attr("disabled",!0))},changeAlign:function(t){var r=e(t.target),i=r.is(":checked");i&&r.closest(".upfront-field-wrap").find(".usocial-global-align-label").text(n.aligned+" "+r.val())},arrayToProperties:function(e){var t=[];return _.each(e,function(e,n){t.push({name:n,value:e})}),t}});Upfront.data.social.panel=new r;var i=Upfront.Models.ObjectModel.extend({init:function(){var e=_.clone(this.getDefaults());e.element_id=Upfront.Util.get_unique_id(e.id_slug+"-object"),this.init_properties(e)},getDefaults:function(){var e=Upfront.data.usocial.globals,t=Upfront.data.usocial.defaults,n=[],r=[],i={};if(!e)return t;_.each(e.services,function(e){n.push(e.id),e.active&&r.push(e.id),i[e.id]=e.url});var s=_.clone(e.services);return s.push({id:"linked-in",name:"Linked in",active:!1,url:"",meta:{}}),s.push({id:"pinterest",name:"Pinterest",active:!1,url:"",meta:{}}),s.push({id:"youtube",name:"Youtube",active:!1,url:"",meta:{}}),_.extend({},t,{services:e.services,button_services:s,counter_options:e.counter_style})}}),s=Upfront.Views.ObjectView.extend({settings:!1,counts:!1,initialize:function(){this.model instanceof i||(this.model=new i({properties:this.model.get("properties")})),Upfront.Views.ObjectView.prototype.initialize.call(this),Upfront.Events.on("entity:drag_stop",this.dragStop,this)},dragStop:function(e,t){var n=this;this.parent_module_view==e&&!Upfront.data.usocial.globals&&!Upfront.data.social.panel.isOpen()&&(Upfront.data.social.panel.open().done(function(e){var t=n.model.getDefaults();_.each(t,function(e,t){n.model.set_property(t,e,!0)}),n.model.trigger("change")}),console.log("No globals"))},property:function(e,t){return typeof t!="undefined"?this.model.set_property(e,t):this.model.get_property_value_by_name(e)},buttons:function(){var e=this.property("button_services"),t=this.property("button_style"),r=this.property("button_size"),i="";return e.length?(_.each(e,function(e){var n=e.url?"":'<span class="alert-url">!</span>';e.active&&(i+='<div class="upfront-'+e.id+"-link-box upfront-social-icon upfront-"+t+" usocial-button-"+r+'">'+'<a class="usocial-button '+e.id+'-link" href="'+e.url+'"></a>'+n+"</div>")}),i):'<span class="upfront-general-notice">'+n.add_some_services+"</span>"},fans:function(){var e=this,t=this.property("services"),r="",i=this.property("button_style"),s=this.property("button_size"),o={facebook:n.fans,twitter:n.followers,google:n.subscribers};return _(t).each(function(t){if(t.active){var n=t.url?"":'<span class="alert-url">!</span>',i=e.getCount(t);r+='<div data-id="upfront-icon-'+t.id+'" class="ufront-'+t.id+'-count-box upfront-social-icon usocial_count_wrapper">'+'<a class="upfront-fan-counts '+t.id+'-count" href="'+t.url+'">'+n+' <span class="upfront-fan-count"><strong class="usocial_count">'+i+"</strong> "+o[t.id]+"</span></a>"+"</div>"}}),r?(this.refreshCount(),r):'<span class="upfront-general-notice">'+n.add_some_services+"</span>"},getCount:function(e){var t=this,n=e.id,r=!1,i=!1,s=this.property("element_id");if(typeof usocial=="undefined"||!usocial.counts||!usocial.counts[s]||!usocial.counts[s][e.id])i=!0;return i?(this.counts?this.counts.done(function(e){var r=e.data[n];t.$el.find('div[data-id="upfront-icon-'+n+'"]').find("strong.usocial_count").html(r)}):this.refreshCount(),"Loading"):usocial.counts[s][e.id]},refreshCount:function(){var e=this;this.counts=Upfront.Util.post({action:"usocial_get_counts",element_id:this.property("element_id"),services:e.property("services")}).done(function(t){_.each(t.data,function(t,n){e.$el.find('div[data-id="upfront-icon-'+n+'"]').find("strong.usocial_count").html(t)})})},rawUrlEncode:function(e){return e=(e+"").toString(),encodeURIComponent(e).replace(/!/g,"%21").replace(/'/g,"%27").replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/\*/g,"%2A")},likes:function(){var r=this.property("counter_options"),i=this.property("services"),s=this,o="";if(i.length){var u=r=="horizontal",a={url:this.rawUrlEncode(location.href),style:r,width:u?90:70,height:u?20:60,size:u?"medium":"tall",layout:u?"button_count":"box_count",text:document.title?document.title:n.awesome_stuff,l10n:n.template},f={facebook:"fb_like-tpl",twitter:"tweet-tpl",google:"plusone-tpl"};_.each(i,function(n){if(n.active){var r=_.template(e(t).find("#"+f[n.id]).html());o+=r(a)}})}return o?o:'<span class="upfront-general-notice">'+n.select_some+"</span>"},get_content_markup:function(){if(!Upfront.data.usocial.globals)return'<span class="upfront-general-notice">'+n.no_global_settings_nag+"</span>";var e=this,t=this.property("social_type"),r="";switch(t){case"likes":r=e.likes();break;case"fans":r=e.fans();break;case"buttons":r=e.buttons()}return this.$el.html(r),r}}),o=Upfront.Views.Editor.Sidebar.Element.extend({priority:60,draggable:!1,render:function(){this.$el.addClass("upfront-icon-element upfront-icon-element-social"),this.$el.html(n.element_name)},add_element:function(){var e=new i,t=new Upfront.Models.Module({name:"",properties:[{name:"element_id",value:Upfront.Util.get_unique_id("module")},{name:"class",value:"c8 upfront-social-media_module"},{name:"has_settings",value:0},{name:"row",value:Upfront.Util.height_to_row(60)}],objects:[e]});this.add_module(t)}}),u=Upfront.Views.Editor.Settings.Item.extend({events:function(){return _.extend({},u.prototype.events,{"click .social-toggle":"social_toggle"})},social_toggle:function(){this.fields._wrapped[0].$el.toggle()},render:function(){this.$el.empty(),this.group?this.$el.append('<div class="upfront-settings-item"><div class="upfront-settings-item-title"><span>'+this.get_title()+"</span></div>"+'<div class="upfront-settings-item-content">'+'<span class="social-toggle">'+n.drag_reorder+"</span>"+'<span class="social-sort"></span>'+"</div>"+"</div>"):this.$el.append('<div class="upfront-settings-item-content"></div>');var e=this.$el.find(".upfront-settings-item-content");this.fields.each(function(t){t.render(),e.append(t.el)}),this.trigger("rendered")}}),a=Upfront.Views.Editor.Field.Field.extend({events:{"click a":"buttonClicked"},render:function(){this.$el.html(this.get_field_html())},get_field_html:function(){return'<i class="upfront-field-icon upfront-field-icon-social-back"></i><span class="upfront-back-global-settings-info">'+this.options.info+' <a href="#">'+this.options.label+"</a></span>"},buttonClicked:function(e){this.options.on_click&&this.options.on_click(e)},isProperty:!1}),f=Upfront.Views.Editor.Field.Field.extend({className:"",tpl:_.template(e(t).find("#service-tpl").html()),variableTpl:_.template(e(t).find("#add-service-tpl").html()),events:{"click .usocial-global-triangle":"toggleService","click .usocial-select":"showServiceList","blur .usocial-select":"hideServiceList","click .upfront-field-select-option":"selectService","click .usocial-add":"addService","change input[type=checkbox]":"changeService","blur input.usocial_text":"updateServiceMeta"},initialize:function(e){var t=this;t.options=e,f.__super__.initialize.apply(this,arguments),this.$el.on("click",function(e){t.hideServiceList(e)})},render:function(){var e=this,t=[],r=this.prop(this.options.prop);this.$el.html('<ul class="upfront-field-wrap upfront-field-wrap-multiple upfront-field-wrap-checkboxes social_media_services_list"></ul>'),_.each(r,function(r){(!e.options.variable||r.active)&&e.$("ul").append(e.tpl({service:r,expandable:e.options.expandable,meta:e.options.meta,l10n:n.template})),r.active||t.push(r)}),this.initSortable(),this.options.variable&&this.$el.append(this.variableTpl({services:t,l10n:n.template})),this.trigger("rendered")},toggleService:function(t){var n=e(t.target).siblings(".upfront-field-wrap-text");n.is(":visible")?n.slideUp("fast"):n.slideDown("fast")},showServiceList:function(t){console.log("Show"),t.preventDefault(),t.stopPropagation(),e(t.currentTarget).removeClass("usocial-select-closed").focus()},hideServiceList:function(e){this.$(".usocial-select").addClass("usocial-select-closed")},selectService:function(t){if(!this.$(".usocial-select").hasClass("usocial-select-closed")){t.preventDefault(),t.stopPropagation();var n=e(t.currentTarget).detach();this.$(".usocial-select-list").prepend(n),this.$(".usocial-select").addClass("usocial-select-closed")}},addService:function(t){t.preventDefault();var r=this.$(".usocial-select-list").find("input").first().val(),i=this.prop(this.options.prop),s={};_.each(i,function(e){e.id==r&&(e.active=!0,s=e)}),this.prop(this.options.prop,i,!0);var o=e(this.tpl({service:s,expandable:this.options.expandable,l10n:n.template})).hide().find(".upfront-field-wrap-text").show().end();this.$(".social_media_services_list").append(o),o.slideDown("fast").find("input[type=text]").focus(),this.$(".usocial-select-list").find("li").first().remove()},changeService:function(t){var n=e(t.target),r=n.val(),i=this.prop(this.options.prop);_.each(i,function(e){e.id==r&&(e.active=n.is(":checked"))}),this.prop(this.options.prop,i,!1);if(n.is(":checked")&&this.options.expandable){var s=n.parent().find("input[type=text]");s.val()||(n.siblings(".upfront-field-wrap-text").slideDown(),s.focus())}this.model.trigger("change")},initSortable:function(){var e=this;this.$("ul").sortable({start:function(e,t){},stop:function(e,t){},update:function(t,n){e.updateOrder()}})},updateOrder:function(){this.save(!0)},updateServiceMeta:function(t){var n=e(t.target),r=n.data("field"),i=n.val(),s=this.serv(n.data("service"));i||n.closest("li").find("input[type=checkbox]").attr("checked",!1);if(!s)return console.log("Unknown service couldn't be saved");if(r=="url")s.url=i;else{var o=s.meta;for(var u in o)o[u].id==r&&(o[u].value=i);s.meta=o}this.serv(n.data("service"),s,!1)},save:function(t){var n=this,r=this.prop(this.options.prop),i={},s=this.$(".ui-sortable").find("input[type=checkbox]"),o=[],u=[];_.each(r,function(e){i[e.id]=e}),typeof t=="undefined"&&(t=!1),s.each(function(r,s){var a=e(s),f=i[a.val()];if(f){if(!t){f.active=a.is(":checked");if(n.options.expandable){var l=a.closest("li");f.url=l.find("input[name="+f.id+"_url]").val(),f.meta.length&&_.each(f.meta,function(e){e.value=l.find("input[name="+e.id+"]").val()})}}u.push(f),o.push(f.id)}}),_.each(r,function(e){o.indexOf(e.id)==-1&&u.push(e)}),this.prop(this.options.prop,u,!1)},serv:function(e,t,n){var r=this.prop(this.options.prop);if(typeof t=="undefined"){for(var i in r)if(r[i].id==e)return r[i];return!1}var s=!1;for(var i in r)r[i].id==e&&(r[i]=t,s=!0);s||r.push(t),typeof n=="undefined"&&(n=!0),this.prop(this.options.prop,r,n)},prop:function(e,t,n){return typeof t!="undefined"?(typeof n=="undefined"&&(n=!0),this.model.set_property(e,t,n)):this.model.get_property_value_by_name(e)}}),l=Upfront.Views.Editor.Settings.Settings.extend({panel:!1,servicesItems:[],events:{"change input[type=radio]":"changeRadio"},initialize:function(e){this.options=e,this.panel=new Upfront.Views.Editor.Settings.Panel({model:this.model,label:n.opts.layout_label,title:n.opts.layout_title,tabbed:!0,settings:[new Upfront.Views.Editor.Settings.ItemTabbed({model:this.model,title:n.opts.action,radio:!0,icon:"social-like",property:"social_type",value:"likes",is_default:!0,settings:this.getLikesSettings()}),new Upfront.Views.Editor.Settings.ItemTabbed({model:this.model,title:n.opts.counts,radio:!0,icon:"social-count",property:"social_type",value:"fans",settings:this.getFansSettings()}),new Upfront.Views.Editor.Settings.ItemTabbed({model:this.model,title:n.opts.cta,radio:!0,icon:"social-button",property:"social_type",value:"buttons",settings:this.getButtonsSettings()})]}),this.panels=_([new Upfront.Views.Editor.Settings.Panel({model:this.model,label:n.opts.general_label,title:n.opts.general_title,settings:[]}),this.panel]),this.panel.on("upfront:settings:panel:saved",this.saveServices,this)},getLikesSettings:function(){var e=new f({model:this.model,prop:"services",expandable:!1});return this.servicesItems.push(e),[new Upfront.Views.Editor.Settings.Item({model:this.model,title:n.opts.counter,fields:[new Upfront.Views.Editor.Field.Radios({model:this.model,property:"counter_options",layout:"horizontal-inline",label:"",values:[{label:"",value:"horizontal",icon:"social-count-horizontal"},{label:"",value:"vertical",icon:"social-count-vertical"}]})]}),new u({className:"upfront-social-services-item",model:this.model,title:n.opts.services,fields:[e]}),this.getGlobalsButton()]},getFansSettings:function(){var e=new f({model:this.model,prop:"services",meta:!0,expandable:!0});return this.servicesItems.push(e),[new u({className:"upfront-social-services-item",model:this.model,title:n.opts.services,fields:[e]}),this.getGlobalsButton()]},getButtonsSettings:function(){var e=new f({model:this.model,prop:"button_services",expandable:!0,variable:!0});return this.servicesItems.push(e),[new Upfront.Views.Editor.Settings.Item({model:this.model,title:n.opts.button_size,fields:[new Upfront.Views.Editor.Field.Radios({model:this.model,property:"button_size",layout:"vertical",label:"",values:[{label:n.opts.small,value:"small"},{label:n.opts.medium,value:"medium"},{label:n.opts.large,value:"large"}]})]}),new Upfront.Views.Editor.Settings.Item({model:this.model,title:n.opts.button_style,fields:[new Upfront.Views.Editor.Field.Radios({model:this.model,property:"button_style",layout:"horizontal-inline",label:"",values:[{label:"",value:"button-style-1",icon:"social-button-style-1"},{label:"",value:"button-style-2",icon:"social-button-style-2"},{label:"",value:"button-style-3",icon:"social-button-style-3"}]})]}),new u({className:"upfront-social-services-item",model:this.model,title:n.opts.services,fields:[e]}),this.getGlobalsButton()]},getGlobalsButton:function(){return new Upfront.Views.Editor.Settings.Item({className:"upfront-social-back",group:!1,fields:[new a({model:this.model,info:n.opts.back_to,label:n.global_settings,on_click:function(e){e.preventDefault(),Upfront.Events.trigger("entity:settings:deactivate"),Upfront.data.social.panel.popupFunc()}})]})},changeRadio:function(t){var n=e(t.target),r=n.attr("name"),i=this.$el.find("input[name="+r+"]:checked").val();this.model.set_property(r,i)},get_title:function(){return n.opts.social_settings},render:function(){var e=this;Upfront.data.usocial.globals?this.constructor.__super__.render.call(this):Upfront.data.social.panel.open().done(function(t){_.each(t,function(t,n){e.model.set_property(n,t,!0)}),e.model.trigger("change")})},saveServices:function(){console.log("Saving services"),_.each(this.servicesItems,function(e){e.$el.is(":visible")&&e.save()}),this.model.trigger("change")}});Upfront.Models.SocialMediaModel=i,Upfront.Views.SocialMediaView=s})}(jQuery),define("elements/upfront-tabs/js/model",[],function(){var e=Upfront.Models.ObjectModel.extend({init:function(){var e=_.clone(Upfront.data.utabs.defaults),t=Upfront.data.utabs.defaults;e.tabs=[],e.tabs[0]={},e.tabs[0].content=_.clone(t.tabs[0].content),e.tabs[0].title=_.clone(t.tabs[0].title),e.tabs[1]={},e.tabs[1].content=_.clone(t.tabs[1].content),e.tabs[1].title=_.clone(t.tabs[1].title),e.element_id=Upfront.Util.get_unique_id("utabs-object"),this.init_properties(e)}});return e}),define("elements/upfront-tabs/js/element",["elements/upfront-tabs/js/model"],function(e){var t=Upfront.Settings.l10n.utabs_element,n=Upfront.Views.Editor.Sidebar.Element.extend({priority:130,render:function(){this.$el.addClass("upfront-icon-element upfront-icon-element-tabs"),this.$el.html(t.element_name)},add_element:function(){var t=new e,n=new Upfront.Models.Module({name:"",properties:[{name:"element_id",value:Upfront.Util.get_unique_id("module")},{name:"class",value:"c9 upfront-tabs_module"},{name:"has_settings",value:0},{name:"row",value:Upfront.Util.height_to_row(225)}],objects:[t]});this.add_module(n)}});return n}),define("text!elements/upfront-tabs/tpl/preset-style.html",[],function(){return"#page .upfront-tabs-container.tab-preset-<?php echo $properties['id']  ?> .tabs-tab:hover,\n#page .upfront-tabs-container.tab-preset-<?php echo $properties['id']  ?> .tabs-tab:hover .inner-box,\n#page .upfront-tabs-container.tab-preset-<?php echo $properties['id']  ?> .tabs-tab:hover .inner-box p,\n#page .upfront-tabs.<?php echo $properties['id']  ?>.live-preview-hover .tabs-tab,\n#page .upfront-tabs.<?php echo $properties['id']  ?>.live-preview-hover .tabs-tab .inner-box,\n#page .upfront-tabs.<?php echo $properties['id']  ?>.live-preview-hover .tabs-tab .inner-box p\n{\n	<?php if(!empty($properties['hover-use-color'])) { ?>\n		<?php if(!empty($properties['hover-tab-bg'])) { ?>background: <?php echo $properties['hover-tab-bg'] ?>; <?php } ?>\n	<?php } ?>\n	<?php if(!empty($properties['hover-use-typography'])) { ?>\n		<?php if(!empty($properties['hover-font-color'])) { ?>color: <?php echo $properties['hover-font-color']  ?>; <?php } ?>\n		<?php if(!empty($properties['hover-font-family'])) { ?>font-family: <?php echo $properties['hover-font-family']  ?>; <?php } ?>\n		<?php if(!empty($properties['hover-font-size'])) { ?>font-size: <?php echo $properties['hover-font-size']  ?>px; <?php } ?>\n		<?php if(!empty($properties['hover-weight'])) { ?>font-weight: <?php echo $properties['hover-weight']  ?>;<?php } ?>\n		<?php if(!empty($properties['hover-style'])) { ?>font-style: <?php echo $properties['hover-style']  ?>;<?php } ?>\n		<?php if(!empty($properties['hover-line-height'])) { ?>line-height: <?php echo $properties['hover-line-height']  ?>;<?php } ?>\n	<?php } else { ?>\n		<?php if(!empty($properties['static-font-color'])) { ?>color: <?php echo $properties['static-font-color']  ?>; <?php } ?>\n		<?php if(!empty($properties['static-font-family'])) { ?>font-family: <?php echo $properties['static-font-family']  ?>; <?php } ?>\n		<?php if(!empty($properties['static-font-size'])) { ?>font-size: <?php echo $properties['static-font-size']  ?>px; <?php } ?>\n		<?php if(!empty($properties['static-weight'])) { ?>font-weight: <?php echo $properties['static-weight']  ?>;<?php } ?>\n		<?php if(!empty($properties['static-style'])) { ?>font-style: <?php echo $properties['static-style']  ?>;<?php } ?>\n		<?php if(!empty($properties['static-line-height'])) { ?>line-height: <?php echo $properties['static-line-height']  ?>;<?php } ?>\n	<?php } ?>\n}\n#page .upfront-tabs-container.tab-preset-<?php echo $properties['id']  ?> .tabs-tab:hover,\n#page .upfront-tabs.<?php echo $properties['id']  ?>.live-preview-hover .tabs-tab {\n	<?php if(!empty($properties['hover-useborder'])) { ?>\n        <?php if(!empty($properties['hover-borderwidth']) && !empty($properties['hover-bordertype']) && !empty($properties['hover-bordercolor'])) { ?>border: <?php echo $properties['hover-borderwidth'] ?>px <?php echo $properties['hover-bordertype'] ?> <?php echo $properties['hover-bordercolor'] ?>;<?php } ?>\n    <?php } else { ?>\n        border: none;\n    <?php } ?>\n}\n#page .upfront-tabs-container.tab-preset-<?php echo $properties['id']  ?> .tabs-tab.tabs-tab-active,\n#page .upfront-tabs-container.tab-preset-<?php echo $properties['id']  ?> .tabs-tab.tabs-tab-active .inner-box,\n#page .upfront-tabs-container.tab-preset-<?php echo $properties['id']  ?> .tabs-tab.tabs-tab-active .inner-box p,\n#page .upfront-tabs.<?php echo $properties['id']  ?>.live-preview-active .tabs-tab,\n#page .upfront-tabs.<?php echo $properties['id']  ?>.live-preview-active .tabs-tab .inner-box,\n#page .upfront-tabs.<?php echo $properties['id']  ?>.live-preview-active .tabs-tab .inner-box p {\n	<?php if(!empty($properties['active-use-color'])) { ?>\n		<?php if(!empty($properties['active-tab-bg'])) { ?>background: <?php echo $properties['active-tab-bg'] ?>; <?php } ?>\n	<?php } ?>\n	<?php if(!empty($properties['active-use-typography'])) { ?>\n		<?php if(!empty($properties['active-font-color'])) { ?>color: <?php echo $properties['active-font-color']  ?>; <?php } ?>\n		<?php if(!empty($properties['active-font-family'])) { ?>font-family: <?php echo $properties['active-font-family']  ?>; <?php } ?>\n		<?php if(!empty($properties['active-font-size'])) { ?>font-size: <?php echo $properties['active-font-size']  ?>px; <?php } ?>\n		<?php if(!empty($properties['active-weight'])) { ?>font-weight: <?php echo $properties['active-weight']  ?>;<?php } ?>\n		<?php if(!empty($properties['active-style'])) { ?>font-style: <?php echo $properties['active-style']  ?>;<?php } ?>\n		<?php if(!empty($properties['active-line-height'])) { ?>line-height: <?php echo $properties['active-line-height']  ?>;<?php } ?>\n	<?php } else { ?>\n		<?php if(!empty($properties['static-font-color'])) { ?>color: <?php echo $properties['static-font-color']  ?>; <?php } ?>\n		<?php if(!empty($properties['static-font-family'])) { ?>font-family: <?php echo $properties['static-font-family']  ?>; <?php } ?>\n		<?php if(!empty($properties['static-font-size'])) { ?>font-size: <?php echo $properties['static-font-size']  ?>px; <?php } ?>\n		<?php if(!empty($properties['static-weight'])) { ?>font-weight: <?php echo $properties['static-weight']  ?>;<?php } ?>\n		<?php if(!empty($properties['static-style'])) { ?>font-style: <?php echo $properties['static-style']  ?>;<?php } ?>\n		<?php if(!empty($properties['static-line-height'])) { ?>line-height: <?php echo $properties['static-line-height']  ?>;<?php } ?>\n	<?php } ?>\n	transition: none;\n}\n#page .upfront-tabs-container.tab-preset-<?php echo $properties['id']  ?> .tabs-tab.tabs-tab-active,\n#page .upfront-tabs.<?php echo $properties['id']  ?>.live-preview-active .tabs-tab {\n	<?php if(!empty($properties['active-useborder'])) { ?>\n        <?php if(!empty($properties['active-borderwidth']) && !empty($properties['active-bordertype']) && !empty($properties['active-bordercolor'])) { ?>border: <?php echo $properties['active-borderwidth'] ?>px <?php echo $properties['active-bordertype'] ?> <?php echo $properties['active-bordercolor'] ?>;<?php } ?>\n    <?php } else { ?>\n        border: none;\n    <?php } ?>\n}\n#page .upfront-tabs-container.tab-preset-<?php echo $properties['id']  ?> .tabs-tab, #page .upfront-tabs-container.tab-preset-<?php echo $properties['id']  ?> .tabs-tab .inner-box,\n#page .upfront-tabs-container.tab-preset-<?php echo $properties['id']  ?> .tabs-tab, #page .upfront-tabs-container.tab-preset-<?php echo $properties['id']  ?> .tabs-tab .inner-box p{\n	<?php if(!empty($properties['static-tab-bg'])) { ?>background: <?php echo $properties['static-tab-bg'] ?>; <?php } ?>\n	<?php if(!empty($properties['static-font-color'])) { ?>color: <?php echo $properties['static-font-color']  ?>; <?php } ?>\n	<?php if(!empty($properties['static-font-family'])) { ?>font-family: <?php echo $properties['static-font-family']  ?>; <?php } ?>\n	<?php if(!empty($properties['static-font-size'])) { ?>font-size: <?php echo $properties['static-font-size']  ?>px; <?php } ?>\n	<?php if(!empty($properties['static-weight'])) { ?>font-weight: <?php echo $properties['static-weight']  ?>;<?php } ?>\n	<?php if(!empty($properties['static-style'])) { ?>font-style: <?php echo $properties['static-style']  ?>;<?php } ?>\n	<?php if(!empty($properties['static-line-height'])) { ?>line-height: <?php echo $properties['static-line-height']  ?>;<?php } ?>\n	<?php if(!empty($properties['hover-use-transition'])) { ?>\n		transition: all <?php echo $properties['hover-transition-duration']  ?>s <?php echo $properties['hover-transition-easing']  ?>;\n	<?php } else { ?>\n		transition: none;\n	<?php } ?>\n}\n#page .upfront-tabs-container.tab-preset-<?php echo $properties['id']  ?> .tabs-tab{\n	<?php if(!empty($properties['static-useborder'])) { ?>\n        <?php if(!empty($properties['static-borderwidth']) && !empty($properties['static-bordertype']) && !empty($properties['static-bordercolor'])) { ?>border: <?php echo $properties['static-borderwidth'] ?>px <?php echo $properties['static-bordertype'] ?> <?php echo $properties['static-bordercolor'] ?>;<?php } ?>\n    <?php } else { ?>\n        border: none;\n    <?php } ?>\n}\n\n.tab-preset-<?php echo $properties['id']  ?> .utabs-content {\n	<?php if(!empty($properties['global-content-bg'])) { ?>background: <?php echo $properties['global-content-bg'] ?>; <?php } ?>\n	<?php if(!empty($properties['global-useborder'])) { ?>\n        <?php if(!empty($properties['global-borderwidth']) && !empty($properties['global-bordertype']) && !empty($properties['global-bordercolor'])) { ?>border: <?php echo $properties['global-borderwidth'] ?>px <?php echo $properties['global-bordertype'] ?> <?php echo $properties['global-bordercolor'] ?>;<?php } ?>\n    <?php } else { ?>\n        border: none;\n    <?php } ?>\n}\n\n<?php if(!empty($properties['preset_style'])) { ?><?php echo $properties['preset_style'] ?><?php } ?>\n"}),define("elements/upfront-tabs/js/settings",["scripts/upfront/element-settings/settings","scripts/upfront/preset-settings/util","text!elements/upfront-tabs/tpl/preset-style.html"],function(e,t,n){var r=Upfront.Settings.l10n.utabs_element,i=e.extend({panels:{Appearance:{mainDataCollection:"tabPresets",styleElementPrefix:"tab-preset",ajaxActionSlug:"tab",panelTitle:r.settings,presetDefaults:Upfront.mainData.presetDefaults.tab,styleTpl:n,stateModules:{Global:[{moduleType:"Colors",options:{title:r.content_area_colors_label,multiple:!1,single:!0,abccolors:[{name:"global-content-bg",label:r.content_area_bg_label}]}},{moduleType:"Border",options:{state:"static",title:"",fields:{use:"global-useborder",width:"global-borderwidth",type:"global-bordertype",color:"global-bordercolor"}}}],Static:[{moduleType:"Colors",options:{title:r.colors_label,multiple:!1,single:!0,abccolors:[{name:"static-tab-bg",label:r.tab_bg_label}]}},{moduleType:"Typography",options:{title:r.tab_typography_label,state:"static",toggle:!1,fields:{typeface:"static-font-family",fontstyle:"static-font-style",weight:"static-weight",style:"static-style",size:"static-font-size",line_height:"static-line-height",color:"static-font-color"}}},{moduleType:"Border",options:{state:"static",title:"",fields:{use:"static-useborder",width:"static-borderwidth",type:"static-bordertype",color:"static-bordercolor"}}}],Hover:[{moduleType:"Colors",options:{title:r.colors_label,multiple:!1,single:!0,toggle:!0,prepend:"hover-",prefix:"static",fields:{use:"hover-use-color"},abccolors:[{name:"hover-tab-bg",label:r.tab_bg_label}]}},{moduleType:"Typography",options:{title:r.tab_typography_label,state:"hover",toggle:!0,prepend:"hover-",prefix:"static",fields:{use:"hover-use-typography",typeface:"hover-font-family",fontstyle:"hover-font-style",weight:"hover-weight",style:"hover-style",size:"hover-font-size",line_height:"hover-line-height",color:"hover-font-color"}}},{moduleType:"Border",options:{state:"hover",title:"",prepend:"hover-",prefix:"static",fields:{use:"hover-useborder",width:"hover-borderwidth",type:"hover-bordertype",color:"hover-bordercolor"}}},{moduleType:"HovAnimation",options:{state:"hover",title:"",toggle:!0,fields:{use:"hover-use-transition",duration:"hover-transition-duration",easing:"hover-transition-easing"}}}],Active:[{moduleType:"Colors",options:{title:r.colors_label,multiple:!1,single:!0,toggle:!0,prepend:"active-",prefix:"static",fields:{use:"active-use-color"},abccolors:[{name:"active-tab-bg",label:r.tab_bg_label}]}},{moduleType:"Typography",options:{title:r.tab_typography_label,state:"active",toggle:!0,prepend:"active-",prefix:"static",fields:{use:"active-use-typography",typeface:"active-font-family",fontstyle:"active-font-style",weight:"active-weight",style:"active-style",size:"active-font-size",line_height:"active-line-height",color:"active-font-color"}}},{moduleType:"Border",options:{state:"active",title:"",prepend:"active-",prefix:"static",fields:{use:"active-useborder",width:"active-borderwidth",type:"active-bordertype",color:"active-bordercolor"}}}]},migrateElementStyle:function(e,t){return e=e.replace(/\.upfront-tabs-container/g,".tabs-wrapper"),e},migrateDefaultStyle:function(e){return e=e.replace(/(div)?\.upfront-tabs\s/g,""),e=e.replace(/(div)?\.upfront-object\s/g,""),e},migratePresetProperties:function(e){var t=this.property("preset")?this.clear_preset_name(this.property("preset")):"default",n=this.presets.findWhere({id:t}),r={};typeof n!="undefined"&&_.each(n.attributes,function(e,t){if(t==="id"||t==="name"||t==="preset_style"||t==="legacy")return;r[t]=e}),e.set(r),e.set({"active-tab-bg":"rgba(255,255,255, 0)","static-tab-bg":"rgba(255,255,255, 0)","hover-tab-bg":"rgba(255,255,255, 0)","static-useborder":"","hover-useborder":"","active-useborder":"","global-content-bg":"rgba(255,255,255, 0)","global-useborder":""})}}},title:r.settings});return t.generatePresetsToPage("tab",n),i}),define("text!elements/upfront-tabs/tpl/utabs.html",[],function(){return'<div class="upfront-tabs-container tab-preset-<?php echo $preset ?>">\r\n  <div class="tabs-wrapper">\r\n    <div class="tabs-menu-wrapper">\r\n      <div class="tabs-menu">\r\n        <?php for ($i = 0; $i < $tabs_count; $i++) { ?>\r\n        <div class="tabs-tab  <?php if($i === 0) { ?>tabs-tab-active<?php } ?>" data-content-id="<?php echo $element_id ?>-<?php echo $i ?>">\r\n          <div class="inner-box">\r\n            <?php echo $tabs[$i][\'title\'] ?>\r\n          </div>\r\n          <?php if (!empty($show_remove)) { ?>\r\n          <i></i>\r\n          <?php } ?>\r\n        </div>\r\n        <?php } ?>\r\n      </div>\r\n    </div>\r\n    <div class="utabs-content" >\r\n      <?php for ($i = 0; $i < $tabs_count; $i++) { ?>\r\n      <div id="<?php echo $element_id ?>-<?php echo $i ?>" class="utab-content <?php if($i === 0) { ?>utab-content-active<?php } ?>"><?php echo $tabs[$i][\'content\'] ?></div>\r\n      <?php } ?>\r\n    </div>\r\n  </div>\r\n</div>\r\n'}),function(e){define("utabs",["elements/upfront-tabs/js/model","elements/upfront-tabs/js/element","elements/upfront-tabs/js/settings","scripts/upfront/preset-settings/util","text!elements/upfront-tabs/tpl/utabs.html","text!elements/upfront-tabs/tpl/preset-style.html"],function(t,n,r,i,s,o){var u=Upfront.Settings.l10n.utabs_element;e("body").off("touchstart click",".tabs-tab");var a=Upfront.Views.ObjectView.extend({model:t,currentTabId:!1,tabsTpl:Upfront.Util.template(s),elementSize:{width:0,height:0},initialize:function(){this.model instanceof t||(this.model=new t({properties:this.model.get("properties")}));var e=this.property("tabs");_.each(e,function(t,n){t.title.trim()===""&&(e[n].title=u.tab_label+" "+(n+1))}),this.property("tabs",e),this.events=_.extend({},this.events,{"click .tabs-tab":"onTabClick","keydown .tabs-tab[contenteditable=true]":"onTabKeydown","click .utab-content-active":"onContentClick","click i":"deleteTab","dblclick .utab-content:not(.redactor-editor)":"startContentEditor"}),this.delegateEvents(),this.model.get("properties").bind("change",this.render,this),this.model.get("properties").bind("change",this.handle_visual_padding_hint,this),this.model.get("properties").bind("add",this.render,this),this.model.get("properties").bind("remove",this.render,this),this.listenTo(Upfront.Events,"theme_colors:update",this.update_colors,this)},update_colors:function(){var e=this,t=this.model.get_property_value_by_name("preset"),n=i.getPresetProperties("tab",t)||{};if(_.size(n)<=0)return!1;i.updatePresetStyle("tab",n,o)},onContentClick:function(){this.$el.find(".tabs-tab-active .inner-box").trigger("blur")},addTab:function(e){e.preventDefault(),this.property("tabs").push({title:u.tab_label+" "+(1+this.property("tabs_count")),content:u.content_label+" "+(1+this.property("tabs_count"))}),this.property("tabs_count",this.property("tabs").length,!1),this.render()},deleteTab:function(t){var n=e(t.currentTarget),r=n.parents(".tabs-tab"),i=e(r).data("content-id").split("-").pop();this.property("tabs").splice(i,1),this.property("tabs_count",this.property("tabs_count")-1,!1)},onTabClick:function(t){var n=e(t.currentTarget),r;this.$el.find(".utab-content").each(function(){var t=e(this).data("ueditor");t&&t.active&&t.stop()});if(n.hasClass("tabs-tab-active")){var i=n.find(".inner-box").data("ueditor");i&&!i.active&&i.start();return}this.$el.find(".tabs-tab .inner-box").each(function(){var t=e(this).data("ueditor");t&&t.active&&e(this).trigger("blur")}),n.siblings().removeClass("tabs-tab-active").end().addClass("tabs-tab-active"),e("#"+n.data("content-id")).siblings().removeClass("utab-content-active").end().addClass("utab-content-active")},saveTabContent:function(e){var t=e.attr("id").split("-").pop(),n=e.data("ueditor"),r="";try{r=n.getValue(!0)}catch(i){r=e.html()}this.currentTabId=e.attr("id"),this.property("tabs")[t].content=r,this.render()},stopEdit:function(t){var n=this.$el.find(".utab-content-active"),r=n.data("ueditor");r&&r.active&&r.stop();if(typeof t!="undefined"&&e(t.target).hasClass("inner-box"))return;var i=this.$el.find(".tabs-tab-active .inner-box:not(.ueditor-placeholder)");i.trigger("blur")},onTabKeydown:function(t){var n;t.keyCode===13&&(t.preventDefault(),e(t.currentTarget).removeAttr("contenteditable"),n=e(t.currentTarget).data("content-id").split("-").pop(),this.property("tabs")[n].title=e(t.currentTarget).text(),this.addTooltips(),e(t.currentTarget).find("i").size()<1&&e(t.currentTarget).append("<i></i>"))},get_content_markup:function(){var e=this.extract_properties();return e.show_add=!0,e.show_remove=this.property("tabs_count")>1?!0:!1,e.preset=e.preset||"default",this.tabsTpl(e)},extract_properties:function(){var e={};return this.model.get("properties").each(function(t){e[t.get("name")]=t.get("value")}),e},on_render:function(){_.delay(function(e){e.addTooltips()},10,this);var t=this,n=this.$el.find(".tabs-tab .inner-box"),r=0,i;n.each(function(){var n=e(this);r++,n.ueditor({linebreaks:!1,autostart:!1,paragraphize:!1,focus:!1,placeholder:!1}).on("start",function(){Upfront.Events.trigger("upfront:element:edit:start","text"),e(this).focus()}).on("stop",function(){var e=n.parent().parent().data("content-id").split("-").pop(),i=n.data("ueditor");i.getValue(!0).trim()===""?(t.property("tabs")[e].title=u.tab_label+" "+r,setTimeout(function(){n.text(u.tab_label+" "+r)},50)):t.property("tabs")[e].title=i.getValue(!0).trim(),Upfront.Events.trigger("upfront:element:edit:stop")})}),i=this.$el.find(".utab-content"),i.each(function(){t.initializeContentEditor(e(this))});var s=this.$el.find(".upfront-object-content");this.$el.find("div#"+this.currentTabId).addClass("utab-content-active").siblings().removeClass("utab-content-active"),this.$el.find(".tabs-tab").removeClass("tabs-tab-active"),this.$el.find('div.tabs-tab[data-content-id="'+this.$el.find("div.utab-content-active").attr("id")+'"]').addClass("tabs-tab-active")},startContentEditor:function(t){e(t.currentTarget).data("ueditor").start()},initializeContentEditor:function(e){var t=this;e.ueditor({linebreaks:!1,autostart:!1,paragraphize:!1,focus:!1,placeholder:!1}).on("start",function(){Upfront.Events.trigger("upfront:element:edit:start","text")}).on("stop",function(){t.stopContentEdit(e)})},stopContentEdit:function(e){e.text().trim()===""&&e.html(u.tab_placeholder),this.saveTabContent(e),Upfront.Events.trigger("upfront:element:edit:stop")},addTooltips:function(){e(".tabs-tab").each(function(){var t=e(this).find("span")[0];!_.isUndefined(t)&&t.offsetWidth<t.scrollWidth&&e(this).attr("title",e(t).text().trim())})},property:function(e,t,n){return typeof t!="undefined"?(typeof n=="undefined"&&(n=!0),this.model.set_property(e,t,n)):this.model.get_property_value_by_name(e)},getControlItems:function(){return _([this.createControl("add",u.add_tab,"addTab"),this.createPaddingControl(),this.createControl("settings",u.settings,"on_settings_click")])}});Upfront.Application.LayoutEditor.add_object("Utabs",{Model:t,View:a,Element:n,Settings:r,anchor:{is_target:!1},cssSelectors:{".upfront-tabs-container":{label:u.css.container_label,info:u.css.container_info},".upfront-tabs-container .tabs-menu-wrapper":{label:u.css.menu_label,info:u.css.menu_info},".upfront-tabs-container .tabs-tab .inner-box":{label:u.css.tabs_label,info:u.css.tabs_info},".upfront-tabs-container .tabs-tab-active .inner-box":{label:u.css.active_tab_label,info:u.css.active_tab_info},".upfront-tabs-container .utabs-content":{label:u.css.tab_content_label,info:u.css.tab_content_info},".upfront-tabs-container .utabs-content p":{label:u.css.tab_p_label,info:u.css.tab_p_info},".upfront-tabs-container .utab-content-active":{label:u.css.active_content_label,info:u.css.active_content_info},".upfront-tabs-container .utab-content-active p":{label:u.css.active_p_label,info:u.css.active_p_info}},cssSelectorsId:Upfront.data.utabs.defaults.type}),Upfront.Models.UtabsModel=t,Upfront.Views.UtabsView=a})}(jQuery),define("text!elements/upfront-this-post/tpl/preset-style.html",[],function(){return"<?php if(!empty($properties['preset_style'])) { ?><?php echo $properties['preset_style'] ?><?php } ?>\n"}),function(e){define("this_post",["scripts/upfront/element-settings/settings","scripts/upfront/element-settings/root-settings-panel","scripts/upfront/preset-settings/util","text!elements/upfront-this-post/tpl/preset-style.html"],function(t,n,r,i){var s=Upfront.Settings.l10n.this_post_element,o=Upfront.Models.ObjectModel.extend({init:function(){var e=_.clone(Upfront.data.thisPost.defaults);e.element_id=Upfront.Util.get_unique_id(e.id_slug+"-object"),this.init_properties(e)}}),u=Upfront.Views.ObjectView.extend({changed:!1,markup:!1,loading:!1,postId:!1,editor:!1,initialize:function(e){var t=this;this.model instanceof o||(this.model=new o({properties:this.model.get("properties")})),this.listenTo(this.model.get("properties"),"change",this.reset_markup),this.constructor.__super__.initialize.call(this,[e]),Upfront.Application.mode.current===Upfront.Application.MODE.THEME&&_.extend(this.events,{"click .upfront-post-layout-trigger":"editPostLayout"}),this.delegateEvents(),this.postId=_upfront_post_data.post_id?_upfront_post_data.post_id:Upfront.Settings.LayoutEditor.newpostType?0:!1,this.postId?(this.refreshMarkup().then(function(){t.postId&&t.prepareEditor()}),t.prepareEditor()):"themeExporter"in Upfront&&Upfront.Application.mode.current===Upfront.Application.MODE.THEME?(this.postId="fake_post",this.refreshMarkup(),t.prepareEditor()):"themeExporter"in Upfront&&Upfront.Application.mode.current===Upfront.Application.MODE.CONTENT_STYLE&&(this.postId="fake_styled_post",this.refreshMarkup(),t.prepareEditor()),this.listenToOnce(this,"rendered",function(){window.location.pathname.indexOf("/edit/")!==-1&&t.editor.loadingLayout.done(function(){setTimeout(function(){t.editor.editContents()},200)})}),Upfront.Events.trigger("post:initialized",this)},get_content_markup:function(){return this.markup?this.markup:(this.refreshMarkup(),"loading")},reset_markup:function(){var e=this,t=["hide_featured_image","full_featured_image"];if(!this.markup)return;_.find(t,function(t){var n=e.property(t),r=e._properties[t];return!n&&!r?!1:r!=n?(e.markup=!1,!0):!1}),this.markup===!1&&this.editor&&this.editor.fetchPostLayout()},prepareEditor:function(){var t=this.$(".upfront-object-content").children();t.length||(t=[e("<div>")]),this.editor?this.editor.setElement(t[0]):(this.editor=new Upfront.Content.PostEditorLegacy({editor_id:"this_post_"+this.postId,post_id:this.postId,preload:!0,node:t[0],content_mode:"post_content",view:this,layout:this.property("layout")}),this.editor.render())},on_render:function(){if(!this.editor)return;var e=this,t=this.$(".upfront-object-content").children();this.parent_module_view.model.get_property_value_by_name("sticky")&&(this.parent_module_view.model.set_property("sticky",!1),this.parent_module_view.$el.find("> .upfront-module > .upfront-entity_meta").prepend('<a href="#" class="upfront-icon-button upfront-icon-button-delete upfront-entity-delete_trigger"></a>')),t[0]&&t[0]!=this.editor.el&&(this.editor.setElement(t[0]),this.editor.render()),this.$el.find("> .upfront-object").css("min-height",""),this.parent_module_view.$el.find("> .upfront-module").css("min-height",""),this.add_region_class("upfront-region-container-has-this_post",!0),this.trigger("rendered")},get_extra_buttons:function(){return Upfront.Application.mode.current===Upfront.Application.MODE.THEME?'<a href="#" title="Edit post layout" class="upfront-icon-button upfront-icon-button-nav upfront-post-layout-trigger"></a>':""},on_edit:function(e){this.editor||this.prepareEditor()},editPostLayout:function(){this.markup=!1,Upfront.Events.trigger("post:layout:edit",this,"single")},editPostContent:function(){this.editor.editContents(),Upfront.Events.trigger("upfront:element:edit:start","write",this)},refreshMarkup:function(){var t=this;if(this.loadingMarkup)return this.loadingMarkup;if(this.postId===!1)return(new e.Deferred).resolve({data:{filtered:"Error"}});var n=e("#"+t.property("element_id")).find(".upfront-object-content"),r=n.length?new Upfront.Views.Editor.Loading({loading:s.refreshing,done:s.here_we_are,fixed:!1}):!1;return r&&(r.render(),n.append(r.$el)),this._properties={post_data:this.property("post_data"),element_id:this.property("element_id"),hide_featured_image:this.property("hide_featured_image"),full_featured_image:this.property("full_featured_image")},this.loadingMarkup=Upfront.Util.post({action:"this_post-get_markup",data:JSON.stringify({post_id:this.postId,post_type:Upfront.Settings.LayoutEditor.newpostType,properties:this._properties})}).success(function(n){r&&(r.done(),r=!1);var i=i||e("#"+t.property("element_id")).find(".upfront-object-content");t.markup=n.data.filtered,i.html(t.get_content_markup()),t.on_render(),t.loadingMarkup=!1}),this.loadingMarkup},redirectPostEdit:function(e){var t="/edit/"+e.get("post_type")+"/"+e.id;Upfront.Application.navigate(t,{trigger:!0}),Upfront.Settings.Application.MODE.ALLOW.indexOf(Upfront.Settings.Application.MODE.LAYOUT)!=-1&&Upfront.Application.set_current(Upfront.Settings.Application.MODE.LAYOUT)},createEditor:function(e){var t=this;if(this.editor)return;this.editor=new Upfront.Content.editor({editor_id:"this_post_"+this.postId,post_id:this.postId,preload:!0,node:e,content_mode:"post_content",view:t,autostart:this.autostart,onUpdated:function(e){t.autostart=!1,t.editor.autostart=!1,t.refreshMarkup(e),t.trigger("post:updated",e)}}),this.listenTo(this.editor,"editor:cancel",function(){t.editor.autostart=!1,t.editor.initEditAreas()})},on_element_edit_start:function(e,t){e=="write"&&this.parent_module_view&&(t.id!=this.postId?this.parent_module_view.disable_interaction(!1):this.parent_module_view.$el.find(".upfront-module").addClass("upfront-module-editing"))},on_element_edit_stop:function(e,t,n){this.parent_module_view&&n!==!0&&(this.parent_module_view.$el.find(".upfront-module").removeClass("upfront-module-editing"),this.parent_module_view.enable_interaction(!1))},property:function(e,t,n){return typeof t!="undefined"?(typeof n=="undefined"&&(n=!0),this.model.set_property(e,t,n)):this.model.get_property_value_by_name(e)},cleanup:function(){this.editor&&(this.editor.remove(),this.editor=!1),this.remove_region_class("upfront-region-container-has-this_post",!0)}}),a=Upfront.Views.Editor.Sidebar.Element.extend({draggable:!1,render:function(){this.$el.html(s.element_name)},add_element:function(){var e=new o,t=new Upfront.Models.Module({name:"",properties:[{name:"element_id",value:Upfront.Util.get_unique_id("module")},{name:"class",value:"c6 upfront-this_post_module"},{name:"has_settings",value:0},{name:"row",value:20}],objects:[e]});this.add_module(t)}}),f=Upfront.Views.Editor.Settings.Item.extend({initialize:function(e){this.options=e;var t=[{label:s.post_author,value:"author"},{label:s.post_date,value:"date"},{label:s.categories,value:"categories"},{label:s.tags,value:"tags"},{label:s.comments_count,value:"comments_count"},{label:s.featured_image,value:"featured_image"}];this.fields=_([new Upfront.Views.Editor.Field.Checkboxes({model:this.model,label:s.show_post_data,property:"post_data",values:t})])},get_title:function(){return s.post_data}}),l=n.extend({label:s.element_name,settings:[{type:"SettingsItem",title:s.featured_image_option,fields:[{type:"Checkboxes",property:"hide_featured_image",multiple:!1,values:[{label:s.hide_featured_image,value:"1"}],change:function(e,t){e==="1"?t.model.set_property("hide_featured_image",1):t.model.set_property("hide_featured_image",!1)}},{type:"Checkboxes",property:"full_featured_image",multiple:!1,values:[{label:s.full_featured_image,value:"1"}],change:function(e,t){e==="1"?t.model.set_property("full_featured_image",1):t.model.set_property("full_featured_image",!1)}}]}],title:s.post_settings}),c=t.extend({panels:{General:l,Appearance:{mainDataCollection:"thispostPresets",styleElementPrefix:"thispost-preset",ajaxActionSlug:"thispost",panelTitle:s.settings,presetDefaults:Upfront.mainData.presetDefaults.thispost,styleTpl:i}},initialize:function(e){location.pathname.indexOf("create_new")===-1&&(this.panels={General:l}),this.constructor.__super__.initialize.call(this,e)},title:s.post_settings});r.generatePresetsToPage("thispost",i),Upfront.Application.LayoutEditor.add_object("ThisPost",{Model:o,View:u,Element:a,Settings:c}),Upfront.Models.ThisPostModel=o,Upfront.Views.ThisPostView=u,Upfront.data.thisPost.PostDataPanel=l})}(jQuery),define("text!elements/upfront-post-data/tpl/views.html",[],function(){return'<div id="post-data">\r\n	<div class="post-data-wrapper">{{post_data}}</div>\r\n</div>\r\n\r\n<div id="loading">\r\n	<p class="loading">{{l10n.loading}}</p>\r\n</div>\r\n\r\n\r\n<div id="error">\r\n	<p class="error">{{l10n.error}}</p>\r\n</div>\r\n\r\n\r\n<div id="part-options-part_visible">\r\n	<div class="name_action_wrapper"></div>\r\n</div>\r\n<div id="part-options-part_label">\r\n	<span class="part_label"></span>\r\n</div>\r\n<div id="part-options-part_action">\r\n	<span class="part_action"><a href="#edit-options">{{l10n.edit}}</a></span>\r\n</div>\r\n<div id="part-options-part_wrapper">\r\n	<div class="options {{part.part}}-options">\r\n		<div class="option"></div>\r\n		<span class="edit_part"><a href="#edit-html">{{l10n.edit_html}}</a></span>\r\n	</div>\r\n</div>'}),function(e){define("elements/upfront-post-data/js/post-data-views",["text!elements/upfront-post-data/tpl/views.html"],function(t){var n=Upfront.Settings.l10n.post_data_element,r=e(t),i={get_preset_data:function(e,t){var n={};if(!e||!t)return n;var r=e+"_elementPresets",i=(Upfront.mainData||{})[r]||[];return _.findWhere(i,{id:t})||n}},s={DEFAULT:"post_data",_view:Backbone.View.extend({_do_cache:!0,render:function(e){var t=this,r=Upfront.Util.model_to_json(this.model),s=r.properties||{},o=r.objects||{},u=this.model.get_property_value_by_name("data_type"),a=this.model.get_property_value_by_name("preset"),f=i.get_preset_data(u,a),l={props:s,objects:o,preset_data:f,post_id:this.element.postId};this.element.authorId&&(l.author_id=this.element.authorId),this.element.postDate&&(l.post_date=this.element.postDate),this._post_data_load=Upfront.Util.post({action:"upfront_post-data-load",data:l}).success(function(r){r.data&&r.data.post_data?(t.render_object_view(r.data.post_data,e),t._do_cache&&(t._cached_data=r.data.post_data),t.$el.empty().removeClass("upfront_post-data-loading")):t.$el.empty().append(t.tpl.error({l10n:n})).removeClass("upfront_post-data-loading")}).error(function(){t.$el.empty().append(t.tpl.error({l10n:n})).removeClass("upfront_post-data-loading")}),this.$el.empty().append(this.tpl.load({l10n:n})).addClass("upfront_post-data-loading")},rerender:function(e){this._cached_data?this.render_object_view(this._cached_data,e):this.render()},render_object_view:function(e,t){_.isArray(t)||(t=[]);var n=this;this.model.get("objects").each(function(n){var r=Upfront.data.object_views[n.cid],i=n.get_property_value_by_name("part_type");if(t.length>0&&!_.contains(t,i))return;if(!r||!i||!e[i])return;r.render_view(e[i]),Upfront.Events.trigger("entity:object:refresh",r)})},tpl:{main:_.template(r.filter("#post-data").html()),error:_.template(r.filter("#error").html()),load:_.template(r.filter("#loading").html())}})};return s.post_data=s._view.extend({className:"upfront_post-data-view upfront_post-data-post_data"}),s.author=s._view.extend({className:"upfront_post-data-view upfront_post-data-author"}),s.taxonomy=s._view.extend({className:"upfront_post-data-view upfront_post-data-taxonomy"}),s.featured_image=s._view.extend({className:"upfront_post-data-view upfront_post-data-featured_image"}),s.comments=s._view.extend({className:"upfront_post-data-view upfront_post-data-comments"}),s.meta=s._view.extend({className:"upfront_post-data-view upfront_post-data-meta"}),s})}(jQuery),define("elements/upfront-post-data/js/panel-abstractions",["scripts/upfront/settings/modules/base-module","scripts/upfront/settings/field-factory","scripts/upfront/preset-settings/state-settings","scripts/redactor/ueditor-inserts","elements/upfront-posts/js/post-list-meta-views"],function(e,t,n,r,i){var s=Upfront.Settings.l10n.post_data_element,o=e.extend({className:function(){var t=(typeof this.initialize==typeof e.prototype.className?e.prototype.className():e.prototype.className||"").split(" ");return t.push("upfront-post_data-part"),t.push("part-module-panel"),t.join(" ")},map_panel_fields:function(){var e=this,n=this.get_fields(),r=new Upfront.Models.ObjectModel;return n.push({type:"Button",label:s.custom_markup,className:"edit_preset_label",compact:!0}),n.push({type:"Button",label:s.edit_template,className:"edit_post_markup edit_preset_css",compact:!0,on_click:function(){e.spawn_editor()}}),_(this.model.attributes).each(function(e,t){if("id"===t||"name"===t)return!0;r.set_property(t,e)}),_.map(n,function(n){var i=_.extend(n,{change:function(t){e.update_object(t,n.property)}});return t.createField(n.type,_.extend({model:r},_.omit(n,["type"])))})},get_fields:function(){return[]},get_object_model:function(){return this.model},update_object:function(e,t){_.isUndefined(e)&&(e=""),this.model.set(t,e),this.trigger("part:property:change",t,e)},render:function(){this.fields=_(this.map_panel_fields()),this.options.title=this.title,e.prototype.render.apply(this,arguments);var t=this.get_modules();this.state=new n({model:this.model,state:"static",modules:t}),this.state.render(),this.$el.append(this.state.$el),this.$el.find(".state_modules").append(this.$el.find(".edit_preset_css")),this.$el.addClass("preset_specific")},get_modules:function(){var e=this,t=function(t){return"static-"+e.data_part+"-"+t};return[{moduleType:"Typography",options:{toggle:!0,state:"static",fields:{use:t("use-typography"),typeface:t("font-family"),weight:t("weight"),fontstyle:t("fontstyle"),style:t("style"),size:t("font-size"),line_height:t("line-height"),color:t("font-color")}}}]},spawn_editor:function(){var e=this,t="post-part-"+this.data_part,n=this.model.get(t),s="meta"===this.options.part?i.Embed:r.inserts.embed,o=new s({data:{code:n},model:this.model}),u=!1,a=function(){if(u){var e=jQuery("#sidebar-ui").width()-1;u.$el.width(jQuery(window).width()-e).css("left",e)}};jQuery(window).on("resize",a),o.start().done(function(n,r){jQuery(window).off("resize",a),e.model.set(t,r)}),this.listenTo(o,"manager:rendered",function(e,t){u=e,a()})},get_name:function(){return!1},get_value:function(){return!1}}),u=o.extend({events:function(){return _.extend({},o.prototype.events,{"click .upfront-settings-item-title .toggle":"toggle_box"})},render:function(){var e=this,t={label:this.title,value:"1"},n=this.model.get("hidden_parts")||[],r=!0,i=!1;n.indexOf(e.data_part)<0&&(t.checked="checked",r=!1),i=new Upfront.Views.Editor.Field.Checkboxes({default_value:1,values:[t],change:function(t){var n=e.model.get("hidden_parts")||[],r=n.indexOf(e.data_part);t&&t.length&&r>=0?n.splice(r,1):r<0&&n.push(e.data_part),e.model.set("hidden_parts",n),t&&t.length?(e.$el.find(".upfront-settings-item-title").removeClass("inactive"),e.show_content()):(e.$el.find(".upfront-settings-item-title").addClass("inactive"),e.hide_content()),e.trigger("part:hide:toggle",e.data_part,t&&t.length&&r>=0)}}),i.render(),i.delegateEvents(),o.prototype.render.apply(this,arguments),this.$el.find(".upfront-settings-item-title").empty().append(i.$el).append('<a href="#toggle" class="toggle">&times;</a>'),r&&this.hide_content(),this.$el.find(".upfront-settings-item-title .toggle").css("background-image","url("+Upfront.Settings.root_url.replace(/\/$/,"")+"/img/uf-ui-sprite.svg)")},toggle_box:function(e){e&&e.preventDefault&&e.preventDefault(),e&&e.stopPropagation&&e.stopPropagation();var t=this.$el.find(".upfront-settings-item-content:first, .state_modules");return t.is(":visible")?this.hide_content():this.show_content(),!1},hide_content:function(){var e=this.$el.find(".upfront-settings-item-content:first, .state_modules");return e.hide()},show_content:function(){var e=this.$el.find(".upfront-settings-item-content:first, .state_modules");return e.show()}});return{Options:o,Toggleable:u}}),define("text!elements/upfront-post-data/tpl/preset-styles/post_data.html",[],function(){return"<?php if (!empty($properties['static-date_posted-use-typography'])) { ?>\r\n\r\n.<?php echo $properties['id'] ?> .upfront-post-data-part .date_posted {\r\n\r\n	<?php if (!empty($properties['static-date_posted-font-family'])) { ?>\r\n		font-family: <?php echo $properties['static-date_posted-font-family'] ?>;\r\n	<?php } ?>\r\n\r\n	<?php if (!empty($properties['static-date_posted-style'])) { ?>\r\n		font-style: <?php echo $properties['static-date_posted-style'] ?>;\r\n	<?php } ?>\r\n\r\n	<?php if (!empty($properties['static-date_posted-weight'])) { ?>\r\n		font-weight: <?php echo $properties['static-date_posted-weight'] ?>;\r\n	<?php } ?>\r\n\r\n	<?php if (!empty($properties['static-date_posted-font-size'])) { ?>\r\n		font-size: <?php echo $properties['static-date_posted-font-size'] ?>px;\r\n	<?php } ?>\r\n\r\n	<?php if (!empty($properties['static-date_posted-font-color'])) { ?>\r\n		color: <?php echo $properties['static-date_posted-font-color'] ?>;\r\n	<?php } ?>\r\n\r\n	<?php if (!empty($properties['static-date_posted-line-height'])) { ?>\r\n		line-height: <?php echo $properties['static-date_posted-line-height'] ?>;\r\n	<?php } ?>\r\n\r\n}\r\n\r\n<?php } ?>\r\n\r\n<?php if (!empty($properties['static-title-use-typography'])) { ?>\r\n\r\n.<?php echo $properties['id'] ?> .upfront-post-data-part .title * {\r\n\r\n	<?php if (!empty($properties['static-title-font-family'])) { ?>\r\n		font-family: <?php echo $properties['static-title-font-family'] ?>;\r\n	<?php } ?>\r\n\r\n	<?php if (!empty($properties['static-title-style'])) { ?>\r\n		font-style: <?php echo $properties['static-title-style'] ?>;\r\n	<?php } ?>\r\n\r\n	<?php if (!empty($properties['static-title-weight'])) { ?>\r\n		font-weight: <?php echo $properties['static-title-weight'] ?>;\r\n	<?php } ?>\r\n\r\n	<?php if (!empty($properties['static-title-font-size'])) { ?>\r\n		font-size: <?php echo $properties['static-title-font-size'] ?>px;\r\n	<?php } ?>\r\n\r\n	<?php if (!empty($properties['static-title-font-color'])) { ?>\r\n		color: <?php echo $properties['static-title-font-color'] ?>;\r\n	<?php } ?>\r\n\r\n	<?php if (!empty($properties['static-title-line-height'])) { ?>\r\n		line-height: <?php echo $properties['static-title-line-height'] ?>;\r\n	<?php } ?>\r\n\r\n}\r\n\r\n<?php } ?>\r\n\r\n\r\n<?php if(!empty($properties['preset_style'])) { ?><?php echo $properties['preset_style'] ?><?php } ?>\r\n"}),define("elements/upfront-post-data/js/modules-post_data",["elements/upfront-post-data/js/panel-abstractions","text!elements/upfront-post-data/tpl/preset-styles/post_data.html"],function(e,t){var n={};return n.template=t,n.part_date_posted=e.Toggleable.extend({title:"Date posted",data_part:"date_posted",get_fields:function(){return[{type:"Select",label:"Date Format",multiple:!1,property:"predefined_date_format",values:[{label:"WordPress date",value:"wp_date"},{label:"30 Jan 2015",value:"d M Y"},{label:"Jan 30 2015",value:"M d Y"},{label:"30 01 2015",value:"d m Y"},{label:"01 30 2015",value:"m d Y"},{label:"Custom PHP Format",value:"0"}],default_value:"wp_date"},{type:"Text",label:"PHP Format",className:"php_date_format",label_style:"inline",property:"date_posted_format"},{type:"Button",label:"Reference",className:"php_date_reference",compact:!0,on_click:function(e){e&&e.preventDefault&&e.preventDefault(),e&&e.stopPropagation&&e.stopPropagation();var t=window.open("https://codex.wordpress.org/Formatting_Date_and_Time","_blank");return t.focus(),!1}}]},render:function(){e.Toggleable.prototype.render.apply(this);if(!this._field_fmt_select||!this._field_fmt||!this._field_fmt_ref){var t=this.fields.toArray();this._field_fmt_select=t[0],this._field_fmt=t[1],this._field_fmt_ref=t[2],this._field_fmt_select&&this.listenTo(this._field_fmt_select,"changed",this.update_fields)}this.update_fields()},update_fields:function(){if(!this._field_fmt_select)return!1;var e=this._field_fmt_select.get_value();"0"!==e?(this._field_fmt.$el.hide(),this._field_fmt_ref.$el.hide()):(this._field_fmt.$el.show(),this._field_fmt_ref.$el.show())}}),n.part_title=e.Toggleable.extend({title:"Title",data_part:"title"}),n.part_content=e.Toggleable.extend({title:"Contents",data_part:"content",get_fields:function(){var e=Upfront.Settings.LayoutEditor.Grid.size||24,t=parseInt((e-1)/2);return[{type:"Number",label:"Left indent",label_style:"inline",min:0,max:t,default_value:0,className:"content-indent indent-left",property:"left_indent"},{type:"Number",label:"Right indent",label_style:"inline",min:0,max:t,default_value:0,className:"content-indent indent-right",property:"right_indent"},{type:"Checkboxes",property:"trigger_splitters",default_value:0,values:[{label:"Convert 3 Returns into Divider",value:"1"}]},{type:"Checkboxes",property:"allow_splitting",default_value:0,values:[{label:"Allow content splitting",value:"1"}]},{type:"Number",label:"Content part",default_value:0,min:0,label_style:"inline",property:"content_part"}]},render:function(){e.Toggleable.prototype.render.apply(this);if(!this._allow_splitting_field||!this._content_part_field){var t=this.fields.toArray();this._allow_splitting_field=t[3],this._content_part_field=t[4],this._allow_splitting_field&&this.listenTo(this._allow_splitting_field,"changed",this.update_fields)}this.update_fields();if(!(this._padding_fields||{}).left||!!(this._padding_fields||{}).right){var t=this.fields.toArray(),n={};n.left=t[0],n.right=t[1],this._padding_fields=n,(this._padding_fields||{}).left&&this.listenTo(this._padding_fields.left,"changed",this.normalize_left_padding),(this._padding_fields||{}).right&&this.listenTo(this._padding_fields.right,"changed",this.normalize_right_padding)}},update_fields:function(){if(!this._allow_splitting_field)return!1;var e=this._allow_splitting_field.get_value();e&&e.length?(Upfront.data.upfront_post_data.split_allowed=!0,this._content_part_field.$el.show()):this._content_part_field.$el.hide()},_normalize_padding:function(e,t){if(!(this._padding_fields||{})[e])return!1;t=parseInt(t,10)||-1;var n=this._padding_fields[e]||{},r=Upfront.Settings.LayoutEditor.Grid.size||24,i=parseInt((r-1)/2),s=n.options||{},o=parseInt(s.min,10)||0,u=parseInt(s.max,10)||i;return t<o&&(n.set_value(o),this.update_object(o,s.property)),t>u&&(n.set_value(u),this.update_object(u,s.property)),!0},normalize_left_padding:function(e){return this._normalize_padding("left",e)},normalize_right_padding:function(e){return this._normalize_padding("right",e)},get_modules:function(){return[]}}),n}),define("text!elements/upfront-post-data/tpl/preset-styles/author.html",[],function(){return"<?php if (!empty($properties['static-author-use-typography'])) { ?>\r\n\r\n.<?php echo $properties['id'] ?> .upfront-post-data-part .author, .<?php echo $properties['id'] ?> .upfront-post-data-part .author a {\r\n\r\n	<?php if (!empty($properties['static-author-font-family'])) { ?>\r\n		font-family: <?php echo $properties['static-author-font-family'] ?>;\r\n	<?php } ?>\r\n\r\n	<?php if (!empty($properties['static-author-style'])) { ?>\r\n		font-style: <?php echo $properties['static-author-style'] ?>;\r\n	<?php } ?>\r\n\r\n	<?php if (!empty($properties['static-author-weight'])) { ?>\r\n		font-weight: <?php echo $properties['static-author-weight'] ?>;\r\n	<?php } ?>\r\n\r\n	<?php if (!empty($properties['static-author-font-size'])) { ?>\r\n		font-size: <?php echo $properties['static-author-font-size'] ?>px;\r\n	<?php } ?>\r\n\r\n	<?php if (!empty($properties['static-author-font-color'])) { ?>\r\n		color: <?php echo $properties['static-author-font-color'] ?>;\r\n	<?php } ?>\r\n\r\n	<?php if (!empty($properties['static-author-line-height'])) { ?>\r\n		line-height: <?php echo $properties['static-author-line-height'] ?>;\r\n	<?php } ?>\r\n\r\n}\r\n\r\n<?php } ?>\r\n\r\n\r\n\r\n.<?php echo $properties['id'] ?> .upfront-post-data-part .gravatar img.avatar {\r\n\r\n	<?php if (!empty($properties['static-gravatar-use-border'])) { ?>\r\n\r\n		<?php if (!empty($properties['static-gravatar-border-width'])) { ?>\r\n			border-width: <?php echo $properties['static-gravatar-border-width'] ?>px;\r\n		<?php } ?>\r\n\r\n		<?php if (!empty($properties['static-gravatar-border-type'])) { ?>\r\n			border-style: <?php echo $properties['static-gravatar-border-type'] ?>;\r\n		<?php } ?>\r\n\r\n		<?php if (!empty($properties['static-gravatar-border-color'])) { ?>\r\n			border-color: <?php echo $properties['static-gravatar-border-color'] ?>;\r\n		<?php } ?>\r\n\r\n	<?php } ?>\r\n\r\n	<?php if (!empty($properties['static-gravatar-use-radius'])) { ?>\r\n\r\n		border-radius: <?php echo $properties['static-gravatar-radius1'] ? $properties['static-gravatar-radius1'] : 0 ?>px\r\n			<?php echo $properties['static-gravatar-radius2'] ? $properties['static-gravatar-radius2'] : 0 ?>px\r\n			<?php echo $properties['static-gravatar-radius3'] ? $properties['static-gravatar-radius3'] : 0 ?>px\r\n			<?php echo $properties['static-gravatar-radius4'] ? $properties['static-gravatar-radius4'] : 0 ?>px\r\n		;\r\n\r\n	<?php } ?>\r\n}\r\n\r\n\r\n<?php if (!empty($properties['static-author_email-use-typography'])) { ?>\r\n\r\n.<?php echo $properties['id'] ?> .upfront-post-data-part .author-email, .<?php echo $properties['id'] ?> .upfront-post-data-part .author-email a {\r\n\r\n	<?php if (!empty($properties['static-author_email-font-family'])) { ?>\r\n		font-family: <?php echo $properties['static-author_email-font-family'] ?>;\r\n	<?php } ?>\r\n\r\n	<?php if (!empty($properties['static-author_email-style'])) { ?>\r\n		font-style: <?php echo $properties['static-author_email-style'] ?>;\r\n	<?php } ?>\r\n\r\n	<?php if (!empty($properties['static-author_email-weight'])) { ?>\r\n		font-weight: <?php echo $properties['static-author_email-weight'] ?>;\r\n	<?php } ?>\r\n\r\n	<?php if (!empty($properties['static-author_email-font-size'])) { ?>\r\n		font-size: <?php echo $properties['static-author_email-font-size'] ?>px;\r\n	<?php } ?>\r\n\r\n	<?php if (!empty($properties['static-author_email-font-color'])) { ?>\r\n		color: <?php echo $properties['static-author_email-font-color'] ?>;\r\n	<?php } ?>\r\n\r\n	<?php if (!empty($properties['static-author_email-line-height'])) { ?>\r\n		line-height: <?php echo $properties['static-author_email-line-height'] ?>;\r\n	<?php } ?>\r\n\r\n}\r\n\r\n<?php } ?>\r\n\r\n\r\n<?php if (!empty($properties['static-author_url-use-typography'])) { ?>\r\n\r\n.<?php echo $properties['id'] ?> .upfront-post-data-part .author-url, .<?php echo $properties['id'] ?> .upfront-post-data-part .author-url a {\r\n\r\n	<?php if (!empty($properties['static-author_url-font-family'])) { ?>\r\n		font-family: <?php echo $properties['static-author_url-font-family'] ?>;\r\n	<?php } ?>\r\n\r\n	<?php if (!empty($properties['static-author_url-style'])) { ?>\r\n		font-style: <?php echo $properties['static-author_url-style'] ?>;\r\n	<?php } ?>\r\n\r\n	<?php if (!empty($properties['static-author_url-weight'])) { ?>\r\n		font-weight: <?php echo $properties['static-author_url-weight'] ?>;\r\n	<?php } ?>\r\n\r\n	<?php if (!empty($properties['static-author_url-font-size'])) { ?>\r\n		font-size: <?php echo $properties['static-author_url-font-size'] ?>px;\r\n	<?php } ?>\r\n\r\n	<?php if (!empty($properties['static-author_url-font-color'])) { ?>\r\n		color: <?php echo $properties['static-author_url-font-color'] ?>;\r\n	<?php } ?>\r\n\r\n	<?php if (!empty($properties['static-author_url-line-height'])) { ?>\r\n		line-height: <?php echo $properties['static-author_url-line-height'] ?>;\r\n	<?php } ?>\r\n\r\n}\r\n\r\n<?php } ?>\r\n\r\n\r\n<?php if (!empty($properties['static-author_bio-use-typography'])) { ?>\r\n\r\n.<?php echo $properties['id'] ?> .upfront-post-data-part .author-bio, .<?php echo $properties['id'] ?> .upfront-post-data-part .author-bio a {\r\n\r\n	<?php if (!empty($properties['static-author_bio-font-family'])) { ?>\r\n		font-family: <?php echo $properties['static-author_bio-font-family'] ?>;\r\n	<?php } ?>\r\n\r\n	<?php if (!empty($properties['static-author_bio-style'])) { ?>\r\n		font-style: <?php echo $properties['static-author_bio-style'] ?>;\r\n	<?php } ?>\r\n\r\n	<?php if (!empty($properties['static-author_bio-weight'])) { ?>\r\n		font-weight: <?php echo $properties['static-author_bio-weight'] ?>;\r\n	<?php } ?>\r\n\r\n	<?php if (!empty($properties['static-author_bio-font-size'])) { ?>\r\n		font-size: <?php echo $properties['static-author_bio-font-size'] ?>px;\r\n	<?php } ?>\r\n\r\n	<?php if (!empty($properties['static-author_bio-font-color'])) { ?>\r\n		color: <?php echo $properties['static-author_bio-font-color'] ?>;\r\n	<?php } ?>\r\n\r\n	<?php if (!empty($properties['static-author_bio-line-height'])) { ?>\r\n		line-height: <?php echo $properties['static-author_bio-line-height'] ?>;\r\n	<?php } ?>\r\n\r\n}\r\n\r\n<?php } ?>\r\n\r\n\r\n<?php if(!empty($properties['preset_style'])) { ?><?php echo $properties['preset_style'] ?><?php } ?>\r\n"}),define("elements/upfront-post-data/js/modules-author",["elements/upfront-post-data/js/panel-abstractions","text!elements/upfront-post-data/tpl/preset-styles/author.html"],function(e,t){var n={};return n.template=t,n.part_author=e.Toggleable.extend({title:"Author",data_part:"author",get_fields:function(){return[{type:"Select",label:"Display",label_style:"inline",property:"display_name",values:[{label:"Display Name",value:"display_name"},{label:"First &amp; Last Name",value:"first_last"},{label:"Last &amp; First Name",value:"last_first"},{label:"Nickname",value:"nickname"},{label:"Username",value:"username"}]},{type:"Select",label:"Link To",label_style:"inline",property:"link",values:[{label:"Website",value:"website"},{label:"Author page",value:"author"}]},{type:"Checkboxes",property:"target",values:[{label:"New Tab",value:"_blank"}]}]}}),n.part_author_email=e.Toggleable.extend({title:"Email",data_part:"author_email",get_fields:function(){return[{type:"Text",label:"Email Text Label",label_style:"inline",default_value:"Email",property:"email_link_text"}]}}),n.part_author_url=e.Toggleable.extend({title:"URL",data_part:"author_url",get_fields:function(){return[{type:"Text",label:"Link Text",label_style:"inline",default_value:"Website",property:"link_text"},{type:"Checkboxes",property:"target",values:[{label:"New Tab",value:"_blank"}]}]}}),n.part_author_bio=e.Toggleable.extend({title:"Biography",data_part:"author_bio"}),n.part_gravatar=e.Toggleable.extend({title:"Gravatar",data_part:"gravatar",get_fields:function(){return[{type:"Number",label:"Size in px",label_style:"inline",property:"gravatar_size"}]},get_modules:function(){var e=[],t=this,n=function(e){return"static-"+t.data_part+"-"+e};return e.push({moduleType:"Border",options:{toggle:!0,state:"static",fields:{use:n("use-border"),width:n("border-width"),type:n("border-type"),color:n("border-color")}}}),e.push({moduleType:"Radius",options:{toggle:!0,state:"static",fields:{use:n("use-radius"),lock:n("lock"),radius:n("radius"),radius_number:n("radius_number"),radius1:n("radius1"),radius2:n("radius2"),radius3:n("radius3"),radius4:n("radius4")}}}),e}}),n}),define("text!elements/upfront-post-data/tpl/preset-styles/featured_image.html",[],function(){return".<?php echo $properties['id'] ?> .upfront-post-data-part .thumbnail {\r\n\r\n	<?php if (!empty($properties['static-featured_image-use-border'])) { ?>\r\n\r\n		<?php if (!empty($properties['static-featured_image-border-width'])) { ?>\r\n			border-width: <?php echo $properties['static-featured_image-border-width'] ?>px;\r\n		<?php } ?>\r\n\r\n		<?php if (!empty($properties['static-featured_image-border-type'])) { ?>\r\n			border-style: <?php echo $properties['static-featured_image-border-type'] ?>;\r\n		<?php } ?>\r\n\r\n		<?php if (!empty($properties['static-featured_image-border-color'])) { ?>\r\n			border-color: <?php echo $properties['static-featured_image-border-color'] ?>;\r\n		<?php } ?>\r\n\r\n	<?php } ?>\r\n\r\n	<?php if (!empty($properties['static-featured_image-use-radius'])) { ?>\r\n\r\n		border-radius: <?php echo $properties['static-featured_image-radius1'] ? $properties['static-featured_image-radius1'] : 0 ?>px\r\n			<?php echo $properties['static-featured_image-radius2'] ? $properties['static-featured_image-radius2'] : 0 ?>px\r\n			<?php echo $properties['static-featured_image-radius3'] ? $properties['static-featured_image-radius3'] : 0 ?>px\r\n			<?php echo $properties['static-featured_image-radius4'] ? $properties['static-featured_image-radius4'] : 0 ?>px\r\n		;\r\n\r\n	<?php } ?>\r\n}\r\n\r\n<?php if(!empty($properties['preset_style'])) { ?><?php echo $properties['preset_style'] ?><?php } ?>\r\n"}),define("elements/upfront-post-data/js/modules-featured_image",["elements/upfront-post-data/js/panel-abstractions","text!elements/upfront-post-data/tpl/preset-styles/featured_image.html"],function(e,t){var n={};return n.template=t,n.part_featured_image=e.Toggleable.extend({title:"Feature Image",data_part:"featured_image",get_fields:function(){var e=this;return[{type:"Checkboxes",property:"resize_featured",multiple:!1,default_value:0,values:[{label:"Re-size to fit Container",value:"1"}]},{type:"Select",label:"If Post Has No Feat. Image",property:"fallback_option",default_value:"",values:[{label:"Hide",value:"hide"},{label:"Use color",value:"color"},{label:"Use default image",value:"image"}]},{type:"Color",property:"fallback_color",label:"Fallback Color"},{type:"Button",compact:!0,property:"fallback_image",label:"Choose",on_click:function(){console.log(this.model.get("fallback_image")),Upfront.Media.Manager.open({multiple_selection:!1,media_type:["images"]}).done(function(t,n){if(!n||!n.length)return!1;var r=n.models[0],i=r.get("image")?r.get("image"):n.models[0],s="src"in i?i.src:"get"in i?i.get("original_url"):!1;if(!s)return!1;e.model.set("fallback_image",s)})}}]},render:function(){e.Toggleable.prototype.render.apply(this,arguments);if(!this._fallback_selection_field||!this._fallback_color_field||!this._fallback_image_field){var t=this.fields.toArray();this._fallback_selection_field=t[1],this._fallback_color_field=t[2],this._fallback_image_field=t[3],this._fallback_selection_field&&this.listenTo(this._fallback_selection_field,"changed",this.update_fields)}this.update_fields()},update_fields:function(){if(!this._fallback_selection_field)return!1;var e=this._fallback_selection_field.get_value();"color"===e?(this._fallback_color_field.$el.show(),this._fallback_image_field.$el.hide()):"image"===e?(this._fallback_color_field.$el.hide(),this._fallback_image_field.$el.show()):(this._fallback_color_field.$el.hide(),this._fallback_image_field.$el.hide())},get_modules:function(){var e=[],t=this,n=function(e){return"static-"+t.data_part+"-"+e};return e.push({moduleType:"Border",options:{toggle:!0,state:"static",fields:{use:n("use-border"),width:n("border-width"),type:n("border-type"),color:n("border-color")}}}),e.push({moduleType:"Radius",options:{toggle:!0,state:"static",fields:{use:n("use-radius"),lock:n("lock"),radius:n("radius"),radius_number:n("radius_number"),radius1:n("radius1"),radius2:n("radius2"),radius3:n("radius3"),radius4:n("radius4")}}}),e}}),n}),define("text!elements/upfront-post-data/tpl/preset-styles/taxonomy.html",[],function(){return"<?php if (!empty($properties['static-categories-use-typography'])) { ?>\r\n\r\n.<?php echo $properties['id'] ?> .upfront-post-data-part .upostdata-part.post_categories, .<?php echo $properties['id'] ?> .upfront-post-data-part .upostdata-part.post_categories a {\r\n\r\n	<?php if (!empty($properties['static-categories-font-family'])) { ?>\r\n		font-family: <?php echo $properties['static-categories-font-family'] ?>;\r\n	<?php } ?>\r\n\r\n	<?php if (!empty($properties['static-categories-style'])) { ?>\r\n		font-style: <?php echo $properties['static-categories-style'] ?>;\r\n	<?php } ?>\r\n\r\n	<?php if (!empty($properties['static-categories-weight'])) { ?>\r\n		font-weight: <?php echo $properties['static-categories-weight'] ?>;\r\n	<?php } ?>\r\n\r\n	<?php if (!empty($properties['static-categories-font-size'])) { ?>\r\n		font-size: <?php echo $properties['static-categories-font-size'] ?>px;\r\n	<?php } ?>\r\n\r\n	<?php if (!empty($properties['static-categories-font-color'])) { ?>\r\n		color: <?php echo $properties['static-categories-font-color'] ?>;\r\n	<?php } ?>\r\n\r\n	<?php if (!empty($properties['static-categories-line-height'])) { ?>\r\n		line-height: <?php echo $properties['static-categories-line-height'] ?>;\r\n	<?php } ?>\r\n\r\n}\r\n\r\n<?php } ?>\r\n\r\n\r\n\r\n<?php if (!empty($properties['static-tags-use-typography'])) { ?>\r\n\r\n.<?php echo $properties['id'] ?> .upfront-post-data-part .upostdata-part.post_tags, .<?php echo $properties['id'] ?> .upfront-post-data-part .upostdata-part.post_tags a {\r\n\r\n	<?php if (!empty($properties['static-tags-font-family'])) { ?>\r\n		font-family: <?php echo $properties['static-tags-font-family'] ?>;\r\n	<?php } ?>\r\n\r\n	<?php if (!empty($properties['static-tags-style'])) { ?>\r\n		font-style: <?php echo $properties['static-tags-style'] ?>;\r\n	<?php } ?>\r\n\r\n	<?php if (!empty($properties['static-tags-weight'])) { ?>\r\n		font-weight: <?php echo $properties['static-tags-weight'] ?>;\r\n	<?php } ?>\r\n\r\n	<?php if (!empty($properties['static-tags-font-size'])) { ?>\r\n		font-size: <?php echo $properties['static-tags-font-size'] ?>px;\r\n	<?php } ?>\r\n\r\n	<?php if (!empty($properties['static-tags-font-color'])) { ?>\r\n		color: <?php echo $properties['static-tags-font-color'] ?>;\r\n	<?php } ?>\r\n\r\n	<?php if (!empty($properties['static-tags-line-height'])) { ?>\r\n		line-height: <?php echo $properties['static-tags-line-height'] ?>;\r\n	<?php } ?>\r\n\r\n}\r\n\r\n<?php } ?>\r\n\r\n\r\n<?php if(!empty($properties['preset_style'])) { ?><?php echo $properties['preset_style'] ?><?php } ?>\r\n"}),define("elements/upfront-post-data/js/modules-taxonomies",["elements/upfront-post-data/js/panel-abstractions","text!elements/upfront-post-data/tpl/preset-styles/taxonomy.html"],function(e,t){var n={};return n.template=t,n.part_categories=e.Toggleable.extend({title:"Categories",data_part:"categories",get_fields:function(){return[{type:"Number",property:"categories_limit",label:"Show max:",label_style:"inline",default_value:3},{type:"Text",property:"categories_separator",label:"Separate with",default_value:" | "}]}}),n.part_tags=e.Toggleable.extend({title:"Tags",data_part:"tags",get_fields:function(){return[{type:"Number",property:"tags_limit",label:"Show max:",label_style:"inline",default_value:3},{type:"Text",property:"tags_separator",label:"Separate with",default_value:", "}]}}),n}),define("text!elements/upfront-post-data/tpl/preset-styles/comments.html",[],function(){return"<?php if (!empty($properties['static-comment_count-use-typography'])) { ?>\r\n\r\n.<?php echo $properties['id'] ?> .upfront-post-data-part .comment_count, .<?php echo $properties['id'] ?> .upfront-post-data-part .comment_count a {\r\n\r\n	<?php if (!empty($properties['static-comment_count-font-family'])) { ?>\r\n		font-family: <?php echo $properties['static-comment_count-font-family'] ?>;\r\n	<?php } ?>\r\n\r\n	<?php if (!empty($properties['static-comment_count-style'])) { ?>\r\n		font-style: <?php echo $properties['static-comment_count-style'] ?>;\r\n	<?php } ?>\r\n\r\n	<?php if (!empty($properties['static-comment_count-weight'])) { ?>\r\n		font-weight: <?php echo $properties['static-comment_count-weight'] ?>;\r\n	<?php } ?>\r\n\r\n	<?php if (!empty($properties['static-comment_count-font-size'])) { ?>\r\n		font-size: <?php echo $properties['static-comment_count-font-size'] ?>px;\r\n	<?php } ?>\r\n\r\n	<?php if (!empty($properties['static-comment_count-font-color'])) { ?>\r\n		color: <?php echo $properties['static-comment_count-font-color'] ?>;\r\n	<?php } ?>\r\n\r\n	<?php if (!empty($properties['static-comment_count-line-height'])) { ?>\r\n		line-height: <?php echo $properties['static-comment_count-line-height'] ?>;\r\n	<?php } ?>\r\n\r\n}\r\n\r\n<?php } ?>\r\n\r\n\r\n\r\n<?php if (!empty($properties['static-comments-use-typography'])) { ?>\r\n\r\n.<?php echo $properties['id'] ?> .upfront-post-data-part .comments,\r\n.<?php echo $properties['id'] ?> .upfront-post-data-part .comments a,\r\n.<?php echo $properties['id'] ?> .upfront-post-data-part .upostdata-part.comments a,\r\n.<?php echo $properties['id'] ?> .upfront-post-data-part .comments p\r\n{\r\n\r\n	<?php if (!empty($properties['static-comments-font-family'])) { ?>\r\n		font-family: <?php echo $properties['static-comments-font-family'] ?>;\r\n	<?php } ?>\r\n\r\n	<?php if (!empty($properties['static-comments-style'])) { ?>\r\n		font-style: <?php echo $properties['static-comments-style'] ?>;\r\n	<?php } ?>\r\n\r\n	<?php if (!empty($properties['static-comments-weight'])) { ?>\r\n		font-weight: <?php echo $properties['static-comments-weight'] ?>;\r\n	<?php } ?>\r\n\r\n	<?php if (!empty($properties['static-comments-font-size'])) { ?>\r\n		font-size: <?php echo $properties['static-comments-font-size'] ?>px;\r\n	<?php } ?>\r\n\r\n	<?php if (!empty($properties['static-comments-font-color'])) { ?>\r\n		color: <?php echo $properties['static-comments-font-color'] ?>;\r\n	<?php } ?>\r\n\r\n	<?php if (!empty($properties['static-comments-line-height'])) { ?>\r\n		line-height: <?php echo $properties['static-comments-line-height'] ?>;\r\n	<?php } ?>\r\n\r\n}\r\n\r\n<?php } ?>\r\n\r\n\r\n\r\n<?php if (!empty($properties['static-comments_pagination-use-typography'])) { ?>\r\n\r\n.<?php echo $properties['id'] ?> .upfront-post-data-part .comments_pagination,\r\n.<?php echo $properties['id'] ?> .upfront-post-data-part .comments_pagination a,\r\n.<?php echo $properties['id'] ?> .upfront-post-data-part .upostdata-part.comments_pagination a\r\n{\r\n\r\n	<?php if (!empty($properties['static-comments_pagination-font-family'])) { ?>\r\n		font-family: <?php echo $properties['static-comments_pagination-font-family'] ?>;\r\n	<?php } ?>\r\n\r\n	<?php if (!empty($properties['static-comments_pagination-style'])) { ?>\r\n		font-style: <?php echo $properties['static-comments_pagination-style'] ?>;\r\n	<?php } ?>\r\n\r\n	<?php if (!empty($properties['static-comments_pagination-weight'])) { ?>\r\n		font-weight: <?php echo $properties['static-comments_pagination-weight'] ?>;\r\n	<?php } ?>\r\n\r\n	<?php if (!empty($properties['static-comments_pagination-font-size'])) { ?>\r\n		font-size: <?php echo $properties['static-comments_pagination-font-size'] ?>px;\r\n	<?php } ?>\r\n\r\n	<?php if (!empty($properties['static-comments_pagination-font-color'])) { ?>\r\n		color: <?php echo $properties['static-comments_pagination-font-color'] ?>;\r\n	<?php } ?>\r\n\r\n	<?php if (!empty($properties['static-comments_pagination-line-height'])) { ?>\r\n		line-height: <?php echo $properties['static-comments_pagination-line-height'] ?>;\r\n	<?php } ?>\r\n\r\n}\r\n\r\n<?php } ?>\r\n\r\n\r\n\r\n<?php if (!empty($properties['static-comment_form-use-typography'])) { ?>\r\n\r\n.<?php echo $properties['id'] ?> .upfront-post-data-part .comment_form,\r\n.<?php echo $properties['id'] ?> .upfront-post-data-part .comment_form a,\r\n.<?php echo $properties['id'] ?> .upfront-post-data-part .comment_form p,\r\n.<?php echo $properties['id'] ?> .upfront-post-data-part .comment_form h1,\r\n.<?php echo $properties['id'] ?> .upfront-post-data-part .comment_form h2,\r\n.<?php echo $properties['id'] ?> .upfront-post-data-part .comment_form h3,\r\n.<?php echo $properties['id'] ?> .upfront-post-data-part .comment_form h4,\r\n.<?php echo $properties['id'] ?> .upfront-post-data-part .comment_form h5,\r\n.<?php echo $properties['id'] ?> .upfront-post-data-part .comment_form h6\r\n{\r\n\r\n	<?php if (!empty($properties['static-comment_form-font-family'])) { ?>\r\n		font-family: <?php echo $properties['static-comment_form-font-family'] ?>;\r\n	<?php } ?>\r\n\r\n	<?php if (!empty($properties['static-comment_form-style'])) { ?>\r\n		font-style: <?php echo $properties['static-comment_form-style'] ?>;\r\n	<?php } ?>\r\n\r\n	<?php if (!empty($properties['static-comment_form-weight'])) { ?>\r\n		font-weight: <?php echo $properties['static-comment_form-weight'] ?>;\r\n	<?php } ?>\r\n\r\n	<?php if (!empty($properties['static-comment_form-font-size'])) { ?>\r\n		font-size: <?php echo $properties['static-comment_form-font-size'] ?>px;\r\n	<?php } ?>\r\n\r\n	<?php if (!empty($properties['static-comment_form-font-color'])) { ?>\r\n		color: <?php echo $properties['static-comment_form-font-color'] ?>;\r\n	<?php } ?>\r\n\r\n	<?php if (!empty($properties['static-comment_form-line-height'])) { ?>\r\n		line-height: <?php echo $properties['static-comment_form-line-height'] ?>;\r\n	<?php } ?>\r\n\r\n}\r\n\r\n<?php } ?>\r\n\r\n\r\n\r\n\r\n<?php if(!empty($properties['preset_style'])) { ?><?php echo $properties['preset_style'] ?><?php } ?>\r\n"}),define("elements/upfront-post-data/js/modules-comments",["elements/upfront-post-data/js/panel-abstractions","text!elements/upfront-post-data/tpl/preset-styles/comments.html"],function(e,t){var n={};return n.template=t,n.part_comment_count=e.Toggleable.extend({title:"Comment Count",data_part:"comment_count"}),n.part_comment_form=e.Toggleable.extend({title:"Comments Form",data_part:"comment_form"}),n.part_comments_pagination=e.Toggleable.extend({title:"Comments Pagination",data_part:"comments_pagination",get_fields:function(){var e=[],t=Upfront.data.upfront_post_data.post_data,n=parseInt((Upfront.data||{upfront_post_data_comments:{paginated:0}}).upfront_post_data_comments.paginated,10);return n||e.push({type:"Button",className:"comments-pagination_warning",label:"Comments pagination is disabled in admin. Toggling this part will have no effect."}),e}}),n.part_comments=e.Toggleable.extend({title:"Comments",data_part:"comments",get_fields:function(){var e=[],t=Upfront.data.upfront_post_data.post_data,n=(t||{comments:{}}).comments,r=(n||{disable:[]}).disable,i=parseInt((Upfront.data||{upfront_post_data_comments:{paginated:0}}).upfront_post_data_comments.paginated,10);return e=[{type:"Checkboxes",property:"disable",label:"For this post:",values:[{label:"Disable comments",value:"comments"},{label:"Disable trackbacks",value:"trackbacks"}]},{type:"Checkboxes",property:"disable_showing",label:"Do not show:",values:[{label:"Comments",value:"comments"},{label:"Trackbacks",value:"trackbacks"}]}],!i||e.push({type:"Number",property:"limit",label:"Comments per page"}),e.push({type:"Radios",property:"order",label:"Order by:",values:[{label:"Date",value:"comment_date_gmt"},{label:"Karma",value:"comment_karma"},{label:"Parent",value:"comment_parent"}]}),e.push({type:"Radios",property:"direction",label:"Direction:",values:[{label:"Oldest first",value:"ASC"},{label:"Newest first",value:"DESC"}]}),e},render:function(){var t=parseInt((Upfront.data||{upfront_post_data_comments:{paginated:0}}).upfront_post_data_comments.paginated,10),n=this.model.get("hidden_parts")||[];!t&&n.indexOf("comments_pagination")<0&&(n.push("comments_pagination"),this.model.set("hidden_parts",n)),e.Toggleable.prototype.render.apply(this,arguments);if(!this._disable_field||!this._pagination_field){var r=this.fields.toArray();this._disable_field=r[0],this._pagination_field=r[2],this._disable_field&&this.listenTo(this._disable_field,"changed",this.send_update_request)}},send_update_request:_.debounce(function(){var e=this._disable_field.get_value();Upfront.Util.post({action:"upfront-post_data-comments-disable",post_id:_upfront_post_data.post_id,disable:e})},3e3)}),Upfront.data.upfront_post_data.post_data={},Upfront.Util.post({action:"upfront-post_data-post-specific",post_id:_upfront_post_data.post_id}).done(function(e){Upfront.data.upfront_post_data.post_data="data"in e?e.data:{}}),n}),define("text!elements/upfront-post-data/tpl/preset-styles/meta.html",[],function(){return"<?php if(!empty($properties['preset_style'])) { ?><?php echo $properties['preset_style'] ?><?php } ?>"}),define("elements/upfront-post-data/js/modules-meta",["elements/upfront-post-data/js/panel-abstractions","text!elements/upfront-post-data/tpl/preset-styles/meta.html"],function(e,t){var n={};return n.template=t,n.part_meta=e.Toggleable.extend({title:"Meta",data_part:"meta",get_modules:function(){return[]}}),n}),define("elements/upfront-post-data/js/post-data-settings-panels",["scripts/upfront/preset-settings/preset-manager","scripts/upfront/preset-settings/util","elements/upfront-post-data/js/modules-post_data","elements/upfront-post-data/js/modules-author","elements/upfront-post-data/js/modules-featured_image","elements/upfront-post-data/js/modules-taxonomies","elements/upfront-post-data/js/modules-comments","elements/upfront-post-data/js/modules-meta"],function(e,t,n,r,i,s,o,u){var a={post_data:n.template,author:r.template,featured_image:i.template,taxonomy:s.template,comments:o.template,meta:u.template},f=_.extend({},_.omit(n,"template"),_.omit(r,"template"),_.omit(i,"template"),_.omit(s,"template"),_.omit(o,"template"),_.omit(u,"template")),l=e.extend({initialize:function(){var t="upfront_post_data_"+this.data_type,n={},r;_(_.omit(Upfront.data[t],["class","data_type","has_settings","id_slug","type","type_parts","view_class"])).each(function(e,t){n[t]=e}),typeof Upfront.mainData.presetDefaults[this.data_type+"_element"]!="undefined"?r=_.extend(n,Upfront.mainData.presetDefaults[this.data_type+"_element"]):r=n,_.extend(this,{mainDataCollection:this.data_type+"_elementPresets",styleElementPrefix:this.data_type+"_element",ajaxActionSlug:this.data_type+"_element",styleTpl:a[this.data_type],presetDefaults:_.extend(r,{id:"default",name:"Default"})}),e.prototype.initialize.apply(this,arguments),this.listenTo(this.model,"preset:updated",function(){this.model.get("objects").trigger("change")},this),Upfront.Application.cssEditor.elementTypes.PostDataModel=Upfront.Application.cssEditor.elementTypes.PostDataModel||{id:this.data_type,label:this.data_type}},setupItems:function(){var t=this.property("preset")?this.clear_preset_name(this.property("preset")):"default",n=this.presets.findWhere({id:t});n||(t="default",this.property("preset",t),n=this.presets.findWhere({id:t})),e.prototype.setupItems.apply(this,arguments),this.listenTo(this.selectPresetModule,"upfront:presets:change",function(){this.model.get("objects").trigger("change");var e=this,t=this.property("preset"),n=this.presets.findWhere({id:t});setTimeout(function(){var t=n.get("hidden_parts")||[],r=e.model.get_property_value_by_name("type_parts")||[];_.each(r,function(n){e.update_object(n,t.indexOf(n)<0)}),e.model.get("objects").trigger("change")})},this),_.each(this.part_panels,function(e,t){var r=new e({model:n}),i=this;this.listenTo(r,"part:hide:toggle",function(e,t){this.update_object(e,t?1:0),this.updatePreset(n.toJSON())},this),this.settings.push(r)},this)},getTitle:function(){return"Presets"},has_object:function(e){return this.find_object(e)?!0:!1},find_object:function(e){var t=this.model.get("objects");return t?t.find(function(t){var n=t.get_property_value_by_name("part_type");return e==n?!0:!1}):!1},find_wrapper:function(e){var t=this.model.get("wrappers"),n=e.get_wrapper_id();return t.get_by_wrapper_id(n)},update_object:function(e,t){var t=t==1,n=Upfront.Views.breakpoints_storage.get_breakpoints().get_active().toJSON(),r=this.model.get("objects"),i=this.model.get("wrappers"),s=this.find_object(e);if(n.default){if(!s&&t){var o=Upfront.Util.get_unique_id("wrapper"),u=new Upfront.Models.Wrapper({properties:[{name:"wrapper_id",value:o},{name:"class",value:"c24 clr"}]}),s=new Upfront.Models.PostDataPartModel({properties:[{name:"view_class",value:"PostDataPartView"},{name:"part_type",value:e},{name:"has_settings",value:0},{name:"class",value:"c24 upfront-post-data-part"},{name:"wrapper_id",value:o}]});i.add(u,{silent:!0}),r.add(s)}else if(s&&!t){var a=Upfront.data.object_views[s.cid];a.parent_view.on_entity_remove(null,a)}}else s&&s.set_breakpoint_property("hide",t?0:1)}});return _.each(a,function(e,n){var r=n+"_element";t.generatePresetsToPage(r,e)}),{get_panel:function(e){var t={};_.each(Upfront.data["upfront_post_data_"+e].type_parts,function(e){var n="part_"+e,r=f[n]?f[n]:!1;if(!r)return;t[e]=r});var n=l.extend({part_panels:t,data_type:e});return{stuff:n}}}}),define("elements/upfront-post-data/js/post-data-settings",["scripts/upfront/element-settings/settings","elements/upfront-post-data/js/post-data-settings-panels"],function(e,t){var n=e.extend({initialize:function(){var n=this,r=this.model.get_property_value_by_name("data_type"),i={},s=Upfront.Settings.l10n.post_data_element.elements[r]||r;this.panels=t.get_panel(r),this.title=s,e.prototype.initialize.apply(this,arguments)}});return n}),function(e){define("upostdata",["text!elements/upfront-post-data/tpl/views.html","elements/upfront-post-data/js/post-data-views","elements/upfront-post-data/js/post-data-settings","scripts/upfront/preset-settings/util"],function(t,n,r,i){function w(){"type"in _upfront_post_data.layout&&"single"===_upfront_post_data.layout.type?(Upfront.Application.LayoutEditor.add_object("Upostdata-post_data",{Model:f,View:h,DataElement:d,Settings:r,cssSelectors:{".date_posted":{label:s.css.post_data_date_label,info:s.css.post_data_date_info},".title":{label:s.css.post_data_title_label,info:s.css.post_data_title_info},".title h1":{label:s.css.post_data_title_h1_label,info:s.css.post_data_title_h1_info},".content":{label:s.css.post_data_content_label,info:s.css.post_data_content_info},".content p":{label:s.css.post_data_content_p_label,info:s.css.post_data_content_p_info}},cssSelectorsId:"post_post_data"}),Upfront.Application.LayoutEditor.add_object("Upostdata-author",{Model:f,View:h,DataElement:v,Settings:r,cssSelectors:{".author":{label:s.css.author_author_label,info:s.css.author_author_info},".author a":{label:s.css.author_author_link_label,info:s.css.author_author_link_info},".gravatar":{label:s.css.author_gravatar_label,info:s.css.author_gravatar_info},".author-email":{label:s.css.author_email_label,info:s.css.author_email_info},".author-email a":{label:s.css.author_email_link_label,info:s.css.author_email_link_info},".author-url":{label:s.css.author_url_label,info:s.css.author_url_info},".author-url a":{label:s.css.author_url_link_label,info:s.css.author_url_link_info},".author-bio":{label:s.css.author_bio_label,info:s.css.author_bio_info}},cssSelectorsId:"post_author"}),Upfront.Application.LayoutEditor.add_object("Upostdata-taxonomy",{Model:f,View:h,DataElement:m,Settings:r,cssSelectors:{".post_tags":{label:s.css.taxonomy_tags_label,info:s.css.taxonomy_tags_info},".post_tags a":{label:s.css.taxonomy_tags_link_label,info:s.css.taxonomy_tags_link_info},".post_categories":{label:s.css.taxonomy_category_label,info:s.css.taxonomy_category_info},".post_categories a":{label:s.css.taxonomy_category_link_label,info:s.css.taxonomy_category_link_info}},cssSelectorsId:"post_taxonomy"}),Upfront.Application.LayoutEditor.add_object("Upostdata-featured_image",{Model:f,View:h,DataElement:g,Settings:r,cssSelectors:{".thumbnail":{label:s.css.featured_thumbnail_label,info:s.css.featured_thumbnail_info},".thumbnail img":{label:s.css.featured_thumbnail_img_label,info:s.css.featured_thumbnail_img_info}},cssSelectorsId:"post_featured_image"}),Upfront.Application.LayoutEditor.add_object("Upostdata-comments",{Model:f,View:h,DataElement:y,Settings:r,cssSelectors:{".comment_count":{label:s.css.comment_count_label,info:s.css.comment_count_info},".comments":{label:s.css.comments_label,info:s.css.comments_info},".comments_pagination":{label:s.css.comments_pagination_label,info:s.css.comments_pagination_info},".upfront-post_data-comments":{label:s.css.comments_label,info:s.css.comments_info},".upfront-post_data-comments .comment":{label:s.css.comment_label,info:s.css.comment_info},".upfront-post_data-comments .comment-wrapper":{label:s.css.comment_wrapper_label,info:s.css.comment_wrapper_info},".upfront-post_data-comments .avatar":{label:s.css.comment_avatar_image_label,info:s.css.comment_avatar_image_info},".upfront-post_data-comments .comment-meta":{label:s.css.comment_meta_label,info:s.css.comment_meta_info},".upfront-post_data-comments .comment-meta .fn a":{label:s.css.comment_athor_label,info:s.css.comment_author_info},".upfront-post_data-comments .comment-meta .comment-time":{label:s.css.comment_time_label,info:s.css.comment_time_info},".upfront-post_data-comments .comment-content":{label:s.css.comment_content_label,info:s.css.comment_content_info},".upfront-post_data-comments .comment-content p":{label:s.css.comment_content_p_label,info:s.css.comment_content_p_info},".upfront-post_data-comments .edit-link a":{label:s.css.edit_link_label,info:s.css.edint_link_info},".upfront-post_data-comments .comment-reply a":{label:s.css.comment_reply_label,info:s.css.comment_reply_info},".comment-respond":{label:s.css.comment_form_label,info:s.css.comment_form_info},".comment-respond .comment-reply-title":{label:s.css.reply_title_label,info:s.css.reply_title_info},".comment-respond .logged-in-as":{label:s.css.logged_in_label,info:s.css.logged_in_info},".comment-respond .logged-in-as a":{label:s.css.logged_in_link_label,info:s.css.logged_in_link_info},".comment-respond .comment-form-comment":{label:s.css.respond_label,info:s.css.respond_info},'.comment-respond .comment-form-comment input[type="text"]':{label:s.css.comment_input_label,info:s.css.comment_input_info},".comment-respond .comment-form-comment textarea":{label:s.css.comment_textarea_label,info:s.css.comment_textarea_info},".comment-respond .form-submit .submit":{label:s.css.submit_button,info:s.css.submit_button}},cssSelectorsId:"post_comments"}),Upfront.Application.LayoutEditor.add_object("Upostdata-meta",{Model:f,View:h,DataElement:b,Settings:r,cssSelectors:{".meta":{label:s.css.post_meta_label,info:s.css.post_meta_info}},cssSelectorsId:"post_meta"})):(Upfront.Application.LayoutEditor.remove_object("Upostdata-post_data"),Upfront.Application.LayoutEditor.remove_object("Upostdata-author"),Upfront.Application.LayoutEditor.remove_object("Upostdata-taxonomy"),Upfront.Application.LayoutEditor.remove_object("Upostdata-featured_image"),Upfront.Application.LayoutEditor.remove_object("Upostdata-comments"),Upfront.Application.LayoutEditor.remove_object("Upostdata-meta"))}var s=Upfront.Settings.l10n.post_data_element,o=e(t),u={},a=Upfront.Models.ObjectModel.extend({init:function(){var e=Upfront.data.upfront_post_data_part?_.clone(Upfront.data.upfront_post_data_part):{};e.element_id=Upfront.Util.get_unique_id(e.id_slug+"-object"),this.init_properties(e)}}),f=Upfront.Models.ObjectGroup.extend({init:function(){var e=this.get_property_value_by_name("data_type"),t=e?"upfront_post_data_"+e:"upfront_post_data",n=Upfront.data[t]?_.clone(Upfront.data[t]):{};n.element_id=Upfront.Util.get_unique_id(n.id_slug+"-object"),this.init_properties(n)}}),l=null,c=Upfront.Views.ObjectView.extend({init:function(){},on_render:function(){this.update_height()},update:function(e,t){if(e&&e.id=="preset")return;this.constructor.__super__.update.call(this,e,t),this.adjust_featured_image()},on_element_drop:function(){this.update_height()},render_view:function(e){this.$el.find(".upfront-object-content").empty().append(e),this.adjust_featured_image(),this.prepare_editor(),Upfront.Events.trigger("post-data:part:rendered",this,e)},prepare_editor:function(){var e=this,t=this.model.get_property_value_by_name("part_type"),n=this.$el.find(".upfront-object-content");this._editor_prepared&&this.editor_view?(this.editor_view.setElement(n),this.trigger_edit()):!this._editor_prepared&&l&&(l.addPartView(t,n.get(0),this.model,this.object_group_view.model).done(function(t){e.editor_view=t,e.trigger_edit()}),this._editor_prepared=!0)},getControlItems:function(){return _([])},trigger_edit:function(){if(!l.contentEditor||!l.contentEditor._editing)return;this.editor_view.editContent()},on_element_edit_start:function(){return},on_element_edit_stop:function(){return},update_height:function(){var e=this.model.get_property_value_by_name("part_type");if(e=="content"||e=="comments")this.$el.find("> .upfront-object").css("min-height",""),this.object_group_view.$el.find("> .upfront-object-group").css("min-height",""),this.object_group_view.parent_module_view.$el.find("> .upfront-module").css("min-height",""),this.add_region_class("upfront-region-container-has-"+e,!0)},adjust_featured_image:function(){var t=this.$el.find(".thumbnail img").attr("src"),n=this,r=this.$el.find("> .upfront-editable_entity"),i=this.model.get_property_value_by_name("part_type"),s=Upfront.Settings.LayoutEditor.Grid.baseline,o=this.model.get_breakpoint_property_value("row",!0),u=o*s,a=parseInt(r.css("padding-top"),10),f=parseInt(r.css("padding-bottom"),10);if(i!="featured_image")return;u-=a+f,this.$el.find(".thumbnail").each(function(){var t=e(this).width(),n=e(this).find("img"),r=new Image,i,s;e(this).css("height",u),e("<img>").attr("src",n.attr("src")).load(function(){e(this).attr("data-resize")=="1"?(r.src=n.attr("src"),i=r.height,s=r.width,u/t>i/s?n.css({height:"100%",width:"auto",marginLeft:(t-Math.round(u/i*s))/2,marginTop:""}):n.css({height:"auto",width:"100%",marginLeft:"",marginTop:(u-Math.round(t/s*i))/2})):(i=n.height(),u!=i&&n.css("margin-top",(u-i)/2))})})},cleanup:function(){var e=this.model.get_property_value_by_name("part_type");this.remove_region_class("upfront-region-container-has-"+e,!0)}}),h=Upfront.Views.ObjectGroup.extend({init:function(){this.listenTo(this.model.get("objects"),"change",this.on_render),this.listenTo(this.model.get("objects"),"add",this.on_render),this.listenTo(this.model.get("objects"),"remove",this.on_render),this.delegateEvents(),this.prepare_editor(),this._multiple=!1},get_extra_buttons:function(){return""},getControlItems:function(){var e=this.get_child_objects(!1),t=[];return e.length>1?(t.push(this.createControl("reorder",s.settings,"on_edit_click")),this._multiple=!0):this._multiple=!1,t.push(this.createPaddingControl()),t.push(this.createControl("settings",s.settings,"on_settings_click")),_(t)},get_preset_properties:function(){var e=this.model.get_property_value_by_name("preset"),t=this.model.get_property_value_by_name("data_type"),n=i.getPresetProperties(t+"_element",e)||{};return n},get_preset_property:function(e){var t=this.get_preset_properties();return t[e]},get_child_objects:function(e){return this.model.get("objects").filter(function(t){var n=t.get_property_value_by_name("view_class");return"PostDataPartView"==n?!0:e===!0})},on_edit_click:function(e){typeof e!="undefined"&&e.preventDefault(),this.enable_object_edit()},on_render:function(){var e=this.model.get_property_value_by_name("data_type"),t=this.get_child_objects(!1);this.render_view(e);if(this.parent_module_view){this.$control_el=this.$el,this.controls&&(t.length>1&&!this._multiple||t.length==1&&this._multiple)&&(this.controls.remove(),this.controls=!1,this.$control_el.find(">.upfront-element-controls").remove()),this.updateControls();var n=this;setTimeout(function(){n.paddingControl&&typeof n.paddingControl.isOpen!="undefined"&&!n.paddingControl.isOpen&&n.paddingControl.refresh()},300)}},render_view:function(e){var t=this.model.get_property_value_by_name("preset"),r=this;if(this.child_view){this.child_view.render();return}e=e||n.DEFAULT;var i=n[e]?new n[e]({model:this.model}):new n[n.DEFAULT]({model:this.model});i.element=this,i.render(),this.child_view=i,this.$el.find(".upfront-object-group-default").append(i.$el)},prepare_editor:function(){this.postId=_upfront_post_data.post_id?_upfront_post_data.post_id:Upfront.Settings.LayoutEditor.newpostType?0:!1,!this.postId&&"themeExporter"in Upfront&&Upfront.Application.mode.current===Upfront.Application.MODE.THEME?this.postId="fake_post":!this.postId&&"themeExporter"in Upfront&&Upfront.Application.mode.current===Upfront.Application.MODE.CONTENT_STYLE&&(this.postId="fake_styled_post");if(!l||l.postId!=this.postId)l=new Upfront.Content.PostEditor({editor_id:"this_post_"+this.postId,post_id:this.postId,content_mode:"post_content"});this.listenTo(l,"post:saved post:trash",this.on_render),this.listenTo(l,"post:cancel",this.on_cancel),this.listenTo(l,"editor:edit:start",this.on_edit_start),this.listenTo(l,"editor:edit:stop",this.on_edit_stop),this.listenTo(l,"editor:change:title",this.on_title_change),this.listenTo(l,"editor:change:content",this.on_content_change),this.listenTo(l,"editor:change:author",this.on_author_change),this.listenTo(l,"editor:change:date",this.on_date_change),this.editor=l},on_cancel:function(){if(!this.child_view)return;this.child_view.rerender()},on_edit_start:function(){if(!this.child_view)return;this.child_view._do_cache=!1},on_edit_stop:function(){if(!this.child_view)return;this.child_view._do_cache=!0},on_title_change:function(e){},on_content_change:function(e,t){},on_author_change:function(e){if(!this.child_view)return;var t=this.model.get_property_value_by_name("data_type");this.authorId=e,"author"==t&&this.child_view.render()},on_date_change:function(e){if(!this.child_view)return;var t=this.model.get_property_value_by_name("data_type");this.postDate=Upfront.Util.format_date(e,!0,!0).replace(/\//g,"-"),"post_data"==t&&this.child_view.render(["date_posted"])},on_element_edit_start:function(e,t){e=="write"&&this.parent_module_view?(this.parent_module_view.$el.find(">.upfront-module").addClass("upfront-module-editing"),this.parent_module_view.disable_interaction(!1,!0,!1,!1,!0)):this.constructor.__super__.on_element_edit_start.call(this,e,t)},on_element_edit_stop:function(e,t,n){e=="write"&&this.parent_module_view&&this.parent_module_view.enable_interaction&&n!==!0?(this.parent_module_view.$el.find(">.upfront-module").removeClass("upfront-module-editing"),this.parent_module_view.enable_interaction(!0)):this.constructor.__super__.on_element_edit_stop.call(this,e,t,n)},on_element_resize:function(e){var t=this.get_child_objects(!1),n=Upfront.Views.breakpoints_storage.get_breakpoints().get_active().toJSON();if(t.length!=1)return;n.default?_.each(t,function(t){t.set_property("row",e.row)}):_.each(t,function(t){var r=Upfront.Util.clone(t.get_property_value_by_name("breakpoint")||{});_.isObject(r[n.id])||(r[n.id]={}),r[n.id].row=e.row,t.set_property("breakpoint",r)})}}),p=Upfront.Views.Editor.Sidebar.Element.extend({_default_data:{type:"",columns:24,rows:Upfront.Util.height_to_row(200),name:"",parts:{}},_post_parts:[],render:function(){this.$el.html(this._default_data.name)},create_part_objects:function(e){var t=this,n=[],r=[],i=this._default_data.type,s=(Upfront.mainData||{})[i+"_elementPresets"]||[],o=(_.findWhere(s,{id:"default"})||{}).hidden_parts||[];return _.each(e,function(e){if(o.indexOf(e)>=0)return;var i=t.create_part_object(e);n.push(i.object),r.push(i.wrapper)}),{objects:n,wrappers:r}},create_part_object:function(e){var t=_.isObject(this._default_data.parts)&&_.isObject(this._default_data.parts[e])?this._default_data.parts[e]:{},n=Upfront.Util.get_unique_id("wrapper"),r=new Upfront.Models.Wrapper({properties:[{name:"wrapper_id",value:n},{name:"class",value:"c24"}]}),i=new a({properties:[{name:"view_class",value:"PostDataPartView"},{name:"part_type",value:e},{name:"has_settings",value:0},{name:"class",value:"c24 upfront-post-data-part part-"+e},{name:"wrapper_id",value:n}]});return _.isUndefined(t.rows)||i.set_property("row",t.rows,!0),{object:i,wrapper:r}},add_element:function(){var e=this.create_part_objects(this._post_parts),t=new f({properties:[{name:"data_type",value:this._default_data.type},{name:"row",value:this._default_data.rows}],objects:e.objects,wrappers:e.wrappers}),n=new Upfront.Models.Module({name:"",properties:[{name:"element_id",value:Upfront.Util.get_unique_id("module")},{name:"class",value:"c"+this._default_data.columns+" upfront-post_data_module"},{name:"has_settings",value:0},{name:"row",value:this._default_data.rows}],objects:[t]});this.add_module(n)}}),d=p.extend({_default_data:{type:"post_data",columns:18,rows:Upfront.Util.height_to_row(200),name:"Post Data"},_post_parts:["date_posted","title","content"]}),v=p.extend({_default_data:{type:"author",columns:4,rows:Upfront.Util.height_to_row(100),name:"Author"},_post_parts:["author","gravatar","author_email","author_url","author_bio"]}),m=p.extend({_default_data:{type:"taxonomy",columns:18,rows:Upfront.Util.height_to_row(50),name:"Categories & Tags"},_post_parts:["tags","categories"]}),g=p.extend({_default_data:{type:"featured_image",columns:18,rows:Upfront.Util.height_to_row(200),name:"Featured Image",parts:{featured_image:{rows:Upfront.Util.height_to_row(200)}}},_post_parts:["featured_image"]}),y=p.extend({_default_data:{type:"comments",columns:18,rows:Upfront.Util.height_to_row(200),name:"Comments"},_post_parts:["comment_count","comments","comments_pagination","comment_form"]}),b=p.extend({_default_data:{type:"meta",columns:4,rows:Upfront.Util.height_to_row(50),name:"Meta"},_post_parts:["meta"]});Upfront.Events.on("application:setup:editor_interface",function(){w()}),w(),Upfront.Models.PostDataModel=f,Upfront.Models.PostDataPartModel=a,Upfront.Views.PostDataView=h,Upfront.Views.PostDataPartView=c})}(jQuery),function(e){define("this_page",[],function(){var t=Upfront.Settings.l10n.this_page_element,n=Upfront.Models.ObjectModel.extend({init:function(){var e=_.clone(Upfront.data.thisPage.defaults);e.element_id=Upfront.Util.get_unique_id(e.id_slug+"-object"),this.init_properties(e)}}),r=function(){var r=!1,i=!1,s=!1,o=!1,u=[],a={},f={};return Upfront.Views.ObjectView.extend({markup:!1,loading:!1,display:"title",deferred:!1,is_new:!1,is_started:!1,initialize:function(e){var t=this;this.model instanceof n||(this.model=new n({properties:this.model.get("properties")})),this.constructor.__super__.initialize.call(this,[e]),this.display=this.model.get_property_value_by_name("display"),u.push(this),r=_upfront_post_data.post_id?_upfront_post_data.post_id:Upfront.Settings.LayoutEditor.newpostType?0:!1,this.listenTo(Upfront.Events,"command:layout:save_start",this.on_save)},get_content_markup:function(){return i||!this.markup?(this.get_markup().done(e.proxy(this.refresh_markup,this)),"Loading"):this.markup},on_render:function(){this.update_editor(this.$el.find(".upfront-object-content"))},on_edit:function(){this.update_editor(this.$el.find(".upfront-object-content"),!0,!0)},get_markup:function(){var n=this;n.deferred=new e.Deferred;if(r===!1)return n.deferred.resolve("error");if(s)return n.deferred.promise();if(!i&&a.length>0&&a[n.display])return n.deferred.resolve(a[n.display]);var o=n.$el.find(".upfront-object-content"),f=o.length?new Upfront.Views.Editor.Loading({loading:t.refreshing,done:t.here_we_are,fixed:!1}):!1;return f&&(f.render(),o.append(f.$el)),s=!0,Upfront.Util.post({action:"this_page-get_markup",data:JSON.stringify({post_id:r,post_type:Upfront.Settings.LayoutEditor.newpostType})}).success(function(e){f&&(f.done(),f=!1);var t=t||n.$el.find(".upfront-object-content"),i=Upfront.data.posts[r];a=e.data.filtered,_.each(u,function(e){e.is_new=i&&i.is_new,e.deferred.resolve(a[e.display])}),i&&(i.is_new=!1)}).done(function(){s=!1}),n.deferred.promise()},get_page:function(){var t,n=new e.Deferred;return Upfront.data.posts[r]?(t=Upfront.data.posts[r],n.resolve(t)):(t=new Upfront.Models.Post({ID:r}),t.fetch({withMeta:!0,filterContent:!0}).done(function(e){Upfront.data.posts||(Upfront.data.posts={}),Upfront.data.posts[r]=t,n.resolve(t)}),n.promise())},refresh_markup:function(e){var t=this,n=this.$el.find(".upfront-object-content"),r=_.findWhere(Upfront.data.ueditor.selectors,{type:this.display}).selector,i="";this.get_page().done(function(s){n.html(e),t.display=="title"?i=s.get("post_title"):t.display=="content"&&(i=s.get("post_content")),n.find(r).html(i),t.markup=n.html(),t.update_editor(n)})},update_editor:function(n,r,i){var s=this,i=typeof i=="undefined"?!0:i,o=_.findWhere(Upfront.data.ueditor.selectors,{type:this.display}).selector,a=n.find(o),l=a.data("ueditor"),c={},h=!1;if(l){r===!0&&!s.is_started&&a.trigger("dblclick");return}s.display=="title"?c={airButtons:{},observeLinks:!1,tabFocus:!1,disableLineBreak:!0,pastePlainText:!0,autostart:r===!0,placeholder:t.title_placeholder,focus:i}:s.display=="content"&&(c={linebreaks:!1,autostart:r===!0,placeholder:t.content_placeholder,focus:i,upfrontMedia:!0,upfrontImages:!0}),a.on("start",function(){h=!0,s.is_started=!0,_.each(u,function(e){if(e==s)return;e.update_editor(e.$el.find(".upfront-object-content"),!0,!1)}),setTimeout(function(){a.ueditor("focus")},100),Upfront.Events.trigger("upfront:element:edit:start","text")}).on("stop",function(){h=!1,s.is_started=!1,Upfront.Events.trigger("upfront:element:edit:stop")}).on("syncAfter",function(){h&&(f[s.display]=a.ueditor("get"),s.markup=e(s.markup).html(f[s.display]).get(0).outerHTML)}).ueditor(c)},on_save:function(){if(o)return;o=!0;var e=this;this.get_page().done(function(t){t.set("post_status","publish"),t.set("post_title",f.title),t.set("post_content",f.content),t.save().done(function(){if(!e.is_new)return;var t="/edit/page/"+r;Upfront.Application.navigate(t),o=!1})})},cleanup:function(){var e=this;_.each(u,function(t,n){t==e&&u.splice(n)})}})}(),i=Upfront.Views.Editor.Sidebar.Element.extend({draggable:!1,render:function(){this.$el.html(t.page_title)},add_element:function(){var e=new n({view:"ThisPageTitle"}),t=new Upfront.Models.Module({name:"",properties:[{name:"element_id",value:Upfront.Util.get_unique_id("module")},{name:"class",value:"c6 upfront-this_page_title_module"},{name:"has_settings",value:0}],objects:[e]});this.add_module(t)}}),s=Upfront.Views.Editor.Sidebar.Element.extend({draggable:!1,render:function(){this.$el.html(t.page_content)},add_element:function(){var e=new n({view:"ThisPageContent"}),t=new Upfront.Models.Module({name:"",properties:[{name:"element_id",value:Upfront.Util.get_unique_id("module")},{name:"class",value:"c6 upfront-this_page_content_module"},{name:"has_settings",value:0}],objects:[e]});this.add_module(t)}});Upfront.Models.ThisPageModel=n,Upfront.Views.ThisPageView=r})}(jQuery),function(e){define("elements/upfront-widget/js/settings",["scripts/upfront/element-settings/settings","scripts/upfront/element-settings/root-settings-panel","scripts/upfront/preset-settings/util","text!elements/upfront-widget/tpl/preset-style.html"],function(e,t,n,r){var s=Upfront.Settings.l10n.widget_element,o=!1,u=!1,a=Upfront.Views.Editor.Settings.Item.extend({get_title:function(){for(i in Upfront.data.uwidget.widgets)if(Upfront.data.uwidget.widgets[i].key===u||Upfront.data.uwidget.widgets[i].key===this.model.get_property_value_by_name("current_widget"))return Upfront.data.uwidget.widgets[i].name;return o?o:""},update_settings:function(e,t){var n=this,r={action:"uwidget_get_widget_admin_form",data:JSON.stringify({widget:e})};Upfront.Util.post(r).success(function(r){n.model.set_property("current_widget_specific_fields",r.data),n.$el.html(""),u=e,o=e,n.udpate_fields(),n.render(),t.model.set_property("current_widget",e)}).error(function(e){console.log("error receiving widget specific settings")})},initialize:function(){u=o,this.udpate_fields()},udpate_fields:function(){var e=this;this.fields=_([]);var t=this.model.get_property_value_by_name("current_widget_specific_fields")||this.model.get_property_value_by_name("widget_specific_fields");for(key in t)t[key]["type"]=="select"?this.fields._wrapped[this.fields._wrapped.length]=new Upfront.Views.Editor.Field.Select({model:this.model,property:t[key].name,label:t[key].label,values:_.map(t[key].options,function(e,t){return{label:e,value:t}}),change:this.clear_cache}):t[key]["type"]=="text"?this.fields._wrapped[this.fields._wrapped.length]=new Upfront.Views.Editor.Field.Text({model:this.model,property:t[key].name,label:t[key].label,value:t[key].value,change:this.clear_cache}):t[key]["type"]=="textarea"?this.fields._wrapped[this.fields._wrapped.length]=new Upfront.Views.Editor.Field.Textarea({model:this.model,property:t[key].name,label:t[key].label,value:t[key].value,change:this.clear_cache}):t[key]["type"]=="checkbox"?this.fields._wrapped[this.fields._wrapped.length]=new Upfront.Views.Editor.Field.Checkboxes({model:this.model,property:t[key].name,label:"",values:[{label:t[key].label,value:t[key].value}],change:this.clear_cache}):t[key]["type"]=="radio"&&(this.fields._wrapped[this.fields._wrapped.length]=new Upfront.Views.Editor.Field.Radios({model:this.model,property:t[key].name,label:"",values:[{label:t[key].label,value:t[key].value}],change:this.clear_cache}))},clear_cache:function(e){Upfront.data.uwidget.widgets_cache={};var t=(this.options||{}).property,n=this.model.get_property_value_by_name("current_widget_specific_fields");_.each(n,function(n,r){t===(n||{}).name&&this.model.set_property(t,e)},this)}}),f=e.extend({panels:{Appearance:{mainDataCollection:"widgetPresets",styleElementPrefix:"widget-preset",ajaxActionSlug:"widget",panelTitle:s.settings,presetDefaults:{id:"default",name:s.default_preset},styleTpl:r,migrateDefaultStyle:function(e){return e=e.replace(/(div)?\.upfront-widget\s/g,""),e=e.replace(/(div)?\.upfront-object\s/g,""),e}}},initialize:function(e){this.constructor.__super__.initialize.call(this,e);var n=_(_.filter(Upfront.data.uwidget.widgets,function(e){return e.admin})).map(function(e){return{label:e.name,value:e.key}});n.unshift({label:s.widget_select,value:""});var r=new t({model:this.model,className:"upfront-settings_panel_wrap widget-settings",title:s.settings}),i=new a({model:this.model}),f=new Upfront.Views.Editor.Settings.Item({model:this.model,title:s.widget_select,fields:[new Upfront.Views.Editor.Field.Select({model:this.model,property:"widget",values:n,change:function(e){o=e,u!==e&&i.update_settings(e,this)}})]});r.settings=_([f,i]),this.panels=_.extend({General:r},this.panels);var l=function(){this.model.set_property("widget_specific_fields",this.model.get_property_value_by_name("current_widget_specific_fields"))};Upfront.Events.off("element:settings:saved",l),Upfront.Events.once("element:settings:saved",l,this);var c=function(){o=u=this.model.get_property_value_by_name("widget"),this.model.set_property("current_widget_specific_fields",this.model.get_property_value_by_name("widget_specific_fields"),!0),this.model.set_property("current_widget",this.model.get_property_value_by_name("widget"))};Upfront.Events.off("element:settings:canceled",c),Upfront.Events.once("element:settings:canceled",c,this)},title:s.settings});return n.generatePresetsToPage("widget",r),f})}(jQuery),function(e){define("uwidget",["elements/upfront-widget/js/settings"],function(e){var t=Upfront.Settings.l10n.widget_element,n=Upfront.Models.ObjectModel.extend({init:function(){var e=_.clone(Upfront.data.uwidget.defaults);e.element_id=Upfront.Util.get_unique_id(e.id_slug+"-object"),this.init_properties(e)}}),r=Upfront.Views.ObjectView.extend({loading:null,content_loaded:!1,initialize:function(e){this.model instanceof n||(this.model=new n({properties:this.model.get("properties")})),this.model.set_property("current_widget",this.model.get_property_value_by_name("widget"),!0),this.model.set_property("current_widget_specific_settings",this.model.get_property_value_by_name("widget_specific_fields"),!0),this.constructor.__super__.initialize.call(this,[e])},init:function(){Upfront.data.uwidget.widgets_cache||(Upfront.data.uwidget.widgets_cache={}),Upfront.Events.on("entity:settings:activate",this.clear_cache,this)},clear_cache:function(){Upfront.data.uwidget.widgets_cache[this.model.get_property_value_by_name("current_widget")+this.cid]=null},get_content_markup:function(){var e=this.model.get_property_value_by_name("current_widget");me=this;if(!e||e==="")return'<span class="no-widget-notice">'+t.select_widget+"</span>";var n=Upfront.data.uwidget.widgets_cache[e+this.cid]||"";return n&&(this.content_loaded=!0),n},on_render:function(){var e=this.model.get_property_value_by_name("current_widget");if(!e)return;if(typeof Upfront.data.uwidget.widgets_cache[e+this.cid]=="undefined"||Upfront.data.uwidget.widgets_cache[e+this.cid]==null)this.content_loaded&&(this.loading=new Upfront.Views.Editor.Loading({loading:t.loading,done:t.done}),this.loading.render(),this.$el.append(this.loading.el)),this._get_widget_markup(e)},_get_widget_markup:function(e){var t=this,n=this.model.get_property_value_by_name("current_widget_specific_fields")||this.model.get_property_value_by_name("widget_specific_fields"),r={};for(key in n)r[n[key].name]=this.model.get_property_value_by_name(n[key].name);Upfront.Util.post({action:"uwidget_get_widget_markup",data:JSON.stringify({widget:e,instance:r})}).success(function(n){Upfront.data.uwidget.widgets_cache[e+t.cid]=n.data,t.loading?t.loading.done(function(){t.render()}):t.render()}).error(function(e){Upfront.Util.log("Error loading widget")})}}),i=Upfront.Views.Editor.Sidebar.Element.extend({priority:80,render:function(){this.$el.addClass("upfront-icon-element upfront-icon-element-widget"),this.$el.html(t.element_name)},add_element:function(){var e=new n,t=new Upfront.Models.Module({name:"",properties:[{name:"element_id",value:Upfront.Util.get_unique_id("module")},{name:"class",value:"c6 upfront-widget_module"},{name:"has_settings",value:0},{name:"row",value:Upfront.Util.height_to_row(150)}],objects:[e]});this.add_module(t)}});Upfront.Application.LayoutEditor.add_object("Uwidget",{Model:n,View:r,Element:i,Settings:e,cssSelectors:{".widget":{label:t.css.container_label,info:t.css.container_info},".widget a":{label:t.css.links_label,info:t.css.links_info}},cssSelectorsId:Upfront.data.uwidget.defaults.type}),Upfront.Models.UwidgetModel=n,Upfront.Views.UwidgetView=r})}(jQuery),define("text!elements/upfront-youtube/tpl/youtube.html",[],function(){return'<div class="upfront-youtube-container <?php if ($multiple_videos && count($multiple_videos) < 2) { ?>uyoutube-single<?php } else { ?>uyoutube-multiple-<?php echo $display_style ?><?php } ?>">\r\n    <?php if ($multiple_videos && count($multiple_videos) == 1) { ?>\r\n		<?php if(!empty($multiple_videos[0][\'id\'])) { ?>\r\n			<iframe src="https://www.youtube.com/embed/<?php echo $multiple_videos[0][\'id\'] ?>?modestbranding=1" height="<?php echo $player_height ?>" width="<?php echo $player_width ?>"></iframe>\r\n			<?php if(!empty($multiple_show_title[0])){ ?>\r\n				<h3><?php echo $multiple_videos[0][\'title\'] ?></h3>\r\n			<?php } ?>\r\n		<?php } else { ?>\r\n			<div class="uyoutube-player" style="width: <?php echo $player_width ?>px; height: <?php echo $player_height ?>px;"></div>\r\n		<?php } ?>\r\n	<?php } ?>\r\n	\r\n	<?php if (count($multiple_videos) > 1) { ?>\r\n    <div class="uyoutube-main-video">\r\n      <?php if ( !empty($multiple_videos[0] ) ) { ?>\r\n        <iframe src="https://www.youtube.com/embed/<?php echo $multiple_videos[0][\'id\'] ?>?modestbranding=1" height="<?php echo $player_height ?>" width="<?php echo $player_width ?>"></iframe>\r\n		<h3><?php echo $multiple_videos[0][\'title\'] ?></h3>\r\n	  <?php } else { ?>\r\n        <div class="uyoutube-player" style="height:<?php echo $player_height ?>px; width:<?php echo $player_width ?>px;"></div>\r\n      <?php } ?>\r\n    </div>\r\n	<div class="uyoutube-thumbnails">\r\n    <?php if ($display_style == \'gallery\') { ?>\r\n      <?php if ($multiple_videos && count( $multiple_videos )  ) {  ?>\r\n        <?php for ($i = 0; $i < count( $multiple_videos ); $i++) {  ?>\r\n		<?php if(empty($first_to_thumbnails[0]) && $i == 0) { continue; } ?>\r\n          <div class="uyoutube-thumbnail uyoutube-gallery-item <?php if(empty($first_to_thumbnails[0])) { ?>firstHidden<?php } ?>" data-video-id="<?php echo $multiple_videos[$i][\'id\'] ?>" style="width:<?php echo $thumbWidth ?>px;">\r\n            <div class="uyoutube-thumb-mask" style="width:<?php echo $thumbWidth ?>px;height:<?php echo $thumbHeight ?>px"><!-- add width height dynamicly -->\r\n				<img class="uyoutube-thumb" src="https://img.youtube.com/vi/<?php echo $multiple_videos[$i][\'id\'] ?>/hqdefault.jpg" style="width:<?php echo $thumbWidth ?>px; margin-top: -<?php echo $thumbOffset ?>px;">\r\n            </div>\r\n            <?php if(!empty($multiple_show_title[0])){ ?>\r\n            <h4 class="uyoutube-title"><?php echo $multiple_videos[$i][\'title\'] ?></h4>\r\n            <?php } ?>\r\n          </div>\r\n        <?php } ?>\r\n      <?php } ?>\r\n    <?php } ?>\r\n    <?php if ($display_style == \'list\') { ?>\r\n      <?php if ($multiple_videos) { ?>\r\n        <?php for ($i = 0; $i < count( $multiple_videos ); $i++) { ?>\r\n		<?php if(empty($first_to_thumbnails[0]) && $i == 0) { continue; } ?>\r\n        <div class="uyoutube-thumbnail uyoutube-list-item <?php if(empty($first_to_thumbnails[0])) { ?>firstHidden<?php } ?>" data-video-id="<?php echo $multiple_videos[$i][\'id\'] ?>">\r\n            <div class="uyoutube-thumb-holder" style="width:<?php echo $thumbWidth ?>px;">\r\n              <div class="uyoutube-thumb-mask" style="width:<?php echo $thumbWidth ?>px;height:<?php echo $thumbHeight ?>px">\r\n                <img class="uyoutube-thumb" style="width:<?php echo $thumbWidth ?>px; margin-top: -<?php echo $thumbOffset ?>px" src="http://img.youtube.com/vi/<?php echo $multiple_videos[$i][\'id\'] ?>/hqdefault.jpg" width="80">\r\n              </div>\r\n            </div>\r\n            <div class="uyoutube-content-holder">\r\n              <?php if ($multiple_show_title[0]) { ?>\r\n                <h4 class="uyoutube-title"><?php echo $multiple_videos[$i][\'title\'] ?></h4>\r\n              <?php } ?>\r\n            </div>\r\n          </div>\r\n        <?php } ?>\r\n      <?php }  ?>\r\n    <?php } ?>\r\n	</div>\r\n  <?php } ?>\r\n</div>\r\n'}),define("text!elements/upfront-youtube/tpl/clonevideo.html",[],function(){return'<div class="upfront-settings-item">\n	<div class="upfront-settings-item-content">\n		<div class="multiple_sources">\n			<label class="upfront-field-label upfront-field-label-block" for="view3296-multiple_source_{{cloneId}}">{{l10n.video_label}} {{cloneId}} {{l10n.url_label}}</label>\n			<input id="view3296-multiple_source_{{cloneId}}" class="upfront-field upfront-field-text" type="text" placeholder="{{l10n.url_placeholder}}" value="{{videoUrl}}" name="multiple_source_{{cloneId}}">\n		</div>\n	</div>\n</div>'}),function(e){define("uyoutube",["scripts/upfront/element-settings/settings","scripts/upfront/element-settings/root-settings-panel","text!elements/upfront-youtube/tpl/youtube.html","text!elements/upfront-youtube/tpl/clonevideo.html"],function(t,n,r,i){var s=Upfront.Settings.l10n.youtube_element,o=Upfront.Models.ObjectModel.extend({init:function(){var e=_.clone(Upfront.data.uyoutube.defaults);e.element_id=Upfront.Util.get_unique_id("youtube-object"),this.init_properties(e)}}),u=Upfront.Views.ObjectView.extend({model:o,youtubeTpl:Upfront.Util.template(r),elementSize:{width:0,height:0},initialize:function(){var e=this;this.model instanceof o||(this.model=new o({properties:this.model.get("properties")}));var t=this.parent_module_view,e=this;this.delegateEvents(),this.model.get("properties").bind("change",this.render,this),this.model.get("properties").bind("change",this.handle_visual_padding_hint,this),this.model.get("properties").bind("add",this.render,this),this.model.get("properties").bind("remove",this.render,this),this.listenTo(Upfront.Events,"upfront:layout_size:change_breakpoint",this.onResizeStop)},on_element_resize_start:function(e){this.$el.find(".upfront-object-content").append('<div class="object-view-overlay" />')},on_element_resize:function(e){this.$el.find(".object-view-overlay").remove(),this.onResizeStop(this)},get_content_markup:function(){var e,t=this.extract_properties();return this.trimListTitle(),e=this.youtubeTpl(this.extract_properties()),this.property("youtube_status")==="starting"&&!t.multiple_videos&&(e+='<div class="upfront-youtube-starting-select upfront-initial-overlay-wrapper"><div class="upfront-youtube-starting-wrapper upfront-initial-overlay-wrapper" style="height: 110px;"><div class="upfront-youtube-starting-text">'+s.enter_url+"</div>"+'<div class="upfront-youtube-box-wrapper"><input type="text" class="upfront-youtube-url" placeholder="'+s.url_placeholder+'" /></div>'+'<div class="upfront-youtube-button-wrapper"><button type="button" class="upfront-youtube-button">'+s.submit_button+"</button></div>"+"</div></div>"),e},trimListTitle:function(){var t=this,n=this.extract_properties();n.multiple_videos!==null&&typeof n.multiple_videos=="object"&&e.each(n.multiple_videos,function(e,n){n.title&&!n.original_title&&(n.original_title=n.title),n.title&&n.original_title&&(n.title=n.original_title.substring(0,t.property("multiple_title_length")))})},extract_properties:function(){var e={};return this.model.get("properties").each(function(t){e[t.get("name")]=t.get("value")}),e},onResizeStop:function(e,t,n){var r;this.property("youtube_status")!=="starting"&&(r=this.$el.find(".upfront-object-content").width(),this.property("player_height",parseInt(r/1.641,10)),this.property("player_width",r,!1))},addVideo:function(e){me.property("youtube_status","ok"),me.property("multiple_source_1",e),Upfront.Events.trigger("entity:settings:activate",me),me.onResizeStop(),setTimeout(function(){me.on_settings_click(),Upfront.Events.trigger("upfront:youtube:added")},50)},on_render:function(){me=this,this.$el.find(".upfront-youtube-button").on("click",function(t){var n=e(this).parents().find("input.upfront-youtube-url").val();n&&(n.match(/youtu\.be/)?(videoMatch=n.match(/^(https?:\/\/)?youtu.be\/([0-9a-zA-Z\-_]{11})/),videoMatch!==null&&videoMatch.length>0?me.addVideo(n):Upfront.Views.Editor.notify(s.validMessage,"error")):(videoMatch=n.match(/^(https?:\/\/(www\.)?)?youtube\.com\/watch\?v=([0-9a-zA-Z\-_]{11}).*/),videoMatch!==null&&videoMatch.length>0?me.addVideo(n):Upfront.Views.Editor.notify(s.validMessage,"error")))}),this.$el.find(".upfront-youtube-url").on("keydown",function(e){e.which==13&&(me.$el.find(".upfront-youtube-button").click(),Upfront.Events.trigger("upfront:element:edit:stop"))})},property:function(e,t,n){return typeof t!="undefined"?(typeof n=="undefined"&&(n=!0),this.model.set_property(e,t,n)):this.model.get_property_value_by_name(e)}}),a=Upfront.Views.Editor.Sidebar.Element.extend({priority:90,render:function(){this.$el.addClass("upfront-icon-element upfront-icon-element-youtube"),this.$el.html("YouTube")},add_element:function(){var e=new o,t=new Upfront.Models.Module({name:"",properties:[{name:"element_id",value:Upfront.Util.get_unique_id("module")},{name:"class",value:"c11 upfront-youtube_module"},{name:"has_settings",value:0},{name:"row",value:Upfront.Util.height_to_row(225)}],objects:[e]});this.add_module(t)}}),f=Upfront.Views.Editor.Field.Text.extend({on_render:function(){var e="upfront-field-wrap upfront-field-wrap-number";this.options.disabled||(e+=" upfront-field-wrap-disabled"),this.el.className=e},get_field_html:function(){var e={type:"number","class":"upfront-field upfront-field-number",id:this.get_field_id(),name:this.get_field_name(),value:this.get_saved_value(),min:this.options.min,max:this.options.max,step:this.options.step};return this.options.disabled&&(e.disabled="disabled")," <input "+this.get_field_attr_html(e)+" /> "+(this.options.suffix?this.options.suffix:"")}}),l=n.extend({className:"uyoutube-settings",tabbed:!1,title:s.general_settings,initialize:function(e){this.options=e;var t=function(){this.settings.invoke("render")},n=this,r=Upfront.Views.Editor.Settings.Item,i=Upfront.Views.Editor.Field;this.model.on("doit",t,this),this.settings=_([new r({className:"optional-field align-center general_settings_item",title:s.apperance_title,fields:[new i.Radios({model:this.model,property:"display_style",layout:"horizontal",label:s.display_style,className:"field-display_style upfront-field-wrap upfront-field-wrap-multiple upfront-field-wrap-radios",values:[{label:s.gallery_label,value:"gallery"},{label:s.list_label,value:"list"}]}),new i.Checkboxes({model:this.model,property:"first_to_thumbnails",className:"first-video-to-thumbnails",default_value:["1"],values:[{label:s.first_to_thumbnails,value:"1"}],change:function(e){this.model.set_property("first_to_thumbnails",e)}}),new i.Checkboxes({model:this.model,property:"multiple_show_title",label:"",values:[{label:"",value:"multiple_show_title"}],change:function(e){this.model.set_property("multiple_show_title",e)}}),new i.Number({model:this.model,property:"multiple_title_length",label:s.title_limit,label_style:"inline",suffix:s.characters_label,min:50,max:100,step:1,default_value:100,change:function(e){this.model.set_property("multiple_title_length",e)}}),new i.Slider({model:this.model,property:"thumbWidth",className:"thumbnails-width",min:100,max:250,step:5,label:s.thumbnail_size,valueTextFilter:function(e){return"("+e+"px x "+n.model.get_property_value_by_name("thumbHeight")+"px)"}}),new i.Hidden({model:this.model,property:"thumbHeight"})]}),new r({model:this.model,title:s.videos_title,className:"multiple_video_section general_settings_item",fields:[new i.Text({model:this.model,label:s.default_video,className:"multiple_sources yt_first_video",property:"multiple_source_1",placeholder:s.video_placeholder})]}),new r({model:this.model,className:"upfront-add-another-wrapper",fields:[new i.Button({className:"upfront-add-another",label:s.add_video,compact:!0,on_click:function(){n.cloneMultipleVideo()}})]}),new Upfront.Views.Editor.Settings.Settings_CSS({model:this.model})]),this.$el.on("change","input[name=display_style]",function(e){n.changeDisplayStyle(e)}).on("change","input[name=thumbWidth]",function(e){n.onThumbChangeSize(e)}),this.on("concealed",this.setFieldEvents,this)},get_label:function(){return s.settings},get_title:function(){return s.settings},render:function(){var e=this;n.prototype.render.call(this),this.listMultipleVideos(),setTimeout(function(){e.toggleMultipleSettings()},50),this.$el.find("[name^=multiple_show_title], [name^=show_title], [name^=show_description]").parent().css({"float":"left","margin-top":"22px"})},toggleMultipleSettings:function(){var e=this.$el.find('[name^="multiple_source_"]').length;e>1?this.$el.find(".field-display_style, .first-video-to-thumbnails, .thumbnails-width").show():this.$el.find(".field-display_style, .first-video-to-thumbnails, .thumbnails-width").hide()},onThumbChangeSize:function(t){var n=this,r=1.8,i=10.4,s=e(t.target).val(),o=Math.round(e(t.target).val()/r),u=Math.round(e(t.target).val()/i);return this.$("input[name=thumbHeight]").val(o),this.property("thumbWidth",s),this.property("thumbOffset",u),this.property("thumbHeight",o,!1),o},changeDisplayStyle:function(t){this.property("display_style",e(t.currentTarget).val(),!1),this.toggleDescriptionEnabled()},toggleDescriptionEnabled:function(){if(this.property("display_style")==="gallery"){this.$el.find("[name=multiple_description_length]").attr("disabled","disabled").parent().addClass("upfront-field-wrap-disabled");return}this.$el.find("[name=multiple_description_length]").removeAttr("disabled").parent().removeClass("upfront-field-wrap-disabled"),this.$el.find("[name=multiple_show_description]").removeAttr("disabled").parent().removeClass("upfront-field-multiple-disabled")},property:function(e,t,n){return typeof t!="undefined"?(typeof n=="undefined"&&(n=!0),this.model.set_property(e,t,n)):this.model.get_property_value_by_name(e)},listMultipleVideos:function(){var t=this.model.get_property_value_by_name("multiple_videos"),n=this;t.length>0&&(n.$el.find(".multiple_video_section").html('<div class="upfront-settings-item-title"><span>'+s.videos_title+"</span></div>"),e(t).each(function(e,t){n.$el.find(".multiple_video_section").append(_.template(i,{cloneId:e+1,videoUrl:t.video_url,l10n:s.template}))}))},cloneMultipleVideo:function(){var e=this.$el.find(".multiple_video_section .upfront-settings-item").length;this.$el.find(".multiple_video_section").append(_.template(i,{cloneId:e+1,videoUrl:"",l10n:s.template})),this.toggleMultipleSettings()}}),c=t.extend({panels:{Behavior:l},events:{"click .upfront-save_settings":"saveSettings","click .upfront-cancel_settings":"cancelSettings","change .multiple_sources":"multipleVideos"},initialize:function(e){this.constructor.__super__.initialize.call(this,e),this.listenTo(Upfront.Events,"upfront:youtube:added",this.multipleVideos)},actions:{single:"upfront_youtube_single"},multipleVideos:function(t){var n=this,r=[],i=0,o=this.$el.find('[name^="multiple_source_"]');o.each(function(t,u){var a=e(u).val(),f=t+1,l,c;if(a){a.match(/youtu\.be/)?(c=a.match(/^(https?:\/\/)?youtu.be\/([0-9a-zA-Z\-_]{11})/),c!==null&&c.length>0?l=c[2]:Upfront.Views.Editor.notify(s.validMessage,"error")):(c=a.match(/^(https?:\/\/(www\.)?)?youtube\.com\/watch\?v=([0-9a-zA-Z\-_]{11}).*/),c!==null&&c.length>0?l=c[3]:Upfront.Views.Editor.notify(s.validMessage,"error"));var h={video_id:a};Upfront.Util.post({action:n.actions.single,data:h}).success(function(e){r.push({order:f,title:e.data.video.title,id:l,video_url:a,thumbnail:e.data.video.thumbnail_url}),i++}).error(function(){Upfront.Util.log("error single video")}).done(function(){i==o.length&&(r.sort(function(e,t){return e.order-t.order}),n.for_view.model.set_property("multiple_videos",r,!1))})}else i++})},title:s.element_settings,get_title:function(){return s.element_settings}});Upfront.Application.LayoutEditor.add_object("Uyoutube",{Model:o,View:u,Element:a,Settings:c,anchor:{is_target:!1},cssSelectors:{".upfront-youtube-container":{label:s.css.global_wrapper_label,info:s.css.global_wrapper_info},".uyoutube-thumbnails":{label:s.css.thumbnails_wrapper_label,info:s.css.thumbnails_wrapper_info},".uyoutube-thumbnail":{label:s.css.thumbnail_label,info:s.css.thumbnail_info}},cssSelectorsId:"UyoutubeModel"}),Upfront.Models.UyoutubeModel=o,Upfront.Views.UyoutubeView=u})}(jQuery),define("text!elements/upfront-code/css/editor.css",[],function(){return"/* Common */\n\n.upfront_code-editor {\n	position: fixed;\n	width: 100%;\n	cursor: auto;\n	right: 0;\n	bottom: 0;\n	z-index: 99;\n	min-height: 200px;\n	display: none\n}\n\n.upfront_code-editor button {\n	background: #2ecc90;\n	color: #fff;\n	position: absolute;\n	bottom: 10px;\n	right: 25px;\n	padding: 5px 10px;\n	border: 0;\n	border-radius: 0;\n	font-size: 14px;\n	z-index: 2;\n}\n.upfront_code-editor button:hover {\n	background: #3ea;\n}\n\n.upfront-icon-button.re-edit:before {\n	/*\n	background-position: -701px -710px;\n	*/\n	display: none;\n}\n.upfront-icon-button.re-edit {\n	background: #515b65; /* Old browsers */\n	background: -moz-linear-gradient(-45deg,  #515b65 47%, #454e56 49%); /* FF3.6+ */\n	background: -webkit-gradient(linear, left top, right bottom, color-stop(47%,#515b65), color-stop(49%,#454e56)); /* Chrome,Safari4+ */\n	background: -webkit-linear-gradient(-45deg,  #515b65 47%,#454e56 49%); /* Chrome10+,Safari5.1+ */\n	background: -o-linear-gradient(-45deg,  #515b65 47%,#454e56 49%); /* Opera 11.10+ */\n	background: -ms-linear-gradient(-45deg,  #515b65 47%,#454e56 49%); /* IE10+ */\n	background: linear-gradient(135deg,  #515b65 47%,#454e56 49%); /* W3C */\n\n	color: #97b8da;\n	font-size: 14px;\n	line-height: 20px;\n	text-align: center;\n}\n\n/* Simple */\n.upfront_code-editor.upfront_code-editor-simple {\n	padding: 10px;\n}\n.upfront_code-editor.upfront_code-editor-simple h3 {\n	margin: 0;\n	text-transform: none;\n}\n\n.upfront_code-editor-simple textarea {\n	min-height: 80px;\n}\n\n/* Complex */\n.upfront_code-editor.upfront_code-editor-complex textarea {\n	color: white;\n	background: #454e58;\n	border: none;\n	outline: none;\n}\n.upfront_code-editor .upfront_code-editor-complex-wrapper {\n	position: absolute;\n	width: 100%;\n	bottom: 0;\n	left: 0;\n	background: #3d5266;\n	min-height: 200px;\n}\n\n.upfront_code-switches {\n	margin: 2px 15px 0 20px;\n	float: left;\n}\n\n\n.upfront_code-switch {\n	color: #cbe5ff;\n	float: left;\n	padding: 2px 10px;\n	margin: 2px 5px 0 0;\n	cursor: pointer;\n}\n\n.upfront_code-switch:hover {\n	color: #dae6f2;\n	background: #2E3D4C;\n}\n\n.upfront_code-switch.active {\n	background: #26333F ;\n}\n\n.upfront_code-jsalert {\n	display: inline-block;\n	margin: 0 5px 0;\n	padding: 0 5px;\n	color: #444d56;\n	display: none;\n	float: left;\n}\n\n.upfront_code-jsalert .upfront-icon-button:before {\n	background-position: -480px -205px;\n	margin-top: 7px;\n}\n\n.upfront_code-editor-section {\n	height: 100%;\n}\n\n.upfront_code-editor.upfront_code-editor-complex .upfront_code-editor-complex-wrapper .upfront_code-editor-section {\n	display: none;\n}\n.upfront_code-editor.upfront_code-editor-complex .upfront_code-editor-complex-wrapper .upfront_code-editor-section.active {\n	display: block;\n}\n.upfront_code-editor.upfront_code-editor-complex .handle.ui-resizable-handle.ui-resizable-s {\n	text-align: center;\n	font-size: 18px;\n	line-height: 7px;\n	bottom: 5px;\n}\n\n.ace_editor.upfront_code-ace {\n	height: 100%;\n	width: 100%;\n}\n\n\n/* Missing defaults */\n.upfront-code_element-module button.embed,\n.upfront-code_element-module button.create,\n.upfront_code-editor-simple button\n{\n	border: 0;\n	border-radius: 2px;\n	padding: 10px 30px;\n	cursor: pointer;\n}\n.upfront_code-editor-simple textarea {\n	width: 98%;\n}\n\n/* Image editable */\n.upfront-code-editable-image {\n	position: absolute;\n	display: none;\n	background: white;\n	z-index: 999999999999999;\n	opacity: 0.75;\n	text-align: center;\n}\n\n/* Color picker */\n.upfront_code-editor .upfront-css-color {\n	display: inline-block;\n}\n.upfront_code-editor .upfront-css-color .upfront-field-wrap, \n.upfront_code-editor .upfront-css-color .upfront-field-wrap label\n{\n	margin: 0;\n}\n.upfront_code-editor .upfront-css-color .upfront-field-wrap .sp-button-container.sp-cf {\n	position: absolute;\n	bottom: -48px;\n	right: -15px;\n}"}),define("text!elements/upfront-code/tpl/editor.html",[],function(){return'<div>\n<!-- Div to select elements inside -->\n\n<div id="editorTpl">\n		<div class="upfront_code-editor-complex-wrapper">\n			<div class="upfront-css-top">\n				<div class="upfront_code-switches">\n					<div class="upfront_code-switch active" data-for="markup">{{ l10n.html }}</div>\n					<div class="upfront_code-switch" data-for="style">{{ l10n.css }}</div>\n					<div class="upfront_code-switch" data-for="script">{{ l10n.js }}</div>\n				</div>\n				<a class="upfront-css-theme_image upfront-css-image" href="#">{{ l10n.link_theme_image }}</a>\n				<a class="upfront-css-media_image upfront-css-image" href="#">{{ l10n.link_image }}</a>\n				<div class="upfront-css-color"></div>\n				<div class="upfront_code-jsalert error javascript"><i class="upfront-icon-button" title="{{ l10n.code_error }}"></i></div>\n				<a class="upfront-css-close" href="#">{{ l10n.close }}</a>\n			</div>\n			<div class="upfront-css-body">\n				<div class="upfront_code-editor-section upfront_code-markup active">\n					<div class="upfront_code-ace" data-type="markup" >{{markup}}</div>\n				</div>\n				<div class="upfront_code-editor-section upfront_code-style">\n					<div class="upfront_code-ace" data-type="style" >{{style}}</div>\n				</div>\n				<div class="upfront_code-editor-section upfront_code-script">\n					<div class="upfront_code-ace" data-type="script" >{{script}}</div>\n				</div>\n				<button>{{ l10n.save }}</button>\n			</div>\n		</div>\n</div>\n\n<div id="embedTpl">\n	<section class="upfront_code-editor-simple">\n		<h3>{{ l10n.paste_your_code }}</h3>\n		<textarea class="upfront_code-markup" data-type="markup">{{ markup }}</textarea>\n		<button>{{ l10n.save }}</button>\n	</section>\n</div>\n\n</div>'}),function($,undefined){define("elements/upfront-code/js/syntax",[],function(){var l10n=Upfront.Settings.l10n.code_element,Checker={_promise:!1,_value:!1,_message:!1,set:function(e){return this._promise=new $.Deferred,this._value=e,this._message=!1,this._promise.promise()},reset:function(){this.set(!1)},test:function(){this._message=!1,this._promise.notify(),this.validate()?this._promise.resolve():this._promise.reject(this._message)},check:function(e){this.set(e);var t=this.validate();return this.reset(),t},validate:function(){return!0}},Checker_Js=_.extend({},Checker,{validate:function(){var ret=!0;try{eval(this._value)}catch(e){this._message=e.message,ret=!1}return ret}}),Checker_Html=_.extend({},Checker,{validate:function(){var e=!0,t=this._value.replace(/\r|\n/g,"\n"),n=$("<div />");return n.html(t),n.html().length!=t.length&&(this._message=l10n.errors.error_markup,e=!1),e}}),Syntax=function(){var e={markup:"html",style:"css",script:"javascript"},t={markup:_.extend(Checker_Html,{}),script:_.extend(Checker_Js,{})},n=function(e){var n=e in t?t[e]:_.extend(Checker,{});return n.reset(),n};return{TYPES:e,checker:n}};return new Syntax})}(jQuery),function(e){define("elements/upfront-code/js/views",["text!elements/upfront-code/tpl/editor.html","elements/upfront-code/js/syntax"],function(t,n){var r=e(t),i=Upfront.Settings.l10n.code_element,s={Start:Backbone.View.extend({events:{"click .embed":"embed_code","click .create":"create_code"},render:function(){this.$el.empty().append('<p class="code-element-choose"><button type="button" class="embed">'+i.intro.embed+"</button>"+"&nbsp;or&nbsp;"+'<button type="button" class="create">'+i.intro.code+"</button></p>")},embed_code:function(){this.model.set_property("code_selection_type","Embed",!0),this.trigger("code:selection:selected")},create_code:function(){this.model.set_property("code_selection_type","Create",!0),this.trigger("code:selection:selected")}}),Create:Upfront.Views.ObjectView.extend({is_editing:!1,MIN_HEIGHT:200,editorTpl:_.template(r.find("#editorTpl").html()),content_editable_selector:".editable",initialize:function(){},get_content_markup:function(){var e=this.fallback("markup"),t=this.fallback("style"),r="(function($){"+this.fallback("script")+"})(jQuery)",i=this.property("element_id"),s="";return t&&_(t.split("}")).each(function(e,t){if(!e.length)return!0;s+="#"+i+" .upfront_code-element "+e+"}"}),s=Upfront.Util.colors.convert_string_ufc_to_color(s),n.checker("script").check(r)||(r=""),'<div class="upfront_code-element clearfix">'+e+"<style>"+s+"</style>"+"<script>"+r+"</script>"+"</div>"},on_render:function(){var t=this;if(!this.property("markup")&&!this.property("style")&&!this.property("script"))setTimeout(function(){t.start_markup_editor()},10);else{var n=this.$el.find(".upfront_code-element "+this.content_editable_selector);n.length&&n.each(function(n){var r=e(this);r.is("img")&&t.bootImageEditable(r,n)}),this.$el.off("dblclick").on("dblclick",function(){t.on_edit()})}},start_markup_editor:function(){if(this.is_editing)return!1;this.is_editing=!0;var t=e("#upfront_code-editor");t.length||(t=e('<section id="upfront_code-editor" class="upfront-ui upfront_code-editor upfront_code-editor-complex"></section>'),e("body").append(t)),this.createEditor(t)},on_edit:function(){if(this.is_editing)return!1;var t=this.$el.find(".upfront_code-element "+this.content_editable_selector);if(t.length)return this.bootContentEditors(t);this.is_editing=!0;var n=e("#upfront_code-editor");n.length||(n=e('<section id="upfront_code-editor" class="upfront-ui upfront_code-editor upfront_code-editor-complex"></section>'),e("body").append(n)),this.createEditor(n)},bootContentEditors:function(t){if(!t||!t.length)return!1;var n=e(this.fallback("markup")),r=this;t.each(function(t){var i=e(this),s=t<=0;if(i.is("img"))return!0;if(i.data("ueditor"))return!0;i.ueditor({autostart:s,placeholder:"",disableLineBreak:!0}).on("start",function(){r.is_editing=!0}).on("stop",function(){r.is_editing=!1}).on("syncAfter",function(){var s=e(n.find(r.content_editable_selector)[t]);if(!s.length)return!1;s.html(i.html()),r.property("markup",e("<div />").append(n).html())})})},bootImageEditable:function(t,n){var r=t.attr("src"),s=this,o=e(this.fallback("markup")),u=this.model.get_property_value_by_name("element_id"),a="upfront-editable-"+u+"-"+n,f=e("#"+a),l;f.length&&f.remove(),e("body").append("<div class='upfront-code-editable-image' id='"+a+"'>"+i.create.change+"</div>"),f=e("#"+a),l=t.add(f),l.on("mouseenter",function(){var e=t.offset(),n=t.width(),r=t.height();f.width(n).height(r).css({top:e.top,left:e.left,"line-height":r+"px"}).show()}).on("mouseleave",function(t){e(this).is("img")||f.hide()}).on("click",function(){f.hide(),Upfront.Media.Manager.open({multiple_selection:!1}).done(function(r,i){if(i&&i.at){var u=i.at(0).get("image").src,a=e(o.find(s.content_editable_selector)[n]);t.attr("src",u),a.attr("src",u),s.property("markup",e("<div />").append(o).html()),Upfront.Events.trigger("upfront:element:edit:stop")}})})},createEditor:function(t){var r=this;t.html(this.editorTpl({markup:this.fallback("markup"),style:this.fallback("style"),script:this.fallback("script"),l10n:i.template})),e("#page").css("padding-bottom","200px"),t.show(),this.resizeHandler=this.resizeHandler||function(){t.width(e(window).width()-e("#sidebar-ui").width()-1)},e(window).on("resize",this.resizeHandler),this.resizeHandler(),this.editors={},this.timers={},t.find(".upfront_code-ace").each(function(){var s=e(this),o=s.html(),u=ace.edit(this),a=s.data("type"),f=n.checker(a);u.getSession().setUseWorker(!1),u.setTheme("ace/theme/monokai"),u.getSession().setMode("ace/mode/"+n.TYPES[a]),u.setShowPrintMargin(!1),"markup"===a&&o&&u.getSession().setValue(o),u.on("change",function(){r.timers[a]&&clearTimeout(r.timers[a]),r.timers[a]=setTimeout(function(){var e=u.getValue();f.set(e).done(function(){t.find(".upfront_code-jsalert").hide(),r.property(a,e,!1)}).fail(function(e){t.find(".upfront_code-jsalert").show().find("i").attr("title",i.errors[a]+" "+e)}),f.test()},1e3)}),u.renderer.scrollBar.width=5,u.renderer.scroller.style.right="5px",r.editors[a]=u}),this.currentEditor=this.editors.markup;var s=t.find(".upfront-css-top"),o=t.find(".upfront-css-body");s.removeClass("ui-resizable-handle").addClass("ui-resizable-handle").removeClass("ui-resizable-n").addClass("ui-resizable-n"),o.height(this.MIN_HEIGHT-s.outerHeight()),t.find(".upfront_code-editor-complex-wrapper").resizable({handles:{n:".upfront-css-top"},resize:function(e,t){o.height(t.size.height-s.outerHeight()),_.each(r.editors,function(e){e.resize()})},minHeight:r.MIN_HEIGHT,delay:100}),t.find(".upfront_code-switch").on("click",function(n){var i=e(n.target),s=i.data("for");t.find(".active").removeClass("active"),i.addClass("active"),t.find(".upfront_code-"+s).addClass("active"),r.editors[s].resize(),r.currentEditor=r.editors[s],s=="script"?t.find("upfront-css-image").hide():t.find("upfront-css-image").show()}),t.find("button").on("click",function(e){_.each(r.editors,function(e,t){var i=e.getValue();n.checker(t).check(i)?r.property(t,i):r.property(t,r.fallback(t))}),r.$("section.upfront_code-element").replaceWith(r.get_content_markup()).end(),r.is_editing=!1,r.destroyEditor()}),t.on("click",".upfront-css-type",function(e){r.hiliteElement(e)}).on("click",".upfront-css-close",function(t){t.preventDefault(),r.destroyEditor(),e("#page").css("padding-bottom",0)}),this.prepareSpectrum(t),t.on("click",".upfront-css-theme_image",_.bind(this.open_theme_image_picker,this)).on("click",".upfront-css-media_image",_.bind(this.open_media_image_picker,this))},prepareSpectrum:function(e){var t=this,n=new Upfront.Views.Editor.Field.Color({blank_alpha:0,default_value:"#ffffff",flat:!0,showAlpha:!0,appendTo:"parent",showPalette:!0,maxSelectionSize:10,preferredFormat:"hex",chooseText:i.create.ok,showInput:!0,allowEmpty:!0,spectrum:{choose:function(e){var n=e.get_is_theme_color()!==!1?e.theme_color:e.alpha<1?e.toRgbString():e.toHexString();t.currentEditor.insert(n),t.currentEditor.focus()}}});n.render(),e.find(".upfront-css-color").empty().append(n.$el)},open_theme_image_picker:function(){return this._open_image_picker({themeImages:!0})},open_media_image_picker:function(){return this._open_image_picker()},_open_image_picker:function(t){t=_.isObject(t)?t:{};var n=this,r=_.extend({multiple_selection:!1,media_type:["images"]},t),i=e("#upfront_code-editor").find(".upfront_code-switch.active").data("for");Upfront.Media.Manager.open(r).done(function(e,t){Upfront.Events.trigger("upfront:element:edit:stop");if(!t)return!1;var r=t.models[0],s=r.get("image")?r.get("image"):t.models[0],o="src"in s?s.src:"get"in s?s.get("original_url"):!1;if(!o)return!1;if("style"===i)n.currentEditor.insert('url("'+o+'")');else if("markup"===i){var u=o.split("."),a=u[u.length-1],f=r.get("selected_size");f&&f!="full"&&(o=o.replace(new RegExp("."+a+"$"),"-"+f+"."+a)),n.currentEditor.insert('<img src="'+o+'">')}n.currentEditor.focus()})},destroyEditor:function(){var t=this;this.editors&&this.editors.length&&(_.each(this.editors,function(e){e.destroy()}),t.editors=!1),this.currentEditor=!1,e("#upfront_code-editor").html("").hide(),e(window).off("resize",this.resizeHandler),this.is_editing=!1},hiliteElement:function(t){t.preventDefault();var n=this.$el.find(".upfront-object-content"),r=n.offset().top-50;e(document).scrollTop(r>0?r:0),this.blink(n,4)},blink:function(e,t){var n=this;e.css("outline","3px solid #3ea"),setTimeout(function(){e.css("outline","none"),t--,t>0&&setTimeout(function(){n.blink(e,t-1)},100)},100)},fallback:function(e){return this.model.get_property_value_by_name(e)||Upfront.data.upfront_code.defaults.fallbacks[e]},property:function(e,t,n){return"undefined"!=typeof t?("undefined"==typeof n&&(n=!0),this.model.set_property(e,t,n)):this.model.get_property_value_by_name(e)},getControlItems:function(){return _([this.createPaddingControl(),this.createControl("edit",i.edit,"start_markup_editor")])}}),Embed:Upfront.Views.ObjectView.extend({is_editing:!1,tpl:_.template(r.find("#embedTpl").html()),get_content_markup:function(){var e=this.fallback("markup"),t=this.model.get_property_value_by_name("element_id");return'<section class="upfront_code-element clearfix">'+e+"</section>"},update_property:function(t){var n=e(this),r=n.attr("data-type"),i=n.val();t.set_property(r,i,!0)},on_render:function(){var e=this;this.model.get_property_value_by_name("markup")||setTimeout(function(){e.on_edit()},10)},on_edit:function(){if(this.is_editing)return!1;this.is_editing=!0;var e=this,t=this.$el.parents(".upfront-module");this.$el.find("section.upfront_code-element").hide().end().append(this.tpl({markup:this.fallback("markup"),l10n:i.template})),this.$el.find("textarea").on("keyup change",function(){e.update_property.apply(this,[e.model])}).on("focus click",function(){t.draggable("disable")}).focus().end().find("button").on("click",function(){e.$el.find("pre code").each(function(){e.update_property.apply(this,[e.model])}),e.$el.find("section.upfront_code-element").replaceWith(e.get_content_markup()).end().find("section.upfront_code-editor-simple").remove(),e.is_editing=!1,e.trigger("code:model:updated")})},fallback:function(e){return this.model.get_property_value_by_name(e)||Upfront.data.upfront_code.defaults.fallbacks[e]},getControlItems:function(){return _([this.createPaddingControl(),this.createControl("edit",i.edit,"on_edit")])}})};return s})}(jQuery),define("elements/upfront-code/js/model",[],function(){var e=Upfront.Models.ObjectModel.extend({init:function(){var e=_.clone(Upfront.data.upfront_code.defaults);e.element_id=Upfront.Util.get_unique_id(e.id_slug+"-object"),this.init_properties(e)}});return e}),define("elements/upfront-code/js/element",["elements/upfront-code/js/model"],function(e){var t=Upfront.Settings.l10n.code_element,n=Upfront.Views.Editor.Sidebar.Element.extend({priority:120,render:function(){this.$el.addClass("upfront-icon-element upfront-icon-element-code"),this.$el.html(t.element_name)},add_element:function(){var t=new e,n=new Upfront.Models.Module({name:"",properties:[{name:"element_id",value:Upfront.Util.get_unique_id("module")},{name:"class",value:"c24 upfront-code_element-module"},{name:"has_settings",value:0},{name:"row",value:Upfront.Util.height_to_row(210)}],objects:[t]});this.add_module(n)}});return n}),function(e,t){define("upfront_code",["text!elements/upfront-code/css/editor.css","elements/upfront-code/js/views","elements/upfront-code/js/model","elements/upfront-code/js/element"],function(t,n,r,i){e("head").append("<style>"+t+"</style>");var s=Upfront.Settings.l10n.code_element,o=Upfront.Views.ObjectView.extend({on_render:function(){var e=this.model.get_property_value_by_name("code_selection_type"),t=this,n=!1;this.$el.empty().append("Loading..."),require([Upfront.Settings.ace_url],function(){e?n=t.render_code_view():n=t.render_initial_view()}),this.parent_module_view.$el.data("dragHandler")||(this.parent_module_view.$el.on("dragstart",this.cover_iframes),this.parent_module_view.$el.data("dragHandler",!0))},cover_iframes:function(e,t){t.helper.append('<div class="upfront-iframe-draggable" style="width:100%;height:100%;position:absolute;top:0;left:0:z-index:1"></div>')},render_initial_view:function(){var e=new n.Start({model:this.model});return e.render(),e.parent_view=this.parent_view,e.parent_module_view=this.parent_module_view,e.on("code:selection:selected",this.render_code_view,this),this.$el.empty().append(e.$el),e},render_code_view:function(){var e=this.model.get_property_value_by_name("code_selection_type");if(!e)return Upfront.Util.log("Missing type"),this.render_initial_view();var t=new n[e]({model:this.model});return t.parent_view=this.parent_view,t.parent_module_view=this.parent_module_view,t.render(),t.on("code:model:updated",this.propagate_model_update,this),this.$el.empty().append(t.$el),this.updateControls(),t.on_edit&&(this.on_settings_click=function(){return t.on_edit()}),t},on_settings_click:function(){},propagate_model_update:function(){Upfront.Events.trigger("upfront:element:edit:stop")}});Upfront.Application.LayoutEditor.add_object("Code",{Model:r,View:o,Element:i}),Upfront.Models.CodeModel=r,Upfront.Views.CodeView=o})}(jQuery),function(e){define("uspacer",["text!upfront/templates/object.html"],function(t){var n=Upfront.Settings.l10n.spacer_element,r=Upfront.Models.ObjectModel.extend({init:function(){this.init_property("type","UspacerModel"),this.init_property("view_class","UspacerView"),this.init_property("element_id",Upfront.Util.get_unique_id("spacer-object")),this.init_property("class","c24 upfront-object-spacer"),this.init_property("has_settings",0),this.init_property("id_slug","uspacer")}}),i=Upfront.Views.ObjectView.extend({className:"upfront-object-view upfront-spacer",display_size_hint:!1,get_content_markup:function(){return""},init:function(){this.listenTo(Upfront.Events,"upfront:wrappers:before_fix_height",this.before_apply_height_from_wrapper),this.listenTo(Upfront.Events,"upfront:wrappers:after_fix_height",this.apply_height_from_wrapper)},render:function(){var e=Upfront.Settings.LayoutEditor.Grid,n={},r=this,i=e.column_padding,s,o,u,a,f,l;this.$el.addClass("upfront-object-view"),this.model.get("properties").each(function(e){n[e.get("name")]=e.get("value")}),l="default_hide"in n?n.default_hide:0,f="hide"in n?n.hide:l,n.preset=n.preset||"",s=_.extend(this.model.toJSON(),{properties:n,buttons:"",content:"",height:0,hide:f,extra_buttons:""}),o=_.template(t,s),Upfront.Events.trigger("entity:object:before_render",this,this.model),this.parent_module_view&&!this.object_group_view&&(this.stopListening(this._previous_parent_module_view||this.parent_module_view,"entity:resize_start"),this.listenTo(this.parent_module_view,"entity:resize_start",this.on_element_resize_start),this.stopListening(this._previous_parent_module_view||this.parent_module_view,"entity:resizing"),this.listenTo(this.parent_module_view,"entity:resizing",this.on_element_resizing),this.stopListening(this._previous_parent_module_view||this.parent_module_view,"entity:resize_stop"),this.listenTo(this.parent_module_view,"entity:resize_stop",this.on_element_resize),this.stopListening(this._previous_parent_module_view||this.parent_module_view,"entity:drop"),this.listenTo(this.parent_module_view,"entity:drop",this.on_element_drop),u=Upfront.Behaviors.GridEditor.get_class_num(this.parent_module_view.model.get_property_value_by_name("class"),e.class),this.parent_module_view.$el.find("> .upfront-module").addClass("upfront-module-spacer"),this.parent_module_view.model.add_class("upfront-module-spacer")),this.$el.html(o),a=Upfront.Behaviors.GridEditor.get_class_num(n.class,e.class),a=a>u?u:a,$object=this.$el.find(".upfront-editable_entity:first"),$object.data("default_col",a),$object.data("current_col",a),Upfront.Events.trigger("entity:object:after_render",this,this.model)},getControlItems:function(){return _([])},createControls:function(){return!1},apply_paddings:function(){return!1},_is_applying:function(e){return this.parent_view&&this.parent_view==e?!0:this.parent_module_view&&this.parent_module_view.parent_view&&this.parent_module_view.parent_view==e?!0:this.$el.is(":visible")?!0:!1},before_apply_height_from_wrapper:function(e){if(!this._is_applying(e))return;var t=this.$el.closest(".upfront-wrapper");t.addClass("upfront-wrapper-spacer"),this.$el.find(">.upfront-object").css("min-height","")},apply_height_from_wrapper:function(e){if(!this._is_applying(e))return;var t=this.$el.closest(".upfront-wrapper");this.$el.find(">.upfront-object").css("min-height",t.height())},activate:function(){typeof Upfront.data.prevEntity!="undefined"&&Upfront.data.prevEntity!==!1&&Upfront.data.prevEntity.deactivate(),e(".upfront-region-module-activated").removeClass(".upfront-region-module-activated")},deactivate:function(){return!1},on_element_edit_start:function(e,t){return},on_element_edit_stop:function(e,t,n){return},on_content_style_edit_start:function(){return},on_content_style_edit_stop:function(){return}});Upfront.Models.UspacerModel=r,Upfront.Views.UspacerView=i})}(jQuery),function(e){define("application",["models","views","editor_views","behaviors","upfront-data","jquery-df","jquery-simulate","scripts/backbone-query-parameters/backbone-query-parameters","responsive","findandreplace"],function(t,n,r,i,s,o){_.extend(Upfront,s),Upfront.Events.trigger("data:ready"),_.extend(Upfront,t),_.extend(Upfront,n),_.extend(Upfront.Views,r),_.extend(Upfront,i);var u=Backbone.Router.extend({start:function(){Upfront.Util.log("Implement runner method")},go:function(e){return Upfront.Events.trigger("subapplication:navigate:"+e),this.navigate(e)},get_layout_data:function(){var e=Upfront.Util.model_to_json(this.layout);return e.layout=_upfront_post_data.layout,e}}),a=u.extend({save_layout_as:function(){Upfront.Behaviors.LayoutEditor.save_dialog(this._save_layout,this)},save_layout:function(){this._save_layout(this.layout.get("current_layout"))},publish_layout:function(){this._save_layout(this.layout.get("current_layout"),!0)},_save_layout:function(e,t){var n=Upfront.Util.model_to_json(this.layout),r=t===!0?_upfront_storage_key:_upfront_save_storage_key;n.layout=_upfront_post_data.layout,n.preferred_layout=e,n=JSON.stringify(n,undefined,2),Upfront.Events.trigger("command:layout:save_start");if(Upfront.Settings.Application.NO_SAVE)return Upfront.Events.trigger("command:layout:save_success"),!1;n=Upfront.Util.colors.update_colors_to_match_ufc(n),Upfront.Util.post({action:Upfront.Application.actions.save,data:n,storage_key:r}).success(function(){Upfront.Util.log("layout saved"),Upfront.Events.trigger("command:layout:save_success")}).error(function(){Upfront.Util.log("error saving layout"),Upfront.Events.trigger("command:layout:save_error")})},preview_layout:function(){var e=!1,t=!1;t=Upfront.PreviewUpdate.preview_url();if(!t)return Upfront.Views.Editor.notify(Upfront.Settings.l10n.global.application.preview_not_ready),!1;e=window.open(t,"_blank")},list_revisions:function(){var t={action:"upfront_list_revisions",cascade:_upfront_post_data.layout,current_url:window.location.href};Upfront.Util.post(t).done(function(t){Upfront.Popup.open(function(){var n=_.template("<h3>"+Upfront.Settings.l10n.global.application.revisions+"</h3><ul>{[ _.each(data, function (item) { ]}"+'<li><a target="_blank" href="{{item.preview_url}}">{{item.date_created}}</a><br /><small>'+Upfront.Settings.l10n.global.application.created_by+" {{item.created_by.display_name}}</small></li>"+"{[ }); ]}</ul>");e(this).html(n(t))})}).error(function(e){console.log(e)})},destroy_editor:function(){return this.navigate(""),window.location.reload(),!1},set_up_editor_interface:function(){if(!this.layout)return!1;var e=this,t=function(){var t={},n=Upfront.Application.sidebar.get_panel("elements"),r=function(e){return e.priority};_(e.Objects).each(function(n,r){_.each(["Element","DataElement","PluginElement"],function(i){if(!_.isObject(n[i]))return;var s=new n[i]({model:e.layout});s.element_type=r,_.isArray(t[i])||(t[i]=[]),t[i].push(s)}),n.Command&&e.sidebar.get_commands("control").commands.push(new n.Command({model:e.layout}))}),n.get_section("layout").elements=_(_.sortBy(t.Element,r)),n.get_section("data").elements=_(_.sortBy(t.DataElement,r)),n.get_section("plugins").elements=_(_.sortBy(t.PluginElement,r)),Upfront.Application.sidebar.render()};Upfront.Events.trigger("application:setup:editor_interface"),t()},add_object:function(e,t){this.Objects[e]=_.extend({},Upfront.Mixins.Anchorable,t)},remove_object:function(e){delete this.Objects[e]},set_up_event_plumbing_before_render:function(){this.listenTo(Upfront.Events,"entity:module:after_render",Upfront.Behaviors.GridEditor.create_resizable),this.listenTo(Upfront.Events,"entity:module:after_render",Upfront.Behaviors.GridEditor.create_draggable),this.listenTo(Upfront.Events,"entity:module_group:after_render",Upfront.Behaviors.GridEditor.create_resizable),this.listenTo(Upfront.Events,"entity:module_group:after_render",Upfront.Behaviors.GridEditor.create_draggable),this.listenTo(Upfront.Events,"entity:wrapper:after_render",Upfront.Behaviors.GridEditor.create_wrapper_resizable),this.listenTo(Upfront.Events,"entity:object:after_render",Upfront.Behaviors.GridEditor.create_resizable),this.listenTo(Upfront.Events,"entity:object:after_render",Upfront.Behaviors.GridEditor.create_draggable),this.listenTo(Upfront.Events,"entity:region:after_render",Upfront.Behaviors.GridEditor.create_region_resizable),this.listenTo(Upfront.Events,"entity:region:after_render",Upfront.Behaviors.GridEditor.create_region_draggable),this.listenTo(Upfront.Events,"entity:region_container:after_render",Upfront.Behaviors.LayoutEditor.create_mergeable),this.listenTo(Upfront.Events,"entity:region_container:after_render",Upfront.Behaviors.GridEditor.create_region_container_resizable),this.listenTo(Upfront.Events,"entity:region_sub_container:after_render",Upfront.Behaviors.GridEditor.create_region_container_resizable),Upfront.Behaviors.GridEditor.grid||Upfront.Behaviors.GridEditor.init(),this.listenTo(Upfront.Events,"layout:after_render",Upfront.Behaviors.GridEditor.init)},set_up_event_plumbing_after_render:function(){this.listenTo(Upfront.Events,"command:exit",this.destroy_editor),this.listenTo(Upfront.Events,"command:layout:save",this.save_layout),this.listenTo(Upfront.Events,"command:layout:save_as",this.save_layout_as),this.listenTo(Upfront.Events,"command:layout:preview",this.preview_layout),this.listenTo(Upfront.Events,"command:layout:publish",this.publish_layout),this.listenTo(Upfront.Events,"command:region:edit_toggle",Upfront.Behaviors.GridEditor.toggle_region_resizable),this.listenTo(Upfront.Events,"command:region:fixed_edit_toggle",Upfront.Behaviors.GridEditor.toggle_region_resizable),this.listenTo(Upfront.Events,"command:region:fixed_edit_toggle",Upfront.Behaviors.GridEditor.toggle_region_draggable),this.listenTo(Upfront.Events,"command:selection:remove",Upfront.Behaviors.LayoutEditor.remove_selections),this.listenTo(Upfront.Events,"entity:activated",Upfront.Behaviors.LayoutEditor.create_undo),this.listenTo(Upfront.Events,"entity:resize_start",Upfront.Behaviors.LayoutEditor.create_undo),this.listenTo(Upfront.Events,"entity:drag_start",Upfront.Behaviors.LayoutEditor.create_undo),this.listenTo(Upfront.Events,"entity:removed:before",Upfront.Behaviors.LayoutEditor.create_undo),this.listenTo(Upfront.Events,"entity:region:activated",Upfront.Behaviors.LayoutEditor.create_undo),this.listenTo(Upfront.Events,"command:undo",Upfront.Behaviors.LayoutEditor.apply_history_change),this.listenTo(Upfront.Events,"command:redo",Upfront.Behaviors.LayoutEditor.apply_history_change),this.listenTo(Upfront.Events,"entity:settings:activate",this.create_settings),this.listenTo(Upfront.Events,"entity:settings:deactivate",this.destroy_settings),this.listenTo(Upfront.Events,"entity:removed:after",this.destroy_settings),this.listenTo(Upfront.Events,"entity:contextmenu:activate",this.create_menu),this.listenTo(Upfront.Events,"entity:contextmenu:deactivate",this.destroy_menu);var t=!1,n=function(){t=new Upfront.Views.Editor.Loading({loading:Upfront.Settings.l10n.global.application.saving,done:Upfront.Settings.l10n.global.application.saving_success,fixed:!0}),t.render(),e("body").append(t.$el)},r=function(e){e||t.update_loading_text(Upfront.Settings.l10n.global.application.saving_error),t.on_finish(function(){Upfront.Events.trigger("command:layout:save_done",e)}),e?t.done():t.done(!1,Upfront.Settings.l10n.global.application.saving_error)};this.listenTo(Upfront.Events,"command:layout:save_start",n),this.listenTo(Upfront.Events,"command:layout:save_success",function(){r(!0)}),this.listenTo(Upfront.Events,"command:layout:save_error",function(){r(!1)}),this.listenTo(Upfront.Events,"command:themefontsmanager:open",Upfront.Behaviors.LayoutEditor.open_theme_fonts_manager),this.listenTo(Upfront.Events,"command:layout:edit_global_regions",Upfront.Behaviors.LayoutEditor.open_global_region_manager),this.listenTo(Upfront.Events,"command:layout:save_success",Upfront.Behaviors.LayoutEditor.clean_region_css),this.listenTo(Upfront.Events,"command:layout:save_success",Upfront.Behaviors.LayoutEditor.clean_global_regions)},create_properties:function(t,n){this.property_view=new Upfront.Views.Editor.Properties({model:n,el:e(Upfront.Settings.LayoutEditor.Selectors.properties)}),this.property_view.render()},destroy_properties:function(){e(Upfront.Settings.LayoutEditor.Selectors.properties).html("")},create_menu:function(t){var n=_(this.Objects).reduce(function(e,n){return t instanceof n.View?n:e},!1),n=n&&n.ContextMenu?n:Upfront.Views.ContextMenu;if(n.ContextMenu===!1)return!1;typeof n.ContextMenu=="undefined"&&(n.ContextMenu=Upfront.Views.ContextMenu);var r=new n.ContextMenu({model:t.model,for_view:t,el:e(Upfront.Settings.LayoutEditor.Selectors.contextmenu)});r.for_view=t,r.render(),this.context_menu_view=r},destroy_menu:function(){if(!this.context_menu_view)return!1;e(Upfront.Settings.LayoutEditor.Selectors.contextmenu).html("").hide(),this.context_menu_view=!1},create_settings:function(t,n){var r,i;if(this.settings_view)return this.destroy_settings();if(!parseInt(t.model.get_property_value_by_name("has_settings"),10))return!1;n||(r=_(this.Objects).reduce(function(e,n){return t instanceof n.View?n:e},!1),r=r&&r.Settings?r:Upfront.Views.Editor.Settings,n=r.Settings),i=new n({model:t.model,anchor:r?r.anchor:!1,el:e(Upfront.Settings.LayoutEditor.Selectors.settings)}),i.for_view=t,i.render(),this.settings_view=i,i.trigger("rendered")},destroy_settings:function(){if(!this.settings_view)return!1;this.settings_view.trigger("closed"),this.settings_view.remove(),this.settings_view=!1,e("body").append('<div id="settings"/>')},create_post:function(e){Upfront.Settings.LayoutEditor.newpostType=e,this.load_layout({item:"single-"+e,type:"single"})},openLightboxRegion:function(e){var t=Upfront.Application.layout.get("regions"),n=t.get_by_name(e);if(!n)return;_.each(t.models,function(e){e.attributes.sub=="lightbox"&&Upfront.data.region_views[e.cid].hide()}),Upfront.data.region_views[n.cid].show()},getLightboxSafeName:function(e){var t=this.layout&&this.layout.get?this.layout.get("regions"):Upfront.Application.current_subapplication.layout.get("regions"),n=t?t.get_by_name("lightbox"):!1;return n||(n=new Upfront.Models.Region({name:"lightbox",container:"lightbox",title:"lightbox Region"}),n.add_to(t,t.length-1)),"ltb-"+e.toLowerCase().replace(/\s/g,"-")+(t.length+1)},createLightboxRegion:function(e){var t=this.layout&&this.layout.get?this.layout.get("regions"):Upfront.Application.current_subapplication.layout.get("regions"),n=this.getLightboxSafeName(e),r=new Upfront.Models.Region(_.extend({},Upfront.data.region_default_args,{name:n,container:"lightbox",title:e,type:"lightbox",sub:"lightbox"}));return r.init_properties({col:10,height:400,click_out_close:"yes",show_close:"yes",overlay_color:"rgba(38,58,77,0.75)",lightbox_color:"rgba(248,254,255,0.9)"}),this.listenToOnce(Upfront.Events,"entity:region:added",this.openNewRegion),r.add_to(t,t.length-1,{sub:"lightbox"}),n},openNewRegion:function(e){e.show&&(e.show(),e.on_settings_click())}}),f=new(a.extend({Objects:{},boot:function(){},start:function(){this.stop(),this.set_up_event_plumbing_before_render(),this.set_up_editor_interface(),this.set_up_event_plumbing_after_render(),e("html").removeClass("upfront-edit-content upfront-edit-theme upfront-edit-postlayout upfront-edit-responsive").addClass("upfront-edit-layout")},stop:function(){return this.stopListening(Upfront.Events)}})),l=new(a.extend({initialize:function(){this.listenTo(Upfront.Events,"post:layout:edit",this.togglePostLayoutEditorMode)},boot:function(){Upfront.Util.log("Preparing postlayout mode for execution"),this.started=0},start:function(){if(this.started)return;this.started=1,this.Objects=Upfront.Application.LayoutEditor.Objects,Upfront.Util.log("Starting the postlayout edit mode"),this.set_up_event_plumbing_before_render(),this.prepareSidebar(),this.listenTo(Upfront.Events,"post:layout:cancel",this.cancelEdition),this.listenTo(Upfront.Events,"post:layout:save",this.saveEdition),this.listenTo(Upfront.Events,"post:edit:templatepart",this.editTemplatePart),e("html").removeClass("upfront-edit-layout upfront-edit-theme upfront-edit-content").addClass("upfront-edit-postlayout"),this.prepareViews(),this.set_up_event_plumbing_after_render()},stop:function(){var e=v.sidebar;this.restoreSidebar(),this.restoreViews(),this.started=0,this.stopListening(Upfront.Events),this.listenTo(Upfront.Events,"post:layout:edit",this.togglePostLayoutEditorMode)},cancelEdition:function(){if(Upfront.Application.is_post_content_style())return;var t=this;typeof this.postwrapperclone!="undefined"&&this.postwrapperclone&&(this.postWrapper.find(".post_editor_container").css("display",""),this.postwrapperclone.find(".post_editor_container").each(function(){t.postWrapper.find(".upfront-object-content").append(e(this))}),this.postwrapperclone.remove());if(v.current_subapplication!=l)return;v.start(v.mode.last)},saveEdition:function(){if(v.current_subapplication!=l)return;var e=this,t=new Upfront.Views.Editor.SaveDialog({question:Upfront.Settings.l10n.global.application.save_layout_pop,thisPostButton:Upfront.Settings.l10n.global.application.this_post_only,allPostsButton:Upfront.Settings.l10n.global.application.all_posts_of_this_type});t.render().on("closed",function(){t.remove(),t=!1}),t.on("save",function(n){var r=e.postView.property("type"),i;elementSlug=r=="ThisPostModel"?"single":"archive",loading=new Upfront.Views.Editor.Loading({loading:Upfront.Settings.l10n.global.application.saving_post_layout,done:Upfront.Settings.l10n.global.application.thank_you_for_waiting,fixed:!1}),elementSlug=="single"?i=n=="this-post"?e.postView.postId:e.postView.editor.post.get("post_type"):i=n=="this-post"?e.postView.property("element_id").replace("uposts-object-",""):e.postView.property("post_type"),console.log(n);var s={postLayout:e.exportPostLayout(),partOptions:e.postView.partOptions||{}};loading.render(),t.$("#upfront-save-dialog").append(loading.$el),Upfront.Util.post({action:"upfront_save_postlayout",layoutData:s,cascade:elementSlug+"-"+i}).done(function(n){loading.done(),console.log(n),t.close(),e.postView.postLayout=s.postLayout,e.postView.render(),v.start(v.mode.last)})})},exportPostLayout:function(){var e=this,t=Upfront.Util.model_to_json(this.regionView.model),n=t.wrappers,r=t.modules,i={},s=[];return _.each(r,function(t){var n=e.propertiesToObject(t.properties),r={classes:n["class"]},o=i[n.wrapper_id];_.each(t.objects,function(t){r.slug=e.propertiesToObject(t.properties).postPart}),o?o.objects.push(r):(o={objects:[r]},s.push(o),i[n.wrapper_id]=o)}),_.each(n,function(t){var n=e.propertiesToObject(t.properties),r=i[n.wrapper_id];r&&(r.classes=n["class"])}),s},importPostLayout:function(e){var t=this,n=this.getPostRegionData(),r=this.postView.property("partOptions");return e?(_.each(e,function(e){var i=Upfront.Util.get_unique_id("wrapper"),s=new Upfront.Models.Wrapper({name:"",properties:[{name:"wrapper_id",value:i},{name:"class",value:e.classes}]});n.get("wrappers").add(s),_.each(e.objects,function(e){var s={type:"PostPart_"+e.slug+"Model",view_class:"PostPart_"+e.slug+"View",has_settings:1,id_slug:"PostPart_"+e.slug,postPart:e.slug};r[e.slug]&&_.extend(s,r[e.slug]);var o=new Upfront.Content.PostPart({properties:s,options:e.options}),u=new Upfront.Models.Module({name:"",properties:[{name:"element_id",value:Upfront.Util.get_unique_id("module")},{name:"class",value:e.classes},{name:"has_settings",value:0},{name:"row",value:1},{name:"wrapper_id",value:i}],objects:[o]});o.postModel=t.postView.model,n.get("modules").add(u)})}),n):n},editTemplatePart:function(e,t){this.templateEditor&&this.templateEditor.close(),this.destroy_settings(),this.templateEditor.open({tpl:e,postPart:t}),Upfront.Events.trigger("post:parttemplates:edit")},togglePostLayoutEditorMode:function(e,t){v.current_subapplication!=l?(this.postView=e,this.elementType=t,this.partMarkup=e.editor.parts.replacements,v.start(v.MODE.POST)):v.start(v.mode.last)},prepareViews:function(){var t=this,n=this.postView,r=this.importPostLayout(n.postLayout),i=v.layout.get("regions");this.templateEditor=new Upfront.Content.TemplateEditor,this.listenTo(this.templateEditor,"save",function(e,n){t.savePartTemplate(e,n)}),this.listenTo(this.templateEditor,"cancel",function(){t.templateEditor.close()}),this.listenToOnce(Upfront.Events,"entity:region:added",this.preparePostRegion),r.add_to(i,i.length-1),e(".upfront-region-postlayouteditor").addClass(n.editor.$el.attr("class"))},destroy_settings:function(){if(!this.settings_view)return!1;this.settings_view.trigger("closed"),this.settings_view.remove(),this.settings_view=!1,e("body").append('<div id="settings"/>')},savePartTemplate:function(e,t){var n=this,r=new Upfront.Views.Editor.SaveDialog({question:Upfront.Settings.l10n.global.application.save_part_pop,thisPostButton:Upfront.Settings.l10n.global.application.this_element_only,allPostsButton:Upfront.Settings.l10n.global.application.all_elements}),i=n.postView.editor.post.get("post_type"),s=n.postView.property("type");Upfront.Util.post({action:"upfront_save_postparttemplate",part:t,tpl:e,type:s,id:i}).done(function(r){n.postView.partTemplates[t]=e,n.postView.model.trigger("template:"+t),n.templateEditor.close(),Upfront.Views.Editor.notify(Upfront.Settings.l10n.global.application.saved_template.replace(/%s/,t))});return},getPostRegionData:function(e){var t=this.postView.parent_module_view.region,n=this.postView.get_element_size(),r={title:Upfront.Settings.l10n.global.application.post_layout_editor,name:"postLayoutEditor",container:"postLayoutEditor",allow_sidebar:!1,type:"clip",modules:[],position:t.get("position")-1,properties:[{name:"col",value:n.col}],scope:"local"},i=new Upfront.Models.Region(r);return i},preparePostRegion:function(t){var n=t.model.get_property_value_by_name("col"),r=Upfront.Settings.LayoutEditor.Grid;this.regionView=t,this.regionContainerView=t.parent_view.get_container_view(t.model),this.regionContainer=this.regionContainerView.$el.detach(),this.postWrapper=this.postView.$el.closest(".upfront-wrapper"),this.elementType=="archive"?(this.postView.editor.$el.hide(),this.postWrapper.before(this.regionContainer)):this.postWrapper.hide().after(this.regionContainer),this.regionContainerView.$layout.removeClass(r.class+this.regionContainerView.max_col),this.regionContainerView.max_col=n,this.regionContainerView.$layout.addClass(r.class+n),this.regionView.update(),this.postRegionClass||(this.postRegionClass=this.regionContainer.attr("class")),this.regionContainer.attr("class",this.postRegionClass+" "+this.postView.parent_module_view.model.get_property_value_by_name("class")),e("#page").find(".upfront-region").not(".upfront-region-postlayouteditor").not(".upfront-region-shadow").addClass("upfront-region-locked").find(".upfront-module").each(function(){e(this).is(".ui-draggable")&&e(this).draggable("disable"),e(this).is(".ui-resizable")&&e(this).resizable("disable")}),e("#page").find(".upfront-region-postlayouteditor").find(".upfront-module").each(function(){e(this).is(".ui-draggable")&&e(this).draggable("enable"),e(this).is(".ui-resizable")&&e(this).resizable("enable")})},restoreViews:function(){this.regionContainer.remove(),this.regionContainer=!1,typeof this.postwrapperclone!="undefined"&&this.postwrapperclone&&this.postwrapperclone.remove(),this.elementType=="archive"?this.postView.editor.$el.show():this.postWrapper.show(),this.postWrapper=!1,this.regionView.remove();var t=v.layout.get("regions").filter(function(e){return e.get("name")!="postLayoutEditor"});v.layout.get("regions").reset(t,{silent:!0}),this.regionView=!1,this.postView=!1,e("#page").find(".upfront-region-locked").removeClass("upfront-region-locked").find(".upfront-module").each(function(){e(this).is(".ui-draggable")&&e(this).draggable("enable"),e(this).is(".ui-resizable")&&e(this).resizable("enable")})},prepareSidebar:function(){var e={},t=v.sidebar;this.sidebarCommands=t.sidebar_commands.control.commands,t.get_panel("posts").loadElements().active=!0,t.get_panel("elements").active=!1,this.sidebarCommands.each(function(t){var n=t.$el;n.hasClass("command-undo")?e.undo=t:n.hasClass("command-redo")?e.redo=t:n.hasClass("command-grid")&&(e.grid=t)}),t.sidebar_commands.control._commands=[e.undo,e.redo,e.grid,new Upfront.Views.Editor.Command_CancelPostLayout(this.sidebarCommands.model)],Upfront.Application.is_editor()&&t.sidebar_commands.control._commands.push(new Upfront.Views.Editor.Command_SavePostLayout(this.sidebarCommands.model)),t.sidebar_commands.control.commands=_(t.sidebar_commands.control._commands),Upfront.Events.trigger("post:layout:sidebarcommands"),t.sidebar_commands.primary.$el.hide(),t.sidebar_profile.$el.hide(),this.listenToOnce(Upfront.Events,"sidebar:rendered",function(){t.get_panel("posts").$("h3.sidebar-panel-title").click()})},restoreSidebar:function(){var e=v.sidebar;e.sidebar_commands.primary.$el.show(),e.sidebar_profile.$el.show(),e.sidebar_commands.control.commands=this.sidebarCommands,this.sidebarCommands=!1,e.get_panel("posts").unloadElements().active=!1,e.get_panel("elements").active=!0},create_settings:function(t){if(this.settings_view)return this.destroy_settings();if(!parseInt(t.model.get_property_value_by_name("has_settings"),10))return!1;var n="PostPart_"+t.postPart,r=this.Objects[n]?this.Objects[n]:Upfront.Views.Editor.Settings,i=new r.Settings({model:t.model,anchor:r.anchor,el:e(Upfront.Settings.LayoutEditor.Selectors.settings)});i.for_view=t,i.render(),this.settings_view=i,i.trigger("rendered")},objectToProperties:function(e){var t=[];return _.each(e,function(e,n){t.push({name:n,value:e})}),t},propertiesToObject:function(e){var t={};return _.each(e,function(e){t[e.name]=e.value}),t}})),c=new(u.extend({initialize:function(){this.listenTo(Upfront.Events,"post:content:edit:start",this.startContentEditorMode),this.listenTo(Upfront.Events,"post:content:edit:stop",this.stopContentEditorMode)},boot:function(){Upfront.Util.log("Preparing post content mode for execution"),Upfront.Events.trigger("upfront:post:edit:booted",this)},start:function(){Upfront.Util.log("Starting post the content edit mode")},stop:function(){var t=e("#page");Upfront.Util.log("Stopping post the content edit mode"),t.find(".upfront-module").each(function(){e(this).is(".ui-draggable")&&e(this).draggable("enable"),e(this).is(".ui-resizable")&&e(this).resizable("enable")}),Upfront.Events.trigger("upfront:element:edit:stop"),t.find(".upfront-region-edit-trigger").show(),this.contentEditor=!1},startContentEditorMode:function(t){if(v.current_subapplication==c)return;this.contentEditor=t;var n=e("#page");v.set_current(v.MODE.POSTCONTENT),n.find(".upfront-module").each(function(){e(this).is(".ui-draggable")&&e(this).draggable("disable"),e(this).is(".ui-resizable")&&e(this).resizable("disable")}),Upfront.Events.trigger("upfront:element:edit:start","write",t.post),n.find(".upfront-region-edit-trigger").hide(),Upfront.Events.on("content:insertcount:updated",this.updateInsertCount)},stopContentEditorMode:function(){Upfront.Events.off("content:insertcount:updated",this.updateInsertCount),v.current_subapplication==c&&v.start(v.mode.last)},updateInsertCount:function(){console.log("update insertcount"),Upfront.Util.post({action:"upfront_update_insertcount"})}})),h=new(u.extend({boot:function(){Upfront.Util.log("Preparing content mode for execution")},start:function(){Upfront.Util.log("Starting the content edit mode"),e("html").removeClass("upfront-edit-layout upfront-edit-theme upfront-edit-postlayout upfront-edit-responsive").addClass("upfront-edit-content")},stop:function(){Upfront.Util.log("Stopping the content edit mode")}})),p=new(a.extend({boot:function(){},start:function(){this.stop(),this.set_up_event_plumbing_before_render(),this.Objects=Upfront.Application.LayoutEditor.Objects,this.set_up_editor_interface(),this.set_up_event_plumbing_after_render(),e("html").removeClass("upfront-edit-layout upfront-edit-content upfront-edit-postlayout upfront-edit-responsive").addClass("upfront-edit-theme"),Upfront.themeExporter.currentTheme==="upfront"&&this.listenToOnce(Upfront.Events,"layout:render",function(){Upfront.Events.trigger("command:layout:edit_structure")}),this.listenToOnce(Upfront.Events,"layout:render",Upfront.Behaviors.GridEditor.apply_grid),this.listenToOnce(Upfront.Events,"command:layout:save_done",Upfront.Behaviors.LayoutEditor.first_save_dialog),this.listenTo(Upfront.Events,"command:layout:create",Upfront.Behaviors.LayoutEditor.create_layout_dialog),this.listenTo(Upfront.Events,"command:themefontsmanager:open",Upfront.Behaviors.LayoutEditor.open_theme_fonts_manager),this.listenTo(Upfront.Events,"command:layout:browse",Upfront.Behaviors.LayoutEditor.browse_layout_dialog),this.listenTo(Upfront.Events,"command:layout:edit_structure",Upfront.Behaviors.GridEditor.edit_structure),this.listenTo(Upfront.Events,"command:layout:export_theme",Upfront.Behaviors.LayoutEditor.export_dialog),this.listenTo(Upfront.Events,"builder:load_theme",Upfront.Behaviors.LayoutEditor.load_theme)},stop:function(){return this.stopListening(Upfront.Events)}})),d=new(a.extend({Objects:{},boot:function(){},start:function(){this.stop(),this.Objects=Upfront.Application.LayoutEditor.Objects,this.set_up_event_plumbing_before_render(),Upfront.Application.sidebar.render(),this.topbar=new Upfront.Views.Editor.Topbar.Topbar,this.topbar.start(),this.set_up_event_plumbing_after_render(),this.listenTo(Upfront.Events,"command:layout:browse",Upfront.Behaviors.LayoutEditor.browse_layout_dialog),e("html").removeClass("upfront-edit-content upfront-edit-theme upfront-edit-postlayout upfront-edit-layout").addClass("upfront-edit-responsive")},stop:function(){return this.topbar&&this.topbar.stop(),this.stopListening(Upfront.Events)}})),v=new(Backbone.Router.extend({LayoutEditor:f,ContentEditor:h,ThemeEditor:p,PostLayoutEditor:l,PostContentEditor:c,ResponsiveEditor:d,actions:{save:"upfront_save_layout",load:"upfront_load_layout"},routes:{done:"destroy_editor","new-layout":"dispatch_layout_creation","create_new(/:postType)":"create_new_entry","*otherRoutes":"fetchLayout"},MODE:{CONTENT:"content",LAYOUT:"layout",THEME:"theme",POST:"post layout",POSTCONTENT:"post content",RESPONSIVE:"responsive"},mode:{last:!1,current:!1},set_post_content_style:function(e){return e=typeof e=="undefined"?!0:e,this.MODE.POSTCONTENT_STYLE=e,!0},is_post_content_style:function(){return this.MODE.POSTCONTENT_STYLE===this.mode.current},is_builder:function(){return this.mode.current===this.MODE.THEME||this.mode.last===this.MODE.THEME},is_editor:function(){return!this.is_builder()},urlCache:{},current_subapplication:!1,sidebar:!1,layout:!1,layout_ready:!1,responsiveMode:!1,boot:function(){this.MODE=Upfront.Settings.Application.MODE;var t=this;e("body .upfront-edit_layout a").addClass("active"),e("body").off("click",".upfront-edit_layout").on("click",".upfront-edit_layout",function(){return t.start(),!1}),e(document).trigger("upfront-load")},start:function(t){Upfront.Util.post({action:"upfront_load_styles",layout:{item:"archive-home",type:"archive"},base_only:!0}).success(function(t){e("#upfront-main-css").after('<style id="upfront-main-base-css">'+t.data.styles+"</style>"),e("#upfront-main-css").remove()}),t||(t=this.MODE.DEFAULT);if(this.mode.current==t)return!1;e("#wpadminbar").hide(),e("html").attr("style","margin-top: 0 !important;"),this.set_current(t),(!this.current_subapplication||!this.current_subapplication.start)&&Upfront.Util.log("Can't boot invalid subapplication"),Upfront.Events.trigger("application:mode:before_switch"),this.listenToResponsiveModes();if(!!this.layout){var n=this.layout.get("regions"),r=n.get_by_name("shadow");return n&&r&&n.remove(r),this.create_sidebar(),this.current_subapplication.layout=this.layout,this.current_subapplication&&this.current_subapplication.start?this.current_subapplication.start():Upfront.Util.log("No current subapplication"),Upfront.Events.trigger("application:mode:after_switch"),!1}var i=this;i.loading=new Upfront.Views.Editor.Loading({loading:Upfront.Settings.l10n.global.application.loading,loading_notice:Upfront.Settings.l10n.global.application.long_loading_notice,loading_type:"upfront-boot",done:Upfront.Settings.l10n.global.application.thank_you_for_waiting,fixed:!0}),i.loading.on_finish(function(){e(Upfront.Settings.LayoutEditor.Selectors.sidebar).show(),e(".upfront-editable_trigger").hide()}),i.loading.render(),e("body").append(i.loading.$el),i.create_sidebar(),require(["objects","media","content","bg-settings","spectrum","responsive","uaccordion","redactor","ueditor","utext","ucomment","ucontact","ugallery","uimage","upfront-like-box","upfront_login","upfront_maps","unewnavigation","ubutton","uposts","usearch","upfront_slider","upfront-social_media","utabs","this_post","upostdata","this_page","uwidget","uyoutube","upfront_code","uspacer"],function(t){i.currentUrl=window.location.pathname+window.location.search,i.saveCache=!0,i.load_layout(_upfront_post_data.layout),i.start_navigation(),i.create_cssEditor(),e(document).trigger("Upfront:loaded"),Upfront.Events.trigger("Upfront:loaded")})},stop:function(){},restart:function(){var e=this.mode.last||this.MODE.DEFAULT;this.start(e)},load_layout:function(t,n){var r=this,i={action:this.actions.load,data:t,load_dev:_upfront_storage_key!=_upfront_save_storage_key?1:0};return n&&(i=_.extend(i,n)),_upfront_post_data&&(i.post_id=_upfront_post_data.post_id),e("body").removeClass(Upfront.Settings.LayoutEditor.Grid.scope),this.loadingLayout&&this.loadingLayout.abort(),this.loadingLayout=Upfront.Util.post(i).success(function(t){r.set_layout_up(t),r.saveCache&&(r.urlCache[r.currentUrl]=e.extend(!0,{},t),r.saveCache=!1)}).error(function(n){if(n.statusText=="abort")return;Upfront.Util.log("Error loading layout "+t),r.loading.cancel(function(){e(Upfront.Settings.LayoutEditor.Selectors.sidebar).hide(),e("#wpadminbar").show(),e("html").removeAttr("style")})}),this.loadingLayout},create_layout:function(t,n){var r=this,i={action:"upfront_create_layout",data:t,load_dev:_upfront_storage_key!=_upfront_save_storage_key?1:0};return n&&(i=_.extend(i,n)),_upfront_post_data&&(i.post_id=_upfront_post_data.post_id),e("body").removeClass(Upfront.Settings.LayoutEditor.Grid.scope),this.loadingLayout&&this.loadingLayout.abort(),this.loadingLayout=Upfront.Util.post(i).success(function(t){r.set_layout_up(t),r.saveCache&&(r.urlCache[r.currentUrl]=e.extend(!0,{},t),r.saveCache=!1)}).error(function(n){if(n.statusText=="abort")return;Upfront.Util.log("Error creating layout "+t),r.loading.cancel(function(){e(Upfront.Settings.LayoutEditor.Selectors.sidebar).hide(),e("#wpadminbar").show(),e("html").removeAttr("style")})}),this.loadingLayout},set_layout_up:function(t){var n=this,r=e.extend(!0,{},t.data.layout)||{};t.data.post&&this.post_set_up(t.data.post);var i=t.data.query||{};this.layout&&(this.unset_layout(),window._upfront_get_current_query=function(){return i}),this.layout=new Upfront.Models.Layout(r),this.current_subapplication.layout=this.layout,this.sidebar.model.set(this.layout.toJSON());var s=this.layout.get("regions").get_by_name("shadow");s&&this.layout.get("regions").remove(s),window._upfront_post_data.layout=t.data.cascade,Upfront.Events.trigger("upfront:layout:loaded"),n.current_subapplication&&n.current_subapplication.start?n.current_subapplication.start():Upfront.Util.log("No current subapplication"),n.layout_view=new Upfront.Views.Layout({model:n.layout,el:e(Upfront.Settings.LayoutEditor.Selectors.main)}),Upfront.Events.trigger("layout:render",n.current_subapplication),n.layout_ready=!0,Upfront.Application.loading.done(function(){Upfront.PreviewUpdate.run(n.layout),Upfront.Events.trigger("application:mode:after_switch")})},unset_layout:function(){var t,n,r;Upfront.data.currentEntity=!1,Upfront.data.Ueditor&&_.each(Upfront.data.Ueditor.instances,function(e){e.stop()}),this.layout&&(this.layout.trigger("destroy"),this.layout=!1),this.current_subapplication.layout&&(this.current_subapplication.layout=!1),this.layout_view&&(n=this.layout_view.el,t={name:n.tagName,id:n.id,className:n.className},r=e("<"+t.name+">"),this.layout_view.$el.after(r),this.layout_view.remove(),this.layout_view=!1,this.layout_ready=!1,r.attr({"class":t.className,id:t.id}),Upfront.Events.off("upfront:editor:init"),Upfront.Events.off("upfront:post:taxonomy_changed")),e(Upfront.Settings.LayoutEditor.Selectors.main).length||e("body").prepend('<div id="page" />')},create_new_entry:function(t){var n=this,r={item:"single-"+t,type:"single",specificity:"single-"+t+"-1000000"},i=new e.Deferred,s={},o=this.set_loading(Upfront.Settings.l10n.global.application.preparing_new_post_type.replace(/%s/,t),Upfront.Settings.l10n.global.application.here_we_are);return this.current_subapplication&&this.current_subapplication.stop&&this.current_subapplication.stop(),Upfront.Events.once("upfront:post:edit:stop",function(e,t){n.navigate("/edit/"+t.post_type+"/"+t.ID+location.search,{trigger:!1,replace:!0})}),Upfront.Events.once("post:initialized",function(e){e.once("post:updated",function(e){Upfront.Settings.LayoutEditor.newpostType=!1,n.navigate("/edit/"+e.post_type+"/"+e.ID,{trigger:!1,replace:!0})}),n.listenToOnce(e.editor,"rendered",function(){setTimeout(function(){e.editor.editContents(!1,e.$(".upfront-content-marker-title"))},200)})}),this.load_layout(r,{new_post:t}).done(function(e){Upfront.Settings.LayoutEditor.newpostType=t,s=e.data.post,Upfront.data.posts[s.ID].is_new=!0,i.resolve(Upfront.data.posts[s.ID]),o.done()}),i.promise()},post_set_up:function(t){t.meta=[];var n=new Upfront.Models.Post(t);n.is_new=t.post_status==="draft"&&t.post_content.indexOf("<p")<0,Upfront.data.posts[n.id]=n,_upfront_post_data.post_id=n.id;var r="logged-in admin-bar customize-support flex-support";t.post_type=="page"?r+=" page page-id-"+n.id+" page-template-default":r+=" single single-"+t.post_type+" postid-"+n.id,n.is_new&&(r+=" is_new"),e("body").removeClass().addClass(r)},set_gridstate:function(e){this.gridstate=e},get_gridstate:function(){return this.gridstate},get_current:function(){return this.mode.current||this.MODE.DEFAULT},set_current:function(e){this.current_subapplication&&this.current_subapplication.stop&&this.current_subapplication.stop(),e||(e=this.MODE.DEFAULT);if(this.mode.current==e)return!1;this.mode.last=this.mode.current,e&&this.MODE.CONTENT==e?(this.mode.current=this.MODE.CONTENT,this.current_subapplication=this.ContentEditor):e&&this.MODE.THEME==e?(this.mode.current=this.MODE.THEME,this.current_subapplication=this.ThemeEditor):e&&this.MODE.POST==e?(this.mode.current=this.MODE.POST,this.current_subapplication=this.PostLayoutEditor):e&&this.MODE.POSTCONTENT==e?(this.mode.current=this.MODE.POSTCONTENT,this.current_subapplication=this.PostContentEditor,this.sidebar.visible&&this.is_editor()&&this.sidebar.toggleSidebar()):e&&this.MODE.RESPONSIVE==e?(this.mode.current=this.MODE.RESPONSIVE,this.current_subapplication=this.ResponsiveEditor):(this.mode.current=this.MODE.LAYOUT,this.current_subapplication=this.LayoutEditor),this.current_subapplication.boot()},create_sidebar:function(){this.sidebar||(this.sidebar=new Upfront.Views.Editor.Sidebar.Sidebar({model:new Upfront.Models.Layout({}),el:e(Upfront.Settings.LayoutEditor.Selectors.sidebar)}))},recursiveExistenceMigration:function(t,n){var r=n.split(" "),i=this;while(r.length>0){try{if(!!e(t+r.join(" ")).closest("#"+i.element_id).length)return!0}catch(s){}r.pop()}return!1},stylesAddSelectorMigration:function(t,n){if(this.is_global_stylesheet&&empty(n))return t;var r=this,i=t.split("}"),s="";return _.each(i,function(t){var i=e.trim(t).split("{");if(i.length!=2)return!0;var o=i[0].split(","),u=[];_.each(o,function(t){t=e.trim(t);var i=t.replace(/:[^\s]+/,""),s=i[0]==="@"||r.recursiveExistenceMigration(n,i),o=s?"":" ";u.push(""+n+o+t+"")}),s+=u.join(", ")+" {"+i[1]+"\n}\n"}),s},create_cssEditor:function(){var t=this,n=new Upfront.Views.Editor.CSSEditor,r,i="";n.fetchThemeStyles(!0).done(function(n){Upfront.data.styles={},_.each(n,function(t,n){Upfront.data.styles[n]=[],_.each(t,function(t,r){t=Upfront.Util.colors.convert_string_ufc_to_color(t),Upfront.data.styles[n].push(r);var i=e("#"+r),s=t.replace(/#page/g,"div#page.upfront-layout-view .upfront-editable_entity.upfront-module");i.length?i.html(s):(i=e('<style id="'+r+'">'+s+"</style>"),e("body").append(i))})}),_.each(Upfront.mainData.iconFonts,function(t){t.active===!0&&(_.each(t.files,function(e,t){i+="url('"+Upfront.mainData.currentThemeUrl+"/icon-fonts/"+e+"') format('";switch(t){case"eot":i+="embedded-opentype";break;case"woff":i+="woff";break;case"ttf":i+="truetype";break;case"svg":i+="svg"}i+="'),"}),r="@font-face {font-family: '"+t.family+"';",t.files.eot&&(r+="src: url('"+Upfront.mainData.currentThemeUrl+"/icon-fonts/"+t.files.eot+"');"),r+="	src:"+i.substring(0,i.length-1)+";",r+="	font-weight: normal;	font-style: normal;}.uf_font_icon, .uf_font_icon * {	font-family: '"+t.family+"'!important;"+"}",e("body").append('<style id="active-icon-font">'+r+"</style>"))}),_upfront_post_data.layout&&t.apply_region_css(),Upfront.Events.trigger("upfront:csseditor:ready")}),n.createSelectors(Upfront.Application.LayoutEditor.Objects),n.createSelector(Upfront.Models.ModuleGroup,Upfront.Views.ModuleGroup,"ModuleGroup"),n.createSelector(Upfront.Models.Region,Upfront.Views.RegionContainerView,"RegionContainer"),n.createSelector(Upfront.Models.Region,Upfront.Views.RegionView,"Region"),n.createSelector(Upfront.Models.Region,Upfront.Views.RegionLightboxView,"RegionLightbox"),Upfront.Events.on("upfront:layout:loaded",t.apply_region_css,t),Upfront.Events.on("upfront:layout:loaded",t.ensure_layout_style,t),this.cssEditor=n},ensure_layout_style:function(){var t;Upfront.Application.current_subapplication.layout&&!e("style#layout-style").length&&(t=Upfront.Application.current_subapplication.layout.get("properties").findWhere({name:"layout_style"})?Upfront.Application.current_subapplication.layout.get("properties").findWhere({name:"layout_style"}).get("value"):"",t&&t.length&&(t=Upfront.Util.colors.convert_string_ufc_to_color(t)),e("body").append('<style id="layout-style">'+t+"</style>"))},apply_region_css:function(){var t=this,n=_upfront_post_data.layout.specificity||_upfront_post_data.layout.item||_upfront_post_data.layout.type;_.each(Upfront.data.styles,function(r,i){if(i!=t.cssEditor.elementTypes.RegionContainer.id&&i!=t.cssEditor.elementTypes.Region.id)return;if(!_.isArray(r))return;_.each(r,function(t){var r=e("#"+t);r.length&&(t.match(new RegExp("^"+n))||t.match(new RegExp("^"+i)))?r.prop("disabled",!1):r.prop("disabled",!0)})})},adjust_grid_padding_settings:function(t){$region=e(t).parent(),padding_top=parseInt($region.css("padding-top")),padding_bottom=parseInt($region.css("padding-bottom")),padding_top>0&&$region.find(".upfront-overlay-grid").css("top",padding_top*-1),padding_bottom>0&&$region.find(".upfront-overlay-grid").css("bottom",padding_bottom*-1)},fetchLayout:function(e,t){this.mode.current!=this.MODE.LAYOUT&&this.start(this.MODE.LAYOUT);var n=this,r=t?[]:!1,i=e?"/"+e:"/",s;r&&(_.each(t,function(e,t){r.push(t+"="+e)}),i+="?"+r.join("&")),s=this.set_loading(Upfront.Settings.l10n.global.application.loading_path.replace(/%s/,i),Upfront.Settings.l10n.global.application.here_we_are),this.urlCache[i]?setTimeout(function(){Upfront.Settings.LayoutEditor.newpostType=!1,n.set_layout_up(n.urlCache[i]),n.currentUrl=i,s.done()},150):(n.unset_layout(),this.load_layout(i).done(function(e){Upfront.Settings.LayoutEditor.newpostType=!1,s.done(),Upfront.Settings.LayoutEditor.newpostType=!1,n.urlCache[i]=e,this.currentUrl=i}))},start_navigation:function(){var e=this,t=document.createElement("a");t.href=Upfront.Settings.site_url,Backbone.history.start({pushState:!0,root:t.pathname,silent:!0})},set_loading:function(t,n){var r=this,i=this.loadingLayer;return i?(document.querySelector(".upfront-loading-text").innerText=t,i.options.done=n):(i=new Upfront.Views.Editor.Loading({loading:t,done:n,fixed:!0}),i.render(),e("body").append(i.$el),i.on_finish(function(){r.loadingLayer=!1})),this.loadingLayer=i,i},listenToResponsiveModes:function(){if(this.responsiveMode)return;var e=this;this.responsiveMode="desktop",this.listenTo(Upfront.Events,"upfront:layout_size:change_breakpoint",function(t,n){e.responsiveMode=t.id})}}));return{Application:v}}),e(function(){e("body").on("click",".upfront-edit_layout",function(e){e.preventDefault()})})}(jQuery),function(e){window.empty=function(e){return"undefined"==typeof e?!0:!e},window.count=function(e){return"undefined"==typeof e?0:e&&e.length?e.length:0},_.mixin({isTrue:function(e){if(typeof e=="undefined")return!1;if(_.isString(e))return e.toLowerCase()==="true";if(_.isNumber(e))return 0!==e}});var t=function(e){var t=(new Date).getTime(),n=Math.max(0,16-(t-lastTime)),r=setTimeout(function(){e(t+n)},n);return lastTime=t+n,r};define("util",[],function(){var n=function(t){return!e.trim(t)||e.trim(t)=="#"||e.trim(t)==""?"unlink":t.length&&t[0]=="#"?t.indexOf("#ltb-")>-1?"lightbox":"anchor":typeof window.location.origin!="undefined"&&t.substring(0,window.location.origin.length)==window.location.origin?typeof window.location.pathname!="undefined"&&t.substring(window.location.origin.length,window.location.origin.length+window.location.pathname.length)==window.location.pathname&&t.substring(window.location.origin.length+window.location.pathname.length)[0]=="#"?"anchor":"entry":t.match(/^mailto/)?"email":"external"},r={isRTL:function(){return!!Upfront.mainData.isRTL},model_to_json:function(e){if(!e)return{};var t=e&&e.toJSON?e.toJSON():e,n=JSON.stringify(t),r=JSON.parse(n);return r},get_unique_id:function(e){return _.template("{{prefix}}-{{stamp}}-{{numeric}}",{prefix:e||"entity",stamp:(new Date).getTime(),numeric:Math.floor(Math.random()*999+1e3)})},log:function(){var e=["[UPFRONT]: "].concat(arguments);console.log.apply(console,e)},dbg:function(){Upfront.Util.log(JSON.stringify(arguments[0]))},clone:function(e){return jQuery.extend(!0,{},e)},preg_quote:function(e){var t=/[|\\{}()[\]^$+*?.]/g;if(typeof e!="string")throw new TypeError("Expected a string");return e.replace(t,"\\$&")},css_support:function(e){var t=document.createElement("div"),n=new RegExp("(khtml|moz|ms|webkit|)"+e,"i");for(s in t.style)if(s.match(n))return!0;return!1},post:function(t,n){var r=_.isObject(t)&&t.action?t:{action:"upfront_request",data:t};return Upfront.Application.current_subapplication.layout&&(r.layout=Upfront.Application.current_subapplication.layout.get("layout")),r.storage_key||(r.storage_key=_upfront_storage_key),r.stylesheet=_upfront_stylesheet,r.mode=Upfront.Application.get_current(),r.dev=location.search.indexOf("dev=true")>-1,r.isbuilder=Upfront.Application.is_builder(),e.post(Upfront.Settings.ajax_url,r,function(){},n?n:"json")},reset_layout:function(){var e={action:"upfront_reset_layout"};return this.post(e)},reset_cache:function(){var e={action:"upfront_reset_cache"};return this.post(e)},reset_all:function(){var e={action:"upfront_reset_all_from_db"};return this.post(e)},format_date:function(e,t,n){if(!e||!e.getFullYear){if(e&&e.length){var r=e;e=new Date(Date.parse(e));if(!e)return r}if(!e||!e.getFullYear)return e}var i=e.getFullYear()+"/",s=e.getDate(),o=e.getMonth()+1;s<10&&(s="0"+s),o<10&&(o="0"+o),i+=o+"/"+s;if(t){var u=e.getHours(),a=e.getMinutes();i+=" "+(u<10?"0":"")+u+":"+(a<10?"0":"")+a;if(n){var f=e.getSeconds();i+=":"+(f<10?"0":"")+f}}return i},get_avatar:function(e,t){var n=window.location.href.split("//"),r=n[0]+"//www.gravatar.com/avatar/",i="";t=t&&parseInt(t,10)==t?t:32;if(_.isString(e))i=e;else{if(!(e instanceof Upfront.Models.User||e instanceof Upfront.Models.Comment))return!1;i=e.get("gravatar")}return r+i+"?d=mm&s="+t},grid:{update_class:function(e,t,n){if(_.isUndefined(n))var n=t.replace(/[^\d.]/g,""),r=t.replace(n,"");else r=t;var i=new RegExp("\\b"+r+"\\d+");e.hasClass(r+n)||(e.attr("class").match(i)?e.attr("class",e.attr("class").replace(i,r+n)):e.addClass(r+n))},col_to_width:function(e){if(!e)return 0;var t=Upfront.Settings.LayoutEditor.Grid.column_width,n=Upfront.Settings.LayoutEditor.Grid.class;return parseInt(e.replace(n,""),10)*t},width_to_col:function(e,t){t=typeof t=="undefined"?!1:t,e=parseInt(e,10);if(e<0)return 0;var n=Upfront.Settings.LayoutEditor.Grid.column_width;return Math[t?"ceil":"floor"](e/n)},height_to_row:function(e){var t=Upfront.Settings.LayoutEditor.Grid.baseline;return Math.ceil(e/t)},normalize_width:function(e){return this.width_to_col(e)*Upfront.Settings.LayoutEditor.Grid.column_width},normalize_height:function(e){return this.height_to_row(e)*Upfront.Settings.LayoutEditor.Grid.baseline},derive_from_classes:function(e,t){if(!e||e.length<2||!t)return!1;var n=new RegExp("("+t+"\\d+(d)*)","g"),r=e.match(n);return _.isEmpty(r)?!1:r[0]},derive_column_class:function(e){return this.derive_from_classes(e,"c")},derive_margintop_class:function(e){return this.derive_from_classes(e,"mt")},derive_marginleft_class:function(e){return this.derive_from_classes(e,"ml")}},width_to_col:function(e){return this.grid.width_to_col(e)},height_to_row:function(e){return this.grid.height_to_row(e)},openLightboxRegion:function(e){var t=Upfront.Application.layout.get("regions"),n=t.get_by_name(e);if(!n)return;_.each(t.models,function(e){e.attributes.sub=="lightbox"&&Upfront.data.region_views[e.cid].hide()}),Upfront.data.region_views[n.cid].show()},find_sorted:function(e,t){return e.find(t).each(Upfront.Util.normalize_sort_elements_cb).sort(Upfront.Util.sort_elements_cb)},sort_elements_cb:function(t,n){var r=e(t).data("breakpoint_order"),i=e(n).data("breakpoint_order");return _.isNumber(r)||(r=e(t).data("dom_order")),_.isNumber(i)||(i=e(n).data("dom_order")),r>i?1:-1},normalize_sort_elements_cb:function(t){e(this).data("dom_order",t)},find_from_elements:function(t,n,r,i,s){var o=t.index(e(n)),u=i?_.first(t,o).reverse():_.rest(t,o+1),a=!1,f=r&&_.isFunction(r),l=s&&_.isFunction(s);return e(_.filter(u,function(n){return a?!1:f&&r(e(n),t)||!f&&e(n).is(r)?s&&(l&&s(e(n),t)||!l&&e(n).is(s))?(a=!0,!1):!0:!1}))},requestAnimationFrame:e.proxy(window.requestAnimationFrame,window)||e.proxy(window.webkitRequestAnimationFrame,window)||e.proxy(window.mozRequestAnimationFrame,window)||e.proxy(window.oRequestAnimationFrame,window)||e.proxy(window.msRequestAnimationFrame,window)||t,template:function(e){var t=_.templateSettings,n=!1;return _.templateSettings={interpolate:/<\?php echo (.+?) \?>/g,evaluate:/<\?php (.+?) \?>/g},n=_.template(e),_.templateSettings=t,function(e){return _.each(e,function(t,n){e["$"+n]=t}),n(e)}},Transient:{_memory_queue:{},_key:window.location.path+window.location.search,initialize:function(){Upfront.Settings.Debug.transients||(this._memory_queue[this._key]=JSON.stringify({}))},get_current:function(){return this._memory_queue[this._key]?JSON.parse(this._memory_queue[this._key]):{}},length:function(e){var t=this.get(e);return t.length},set:function(e,t){var n=this.get_current();n[e]=r.model_to_json(t),this._memory_queue[this._key]=JSON.stringify(n)},get:function(e){var t=this.get_current(),n=t[e]||!1;return n},get_all:function(e){var t=e?new RegExp(e):!1,n=[],r=this._memory_queue[this._key]?JSON.parse(this._memory_queue[this._key]):!1;return r&&_(r).each(function(e,r){if(t&&!r.match(t))return!0;n=e}),n},push:function(e,t){var n=this.get(e)||[];return n.push(t),this.set(e,n)},pop:function(e){var t=this.get(e)||[],n=t&&t.pop?t.pop():!1;return this.set(e,t),n}},date:{php_format_to_jquery:function(e){var t={d:"dd",D:"D",j:"d",l:"DD",N:"",S:"",w:"",z:"o",W:"",F:"MM",m:"mm",M:"M",n:"m",t:"",L:"",o:"",Y:"yy",y:"y",a:"",A:"",B:"",g:"",G:"",h:"",H:"",i:"",s:"",u:""};jqueryui_format="",escaping=!1;for(var n=0;n<e.length;n++)char=e[n],char==="\\"?(n++,escaping?jqueryui_format+=e[n]:jqueryui_format+="'"+e[n],escaping=!0):(escaping&&(jqueryui_format+="'",escaping=!1),_.isUndefined(t[char])?jqueryui_format+=char:jqueryui_format+=t[char]);return jqueryui_format},php_format_to_js:function(e){var t={d:"dd",D:"D",j:"d",l:"DD",N:"",S:"",w:"",z:"o",W:"",F:"MMMM",m:"mmmm",M:"M",n:"m",t:"",L:"",o:"",Y:"yyyy",y:"y",a:"",A:"",B:"",g:"",G:"",h:"",H:"",i:"",s:"",u:""};jqueryui_format="",escaping=!1;for(var n=0;n<e.length;n++)char=e[n],char==="\\"?(n++,escaping?jqueryui_format+=e[n]:jqueryui_format+="'"+e[n],escaping=!0):(escaping&&(jqueryui_format+="'",escaping=!1),_.isUndefined(t[char])?jqueryui_format+=char:jqueryui_format+=t[char]);return jqueryui_format}},colors:{to_color_value:function(e){return Upfront.Util.colors.is_theme_color(e)?Upfront.Util.colors.get_color(e):e},is_theme_color:function(e){return!e||!e.match?!1:!!e.match(/^#?ufc\d+$/)},get_ufc:function(e){if(_.isEmpty(e))return!1;e=tinycolor(e);var t=Upfront.Views.Theme_Colors.colors.pluck("color"),n;for(var r in t)t[r].replace("#","")===e.toHex()&&(n="ufc"+r);return n},get_color:function(e){if(_.isEmpty(e))return!1;var t=Upfront.Views.Theme_Colors.colors.pluck("color"),n=Upfront.Views.Theme_Colors.colors.pluck("alpha"),r=parseInt(e.replace("ufc","").replace("#",""),10),i=t[r]==="#000000"&&n[r]===0?"inherit":t[r];return i},convert_string_ufc_to_color:function(e,t){if(_.isEmpty(e))return e;t=typeof t=="undefined"?!0:t;var n=Upfront.Views.Theme_Colors.colors.pluck("color"),r=Upfront.Views.Theme_Colors.colors.pluck("alpha"),i=new RegExp("/\\*[^,;\\n]*#ufc(\\d*)\\*/[^,;\\n]*([\\*/]*((#[A-Fa-f0-9]+)+|(rgb[a]?[^\\)]*\\))))+","g");e=e.replace(i,"#ufc$1");for(var s in n){var o=n[s]==="#000000"&&r[s]===0?"inherit":n[s],u=new RegExp("#ufc"+s,"g");o=t?"/*#ufc"+s+"*/"+o:o,e=e.replace(u,o)}return e},remove_ufcs:function(e){var t=Upfront.Views.Theme_Colors.colors.pluck("color");for(var n in t){var r=new RegExp("/\\*#ufc"+n+"\\*/"+t[n],"g"),i=t[n];e=e.replace(r,i)}return e},convert_string_color_to_ufc:function(e){var t=Upfront.Views.Theme_Colors.colors.pluck("color");for(var n in t){var r=new RegExp("/\\*#ufc"+n+"\\*/"+t[n],"gi"),i="#ufc"+n;e=e.replace(r,i)}return e},update_colors_in_dom:function(t,n,r){var i=new RegExp("/\\*#ufc"+r+"\\*/#(?:[0-9a-fA-F]{3}){1,2}","gi"),s=document.getElementsByTagName("html")[0],o="/*#ufc"+r+"*/"+n,u=findAndReplaceDOMText(s,{find:i,replace:function(e,t){return o}});e(".upfront-plain_txt > p").each(function(){var t=e(this),n=t.html();t.html(n.replace(i,o))});var a=e("*").filter(function(){return e(this).data("ufc")});return e(a).each(function(){var t=e(this),n=t.data("ufc"),r=t.data("ufc_rule");t.css(r,n)}),u},update_colors_to_match_ufc:function(e){var t=Upfront.Views.Theme_Colors.colors.pluck("color");for(var n in t){var r=new RegExp("/\\*#ufc"+n+"\\*/#(?:[0-9a-fA-F]{3}){1,2}","gi"),i="/*#ufc"+n+"*/"+t[n];e=e.replace(r,i)}return e}},guessLinkType:n,visitLink:function(t){var r=n(t),i,s,o,u;r==="lightbox"?(i=Upfront.Application.layout.get("regions"),s=i?i.get_by_name(t.substring(1)):!1,s&&(_.each(i.models,function(e){e.attributes.sub=="lightbox"&&Upfront.data.region_views[e.cid].hide()}),o=Upfront.data.region_views[s.cid],o.show())):r=="anchor"?(u=t.replace(/^.*?#/,"#"),e(u).length>0?e("html,body").animate({scrollTop:e(u).offset().top},"slow"):console.log("obselete anchor")):r=="entry"?window.location.href=t.replace("&editmode=true","").replace("editmode=true","")+(t.indexOf("?")>0?"&editmode=true":"?editmode=true"):window.open(t)},checkLightbox:function(e){return regions=Upfront.Application.layout.get("regions"),lightbox=regions?regions.get_by_name(e.substring(1)):!1,lightbox?!0:!1}},i={$popup:{},$background:{},_deferred:{},init:function(){e("#upfront-popup").length?this.close():e("#page").append('<div id="upfront-popup" class="upfront-ui" style="display:none"><div id="upfront-popup-close" class="upfront-icon upfront-icon-popup-close">&times;</div><div class="upfront-popup-meta" id="upfront-popup-top"></div><div id="upfront-popup-content"></div><div class="upfront-popup-meta" id="upfront-popup-bottom"></div></div>').append("<div id='upfront-popup-background' style='display:none' />"),this.$popup=e("#upfront-popup"),this.$background=e("#upfront-popup-background"),this.$popup.find("#upfront-popup-content").empty()},open:function(t,n,r){n=n||{},this.data=n,r=r||"default-popup",this.init();var i=this,s=e("#sidebar-ui").width(),o=e(window),u=n.width||630,a=(o.width()-u)/2+s/2,f=o.height()/3*2,l=function(){return e("#upfront-popup").attr("class","upfront-ui"),i.close(),!1};return e("body").bind("keyup",function(e){e.keyCode===27&&i.close()}),this.$background.on("click",l).show(),this.$popup.show().find("#upfront-popup-close").on("click",l).end(),r&&this.$popup.addClass(r).data("classname",r),e("body").addClass("upfront-popup-open"),t.apply(this.$popup.find("#upfront-popup-content").get(),[n,this.$popup.find("#upfront-popup-top"),this.$popup.find("#upfront-popup-bottom")]),this._deferred=new e.Deferred,this._deferred.promise()},close:function(t){this.data.hold_editor?this._deferred.notify("dont_close"):this._deferred.notify("before_close"),this.$background.hide(),this.$popup.hide().find("#upfront-popup-content").empty(),this.$popup.find("#upfront-popup-top").empty(),this.$popup.find("#upfront-popup-bottom").empty(),e("body").removeClass("upfront-popup-open");var n=this.$popup.data("classname");n&&this.$popup.removeClass(n),Upfront.Events.trigger("popup:closed"),this._deferred.resolve(this.$popup,t)}},o=function(){var e=!1,t=!1,n=!1,r=!1,i=!1,s=!1,o=function(e){!Upfront.Settings.Application.PERMS.REVISIONS||(Upfront.Application.mode.current===Upfront.Application.MODE.THEME?u():(t=e,rebind_events())),window.onbeforeunload=warn},u=function(){Upfront.Events.off("entity:region:deactivated",a),Upfront.Events.off("entity:settings:deactivate",a),Upfront.Events.off("entity:removed:after",a),Upfront.Events.off("entity:resize_start",a),Upfront.Events.off("entity:drag_stop",a),Upfront.Events.off("entity:module:after_render",a),Upfront.Events.off("upfront:element:edit:stop",a),Upfront.Events.on("entity:region:deactivated",a,this),Upfront.Events.on("entity:settings:deactivate",a,this),Upfront.Events.on("entity:removed:after",a,this),Upfront.Events.on("entity:resize_start",a,this),Upfront.Events.on("entity:drag_stop",a,this),Upfront.Events.on("entity:module:after_render",a,this),Upfront.Events.on("upfront:element:edit:stop",a,this),Upfront.Events.off("command:layout:export_theme",clear),Upfront.Events.on("command:layout:export_theme",clear)},a=function(){r=!0};return rebind_events=function(){var e=this;Upfront.PreviewUpdate.__deferred_save_callback=Upfront.PreviewUpdate.__deferred_save_callback||_.debounce(save,200),Upfront.Events.off("entity:removed:after",Upfront.PreviewUpdate.__deferred_save_callback),Upfront.Events.off("entity:resize_start",Upfront.PreviewUpdate.__deferred_save_callback),Upfront.Events.off("entity:drag_stop",Upfront.PreviewUpdate.__deferred_save_callback),Upfront.Events.off("upfront:element:edit:stop",Upfront.PreviewUpdate.__deferred_save_callback),Upfront.Events.on("entity:removed:after",Upfront.PreviewUpdate.__deferred_save_callback,this),Upfront.Events.on("entity:resize_start",Upfront.PreviewUpdate.__deferred_save_callback,this),Upfront.Events.on("entity:drag_stop",Upfront.PreviewUpdate.__deferred_save_callback,this),Upfront.Events.on("upfront:element:edit:stop",Upfront.PreviewUpdate.__deferred_save_callback,this),Upfront.Events.off("model:property:add",Upfront.PreviewUpdate.__deferred_save_callback),Upfront.Events.off("model:property:set",Upfront.PreviewUpdate.__deferred_save_callback),Upfront.Events.on("model:property:add",Upfront.PreviewUpdate.__deferred_save_callback,this),Upfront.Events.on("model:property:set",Upfront.PreviewUpdate.__deferred_save_callback,this),Upfront.Events.off("entity:region:deactivated",Upfront.PreviewUpdate.__deferred_save_callback,this),Upfront.Events.on("entity:region:deactivated",Upfront.PreviewUpdate.__deferred_save_callback,this),Upfront.Events.off("command:layout:save_success",clear),Upfront.Events.on("command:layout:save_success",clear)},set_data=function(){e=Upfront.Util.model_to_json(t),e&&e.regions&&(e.regions=_(e.regions).reject(function(e){return e.name==="shadow"})),e.layout=_upfront_post_data.layout,e.preferred_layout=t.get("current_layout"),e=JSON.stringify(e)},save=function(){if(n)return!1;n=!0,r=!0,set_data(),Upfront.Events.trigger("preview:build:start"),Upfront.Util.post({action:"upfront_build_preview",data:e,current_url:window.location.href}).success(function(e){var t=e.data||{};"html"in t&&t.html?(i=t.html,s=t.idx):Upfront.Util.log("Invalid response"),n=!1,Upfront.Events.trigger("preview:build:stop");if("concurrent_users"in t&&t.concurrent_users&&_.size(t.concurrent_users)){var r=_.values(t.concurrent_users).join(", ");Upfront.Views.Editor.notify(Upfront.Settings.l10n.global.views.already_edited_nag.replace(/%s/,r),"error")}}).error(function(){Upfront.Util.log("error building layout preview")}),o(t)},clear=function(){r=!1},warn=function(e){var e=e||window.event,t=Upfront.Settings.l10n.global.views.unsaved_changes_nag;if(!n&&!r)return;return e&&(e.returnValue=t),t},get_preview_url=function(){return i},get_revision=function(){return s},{run:o,preview_url:get_preview_url,get_revision:get_revision,rebind_events:rebind_events}};return{Util:r,Popup:i,PreviewUpdate:new o}})}(jQuery);var Upfront=window.Upfront||{};Upfront.mainData=Upfront.mainData||{},Upfront.Events={},define("jquery",[],function(){return jQuery}),require.config(Upfront.mainData.requireConfig),require(["backbone"],function(e){_.templateSettings={evaluate:/\{\[([\s\S]+?)\]\}/g,interpolate:/\{\{([\s\S]+?)\}\}/g},require(["application","util"],function(t,n){_.extend(Upfront.Events,e.Events),Upfront.Settings={ace_url:"//cdnjs.cloudflare.com/ajax/libs/ace/1.1.01/ace.js",root_url:Upfront.mainData.root,ajax_url:Upfront.mainData.ajax,admin_url:Upfront.mainData.admin,site_url:Upfront.mainData.site,Debug:Upfront.mainData.debug,ContentEditor:{Requirements:Upfront.mainData.layoutEditorRequirements,Selectors:{sidebar:"#sidebar-ui"}},Application:{MODE:Upfront.mainData.applicationModes,NO_SAVE:Upfront.mainData.readOnly,DEBUG:!1,PERMS:Upfront.mainData.PERMS},LayoutEditor:{Requirements:Upfront.mainData.layoutEditorRequirements,Selectors:{sidebar:"#sidebar-ui",commands:"#commands",properties:"#properties",layouts:"#layouts",settings:"#settings",contextmenu:"#contextmenu",main:"#page"},Specificity:Upfront.mainData.specificity,Grid:Upfront.mainData.gridInfo,Theme:Upfront.mainData.themeInfo},Content:Upfront.mainData.content,l10n:Upfront.mainData.l10n},window._upfront_debug_mode&&(Upfront.Settings.Application.DEBUG=!0,Upfront.Settings.Application.NO_SAVE=!0),_.extend(Upfront,t),_.extend(Upfront,n),Upfront.Util.Transient.initialize(),Upfront.LoadedObjectsDeferreds={},Upfront.Events.trigger("application:loaded:layout_editor"),Upfront.Application&&Upfront.Application.boot?Upfront.Application.boot():Upfront.Util.log("something went wrong")})}),define("main",function(){});