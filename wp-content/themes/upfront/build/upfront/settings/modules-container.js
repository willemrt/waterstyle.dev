define(["scripts/upfront/settings/module-factory"],function(e){var t=Backbone.View.extend({initialize:function(t){this.options=t||{};var n=[],r=this,i=this.options.modules;_.isUndefined(i)&&(i=this.modules),typeof this.getAdditionalModules=="function"&&(i=this.getAdditionalModules(_.clone(i))),_.each(i,function(t){t.options=t.options||{},"change"in t.options&&(t.options.preservedChangeCallback||(t.options.preservedChangeCallback=t.options.change),t.options.change=function(e){t.options.preservedChangeCallback(e,r)},Upfront.Events.once("entity:settings:deactivate",function(){t.options.change=t.options.preservedChangeCallback}));var i=e.createModule(t.moduleType,t.options||{},this.options.model);i.panel=this,n.push(i)},this),this.modules=_(n),this.onInitialize&&this.onInitialize(t)},render:function(){this.$el.html(""),this.$el.append('<div class="upfront-settings-item-content"></div>');var e=this.$el.find(".upfront-settings-item-content");this.modules.each(function(t){t.render(),t.delegateEvents(),e.append(t.el)})},save_settings:function(){if(!this.modules)return;var e=this;this.modules.each(function(e){e.fields.size()>0&&e.save_fields()})}});return t});